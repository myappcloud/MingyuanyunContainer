(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c519870"],{"0ad4":function(t,n,e){},"0f10":function(t,n,e){},"659a":function(t,n,e){"use strict";e("0f10")},"7b4e":function(t,n,e){"use strict";e("0ad4")},"8b57":function(t,n,e){"use strict";e.r(n);var a=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("app-container",[e("app-header",{attrs:{title:"公告"},on:{"click-right":t.updateStatus}},[e("span",{attrs:{slot:"right"},slot:"right"},[t._v("全部已读")])]),e("div",{staticClass:"list"},[e("van-pull-refresh",{staticClass:"refresh-wrapper",on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(n){t.isLoading=n},expression:"isLoading"}},[e("empty-page",{attrs:{emptyMsg:"暂无公告",showEmpty:!t.announcementData.length,loadingPage:this.loading}}),e("van-list",{attrs:{finished:t.finished,"finished-text":"— 干工程是有底线的 —","immediate-check":!1},on:{load:t.loadMore},model:{value:t.loadingMore,callback:function(n){t.loadingMore=n},expression:"loadingMore"}},[e("div",{staticClass:"content"},t._l(t.announcementData,(function(t){return e("div",{key:t.id,staticClass:"content-item"},[e("announcement-item",{attrs:{"item-data":t}})],1)})),0)])],1)],1)],1)},i=[],o=(e("51d7"),e("5cff"),e("4d20"),e("dcd4"),function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"announcement-item",on:{click:t.goToDetail}},[e("div",{staticClass:"announcement-item-title-container"},[e("div",{staticClass:"title"},[+t.itemData.have_read?t._e():e("div",{staticClass:"dot"}),e("div",{staticClass:"hidden"},[t._v(t._s(t.itemData.subject))])]),e("p",{staticClass:"time"},[t._v(t._s(t.handleTime(t.itemData.published_on)))])])])}),r=[],c=(e("eb27"),e("e5e2")),s={props:{itemData:{type:Object,isRequired:!0}},methods:{handleTime:function(t){var n=t.slice(5),e=n.substring(0,n.length-3);return e},goToDetail:function(){var t=this.itemData,n=t.id,e=t.have_read;this.$router.push("/announcement/detail/".concat(n)),+e||this.updateStatus()},updateStatus:function(){var t=this.itemData.id;return c["a"].updateAnnouncementStatus({announcement_ids:[t]}).then((function(t){console.log(t)}))}}},u=s,d=(e("7b4e"),e("5d22")),h=Object(d["a"])(u,o,r,!1,null,"9544e412",null),l=h.exports,f=1,m={name:"AnnouncementIndex",components:{AnnouncementItem:l},data:function(){return{loading:!1,isLoading:!1,loadingMore:!1,finished:!1,announcementData:[],recordCount:0}},activated:function(){this.init()},methods:{init:function(){this.loading=!1,this.isLoading=!1,this.loadingMore=!1,this.finished=!1,this.announcementData=[],f=1,this.recordCount=0,this.getList()},onRefresh:function(){var t=this;if(this.loading)return!1;this.isLoading=!0,this.finished=!1,this.getList().then((function(){t.isLoading=!1})).catch((function(){t.isLoading=!1}))},loadMore:function(){var t=this;return this.finished=this.announcementData.length>=this.recordCount,this.finished?(this.loadingMore=!1,!1):this.getList(!1).then((function(){t.loadingMore=!1})).catch((function(){t.loadingMore=!1}))},getList:function(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.loading)return Promise.reject(!1);n&&(f=1),this.loading=!0;var e={page_size:20,page_index:f};return c["a"].getAnnouncementList(e).then((function(e){t.loading=!1;var a=e.announcementData,i=e.recordCount;t.announcementData=n?a:t.announcementData.concat(a),f++,t.recordCount=i,t.finished=t.announcementData.length>=i})).catch((function(n){return console.error(n),t.loading=!1,Promise.reject("获取失败")}))},updateStatus:function(){var t=this;if(this.announcementData.length){var n=[];return this.announcementData.forEach((function(t){+t.have_read||n.push(t.id)})),c["a"].updateAnnouncementStatus({announcement_ids:n}).then((function(){t.announcementData.forEach((function(t){t.have_read="1"}))}))}}}},g=m,p=(e("659a"),Object(d["a"])(g,a,i,!1,null,"369a2c00",null));n["default"]=p.exports},e5e2:function(t,n,e){"use strict";e("4d20"),e("51d7");var a,i=e("10c8"),o=e("1f03"),r=window.GLOBAL_ENV.SSO_CENTER_DEFAULT_API,c=Object(o["getUserContext"])().userId,s=function(){var t=Object(o["getUserContext"])();if(a&&t.userId===c)return Promise.resolve(a);c=t.userId;var n=t.tenantCode;return Object(i["a"])({method:"get",url:"".concat(r,"/m/").concat(n,"/PermissionApply/permission-init/get-userid-by-openid"),data:{tenantCode:n,openId:t.userId}}).then((function(t){return t.errcode?Promise.reject(t.message):(a=t.data,t.data)})).catch((function(t){throw new Error(t)}))},u=function(t){var n=Object(o["getUserContext"])().tenantCode;return s().then((function(t){return e(t)}));function e(e){return Object(i["a"])({method:"POST",url:"".concat(r,"/m/Organization/api2/announcement-list"),data:Object.assign({},{user_id:e,tenant_code:n},t)}).then((function(t){if(t.errcode)return Promise.reject(t.errMsg);var n=t.data,e=n.list,a=n.count;return{data:e||[],recordCount:a||0}})).catch((function(){return{data:[],recordCount:0}}))}},d=function(t){var n=Object(o["getUserContext"])().tenantCode;return Object(i["a"])({method:"POST",url:"".concat(r,"/m/Organization/api2/announcement-info"),data:{user_id:a,tenant_code:n,announcement_id:t.announcement_id}}).then((function(t){return t.errcode?Promise.reject(t.errMsg):t.data})).catch((function(t){throw new Error(t)}))},h=function(t){var n=Object(o["getUserContext"])().tenantCode;return s().then((function(t){return e(t)}));function e(e){return Object(i["a"])({method:"POST",url:"".concat(r,"/m/Organization/api2/announcement-set-status"),data:Object.assign({},{user_id:e,tenant_code:n},t)}).then((function(t){return t.errcode?Promise.reject(t.errMsg):t})).catch((function(t){throw new Error(t)}))}},l=e("d1d2"),f=e.n(l);n["a"]={getAnnouncementList:function(t){return f.a.getHasNetwork().then((function(n){return n?u(t).then((function(t){var n=t.data,e=t.recordCount;return{announcementData:n,recordCount:e}})):Promise.reject("您的当前网络不可用，请检查您的网络设置")}))},getAnnouncementDetail:function(t){return f.a.getHasNetwork(t).then((function(n){return n?d(t).then((function(t){return t})):Promise.reject("您的当前网络不可用，请检查您的网络设置")}))},updateAnnouncementStatus:function(t){return f.a.getHasNetwork(t).then((function(n){return n?h(t).then((function(t){return t})):Promise.reject("您的当前网络不可用，请检查您的网络设置")}))}}},eb27:function(t,n,e){"use strict";var a=e("bbcf"),i=e("2fb1"),o=e("ec82"),r=e("5501"),c=e("5152"),s=e("e855"),u=e("7389"),d=e("19d6"),h=e("780c"),l=e("e9a9"),f=h("slice"),m=l("slice",{ACCESSORS:!0,0:0,1:2}),g=d("species"),p=[].slice,v=Math.max;a({target:"Array",proto:!0,forced:!f||!m},{slice:function(t,n){var e,a,d,h=s(this),l=c(h.length),f=r(t,l),m=r(void 0===n?l:n,l);if(o(h)&&(e=h.constructor,"function"!=typeof e||e!==Array&&!o(e.prototype)?i(e)&&(e=e[g],null===e&&(e=void 0)):e=void 0,e===Array||void 0===e))return p.call(h,f,m);for(a=new(void 0===e?Array:e)(v(m-f,0)),d=0;f<m;f++,d++)f in h&&u(a,d,h[f]);return a.length=d,a}})}}]);