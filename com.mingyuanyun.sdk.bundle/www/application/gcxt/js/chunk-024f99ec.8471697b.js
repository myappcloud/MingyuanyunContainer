(window["webpackJsonp_module_entry_gcxt_"]=window["webpackJsonp_module_entry_gcxt_"]||[]).push([["chunk-024f99ec"],{"674f":function(t,e,a){e=t.exports=a("690e")(!1),e.push([t.i,'.gcxt[data-v-4883d3f4] :export{colorPrimary:#2c5cf7;headerBackgroundColor:#fff;headerTextColor:#333}.gcxt .contract-settlement-common[data-v-4883d3f4]{height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.gcxt .contract-settlement-common .contract_list[data-v-4883d3f4]{-webkit-box-flex:1;-ms-flex:1;flex:1;overflow-y:auto}.gcxt .contract-settlement-common[data-v-4883d3f4] .van-search{padding:8px 15px}.gcxt .contract-settlement-common[data-v-4883d3f4] .van-search .van-search__content--round{background:#fff;border-radius:5px}.gcxt .contract-settlement-common[data-v-4883d3f4] .van-search .van-icon-search{padding-top:2px}.gcxt .contract-settlement-common[data-v-4883d3f4] .van-search .van-cell{padding:0}.gcxt .contract-settlement-common[data-v-4883d3f4] .van-search input{height:28px}.gcxt .contract-settlement-common[data-v-4883d3f4] .van-search input::-webkit-input-placeholder{color:#ccc}.gcxt .contract-settlement-common[data-v-4883d3f4] .van-search input::-moz-input-placeholder{color:#ccc}.gcxt .contract-settlement-common[data-v-4883d3f4] .van-search input::-ms-input-placeholder{color:#ccc}.gcxt .contract-settlement-common[data-v-4883d3f4] .van-list{background:inherit}.gcxt .contract-settlement-common .state_selector[data-v-4883d3f4]{list-style:none;margin:0;padding:0;background-color:#fff;width:100%;position:relative;z-index:50;display:-webkit-box;display:-ms-flexbox;display:flex}.gcxt .contract-settlement-common .state_selector .state[data-v-4883d3f4]{width:33.3%;text-align:center;padding:14px 0}.gcxt .contract-settlement-common .state_selector .state.active[data-v-4883d3f4]{border-bottom:2px solid #2c5cf7}.gcxt .contract-settlement-common .state_selector .state_count[data-v-4883d3f4]{font-size:24px}.gcxt .contract-settlement-common .state_selector .state_name[data-v-4883d3f4]{color:#999;font-size:13px}.gcxt .contract-settlement-common .contract[data-v-4883d3f4]{background-color:#fff;margin-top:12px;padding:15px}.gcxt .contract-settlement-common .contract_list_wrapper li[data-v-4883d3f4]:first-child{margin-top:0}.gcxt .contract-settlement-common .contract_name_wrapper[data-v-4883d3f4]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-wrap:nowrap;flex-wrap:nowrap;position:relative;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.gcxt .contract-settlement-common .contract_phase[data-v-4883d3f4]{color:#2c5cf7;border:1px solid #2c5cf7;border-radius:2px}.gcxt .contract-settlement-common .contract_final[data-v-4883d3f4],.gcxt .contract-settlement-common .contract_phase[data-v-4883d3f4]{font-size:13px;padding:2px;line-height:13px;vertical-align:middle;height:20px;margin-right:10px;-ms-flex-negative:0;flex-shrink:0}.gcxt .contract-settlement-common .contract_final[data-v-4883d3f4]{color:#f90;border:1px solid #f90;border-radius:2px}.gcxt .contract-settlement-common .contract_name[data-v-4883d3f4]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-right:30px;line-height:30px;font-size:16px}.gcxt .contract-settlement-common .icon-xiala-copy[data-v-4883d3f4]{position:absolute;font-size:14px;color:#999;right:0;top:4px}.gcxt .contract-settlement-common .contract_project[data-v-4883d3f4]{color:#999;font-size:13px}.gcxt .contract-settlement-common .contract_date[data-v-4883d3f4]{float:left;color:#999;line-height:21px;font-size:13px}.gcxt .contract-settlement-common .contract_progress[data-v-4883d3f4]{float:right;text-align:right;color:#f90;max-width:50%;word-break:break-all;font-size:13px}.gcxt .contract-settlement-common .empty-hint[data-v-4883d3f4]{text-align:center;font-size:16px;padding-top:20%;color:#999}.gcxt .contract-settlement-common .empty-hint img[data-v-4883d3f4]{display:block;width:40%;margin:0 auto}.gcxt .contract-settlement-common .settlement_list_wrapper[data-v-4883d3f4]{list-style:none;margin:0;padding:0;background-color:#f7fbff}.gcxt .contract-settlement-common .settlement[data-v-4883d3f4]{margin:0 15px;padding:12px 0;position:relative;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:13px}.gcxt .contract-settlement-common .settlement.line-bottom[data-v-4883d3f4]:last-child:after{display:none}.gcxt .contract-settlement-common .settlement .settlement_type[data-v-4883d3f4]{width:15%}.gcxt .contract-settlement-common .settlement .settlement_type .settlement_phase[data-v-4883d3f4]{display:inline-block;color:#2c5cf7;border:1px solid #2c5cf7;border-radius:2px;width:35px;height:35px;line-height:17.5px;text-align:center}.gcxt .contract-settlement-common .settlement .settlement_type .settlement_final[data-v-4883d3f4]{display:inline-block;color:#f90;border:1px solid #f90;border-radius:2px;width:35px;text-align:center}.gcxt .contract-settlement-common .settlement .settlement_type .settlement_invalid[data-v-4883d3f4]{display:inline-block;width:35px;text-align:center}.gcxt .contract-settlement-common .settlement .settlement_detail[data-v-4883d3f4]{width:50%;word-break:break-all}.gcxt .contract-settlement-common .settlement .settlement_detail_row[data-v-4883d3f4]{float:left;width:100%}.gcxt .contract-settlement-common .settlement .settlement_detail .name[data-v-4883d3f4]{float:left;width:50%;min-height:19px}.gcxt .contract-settlement-common .settlement .settlement_detail .amount[data-v-4883d3f4]{float:left;width:50%;padding-left:5%}.gcxt .contract-settlement-common .settlement .settlement_detail .start_date[data-v-4883d3f4]{float:left;width:50%;color:#999;font-size:13px;min-height:21px}.gcxt .contract-settlement-common .settlement .settlement_detail .declare[data-v-4883d3f4]{float:left;width:50%;color:#999;font-size:13px;padding-left:5%}.gcxt .contract-settlement-common .settlement .settlement_status[data-v-4883d3f4]{width:35%;text-align:right}.gcxt .contract-settlement-common .settlement .icon-back[data-v-4883d3f4]{position:absolute;color:#999;-webkit-transform:rotate(180deg) translateY(50%);transform:rotate(180deg) translateY(50%);right:0;top:50%;font-size:14px}.gcxt .contract-settlement-common .settlement_empty[data-v-4883d3f4]{text-align:center;color:#999;padding-top:15px}.gcxt .contract-settlement-common .settlement_btn_create[data-v-4883d3f4]{position:fixed;padding:0;z-index:150;width:2.5rem;height:2.5rem;line-height:2.5rem;border-radius:1.25rem;background:-webkit-gradient(linear,left top,right top,from(#2c5cf7),to(rgba(44,92,247,.8)));background:linear-gradient(90deg,#2c5cf7 0,rgba(44,92,247,.8));bottom:2rem;left:auto;right:1rem;text-align:center;-webkit-box-shadow:1px 1px 3px 0 #ccc;box-shadow:1px 1px 3px 0 #ccc}.gcxt .contract-settlement-common .settlement_btn_create .icon-plus[data-v-4883d3f4]{display:block;width:100%;font-size:1rem;font-weight:700;color:#fff}.gcxt .contract-settlement-common .line[data-v-4883d3f4]{position:relative}.gcxt .contract-settlement-common .line-left[data-v-4883d3f4]:before{position:absolute;content:"";left:0;top:0;width:1px;height:100%;-webkit-transform:scaleX(.5);transform:scaleX(.5);background-color:#ddd;z-index:15}.gcxt .contract-settlement-common .line-top[data-v-4883d3f4]:before{top:0}.gcxt .contract-settlement-common .line-bottom[data-v-4883d3f4]:after,.gcxt .contract-settlement-common .line-top[data-v-4883d3f4]:before{position:absolute;content:"";left:0;width:100%;height:1px;-webkit-transform:scaleY(.5);transform:scaleY(.5);background-color:#ddd;z-index:15}.gcxt .contract-settlement-common .line-bottom[data-v-4883d3f4]:after{bottom:0}.gcxt .contract-settlement-common .red[data-v-4883d3f4]{color:red}.gcxt .contract-settlement-common .blue[data-v-4883d3f4]{color:#2c5cf7}.gcxt .contract-settlement-common .orange[data-v-4883d3f4]{color:#f90}.gcxt .contract-settlement-common .green[data-v-4883d3f4]{color:#75c813}.gcxt .contract-settlement-common .gray[data-v-4883d3f4]{color:#aaa}.gcxt .search-bar[data-v-4883d3f4]{border-bottom:1px solid #ececec}',""])},"76a5":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("page",{staticClass:"contract-settlement-common"},[n("v-header",{attrs:{slot:"header","back-action":t.onBack,title:"合同结算"},slot:"header"}),n("search-bar",{staticClass:"search-bar",attrs:{placeholder:"合同名、合同号、项目名、公司名"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),n("ul",{staticClass:"state_selector line line-bottom"},t._l(t.state,(function(e,a){return n("li",{key:a,class:["state",{active:t.xt_js_state===e.value}],on:{click:function(n){t.toggleState(e,a)}}},[n("div",{class:["line","line-left","state_wrapper",e.class]},[n("div",{staticClass:"state_count",domProps:{innerHTML:t.xss(t._s(e.count))}}),n("div",{staticClass:"state_name",domProps:{innerHTML:t.xss(t._s(e.name))}})])])}))),n("div",{staticClass:"contract_list"},[t.ready?n("scroll-refresh",{attrs:{loading:t.loading,finished:t.finished,"finished-text":""},on:{refresh:t.refresh,more:t.loadList}},[n("ul",{class:["contract_list_wrapper",{detail_mode:t.detail_mode}]},t._l(t.contract_list_filter,(function(e,a){return n("li",{key:a,class:["line","line-top","line-bottom","contract",{selected:e.contract_id===t.selected_contract.contract_id}],style:{display:t.detail_mode&&e.contract_id!==t.selected_contract.contract_id?"none":"block"},on:{click:function(n){t.toggleContract(e,a)}}},[n("div",{staticClass:"contract_name_wrapper"},["阶段结算"===e.settlement_type?n("span",{staticClass:"contract_phase"},[t._v("阶段结算")]):t._e(),"结算"===e.settlement_type?n("span",{staticClass:"contract_final"},[t._v("结算")]):t._e(),n("span",{staticClass:"contract_name"},[t._v(t._s(e.contract_name))]),n("i",{staticClass:"iconfont icon-_xiala"})]),n("div",{staticClass:"contract_project",domProps:{innerHTML:t.xss(t._s(e.project_name))}}),n("div",{staticClass:"clearfix"},[e.plan_start_date&&"0000-00-00 00:00:00"!==e.plan_start_date?n("span",{staticClass:"contract_date"},[t._v("计划开始日期:"+t._s(e.plan_start_date?e.plan_start_date.split(" ")[0]:""))]):t._e(),e.plan_start_date&&"0000-00-00 00:00:00"===e.plan_start_date?n("span",{staticClass:"contract_date"},[t._v("计划开始日期: --")]):t._e(),t.detail_mode?t._e():n("span",{class:["contract_progress",{red:"草稿"===e.check_status_desc}],domProps:{innerHTML:t.xss(t._s(e.check_status_desc))}})])])}))),t.record_count?t._e():n("div",{staticClass:"empty-hint"},[n("img",{attrs:{src:a("c0c2")}}),n("div",[t._v("暂无"+t._s(t.state[t.state_index].name)+"合同")])]),t.detail_mode?n("div",{staticClass:"settlement_list"},[n("ul",{staticClass:"settlement_list_wrapper line line-bottom"},t._l(t.settlement_list,(function(e,a){return n("li",{key:a,staticClass:"settlement line line-bottom",on:{click:function(a){t.reviewSettlement(e)}}},[n("div",{staticClass:"settlement_type"},["阶段结算"===e.settlement_type?n("span",{staticClass:"settlement_phase"},[t._v("阶段结算")]):t._e(),"结算"===e.settlement_type?n("span",{staticClass:"settlement_final"},[t._v("结算")]):t._e(),"结算"!==e.settlement_type&&"阶段结算"!==e.settlement_type?n("span",{staticClass:"settlement_invalid"},[t._v("-")]):t._e()]),n("div",{staticClass:"settlement_detail clearfix"},[n("div",{staticClass:"settlement_detail_row"},[n("div",{staticClass:"name",domProps:{innerHTML:t.xss(t._s(e.name))}}),n("div",{staticClass:"amount"},[t._v(t._s(t._f("parseAmount")(e.sgdwsbj_amount))+"元")])]),n("div",{staticClass:"settlement_detail_row"},[n("div",{staticClass:"start_date"},[t._v(t._s(e.fq_date?e.fq_date.split(" ")[0]:""))]),n("div",{staticClass:"declare"},[t._v("上报金额")])])]),"0"!==e.check_status?n("div",{class:["settlement_status",{green:"3"===e.check_status,orange:"3"!==e.check_status}]},[n("div",{domProps:{innerHTML:t.xss(t._s(e.check_status_desc.split("-")[0]))}}),n("div",{domProps:{innerHTML:t.xss(t._s(e.check_status_desc.split("-")[1]))}})]):t._e(),"0"===e.check_status?n("div",{staticClass:"settlement_status red"},[n("span",{on:{click:function(n){t.deleteDraft(n,e,a)}}},[t._v("\n                  [草稿]\n                  "),n("i",{staticClass:"del-draft icon icon-remove gray"})])]):t._e()])}))),t.detail_mode&&!t.settlement_list.length?n("div",{staticClass:"settlement_empty"},[t._v("当前合同没有结算哦～")]):t._e(),"结算"!==t.selected_contract.xt_js_state?n("div",{staticClass:"settlement_btn_create",on:{click:t.createSettlement}},[n("i",{staticClass:"iconfont icon-plus"})]):t._e()]):t._e()]):t._e()],1)],1)},c=[],o=(a("cc57"),a("6d57"),a("e10e"),a("5ab2"),a("28f8")),s=a("ab3e"),i=a("da71");function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function r(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){Object(o["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var d=function(t){return Object(s["a"])({url:i["a"].get_contract_count_group_by_state,method:"post",data:r({showLoading:!0},t)})},m=function(t){return Object(s["a"])({url:i["a"].get_htjs_list,method:"post",data:r({showLoading:!0},t)})},_=a("e200"),p=a("a075"),f=a("5fe8"),x=f["a"].CONTRACT_SETTLEMENT,h=Object(_["b"])(x),g={name:"ContractSettlement",filters:{parseAmount:function(t){return p["a"].number.format(p["a"].number.round(t))}},data:function(){return{loading:!1,finished:!1,ready:!1,state:[{name:"未结算",count:0,value:"未结算",class:"blue"},{name:"结算中",count:0,value:"结算中",class:"orange"},{name:"已结算",count:0,value:"结算",class:"green"}],contract_list:[],settlement_list:[],detail_mode:!1,selected_contract:"",selected_index:-1,keyword:"",focus:!1,page_size:10,page_index:1,xt_js_state:"结算中",state_index:1,scrollTop:0,record_count:0,timer:null,request:null}},computed:{contract_list_filter:function(){return this.detail_mode?[this.selected_contract]:this.contract_list}},watch:{keyword:function(t){var e=this;this.keyword=t,this.detail_mode=!1,window.clearTimeout(this.timer),this.timer=window.setTimeout((function(){e.contract_list=[],e.page_index=1,e.detail_mode=!1,e.loadAll=!1,e.loading=!1,e.finished=!1,e.getState(),e.loadList()}),100)}},created:function(){var t=this.readCache();if(Object.keys(t).length){var e=t.state_index,a=t.selected_index,n=t.scrollTop,c=t.detail_mode,o=t.xt_js_state,s=t.keyword;this.state_index=e,this.selected_index=a,this.scrollTop=n,this.detail_mode=c,this.xt_js_state=o,this.keyword=s}this.getState()},methods:{refresh:function(){},clickCancel:function(){this.focus=!1,this.keyword=""},getState:function(){var t=this;d({keyword:this.keyword}).then((function(e){var a=e.data,n=t.state.map((function(t){return t.count=a[t.name]||0,t}));t.ready=!0,t.state=n,t.loadAll=!1}))},loadList:function(t,e){var a,n,c=this,o=this.readCache(),s=!!Object.keys(o).length;s&&(a=1,n=o.page_size*o.page_index),this.loading||(this.loading=!0,m({keyword:this.keyword,xt_js_state:this.xt_js_state,page_index:a||this.page_index,page_size:n||this.page_size}).then((function(t){if(c.contract_list=c.contract_list.concat(t.data),t.record_count<10*c.page_index?c.finished=!0:c.page_index++,c.detail_mode){var e=c.selected_index;c.selected_contract=c.contract_list[e],c.settlement_list=c.selected_contract.settlement}s&&(c.page_index=o.page_index,c.deleteCache()),c.record_count=t.record_count,c.settlement_list=c.selected_contract.settlement,c.loading=!1})))},toggleState:function(t,e){this.contract_list=[],this.page_index=1,this.record_count=t.count,this.xt_js_state=t.value,this.state_index=e,this.detail_mode=!1,this.loadAll=!1,this.loading=!1,this.finished=!1,this.loadList()},toggleContract:function(t,e){var a=this;this.detail_mode?(this.detail_mode=!1,this.loading=!1,this.selected_contract={},this.$nextTick((function(){document.querySelector(".contract-settlement-common .van-pull-refresh").scrollTop=a.scrollTop}))):(this.loading=!1,this.detail_mode=!0,this.settlement_list=t.settlement,this.selected_contract=t,this.selected_index=e,this.scrollTop=document.querySelector(".contract-settlement-common .van-pull-refresh").scrollTop)},createSettlement:function(){var t=!0;if(this.settlement_list.forEach((function(e){"3"!==e.check_status&&(t=!1)})),!t)return this.sui.toast("有未结算通过的单据，无法发起新结算");var e=this.selected_contract.contract_id;this.createCache(),this.$router.push({path:"/contract-settlement-common/edit",query:{contract_id:e}})},reviewSettlement:function(t){var e="0"===t.check_status?"/contract-settlement-common/edit":"/contract-settlement-common/detail",a=t.settlement_id;this.createCache(),this.$router.push({path:e,query:{id:a}})},deleteDraft:function(t,e,a){var n=this;t.stopPropagation();var c="确定要把单据放入回收站吗？删除的单据可在90天内通过回收站还原";this.sui.confirm(c,(function(){h.deleteData(e.settlement_id).then((function(t){n.selected_contract.settlement.splice(a,1),n.sui.toast("删除成功"),n.contract_list=[],n.createCache(),n.loadList()}))}))},createCache:function(){var t={state_index:this.state_index,page_size:this.page_index,page_index:this.page_size,selected_index:this.selected_index,scrollTop:this.scrollTop,detail_mode:!0,xt_js_state:this.xt_js_state,keyword:this.keyword};t=JSON.stringify(t),sessionStorage.setItem("contract_settlement",t)},deleteCache:function(){sessionStorage.removeItem("contract_settlement")},readCache:function(){var t=sessionStorage.getItem("contract_settlement")||"{}";return JSON.parse(t)},onBack:function(){this.deleteCache(),window.history.back()}}},u=g,v=(a("8f83"),a("c701")),b=Object(v["a"])(u,n,c,!1,null,"4883d3f4",null);e["default"]=b.exports},"8f83":function(t,e,a){"use strict";a("ec14")},c0c2:function(t,e,a){t.exports=a.p+"img/no-contract-index.8bf68839.png"},ec14:function(t,e,a){var n=a("674f");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var c=a("85cb").default;c("0ba1df18",n,!0,{sourceMap:!1,shadowMode:!1})}}]);