(window["webpackJsonp_module_entry_gcxt_"]=window["webpackJsonp_module_entry_gcxt_"]||[]).push([["chunk-50d30a31"],{1472:function(t,e,n){!function(e,n){t.exports=n()}(0,(function(){"use strict";var t="millisecond",e="second",n="minute",i="hour",r="day",a="week",s="month",o="quarter",u="year",c="date",l=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},f=function(t,e,n){var i=String(t);return!i||i.length>=e?t:""+Array(e+1-i.length).join(n)+t},m={s:f,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),i=Math.floor(n/60),r=n%60;return(e<=0?"+":"-")+f(i,2,"0")+":"+f(r,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var i=12*(n.year()-e.year())+(n.month()-e.month()),r=e.clone().add(i,s),a=n-r<0,o=e.clone().add(i+(a?-1:1),s);return+(-(i+(n-r)/(a?r-o:o-r))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(l){return{M:s,y:u,w:a,d:r,D:c,h:i,m:n,s:e,ms:t,Q:o}[l]||String(l||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},p="en",y={};y[p]=d;var g=function(t){return t instanceof _},b=function(t,e,n){var i;if(!t)return p;if("string"==typeof t)y[t]&&(i=t),e&&(y[t]=e,i=t);else{var r=t.name;y[r]=t,i=r}return!n&&i&&(p=i),i||!n&&p},v=function(t,e){if(g(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new _(n)},M=m;M.l=b,M.i=g,M.w=function(t,e){return v(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var _=function(){function d(t){this.$L=b(t.locale,null,!0),this.parse(t)}var f=d.prototype;return f.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(M.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var i=e.match(l);if(i){var r=i[2]-1||0,a=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,a)):new Date(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,a)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},f.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},f.$utils=function(){return M},f.isValid=function(){return!("Invalid Date"===this.$d.toString())},f.isSame=function(t,e){var n=v(t);return this.startOf(e)<=n&&n<=this.endOf(e)},f.isAfter=function(t,e){return v(t)<this.startOf(e)},f.isBefore=function(t,e){return this.endOf(e)<v(t)},f.$g=function(t,e,n){return M.u(t)?this[e]:this.set(n,t)},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(t,o){var l=this,h=!!M.u(o)||o,d=M.p(t),f=function(t,e){var n=M.w(l.$u?Date.UTC(l.$y,e,t):new Date(l.$y,e,t),l);return h?n:n.endOf(r)},m=function(t,e){return M.w(l.toDate()[t].apply(l.toDate("s"),(h?[0,0,0,0]:[23,59,59,999]).slice(e)),l)},p=this.$W,y=this.$M,g=this.$D,b="set"+(this.$u?"UTC":"");switch(d){case u:return h?f(1,0):f(31,11);case s:return h?f(1,y):f(0,y+1);case a:var v=this.$locale().weekStart||0,_=(p<v?p+7:p)-v;return f(h?g-_:g+(6-_),y);case r:case c:return m(b+"Hours",0);case i:return m(b+"Minutes",1);case n:return m(b+"Seconds",2);case e:return m(b+"Milliseconds",3);default:return this.clone()}},f.endOf=function(t){return this.startOf(t,!1)},f.$set=function(a,o){var l,h=M.p(a),d="set"+(this.$u?"UTC":""),f=(l={},l[r]=d+"Date",l[c]=d+"Date",l[s]=d+"Month",l[u]=d+"FullYear",l[i]=d+"Hours",l[n]=d+"Minutes",l[e]=d+"Seconds",l[t]=d+"Milliseconds",l)[h],m=h===r?this.$D+(o-this.$W):o;if(h===s||h===u){var p=this.clone().set(c,1);p.$d[f](m),p.init(),this.$d=p.set(c,Math.min(this.$D,p.daysInMonth())).$d}else f&&this.$d[f](m);return this.init(),this},f.set=function(t,e){return this.clone().$set(t,e)},f.get=function(t){return this[M.p(t)]()},f.add=function(t,o){var c,l=this;t=Number(t);var h=M.p(o),d=function(e){var n=v(l);return M.w(n.date(n.date()+Math.round(e*t)),l)};if(h===s)return this.set(s,this.$M+t);if(h===u)return this.set(u,this.$y+t);if(h===r)return d(1);if(h===a)return d(7);var f=(c={},c[n]=6e4,c[i]=36e5,c[e]=1e3,c)[h]||1,m=this.$d.getTime()+t*f;return M.w(m,this)},f.subtract=function(t,e){return this.add(-1*t,e)},f.format=function(t){var e=this;if(!this.isValid())return"Invalid Date";var n=t||"YYYY-MM-DDTHH:mm:ssZ",i=M.z(this),r=this.$locale(),a=this.$H,s=this.$m,o=this.$M,u=r.weekdays,c=r.months,l=function(t,i,r,a){return t&&(t[i]||t(e,n))||r[i].substr(0,a)},d=function(t){return M.s(a%12||12,t,"0")},f=r.meridiem||function(t,e,n){var i=t<12?"AM":"PM";return n?i.toLowerCase():i},m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:M.s(o+1,2,"0"),MMM:l(r.monthsShort,o,c,3),MMMM:l(c,o),D:this.$D,DD:M.s(this.$D,2,"0"),d:String(this.$W),dd:l(r.weekdaysMin,this.$W,u,2),ddd:l(r.weekdaysShort,this.$W,u,3),dddd:u[this.$W],H:String(a),HH:M.s(a,2,"0"),h:d(1),hh:d(2),a:f(a,s,!0),A:f(a,s,!1),m:String(s),mm:M.s(s,2,"0"),s:String(this.$s),ss:M.s(this.$s,2,"0"),SSS:M.s(this.$ms,3,"0"),Z:i};return n.replace(h,(function(t,e){return e||m[t]||i.replace(":","")}))},f.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},f.diff=function(t,c,l){var h,d=M.p(c),f=v(t),m=6e4*(f.utcOffset()-this.utcOffset()),p=this-f,y=M.m(this,f);return y=(h={},h[u]=y/12,h[s]=y,h[o]=y/3,h[a]=(p-m)/6048e5,h[r]=(p-m)/864e5,h[i]=p/36e5,h[n]=p/6e4,h[e]=p/1e3,h)[d]||p,l?y:M.a(y)},f.daysInMonth=function(){return this.endOf(s).$D},f.$locale=function(){return y[this.$L]},f.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),i=b(t,e,!0);return i&&(n.$L=i),n},f.clone=function(){return M.w(this.$d,this)},f.toDate=function(){return new Date(this.valueOf())},f.toJSON=function(){return this.isValid()?this.toISOString():null},f.toISOString=function(){return this.$d.toISOString()},f.toString=function(){return this.$d.toUTCString()},d}(),$=_.prototype;return v.prototype=$,[["$ms",t],["$s",e],["$m",n],["$H",i],["$W",r],["$M",s],["$y",u],["$D",c]].forEach((function(t){$[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),v.extend=function(t,e){return t.$i||(t(e,_,v),t.$i=!0),v},v.locale=b,v.isDayjs=g,v.unix=function(t){return v(1e3*t)},v.en=y[p],v.Ls=y,v.p={},v}))},"525e":function(t,e,n){!function(e,n){t.exports=n()}(0,(function(){"use strict";return function(t,e){e.prototype.isSameOrBefore=function(t,e){return this.isSame(t,e)||this.isBefore(t,e)}}}))},a23a:function(t,e,n){"use strict";n("ac67"),n("1bc7"),n("32ea");var i=n("34f5"),r=(n("a450"),n("8dee"),n("e680"),n("a18c")),a=n("3ec3");function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){Object(i["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e["a"]={computed:{sheetId:function(){return this.$route.query.id||""},mode:function(){return this.sheetId?"edit":"add"},config:function(){return this.customBizConfig?this.customBizConfig:a["a"][this.bizType]}},watch:{sheetId:function(){this.init()}},provide:function(){return{bizType:this.bizType,changeType:this.changeType||""}},mounted:function(){var t=this;this.$vBus.$on("page-reinit",(function(e){if(e){var n=e.query,i=e.back_len,a=r["a"].history.current.query,s=r["a"].history.current;if(i&&!isNaN(Number(i)))return void r["a"].go(-Number(i));n&&r["a"].replace({name:s.name,query:o(o({},a),n)})}t.data=null,t.init()})),this.init()},deactivated:function(){this.$vBus.$off("page-reinit")},beforeDestroy:function(){this.$vBus.$off("page-reinit")}}},e016:function(t,e,n){!function(e,n){t.exports=n()}(0,(function(){"use strict";return function(t,e,n){e.prototype.isBetween=function(t,e,i,r){var a=n(t),s=n(e),o="("===(r=r||"()")[0],u=")"===r[1];return(o?this.isAfter(a,i):!this.isBefore(a,i))&&(u?this.isBefore(s,i):!this.isAfter(s,i))||(o?this.isBefore(a,i):!this.isAfter(a,i))&&(u?this.isAfter(s,i):!this.isBefore(s,i))}}}))},fb25:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("business-edit-view",{ref:"BusinessEditView",attrs:{data:t.data,config:t.config,"biz-type":t.bizType,"change-type":t.changeType,mode:t.mode},on:{"form-change":t.onFormChanged,"select-biz-change":t.onSelectBizChange}})},r=[],a=n("a262"),s=n("a23a"),o=(n("ac67"),n("32ea"),n("a450"),n("34f5")),u=(n("1bc7"),n("6a61"),n("ed32")),c=n("7bce"),l=n("ab3e"),h=n("da71");var d=function(t){return Object(l["a"])({url:h["a"].get_jzc_material_types,data:t})},f=function(t){return Object(l["a"])({url:h["a"].get_jzc_material_list_by_type,data:t})},m=function(t){return Object(l["a"])({url:h["a"].get_main_data_jzc_material_list,data:t})},p=n("a783"),y=n("1472"),g=n.n(y),b=n("e016"),v=n.n(b),M=n("525e"),_=n.n(M);function $(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$(Object(n),!0).forEach((function(e){Object(o["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}g.a.extend(v.a),g.a.extend(_.a);var D={data:function(){return{lastMaterialType:"",subFormBkFields:{org:null,new:null},BizStore:p["a"],isMainMaterialMode:!1,skipedFirstManualCheck:!1}},computed:{enableMaterialEvents:function(){var t=this.formDataModel;return!!t.material_type}},watch:{isMainMaterialMode:function(t){console.log("isMainMaterialMode",t),this.BizStore.contracts.length&&(this.MAIN_switchMaterialTypeField(),this.switchSubFormLayout(),c["b"].triggerAllRelations(this.data.formData))}},mounted:function(){window.testJzcApplyEdit=this},methods:{afterInitBGY:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(){var e,n,i,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.enableMaterialEvents){t.next=2;break}return t.abrupt("return");case 2:if(e=this.data,n=e.formData,i=void 0===n?{}:n,r=i.dataModel.material_type,["current_month_trend","next_month_trend"].forEach((function(t){var e=i.dataModel[t];e&&(e.type="select",e.options="",e.data=[{value:"0",text:"--"},{value:"1",text:'<span style="color:#ff6949;line-height:1">上涨 <i class="iconfont icon-shangzhang"/></span>'},{value:"-1",text:'<span style="color:#73c913;line-height:1">下跌 <i class="iconfont icon-xiadie"/></span>'}],i.dataModel[t]=w({},e))})),r){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,d();case 10:a=t.sent,r.data=a.data.map((function(t){return w(w({},t),{},{text:t.material_name,value:t.material_type})})),this.initSubFormBkFields(),c["b"].setVal(r,r.value),this.isMainMaterialMode="main_data"===r.value,this.switchSubFormLayout(!0);case 16:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),checkIsMainMaterialMode:function(){return!(!this.BizStore.contracts[0]||1!==+this.BizStore.contracts[0].is_open_jzc_material_main_data)},onSelectBizChange:function(t){"contract_id"===t.id&&((this.skipedFirstManualCheck||"add"===this.mode)&&(this.isMainMaterialMode=this.checkIsMainMaterialMode()),this.skipedFirstManualCheck=!0)},MAIN_switchMaterialTypeField:function(){var t=this.formDataModel.material_type;this.isMainMaterialMode?(t.show=!1,t.value=t.text="main_data"):(t.show=!0,t.value=t.text="")},getJzcApplyDates:function(){if(this.enableMaterialEvents){var t=this.formDataModel,e=t.material_type,n=t.last_applied_buy_date,i=t.expected_arrival_date,r=t.supply_cycle,a=t.real_applied_buy_date;"common"!==e.value&&e.value&&(i.value||c["b"].setVal(i,window.sysTime),c["b"].setVal(n,g()(i.value).subtract(r.value||0,"day").format("YYYY-MM-DD")),c["b"].setVal(a,this._getRealAppliedBuyDate().format("YYYY-MM-DD")))}},_getRealAppliedBuyDate:function(){var t,e=this.formDataModel,n=e.last_applied_buy_date,i=e.current_month_trend,r=e.next_month_trend,a=g()(n.value),s=g()(window.sysTime),o=s.add(1,"month"),u="";if(a.isSameOrBefore(s))this.log("最晚申购日期处于过去或今天"),u=s,this.log("= 取今天\n================END================");else if(this.log("最晚申购日期处于未来"),t=a.isSame(s,"month")?i:a.isSame(o,"month")?r:{value:""},this.log("> 所在区间",t.label),this.log("> 所在区间趋势",{"-1":"下跌",1:"上涨"}[t.value]||"未知"),"1"===t.value)if(a.date()<16){var c=a.subtract(1,"month").endOf("month");u=c.isBefore(s)?a:c,this.log("> > 介于1~15"),this.log("> > > “上”个月最后一天是否属于过去",c.isBefore(s)),this.log(c.isBefore(s)?"= 取最晚申购日期":"取“上”个月最后一天\n================END================")}else u=a,this.log("> > 介于16~31"),this.log("= 取最晚申购日期\n================END================");else t.value,u=a,this.log("= 取最晚申购日期\n================END================");return u},onFormChanged:function(t,e,n){"expected_arrival_date"!==e.id&&"material_type"!==e.id||(this.getJzcApplyDates(),this.switchSubFormLayout())},initSubFormBkFields:function(){var t=this,e=this.data.subFormsSetting,n=void 0===e?{}:e,i=n.sub_form_jzc_clapply;if(i&&i.isEnable){var r=i.defaultForm.dataModel;this.subFormBkFields.org||(this.subFormBkFields.org={},["name","spec","unit","technological_requirement","material_id"].forEach((function(e){t.subFormBkFields.org[e]=w(w({},r[e]),{},{value:"",text:""})}))),this.subFormBkFields.new||(this.subFormBkFields.new={name:w(w({},r.name),{},{type:"selectBiz",value:"",text:"",placeholder:"必选",searchPlaceholder:"支持按空格隔离搜索多个关键词",data:[],keyMap:{id:"material_id",label:"subtext",name:"text",value:"name"},pagingFun:function(t){var e=this.formDataModel.material_type;return this.isMainMaterialMode?m(w(w({},t),{},{name_keyword:t.keyword})).then((function(t){var e=t.data,n=void 0===e?[]:e;return t.list=n.map((function(t){return w(w({},t),{},{text:t.name,value:t.name})})),t})):f(w(w({},t),{},{material_type:e.value})).then((function(t){var e=t.data,n=void 0===e?[]:e;return t.list=n.map((function(t){return w(w({},t),{},{text:t.name,value:t.name})})),t}))}})},this.subFormBkFields.new.name.pagingFun=this.subFormBkFields.new.name.pagingFun.bind(this),["spec","unit","technological_requirement","material_id"].forEach((function(e){t.subFormBkFields.new[e]=w(w({},r[e]),{},{enabled:0,relative_id:"name",value:"",text:"",req:0,placeholder:""})})))}},switchSubFormLayout:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.enableMaterialEvents)try{var e=this.formDataModel.material_type,n=e.value;if(this.lastMaterialType&&n===this.lastMaterialType)return;var i=this.data,r=i.subFormsSetting,a=void 0===r?{}:r,s=i.subFormsValues,o=void 0===s?{}:s,u=a.sub_form_jzc_clapply;if(u&&u.isEnable){var c=u.defaultForm.dataModel;"common"!==n&&n||this.isMainMaterialMode?u.defaultForm.dataModel=w(w({},c),this.subFormBkFields.new):u.defaultForm.dataModel=w(w({},c),this.subFormBkFields.org),c=u.defaultForm.dataModel;var l=c.brand,h=c.name;if(this.isMainMaterialMode?(l.show=!0,l.isSave=1,h.searchPlaceholder="搜索"):(l.show=!1,l.isSave=0,l.text=l.value="",h.searchPlaceholder="支持按空格隔离搜索多个关键词"),this.$refs.BusinessEditView.getFormatRefs().sub_form_jzc_clapply){var d=this.$refs.BusinessEditView.getFormatRefs().sub_form_jzc_clapply;t||(o.sub_form_jzc_clapply=[]),this.$nextTick((function(){d.reInit()}))}}this.lastMaterialType=n}catch(f){this.log("error",f)}},log:function(){}}},O=n("225c"),S=n("db68"),F={name:"JzcClapplyEdit",components:{BusinessEditView:a["a"]},mixins:[s["a"],D],data:function(){return{bizType:S["b"].store.getValueByKey("biz_type"),changeType:S["b"].store.getValueByKey("change_type")||"",data:null}},computed:{formDataModel:function(){return this.data&&this.data.formData?this.data.formData.dataModel:{}}},methods:{init:function(){var t=this;O["a"].init({bizType:this.bizType,changeType:this.changeType,sheetId:this.sheetId,params:JSON.parse(this.$route.query.params||"null"),config:this.config}).then((function(e){return t.data=e,e})).then((function(){t.afterInitBGY()})).catch((function(t){console.error(t)}))}}},B=F,j=n("5d22"),k=Object(j["a"])(B,i,r,!1,null,null,null);e["default"]=k.exports}}]);