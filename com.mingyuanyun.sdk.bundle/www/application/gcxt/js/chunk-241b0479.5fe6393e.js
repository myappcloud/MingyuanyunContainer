(window["webpackJsonp_module_entry_gcxt_"]=window["webpackJsonp_module_entry_gcxt_"]||[]).push([["chunk-241b0479"],{"2da2":function(e,t,a){"use strict";a("ac67"),a("1bc7"),a("32ea");var n=a("34f5"),r=a("225c");function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t["a"]=o({},r["a"])},"7ae6":function(e,t,a){"use strict";a("ac67"),a("1bc7"),a("32ea");var n=a("34f5"),r=(a("e5b4"),a("a262")),i=a("fd50");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var s,u,d={extends:r["a"],data:function(){var e=this;return{formHooks:{afterRelative:function(t,a,n){if("project_id"===n.id){var r=t.find((function(e){return"fq_company"===e.id}));if(r)return r.getBizData().then((function(){var t=r.data,a=e.data.formData.dataModel.fq_company;1===t.length&&(a.value=t[0].value,a.text=t[0].text,a.valueObj=[c({value:a.value},t[0].__orgOption)])})).catch((function(e){console.error(e)}))}return i["a"].resolve()}}}},provide:function(){return{formHooks:this.formHooks}}},l=d,h=a("5d22"),f=Object(h["a"])(l,s,u,!1,null,null,null);t["a"]=f.exports},cb6f:function(e,t,a){"use strict";a("6a61");var n=a("ed32"),r=a("7ae6"),i=a("2da2"),o=a("db68"),c=a("3ec3"),s=a("040f"),u=a("82f8"),d=a("a783");t["a"]={components:{BusinessEditView:r["a"]},data:function(){return{bizType:o["b"].store.getValueByKey("biz_type"),changeType:o["b"].store.getValueByKey("change_type")||"",data:null,hooks:{afterLayoutRequest:function(e){var t=e.dataModel;"project_id"in t&&(t.project_id.pagingFun=s["a"].pagingFunUserProjects)}}}},computed:{sheetId:function(){return this.$route.query.id},mode:function(){return this.sheetId?"edit":"add"},config:function(){return c["a"][this.bizType]}},watch:{sheetId:function(){this.init()}},mounted:function(){this.init()},methods:{init:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,a,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getDefaultProjectInfo();case 2:t=e.sent,a=t?Object.assign({project_id:t.project_id},JSON.parse(this.$route.query.params||"null")):JSON.parse(this.$route.query.params||"null"),i["a"].init({bizType:this.bizType,changeType:this.changeType,sheetId:this.sheetId,params:a,config:this.config,hooks:this.hooks}).then((function(e){var t=e;return n.hooks.afterInit?n.hooks.afterInit(t):t})).then((function(e){console.log(e),n.data=e})).catch((function(e){console.error(e)}));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getDefaultProjectInfo:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.config.isTCMode||"add"!==this.mode||!window.__YL__){e.next=17;break}return e.next=3,window.__YL__.dataShare.getProjectInfo();case 3:if(t=e.sent,t){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,e.next=9,Object(u["W"])({erp_project_id:[t.id]});case 9:if(a=e.sent,!(a.data.length>0)){e.next=13;break}return d["a"].project=a.data,e.abrupt("return",a.data[0]);case 13:e.next=17;break;case 15:e.prev=15,e.t0=e["catch"](6);case 17:case"end":return e.stop()}}),e,this,[[6,15]])})));function t(){return e.apply(this,arguments)}return t}()}}},fa26:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("business-edit-view",{attrs:{data:e.data,config:e.config,"biz-type":e.bizType,"change-type":e.changeType,mode:e.mode,comps:e.comps},on:{"select-biz-change":e.onSelectBizChange,"form-change":e.onFormChange}},[a("qa-tables",{attrs:{slot:"QaTables","tables-data":e.qaTabels.result,"tables-layout":e.qaTabels.layout},slot:"QaTables"})],1)},r=[],i=a("c376"),o=(a("1bc7"),a("a7e5"),a("cb6f")),c=a("7411"),s=a("a740"),u=a("a075"),d=a("da71"),l=a("ab3e"),h={projectId:"project_id",wea:"custom_1",win_speed:"custom_2",tem:"custom_3",sender:"custom_4",date:"custom_6",title:"biz_title",isEdit:"custom_7"},f={name:"TcProjectDailyEdit",components:{QaTables:c["a"]},mixins:[o["a"]],data:function(){return{comps:["ViewTemplate","FormComp","QaTables","SubForms","UploadImages","Attachment","UserSelector"],qaTabels:{result:{process:[],material:[],measure:[],check:[]},layout:[{key:"config",name:"配置项",value:{colors:[{key:"待申请进场",color:"#FF3C46"},{key:"待验收",color:"#FF3C46"},{key:"待退场",color:"#FF3C46"},{key:"复验合格",color:"#63B20D"},{key:"已退场",color:"#888888"},{key:"待申请进场",color:"#FF3C46"}]}},{key:"process",name:"工序移交",groupingKey:"building_name",value:[{key:"building_name",name:"楼栋",width:200},{key:"place",name:"部位",width:180},{key:"item_name",name:"检查项",width:472}]},{key:"material",name:"材料验收",groupingKey:"bidsection_name",value:[{key:"bidsection_name",name:"标段",rows:2,width:120},{key:"material",name:"材料名称",rows:2,width:200},{key:"material_type",name:"材料类型",rows:2,width:130},{key:"specification",name:"材料规格",rows:2,width:130},{key:"quantity",name:"数量",rows:2,width:100},{key:"quantity_unit",name:"单位",rows:2,width:60},{key:"status",name:"状态",rows:2,width:112}]},{key:"measure",name:"实测实量",groupingKey:"building_name",value:[{key:"building_name",name:"楼栋",rows:2,width:150},{key:"parent_item_name",name:"检查项",rows:2,width:222},{key:"place_num",name:"部位数",rows:2,width:160},{key:"item_num",name:"检查项数",rows:2,width:160},{key:"measurement_points",name:"实测点数",rows:2,width:160}]},{key:"check",name:"现场检查",groupingKey:"batch_name",value:[{key:"batch_name",name:"批次",rows:2,width:150},{key:"place",name:"部位",rows:2,width:130},{key:"item_name",name:"检查项",rows:2,width:150},{key:"desc_name",name:"问题描述",rows:2,width:230},{key:"remark",name:"补充说明",rows:2,width:192}]}]}}},computed:{isDisableQa:function(){return"zhbj"===Object(s["a"])("tenant_code")}},created:function(){var e=this;if(this.isDisableQa){var t=this.comps.findIndex((function(e){return"QaTables"===e}));this.comps.splice(t,1)}this.hooks.afterInit=function(t){var a=Object(s["a"])("xt_user_name"),n=t.formData.dataModel[h.sender];return n&&(n.value=n.text=a),[h.wea,h.win_speed,h.tem].forEach((function(a){var n=t.formData.dataModel[a];n&&e.$set(n,"editBefore",(function(){return!!t.formData.dataModel.project_id.value||(e.sui.toast("清先选择项目"),!1)}))})),t}},methods:{onSelectBizChange:function(e){var t=e.id;"project_id"===t&&(this.handlerBizTitle(),this.fetchWeather(),this.fetchQualityReport())},onFormChange:function(e,t){var a=t.id;a===h.date?(this.handlerBizTitle(),this.fetchWeather(),this.fetchQualityReport()):a===h.title&&(this.data.formData.dataModel[h.isEdit].value="1")},handlerBizTitle:function(){var e=this.data.formData.dataModel,t="";if(!e[h.isEdit]||"1"!==e[h.isEdit].value){var a=e.biz_title,n=e.project_id,r=e[h.date];a&&n&&n.text&&(t+=n.text,r&&r.value&&(t+="-".concat(u["a"].date.format(r.value,"yyyy-MM-dd")),a.value=a.text=t))}},fetchWeather:function(){var e=this.data.formData.dataModel,t=e.project_id,a=e[h.date];if(t.value&&a.value)return Object(l["a"])({url:d["a"].get_weather,data:{project_id:t.value,date:a.value}}).then((function(t){var a=t.data,n=e[h.tem],r=e[h.wea],o=e[h.win_speed];[["tem",n],["wea",r],["win_speed",o]].forEach((function(e){var t=Object(i["a"])(e,2),n=t[0],r=t[1];a.hasOwnProperty(n)&&r&&(r.value=r.text=a[n])}))}))},fetchQualityReport:function(){var e=this;if(!this.isDisableQa){var t=this.data.formData.dataModel,a=t.project_id,n=t[h.date];if(a.value&&n.value)return Object(l["a"])({url:d["a"].get_zj_data,data:{erp_project_id:a.valueObj[0].erp_project_id||a.value,date:n.value}}).then((function(t){var a=t.data;a.layout&&a.result&&(e.qaTabels=a)})).catch((function(){}))}}}},p=f,m=a("5d22"),y=Object(m["a"])(p,n,r,!1,null,null,null);t["default"]=y.exports}}]);