(window["webpackJsonp_module_entry_gcxt_"]=window["webpackJsonp_module_entry_gcxt_"]||[]).push([["chunk-191d21c4"],{"056f":function(t,e,n){!function(e,n){t.exports=n()}(0,(function(){"use strict";return function(t,e,n){e.prototype.isBetween=function(t,e,i,r){var a=n(t),s=n(e),o="("===(r=r||"()")[0],u=")"===r[1];return(o?this.isAfter(a,i):!this.isBefore(a,i))&&(u?this.isBefore(s,i):!this.isAfter(s,i))||(o?this.isBefore(a,i):!this.isAfter(a,i))&&(u?this.isAfter(s,i):!this.isBefore(s,i))}}}))},"0a26":function(t,e,n){!function(e,n){t.exports=n()}(0,(function(){"use strict";return function(t,e){e.prototype.isSameOrBefore=function(t,e){return this.isSame(t,e)||this.isBefore(t,e)}}}))},"6cfa":function(t,e,n){!function(e,n){t.exports=n()}(0,(function(){"use strict";var t="millisecond",e="second",n="minute",i="hour",r="day",a="week",s="month",o="quarter",u="year",c="date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d+)?$/,l=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,h={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},d=function(t,e,n){var i=String(t);return!i||i.length>=e?t:""+Array(e+1-i.length).join(n)+t},p={s:d,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),i=Math.floor(n/60),r=n%60;return(e<=0?"+":"-")+d(i,2,"0")+":"+d(r,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var i=12*(n.year()-e.year())+(n.month()-e.month()),r=e.clone().add(i,s),a=n-r<0,o=e.clone().add(i+(a?-1:1),s);return+(-(i+(n-r)/(a?r-o:o-r))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(f){return{M:s,y:u,w:a,d:r,D:c,h:i,m:n,s:e,ms:t,Q:o}[f]||String(f||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},m="en",y={};y[m]=h;var g=function(t){return t instanceof $},v=function(t,e,n){var i;if(!t)return m;if("string"==typeof t)y[t]&&(i=t),e&&(y[t]=e,i=t);else{var r=t.name;y[r]=t,i=r}return!n&&i&&(m=i),i||!n&&m},b=function(t,e){if(g(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new $(n)},_=p;_.l=v,_.i=g,_.w=function(t,e){return b(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var $=function(){function h(t){this.$L=v(t.locale,null,!0),this.parse(t)}var d=h.prototype;return d.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(_.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var i=e.match(f);if(i){var r=i[2]-1||0,a=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,a)):new Date(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,a)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},d.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},d.$utils=function(){return _},d.isValid=function(){return!("Invalid Date"===this.$d.toString())},d.isSame=function(t,e){var n=b(t);return this.startOf(e)<=n&&n<=this.endOf(e)},d.isAfter=function(t,e){return b(t)<this.startOf(e)},d.isBefore=function(t,e){return this.endOf(e)<b(t)},d.$g=function(t,e,n){return _.u(t)?this[e]:this.set(n,t)},d.unix=function(){return Math.floor(this.valueOf()/1e3)},d.valueOf=function(){return this.$d.getTime()},d.startOf=function(t,o){var f=this,l=!!_.u(o)||o,h=_.p(t),d=function(t,e){var n=_.w(f.$u?Date.UTC(f.$y,e,t):new Date(f.$y,e,t),f);return l?n:n.endOf(r)},p=function(t,e){return _.w(f.toDate()[t].apply(f.toDate("s"),(l?[0,0,0,0]:[23,59,59,999]).slice(e)),f)},m=this.$W,y=this.$M,g=this.$D,v="set"+(this.$u?"UTC":"");switch(h){case u:return l?d(1,0):d(31,11);case s:return l?d(1,y):d(0,y+1);case a:var b=this.$locale().weekStart||0,$=(m<b?m+7:m)-b;return d(l?g-$:g+(6-$),y);case r:case c:return p(v+"Hours",0);case i:return p(v+"Minutes",1);case n:return p(v+"Seconds",2);case e:return p(v+"Milliseconds",3);default:return this.clone()}},d.endOf=function(t){return this.startOf(t,!1)},d.$set=function(a,o){var f,l=_.p(a),h="set"+(this.$u?"UTC":""),d=(f={},f[r]=h+"Date",f[c]=h+"Date",f[s]=h+"Month",f[u]=h+"FullYear",f[i]=h+"Hours",f[n]=h+"Minutes",f[e]=h+"Seconds",f[t]=h+"Milliseconds",f)[l],p=l===r?this.$D+(o-this.$W):o;if(l===s||l===u){var m=this.clone().set(c,1);m.$d[d](p),m.init(),this.$d=m.set(c,Math.min(this.$D,m.daysInMonth())).$d}else d&&this.$d[d](p);return this.init(),this},d.set=function(t,e){return this.clone().$set(t,e)},d.get=function(t){return this[_.p(t)]()},d.add=function(t,o){var c,f=this;t=Number(t);var l=_.p(o),h=function(e){var n=b(f);return _.w(n.date(n.date()+Math.round(e*t)),f)};if(l===s)return this.set(s,this.$M+t);if(l===u)return this.set(u,this.$y+t);if(l===r)return h(1);if(l===a)return h(7);var d=(c={},c[n]=6e4,c[i]=36e5,c[e]=1e3,c)[l]||1,p=this.$d.getTime()+t*d;return _.w(p,this)},d.subtract=function(t,e){return this.add(-1*t,e)},d.format=function(t){var e=this;if(!this.isValid())return"Invalid Date";var n=t||"YYYY-MM-DDTHH:mm:ssZ",i=_.z(this),r=this.$locale(),a=this.$H,s=this.$m,o=this.$M,u=r.weekdays,c=r.months,f=function(t,i,r,a){return t&&(t[i]||t(e,n))||r[i].substr(0,a)},h=function(t){return _.s(a%12||12,t,"0")},d=r.meridiem||function(t,e,n){var i=t<12?"AM":"PM";return n?i.toLowerCase():i},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:_.s(o+1,2,"0"),MMM:f(r.monthsShort,o,c,3),MMMM:f(c,o),D:this.$D,DD:_.s(this.$D,2,"0"),d:String(this.$W),dd:f(r.weekdaysMin,this.$W,u,2),ddd:f(r.weekdaysShort,this.$W,u,3),dddd:u[this.$W],H:String(a),HH:_.s(a,2,"0"),h:h(1),hh:h(2),a:d(a,s,!0),A:d(a,s,!1),m:String(s),mm:_.s(s,2,"0"),s:String(this.$s),ss:_.s(this.$s,2,"0"),SSS:_.s(this.$ms,3,"0"),Z:i};return n.replace(l,(function(t,e){return e||p[t]||i.replace(":","")}))},d.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},d.diff=function(t,c,f){var l,h=_.p(c),d=b(t),p=6e4*(d.utcOffset()-this.utcOffset()),m=this-d,y=_.m(this,d);return y=(l={},l[u]=y/12,l[s]=y,l[o]=y/3,l[a]=(m-p)/6048e5,l[r]=(m-p)/864e5,l[i]=m/36e5,l[n]=m/6e4,l[e]=m/1e3,l)[h]||m,f?y:_.a(y)},d.daysInMonth=function(){return this.endOf(s).$D},d.$locale=function(){return y[this.$L]},d.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),i=v(t,e,!0);return i&&(n.$L=i),n},d.clone=function(){return _.w(this.$d,this)},d.toDate=function(){return new Date(this.valueOf())},d.toJSON=function(){return this.isValid()?this.toISOString():null},d.toISOString=function(){return this.$d.toISOString()},d.toString=function(){return this.$d.toUTCString()},h}(),D=$.prototype;return b.prototype=D,[["$ms",t],["$s",e],["$m",n],["$H",i],["$W",r],["$M",s],["$y",u],["$D",c]].forEach((function(t){D[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),b.extend=function(t,e){return t(e,$,b),b},b.locale=v,b.isDayjs=g,b.unix=function(t){return b(1e3*t)},b.en=y[m],b.Ls=y,b.p={},b}))},a23a:function(t,e,n){"use strict";n("5ab2"),n("6d57"),n("e10e");var i=n("28f8"),r=(n("cc57"),n("f548"),n("163d"),n("a18c")),a=n("3ec3");function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){Object(i["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e["a"]={computed:{sheetId:function(){return this.$route.query.id||""},mode:function(){return this.sheetId?"edit":"add"},config:function(){return this.customBizConfig?this.customBizConfig:a["a"][this.bizType]}},watch:{sheetId:function(){this.init()}},provide:function(){return{bizType:this.bizType,changeType:this.changeType||""}},mounted:function(){var t=this;this.$vBus.$on("page-reinit",(function(e){if(e){var n=e.query,i=e.back_len,a=r["a"].history.current.query,s=r["a"].history.current;if(i&&!isNaN(Number(i)))return void r["a"].go(-Number(i));n&&r["a"].replace({name:s.name,query:o(o({},a),n)})}t.data=null,t.init()})),this.init()},deactivated:function(){this.$vBus.$off("page-reinit")},beforeDestroy:function(){this.$vBus.$off("page-reinit")}}},fb25:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("business-edit-view",{ref:"BusinessEditView",attrs:{data:t.data,config:t.config,"biz-type":t.bizType,"change-type":t.changeType,mode:t.mode},on:{"form-change":t.onFormChanged}})},r=[],a=n("a262"),s=n("a23a"),o=(n("5ab2"),n("e10e"),n("cc57"),n("28f8")),u=(n("6d57"),n("7bce")),c=n("ab3e"),f=n("da71");var l=function(t){return Object(c["a"])({url:f["a"].get_jzc_material_types,data:t})},h=function(t){return Object(c["a"])({url:f["a"].get_jzc_material_list_by_type,data:t})},d=n("6cfa"),p=n.n(d),m=n("056f"),y=n.n(m),g=n("0a26"),v=n.n(g);function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){Object(o["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}p.a.extend(y.a),p.a.extend(v.a),window.dayjs=p.a;var $={data:function(){return{lastMaterialType:"",subFormBkFields:{org:null,new:null}}},computed:{enableMaterialEvents:function(){var t=this.formDataModel;return!!t.material_type}},methods:{afterInitBGY:function(){var t=this,e=this.data;if(this.enableMaterialEvents){var n=e.formData,i=void 0===n?{}:n;["current_month_trend","next_month_trend"].forEach((function(t){var e=i.dataModel[t];e&&(e.type="select",e.options="",e.data=[{value:"0",text:"--"},{value:"1",text:'<span style="color:#ff6949;line-height:1">上涨 <i class="iconfont icon-shangzhang"/></span>'},{value:"-1",text:'<span style="color:#73c913;line-height:1">下跌 <i class="iconfont icon-xiadie"/></span>'}],i.dataModel[t]=_({},e))}));var r=i.dataModel.material_type;if(r)return l().then((function(e){var n=e.data;r.data=n.map((function(t){return _(_({},t),{},{text:t.material_name,value:t.material_type})})),u["b"].setVal(r,r.value),t.getJzcApplyDates(!0),t.swtichSubFormLayout(!0)}))}},getJzcApplyDates:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.enableMaterialEvents&&!t){var e=this.formDataModel,n=e.material_type,i=e.last_applied_buy_date,r=e.expected_arrival_date,a=e.supply_cycle,s=e.real_applied_buy_date;"common"!==n.value&&n.value&&(r.value||u["b"].setVal(r,window.sysTime),u["b"].setVal(i,p()(r.value).subtract(a.value||0,"day").format("YYYY-MM-DD")),u["b"].setVal(s,this._getRealAppliedBuyDate().format("YYYY-MM-DD")))}},_getRealAppliedBuyDate:function(){var t,e=this.formDataModel,n=e.last_applied_buy_date,i=e.current_month_trend,r=e.next_month_trend,a=p()(n.value),s=p()(window.sysTime),o=s.add(1,"month"),u="";if(a.isSameOrBefore(s))this.log("最晚申购日期处于过去或今天"),u=s,this.log("= 取今天\n================END================");else if(this.log("最晚申购日期处于未来"),t=a.isSame(s,"month")?i:a.isSame(o,"month")?r:{value:""},this.log("> 所在区间",t.label),this.log("> 所在区间趋势",{"-1":"下跌",1:"上涨"}[t.value]||"未知"),"1"===t.value)if(a.date()<16){var c=a.subtract(1,"month").endOf("month");u=c.isBefore(s)?a:c,this.log("> > 介于1~15"),this.log("> > > “上”个月最后一天是否属于过去",c.isBefore(s)),this.log(c.isBefore(s)?"= 取最晚申购日期":"取“上”个月最后一天\n================END================")}else u=a,this.log("> > 介于16~31"),this.log("= 取最晚申购日期\n================END================");else t.value,u=a,this.log("= 取最晚申购日期\n================END================");return u},onFormChanged:function(t,e,n){"expected_arrival_date"!==e.id&&"material_type"!==e.id||(this.getJzcApplyDates(),this.swtichSubFormLayout())},_getSubFormBkFields:function(t){var e=this;this.subFormBkFields.org||(this.subFormBkFields.org={},["name","spec","unit","technological_requirement","material_id"].forEach((function(n){e.subFormBkFields.org[n]=_(_({},t[n]),{},{value:"",text:""})})));var n=this.formDataModel.material_type;this.subFormBkFields.new||(this.subFormBkFields.new={name:_(_({},t.name),{},{type:"selectBiz",value:"",text:"",placeholder:"必选",searchPlaceholder:"支持按空格隔离搜索多个关键词",data:[],pagingFun:function(t){return h(_(_({},t),{},{material_type:n.value})).then((function(t){var e=t.data,n=void 0===e?[]:e;return t.list=n.map((function(t){return _(_({},t),{},{text:t.name,value:t.name})})),t}))}})},["spec","unit","technological_requirement","material_id"].forEach((function(n){e.subFormBkFields.new[n]=_(_({},t[n]),{},{enabled:0,relative_id:"name",value:"",text:"",placeholder:""})})))},swtichSubFormLayout:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.enableMaterialEvents)try{var e=this.formDataModel.material_type,n=e.value;if(n===this.lastMaterialType)return;var i=this.data,r=i.subFormsSetting,a=void 0===r?{}:r,s=i.subFormsValues,o=void 0===s?{}:s,u=a.sub_form_jzc_clapply;if(u&&u.isEnable){var c=u.defaultForm.dataModel;if(this._getSubFormBkFields(c),u.defaultForm.dataModel=_(_({},c),"common"!==n&&n?this.subFormBkFields.new:this.subFormBkFields.org),this.$refs.BusinessEditView.getFormatRefs().sub_form_jzc_clapply){var f=this.$refs.BusinessEditView.getFormatRefs().sub_form_jzc_clapply;t||(o.sub_form_jzc_clapply=[]),this.$nextTick((function(){f.reInit()}))}}this.lastMaterialType=n}catch(l){this.log("error",l)}},log:function(){}}},D=n("225c"),M=n("db68"),O={name:"JzcClapplyEdit",components:{BusinessEditView:a["a"]},mixins:[s["a"],$],data:function(){return{bizType:M["b"].store.getValueByKey("biz_type"),changeType:M["b"].store.getValueByKey("change_type")||"",data:null}},computed:{formDataModel:function(){return this.data&&this.data.formData?this.data.formData.dataModel:{}}},methods:{init:function(){var t=this;D["a"].init({bizType:this.bizType,changeType:this.changeType,sheetId:this.sheetId,params:JSON.parse(this.$route.query.params||"null"),config:this.config}).then((function(e){return t.data=e,e})).then((function(){t.afterInitBGY()})).catch((function(t){console.error(t)}))}}},w=O,S=n("c701"),B=Object(S["a"])(w,i,r,!1,null,null,null);e["default"]=B.exports}}]);