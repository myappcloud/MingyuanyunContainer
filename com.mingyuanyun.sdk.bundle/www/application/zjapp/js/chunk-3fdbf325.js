(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-3fdbf325","chunk-739f37c8"],{4276:function(e,t,o){"use strict";o.r(t);o("5ab2"),o("e10e"),o("6d57");var a=o("28f8"),l=(o("cc57"),o("07d2")),n=o("774b"),i=o("409e"),s=o("f7ab"),r=o("3e47"),c=o("e2a7"),h=o("0f1f"),u=o("ef39"),p=o("ed08"),d=o("04f3");function f(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function g(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?f(Object(o),!0).forEach((function(t){Object(a.a)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):f(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var b={name:"TemplateManage",components:{Item:l.default,Scroller:n.default,ProgressRound:i.a,SynchronizeTipBar:s.a,AppSearchBar:h.a,TemplateItem:u.a},data:function(){return{isSecondary:!1,localTemplateList:[],keyword:"",searchKeyword:"",mass:!1,checkAll:!1,pageTitle:"离线文档",searchBack:null}},computed:{filterList:function(){var e=this;return this.searchKeyword?this.localTemplateList.filter((function(t){return t.name.indexOf(e.searchKeyword)>-1})):this.localTemplateList},hasList:function(){return!!this.filterList.length},isIOSBezelLess:function(){return this.$store.state.app.isIOSBezelLess}},activated:function(){console.log("this.$router.isBack",this.$router.isBack),this.$router.isBack||(this.init(),this.getList())},methods:{init:function(){this.keyword="",this.searchKeyword="",this.pageTitle="离线文档",this.checkAll=!1,this.mass=!1,this.$refs["app-search-bar"]&&(this.$refs["app-search-bar"].isSeaching=!1)},getList:function(){var e=this;r.a._getLocalTemplateList().then((function(t){e.localTemplateList=t.reverse().map((function(e){return g(g({},e),{},{file_type:p.a.formatFiletypes(e.url||e.name),isLocal:!0,checked:!1})}))}))},onRefresh:function(){this.handleCancelSelectMulti(),this.getList()},keywordChange:function(e){this.keyword=e,this.keyword||(this.searchKeyword=""),this.calcIsSelectAll()},onSearch:function(e){this.searchKeyword=e,this.calcIsSelectAll()},onSelectMulti:function(){var e=this;this.mass=!0,this.pageTitle="已选择0个文件",this.searchBack=Object(d.a)((function(){e.handleCancelSelectMulti()}))},handleSelectNone:function(){this.localTemplateList.forEach((function(e){return e.checked=!1,e})),this.calcIsSelectAll()},handleSelectAll:function(){this.localTemplateList.forEach((function(e){return e.checked=!0,e})),this.calcIsSelectAll()},handleCancelSelectMulti:function(){this.handleSelectNone(),this.mass=!1,this.pageTitle="离线文档",Object(d.e)()},handleRemoveSelected:function(){var e=this,t=[];this.filterList.forEach((function(e){e.checked&&t.push(e.id)})),t.length?c.a.confirm("是否确定删除文件？").then((function(e){return e?r.a.removeTemplate(t):Promise.reject()})).then((function(){e.handleCancelSelectMulti(),e.onRefresh()})):c.a.alert("请先选择文件")},calcIsSelectAll:function(){var e=this;if(this.mass&&this.hasList){var t=0,o=!0;this.filterList.forEach((function(e){e.checked&&t++,e.checked||(o=!1)})),this.checkAll=o,this.pageTitle="已选择".concat(t,"个文件"),this.searchBack&&Object(d.c)(this.searchBack),this.searchBack=Object(d.a)((function(){e.handleCancelSelectMulti()}))}else Object(d.e)(),this.pageTitle="离线文档"}}},m=(o("8db6"),o("17cc")),w=Object(m.a)(b,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("page-content",{attrs:{title:e.pageTitle,"show-go-root":!e.mass||!e.hasList,"show-go-back":!e.mass||!e.hasList}},[e.mass&&e.hasList?o("div",{staticClass:"header-btn",attrs:{slot:"header-bar-left"},on:{click:e.handleCancelSelectMulti},slot:"header-bar-left"},[e._v("\n    取消\n  ")]):e._e(),!e.mass&&e.hasList?o("div",{staticClass:"header-btn",attrs:{slot:"header-bar-right"},on:{click:e.onSelectMulti},slot:"header-bar-right"},[e._v("\n    批量删除\n  ")]):e.mass&&e.hasList&&e.checkAll?o("div",{staticClass:"header-btn",attrs:{slot:"header-bar-right"},on:{click:e.handleSelectNone},slot:"header-bar-right"},[e._v("\n    全不选\n  ")]):e.mass&&e.hasList&&!e.checkAll?o("div",{staticClass:"header-btn",attrs:{slot:"header-bar-right"},on:{click:e.handleSelectAll},slot:"header-bar-right"},[e._v("\n    全选\n  ")]):e._e(),o("synchronize-tip-bar"),o("app-search-bar",{ref:"app-search-bar",attrs:{placeholder:"搜索",value:e.keyword},on:{keywordChange:e.keywordChange,search:e.onSearch}}),o("div",{staticClass:"border-block"}),o("scroller",{attrs:{"has-pull-down":!e.mass,"is-empty":!e.hasList},on:{pullDown:e.onRefresh}},[o("div",{staticClass:"local-content"},e._l(e.filterList,(function(t,a){return o("template-item",{key:a,attrs:{"data-source":t,keyword:e.searchKeyword,"show-trash":!0,"is-mass":e.mass,checked:t.checked},on:{refresh:e.onRefresh,calcIsSelectAll:e.calcIsSelectAll}})}))),o("loading-status",{attrs:{"is-loading":!1,"is-empty":!e.hasList,"empty-text":"暂无可查看文档"}})],1),e.mass&&e.hasList?o("div",{staticClass:"bottom",class:{"ios-bezel-less":e.isIOSBezelLess},on:{click:e.handleRemoveSelected}},[e._v("\n    删除\n  ")]):e._e()],1)}),[],!1,null,"07e544c6",null);t.default=w.exports},6163:function(e,t,o){(e.exports=o("690e")(!1)).push([e.i,".zjapp .border-block[data-v-07e544c6]{height:1px;border:none;background-image:linear-gradient(0deg,#dcdcdc,#dcdcdc 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}.zjapp .downed-icon img[data-v-07e544c6]{padding:10px 15px;box-sizing:content-box;width:22px}.zjapp .local-content[data-v-07e544c6]{overflow:hidden}.zjapp .local-content[data-v-07e544c6] .template-item-wrapper .item{padding:10px 13px}.zjapp .bottom[data-v-07e544c6]{height:46px;line-height:46px;font-size:16px;color:#ff3b30;text-align:center;position:absolute;bottom:0;width:100%;background-color:#fff;border:none;background-image:linear-gradient(180deg,#ececec,#ececec 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:top}.zjapp .bottom.ios-bezel-less[data-v-07e544c6]{height:84px;line-height:64px}",""])},"774b":function(e,t,o){"use strict";o.r(t);var a=o("d18d").a,l=(o("b225"),o("17cc")),n=Object(l.a)(a,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{ref:"scroll-warp",staticClass:"scroll-warp",class:{"scroll-warp-pulling":e.pulling,"scroll-warp-complete":!e.hasNext&&!e.isEmpty,"scroll-warp-empty":e.isEmpty},style:{"padding-bottom":e.numberKeyboardCoverHeight+"px"},on:{scroll:e.onScroll,touchstart:e.onTouchstart,touchmove:e.onTouchmove,touchend:e.onTouchend}},[e.allowPullDown?o("div",{staticClass:"pull-refresh-warp",style:{height:e.pullDist+"px"}},[o("div",{staticClass:"pull-refresh"},[o("div",{staticClass:"animation-refresher",class:{refreshing:e.refreshing}}),e.updateTime?o("p",{staticClass:"pull-refresh-date"},[e._v("最后成功同步："+e._s(e.updateTime))]):e._e()])]):e._e(),e._t("default"),e.loading?o("div",{staticClass:"page-loading"},[o("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[o("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]):e._e(),e.hasNext||e.isEmpty?e._e():[e.$slots.end?e._t("end"):e._e(),!e.$slots.end&&e.endText?o("div",{staticClass:"end-text"},[e._v("\n      "+e._s(e.endText)+"\n    ")]):e._e()]],2)}),[],!1,null,"2b1a346c",null);t.default=n.exports},"8db6":function(e,t,o){"use strict";o("bee2")},"9d55":function(e,t,o){(e.exports=o("690e")(!1)).push([e.i,'.zjapp .scroll-warp[data-v-2b1a346c]{flex:1;overflow:auto;-webkit-overflow-scrolling:touch}.zjapp .scroll-warp-pulling[data-v-2b1a346c]{overflow:hidden}.zjapp .scroll-warp-complete[data-v-2b1a346c]:after{content:"";display:block;height:100px}.zjapp .scroll-warp-empty[data-v-2b1a346c]{display:flex;flex-direction:column}.zjapp .pull-refresh-warp[data-v-2b1a346c]{position:relative;height:0;overflow:hidden}.zjapp .pull-refresh[data-v-2b1a346c]{position:absolute;left:0;bottom:0;height:70px;width:100%;padding:6px;text-align:center}.zjapp .pull-refresh-date[data-v-2b1a346c]{margin-top:4px;height:16px;line-height:16px;font-size:12px;color:#bcbcbc}.zjapp .page-loading[data-v-2b1a346c]{padding:10px;text-align:center}.zjapp .end-text[data-v-2b1a346c]{color:#c8c8c8;background:#f4f4f4;position:relative;line-height:76px;height:76px;text-align:center}.zjapp .end-text[data-v-2b1a346c]:after,.zjapp .end-text[data-v-2b1a346c]:before{content:"";position:absolute;width:48px;height:1px;background:#e4e4e4;top:50%;margin-top:-1px}.zjapp .end-text[data-v-2b1a346c]:after{left:50%;transform:translateX(-92px)}.zjapp .end-text[data-v-2b1a346c]:before{right:50%;transform:translateX(90px)}.zjapp .end-slot[data-v-2b1a346c]{padding:30px;line-height:18px;text-align:center;color:#c8c8c8}',""])},b225:function(e,t,o){"use strict";o("ef48")},bee2:function(e,t,o){var a=o("6163");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,o("85cb").default)("31bef718",a,!0,{sourceMap:!1,shadowMode:!1})},d18d:function(e,t,o){"use strict";(function(e){o("2b45");var a,l=o("4360"),n=o("48f4"),i=o("162a"),s=o("e2a7"),r=o("a500"),c=o("6f9e"),h={};t.a={name:"Scroller",props:{buildingId:{type:String,default:""},hasNext:{type:Boolean,default:!1},isEmpty:{type:Boolean,default:!1},isSync:{type:Boolean,default:!0},endText:{type:String,default:""},memoryScrollTop:{type:Boolean,default:!0},keepScrollTop:{type:Boolean},hasPullDown:{type:Boolean,default:!0},onPullDown:{type:Function}},data:function(){return{pullDist:0,refreshing:!1,pulling:!1,loading:!1,scrollTop:0,isCurrKeyboard:!1,gapBottom:0}},computed:{allowPullDown:function(){return this.hasPullDown&&(!!this.$listeners.pullDown||!!this.onPullDown)},updateTime:function(){return l.a.state.global.businessDownloadTime},numberKeyboardCoverHeight:function(){return l.a.state.global.isNumberInputOpen?l.a.state.global.numberKeyboardHeight-this.gapBottom:0}},mounted:function(){var e=this;c.a.$on("numberKeyboardOpen",this.onNumberKeyboardOpen),this.$nextTick((function(){var t=e.$refs["scroll-warp"]&&e.$refs["scroll-warp"].getBoundingClientRect&&e.$refs["scroll-warp"].getBoundingClientRect();t&&(e.gapBottom=document.documentElement.clientHeight-t.bottom),e.$el&&e.$el.addEventListener("focus",(function(t){var o=t&&t.target,a=o&&o.tagName&&o.tagName.toLowerCase();if("input"===a||"textarea"===a){window.addEventListener("resize",(function t(){var a=o.getBoundingClientRect(),l=e.$el.getBoundingClientRect(),n=a.bottom-l.bottom;n>0&&e.scrollBy(n),window.removeEventListener("resize",t,!1)}),!1)}}),!0)}))},destroyed:function(){c.a.$off("numberKeyboardOpen",this.onNumberKeyboardOpen)},activated:function(){var e=this.keepScrollTop||this.$router.isBack&&this.memoryScrollTop;this.scrollTop&&e&&(this.$refs["scroll-warp"].scrollTop=this.scrollTop)},deactivated:function(){this.memoryScrollTop&&(this.scrollTop=this.$refs["scroll-warp"].scrollTop)},methods:{onScroll:function(e){var t=this,o=this.$refs["scroll-warp"].scrollTop,a=this.$refs["scroll-warp"].scrollHeight;if(o+this.$refs["scroll-warp"].clientHeight>=a-5&&!this.loading&&this.hasNext){this.loading=!0;var l=this.$listeners.loadNext();l&&l.then&&"function"==typeof l.then?l.then((function(){t.loading=!1})):this.loading=!1}this.$emit("scroll",e)},getTouchDiretion:function(e){if(!(h&&e&&e.touches&&e.touches[0]))return"";var t=e.touches[0].clientX,o=e.touches[0].clientY;return Math.abs(o-h.y)>Math.abs(t-h.x)&&Math.abs(o-h.y)>=3?o>h.y?"down":"up":""},onTouchstart:function(e){this.allowPullDown&&e.touches&&1===e.touches.length&&(h={x:e.touches[0].clientX,y:e.touches[0].clientY,scrollTop:this.$refs["scroll-warp"].scrollTop,pullDist:this.pullDist})},onTouchmove:function(e){if(this.allowPullDown&&e.touches&&1===e.touches.length){var t=this.$refs["scroll-warp"].scrollTop,o=e.touches[0].clientY,a=o-h.y,l=this.getTouchDiretion(e);"down"===l?!this.refreshing&&t<=0?(this.pulling=!0,this.pullDist=(a-h.scrollTop)/2,e.preventDefault()):this.pulling=!1:"up"===l?this.pullDist>0&&(this.pullDist=h.pullDist-(h.y-o),e.preventDefault()):this.pullDist=h.pullDist}},onTouchend:function(){var e=this;this.allowPullDown&&(h={},this.pulling=!1,this.pullDist>=70&&this.isSync?this.refreshing?this.makePullTo(70):this.makePullTo(70).then((function(){if(e.refreshing=!0,e.onPullDown){var t=e.onPullDown();t&&t.then&&"function"==typeof t?t.finally((function(){e.refreshing=!1,e.makePullTo(0)})):(e.refreshing=!1,e.makePullTo(0))}else e.dataSync().then((function(){e.refreshing=!1,e.makePullTo(0),e.$emit("pullDown")})).catch((function(){e.refreshing=!1,e.makePullTo(0),e.$emit("pullDown")}))})):(this.refreshing=!1,this.makePullTo(0)))},makePullTo:function(e){var t=this,o=this.pullDist,a=e,l=a-o,n=o;return o===a?Promise.resolve():new Promise((function(e){!function i(){window.requestAnimationFrame((function(){n+=l/6,t.pullDist=n,o<a&&n<a||o>a&&n>a?i():(t.pullDist=a,t.refreshing=!1,e())}))}()}))},dataSync:function(){var e,t=n.default.getCurrentModuleCode(),o=n.default.getCurrentRoute(),a=o.meta&&o.meta.isTodo;if(n.default.isModuleNeedBuilding(t)&&!a){if(!this.buildingId)return new Promise((function(e){setTimeout((function(){e()}),500)}));e=this.buildingId}return r.a.addTrack("公共-手动下拉刷新","",""),i.a.beginManualUpdate(),n.default.checkSync(e).then((function(e){return i.a.endManualUpdate(),e})).catch((function(e){$log.error("下拉刷新错误",e),e&&"Error: Network Error"===e.toString()?s.a.alert("当前网络无法同步数据"):s.a.alert(e),i.a.endManualUpdate()}))},getScrollHeight:function(){return this.$refs["scroll-warp"].offsetHeight},getScrollTop:function(){return this.$refs["scroll-warp"].scrollTop},setScrollTop:function(e){this.$refs["scroll-warp"].scrollTop=e},scrollBy:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,l=this.getScrollTop(),n=l+e,i=Math.round(o/16.7),s=e/i,r=l,c=a=+new Date;return l===n?Promise.resolve():new Promise((function(e){!function o(){window.requestAnimationFrame((function(){c===a&&(r+=s,t.$refs["scroll-warp"].scrollTop=r,l<n&&r<n||l>n&&r>n?o():(t.$refs["scroll-warp"].scrollTop=n,e()))}))}()}))},scrollTo:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,o=this.getScrollTop(),a=e-o;return this.scrollBy(a,t)},scrollToEle:function(e){var t=e.keyboardHeight||232,o=(e=e.$el?e.$el:e).getBoundingClientRect(),a=this.$refs["scroll-warp"].getBoundingClientRect();if(o&&a){var n=document.documentElement.clientHeight-(l.a.state.global.isNumberInputOpen?t:0),i=a.bottom<n?a.bottom:n,s=a.top-o.top,r=o.bottom-i;s>0?this.scrollBy(-s-10):r>0&&this.scrollBy(r+10)}},isCurrent:function(t,o){var a=this;t.length&&e.each(t,(function(e){e._uid===o?a.isCurrKeyboard=!0:a.isCurrent(e.$children,o)}))},onNumberKeyboardOpen:function(e){this.isCurrKeyboard=!1,this.isCurrent(this.$children,e._uid),this.isCurrKeyboard&&this.scrollToEle(e)}}}}).call(this,o("391c"))},ef48:function(e,t,o){var a=o("9d55");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,o("85cb").default)("a1a65c0c",a,!0,{sourceMap:!1,shadowMode:!1})}}]);