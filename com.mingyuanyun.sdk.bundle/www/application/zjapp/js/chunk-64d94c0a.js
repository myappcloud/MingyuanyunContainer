(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-64d94c0a"],{"1ad6":function(e,t,i){var s=i("1f34");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,i("85cb").default)("a589ca68",s,!0,{sourceMap:!1,shadowMode:!1})},"1f34":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .item[data-v-52e80b59]{align-items:center}.zjapp .icon[data-v-52e80b59]{color:#4275e8}.zjapp .item>[class*=icon-checkbox][data-v-52e80b59]{margin-right:10px}.zjapp .item-disabled>[class*=icon-checkbox][data-v-52e80b59]{color:#b2b2b2;background-color:#b2b2b2}",""])},"32fa":function(e,t,i){"use strict";var s=i("329b"),a=i("e973d").a,o=(i("f43d"),i("17cc")),n=Object(o.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"slide-right"}},[e.show?i("page-content",{attrs:{title:e.title,mode:"dialog","on-close":e.closeEvent}},[e.multi?i("div",{staticClass:"header-btn",attrs:{slot:"header-bar-right"},on:{click:e.onConfirm},slot:"header-bar-right"},[e._v("\n      确定("+e._s(e.selected.length)+")\n    ")]):e._e(),e.multi&&e.showFixed&&e.selected.length?i("div",{staticClass:"selected fixed border-bottom"},[i("label",{staticClass:"selected-label"},[e._v("已选：")]),e._l(e.selected,(function(t){return i("span",{key:t.id,staticClass:"selected-item",class:{"selected-item-disabled":t.disabled}},[e._v("\n        "+e._s(t.name)+"\n        "),i("icon",{staticClass:"selected-remove",attrs:{name:"unqualified"},on:{click:function(i){e.onSelectUser(t)}}})],1)}))],2):e._e(),i("scroller",{attrs:{"is-empty":!!e.keyword&&!e.roleGroup.length},on:{"&scroll":function(t){return e.onScroll(t)}}},[i("app-search-bar",{ref:"app-search-bar",attrs:{placeholder:"搜索","history-key":e.storageKey},on:{changeSearchStatus:e.onSearchTypeChange},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),!e.searchStatus||e.searchStatus&&e.keyword?[e.multi&&e.selected.length?i("div",{staticClass:"selected"},[i("label",{staticClass:"selected-label"},[e._v("已选：")]),e._l(e.selected,(function(t){return i("span",{key:t.id,staticClass:"selected-item",class:{"selected-item-disabled":t.disabled}},[e._v("\n            "+e._s(t.name)+"\n            "),i("icon",{staticClass:"selected-remove",attrs:{name:"unqualified"},on:{click:function(i){e.onSelectUser(t)}}})],1)}))],2):e._e(),e.lastSelected&&e.lastSelected.length?[i("div",{staticClass:"part-title"},[e._v("最近选择")]),e._l(e.lastSelected,(function(t){return i("user-item",{key:t.id,attrs:{"head-portrait":t.head_portrait,name:t.name,multi:e.multi,selected:e.selectedSet[t.id],disabled:e.disabledSet[t.id]},on:{click:function(i){e.onSelectUser(t)}}})}))]:e._e(),e.roleGroup&&e.roleGroup.length?i("div",{staticClass:"part-title"},[e._v("全部人员")]):e._e(),e._l(e.roleGroup,(function(t){return[i("item",{key:t.id,attrs:{text:t.name,"icon-right":e.openSet[t.id]?"arrow-up":"arrow-down",border:"bottom"},on:{click:function(i){e.toggleGroup(t)}}},[e.multi?i("icon",{attrs:{slot:"icon-left",name:e.groupSelectedSet[t.id]?"checkbox-checked":"checkbox"},on:{click:function(i){i.stopPropagation(),e.selectedAll(t)}},slot:"icon-left"}):e._e(),i("div",{staticClass:"item-text fw-b"},[e._v(e._s(t.name))])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:e.openSet[t.id],expression:"openSet[role.id]"}],key:t.id+"-list",staticClass:"role-list"},[31===t.id&&e.contractorGroup&&e.contractorGroup.length?[e._l(e.contractorGroup,(function(t){return[i("item",{key:t.id,attrs:{text:t.name,"icon-right":e.openSet[t.id]?"arrow-up":"arrow-down",border:"bottom"},on:{click:function(i){e.toggleGroup(t)}}},[e.multi?i("icon",{attrs:{slot:"icon-left",name:e.groupSelectedSet[t.id]?"checkbox-checked":"checkbox"},on:{click:function(i){i.stopPropagation(),e.selectedAll(t)}},slot:"icon-left"}):e._e()],1),e.openSet[t.id]?e._l(t.children,(function(s){return i("user-item",{key:t.id+s.id,staticClass:"item-data",attrs:{"head-portrait":s.head_portrait,name:s.name,keyword:e.keyword,multi:e.multi,selected:e.selectedSet[s.id],disabled:e.disabledSet[s.id]},on:{click:function(t){e.onSelectUser(s)}}})})):e._e()]}))]:e._l(t.children,(function(t){return i("user-item",{key:t.id,staticClass:"item-data",attrs:{"head-portrait":t.head_portrait,name:t.name,keyword:e.keyword,multi:e.multi,selected:e.selectedSet[t.id],disabled:e.disabledSet[t.id]},on:{click:function(i){e.onSelectUser(t)}}})}))],2)]})),i("loading-status",{attrs:{"is-empty":!e.roleGroup.length,"empty-text":Boolean(e.keyword)?"没有查询到结果":"暂无数据",type:Boolean(e.keyword)?"search":"common"}})]:e._e()],2)],1):e._e()],1)}),[],!1,null,"a6d27bfe",null).exports,c=!1;c||(c=new(s.default.extend(n))({el:document.createElement("div")}),document.body.appendChild(c.$el));t.a=c},"50c9":function(e,t,i){"use strict";i("1ad6")},5978:function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .selected[data-v-a6d27bfe]{position:relative;z-index:3;padding:5px 15px 10px 60px;line-height:24px;background-color:#fff;max-height:134px;overflow:auto;scroll-behavior:smooth}.zjapp .selected-label[data-v-a6d27bfe]{position:absolute;top:10px;left:15px;line-height:24px;font-size:16px;color:#999}.zjapp .selected-item[data-v-a6d27bfe]{position:relative;display:inline-block;height:24px;line-height:20px;padding:2px 20px 2px 5px;margin:5px 5px 0 0;font-size:14px;color:#666;background-color:#f4f4f4;border-radius:4px}.zjapp .selected-remove[data-v-a6d27bfe]{position:absolute;top:0;right:0;width:20px;height:24px;line-height:24px;text-align:center;font-size:8px;color:#ccc}.zjapp .selected-item-disabled[data-v-a6d27bfe]{padding:2px 5px}.zjapp .selected-item-disabled .selected-remove[data-v-a6d27bfe]{display:none}.zjapp .item-data[data-v-a6d27bfe]{background-color:#fafafa}.zjapp .scroll-wrap[data-v-a6d27bfe]{flex:1;background:#fff;height:100%;overflow:auto;transform:translateZ(0)}.zjapp .fixed[data-v-a6d27bfe]{position:absolute;top:0;left:0;right:0;background-color:#fff;z-index:4}.zjapp .part-title[data-v-a6d27bfe]{padding:9px 15px 5px 15px;line-height:18px;font-size:12px;color:#999;background-color:#f4f4f4}.zjapp .item[data-v-a6d27bfe]{align-items:center}.zjapp .item>[class*=icon-checkbox][data-v-a6d27bfe]{margin-right:10px}",""])},"788b":function(e,t,i){var s=i("8cca");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,i("85cb").default)("44b486a8",s,!0,{sourceMap:!1,shadowMode:!1})},"8cca":function(e,t,i){var s=i("5454");(e.exports=i("690e")(!1)).push([e.i,".zjapp .item-user-unit[data-v-2ccee61c]{position:relative;display:inline-block;vertical-align:top;font-size:0}.zjapp .item-user-name[data-v-2ccee61c]{font-size:16px;display:inline-block;vertical-align:middle}.zjapp .icon-im-btn[data-v-2ccee61c]{position:relative;z-index:5;display:inline-block;vertical-align:middle;width:34px;height:22px;background:url("+s(i("f77a"))+") no-repeat 6px;background-size:16px 10px}.zjapp .popup-user-im[data-v-2ccee61c]{position:absolute;z-index:5;bottom:30px;left:50%;margin-left:-65px;padding:0 5px;width:130px;height:60px;background-color:rgba(0,0,0,.8);border-radius:5px}.zjapp .popup-user-im-item[data-v-2ccee61c]{float:left;width:60px;height:60px;text-align:center;color:#fff;padding-top:10px}.zjapp .popup-user-im-item.disabled[data-v-2ccee61c]{color:#666}.zjapp .popup-user-im-arrow[data-v-2ccee61c]{position:absolute;bottom:-5px;left:50%;margin-left:-5px;border:5px solid transparent;border-bottom:none;border-top-color:rgba(0,0,0,.8)}.zjapp .popup-user-im-icon[data-v-2ccee61c]{display:block;font-size:21px}.zjapp .popup-user-im-text[data-v-2ccee61c]{font-size:12px;line-height:16px;margin-top:4px}.zjapp .popup-user-posi-bottom[data-v-2ccee61c]{bottom:auto;top:30px}.zjapp .popup-user-posi-bottom .popup-user-im-arrow[data-v-2ccee61c]{top:-5px;bottom:auto;border-top:none;border-bottom:5px solid rgba(0,0,0,.8)}",""])},9864:function(e,t,i){"use strict";var s=i("cdce").a,a=(i("c509"),i("17cc")),o=Object(a.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"root"},[e.list.length?e._e():i("div",{staticClass:"item-user-unit"},[i("span",{staticClass:"item-user-name"},[e._v("\n      无\n    ")])]),e._l(e.list,(function(t,s){return i("div",{key:s,staticClass:"item-user-unit"},[i("span",{staticClass:"item-user-name"},[e._v("\n      "+e._s(t&&t.name?t.name:"")+"\n    ")]),i("div",{staticClass:"icon-im-btn",on:{click:function(i){if(i.stopPropagation(),i.target!==i.currentTarget)return null;e.openImPopup(t,i)}}},[e.popupOpenItemId===t.id?i("div",{staticClass:"popup-user-im",class:{"popup-user-posi-bottom":e.popupUserPosiBottom},style:{left:e.popupL}},[i("div",{directives:[{name:"track",rawName:"v-track",value:"公共-发起聊天",expression:"'公共-发起聊天'"}],staticClass:"popup-user-im-item",class:{disabled:e.isImDisabled(t)},on:{click:function(i){e.openIm(t)}}},[i("icon",{staticClass:"popup-user-im-icon",attrs:{name:"liaotian"}}),i("p",{staticClass:"popup-user-im-text"},[e._v("聊天")])],1),t.mobile&&e.userInfo.user_id!==t.id?i("a",{directives:[{name:"track",rawName:"v-track",value:"公共-打电话",expression:"'公共-打电话'"}],staticClass:"popup-user-im-item",attrs:{href:"tel:"+t.mobile}},[i("icon",{staticClass:"popup-user-im-icon",attrs:{name:"dianhua"}}),i("p",{staticClass:"popup-user-im-text"},[e._v("电话")])],1):i("div",{staticClass:"popup-user-im-item disabled"},[i("icon",{staticClass:"popup-user-im-icon",attrs:{name:"dianhua"}}),i("p",{staticClass:"popup-user-im-text"},[e._v("电话")])],1),i("div",{staticClass:"popup-user-im-arrow",style:{left:e.arrowL}})]):e._e()])])}))],2)}),[],!1,null,"2ccee61c",null);t.a=o.exports},afbf:function(e,t,i){var s=i("5978");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,i("85cb").default)("14083d13",s,!0,{sourceMap:!1,shadowMode:!1})},b747:function(e,t,i){"use strict";i("f548"),i("9dd9"),i("cc57");var s={name:"UserSelectItem",components:{Item:i("07d2").default},props:{name:{type:String},headPortrait:{type:String,default:""},multi:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},keyword:{type:String,default:""}},data:function(){return{}},computed:{showName:function(){var e="";if(""===this.keyword)e=this.name;else{var t=new RegExp("("+this.keyword+")","gmi");e=this.name.replace(t,'<span color="color-theme">$1</span>')}return e}}},a=(i("50c9"),i("17cc")),o=Object(a.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("item",e._g({class:{"item-disabled":e.disabled},attrs:{border:"bottom"}},e.$listeners),[e.multi?i("icon",{attrs:{name:e.selected?"checkbox-checked":"checkbox"}}):e._e(),e.headPortrait?i("img",{staticClass:"item-headimg",attrs:{src:e.headPortrait}}):e._e(),i("div",{staticClass:"item-text",class:{"color-theme":!e.multi&&e.selected},domProps:{innerHTML:e._s(e.showName)}}),e.multi?e._e():i("icon",{attrs:{name:e.selected?"qualified":""}})],1)}),[],!1,null,"52e80b59",null);t.a=o.exports},c509:function(e,t,i){"use strict";i("788b")},cd05:function(e,t,i){"use strict";var s=i("e53d").a,a=i("17cc"),o=Object(a.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("item",{attrs:{label:e.title,mode:e.mode,editabled:e.editabled,border:e.border},on:{click:e.openSelect}},[!e.multi&&e.title?i("div",{class:{"item-label":!0,"color-gray2":"view"===e.mode},attrs:{slot:"left"},slot:"left"},[e._v("\n    "+e._s(e.title)+"\n    "),""!==e.isRead?i("span",{staticClass:"item-status-read",class:{"color-red":!e.isRead,"color-gray2":e.isRead}},[e._v("\n      "+e._s(e.isRead?"已读":"未读")+"\n    ")]):e._e()]):e._e(),e.multi?e._e():i("div",{class:{"item-text":!0,"align-r":"edit"===e.mode,"color-gray1":"edit"===e.mode&&e.selected&&e.selected.id,"item-placeholder":"edit"===e.mode&&!(e.selected&&e.selected.id),"border-editabled":"view"===e.mode&&e.editabled},attrs:{slot:"right"},slot:"right"},[i("div",{staticClass:"item-display-flex"},[e.selected&&e.selected.id?i("div",{staticClass:"item-flex"},["edit"===e.mode?i("span",[e._v(e._s(e.selected.name))]):i("check-user-contact",{attrs:{list:[e.selected]}})],1):e._e(),e.note&&e.selected&&e.selected.id?i("div",{staticClass:"item-note color-gray"},[e._v("\n        "+e._s(e.note)+"\n      ")]):e._e()]),e.selected&&e.selected.id?e._e():i("span",{class:{"item-placeholder":e.editabled&&!e.formCheck,"item-text-error":e.formCheck}},[e._v("\n      "+e._s("edit"===e.mode?e.required?"请选择":"选填":e.emptyText)+"\n    ")]),e.date&&!e.editabled?i("div",{staticClass:"color-light mt10"},[i("span",[e._v(e._s(e.date))]),e.modifyDate?i("span",{staticClass:"ml10"},[e._v("提交")]):e._e(),e.status?i("span",{staticClass:"ml10",class:e.statusClass},[e._v("\n        "+e._s(e.status)+"\n      ")]):e._e()]):e._e(),e.modifyDate&&!e.editabled?i("div",{staticClass:"color-light mt10"},[i("span",[e._v(e._s(e.modifyDate))]),i("span",{staticClass:"ml10"},[e._v("最后修改")])]):e._e()]),e.multi?i("div",{class:{"item-text":!0,"align-r":"edit"===e.mode,"color-gray1":"edit"===e.mode&&e.selected&&e.selected.length,"item-placeholder":"edit"===e.mode&&!(e.selected&&e.selected.length),"border-editabled":"view"===e.mode&&e.editabled},attrs:{slot:"right"},slot:"right"},[e.selected&&e.selected.length?["edit"===e.mode?e._l(e.selected,(function(t,s){return i("span",{key:s},[e._v("\n          "+e._s(s?"、":"")+e._s(t.name)+"\n        ")])})):i("check-user-contact",{attrs:{list:e.selected}})]:i("span",{class:{"item-placeholder":e.editabled&&!e.formCheck,"item-text-error":e.formCheck}},[e._v("\n      "+e._s(e.editabled?e.required?"请选择":"选填":e.emptyText)+"\n    ")])],2):e._e()])}),[],!1,null,null,null);t.a=o.exports},cdce:function(e,t,i){"use strict";(function(e){i("cc57");var s=i("4360"),a=i("3bd5"),o=i("1601"),n=i("e2a7"),c=i("6f9e");t.a={name:"CheckUserContact",props:{list:{type:Array,default:function(){return[]}}},data:function(){return{popupOpenItemId:"",popupL:"50%",arrowL:"50%",popupUserPosiBottom:!1}},computed:{allowIM:function(){return window&&window.$rootScope&&window.$rootScope.allowIM},userInfo:function(){return a.a.getUser()}},created:function(){c.a.$on("pageContentClick",this.closeImPopup)},destroyed:function(){c.a.$off("pageContentClick",this.closeImPopup)},methods:{hasIm:function(e){return!!parseInt(e.is_im_user)},openImPopup:function(e,t){if($log.log("打开聊天窗口",e),c.a.$emit("pageContentClick"),this.popupOpenItemId=e.id,t&&t.target){var i=t.target.getBoundingClientRect(),a=window.innerWidth,o=s.a.state.app.isIOS?s.a.state.app.isIOSBezelLess?88:64:44;i.top<o+68?this.popupUserPosiBottom=!0:this.popupUserPosiBottom=!1,a-i.right<50?(this.popupL=16-(50-(a-i.right))+"px",this.arrowL=50-(a-i.right)+65+"px"):(this.popupL="50%",this.arrowL="50%")}},closeImPopup:function(){this.popupOpenItemId=""},openIm:function(t){var i=this.isImDisabled(t),s=this.allowIM&&!i;if(console.log(i,s,this.allowIM),s)if(e.has(t,"headimg_url")){var a=this.userInfo.tenant_code+"_"+t.id;o.a.openIm(a,t.name,t.headimg_url).catch((function(e){n.a.alert(e)}))}else o.a.openUserChat(t.id).catch((function(e){n.a.alert(e)}));else n.a.alert("聊天功能优化中暂不可用")},isImDisabled:function(e){return 1!==parseInt(e.is_im_user)||e.id===this.userInfo.user_id}}}}).call(this,i("391c"))},e53d:function(e,t,i){"use strict";(function(e){i("2b45"),i("e697"),i("cc57"),i("163d");var s=i("07d2"),a=i("32fa"),o=i("6144"),n=i("9864"),c=i("e2a7"),r=i("a18c");t.a={name:"UserSelect",components:{Item:s.default,CheckUserContact:n.a},props:{title:{type:String},value:{type:[Object,Array]},options:{type:Array,default:function(){return[]}},multi:{type:Boolean,default:!1},date:{type:String,default:""},modifyDate:{type:String,default:""},isRead:{type:[String,Boolean],default:""},note:{type:String,default:""},status:{type:String,default:""},statusClass:{type:[Object,String]},max:{type:Number,default:1/0},maxTip:{type:String,default:""},border:{type:String,default:""},mode:{type:String,default:"edit"},editabled:{type:Boolean,default:!0},memory:{type:Boolean,default:!1},autoSelect:{type:Boolean,default:!1},required:{type:Boolean,default:!0},emptyText:{type:String,default:"空"},beforeOpen:{type:Function,default:function(){}},beforeSelect:{type:Function,default:function(){}},beforeConfirm:{type:Function,default:function(){}},formCheck:{type:Boolean,default:!1},linkedData:{type:Object,default:function(){return{}}}},data:function(){return{isOpen:!1,memoryKey:(this.$route?this.$route.name:r.a.history.current.name)+encodeURI(this.title||"选人组件")}},computed:{selected:function(){return this.multi?e.isArray(this.value)?this.value:e.isEmpty(this.value)?[]:[this.value]:e.isArray(this.value)?this.value[0]||{}:e.isEmpty(this.value)?{}:this.value}},watch:{options:function(){this.setSelected()}},mounted:function(){this.setSelected()},methods:{openSelect:function(){var t=this;if(this.editabled){var i=this.beforeOpen(this.linkedData);i&&i.then&&e.isFunction(i.then)?i.then((function(e){!1!==e&&t.openPopup()})).catch((function(e){$log.error(e),c.a.alert(e||"发生了错误")})):!1!==i&&this.openPopup()}},openPopup:function(){var t=this;a.a.openPopup({title:"选择"+(this.title||""),selected:this.selected,options:this.options,multi:this.multi,max:this.max,maxTip:this.maxTip,beforeSelect:this.beforeSelect,beforeConfirm:this.beforeConfirm,onSelect:function(i){var s=e.cloneDeep(t.selected);t.multi?(t.$emit("input",i,s),t.$emit("onSelect",i,s)):(t.$emit("input",i[0],s),t.$emit("onSelect",i[0],s)),t.memory&&o.a.saveObject(t.memoryKey,t.multi?i:i[0],o.a.level.user)}})},closeSelect:function(){this.isOpen=!1},getSame:function(t,i){var s=[];return e.each(t,(function(t){t&&t.id&&e.find(i,(function(e){return e.id.toString().toUpperCase()===t.id.toString().toUpperCase()}))&&s.push(t)})),s},setSelected:function(){var t,i=o.a.getObject(this.memoryKey,o.a.level.user);!1===this.editabled||e.isEmpty(this.options)||(this.multi?e.isEmpty(this.selected)?i&&i.length&&this.memory?(t=this.getSame(i,this.options)).length&&(this.$emit("input",t),this.autoSelect&&this.$emit("defaultSelect",t)):this.selectDefault&&(t=this.getSame(this.selectDefault,this.options)).length&&(this.$emit("input",t),this.autoSelect&&this.$emit("defaultSelect",t)):(t=this.getSame(this.selected,this.options)).length?this.autoSelect&&this.$emit("defaultSelect",this.selected):this.autoSelect&&this.$emit("defaultSelect",[]):!e.isEmpty(this.selected)&&this.selected.id?this.autoSelect&&this.$emit("defaultSelect",this.selected):this.memory&&!e.isEmpty(i)&&(e.isArray(i)&&(i=i[0]),e.some(this.options,{id:i.id})&&(this.$emit("input",i),this.autoSelect&&this.$emit("defaultSelect",i))))}}}}).call(this,i("391c"))},e89f:function(e,t,i){"use strict";var s=i("04f3"),a=i("cf09"),o=i("4360"),n=0;t.a={name:"PopupMixin",data:function(){return{backButtonEvent:null}},watch:{show:function(e){var t=this;if(e){if(this.$nextTick((function(){t.$el&&t.$el.style&&(t.$el.style.zIndex=++a.a.zIndex,n++,o.a.commit("app/SET_HAS_POPUP",!!n))})),!this.backButtonEvent){var i=this.close||this.closePopup;this.backButtonEvent=Object(s.a)(i)}}else--n<0&&(n=0),o.a.commit("app/SET_HAS_POPUP",!!n),this.backButtonEvent&&(Object(s.c)(this.backButtonEvent),this.backButtonEvent=null)}},methods:{}}},e973d:function(e,t,i){"use strict";(function(e){i("5ab2"),i("6d57"),i("e10e"),i("e204"),i("ed63"),i("8cf2");var s=i("28f8"),a=(i("e697"),i("cc57"),i("9dd9"),i("e2a7")),o=i("9eea"),n=i("774b"),c=i("07d2"),r=i("b747"),l=i("6144"),d=i("e89f"),p=i("a18c"),u=i("4360");function h(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function m(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?h(Object(i),!0).forEach((function(t){Object(s.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.a={name:"AppUserSelect",components:{appSearchBar:o.default,Scroller:n.default,Item:c.default,UserItem:r.a},mixins:[d.a],data:function(){return{storageKey:encodeURI(this.title||"userSelectMark"),showFixed:!1,show:!1,searchStatus:!1,keyword:"",options:[],selected:[],disabled:[],max:1/0,maxTip:"",lastSelected:[],openSet:{}}},computed:{selectedSet:function(){var t={};return e.isArray(this.selected)?e.each(this.selected,(function(e){t[e.id]=!0})):this.selected&&this.selected.id&&(t[this.selected.id]=!0),t},disabledSet:function(){var t={};return e.each(this.disabled||[],(function(e){t[e.id]=!0})),t},roleGroup:function(){var t,i=this,s=[{id:31,name:"施工单位人员",children:[]},{id:32,name:"监理单位人员",children:[]},{id:33,name:"建设单位人员",children:[]}];return t=this.keyword?e.filter(this.options,(function(e){return new RegExp("("+i.keyword+")","gmi").test(e.name)})):this.options,e.each(s,(function(i){i.children=e.filter(t,(function(e){return e.role===i.id}))})),e.filter(s,(function(t){return!e.isEmpty(t.children)}))},contractorGroup:function(){var t=this,i=[];if(u.a.state.global.allowGroupUserByConstructor){var s,a={id:"other",name:"其他",children:[]};s=this.keyword?e.filter(this.options,(function(e){return new RegExp("("+t.keyword+")","gmi").test(e.name)})):this.options,e.each(s,(function(t){31===t.role&&(t.contractors&&t.contractors.length?e.each(t.contractors,(function(s){var a=e.find(i,(function(e){return e.id===s.id}));a||(a=m(m({},s),{},{children:[]}),i.push(a)),a.children.push(m({},t))})):a.children.push(m({},t)))})),e.isEmpty(a.children)||i.push(a)}return i},groupSelectedSet:function(){var t=this,i={};return e.each(this.roleGroup,(function(s){var a=e.some(s.children,(function(e){return!t.selectedSet[e.id]}));i[s.id]=!a})),e.each(this.contractorGroup,(function(s){var a=e.some(s.children,(function(e){return!t.selectedSet[e.id]}));i[s.id]=!a})),i}},watch:{keyword:function(e){this.setSearchOpenSet()}},methods:{openPopup:function(t){t.selected=t.selected||[];var i=e.isArray(t.selected)?t.selected:[t.selected],s=e.filter(t.options,(function(t){return e.some(i,{id:t.id})||t.checked}));t.disabled=t.disabled||[];var a=e.isArray(t.disabled)?t.disabled:[t.disabled],o=e.filter(t.options,(function(t){return e.some(a,{id:t.id})||t.disabled}));this.show=!0,this.showFixed=!1,this.title=t.title,this.selected=s,this.disabled=o,this.options=t.options,this.multi=t.multi,this.onSelect=t.onSelect,this.beforeSelect=t.beforeSelect,this.beforeConfirm=t.beforeConfirm,this.max=t.max||1/0,this.maxTip=t.maxTip||"";var n=this.getLastSelected(),c=e.filter(t.options,(function(t){return e.includes(n,t.id)}));c=e.sortBy(c,(function(t){return e.indexOf(n,t.id)})),this.lastSelected=c,this.storageKey=encodeURI(this.title||"userSelectMark"),this.setDefaultOpen(),this.$emit("open")},setDefaultOpen:function(){var t=this;this.openSet={};var i=e.uniqBy(e.map(this.selected,"role"));e.each(i,(function(e){t.$set(t.openSet,e,!0)}));var s=[];e.each(this.selected,(function(e){e&&e.contractors&&e.contractors.length&&(s=s.concat(e.contractors))})),s=e.uniqBy(s,"id"),e.each(s,(function(e){t.$set(t.openSet,e.id,!0)}))},setSearchOpenSet:function(){var t=this;this.keyword?(e.each(this.roleGroup,(function(e){t.$set(t.openSet,e.id,!0)})),e.each(this.contractorGroup,(function(e){t.$set(t.openSet,e.id,!0)}))):this.setDefaultOpen()},toggleGroup:function(e){this.$set(this.openSet,e.id,!this.openSet[e.id])},getLastSetKey:function(){var e=p.a.history.current,t=e?e.name:"";return"".concat(u.a.state.global.currentProject.id,"-").concat(t,"-").concat(encodeURI(this.title))},saveLastSelected:function(t){if(t&&(e.isArray(t)||(t=[t]),!(t.length>3))){var i=this.getLastSelected();e.each(t,(function(e){i.unshift(e.id)})),(i=e.uniqBy(i)).length>3&&(i=i.splice(0,3));var s=this.getLastSetKey(),a=l.a.getUserObject("user-select-last-selected")||{};a[s]=i,l.a.saveUserObject("user-select-last-selected",a)}},getLastSelected:function(){var e=this.getLastSetKey();return(l.a.getUserObject("user-select-last-selected")||{})[e]||[]},closePopup:function(){this.show=!1,this.$emit("close")},onSure:function(){this.saveLastSelected(this.selected),this.onSelect(this.selected),this.closeEvent()},onConfirm:function(){var e=this,t=this.multi?this.beforeSelect(this.selected):null,i=this.beforeConfirm(this.selected);t instanceof Promise||(t=Promise.resolve(t)),i instanceof Promise||(i=Promise.resolve(i)),t.then((function(t){!1!==t&&i.then((function(t){!1!==t&&window.setTimeout((function(){e.onSure()}),300)}))}))},closeEvent:function(){this.closePopup(),this.$refs["app-search-bar"]&&this.$refs["app-search-bar"].cancelSearch(),this.onSearchTypeChange(!1)},onScroll:function(e){e.srcElement&&e.srcElement.scrollTop&&e.srcElement.scrollTop>44?this.showFixed=!0:this.showFixed=!1},onSearchTypeChange:function(e){this.searchStatus=e,e||(this.keyword="")},selectedAll:function(t){var i=this;if(t&&t.children&&t.children.length){var s="";if(s=!this.groupSelectedSet[t.id]){var o=e.filter(t.children,(function(e){return!i.selectedSet[e.id]&&!i.disabledSet[e.id]})).length;if(this.selected.length+o>this.max)return void a.a.alert(this.maxTip||"最多选择".concat(this.max,"个"))}e.each(t.children,(function(t){if(!i.disabledSet[t.id]){var a=e.findIndex(i.selected,{id:t.id});a<0?s&&i.selected.push(t):s||i.selected.splice(a,1)}}))}},onSelectUser:function(t){var i=this,s=this.multi?null:this.beforeSelect(t);s instanceof Promise||(s=Promise.resolve(s)),s.then((function(s){if(!1===s)return!1;if(!i.disabledSet[t.id]){if(i.multi){var o=e.findIndex(i.selected,{id:t.id});if(o<0){if(i.selected.length>=i.max)return void a.a.alert(i.maxTip||"最多选择".concat(i.max,"个"));i.selected.push(t)}else i.selected.splice(o,1)}else i.selected=[t],window.setTimeout((function(){i.onSure()}),300);i.recordSearch()}}))},recordSearch:function(){this.$refs["app-search-bar"].saveHistory()}}}}).call(this,i("391c"))},f43d:function(e,t,i){"use strict";i("afbf")},f77a:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAeCAYAAABqpJ3BAAAAAXNSR0IArs4c6QAAAnlJREFUWAntmD1PFEEYx2dmbxUhd0eABAQsjAap0AIagYYYayWUxMaCaIJQGg1kQ0VNAdkY/QA0JH4AQyEdDRdB74xGQ4CYUABnJMfezsM8JHvKMs8ei4GdGDe57O3zMvP7z8vO7HBW5QIAPjmX65Oc93JgrcDY5Sop5+JW9ZY4Z5sCYGnqSdd7zhWNunhUbdPul2zRLz5mTNyKirtoHwD7lEnVvXk+cmNXUJVjy5sIj7yqJzqRDRktSoBsHuwHJgYof/J23rS4/GOH7AEc88lDRhMgIykAJ2x0evJeZCQFJPW2idMsyEgKiFNQkrH/BSTZ+li3tgdcF+ykwU5b/4mV2Jn5nPHs/acM2PXTFpJk3DEBL9y1q8LzRkHwxrhQtiXEw4G27o5r6Q7MLawXCwvvNpY9X0pdWXHjdWWgrbISO26u0y/740zwDBUcZR+6197TdbP+TiolbPw1N9S0NGQvidWvexu6vLjxujLQdjQHJuY+9B5IeKZ2eFeowGr2oOX/jNPZAr/Op7MF8dRdOK9W2iXIRzxiX0Qlm2AXjKd+qRXN+1sYHPPhMnS2IEbn09mCeOpuLb6d3b//YOyjD+XbaqN65o+VwvefWzjms3V2puyDt/ZtbxUnsVR7Xl3lceN1ZaCt8hZy3HyT55dGla2FCjbRXhGAcI67WXtQ3h7BDwYTYXVMxwRgwPw8WCvbuWHVOXd1CabZTggIAF/O5tzgv8l37V7IZOAw278rQI2tUlitac/ISPYAqEMk04DDPMhICsATsHCCac/ISArA4zvGZN406N88Mo+MpAA8e0xb6ddmipB5ZENGch0IlJpyuIsT9mjMhw53DwElT/W1PxsJFAAAAABJRU5ErkJggg=="}}]);