(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-3db50445"],{"04e66":function(t,e,a){"use strict";(function(t){a("5ab2"),a("e10e");var i=a("28f8"),o=(a("6d57"),a("06a2"),a("cc57"),a("e2a7")),s=a("3bd5"),n=a("774b"),c=a("6bf2"),r=a.n(c),l=a("07d2"),p=a("e68e"),d=a("3c64"),u=a("7cb8"),m=a("37d5"),h=a("cd05"),f=a("5a71"),g=a("7bac"),b=a("a7c3"),_=a("3122"),v=a("49ca"),x=a("162a"),C=a("1b7e"),k=a("b61f"),w=a("5ff0");function y(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}e.a={name:"WaterPouringTestEdit",components:{Scroller:n.a,Item:l.a,ItemImgList:p.a,ItemTextarea:d.a,UserSelect:h.a,SingleSelect:f.a},data:function(){return{isLoading:!0,type:"add",title:"...",isCommit:!1,projId:"",currentUserId:s.a.getUser().user_id,bidsection_id:"",building_id:"",room_id:"",params:{name:"",start_date:r()(new Date).format("YYYY-MM-DD HH:mm:ss"),image_file:[],remark:"",acceptor:{}},acceptParams:{acceptor:{},accept_indoor_image_file:[],accept_outdoor_image_file:[],accept_remark:"",contractor:{}},currentAcceptor:{},accept:{},contractors:[],acceptors:[],showAcceptView:!0,isShowSelDate:!1,currentRigistDate:new Date,maxRegistDate:new Date,selRoomList:[],placeOptions:[],currentPlace:[]}},computed:{placeName:function(){if(t.isEmpty(this.selRoomList))return"";var e=this.selRoomList.slice(0,5);return t.each(e,(function(t){t.place=(t.unit?Object(u.a)(t.unit,"单元"):"")+(t.floor?Object(u.a)(t.floor,"层"):"")+t.room_name})),t.map(e,"place").join(",")+(this.selRoomList.length>5?"...":"")}},activated:function(){this.projId=this.$store.state.global.currentProject.id;var t=this.$route.query,e=t.bidsection_id,a=t.building_id,i=t.room_id,o=t.status,s=t.building_name,n=t.unit,c=t.floor,r=t.room_name;this.type=o?"accept":"add";var l=s+(n||"")+(c||"")+(r||"");this.title=o?l:"新增淋水试验",this.bidsection_id=e,this.building_id=a,this.room_id=i,this.init(i,o)},beforeRouteLeave:function(t,e,a){var i=this.params,s=i.name,n=i.image_file,c=i.remark,r=this.acceptParams,l=r.accept_indoor_image_file,p=r.accept_outdoor_image_file,d=r.accept_remark,u="add"===this.type&&(s||n.length||c),m="accept"===this.type&&(l.length||p.length||d);this.isCommit||!u&&!m?a():o.a.confirm("此操作不会暂存已填写的数据，确定返回吗？").then((function(t){t?a():a(!1)}))},methods:{init:function(t,e){this.isLoading=!0,this.defaultData(e),this.roomSelLists(),this.getUserOptions(),this.getBatchFloorList(),e&&this.getTestData(t,e)},defaultData:function(t){var e=this,a=this.building_id+this.currentUserId;g.a.getUserObject(b.a.WATER_POURING_TEST_DEFAULT_ACCEPTOR+a).then((function(t){var a=s.a.getUser(),i=a.user_id,o=a.user_name,n=a.user_mobile,c=t||{id:i,name:o,mobile:n};e.params={name:"",start_date:r()(new Date).format("YYYY-MM-DD HH:mm:ss"),image_file:[],remark:"",acceptor:c},e.currentAcceptor=c})),g.a.getUserObject(b.a.WATER_POURING_TEST_DEFAULT_CONTRACTOR+a).then((function(t){var a=t||{};e.acceptParams={acceptor:{},accept_indoor_image_file:[],accept_outdoor_image_file:[],accept_remark:"",contractor:a}})),this.currentRigistDate=new Date,this.maxRegistDate=new Date,this.accept={},this.isCommit=!1,t||(this.isLoading=!1)},getUserOptions:function(){var t=this,e=this.projId;return m.default.getProjectUsers(e,[31,32,33]).then((function(e){t.acceptors=e}))},getTestData:function(t,e){var a=this;v.a.getTestData(t,e).then((function(t){console.log(t),a.accept=t,a.acceptParams.acceptor=t.acceptor,a.currentAcceptor=t.acceptor,a.showAcceptView=t.acceptor.id===a.currentUserId})).then((function(){a.initContractor()})).finally((function(){a.isLoading=!1}))},roomSelLists:function(){var t=this;return g.a.getUserObject(b.a.WATER_POURING_TEST_SEL_ROOMS).then((function(e){t.selRoomList=e}))},getBatchFloorList:function(){var t=this;g.a.getUserObject(b.a.WATER_POURING_TEST_BUILDING+this.projId).then((function(e){var a=e||[];t.currentPlace=a;var i=a[1]?a[1].id:"";v.a.getBatchRooms(i).then((function(e){t.placeOptions=e}))}))},setPlace:function(){var t=this,e=this.currentPlace[1]&&this.currentPlace[1].units&&this.currentPlace[1].units.length?"unit-floor-room":"floor-room";k.a.openPopup({title:"选择覆盖部位",type:e,options:this.placeOptions,selected:this.selRoomList,rightBtn:"确定",rightBtnEvent:function(e){console.log("PlaceListDialog - data:",e),t.selRoomList=e}})},setStartDate:function(){this.isShowSelDate=!0},selDate:function(t){this.isShowSelDate=!1,this.params.start_date=r()(t).format("YYYY-MM-DD HH:mm:ss"),console.log(this.params)},cancelDate:function(){this.isShowSelDate=!1},changeAcceptor:function(){var t=this.building_id+this.currentUserId,e=this.params.acceptor;g.a.saveUserObject(b.a.WATER_POURING_TEST_DEFAULT_ACCEPTOR+t,e)},updateAcceptor:function(){var t=this,e={id:this.accept.detailId,acceptor:this.acceptParams.acceptor.id};if(e.acceptor.id!==this.currentAcceptor.id)return o.a.confirm("确定变更验收人为".concat(this.acceptParams.acceptor.name,"吗？"),{okText:"确定"}).then((function(a){if(a)return t.currentAcceptor=t.acceptParams.acceptor,v.a.updateAcceptor(e).then((function(){t.showAcceptView=!1})).catch((function(t){$log.error(t)}));t.acceptParams.acceptor=t.currentAcceptor}))},changeContractor:function(){var t=this.building_id+this.currentUserId,e=this.acceptParams.contractor;g.a.saveUserObject(b.a.WATER_POURING_TEST_DEFAULT_CONTRACTOR+t,e)},initContractor:function(){var t=this;return w.a.getContractorList(this.bidsection_id).then((function(e){t.contractors=e}))},uploadImages:function(){var e=[];return t.each(this.params.image_file,(function(t){!t.url&&t.temp&&e.push(_.a.uploadImage(t.temp).then((function(e){t.url=e}))),!t.videoUrl&&t.videoTemp&&e.push(_.a.uploadImage(t.videoTemp).then((function(e){t.videoUrl=e})))})),Promise.all(e)},submit:function(){var e=this,a=this.params,s=a.name,n=a.start_date,c=a.image_file,r=a.remark,l=a.acceptor;return s?this.selRoomList.length?n.length?c.length?l.id?(o.a.loading("正在提交..."),C.a.getHasNetwork().then((function(t){if(!t)return Promise.reject({errmsg:"当前无网络连接"})})).then((function(){return o.a.loading("正在提交..."),e.uploadImages()})).then((function(){var a=Object(u.o)(t.map(e.params.image_file,(function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?y(Object(a),!0).forEach((function(e){Object(i.a)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},t);return delete e.thumbnail,delete e.temp,delete e.videoTemp,e}))),c={water_pouring_test:{proj_id:e.projId,bidsection_id:e.bidsection_id,building_id:e.building_id,name:s,start_date:n,image_file:a,remark:r,acceptor:l.id},place:e.selRoomList.map((function(t){return{unit:t.unit,floor:t.floor,room_id:t.id}}))};console.log(c),x.a.post("/online/water-pouring-test/upload",null,{data:JSON.stringify(c)}).then((function(t){console.log({res:t}),setTimeout((function(){o.a.hideLoading(),o.a.alert("提交成功")}),1e3),v.a.insertTestData(t).then((function(){e.isCommit=!0,setTimeout((function(){e.$router.go(-1)}),1e3)}))})).catch((function(t){$log.log(t),setTimeout((function(){o.a.hideLoading(),o.a.alert(t)}),1e3)}))})).catch((function(t){o.a.hideLoading(),o.a.alert(t.errmsg||"提交失败"),console.error(t)}))):o.a.alert("请选择后续验收人"):o.a.alert("请拍摄淋水照片"):o.a.alert("请填写淋水开始时间"):o.a.alert("请选择移交部位"):o.a.alert("请填写淋水批次")},commitAccept:function(e){var a=this,i=t.clone(this.acceptParams);return i.acceptor.id?i.accept_outdoor_image_file.length?i.accept_indoor_image_file.length?e||i.contractor.id?(i.id=this.accept.detailId,i.status=e?"合格":"不合格",i.accept_date=r()(new Date).format("YYYY-MM-DD HH:mm:ss"),i.accept_indoor_image_file=JSON.stringify(i.accept_indoor_image_file),i.accept_outdoor_image_file=JSON.stringify(i.accept_outdoor_image_file),i.acceptor=i.acceptor.id||"",i.contractor=i.contractor.id||"",console.log(i),void v.a.updateTestDetail(i,this.room_id).then((function(){o.a.alert("验收成功"),a.isCommit=!0,a.$router.go(-1)}))):o.a.alert("请选择责任单位"):o.a.alert("请拍摄户内验收照片"):o.a.alert("请拍摄外墙/窗照片"):o.a.alert("请选择验收人")}}}}).call(this,a("391c"))},"0748":function(t,e,a){"use strict";a("3cc7")},"2c76":function(t,e,a){"use strict";a("c070")},3727:function(t,e,a){var i=a("f637");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("28f9edd8",i,!0,{sourceMap:!1,shadowMode:!1})},"3c64":function(t,e,a){"use strict";a("163d");var i={name:"ItemTextarea",components:{},props:{value:{type:String,default:""},placeholder:{type:String,default:""},maxlength:{type:Number,default:200},borderBottom:{type:Boolean,default:!0}},data:function(){return{textareaHeight:40,isLock:!1,blurTime:null}},computed:{lastLength:function(){var t=this.value&&this.value.length||0,e=this.maxlength-t;return e>0?e:0}},mounted:function(){var t=this;this.$nextTick((function(){t.textareaHeight=t.$refs.rule&&t.$refs.rule.offsetHeight||40}))},methods:{onfocus:function(){var t=(new Date).getTime();this.blurTime&&t-this.blurTime<300&&window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(this.$refs.input.blur(),window.cordova.plugins.Keyboard.close()),this.blurTime=null,this.$emit("focus")},onblur:function(){this.blurTime=(new Date).getTime(),this.$emit("blur")},setStatus:function(t){console.log(t),this.isLock=t},oninput:function(t){var e=this;setTimeout((function(){if(!e.isLock){var a=t.target.value;a.length>e.maxlength&&(a=a.substring(0,e.maxlength),e.$refs.input.value=a),e.$refs.rule.innerText=a,e.textareaHeight=e.$refs.rule&&e.$refs.rule.offsetHeight+20,e.$emit("input",a),e.$emit("change",a)}}),0)}}},o=(a("2c76"),a("17cc")),s=Object(o.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"item-textarea",class:{"border-bottom":t.borderBottom}},[a("div",{staticClass:"item-textarea-content"},[a("textarea",{ref:"input",style:{height:t.textareaHeight+"px"},attrs:{placeholder:t.placeholder},domProps:{value:t.value},on:{focus:t.onfocus,blur:t.onblur,compositionstart:function(e){t.setStatus(!0)},compositionend:function(e){t.setStatus(!1)},input:t.oninput}}),a("div",{ref:"rule",staticClass:"rule"},[t._v("\n      "+t._s(t.value)+"\n    ")]),t.maxlength!==1/0?a("p",{staticClass:"counter"},[t._v("\n      "+t._s(t.lastLength)+"\n    ")]):t._e()])])}),[],!1,null,null,null);e.a=s.exports},"3cc7":function(t,e,a){var i=a("44a1");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("12a96fd8",i,!0,{sourceMap:!1,shadowMode:!1})},"44a1":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .multiple-place-content[data-v-4b9b8166]{z-index:99999;max-height:134px;border-bottom:1px solid #ececec;overflow:auto;scroll-behavior:smooth}.zjapp .multiple-place-content.-fixed[data-v-4b9b8166]{position:absolute;left:0;right:0;top:0}.zjapp .selected[data-v-4b9b8166]{position:relative;display:flex;padding:13px 15px;font-size:15px;background-color:#fff;overflow:scroll}.zjapp .selected label[data-v-4b9b8166]{margin-right:10px;color:#999;white-space:nowrap}.zjapp .select-wrap[data-v-4b9b8166]{flex:1;background-color:#fff;overflow:auto;scroll-behavior:smooth}.zjapp .van-collapse[data-v-4b9b8166] .van-cell{align-items:center}.zjapp .van-collapse[data-v-4b9b8166] .icon{margin-right:10px;vertical-align:middle}.zjapp .van-collapse[data-v-4b9b8166] .van-collapse-item__content{padding:0}.zjapp .group.-border-bottom[data-v-4b9b8166]{border-bottom:1px solid #ececec}.zjapp .group-name[data-v-4b9b8166]{font-size:14px;color:#999;height:34px;padding-top:15px}.zjapp .element-list[data-v-4b9b8166]{display:flex;flex-wrap:wrap}.zjapp .element[data-v-4b9b8166]{min-width:75px;height:28px;line-height:28px;text-align:center;margin:10px 6px 10px 0;padding:0 10px;background:#fff;border-radius:100px;color:#333;font-size:14px;border:1px solid #dcdcdc}.zjapp .element.-disabled[data-v-4b9b8166]{background:#ececec;color:#999;border-color:#ececec}.zjapp .element.-checked[data-v-4b9b8166]{background:#4275e8;color:#fff;border-color:#4275e8}",""])},"50b5":function(t,e,a){"use strict";a("3727")},"574c":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .item-textarea{background-color:#fff;padding:5px 15px}.zjapp .item-textarea-content{position:relative}.zjapp .item-textarea .rule,.zjapp .item-textarea textarea{width:100%;min-height:40px;line-height:20px;font-size:16px;padding:0;border:none}.zjapp .item-textarea .rule{position:absolute;top:0;left:0;visibility:hidden;word-break:break-all}.zjapp .item-textarea .counter{text-align:right;margin:0 0 -5px 0;height:15px;line-height:15px;color:#b2b2b2;font-size:12px}",""])},"5a97":function(t,e,a){"use strict";a.r(e);var i=a("04e66").a,o=(a("50b5"),a("17cc")),s=Object(o.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-content",{attrs:{title:t.title,"show-go-root":!0}},[t.isLoading?t._e():a("scroller",["add"===t.type?[a("item",{attrs:{mode:"edit",label:"淋水批次"}},[a("template",{slot:"right"},[a("div",{staticClass:"item-con"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.params.name,expression:"params.name"}],staticClass:"location-place-input",attrs:{type:"text",placeholder:"请输入批次描述",maxlength:"200"},domProps:{value:t.params.name},on:{input:function(e){e.target.composing||t.$set(t.params,"name",e.target.value)}}})])])],2),a("item",{attrs:{mode:"edit",label:"覆盖部位",text:t.placeName,editabled:!0},on:{click:function(e){t.setPlace()}}}),a("item",{attrs:{mode:"edit",label:"淋水开始时间",text:t._f("formatDate")(t.params.start_date),editabled:!0},on:{click:function(e){t.setStartDate()}}}),a("div",{staticClass:"bg-white"},[[a("item",{staticClass:"mt10",attrs:{text:"淋水照片"}},[a("i",{staticClass:"icon-point",attrs:{slot:"icon-left"},slot:"icon-left"})]),a("item",{staticClass:"pt0 pb15"},[a("item-img-list",{attrs:{maxlength:15},model:{value:t.params.image_file,callback:function(e){t.$set(t.params,"image_file",e)},expression:"params.image_file"}})],1)]],2),a("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"备注"},model:{value:t.params.remark,callback:function(e){t.$set(t.params,"remark",e)},expression:"params.remark"}}),a("user-select",{staticClass:"mt10",attrs:{title:"后续验收人",options:t.acceptors,editabled:!0},on:{onSelect:function(e){t.changeAcceptor()}},model:{value:t.params.acceptor,callback:function(e){t.$set(t.params,"acceptor",e)},expression:"params.acceptor"}})]:t._e(),"accept"===t.type?[a("item",{attrs:{label:"淋水批次",text:t.accept.name}}),a("item",{attrs:{label:"淋水开始时间",text:t._f("formatDate")(t.accept.start_date)}}),a("item",{attrs:{label:"淋水照片"}},[a("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[a("item-img-list",{attrs:{editabled:!1},model:{value:t.accept.image_file,callback:function(e){t.$set(t.accept,"image_file",e)},expression:"accept.image_file"}})],1)]),a("item",{directives:[{name:"show",rawName:"v-show",value:t.accept.remark,expression:"accept.remark"}],attrs:{label:"备注",text:t.accept.remark}}),a("user-select",{attrs:{title:"检查人",mode:"view",date:t._f("formatDate")(t.accept.regist_date),editabled:!1},model:{value:t.accept.regist_by,callback:function(e){t.$set(t.accept,"regist_by",e)},expression:"accept.regist_by"}}),a("user-select",{staticClass:"mt10",attrs:{title:"验收人",options:t.acceptors,editabled:t.showAcceptView},on:{onSelect:function(e){t.updateAcceptor()}},model:{value:t.acceptParams.acceptor,callback:function(e){t.$set(t.acceptParams,"acceptor",e)},expression:"acceptParams.acceptor"}}),t.showAcceptView?[a("div",{staticClass:"bg-white van-hairline--bottom"},[a("item",{staticClass:"mt10",attrs:{text:"外墙/窗照片"}},[a("i",{staticClass:"icon-point",attrs:{slot:"icon-left"},slot:"icon-left"})]),a("item",{staticClass:"pt0 pb15"},[a("item-img-list",{attrs:{maxlength:15},model:{value:t.acceptParams.accept_outdoor_image_file,callback:function(e){t.$set(t.acceptParams,"accept_outdoor_image_file",e)},expression:"acceptParams.accept_outdoor_image_file"}})],1)],1),a("div",{staticClass:"bg-white"},[a("item",{attrs:{text:"户内验收照片"}},[a("i",{staticClass:"icon-point",attrs:{slot:"icon-left"},slot:"icon-left"})]),a("item",{staticClass:"pt0 pb15"},[a("item-img-list",{attrs:{maxlength:15},model:{value:t.acceptParams.accept_indoor_image_file,callback:function(e){t.$set(t.acceptParams,"accept_indoor_image_file",e)},expression:"acceptParams.accept_indoor_image_file"}})],1)],1),a("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"备注"},model:{value:t.acceptParams.accept_remark,callback:function(e){t.$set(t.acceptParams,"accept_remark",e)},expression:"acceptParams.accept_remark"}}),a("single-select",{staticClass:"mt10",attrs:{title:"责任单位",options:t.contractors,memory:!0,"if-toggle":!0},on:{onSelect:function(e){t.changeContractor()}},model:{value:t.acceptParams.contractor,callback:function(e){t.$set(t.acceptParams,"contractor",e)},expression:"acceptParams.contractor"}}),a("app-button-group",{staticStyle:{"margin-top":"30px"},attrs:{direction:"column"}},[a("app-button",{on:{click:function(e){t.commitAccept(1)}}},[t._v("\n            验收合格\n          ")]),a("app-button",{attrs:{type:"warning",plain:"",rimless:""},on:{click:function(e){t.commitAccept(0)}}},[t._v("\n            验收不合格\n          ")])],1)]:t._e()]:t._e()],2),t.isShowSelDate?a("van-popup",{attrs:{position:"bottom"},model:{value:t.isShowSelDate,callback:function(e){t.isShowSelDate=e},expression:"isShowSelDate"}},[a("van-datetime-picker",{attrs:{type:"datetime","max-date":t.maxRegistDate,title:"开始淋水时间"},on:{confirm:t.selDate,cancel:t.cancelDate},model:{value:t.currentRigistDate,callback:function(e){t.currentRigistDate=e},expression:"currentRigistDate"}})],1):t._e(),"add"!==t.type||t.isLoading?t._e():a("app-button-group",{attrs:{"fixed-bottom":""}},[a("app-button",{on:{click:t.submit}},[t._v("\n      提交淋水记录\n    ")])],1),a("loading-status",{attrs:{"is-loading":t.isLoading}})],1)}),[],!1,null,"252a794a",null);e.default=s.exports},"7c9b":function(t,e,a){"use strict";(function(t){a("e204"),a("f548"),a("6d57"),a("cc57"),a("c904");var i=a("e89f"),o=a("1df9"),s=a("774b"),n=a("e2a7"),c=a("7cb8");e.a={components:{PageContent:o.a,Scroller:s.a},mixins:[i.a],data:function(){return{show:!1,title:"",options:[],actionTabs:[],mapSelectedItems:[],selectedResult:"",optionsMap:{},statusMap:{},autoSuffix:!0,nameKeys:{"unit-floor-room":[{id:"unit",name:"unit_name",children:"floors"},{id:"floor",name:"floor_name",children:"rooms"},{name:"room_name"}],"floor-room":[{id:"floor",name:"floor_name",children:"rooms"},{name:"room_name"}],"unit-floor":[{id:"unit",name:"unit_name",children:"floors"},{id:"floor",name:"floor_name"}],floor:[{id:"floor",name:"floor_name"}]}}},computed:{selectedResultText:function(){return t.clone(this.mapSelectedItems).sort((function(t,e){return t.order-e.order})).reduce((function(t,e){return t+="、"+e.name}),"").substring(1)}},mounted:function(){window.dialogTest=this},methods:{initData:function(t){var e=this;this.actionTabs=[],this.mapSelectedItems=[],this.selectedResult="",this.options=t||[],"floor"===this.type&&this.options.floors&&(this.options=this.options[0].floors);var a=this.traversOptions(this.options);if("floor"===this.type){var i=0,o=[];for(var s in this.statusMap)this.statusMap[s].pid="allfloors",this.statusMap[s].disabled||(i+=2),o.push(s);var n=!1;0===i&&(n=!0),this.statusMap.allfloors={id:"allfloors",status:"0",total:i,countChecked:0,children:o,disabled:n}}a.forEach((function(t){e.toggleItem(t.id,!0)}))},traversOptions:function(t){var e=this,a={},i={},o=[],s=this.nameKeys[this.type],n=0;function r(t){var s=t.val,c=t.mapId,r=t.parentId,p=t.childrenKey,d=t.isChecked,u=t.isForceChecked,m=t.isDisabled;a[c]=s;var h=r?i[r].name:"",f={id:c,status:"0",order:n++,originName:s.name,disabled:m,isForceChecked:u,name:e.autoSuffix?(h+s.name).replace(/单元.*层(.)/,"单元$1"):h+s.name};if(i[c]=f,p&&(f.total=s[p]?2*s[p].filter((function(t){return!l(t)})).length:0,0===f.total&&(f.disabled=!0),f.countChecked=0),r){f.pid=r;var g=i[r];g.children||(g.children=[]),g.children.push(c)}s.status&&(f.statusText=s.status),d&&o.push(f)}function l(t){return!!(t.used||t.disabled||t.status&&!t.checked)}return function t(a){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(a)&&a.length){var n=o?o+"-":"",p=i===s.length-1;a.forEach((function(a){var d=s[i];a.name||(a.name=a[d.name]||""),a.id||(a.id=a[d.id]),e.autoSuffix&&(a.hasOwnProperty("floors")&&(a.name=Object(c.a)(a.name,"单元")),a.hasOwnProperty("rooms")&&(a.name=Object(c.a)(a.name,"层")));var u=!1;p&&l(a)&&(u=!0);var m=!1,h=!1;p&&((m=a.checked||!1)&&(h=!0),~e.selected.findIndex((function(t){return"unit-floor"===e.type?t.id===a.id&&t.unit===a.unit:t.id===a.id}))&&(h=!0));var f=n+a.id,g=d.children;r({val:a,mapId:f,parentId:o,childrenKey:g,isChecked:h,isForceChecked:m,isDisabled:u}),g&&t(a[g],i+1,f)}))}}(t),this.optionsMap=a,this.statusMap=i,o},openPopup:function(t){this.show=!0,this.title=t.title,this.selected=t.selected,this.onSelect=t.onSelect,this.rightBtn=t.rightBtn,this.type=t.type,this.rightBtnEvent=t.rightBtnEvent,this.autoSuffix=!1!==t.autoSuffix,this.initData(t.options),this.$emit("open")},closePopup:function(){this.show=!1,this.$emit("close")},_handlerItemSelected:function(t,e){if(!t.total){var a=this.mapSelectedItems.indexOf(t);e?~a&&this.mapSelectedItems.splice(a,1):~a||this.mapSelectedItems.push(t)}},toggleItem:function(t,e){var a=this,i=this.statusMap;var o=i[t];if(!e&&o.isForceChecked||o.disabled)o.statusText&&!e&&n.a.alert(o.statusText);else{var s,c=o.status;(function t(e,s){var n=i[e];n.status=s,"2"===s&&n.total?n.countChecked=n.total:n.countChecked=0,n.hasOwnProperty("children")?n.children.length&&n.children.forEach((function(e){a.optionsMap[e].checked||t(e,s)})):o.isForceChecked||n.disabled||a._handlerItemSelected(n,"0"===s)})(t,s="2"===c?"0":"2"),function t(e,a){var o=i[e].pid;if(o){var s=i[o],n=function(t,e){var a=t.status,i=t.total;t.countChecked=t.countChecked+e;var o=t.countChecked;switch(!0){case 0===o:t.status="0";break;case o<i:t.status="1";break;case o===i:t.status="2";break;default:$log.error("something is wrong on @toggleItem: current pItem's pCountChecked: ".concat(o,", pTotal: ").concat(i))}return t.status-a}(s,a);0!==n&&t(s.id,n)}}(t,s-c)}},mapStatusToClass:function(t,e){if(this.statusMap[t].disabled)return"-disabled";return["","-indeterminate","-checked"][this.statusMap[t].status]},onRightBtnEvent:function(){var e=this;if(t.isEmpty(this.mapSelectedItems)){if("room"===this.type.substr(-4))return n.a.alert("请选择房间");if("floor"===this.type.substr(-5))return n.a.alert("请选择楼层")}var a=[];this.mapSelectedItems.forEach((function(t){a.push(e.optionsMap[t.id])})),this.rightBtnEvent(a),this.show=!1}}}}).call(this,a("391c"))},b61f:function(t,e,a){"use strict";var i=a("329b"),o=a("7c9b").a,s=(a("0748"),a("17cc")),n=Object(s.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"slide-right"}},[t.show?a("page-content",{attrs:{title:t.title,mode:"dialog","on-close":t.closePopup}},[t.rightBtn?a("div",{staticClass:"header-btn",attrs:{slot:"header-bar-right"},on:{click:t.onRightBtnEvent},slot:"header-bar-right"},[t._v("\n      "+t._s(t.rightBtn)+"("+t._s(t.mapSelectedItems.length)+")\n    ")]):t._e(),a("div",{staticClass:"multiple-place-content"},[a("div",{staticClass:"selected"},[a("label",[t._v("已选:")]),a("div",{staticClass:"text"},[t._v("\n          "+t._s(t.selectedResultText)+"\n        ")])])]),a("div",{staticClass:"multiple-place-content -fixed"},[a("div",{staticClass:"selected"},[a("label",[t._v("已选:")]),a("div",{staticClass:"text"},[t._v("\n          "+t._s(t.selectedResultText)+"\n        ")])])]),a("div",{staticClass:"select-wrap"},["unit-floor-room"===t.type?a("van-collapse",{model:{value:t.actionTabs,callback:function(e){t.actionTabs=e},expression:"actionTabs"}},t._l(t.options,(function(e){return a("van-collapse-item",{key:e.id,staticClass:"section",attrs:{name:e.id}},[a("strong",{attrs:{slot:"title"},on:{click:function(a){a.stopPropagation(),t.toggleItem(e.id)}},slot:"title"},[a("icon",{attrs:{slot:"icon",name:"checkbox-square"+t.mapStatusToClass(e.id)},slot:"icon"}),t._v(t._s(e.name))],1),t._l(e[t.nameKeys[t.type][0].children],(function(i){return a("div",{key:i.id,staticClass:"group pl40 pr15  -border-bottom"},[a("div",{staticClass:"group-name"},[t._v(t._s(i.name))]),a("div",{staticClass:"element-list"},[a("div",{staticClass:"element -all",class:t.mapStatusToClass([e.id,i.id].join("-"),i),on:{click:function(a){t.toggleItem([e.id,i.id].join("-"))}}},[t._v("\n                  全选\n                ")]),t._l(i[t.nameKeys[t.type][1].children],(function(o){return a("div",{key:o.name,staticClass:"element",class:t.mapStatusToClass([e.id,i.id,o.id].join("-")),on:{click:function(a){t.toggleItem([e.id,i.id,o.id].join("-"))}}},[t._v("\n                  "+t._s(o.name)+"\n                ")])}))],2)])}))],2)}))):t._e(),"floor-room"===t.type?a("div",{staticClass:"section"},t._l(t.options,(function(e){return a("div",{key:e.id,staticClass:"group pl15 pr15"},[a("div",{staticClass:"group-name"},[t._v(t._s(e.name))]),a("div",{staticClass:"element-list"},[a("div",{staticClass:"element -all",class:t.mapStatusToClass(e.id,e),on:{click:function(a){t.toggleItem(e.id)}}},[t._v("\n              全选\n            ")]),t._l(e[t.nameKeys[t.type][0].children],(function(i){return a("div",{key:i.id,staticClass:"element mr15",class:t.mapStatusToClass([e.id,i.id].join("-")),on:{click:function(a){t.toggleItem([e.id,i.id].join("-"))}}},[t._v("\n              "+t._s(i.name)+"\n            ")])}))],2)])}))):t._e(),"floor"===t.type?a("div",{staticClass:"section"},[a("div",{staticClass:"group pl15 pr15"},[a("div",{staticClass:"group-name"},[t._v("全部")]),a("div",{staticClass:"element-list"},[a("div",{staticClass:"element mr15",class:t.mapStatusToClass("allfloors"),on:{click:function(e){t.toggleItem("allfloors")}}},[t._v("\n              全选\n            ")]),t._l(t.options,(function(e){return a("div",{key:e.name,staticClass:"element mr15",class:t.mapStatusToClass(e.id),on:{click:function(a){t.toggleItem(e.id)}}},[t._v("\n              "+t._s(e.name)+"\n            ")])}))],2)])]):t._e(),"unit-floor"===t.type?a("div",{staticClass:"section"},t._l(t.options,(function(e){return a("div",{key:e.name,staticClass:"group pl15 pr15"},[a("div",{staticClass:"group-name"},[t._v(t._s(e.name))]),a("div",{staticClass:"element-list"},[a("div",{staticClass:"element mr15",class:t.mapStatusToClass(e.id,e),on:{click:function(a){t.toggleItem(e.id)}}},[t._v("\n              全选\n            ")]),t._l(e[t.nameKeys[t.type][0].children],(function(i){return a("div",{key:i.name,staticClass:"element mr15",class:t.mapStatusToClass([e.id,i.id].join("-")),on:{click:function(a){t.toggleItem([e.id,i.id].join("-"))}}},[t._v("\n              "+t._s(i.name)+"\n            ")])}))],2)])}))):t._e(),t.options.length?t._e():a("loading-status",{attrs:{"is-empty":!0,"empty-text":"没有内容"}})],1)]):t._e()],1)}),[],!1,null,"4b9b8166",null).exports,c=!1;c||(c=new(i.default.extend(n))({el:document.createElement("div")}),document.body.appendChild(c.$el));e.a=c},c070:function(t,e,a){var i=a("574c");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("35590dcb",i,!0,{sourceMap:!1,shadowMode:!1})},f637:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .item-con input[data-v-252a794a]{width:100%;text-align:right}",""])}}]);