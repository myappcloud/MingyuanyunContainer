(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-03aa3f77"],{1493:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"a",(function(){return i}));var n={0:"自定义任务",1:"工序移交",2:"工序验收",3:"样板验收"},i={1:"ProcessNewIndex",2:"ProcessAcceptV3",3:"TempletPlan"}},"16ff":function(t,e,a){var n=a("39e4");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("801e728a",n,!0,{sourceMap:!1,shadowMode:!1})},"242a":function(t,e,a){"use strict";var n={name:"Checkbox",props:{semiSelection:{type:Boolean,default:!1},status:{type:String,default:null},value:{type:Boolean,default:!1},text:{type:String,default:""},type:{type:String,default:"circular"}},data:function(){return{}},computed:{iconName:function(){var t="";return"circular"===this.type?t=this.value?"checkbox-checked":"checkbox":"square"===this.type&&(t=this.value?"checkbox-square-checked":"checkbox-square"),t}},methods:{semiClickHandle:function(t){if(t.stopPropagation(),this.semiSelection){var e="partSelected"===this.status||!this.value,a="partSelected"===this.status||e?"fullSelected":null;this.$emit("input",e,a),this.$emit("change",e,a)}else this.$emit("input",!this.value),this.$emit("change",!this.value)}}},i=(a("53e4"),a("17cc")),r=Object(i.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:{checkbox:!t.semiSelection,semiCheckbox:t.semiSelection,"semiCheckbox-indeterminate":"partSelected"===t.status,"semiCheckbox-checked":"fullSelected"===t.status},on:{click:function(e){t.semiClickHandle(e)}}},[t.semiSelection?a("span",{staticClass:"semiCheckbox-inner"}):t._e(),t.semiSelection?t._e():a("icon",{attrs:{name:t.iconName}}),t._v(t._s(t.text)+"\n")],1)}),[],!1,null,"afcfdff2",null);e.a=r.exports},2980:function(t,e,a){"use strict";a.r(e);var n=a("8db2").a,i=(a("b8d02"),a("17cc")),r=Object(i.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-content",{attrs:{title:t.title,"show-go-root":!0}},[t.isLoading||t.isEmpty?t._e():a("scroller",[a("item",{attrs:{label:"所属计划",text:t.taskData.schedule_plan_name}}),a("item",{attrs:{label:"关联节点",text:t.taskData.schedule_plan_detail_name}}),a("item",{attrs:{label:"任务名称",text:t.taskData.name}}),a("item",{attrs:{label:"任务类型",text:t.taskType[t.taskData.task_type]}}),[1,2].includes(t.taskData.task_type)?[a("item",{attrs:{label:"关联工序",text:t.taskData.relation_biz_name}}),a("item",{attrs:{label:"关联部位",text:t.taskData.relation_biz_detail}})]:t._e(),3===t.taskData.task_type?[a("item",{attrs:{label:"关联样板计划",text:t.taskData.relation_biz_name}}),a("item",{attrs:{label:"关联样板",text:t.taskData.relation_biz_detail}})]:t._e(),a("item",{attrs:{label:"计划开始",text:t._f("formatDate")(t.taskData.start_time,"YYYY-MM-DD")}}),a("item",{attrs:{label:"计划完成",text:t._f("formatDate")(t.taskData.deadline,"YYYY-MM-DD")}}),a("div",{staticClass:"item"},[a("div",{staticClass:"item-label item-label-gray"},[t._v("实际完成")]),a("div",{staticClass:"item-text"},[t._v("\n        "+t._s(t._f("formatDate")(t.taskData.complete_time,"YYYY-MM-DD"))+"\n        "),a("span",{class:{"task-status":t.taskData.complete_time},style:{color:"未完成"===t.taskData.status&&t.currentDate>t.taskData.deadline?"#FF3C46":"#666666","padding-left":t.taskData.complete_time?"9px":"0"}},[t._v("\n          "+t._s("未完成"===t.taskData.status?t.currentDate>t.taskData.deadline?"逾期未完成":"未完成":t.taskData.complete_time>t.taskData.deadline?"逾期完成":"已完成")+"\n        ")])])]),a("user-select",{attrs:{title:"主责人",multi:!0,mode:"view",editabled:!1,required:!1},model:{value:t.taskData.in_charge_by,callback:function(e){t.$set(t.taskData,"in_charge_by",e)},expression:"taskData.in_charge_by"}}),a("user-select",{attrs:{title:"抄送人",multi:!0,mode:"view",editabled:!1,required:!1},model:{value:t.taskData.cc,callback:function(e){t.$set(t.taskData,"cc",e)},expression:"taskData.cc"}}),t._l(t.taskData.report,(function(e,n){return a("item",{key:n,attrs:{label:n?"":"进展汇报"}},[a("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[e.remark?a("p",{staticClass:"item-text"},[t._v("\n            "+t._s(e.remark)+"\n          ")]):t._e(),e.pictures&&e.pictures.length?a("item-img-list",{attrs:{editabled:!1,"online-mode":!0},model:{value:e.pictures,callback:function(a){t.$set(e,"pictures",a)},expression:"report.pictures"}}):t._e(),a("p",{staticClass:"item-text color-light report-date"},[t._v("\n            "+t._s(t.dateFormat(e.report_on,"YYYY-MM-DD HH:mm"))+"\n            "),"已完成"===e.status?a("span",{staticClass:"report-status"},[t._v("任务完成")]):t._e()])],1)])})),t.isSubmit&&0===t.taskData.task_type?[a("item",{staticClass:"photo-list border-bottom"},[a("p",{staticClass:"photo-type"},[t._v("进展汇报")]),a("item-img-list",{attrs:{maxlength:15,"online-mode":!0},model:{value:t.pictures,callback:function(e){t.pictures=e},expression:"pictures"}})],1),a("item-textarea",{staticClass:"border-none",attrs:{placeholder:"备注(必填)"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})]:t._e(),t.isSubmit&&0===t.taskData.task_type?a("checkbox",{staticClass:"p15",attrs:{text:"任务已完成",type:"square"},on:{change:t.nodeCompleteChange},model:{value:t.isComplete,callback:function(e){t.isComplete=e},expression:"isComplete"}}):t._e(),t.isSubmit&&t.isComplete?a("item",{attrs:{label:"实际完成",text:t._f("formatDate")(t.complete_time,"YYYY-MM-DD"),editabled:!0,mode:"edit"},on:{click:t.selectReportDate}}):t._e()],2),a("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.isLoading&&t.isEmpty,type:t.errorType,"empty-text":t.emptyTips||"没有报表数据"}}),t.isSubmit?a("app-button-group",{attrs:{"fixed-bottom":""}},[0===t.taskData.task_type?a("app-button",{on:{click:t.submit}},[t._v("\n      提交\n    ")]):a("app-button",{on:{click:t.goAccept}},[t._v("\n      去验收\n    ")])],1):t._e()],1)}),[],!1,null,"4b4ac540",null);e.default=r.exports},"2c76":function(t,e,a){"use strict";a("c070")},"38a7":function(t,e,a){"use strict";a("16ff")},"39e4":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .content[data-v-73ce749f]{display:flex;flex-direction:column;justify-content:flex-end;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.4);overflow:hidden}",""])},"3c64":function(t,e,a){"use strict";a("163d");var n={name:"ItemTextarea",components:{},props:{value:{type:String,default:""},placeholder:{type:String,default:""},maxlength:{type:Number,default:200},borderBottom:{type:Boolean,default:!0}},data:function(){return{textareaHeight:40,isLock:!1,blurTime:null}},computed:{lastLength:function(){var t=this.value&&this.value.length||0,e=this.maxlength-t;return e>0?e:0}},mounted:function(){var t=this;this.$nextTick((function(){t.textareaHeight=t.$refs.rule&&t.$refs.rule.offsetHeight||40}))},methods:{onfocus:function(){var t=(new Date).getTime();this.blurTime&&t-this.blurTime<300&&window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(this.$refs.input.blur(),window.cordova.plugins.Keyboard.close()),this.blurTime=null,this.$emit("focus")},onblur:function(){this.blurTime=(new Date).getTime(),this.$emit("blur")},setStatus:function(t){console.log(t),this.isLock=t},oninput:function(t){var e=this;setTimeout((function(){if(!e.isLock){var a=t.target.value;a.length>e.maxlength&&(a=a.substring(0,e.maxlength),e.$refs.input.value=a),e.$refs.rule.innerText=a,e.textareaHeight=e.$refs.rule&&e.$refs.rule.offsetHeight+20,e.$emit("input",a),e.$emit("change",a)}}),0)}}},i=(a("2c76"),a("17cc")),r=Object(i.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"item-textarea",class:{"border-bottom":t.borderBottom}},[a("div",{staticClass:"item-textarea-content"},[a("textarea",{ref:"input",style:{height:t.textareaHeight+"px"},attrs:{placeholder:t.placeholder},domProps:{value:t.value},on:{focus:t.onfocus,blur:t.onblur,compositionstart:function(e){t.setStatus(!0)},compositionend:function(e){t.setStatus(!1)},input:t.oninput}}),a("div",{ref:"rule",staticClass:"rule"},[t._v("\n      "+t._s(t.value)+"\n    ")]),t.maxlength!==1/0?a("p",{staticClass:"counter"},[t._v("\n      "+t._s(t.lastLength)+"\n    ")]):t._e()])])}),[],!1,null,null,null);e.a=r.exports},"53e4":function(t,e,a){"use strict";a("75b9")},"574c":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .item-textarea{background-color:#fff;padding:5px 15px}.zjapp .item-textarea-content{position:relative}.zjapp .item-textarea .rule,.zjapp .item-textarea textarea{width:100%;min-height:40px;line-height:20px;font-size:16px;padding:0;border:none}.zjapp .item-textarea .rule{position:absolute;top:0;left:0;visibility:hidden;word-break:break-all}.zjapp .item-textarea .counter{text-align:right;margin:0 0 -5px 0;height:15px;line-height:15px;color:#b2b2b2;font-size:12px}",""])},"70a2":function(t,e,a){var n=a("daa7");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("32e17ba4",n,!0,{sourceMap:!1,shadowMode:!1})},"75b9":function(t,e,a){var n=a("e5a0");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("417e698a",n,!0,{sourceMap:!1,shadowMode:!1})},8474:function(t,e,a){"use strict";var n=a("329b"),i=(a("ed6c"),a("591c")),r=a("e89f"),o=a("4360"),s={name:"DateSelectDialog",components:{DatetimePicker:i.a},mixins:[r.a],store:o.a,data:function(){return{show:!1,showCon:!1,date:"",type:"",min:"",max:"",confirmFn:function(){}}},watch:{show:function(t){var e=this;t&&this.$nextTick((function(){e.showCon=!0}))}},methods:{open:function(t){this.date=t.date,this.type=t.type||"datetime",this.min=t.min||void 0,this.max=t.max||void 0,this.confirmFn=t.onConfirm,this.show=!0},close:function(){this.showCon=!1},afterClose:function(){this.show=!1},onConfirm:function(t){this.confirmFn&&this.confirmFn(t),this.close()},onCancel:function(t){this.close()}}},c=(a("38a7"),a("17cc")),l=Object(c.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.show?a("div",{staticClass:"content",on:{click:function(e){return e.target!==e.currentTarget?null:t.close(e)}}},[a("transition",{attrs:{name:"slide-up"},on:{"after-leave":t.afterClose}},[t.showCon?a("van-datetime-picker",{attrs:{type:t.type,"min-date":t.min,"max-date":t.max},on:{confirm:t.onConfirm,cancel:t.onCancel},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}}):t._e()],1)],1):t._e()}),[],!1,null,"73ce749f",null).exports,u=!1;u||(u=new(n.default.extend(l))({el:document.createElement("div")}),document.body.appendChild(u.$el));e.a=u},"8db2":function(t,e,a){"use strict";(function(t){a("6a61");var n,i,r=a("2e91"),o=a("ed08"),s=a("fd50"),c=a("07d2"),l=a("6bf2"),u=a.n(l),p=a("1b7e"),d=a("e2a7"),f=a("3bd5"),m=a("774b"),h=a("cd05"),b=a("e68e"),k=a("3c64"),x=a("242a"),g=a("8474"),v=a("3122"),_=a("1493"),y=a("9cd1");e.a={name:"SchedulePlanDetailTask",components:{item:c.default,Scroller:m.default,UserSelect:h.a,ItemImgList:b.a,ItemTextarea:k.a,Checkbox:x.a},data:function(){return{isLoading:!0,taskId:"",userId:"",fromWorkbench:!1,emptyTips:"",taskData:{},errorType:"report",isEmpty:!1,pictures:[],remark:"",isComplete:!1,title:"",complete_time:"",currentDate:"",taskType:_.b}},computed:{isSubmit:function(){return!this.fromWorkbench&&this.userId===(this.taskData.in_charge_by&&this.taskData.in_charge_by.id)&&("未完成"===this.taskData.status||"逾期未完成"===this.taskData.status)},templateV2Gray:function(){return this.$store.state.global.allGrayRelease.TempletPlanV2},currentProjId:function(){return this.$store.state.global.currentProject.id}},activated:function(){this.taskId=this.$route.params.id,this.userId=f.a.getUser().user_id,this.fromWorkbench=this.$route.query.fromWorkbench||!1,this.title=this.fromWorkbench?"任务详情":"待办-任务详情",this.complete_time=u()(new Date).format("YYYY-MM-DD"),this.currentDate=u()(new Date).format("YYYY-MM-DD"),this.pictures=[],this.init()},methods:{init:(i=Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTaskData();case 2:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)}),getTaskData:function(){var e=this;return this.isLoading=!0,this.emptyTips="",this.errorType="report",this.taskData={},this.pictures=[],this.remark="",this.isComplete=!1,p.a.getHasNetwork().then((function(t){if(!t)return s.a.reject({errmsg:"网络异常，请检查"})})).then((function(){return Object(y.h)({task_id:e.taskId||""}).then((function(a){e.taskData=a,t.isEmpty(e.taskData)?(e.emptyTips="没有报表数据",e.isEmpty=!0):e.isEmpty=!1,t.isEmpty(e.taskData.report)||t.each(e.taskData.report,(function(t){t.pictures=JSON.parse(t.pictures)})),e.isLoading=!1}))})).catch((function(t){e.errorType="error",e.emptyTips=t.errmsg||"获取数据失败",e.isEmpty=!0,e.isLoading=!1}))},selectReportDate:function(){var t=this;g.a.open({date:u()(this.complete_time).toDate(),type:"date",min:"",max:u()(new Date).toDate(),onConfirm:function(e){var a=u()(e).format("YYYY-MM-DD");t.complete_time=a}})},submit:function(){var e=this;return p.a.getHasNetwork().then((function(t){if(!t)return s.a.reject({errmsg:"网络异常，请检查"})})).then((function(){var a=[];return t.each(e.pictures,(function(t){!t.url&&t.temp?a.push(v.a.uploadImage(t.temp).then((function(e){t.url=e,delete t.temp}))):delete t.temp,!t.video_url&&t.videoTemp?a.push(v.a.uploadImage(t.videoTemp).then((function(e){t.video_url=e,delete t.videoTemp}))):delete t.videoTemp})),s.a.all(a).then((function(){var a=[];t.each(e.pictures,(function(t){a.push({id:t.id,url:t.url,videoUrl:t.video_url||""})})),e.pictures=a}))})).then((function(){if(""!==e.remark)return Object(y.m)({task_id:e.taskId,pictures:JSON.stringify(e.pictures),remark:e.remark,is_complete:e.isComplete?1:0,complete_time:e.complete_time}).then((function(t){if(t.errmsg)return s.a.reject({errmsg:t.errmsg});e.init()}));d.a.alert("备注必填")})).catch((function(t){d.a.alert(t.errmsg||"获取数据失败")}))},dateFormat:function(t,e){return u()(t).format(e)},nodeCompleteChange:function(t){this.isComplete=t},goAccept:function(){var t=this.taskData,e=t.proj_id,a=t.task_type;if(this.templateV2Gray&&(_.a[3]="TempletPlanV2"),this.currentProjId!==e)return this.downloadProjectData(e,_.a[a]);this.$router.push({name:_.a[a]})},downloadProjectData:(n=Object(r.a)(regeneratorRuntime.mark((function t(e,n){var i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve().then(a.bind(null,"37d5"));case 2:return i=t.sent.default,t.next=5,i.getProject(e);case 5:if(!((r=t.sent)&&r.expire_time&&r.expire_time<=o.a.now())){t.next=8;break}return t.abrupt("return",s.a.reject("该项目租期已过"));case 8:this.$store.commit("global/SET_CURRENT_PROJECT",r),this.$router.push({name:n});case 10:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})}}}).call(this,a("391c"))},"9cd1":function(t,e,a){"use strict";a.d(e,"h",(function(){return o})),a.d(e,"m",(function(){return s})),a.d(e,"g",(function(){return c})),a.d(e,"f",(function(){return l})),a.d(e,"d",(function(){return u})),a.d(e,"l",(function(){return p})),a.d(e,"k",(function(){return d})),a.d(e,"j",(function(){return f})),a.d(e,"b",(function(){return m})),a.d(e,"e",(function(){return h})),a.d(e,"c",(function(){return b})),a.d(e,"i",(function(){return k})),a.d(e,"a",(function(){return x}));var n=a("5e8d"),i=a("162a"),r=a("bcc78");function o(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanTaskInfo.url;return i.a.request(e,t)}))}function s(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanSaveTask.url;return i.a.post(e,null,t)}))}function c(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanPlanList.url;return i.a.request(e,t)}))}function l(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanNodeList.url;return i.a.request(e,t)}))}function u(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanNodeInfo.url;return i.a.request(e,t)}))}function p(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanSaveReport.url;return i.a.post(e,null,t)}))}function d(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanSaveCompleteTime.url;return i.a.post(e,null,t)}))}function f(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanSaveChecker.url;return i.a.post(e,null,t)}))}function m(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanCheckerLogList.url;return i.a.request(e,t)}))}function h(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanNodeLevel.url;return i.a.request(e,t)}))}function b(){return Object(n.a)().then((function(){var t=r.a.schedulePlanCompletedTimeSetting.url;return i.a.request(t)}))}function k(){return Object(n.a)().then((function(){var t=r.a.schedulePlanLeaderSchedulePlan.url;return i.a.request(t)}))}function x(t){return Object(n.a)().then((function(){var e=r.a.schedulePlanGetByFirstProject.url;return i.a.request(e,t)}))}},b8d02:function(t,e,a){"use strict";a("70a2")},c070:function(t,e,a){var n=a("574c");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("35590dcb",n,!0,{sourceMap:!1,shadowMode:!1})},daa7:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .photo-list[data-v-4b4ac540]{flex-direction:column;padding-bottom:15px;background-color:#fff}.zjapp .photo-type[data-v-4b4ac540]{margin-top:7px;margin-bottom:15px;font-size:16px}.zjapp .report-date[data-v-4b4ac540]{font-size:14px}.zjapp .report-status[data-v-4b4ac540]{color:#0bc666;font-size:12px}.zjapp .task-status[data-v-4b4ac540]{font-size:12px}",""])},e5a0:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .checkbox[data-v-afcfdff2]{font-size:14px;line-height:20px}.zjapp .icon[data-v-afcfdff2]{vertical-align:top;margin-top:1px;margin-right:7px}.zjapp .semiCheckbox[data-v-afcfdff2]{font-family:Chinese Quote,-apple-system,BlinkMacSystemFont,Segoe UI,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Helvetica Neue,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:14px;font-variant:tabular-nums;line-height:1.5;color:rgba(0,0,0,.65);box-sizing:border-box;margin:0;padding:0;list-style:none;white-space:nowrap;cursor:pointer;outline:none;display:inline-block;line-height:1;position:relative;vertical-align:middle}.zjapp .semiCheckbox-inner[data-v-afcfdff2]{position:relative;top:0;left:0;display:block;width:18px;height:18px;border:1px solid #d9d9d9;border-radius:2px;background-color:#fff;transition:all .3s}.zjapp .semiCheckbox-indeterminate .semiCheckbox-inner[data-v-afcfdff2]:after{content:" ";transform:translate(-50%,-50%) scale(1);border:0;left:50%;top:50%;width:8px;height:8px;background-color:#4275e8;opacity:1}.zjapp .semiCheckbox-inner[data-v-afcfdff2]:after{transform:rotate(45deg) scale(0);position:absolute;left:5.57142857px;top:2.14285714px;display:table;width:5.71428571px;height:9.14285714px;border:2px solid #fff;border-top:0;border-left:0;content:" ";transition:all .1s cubic-bezier(.71,-.46,.88,.6),opacity .1s;opacity:0}.zjapp .semiCheckbox-checked .semiCheckbox-inner[data-v-afcfdff2]{background-color:#4275e8;border-color:#4275e8}.zjapp .semiCheckbox-checked .semiCheckbox-inner[data-v-afcfdff2]:after{transform:rotate(45deg) scale(1);position:absolute;display:table;border:2px solid #fff;border-top:0;border-left:0;content:" ";transition:opacity .2s cubic-bezier(.12,.4,.29,1.46) .1s;opacity:1}',""])}}]);