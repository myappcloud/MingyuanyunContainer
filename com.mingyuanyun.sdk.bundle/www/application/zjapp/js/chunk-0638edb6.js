(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-0638edb6","chunk-739f37c8"],{"31fc":function(t,e,i){var n=i("701f");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,i("85cb").default)("27785a6a",n,!0,{sourceMap:!1,shadowMode:!1})},"47c0":function(t,e,i){"use strict";i.r(e);i("9a33");var n=i("4360"),o=i("774b"),a=i("f97c"),s=i("1b7e"),r=i("e2a7"),l=i("f3a3"),c={name:"Inventory",components:{Scroller:o.default},data:function(){return{list:[],stauts:{"已关闭":"color-999","暂无进场记录":"color-999"},loading:!1,finished:!1,page:1,page_size:15,isDraftLoading:!1,scrollBur:!1}},computed:{},watch:{list:function(){var t=this;this.scrollBur&&this.$nextTick((function(){t.rollingHistoryScroll(),t.scrollBur=!1}))}},activated:function(){var t=this;this.isDraftLoading=!0,this.finished=!1,this.page=1,this.list=[],this.proj_id=a.a.getDefaultProject().id,this.getHasNetwork(1).then((function(){t.$router.isBack&&t.$nextTick((function(){t.rollingHistoryScroll()}))}))},methods:{onRefresh:function(t){var e=this;this.page=1,this.getList(2).then((function(i){"function"==typeof t&&t(!1),e.finished=i})).catch((function(){"function"==typeof t&&t(!1)}))},onloadUp:function(){return this.page+=1,this.getList(3)},getList:function(t){var e=this,i=this.$router.isBack?n.a.state.inventory.historyScroll.page:1,o=this.page_size*i,a={proj_id:this.proj_id,page:this.page,page_size:o};return Object(l.c)(a).then((function(i){switch(t){case 1:e.scrollBur=!0,e.list=i.result,e.isDraftLoading=!1;break;case 2:e.list=i.result,e.isLoading=!1;break;case 3:e.list=e.list.concat(i.result),e.loading=!1}return i.has_next_page&&0!==i.result.length||(e.finished=!0),!i.has_next_page})).catch((function(t){e.isDraftLoading=!1,e.finished=!0,$log.error("材料盘点列表error：",t)}))},getHasNetwork:function(t){var e=this;return s.a.getHasNetwork().then((function(i){return i?e.getList(t):(e.$toast("当前无网络！"),e.isDraftLoading=!1,Promise.resolve())}))},history:function(t,e){this.$router.push({name:"InventoryHistory",query:{id:t.id}}),this.scrollTop(e),n.a.commit("inventory/SET_HISTORYTITLE",t.material_name)},startCounting:function(t,e){if(t.is_closed)this.$toast("该材料盘点任务已关闭，无需盘点");else switch(t.status){case 1:this.scrollTop(e),n.a.commit("inventory/SET_ADD",t),n.a.commit("inventory/SET_STATUS",!0),this.$router.push({name:"InventoryAdd"});break;case 2:this.$toast("该材料已盘点");break;case 3:this.$toast("还没到下次盘点时间")}},onSwitchInput:function(t,e){var i=this,n={id:t.id,proj_id:this.proj_id,is_closed:t.is_closed?0:1};t.is_closed?r.a.confirm({message:"确定开启此材料的盘点功能？",okText:"确定开启",cancelText:"取消"}).then((function(e){e&&Object(l.d)(n).then((function(e){i.$set(t,"is_closed",0)})).catch((function(t){$log.error("开启材料盘点error：",t)}))})):r.a.confirm({message:"若项目上已停用或未使用此类材料，您可以关闭此材料的盘点功能，确定关闭吗?",okText:"确认关闭",cancelText:"取消"}).then((function(e){e&&Object(l.d)(n).then((function(e){i.$set(t,"is_closed",1)})).catch((function(t){$log.error("开启材料盘点error：",t)}))}))},nextInventory:function(t){if(t.is_closed)return"--";switch(t.status){case 1:return"今天";case 2:return"明日刷新";case 3:var e=t.end_date.split("-");return e[1]+"-"+e[2]}},rollingHistoryScroll:function(){var t=n.a.state.inventory.historyScroll.scroll;this.$refs.scroller.setScrollTop(t)},scrollTop:function(t){if(this.$refs.scroller){var e=this.$refs.scroller.getScrollTop(),i=Math.ceil(t/this.page_size)||1;n.a.commit("inventory/SET_HISTORSCROLL",{scroll:e,page:i})}}}},u=(i("f752"),i("17cc")),p=Object(u.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("page-content",{attrs:{title:"材料盘点"}},[i("div",{staticClass:"inventory-list"},[i("scroller",{ref:"scroller",attrs:{"has-next":!t.finished,"is-empty":!t.list.length,"end-text":"就这么多了","memory-scroll-top":!1},on:{pullDown:t.onRefresh,loadNext:t.onloadUp}},[t._l(t.list,(function(e,n){return i("div",{key:e.id,class:{"list-item":!0,active:e.is_closed}},[i("div",{staticClass:"item-title"},[t._v("\n          "+t._s(e.material_name)+"\n          "),i("i",{staticClass:"list-i"}),i("van-switch",{staticClass:"list-switch",attrs:{value:!e.is_closed,size:"22px","active-color":"#549CFF","inactive-color":"#E5E5EA"},on:{input:function(i){t.onSwitchInput(e,n)}}})],1),i("div",{staticClass:"item-main"},[i("div",{staticClass:"item-main-detail"},[i("p",[t._v("盘点周期："+t._s(e.inventory_cycle))]),i("p",[t._v("下次盘点："+t._s(t.nextInventory(e)))])]),i("div",{staticClass:"item-main-button"},[i("div",{staticClass:"item-button-lishi",on:{click:function(i){t.history(e,n)}}},[i("icon",{attrs:{name:"lishi"}}),t._v("\n              历史\n            ")],1),i("div",{class:{"item-button-pandian":!0,active:1===e.status&&!e.is_closed},on:{click:function(i){t.startCounting(e,n)}}},[t._v("\n              "+t._s(1===e.status?"开始盘点":2===e.status?"已盘点":"开始盘点")+"\n            ")])])]),t.list.length-1!==n?i("div",{staticClass:"item-bottom"}):t._e()])})),i("loading-status",{attrs:{"is-loading":t.isDraftLoading,"is-empty":!t.list.length,"empty-text":"暂无材料盘点"}})],2)],1)])}),[],!1,null,"fc832c36",null);e.default=p.exports},"701f":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,'.zjapp .inventory-list[data-v-fc832c36]{height:100%;background:#f4f4f4;display:flex;flex-direction:column;flex:1}.zjapp .inventory-list .color-999[data-v-fc832c36]{color:#999}.zjapp .inventory-list .van-pull-refresh[data-v-fc832c36]{min-height:100%}.zjapp .inventory-list .item-title[data-v-fc832c36]{min-height:46px;width:100%;position:relative;padding:12px 22% 10px 4%;border-bottom:1px solid #ececec;color:#333;font-weight:600;font-size:16px}.zjapp .inventory-list .list-i[data-v-fc832c36]{position:absolute;top:15px;left:0;background:#4275e8;width:4px;height:16px;display:inline-block}.zjapp .inventory-list .list-switch[data-v-fc832c36]{position:absolute;top:11px;right:15px}.zjapp .inventory-list .item-main[data-v-fc832c36]{padding:15px 4%;display:flex;justify-content:space-between;align-items:center;font-size:14px}.zjapp .inventory-list .item-main-detail[data-v-fc832c36]{color:#666;margin-right:5px;line-height:16px}.zjapp .inventory-list .item-main-detail p[data-v-fc832c36]:first-child{margin-bottom:10px}.zjapp .inventory-list .item-main-button[data-v-fc832c36]{display:flex;align-items:center}.zjapp .inventory-list .item-button-lishi[data-v-fc832c36]{margin-right:40px;color:#6b7ba9;min-width:48px}.zjapp .inventory-list .item-button-pandian[data-v-fc832c36]{width:80px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:28px;text-align:center;color:#999;border:1px solid #dcdcdc}.zjapp .inventory-list .item-button-pandian.active[data-v-fc832c36]{color:#fff;border:none;background:linear-gradient(90deg,#55abff,#4c7aff)}.zjapp .inventory-list .item-bottom[data-v-fc832c36]{height:9px;width:100%;background:#f4f4f4}.zjapp .inventory-list .list-item[data-v-fc832c36]{background:#fff}.zjapp .inventory-list .list-item.active .item-title[data-v-fc832c36]{color:#666}.zjapp .inventory-list .list-item.active .item-main-detail[data-v-fc832c36]{color:#999}.zjapp .inventory-list[data-v-fc832c36] .van-list__finished-text{color:#c8c8c8;background:#f4f4f4;position:relative;line-height:76px;height:76px}.zjapp .inventory-list[data-v-fc832c36] .van-list__finished-text:after,.zjapp .inventory-list[data-v-fc832c36] .van-list__finished-text:before{content:"";position:absolute;width:48px;height:1px;background:#e4e4e4;top:50%;margin-top:-1px}.zjapp .inventory-list[data-v-fc832c36] .van-list__finished-text:after{left:50%;transform:translateX(-92px)}.zjapp .inventory-list[data-v-fc832c36] .van-list__finished-text:before{right:50%;transform:translateX(90px)}',""])},"774b":function(t,e,i){"use strict";i.r(e);var n=i("d18d").a,o=(i("b225"),i("17cc")),a=Object(o.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"scroll-warp",staticClass:"scroll-warp",class:{"scroll-warp-pulling":t.pulling,"scroll-warp-complete":!t.hasNext&&!t.isEmpty,"scroll-warp-empty":t.isEmpty},style:{"padding-bottom":t.numberKeyboardCoverHeight+"px"},on:{scroll:t.onScroll,touchstart:t.onTouchstart,touchmove:t.onTouchmove,touchend:t.onTouchend}},[t.allowPullDown?i("div",{staticClass:"pull-refresh-warp",style:{height:t.pullDist+"px"}},[i("div",{staticClass:"pull-refresh"},[i("div",{staticClass:"animation-refresher",class:{refreshing:t.refreshing}}),t.updateTime?i("p",{staticClass:"pull-refresh-date"},[t._v("最后成功同步："+t._s(t.updateTime))]):t._e()])]):t._e(),t._t("default"),t.loading?i("div",{staticClass:"page-loading"},[i("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[i("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]):t._e(),t.hasNext||t.isEmpty?t._e():[t.$slots.end?t._t("end"):t._e(),!t.$slots.end&&t.endText?i("div",{staticClass:"end-text"},[t._v("\n      "+t._s(t.endText)+"\n    ")]):t._e()]],2)}),[],!1,null,"2b1a346c",null);e.default=a.exports},"9d55":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,'.zjapp .scroll-warp[data-v-2b1a346c]{flex:1;overflow:auto;-webkit-overflow-scrolling:touch}.zjapp .scroll-warp-pulling[data-v-2b1a346c]{overflow:hidden}.zjapp .scroll-warp-complete[data-v-2b1a346c]:after{content:"";display:block;height:100px}.zjapp .scroll-warp-empty[data-v-2b1a346c]{display:flex;flex-direction:column}.zjapp .pull-refresh-warp[data-v-2b1a346c]{position:relative;height:0;overflow:hidden}.zjapp .pull-refresh[data-v-2b1a346c]{position:absolute;left:0;bottom:0;height:70px;width:100%;padding:6px;text-align:center}.zjapp .pull-refresh-date[data-v-2b1a346c]{margin-top:4px;height:16px;line-height:16px;font-size:12px;color:#bcbcbc}.zjapp .page-loading[data-v-2b1a346c]{padding:10px;text-align:center}.zjapp .end-text[data-v-2b1a346c]{color:#c8c8c8;background:#f4f4f4;position:relative;line-height:76px;height:76px;text-align:center}.zjapp .end-text[data-v-2b1a346c]:after,.zjapp .end-text[data-v-2b1a346c]:before{content:"";position:absolute;width:48px;height:1px;background:#e4e4e4;top:50%;margin-top:-1px}.zjapp .end-text[data-v-2b1a346c]:after{left:50%;transform:translateX(-92px)}.zjapp .end-text[data-v-2b1a346c]:before{right:50%;transform:translateX(90px)}.zjapp .end-slot[data-v-2b1a346c]{padding:30px;line-height:18px;text-align:center;color:#c8c8c8}',""])},b225:function(t,e,i){"use strict";i("ef48")},d18d:function(t,e,i){"use strict";(function(t){i("2b45");var n,o=i("4360"),a=i("48f4"),s=i("162a"),r=i("e2a7"),l=i("a500"),c=i("6f9e"),u={};e.a={name:"Scroller",props:{buildingId:{type:String,default:""},hasNext:{type:Boolean,default:!1},isEmpty:{type:Boolean,default:!1},isSync:{type:Boolean,default:!0},endText:{type:String,default:""},memoryScrollTop:{type:Boolean,default:!0},keepScrollTop:{type:Boolean},hasPullDown:{type:Boolean,default:!0},onPullDown:{type:Function}},data:function(){return{pullDist:0,refreshing:!1,pulling:!1,loading:!1,scrollTop:0,isCurrKeyboard:!1,gapBottom:0}},computed:{allowPullDown:function(){return this.hasPullDown&&(!!this.$listeners.pullDown||!!this.onPullDown)},updateTime:function(){return o.a.state.global.businessDownloadTime},numberKeyboardCoverHeight:function(){return o.a.state.global.isNumberInputOpen?o.a.state.global.numberKeyboardHeight-this.gapBottom:0}},mounted:function(){var t=this;c.a.$on("numberKeyboardOpen",this.onNumberKeyboardOpen),this.$nextTick((function(){var e=t.$refs["scroll-warp"]&&t.$refs["scroll-warp"].getBoundingClientRect&&t.$refs["scroll-warp"].getBoundingClientRect();e&&(t.gapBottom=document.documentElement.clientHeight-e.bottom),t.$el&&t.$el.addEventListener("focus",(function(e){var i=e&&e.target,n=i&&i.tagName&&i.tagName.toLowerCase();if("input"===n||"textarea"===n){window.addEventListener("resize",(function e(){var n=i.getBoundingClientRect(),o=t.$el.getBoundingClientRect(),a=n.bottom-o.bottom;a>0&&t.scrollBy(a),window.removeEventListener("resize",e,!1)}),!1)}}),!0)}))},destroyed:function(){c.a.$off("numberKeyboardOpen",this.onNumberKeyboardOpen)},activated:function(){var t=this.keepScrollTop||this.$router.isBack&&this.memoryScrollTop;this.scrollTop&&t&&(this.$refs["scroll-warp"].scrollTop=this.scrollTop)},deactivated:function(){this.memoryScrollTop&&(this.scrollTop=this.$refs["scroll-warp"].scrollTop)},methods:{onScroll:function(t){var e=this,i=this.$refs["scroll-warp"].scrollTop,n=this.$refs["scroll-warp"].scrollHeight;if(i+this.$refs["scroll-warp"].clientHeight>=n-5&&!this.loading&&this.hasNext){this.loading=!0;var o=this.$listeners.loadNext();o&&o.then&&"function"==typeof o.then?o.then((function(){e.loading=!1})):this.loading=!1}this.$emit("scroll",t)},getTouchDiretion:function(t){if(!(u&&t&&t.touches&&t.touches[0]))return"";var e=t.touches[0].clientX,i=t.touches[0].clientY;return Math.abs(i-u.y)>Math.abs(e-u.x)&&Math.abs(i-u.y)>=3?i>u.y?"down":"up":""},onTouchstart:function(t){this.allowPullDown&&t.touches&&1===t.touches.length&&(u={x:t.touches[0].clientX,y:t.touches[0].clientY,scrollTop:this.$refs["scroll-warp"].scrollTop,pullDist:this.pullDist})},onTouchmove:function(t){if(this.allowPullDown&&t.touches&&1===t.touches.length){var e=this.$refs["scroll-warp"].scrollTop,i=t.touches[0].clientY,n=i-u.y,o=this.getTouchDiretion(t);"down"===o?!this.refreshing&&e<=0?(this.pulling=!0,this.pullDist=(n-u.scrollTop)/2,t.preventDefault()):this.pulling=!1:"up"===o?this.pullDist>0&&(this.pullDist=u.pullDist-(u.y-i),t.preventDefault()):this.pullDist=u.pullDist}},onTouchend:function(){var t=this;this.allowPullDown&&(u={},this.pulling=!1,this.pullDist>=70&&this.isSync?this.refreshing?this.makePullTo(70):this.makePullTo(70).then((function(){if(t.refreshing=!0,t.onPullDown){var e=t.onPullDown();e&&e.then&&"function"==typeof e?e.finally((function(){t.refreshing=!1,t.makePullTo(0)})):(t.refreshing=!1,t.makePullTo(0))}else t.dataSync().then((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")})).catch((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")}))})):(this.refreshing=!1,this.makePullTo(0)))},makePullTo:function(t){var e=this,i=this.pullDist,n=t,o=n-i,a=i;return i===n?Promise.resolve():new Promise((function(t){!function s(){window.requestAnimationFrame((function(){a+=o/6,e.pullDist=a,i<n&&a<n||i>n&&a>n?s():(e.pullDist=n,e.refreshing=!1,t())}))}()}))},dataSync:function(){var t,e=a.default.getCurrentModuleCode(),i=a.default.getCurrentRoute(),n=i.meta&&i.meta.isTodo;if(a.default.isModuleNeedBuilding(e)&&!n){if(!this.buildingId)return new Promise((function(t){setTimeout((function(){t()}),500)}));t=this.buildingId}return l.a.addTrack("公共-手动下拉刷新","",""),s.a.beginManualUpdate(),a.default.checkSync(t).then((function(t){return s.a.endManualUpdate(),t})).catch((function(t){$log.error("下拉刷新错误",t),t&&"Error: Network Error"===t.toString()?r.a.alert("当前网络无法同步数据"):r.a.alert(t),s.a.endManualUpdate()}))},getScrollHeight:function(){return this.$refs["scroll-warp"].offsetHeight},getScrollTop:function(){return this.$refs["scroll-warp"].scrollTop},setScrollTop:function(t){this.$refs["scroll-warp"].scrollTop=t},scrollBy:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,o=this.getScrollTop(),a=o+t,s=Math.round(i/16.7),r=t/s,l=o,c=n=+new Date;return o===a?Promise.resolve():new Promise((function(t){!function i(){window.requestAnimationFrame((function(){c===n&&(l+=r,e.$refs["scroll-warp"].scrollTop=l,o<a&&l<a||o>a&&l>a?i():(e.$refs["scroll-warp"].scrollTop=a,t()))}))}()}))},scrollTo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,i=this.getScrollTop(),n=t-i;return this.scrollBy(n,e)},scrollToEle:function(t){var e=t.keyboardHeight||232,i=(t=t.$el?t.$el:t).getBoundingClientRect(),n=this.$refs["scroll-warp"].getBoundingClientRect();if(i&&n){var a=document.documentElement.clientHeight-(o.a.state.global.isNumberInputOpen?e:0),s=n.bottom<a?n.bottom:a,r=n.top-i.top,l=i.bottom-s;r>0?this.scrollBy(-r-10):l>0&&this.scrollBy(l+10)}},isCurrent:function(e,i){var n=this;e.length&&t.each(e,(function(t){t._uid===i?n.isCurrKeyboard=!0:n.isCurrent(t.$children,i)}))},onNumberKeyboardOpen:function(t){this.isCurrKeyboard=!1,this.isCurrent(this.$children,t._uid),this.isCurrKeyboard&&this.scrollToEle(t)}}}}).call(this,i("391c"))},ef48:function(t,e,i){var n=i("9d55");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,i("85cb").default)("a1a65c0c",n,!0,{sourceMap:!1,shadowMode:!1})},f3a3:function(t,e,i){"use strict";i.d(e,"c",(function(){return o})),i.d(e,"e",(function(){return a})),i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return r})),i.d(e,"d",(function(){return l}));var n=i("162a");function o(t){return n.a.request("/online/material-inventory/list",t)}function a(t){return n.a.post("/online/material-inventory/save-data",null,t)}function s(t){return n.a.request("/online/material-inventory/history",t)}function r(t){return n.a.request("/online/material-inventory/detail",t)}function l(t){return n.a.post("/online/material-inventory/change-status",null,t)}},f752:function(t,e,i){"use strict";i("31fc")}}]);