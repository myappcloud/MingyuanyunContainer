(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["report-iframe"],{"0c09":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return o}));var n="QA",o="ES"},1484:function(e,t,r){"use strict";r("f001")},1576:function(e,t,r){"use strict";r("455c")},"379d3":function(e,t,r){(e.exports=r("690e")(!1)).push([e.i,".zjapp .show-dmp[data-v-7f2a0f6c]{width:100%;height:100%;border:none}",""])},"455c":function(e,t,r){var n=r("379d3");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,r("85cb").default)("55e01751",n,!0,{sourceMap:!1,shadowMode:!1})},4971:function(e,t,r){(e.exports=r("690e")(!1)).push([e.i,".zjapp .report-template-plan{width:1px;min-width:100%;*width:100%;box-sizing:border-box;flex:1}",""])},"4c28":function(e,t,r){"use strict";r.r(t);r("5ab2"),r("6d57"),r("e10e"),r("f548");var n=r("28f8"),o=r("3bd5"),i=(r("162a"),r("4ad6"),r("e2a7"),r("1b7e")),a=r("04f3"),s=r("7f43"),c=r.n(s);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var p=null,u={name:"ReportCommonIframe",data:function(){return{isLoading:!0,noNetwork:!1,h5Site:"",url:"",title:"",isDmp:!1,historyLength:0}},computed:{parameter:function(){var e=this.$route.query.parameter;return e||{}},projectSelected:function(){return this.$store.state.global.currentReportProject}},activated:function(){var e=this;this.url="",this.isDmp=!1,this.title=this.$route.query.title,this.historyLength=history.length,this.noNetwork=!1,this.isLoading=!1,i.a.getHasNetwork().then((function(t){t||(e.isLoading=!1,e.noNetwork=!0)}));var t=this.$route.query.url,r=(o.a.getUser().tenant_code,o.a.getUser().user_id,o.a.getUser().access_token);if(p=Object(a.a)(this.onClose),t.indexOf("https://bigdata")>-1&&t.indexOf(".myyscm.com/dmp/")>-1){this.isDmp=!0,this.isLoading=!0;var s=c.a.create(),u=t.indexOf("?")>-1?"&":"?",l=t;if(-1!==this.projectSelected.id){var m={company:"company_id",project:"proj_id",group:"group_id"}[this.projectSelected.label];l=t+u+this.objTransferString(Object(n.a)({},m,this.projectSelected.id))}var h=window.__YL_SUPER_APP__?{super_app_token:o.a.getToken()}:{token:r};s.post(l,h).then((function(t){setTimeout((function(){e.isLoading=!1}),500),e.url=t.data.url}))}else{var f=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({access_token:r},this.parameter);-1!==this.projectSelected.id&&(f.proj_id=this.projectSelected.id);var g=this.$route.query.url.indexOf("?")>-1?"&":"?";this.url=this.$route.query.url+g+this.objTransferString(f),this.isLoading=!0,setTimeout((function(){e.isLoading=!1}),500)}},deactivated:function(){this.url="",p&&Object(a.c)(p)},methods:{toReportIndex:function(){!0===window.__YL_SUPER_APP__?this.$router.replace({name:"ReportIndexSuper"},!0):this.$router.replace({name:"Report"},!0)},messageSend:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){var r=document.getElementById("reportCommonIframe");r&&r.contentWindow.postMessage({type:e,data:t},"*")}},objTransferString:function(e){var t="";for(var r in e)t+="&".concat(r,"=").concat(e[r]);return t=t.slice(1)},onClose:function(){var e=Math.max(history.length-this.historyLength+1,1);this.$router.go(-e)}}},l=(r("a0b2"),r("17cc")),m=Object(l.a)(u,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("page-content",{staticClass:"is-keyboard-open",attrs:{title:e.title,"on-close":e.onClose}},[e.url?r("iframe",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading&&!e.noNetwork,expression:"!isLoading && !noNetwork"}],staticClass:"report-template-plan",attrs:{id:"reportCommonIframe",src:e.url,width:"100%",frameborder:"0",marginwidth:"0",marginheight:"0",scrolling:"no",name:"reportCommonIframe"}}):e._e(),r("loading-status",{attrs:{"is-loading":e.isLoading,"is-empty":e.noNetwork,"empty-text":"当前无网络连接"}})],1)}),[],!1,null,null,null);t.default=m.exports},"972e":function(e,t,r){var n=r("c7ab");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,r("85cb").default)("4eeed00b",n,!0,{sourceMap:!1,shadowMode:!1})},a0b2:function(e,t,r){"use strict";r("972e")},c7ab:function(e,t,r){(e.exports=r("690e")(!1)).push([e.i,".zjapp .report-template-plan{width:1px;min-width:100%;*width:100%;box-sizing:border-box;flex:1}",""])},c90f:function(e,t,r){"use strict";r.r(t);r("f548"),r("c04d");var n,o,i=r("f585"),a=(r("6a61"),r("2e91")),s=(r("7f43"),r("3094")),c=r("162a"),d=r("3bd5"),p=r("4ad6"),u={name:"ReportCommonDMPIndex",data:function(){return{title:"...",src:"",isLoading:!1,token:"",url:""}},created:function(){this.iframeMessage()},activated:function(){var e=this.$route.query,t=e.title,r=e.params,n=e.biz_code,o=e.code;n&&o&&(r={biz_code:n,code:o}),console.log("获取参数",r);var i="https://bigdata.myyscm.com/dmp/yfw/access-auth?";"dist"!==APP_ENV&&(i="https://bigdata-test.myyscm.com/dmp/yfw/access-auth?",r.biz_code_test&&(r.biz_code=r.biz_code_test,delete r.biz_code_test)),this.title=t,this.url=i+this.objTransferString(r),$log.log("报表-公共DMP-跳转",{url:this.url,"参数":r}),this.init()},methods:{init:(o=Object(a.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.src="",this.isLoading=!0,e.next=4,this.load().catch((function(e){t.src="",Object(i.a)(e)}));case 4:e.sent,this.isLoading=!1;case 6:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)}),load:(n=Object(a.a)(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="","dist"===APP_ENV){e.next=7;break}return e.next=4,this.login();case 4:t=e.sent,e.next=8;break;case 7:t=d.a.getUser().access_token;case 8:return $log.log("报表-公共DMP",{token:t,"APP环境":APP_ENV}),r=window.__YL_SUPER_APP__?{super_app_token:d.a.getToken()}:{token:t},e.next=12,this.getUrl(r);case 12:return n=e.sent,this.src=n,$log.log("报表-公共DMP-DMP的路径：",n),e.abrupt("return",this.loadIDmpResource());case 16:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),login:function(){var e=this.$route.query.params.code,t={tenant_code:e,account:e,pwd:"123",pwd_enc:s.a.encrypt("123","O57DLSOV0MJY81Q8","CBC","XFJMJJ924Y4L2PG9"),device_id:window.device&&window.device.uuid||"",application_code:"MobileCheckQuality"};return c.a.post("/common/proxy",null,{url:"https://appzj-test.myyscm.com/common/login?o=".concat(e,"&is_wifi=1&app_version=3.1.5393&platform=Android&applicationId=undefined&deviceToken=undefined&manufacturer=undefined&pushChannel=undefined&access_token="),data:JSON.stringify(t)}).then((function(e){return $log.log("报表-公共DMP-开发+测试环境登录传递参数",Object.assign({},t,{pwd:"重置","返回的数据":e})),e&&!e.errcode?e.access_token:Promise.reject(e.errmsg)}))},getUrl:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c.a.post("/common/proxy",{},{url:this.url,data:JSON.stringify(JSON.stringify(e)),header:["Content-Type: application/json"]}).then((function(e){return $log.log("报表-公共DMP-common/proxy-返回数据",e),e&&!e.errcode?e.url:Promise.reject(e.errmsg)}))},loadIDmpResource:function(){var e=this;return new Promise((function(t,r){setTimeout((function(n){e.$refs.dmp.onload=function(){$log.log("报表-公共DMP-url资源加载成功"),t()},e.$refs.dmp.onerror=function(){console.log(""),$log.log("报表-公共DMP-url资源加载失败"),r()}}),0)}))},iframeMessage:function(){this.removeAllHandlers("message",window._eventHandlers),window._eventHandlers=[],window._eventHandlers.push(this.messageDealWith),window.addEventListener("message",this.messageDealWith,!1)},removeAllHandlers:function(e,t){for(var r in t)window.removeEventListener(e,t[r])},messageDealWith:function(e){var t=this,r=e.data||{};if($log.log("报表-公共DMP-是否重新加载iframe：",{type:e.type,data:e.data}),e&&"message"===e.type&&"token-timeout"===e.data)return this.init().catch((function(e){t.src="",Object(i.a)(e)}));if(e&&"report-common-view-larger-image"===r.type){var n=r.data,o=n.list,a=n.index;this.viewLargerImage(o,a)}else e&&"report-common-ask-parent-windows-is-app"===r.type?this.messageSend("report-common-parent-windows-is-app",{parentWindowIsApp:!0}):e&&"report-common-login-failure"===r.type&&(Popup.alert("登陆失效，重新进入"),this.toReportIndex())},messageSend:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"==typeof e&&document.getElementById("reportCommonDMP").contentWindow.postMessage({type:e,data:t},"*")},viewLargerImage:function(e,t){p.a.openImageBrowser(e,t,{isShow:!0,isShowChange:!0})},toReportIndex:function(){!0===window.__YL_SUPER_APP__?this.$router.replace({name:"ReportIndexSuper"},!0):this.$router.replace({name:"Report"},!0)},objTransferString:function(e){var t="";for(var r in e)t+="&".concat(r,"=").concat(e[r]);return t=t.slice(1)}}},l=(r("1576"),r("17cc")),m=Object(l.a)(u,(function(){var e=this.$createElement,t=this._self._c||e;return t("page-content",{attrs:{title:this.title}},[this.src?t("iframe",{ref:"dmp",staticClass:"show-dmp",attrs:{id:"reportCommonDMP",src:this.src,width:"100%",height:"100%",frameborder:"0"}}):this._e(),t("loading-status",{attrs:{"is-loading":this.isLoading,"is-empty":!this.isLoading&&!this.src,"empty-text":"当前无网络",type:"error"}})],1)}),[],!1,null,"7f2a0f6c",null);t.default=m.exports},ebc5:function(e,t,r){"use strict";r.r(t);r("5ab2"),r("6d57"),r("e10e");var n=r("28f8"),o=(r("f548"),r("ed63"),r("8cf2"),r("3e83")),i=r("3bd5"),a=(r("162a"),r("4ad6")),s=r("e2a7"),c=r("1b7e"),d=r("0c09"),p=r("b26e"),u=r("9416"),l=r("8d95");function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var h={name:"ReportCommonIframe",data:function(){return{isLoading:!0,noNetwork:!1,h5Site:"",url:"",title:"",siteType:d.b}},computed:{parameter:function(){var e=this.$route.query.parameter;return e||{}}},activated:function(){var e=this;this.path=this.$route.query.path,this.title=this.$route.query.title,this.siteType=this.$route.query.site_type||d.b,this.noNetwork=!1,this.isLoading=!0,c.a.getHasNetwork().then((function(t){t||(e.isLoading=!1,e.noNetwork=!0)})).then((function(){e.heDomainName(),e.iframeMessage()}))},deactivated:function(){this.url=""},methods:{iframeMessage:function(){this.removeAllHandlers("message",window._eventHandlers),window._eventHandlers=[],window._eventHandlers.push(this.messageDealWith),window.addEventListener("message",this.messageDealWith,!1)},removeAllHandlers:function(e,t){for(var r in t)window.removeEventListener(e,t[r])},messageDealWith:function(e){if((e=e.data)&&"object"===Object(o.a)(e))if(console.log("app-message：",e.type,e.data),"report-common-query"===e.type){var t=e.data.title;t.includes("专项巡检")&&(t=t.replace("专项巡检",Object(u.a)(l.a.SPECIAL_INSPECT)||"专项巡检")),t&&(this.title=t)}else if("report-common-close-loading"===e.type)this.isLoading=!1;else if("report-common-view-larger-image"===e.type){var r=e.data,n=r.list,i=r.index;this.viewLargerImage(n,i)}else"report-common-ask-parent-windows-is-app"===e.type?this.messageSend("report-common-parent-windows-is-app",{parentWindowIsApp:!0}):"report-common-login-failure"===e.type?(s.a.alert("登录失效，重新进入"),this.toReportIndex()):"report-common-router-back"===e.type&&this.$router.back()},viewLargerImage:function(e,t){console.log("viewImages-1",e),a.a.openImageBrowser(e,t,{isShow:!0,isShowChange:!0})},toReportIndex:function(){!0===window.__YL_SUPER_APP__?this.$router.replace({name:"ReportIndexSuper"},!0):this.$router.replace({name:"Report"},!0)},messageSend:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){var r=document.getElementById("reportCommonIframe");r&&r.contentWindow.postMessage({type:e,data:t},"*")}},open:function(){var e=i.a.getUser().tenant_code,t=i.a.getUser().user_id,r=!0===window.__YL_SUPER_APP__,o=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({access_token:r?i.a.getToken():i.a.getUser().access_token,key:r?"unified_token":"access_token",tenant_code:e,app_user_id:t,o:e,t:(new Date).getTime()},this.parameter);this.url="".concat(this.h5Site,"/").concat(this.path,"?").concat(this.objTransferString(o)),$log.log("集团-H5-传递的参数：",o),$log.log("集团-H5-跳转url：",this.url)},heDomainName:function(){var e=this,t={name:this.siteType===d.b?"MobileCheckQualityH5Site":"EngineeringScheduleH5Site"};Object(p.e)(t).then((function(t){e.h5Site=t,"dev"===APP_ENV&&(e.h5Site="http://".concat(window.location.hostname,":16161")),e.open()}))},objTransferString:function(e){var t="";for(var r in e)t+="&".concat(r,"=").concat(e[r]);return t=t.slice(1)}}},f=(r("1484"),r("17cc")),g=Object(f.a)(h,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("page-content",{staticClass:"is-keyboard-open",attrs:{title:e.title}},[e.url?r("iframe",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading&&!e.noNetwork,expression:"!isLoading && !noNetwork"}],staticClass:"report-template-plan",attrs:{id:"reportCommonIframe",src:e.url,width:"100%",frameborder:"0",marginwidth:"0",marginheight:"0",scrolling:"no",name:"reportCommonIframe"}}):e._e(),r("loading-status",{attrs:{"is-loading":e.isLoading,"is-empty":e.noNetwork,"empty-text":"当前无网络连接"}})],1)}),[],!1,null,null,null);t.default=g.exports},f001:function(e,t,r){var n=r("4971");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,r("85cb").default)("35fdd6de",n,!0,{sourceMap:!1,shadowMode:!1})}}]);