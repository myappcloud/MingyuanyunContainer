(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-2dd23fce"],{"010a":function(t,e,n){"use strict";n("7876")},"2e80":function(t,e,n){var i=n("9e2b");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,n("85cb").default)("3ccc3358",i,!0,{sourceMap:!1,shadowMode:!1})},"3e1e":function(t,e,n){"use strict";n("2e80")},4218:function(t,e,n){"use strict";n.r(e);n("6a61");var i,r=n("2e91"),o=n("07d2"),c=n("e2a7"),s=(n("a044"),n("c726")),a=n("2757"),u=Object(a.c)(11),l={name:"SpecialInspectIndexListHolderMode11",components:{Item:o.a},props:{isLoading:{type:Boolean},isEmpty:{type:Boolean},batch:{type:Object,default:function(){return{}}}},data:function(){return{}},computed:{editable:function(){return"检查完毕"!==this.batch.status&&this.batch.isChecker}},methods:{addPlace:(i=Object(r.a)(regeneratorRuntime.mark((function t(){var e,n,i,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.batch,n=e.id,i=e.proj_id,t.next=3,u.hasBatchCheckitem(n);case 3:t.sent?s.a.open({title:"选择测区",projectId:i,callback:function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.a.close(),t.prev=1,t.next=4,u.addBatchPlace(e,n,i);case 4:o.$emit("reload"),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(1),$log.error(t.t0),c.a.alert("添加测区失败");case 11:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e){return t.apply(this,arguments)}}()}):c.a.alert("没有批次检查项，请先下拉同步数据");case 5:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})}},d=(n("010a"),n("17cc")),f=Object(d.a)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":t.isEmpty}},[n("div",{attrs:{slot:"empty-text"},slot:"empty-text"},[t._v("\n    暂无测区"),t.editable?[t._v("，"),n("app-button",{attrs:{type:"text"},on:{click:t.addPlace}},[t._v("\n        请添加\n      ")])]:t._e()],2)])}),[],!1,null,"1ae8187c",null);e.default=f.exports},"49ef":function(t,e,n){(t.exports=n("690e")(!1)).push([t.i,".zjapp .app-btn-text[data-v-1ae8187c]{font-size:16px}",""])},"4e84":function(t,e,n){"use strict";n("5ab2"),n("6d57"),n("e10e");var i=n("28f8"),r=(n("cc57"),n("fc9f")),o=function(t){var e="select * from section \n      where proj_id = '".concat(t,"' \n      order by name");return r.a.query(e)},c=function(t){var e="select b.*, sb.section_id from building b\n      join section_building sb on b.id = sb.building_id\n      where b.proj_id = '".concat(t,"' \n      order by b.sort, b.code");return r.a.query(e)},s=function(t){var e="select b.* from section_building sb \n      left join building b on sb.building_id = b.id \n      where sb.section_id = '".concat(t,"' \n      order by b.sort, b.code");return r.a.query(e)},a=function(t){var e="select * from build_unit \n      where building_id = '".concat(t,"'\n      order by sort");return r.a.query(e)},u=function(t){var e="select * from building_floor \n      where building_id = '".concat(t,"' \n      order by sort");return r.a.query(e)},l=function(t,e,n){var i=e?" and unit = '".concat(e,"' "):"",o="select * from room where \n      building_id = '".concat(t,"' and floor = '").concat(n,"' ").concat(i," \n      order by sort");return r.a.query(o)},d=n("7cb8");function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){Object(i.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e.a={getSections:function(t){return o(t)},getBuildingsByProject:function(t){return c(t)},getBuildingsBySection:function(t){return s(t)},getUnits:function(t){return a(t).then((function(t){return((t=t.filter((function(t){return!!t.name})))||[]).map((function(t){return p(p({},t),{},{id:t.name,name:Object(d.a)(t.name,"单元")})}))}))},getFloors:function(t){return u(t).then((function(t){return(t||[]).map((function(t){return p(p({},t),{},{id:t.floor,name:Object(d.a)(t.floor,"层")})}))}))},getRooms:function(t,e,n){return l(t,e,n).then((function(t){return(t||[]).map((function(t){return p(p({},t),{},{name:t.room_no})}))}))}}},7876:function(t,e,n){var i=n("49ef");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,n("85cb").default)("94581e0a",i,!0,{sourceMap:!1,shadowMode:!1})},"9e2b":function(t,e,n){(t.exports=n("690e")(!1)).push([t.i,"[data-v-0f3c0354] .layout-content{display:flex;flex-direction:column;overflow:hidden;background:#fff}.zjapp .page-scroll[data-v-0f3c0354]{flex:1;overflow:auto;padding-bottom:100px}.zjapp .bread-crumb[data-v-0f3c0354]{padding:8px 15px;font-size:16px;line-height:30px;color:#999}.zjapp .bread-crumb .level-item i[data-v-0f3c0354]{font-size:12px;margin:0 10px}.zjapp .bread-crumb .level-item:last-child>i[data-v-0f3c0354]{display:none}.zjapp .bread-crumb .active[data-v-0f3c0354]{color:#4275e8}.zjapp .empty-msg[data-v-0f3c0354]{display:flex;align-items:center;justify-content:center;color:#c8c8c8;margin-top:30px}.zjapp .empty-msg .line[data-v-0f3c0354]{width:48px;margin:0 8px;border-top:1px solid #e4e4e4}[data-v-0f3c0354] .icon-qualified{color:#4275e8}.zjapp .place-item[data-v-0f3c0354]{align-items:center}",""])},c726:function(t,e,n){"use strict";var i=n("329b"),r=(n("5ab2"),n("28f8")),o=(n("ed63"),n("8cf2"),n("e697"),n("6d57"),n("e10e"),n("cc57"),n("e204"),n("e89f")),c=n("07d2"),s=n("4e84");function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var l=["building","unit","floor","room"],d=["unit"],f={name:"PlaceSelectDialog",components:{Item:c.a},mixins:[o.a],data:function(){return{show:!1,isLoading:!0,title:"",items:[],optionalItems:[],curItem:"",options:[],hasUnit:!1,projectId:"",sectionId:"",selected:{},defaultSelected:{},beforeConfirm:function(){},callback:function(){}}},computed:{crumbs:function(){var t=[],e=this.items,n=this.curItem,i=e.findIndex((function(t){return t===n}));if(i>=0)for(var r=0;r<=i;r++){var o=e[r],c=e[r-1],s=c?this.selected[c]&&this.selected[c].name:"全部";("unit"!==c||s)&&t.push({name:s,item:o})}return t},hasSelected:function(){return!!this.selected&&!!Object.keys(this.selected).length},prevItem:function(){var t=this,e=this.items.findIndex((function(e){return e===t.curItem}));return this.items[e-1]},nextItem:function(){var t=this,e=this.items.findIndex((function(e){return e===t.curItem}));return this.items[e+1]}},methods:{open:function(t){if(this.items=t.items||l,this.optionalItems=t.optionalItems||d,!this.items||!this.items.length)return Promise.reject(new Error("palce-select open() 参数错误"));this.curItem=this.items[0],this.projectId=t.projectId,this.sectionId=t.sectionId,this.defaultSelected=t.selected,this.title=t.title,this.beforeConfirm="function"==typeof t.beforeConfirm?t.beforeConfirm:function(){},this.callback="function"==typeof t.callback?t.callback:function(){},this.init(),this.show=!0},close:function(){this.show=!1},getDefaultId:function(t){if(!this.defaultSelected)return"";var e=this.defaultSelected[t];switch(t){case"section":return e&&e.id||"";case"building":return this.defaultSelected.building_id||e&&e.id||"";case"unit":return this.defaultSelected.unit_id||e&&e.id||"";case"floor":return("string"==typeof e?e:e&&e.id)||"";case"room":return this.defaultSelected.room_id||e&&e.id||""}},init:function(){var t=this,e=Promise.resolve(),n=!0;return this.selected={},this.curItem=this.items[0],this.items.forEach((function(i){e=e.then((function(){if(n)return t.getOptions(i).then((function(e){var r=t.getDefaultId(i),o=r&&(e||[]).find((function(t){return t.id===r}));if(!e||!e.length)return t.$set(t.selected,i,null),void(n=!!t.optionalItems.includes(i));o?(t.$set(t.selected,i,u({},o)),t.options=e,t.curItem=i,n=!0):(i===t.items[0]&&(t.options=e),n=!1)}))}))})),e},crumbClick:function(t){var e=this;this.curItem=t.item;var n=this.items.findIndex((function(t){return t===e.curItem}));return this.clearChildrenFromIndex(n),this.getOptions().then((function(t){if(e.options=t,"unit"===e.curItem&&(!e.options||!e.options.length)&&e.nextItem)return e.curItem=e.nextItem,e.getOptions().then((function(t){e.options=t}))}))},clearChildrenFromIndex:function(t){for(var e=this.items,n=t;n<e.length;n++){var i=e[n];this.$delete(this.selected,i)}},getOptions:function(t){var e=this;this.isLoading=!0,t=t||this.curItem;var n=this.items;return Promise.resolve().then((function(){var i=e.projectId,r=e.sectionId||e.selected&&e.selected.section&&e.selected.section.id,o=e.selected&&e.selected.building&&e.selected.building.id,c=e.selected&&e.selected.unit&&e.selected.unit.id,a=e.selected&&e.selected.floor&&e.selected.floor.id;switch(t){case"section":return s.a.getSections(i);case"building":return n.some((function(t){return"section"===t}))?s.a.getBuildingsBySection(r):s.a.getBuildingsByProject(i);case"unit":return s.a.getUnits(o);case"floor":return s.a.getFloors(o);case"room":return s.a.getRooms(o,c,a)}})).then((function(n){return"unit"===t&&(e.hasUnit=n&&n.length),n})).catch((function(t){$log.error(t)})).finally((function(){e.isLoading=!1}))},selectedItem:function(t){var e=this,n=this.items,i=this.curItem;if(i&&t){this.$set(this.selected,i,u({},t));var r=n.findIndex((function(t){return t===i}));this.clearChildrenFromIndex(r+1),this.nextItem?(this.curItem=this.nextItem,this.getOptions().then((function(t){if(e.options=t,"unit"===e.curItem&&(!e.options||!e.options.length)&&e.nextItem)return e.curItem=e.nextItem,e.getOptions().then((function(t){e.options=t}))})).then((function(){e.options&&e.options.length||e.finish()}))):this.finish()}},finish:function(){var t=this,e={fullname:""};this.items.forEach((function(n){var i=t.selected[n];i&&(e[n]=i,"floor"===n&&t.selected.room||(e.fullname+=i.name))}));var n=this.beforeConfirm&&this.beforeConfirm(e);n instanceof Promise||(n=Promise.resolve(n)),n.then((function(n){if(!1===n)return!1;t.callback&&t.callback(e)}))}}},p=(n("3e1e"),n("17cc")),m=Object(p.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"slide-right"}},[t.show?n("page-content",{attrs:{mode:"dialog",title:t.title,"on-close":t.close}},[n("div",{staticClass:"bread-crumb"},t._l(t.crumbs,(function(e){return n("span",{key:e.item,staticClass:"level-item",class:{active:e.item===(t.hasUnit||"unit"!==t.prevItem?t.curItem:t.prevItem)},on:{click:function(n){t.crumbClick(e)}}},[t._v("\n        "+t._s(e.name)),n("icon",{attrs:{name:"arrow-right"}})],1)}))),!t.isLoading&&t.options.length?n("div",{ref:"placeSelectScroll",staticClass:"page-scroll"},[t._l(t.options,(function(e,i){return n("item",{key:i,staticClass:"border-bottom place-item",attrs:{text:e.name,"icon-right":t.selected[t.curItem]&&t.selected[t.curItem].id===e.id?"qualified":""},on:{click:function(n){t.selectedItem(e)}}})})),n("div",{staticClass:"empty-msg"},[n("span",{staticClass:"line"}),t._v("\n        就这么多了\n        "),n("span",{staticClass:"line"})])],2):t._e(),!t.isLoading&&t.options.length?n("app-button-group",{attrs:{"fixed-bottom":""}},[n("app-button",{attrs:{disabled:!t.hasSelected},on:{click:t.finish}},[t._v("\n        确定\n      ")])],1):t._e(),n("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.options||!t.options.length,"empty-text":"没有信息"}})],1):t._e()],1)}),[],!1,null,"0f3c0354",null).exports,h=!1;h||(h=new(i.default.extend(m))({el:document.createElement("div")}),document.body.appendChild(h.$el));e.a=h},e89f:function(t,e,n){"use strict";var i=n("04f3"),r=n("cf09"),o=n("4360"),c=0;e.a={name:"PopupMixin",data:function(){return{backButtonEvent:null}},watch:{show:function(t){var e=this;if(t){if(this.$nextTick((function(){e.$el&&e.$el.style&&(e.$el.style.zIndex=++r.a.zIndex,c++,o.a.commit("app/SET_HAS_POPUP",!!c))})),!this.backButtonEvent){var n=this.close||this.closePopup;this.backButtonEvent=Object(i.a)(n)}}else--c<0&&(c=0),o.a.commit("app/SET_HAS_POPUP",!!c),this.backButtonEvent&&(Object(i.c)(this.backButtonEvent),this.backButtonEvent=null)}},methods:{}}}}]);