(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-4d52ef9c"],{3045:function(e,n,o){(e.exports=o("690e")(!1)).push([e.i,".zjapp .disabled-tolbar .bf-toolbar{display:none!important}",""])},"32fd":function(e,n,o){"use strict";(function(e){o("cc57"),o("a32d");var i,t,a=o("fd50"),d=o("e2a7"),c=o("4ad6"),l=o("2e75");o("a078");n.a={data:function(){return{viewSize:$rootScope.viewSize,points:[],mode:"",localPath:"",onmark:null,downloadingSdk:!1,donwloadingProgress:0,donwloadingError:"",title:"",fileExt:"dwg"}},computed:{disabledToolbar:function(){return"dwg"===this.fileExt}},activated:function(){var n=this,o=this.$route.query,i=o.mode,t=o.url,a=o.viewToken,d=o.points,l=o.onmark,r=o.name,s=o.ext,f=void 0===s?"dwg":s;this.fileExt=f,this.mode=i,this.localPath=t,this.points=d||[],this.onmark=l,this.title=r||"文档详情",this.downloadingSdk=!1,this.donwloadingError="",this.localPath?c.a.getFileList(this.localPath).then((function(o){var i,t=o[0];t&&(i=n.$store.state.app.isIOS&&c.a.allowWKWebView()?"http://"+location.host+t.path:"file://"+t.path,n.checkSdk().then((function(){return n.loadJssdk()})).then((function(){n.initOfflineHuxing(i)})).catch((function(o){n.donwloadingError=e.isString(o)?o:"打开图纸失败",console.log(o)})))})).catch((function(e){$log.error("err",e)})):a&&this.checkSdk().then((function(){return n.loadJssdk()})).then((function(){n.initOnlineHuxing(a)})).catch((function(o){n.donwloadingError=e.isString(o)?o:"打开图纸失败",console.log(o)}))},deactivated:function(){document.getElementById("bimface-huxing").innerHTML=""},methods:{close:function(){window.keyboardNumScope&&window.keyboardNumScope.close()},checkSdk:function(){var e=this,n=this.fileExt;return l.a.checkBimfaceSdk().then((function(o){if(!o)return d.a.confirm("查看".concat(n,"图纸需要下载对应插件，是否确认下载？")).then((function(o){return o?e.downloadSdk():Promise.reject("拒绝了下载".concat(n,"图纸插件"))}))})).catch((function(e){console.log(e)}))},downloadSdk:function(){var e=this,n=a.a.defer();return this.downloadingSdk=!0,l.a.downloadBimfaceSdk().then((function(){$log.log("bimface jssdk 下载完毕"),e.downloadingSdk=!1,n.resolve()}),null,(function(n){e.donwloadingProgress=parseInt(n)})).catch((function(o){e.downloadingSdk=!1,n.reject(o)})),n.promise},loadJssdk:function(){var e=this.fileExt;if(window.BimfaceSDKLoaderConfig)return Promise.resolve();if("dev"===window.APP_ENV){var n=new Error("开发环境无法打开 ".concat(e," 文件"));return Promise.reject(n)}var o=document.getElementsByTagName("head")[0],i=document.createElement("script"),t=l.a.getBimfaceJssdkDir()+"/jssdk/BimfaceSDKLoader@latest-release.js";return i.type="text/javascript",i.src=t,o.appendChild(i),new Promise((function(e,n){i.onload=function(){$log.log("bimface jssdk 载入成功！"),e()},i.onerror=function(e){$log.error(e),n(e)}}))},initOfflineHuxing:function(e){e&&this.$nextTick((function(){var n=new BimfaceSDKLoaderConfig,o=l.a.getBimfaceJssdkDir();n.dataEnvType=BimfaceEnvOption.Local,n.sdkPath=o+"/jssdk",n.path=e+"/viewToken.json",BimfaceSDKLoader.load(n,this.onSDKLoadSucceeded,this.onSDKLoadFailed)}))},initOnlineHuxing:function(e){e&&this.$nextTick((function(){var n=new BimfaceSDKLoaderConfig;n.viewToken=e,BimfaceSDKLoader.load(n,this.onSDKLoadSucceeded,this.onSDKLoadFailed)}))},onSDKLoadSucceeded:function(e){var n=document.getElementById("bimface-huxing");n.innerHTML="","drawingView"===e.viewType?((i=new Glodon.Bimface.Application.WebApplicationDrawingConfig).domElement=n,new Glodon.Bimface.Application.WebApplicationDrawing(i).getViewer().addModel(e)):"3DView"===e.viewType?((t=new Glodon.Bimface.Application.WebApplication3DConfig).domElement=n,Glodon.Bimface.Application.WebApplication3DEvent,new Glodon.Bimface.Application.WebApplication3D(t).getViewer().addModel(e)):"rfaView"===e.viewType&&((t=new Glodon.Bimface.Application.WebApplicationRfaConfig).domElement=n,Glodon.Bimface.Application.WebApplicationRfaEvent,app=new Glodon.Bimface.Application.WebApplicationRfa(t),app.getViewer().addModel(e))}},onSDKLoadFailed:function(e){$log.log("Failed to load SDK!",e)}}}).call(this,o("391c"))},3944:function(e,n,o){"use strict";o.r(n);var i=o("32fd").a,t=(o("f518"),o("17cc")),a=Object(t.a)(i,(function(){var e=this,n=e.$createElement,o=e._self._c||n;return o("page-content",{attrs:{title:e.title,"show-go-root":!0}},[e.downloadingSdk||e.donwloadingError?e._e():o("div",{class:{"disabled-tolbar":e.disabledToolbar},style:{width:e.viewSize.width+"px",height:e.viewSize.contentHeight+"px"},attrs:{id:"bimface-huxing"}}),o("loading-status",{attrs:{"is-loading":e.downloadingSdk,"loading-text":"正在下载"+e.fileExt+"图纸插件"+e.donwloadingProgress+"%","is-empty":!!e.donwloadingError,"empty-text":e.donwloadingError,type:"error"}})],1)}),[],!1,null,null,null);n.default=a.exports},"9a9f":function(e,n,o){var i=o("3045");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,o("85cb").default)("e99dc312",i,!0,{sourceMap:!1,shadowMode:!1})},f518:function(e,n,o){"use strict";o("9a9f")}}]);