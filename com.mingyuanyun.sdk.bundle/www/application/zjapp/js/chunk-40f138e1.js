(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-40f138e1","chunk-b1eec014","chunk-2d0d2f53"],{"0732":function(e,t,i){var r=i("81f2");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,i("85cb").default)("1b5b07de",r,!0,{sourceMap:!1,shadowMode:!1})},"0dc2":function(e,t,i){var r=i("8fdd");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,i("85cb").default)("1dfae8a1",r,!0,{sourceMap:!1,shadowMode:!1})},"114f":function(e,t,i){"use strict";(function(e){i("5ab2"),i("e10e"),i("6d57"),i("e697"),i("cc57"),i("163d");var r=i("28f8"),n=i("8693"),a=i("5b5e"),o=i("06f6"),c=i("242b"),s=i("6144"),l=i("3bd5"),d=i("3122"),u=i("2a15"),p=(i("3516"),i("6e1b"));function m(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?m(Object(i),!0).forEach((function(t){Object(r.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var h=l.a.getUser();t.a={defaultPlaceKey:"special-inspect-prolbem-pure-default-place",getProblemData:function(t){return a.a.getCheckProblemInfo(t).then((function(t){return f(f({},t),{},{id:t.id,status:t.status,proj_id:t.proj_id,place:{building_id:t.building_id,unit_id:t.unit,floor:t.floor,room_id:t.room_id,full_name:t.place},bidsection_id:t.bidsection_id,batch_id:t.batch_id,batch_type:t.batch_type,created_by:t.created_by,checkItem:{id:t.item_id,name:t.item_name,full_name:t.item_full_name,parentId:t.item_parent_id},description:{id:t.desc_id,name:t.desc},image_file:JSON.parse(t.image_file||"[]"),remark:t.remark,repair_requirements:t.repair_requirements,level:t.emergency_degree||"一般",deadline:void 0===t.deadline||null===t.deadline?7:Number(t.deadline),building_id:t.building_id,unit:t.unit,floor:t.floor,room_id:t.room_id,place_point:JSON.parse(t.problem_values||"[]"),drawing_file:JSON.parse(t.drawing_file||"[]"),repair_set:t.repair_set,process_mode:t.process_mode,repair:t.repair&&t.repair.id?f({},t.repair):t.repair_set&&t.repair_set.id?f({},t.repair_set):{},repair_image_file:JSON.parse(t.repair_image_file||"[]"),contractor:{id:t.contractor_id,name:t.contractor_name},reinspect_set:t.reinspect_set,cc_set:t.cc_set_array||[],sent_back:t.sent_back&&t.sent_back.id?f({},t.sent_back):{},sent_back_image_file:JSON.parse(t.sent_back_image_file||"[]"),regist:{id:t.regist.id,name:t.regist.name,mobile:t.regist.mobile,is_im_user:t.regist.is_im_user},currentReinspectBy:e.find(e.clone(t.reinspectBy),(function(e){return e.id===l.a.getUser().user_id}))||{reinspect_image_file:[],reinspect_remark:""}})})).then((function(e){var t=e&&e.biz_id||"";return t?n.a.getSpecialInspectData(t).then((function(t){return e.checkItem={id:t.checkitem_id,name:t.checkitem_name,full_name:t.checkitem_full_name,parentId:t.checkitem_parent_id},e.specialInspectId=t.id,e})):e})).then((function(e){return p.a.getBatchDetailAndCheckers(e.batch_id).then((function(t){return e.batchDetail=t,e}))})).catch((function(e){console.error(e)}))},createNewData:function(e,t){var i=this;return Promise.resolve().then((function(){return e?t?n.a.getPlaceSpecialInspectData(e,t):n.a.getSpecialInspectCheckItemDetail(e):Promise.reject(new Error("专项巡检，创建问题，缺少 specialInspectId"))})).then((function(e){return Promise.resolve().then((function(){if(t)return n.a.getBatchPlace(t).then((function(e){if(e.building_id)return{building_id:e.building_id,unit_id:e.unit,floor:e.floor,room_id:e.room_id,full_name:e.name}}))})).then((function(t){return e.defaultPlace=t||s.a.getObject(i.defaultPlaceKey,s.a.level.user)||{},e}))})).then((function(t){return{status:"",proj_id:t.proj_id,place:t.defaultPlace||{},batch_id:t.batch_id,batch_type:"专项巡检",checkItem:{id:t.item_id||t.checkitem_id,name:t.item_name||t.checkitem_name,full_name:t.full_name||t.checkitem_full_name},description:{},image_file:[],remark:"",level:"一般",deadline:7,repair_set:{},contractor:{},cc_set:[],reinspect_set:[],bidsection_id:"",building_id:t.defaultPlace&&t.defaultPlace.building_id||"",unit:t.defaultPlace&&t.defaultPlace.unit_id||"",floor:t.defaultPlace&&t.defaultPlace.floor||"",room_id:t.defaultPlace&&t.defaultPlace.room_id||"",place_point:[],deduction:1,redline_deduction:0,biz_id:e,biz_children_id:t.id,created_by:h.user_id,checkitem_extension:JSON.parse(t.checkitem_extension||"{}")}}))},getDiagram:function(e){return Promise.resolve().then((function(){if(e){var t=e.building_id,i=e.unit_id,r=e.floor,n=e.room_id;return n?o.default.getRoomTypeDiagram(n):i&&r?c.a.getDiagram(t,i,r,1):r?c.a.getDiagram(t,"",r,2):void 0}}))},getProblemList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return e=Array.isArray(e)?e:[e],Promise.resolve().then((function(){return n.a.getProblemList(e,t)})).then((function(e){return(e||[]).forEach((function(e){e.thumbnail=d.a.getDefaultThumbnailFromList(e.image_file,"专项巡检"),"检查完毕"===e.status&&(e.status="已提交")})),e}))},getBatchProblemList:function(e){var t=this;return Promise.resolve().then((function(){return n.a.getAllProblemIncloudRootSpecialInspectIds(e)})).then((function(e){var i=(e||[]).map((function(e){return e.id}));return t.getProblemList(i)}))},getPlaceProblemList:function(e){var t=this;return n.a.getMode11SpecilInspectByPlaceId(e).then((function(i){var r=(i||[]).map((function(e){return e.special_inspect_id}));return t.getProblemList(r,e)}))},deleteBatchDraftProblem:function(e){return u.a.deleteBatchDraftProblem(e)}}}).call(this,i("391c"))},1448:function(e,t,i){var r=i("5ad1");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,i("85cb").default)("215b02e2",r,!0,{sourceMap:!1,shadowMode:!1})},"19a9":function(e,t,i){"use strict";i("7d4e")},2939:function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .page-scroll[data-v-74102c05]{flex:1;overflow:auto;padding-bottom:100px;transform:translateZ(0)}.zjapp .sublist[data-v-74102c05]{padding-left:25px;padding-top:1px;background-color:#fff}.zjapp .sublist>.sublist[data-v-74102c05]{padding-left:10px;padding-top:0}",""])},"2a15":function(e,t,i){"use strict";var r=i("fc9f");t.a={deleteBatchDraftProblem:function(e){return r.a.executeSql("delete from checkquality_problem where batch_id = ? and status = '草稿'",[e])}}},"3cd8":function(e,t,i){var r=i("5c19");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,i("85cb").default)("67c16200",r,!0,{sourceMap:!1,shadowMode:!1})},"4aef":function(e,t,i){"use strict";var r=i("dd16").a,n=i("17cc"),a=Object(n.a)(r,(function(){var e=this.$createElement;return(this._self._c||e)("span",{class:this.classSet[this.status]},[this._v(this._s(this.text||this.status))])}),[],!1,null,null,null);t.a=a.exports},"515e":function(e,t,i){"use strict";var r=i("329b"),n=i("f1e4").a,a=(i("fe9e"),i("17cc")),o=Object(a.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"slide-right"}},[e.show?i("page-content",{class:{"content-not-empty":e.content.length},attrs:{mode:"dialog",title:"检查指引","on-close":e.closePopup}},[e.isLoading?e._e():i("div",{staticClass:"check-guide-detail-hd border-bottom"},[i("h2",{staticClass:"check-guide-detail-title pb10"},[e._v(e._s(e.title))])]),!e.isLoading&&e.content.length?i("div",{staticClass:"check-guide-detail-content"},e._l(e.content,(function(t,r){return i("p",{key:r},[t.isImg&&t.src?i("img",{class:{"img-not-ready":!t.ready,error:"rejected"===t.status},attrs:{src:e.getThumbnail(t)},on:{error:function(i){e.imgError(t,r)},click:function(i){e.imgClick(t)}}}):e._e(),t.isImg?e._e():i("span",[e._v("\n          "+e._s(t.val)+"\n        ")])])}))):e._e(),i("loading-status",{attrs:{"is-loading":e.isLoading,"is-empty":!e.content.length,"empty-text":"PC端未设置检查指引"}})],1):e._e()],1)}),[],!1,null,"43042f0d",null).exports,c=!1;c||(c=new(r.default.extend(o))({el:document.createElement("div")}),document.body.appendChild(c.$el));t.a=c},"56e6":function(e,t,i){"use strict";i.r(t);var r=i("7e59").a,n=(i("6810"),i("17cc")),a=Object(n.a)(r,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("page-content",{attrs:{title:"检查项详情","show-go-root":!0}},[e.isLoading?e._e():i("check-guide",{directives:[{name:"track",rawName:"v-track",value:"专项巡检-检查指引",expression:"'专项巡检-检查指引'"}],attrs:{slot:"header-bar-right","item-id":e.specialInspectId,module:"special-inspect"},slot:"header-bar-right"}),i("scroller",[!e.isLoading&&e.detailData&&e.detailData.id?[i("div",{staticClass:"title border-bottom"},[e._v(e._s(e.title))]),e.checkitemRule?i("div",{staticClass:"rule border-bottom"},[e._v(e._s(e.checkitemRule))]):e._e(),i("item",{attrs:{label:"检查结果",text:e.detailData.status,mode:"edit"}}),i("div",{staticClass:"mt10"},["不合格"===e.detailData.status?i("item",{attrs:{label:"倒扣分",text:(void 0===e.detailData.deduction||null===e.detailData.deduction?"":e.detailData.deduction)+"分",mode:"edit"}}):e._e(),e.detailData.images&&e.detailData.images.length?i("item",{staticClass:"p15"},[i("item-img-list",{attrs:{editabled:!1},model:{value:e.detailData.images,callback:function(t){e.$set(e.detailData,"images",t)},expression:"detailData.images"}})],1):e._e(),e.detailData.remark?i("div",{staticClass:"item-remark"},[i("div",{staticClass:"item-remark-con"},[e._v("补充说明："+e._s(e.detailData.remark))])]):e._e()],1),i("problem-list",{attrs:{list:e.problemList,edit:e.editable},on:{add:e.createProblem,clickItem:e.openProblemDetail}}),e.allowRest?i("app-button-group",[i("app-button",{attrs:{type:"text"},on:{click:e.checkItemRest}},[e._v(" 删除已检查内容 ")])],1):e._e()]:e._e()],2),i("loading-status",{attrs:{"is-loading":e.isLoading,"is-empty":!e.detailData||!e.detailData.id,"empty-text":"获取数据失败"}})],1)}),[],!1,null,"5bac2e99",null);t.default=a.exports},"5ad1":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .title[data-v-5bac2e99]{padding:10px 15px;line-height:26px;font-size:16px;color:#333;font-weight:500;background-color:#fff}.zjapp .rule[data-v-5bac2e99]{padding:13px 15px;line-height:20px;font-size:14px;color:#999;background-color:#fff}.zjapp .item-remark[data-v-5bac2e99]{padding:15px;background-color:#fff}.zjapp .item-remark-con[data-v-5bac2e99]{padding:10px;line-height:20px;border-radius:4px;font-size:14px;color:#999;background-color:#f4f4f4}",""])},"5b5e":function(e,t,i){"use strict";(function(e){i("9e76"),i("163d"),i("e697");var r,n=i("fd50"),a=i("3bd5"),o=i("ed08"),c=i("4ad6"),s=i("3122"),l=i("3516"),d=i("37d5"),u=i("f2d3"),m=i("48f4"),f=i("6bf2"),h=i.n(f),g=i("4360"),_=i("4921"),b=i("334f"),y=i("b725"),v=i("6b81"),k=i("2f02"),x=i("7364"),w=i("59f8"),P=i("c745"),j=i("0136"),I=function(t,i){var r=a.a.getUser();return b.a.getProblemCCAllColumn(t).then((function(n){if(e.some(n,(function(e){return e.cc===r.user_id&&e.type===i})))return b.a.updateProblemReadingTime(t);var a={id:r.user_id,name:r.user_name,type:i,reading_time:o.a.getNowDate()};return b.a.appendCC(t,a).then((function(){return b.a.updateProblemReadingTime(t)}))}))},D=function(e){var t=e.status;return"已关闭"===e.status&&(t="非正常关闭"),n.a.resolve({status_text:t})};r={getCheckProblemDraftList:function(e){return _.a.getCheckProblemDraftList(e).catch((function(e){return $log.error(e),n.a.reject(e)}))},getCheckProblemList:function(t){var i=a.a.getUser().user_id;return _.a.getCheckProblemList(t,i).then((function(a){return e.map(a,(function(e){r.getProblemLocalStatus({status:e.status}).then((function(t){e.status_text=t.status_text}))})),_.a.getCheckProblemCount(t,i).then((function(e){return n.a.resolve({data:a,total:e.count})}))})).catch((function(e){return $log.error(e),n.a.reject(e)}))},getCheckProblemInfo:function(t){return t?n.a.all([_.a.getCheckProblem(t),y.a.getRepair(t),v.a.getMutliReinspect(t),b.a.getCC(t),b.a.getProblemCCAllColumn(t),v.a.getReinspectByList(t)]).then((function(t){var i=t[0],r=t[5],a=t[1];a&&(i.repair_set=a,i.has_read=a.has_read);var o=t[2];e.isEmpty(o)?i.reinspect_set=[]:i.reinspect_set=o;var c=t[3];c&&c.length>0&&(i.cc_set_id_array=e.map(c,(function(e){return{id:e.user_id}})),i.cc_set_name_array=e.map(c,(function(e){return{name:e.user_name}})),i.cc_set_array=e.map(c,(function(e){return{id:e.user_id,name:e.user_name,mobile:e.mobile,is_im_user:e.is_im_user}})));var s=t[4];return s&&s.length>0&&(i.cc_set_all_id_array=e.map(s,(function(e){return{id:e.cc}}))),i.regist_by||i.sent_back_by||i.repair_by||i.reinspect_by?d.default.getAllProjectUsers(i.proj_id).then((function(t){if(i.regist_by){var n=e.find(t,(function(e){return e.user_id===i.regist_by}));n&&(i.regist=n)}if(i.sent_back_by){var a=e.find(t,(function(e){return e.user_id===i.sent_back_by}));a&&(i.sent_back={id:a.user_id,name:a.user_name,mobile:a.mobile,is_im_user:a.is_im_user})}if(i.repair_by){var o=e.find(t,(function(e){return e.user_id===i.repair_by}));o&&(i.repair=o)}return e.isEmpty(r)||(i.reinspectBy=e.map(r,(function(i){var r=e.find(t,(function(e){return e.user_id===i.reinspect}));return r?{id:r.user_id,name:r.user_name,mobile:r.mobile,is_im_user:r.is_im_user,reinspect_date:i.reinspect_date,reinspect_remark:i.reinspect_remark,reinspect_image_file:JSON.parse(i.reinspect_image_file||"[]"),reinspectById:i.id}:{id:i.reinspect,name:"该用户已被删除",mobile:"",is_im_user:null,reinspect_date:i.reinspect_date,reinspect_remark:"",reinspect_image_file:[],reinspectById:i.id}})),i.reinspectBy=e.filter(i.reinspectBy,(function(e){return!!e})),i.reinspect=e.filter(i.reinspectBy,(function(e){return!!e.reinspect_date}))),i.regist=i.regist||{},i.sent_back=i.sent_back||{},i.repair=i.repair||{},i.reinspect=i.reinspect||[],i})):(i.regist={},i.sent_back={},i.repair={},i.reinspect=[],n.a.resolve(i))})).catch((function(e){$log.log(e)})):n.a.resolve({})},submit:function(t,i,r){if(!1===r)return function(e,t){var i=a.a.getUser();return e.repair_deadline="",e.regist_by=i.user_id,e.regist_date=o.a.getNowDate(),e.created_by=i.user_id,e.created_on=o.a.getNowDate(),e.image_file=JSON.stringify(e.image_file),e.drawing_file&&(e.drawing_file=JSON.stringify(e.drawing_file)),$log.log("专项巡检--\x3e不通知整改"),_.a.submit(e).then((function(){return x.a.saveProblemStatusLog(e.proj_id,"",e.batch_id,e.id,"已提交","","",e.image_file)})).then((function(){return I(e.id,"登记人")})).then((function(t){return m.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).then((function(){if("special-inspect-problem"!==t)return j.a.saveTodo({biz_id:e.id,proj_id:e.proj_id,module_code:t||"",type:2})})).catch((function(e){return $log.error(e),n.a.reject(e)}))}(t,i);if("待提交"!==t.status&&"草稿"!==t.status&&"合格草稿"!==t.status&&"不合格草稿"!==t.status)return n.a.reject("问题单状态异常");if(!t.checkItem.id)return n.a.reject("请先选择检查项");if(!t.repair_set||!t.repair_set.id)return n.a.reject("请选择问题的整改人");if(e.isEmpty(t.reinspect_set))return n.a.reject("请选择问题的复验人");var c=a.a.getUser();t.status="待整改";var s=new Date;return s.setDate(s.getDate()+Number(t.deadline)),t.repair_deadline=h()(s).format("YYYY-MM-DD"),"special-inspect-problem"===i&&t.regist_by&&t.regist_date&&t.created_by&&t.created_on||(t.regist_by=c.user_id,t.regist_date=o.a.getNowDate(),t.created_by=c.user_id,t.created_on=o.a.getNowDate()),t.image_file=JSON.stringify(t.image_file),t.drawing_file&&(t.drawing_file=JSON.stringify(t.drawing_file)),$log.log("现场检查--\x3e提交问题"),_.a.submit(t).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已提交","","",t.image_file)})).then((function(){return I(t.id,"登记人")})).then((function(){if("special-inspect-problem"!==i){var e=t.created_by===t.repair_set.id?1:2;return j.a.insertTodoData(t.created_by,t.id,i,e,0)}})).then((function(){return v.a.getReinspectByList(t.id)})).then((function(i){return m.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_repair",t.id],["checkquality_reinspect",t.id],["checkquality_reinspect_by",e.map(i,"id")],["checkquality_cc",t.id]])})).catch((function(e){return $log.error(e),n.a.reject(e)}))},save:function(t){if("待提交"!==t.status&&"草稿"!==t.status&&"合格草稿"!==t.status&&"不合格草稿"!==t.status)return n.a.reject("问题单状态异常。");if(!/^\+?[0-9]*$/.test(t.deadline))return n.a.reject("整改期限必须是正整数");var i={id:t.id,remark:t.remark,image_file:t.image_file,batch_id:t.batch_id,batch_type:t.batch_type,bidsection_id:t.bidsection_id||"",proj_id:t.proj_id,created_by:t.created_by,created_on:o.a.getNowDate(),status:t.status,room_id:t.room_id||"",building_id:t.building_id||"",unit:t.unit||"",floor:t.floor||"",biz_id:t.biz_id||"",biz_children_id:t.biz_children_id||"",deduction:void 0===t.deduction?"":t.deduction,redline_deduction:4===t.mode||8===t.mode?t.redline_deduction:0,contract_id:t.contract&&t.contract.id?t.contract.id:"",voice_file:e.isEmpty(t.voice_file)?null:JSON.stringify(t.voice_file)};return t.repair_requirements&&(i.repair_requirements=t.repair_requirements||""),t.checkItem&&t.checkItem.id&&(i.item_id=t.checkItem.id),t.place&&t.place.full_name&&(i.place=t.place.full_name),t.contractor&&t.contractor.id&&(i.contractor_id=t.contractor.id),t.description&&t.description.id?i.desc_id=t.description.id:i.desc_id="",i.emergency_degree=t.level,t.deadline&&(i.deadline=t.deadline),t.place_point&&(i.problem_values=JSON.stringify(t.place_point)),i.image_file=JSON.stringify(t.image_file),t.drawing_file&&(i.drawing_file=JSON.stringify(t.drawing_file)),(t.process_mode||null===t.process_mode)&&(i.process_mode=t.process_mode),8===t.mode&&(i.deduction_level=t.deduction_level),t.id?_.a.update(i,t.cc_set,t.repair_set,t.reinspect_set).then((function(){return n.a.resolve(t.id)})).catch((function(e){return $log.error(e),n.a.reject(e)})):(i.id=o.a.uuid(),_.a.insert(i).then((function(){return _.a.update(i,t.cc_set,t.repair_set,t.reinspect_set)})).then((function(){return n.a.resolve(i.id)})).catch((function(e){return $log.error(e),n.a.reject(e)})))},delete:function(e){return _.a.getCheckProblem(e).then((function(t){return"待提交"===t.status||"草稿"===t.status||"合格草稿"===t.status||"不合格草稿"===t.status?_.a.delete(e).catch((function(e){return $log.error(e),n.a.reject(e)})):($log.log("问题单状态异常："+e),n.a.reject("问题单状态异常"))}))},repair:function(t,i){if("待整改"!==t.status)return n.a.reject("问题单状态异常");var r=a.a.getUser();t.status="待复验",t.repair_by=r.user_id,t.repair_date=o.a.getNowDate();var c=JSON.stringify(t.repair_image_file);return _.a.getCheckProblem(t.id).then((function(r){if(!r||"待整改"===r.status)return $log.log("现场检查--\x3e完成整改"),_.a.repairProblem(t.id,t.status,t.repair_by,t.repair_remark,t.repair_date,c).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已整改","",t.repair_remark,c)})).then((function(){return I(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var r=2;e.filter(t.reinspect_set,{user_id:t.repair_by}).length&&(r=1);var n=j.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return j.a.insertTodoData(t.repair_by,t.id,"check",r,n)}})).then((function(){return m.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_cc",t.id]])}));$log.log("提交整改时数据已变为")})).catch((function(e){return $log.error(e),n.a.reject(e)}))},reinspectPass:function(t,i){if("待复验"!==t.status)return n.a.reject("问题单状态异常");t.currentReinspectBy=t.currentReinspectBy||{};var r=a.a.getUser(),c="",s=e.isEmpty(t.currentReinspectBy.reinspect_image_file)?"":JSON.stringify(t.currentReinspectBy.reinspect_image_file);return _.a.getCheckProblem(t.id).then((function(a){if(!a||"待复验"===a.status)return v.a.reinspectPass(t.id,r.user_id,o.a.now(),s,t.currentReinspectBy.reinspect_remark||"").then((function(){return v.a.getReinspectByList(t.id).then((function(i){var a=e.every(i,(function(e){return!!e.reinspect_date})),s=e.find(i,{reinspect:r.user_id});return s?(c=s.id,a?(t.status="已通过",t.respect_by=r.user_id,t.reinspect_completed_date=o.a.getNowDate(),_.a.reinspectProblemPass(t.id,t.status,t.reinspect_completed_date,t.respect_by).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已复验","","","")}))):void 0):n.a.reject("问题单复验人异常")}))})).then((function(){return I(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var e=j.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return j.a.insertTodoData(r.user_id,t.id,i||"check",2,e)}})).then((function(){return m.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_reinspect_by",c],["checkquality_cc",t.id]])}))})).catch((function(e){return $log.error(e),n.a.reject(e)}))},reinspectReject:function(t,i){var r=[["checkquality_problem",t.id],["checkquality_cc",t.id]];if("待复验"!==t.status)return n.a.reject("问题单状态异常");if(!t.sent_back_remark)return n.a.reject("请填写退回原因");var c=a.a.getUser();t.sent_back_times?t.sent_back_times++:t.sent_back_times=1,t.status="待整改",t.sent_back_date=o.a.getNowDate(),t.sent_back_by=c.user_id;var s=JSON.stringify(t.sent_back_image_file);return $log.log("现场检查--\x3e复验退回"),_.a.reinspectProblemReject(t.id,t.status,t.sent_back_date,t.sent_back_remark,s,t.sent_back_by,t.sent_back_times).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已退回",t.sent_back_remark,"",s)})).then((function(){return v.a.clearReinspectByData(t.id)})).then((function(){return I(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var e=2;t.repair_set.id&&t.repair_set.id===c.user_id&&(e=1);var r=j.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return j.a.insertTodoData(c.user_id,t.id,"check",e,r)}})).then((function(){return v.a.getReinspectByList(t.id).then((function(t){r.push(["checkquality_reinspect_by",e.map(t,"id")])}))})).then((function(){if(1===t.has_read)return y.a.update({has_read:0},{checkquality_problem_id:t.id}).then((function(){r.push(["checkquality_repair",t.id])}))})).then((function(){return m.default.addSyncGroup(r)})).catch((function(e){return $log.error(e),n.a.reject(e)}))},close:function(e,t){if("待整改"!==e.status)return n.a.reject("问题单状态异常");if(!e.close_reason)return n.a.reject("请填写关闭原因");var i=a.a.getUser();return e.close_date=o.a.getNowDate(),e.status="已关闭",$log.log("现场检查--\x3e非正常关闭"),_.a.closeProblem(e.id,e.status,e.close_date,e.close_reason).then((function(){return x.a.saveProblemStatusLog(e.proj_id,e.bidsection_id,e.batch_id,e.id,"已关闭",e.close_reason,"","")})).then((function(){return I(e.id,"操作人")})).then((function(){if("special-inspect-problem"!==t){var r=j.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"check");return j.a.insertTodoData(i.user_id,e.id,"check",2,r)}})).then((function(){return m.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).catch((function(e){return $log.error(e),n.a.reject(e)}))},changeRepair:function(e,t,i){if(!e.repair_set||!e.repair_set.id)return n.a.reject("请指定一个整改人");var r=a.a.getUser();return $log.log("现场检查--\x3e修改整改人"),_.a.updateProblemModifiedBy(e.id).then((function(){if(t)return _.a.updateProblemContractor(e.id,e.contractor.id)})).then((function(){if(t){var i=e.contractor&&e.contractor.id||"";return _.a.updateProblemContractor(e.id,i)}})).then((function(){return y.a.changeProblemRepairer(e)})).then((function(){return k.a.saveProblemFpInfo(e.proj_id,e.bidsection_id,e.batch_id,e.id,e.repair_set.id,e.repair_set_old.id,"分配整改人")})).then((function(){return I(e.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var t=2;e.repair_set.id&&e.repair_set.id===r.user_id&&(t=1);var n=j.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"check");return j.a.insertTodoData(r.user_id,e.id,"check",t,n)}})).then((function(){return m.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_repair",e.id],["checkquality_cc",e.id],["checkquality_problem_fpinfo",e.id]])})).catch((function(e){return $log.error(e),n.a.reject(e)}))},changeReinspect:function(t,i){if(e.isEmpty(t.reinspect_set))return n.a.reject("请指定一个复验人");var r=a.a.getUser();return $log.log("现场检查--\x3e修改复验人"),_.a.updateProblemModifiedBy(t.id).then((function(){return v.a.changeProblemReinspect(t.id,t.reinspect_set,!0)})).then((function(){var i=e.map(t.reinspect_set,(function(e){return e.id})).join(","),r=e.map(t.reinspect_set_old,(function(e){return e.id})).join(",");return k.a.saveProblemFpInfo(t.proj_id,t.bidsection_id,t.batch_id,t.id,i,r,"分配复验人")})).then((function(){return I(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var n=2;e.filter(t.reinspect_set,{user_id:r.user_id}).length&&"待复验"===t.status&&(n=1);var a=j.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return j.a.insertTodoData(r.user_id,t.id,"check",n,a)}})).then((function(){return v.a.getReinspectByList(t.id)})).then((function(i){return m.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_reinspect",t.id],["checkquality_reinspect_by",e.map(i,"id")],["checkquality_cc",t.id],["checkquality_problem_fpinfo",t.id]])})).catch((function(e){return $log.error(e),n.a.reject(e)}))},changeCC:function(e){return $log.log("现场检查--\x3e修改抄送人"),_.a.updateProblemModifiedBy(e.id).then((function(){return b.a.saveProblemCC(e.id,e.cc_set)})).then((function(){return m.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).catch((function(e){return $log.error(e),n.a.reject(e)}))},changeContractor:function(e){return e.contractor&&e.contractor.id?($log.log("现场检查--\x3e修改责任单位"),_.a.updateProblemContractor(e.id,e.contractor.id).then((function(){return m.default.addSyncGroup([["checkquality_problem",e.id]])})).catch((function(e){return $log.error(e),n.a.reject(e)}))):n.a.reject("请指定责任单位")},changeRepairDeadline:function(e){if(!/^(\d+)-(\d{1,2})-(\d{1,2})$/.test(e.repair_deadline))return n.a.reject("整改期限需要一个日期格式的值");var t=h()(e.repair_deadline).format("YYYY-MM-DD"),i=h()().format("YYYY-MM-DD");return e.is_timeout=t<i,$log.log("现场检查--\x3e修改整改期限"),_.a.updateProblemRepairDeadline(e.id,e.repair_deadline).then((function(){return m.default.addSyncGroup([["checkquality_problem",e.id]])})).catch((function(e){return $log.error(e),n.a.reject(e)}))},getProblemLocalStatusById:function(e){return D({status:p.status})},getProblemLocalStatus:D,saveRepairInfo:function(e,t,i){return i=JSON.stringify(i),_.a.saveRepairInfo(e,t,i).then((function(){return _.a.getCheckProblemDraft(e).then((function(t){return u.a.backUpDraft(e,t.proj_id,"checkquality_problem",t)}))}))},problemRead:function(e){return y.a.update({has_read:1},{checkquality_problem_id:e}).then((function(){return m.default.addSyncGroup([["checkquality_problem",e],["checkquality_repair",e]])}))},takePictureAndSave:function(e){return s.a.takePicture().then((function(t){if(t)return l.a.getBatch(e).then((function(e){var i={proj_id:e.proj_id,bidsection_id:e.bidsection_id,batch_id:e.id,deadline:e.repair_deadline,batch_type:e.batch_type,created_by:a.a.getUser().user_id,created_on:o.a.now(),image_file:[t],status:"待提交"};return r.save(i)}))})).catch((function(e){return $log.error(e),n.a.reject(e)}))},saveByPicture:function(e,t){return e?l.a.getBatch(t).then((function(t){var i={proj_id:t.proj_id,bidsection_id:t.bidsection_id,batch_id:t.id,deadline:t.repair_deadline,batch_type:t.batch_type,created_by:a.a.getUser().user_id,created_on:o.a.now(),image_file:[{temp:e}],status:"待提交"};return r.save(i)})).catch((function(e){return $log.error(e),n.a.reject(e)})):n.a.when()},createProblem:function(e,t){return l.a.getBatch(t).then((function(t){var i={proj_id:t.proj_id,bidsection_id:t.bidsection_id,batch_id:t.id,deadline:t.repair_deadline,batch_type:t.batch_type,created_by:a.a.getUser().user_id,created_on:o.a.now(),image_file:[{temp:e}],status:"待提交"};return r.save(i)}))},takePicture:function(){return s.a.takePicture()},allowSelectPicture:function(){return w.a.getValue("upload_from_phone_albums").then((function(e){return"1"===e}))},reinspectByConflict:function(t){return e.isEmpty(t.reinspectBy)?n.a.when():v.a.removeProblemReinspectBy(t.reinspectBy[0].checkquality_problem_id).then((function(){return v.a.insertReinspectByList(t.reinspectBy)})).then((function(){return TodoRepository.removeProblemTodo(t.reinspectBy[0].checkquality_problem_id)})).then((function(){return TodoRepository.insertTodoList(t.todo)}))},copyProblem:function(t){return n.a.all([_.a.getProblemAllColumn(t),y.a.getRepairAllColumn(t),v.a.getReinspectAllColumn(t),v.a.getReinspectByList(t),b.a.getProblemCCAllColumn(t)]).then((function(t){var i=t[0],r=t[1],c=t[2],s=t[3],l=t[4];if(i.id=o.a.uuid(),i.status="待提交",i.regist_by="",i.repair_by="",i.repair_remark="",i.repair_date="",i.repair_image_file="",i.sent_back_by="",i.sent_back_date="",i.sent_back_times=0,i.sent_back_remark="",i.sent_back_image_file="",i.reinspect_by="",i.reinspect_completed_date="",i.close_date="",i.close_reason="",i.created_by=a.a.getUser().user_id,i.created_on=o.a.now(),i.modified_by=a.a.getUser().user_id,i.download_time="",i.update_timestamp="",i.repair_deadline&&!i.deadline&&i.regist_date){for(var d=i.repair_deadline.match(/\d+/g),u=0;u<d.length;u++)d[u]=parseInt(d[u]);for(var p=new Date(d[0],d[1]-1,d[2],d[3]||0,d[4]||0,d[5]||0),m=i.regist_date.match(/\d+/g),f=0;f<m.length;f++)m[f]=parseInt(m[f]);var h=new Date(m[0],m[1]-1,m[2],m[3]||0,m[4]||0,m[5]||0);i.deadline=Math.ceil((p.getTime()-h.getTime())/864e5)}i.regist_date="",i.repair_deadline="",e.each(r,(function(e){e.id=o.a.uuid(),e.checkquality_problem_id=i.id,e.download_time=""})),e.each(c,(function(e){e.id=o.a.uuid(),e.checkquality_problem_id=i.id,e.download_time=""})),e.each(s,(function(e){e.id=o.a.uuid(),e.checkquality_problem_id=i.id,e.reinspect_date="",r.reinspect_remark="",r.reinspect_image_file="",e.download_time=""}));var g=e.filter(l,(function(e){return"默认"===e.type}));return g=e.map(g,(function(e){return{id:e.cc}})),l=e.filter(l,(function(e){return"被抄送"===e.type})),l=e.map(l,(function(e){return{id:e.cc}})),n.a.all([_.a.insert(i),y.a.insert(r),v.a.insertReinspect(c),v.a.insertReinspectByList(s),b.a.saveProblemCC(i.id,l),b.a.saveDefaultCc(i.id,g)])}))},removeLocalInvalidProblem:function(t){var i=n.a.when();return t.problem_repair&&(i=i.then((function(){return y.a.removeInvalidData(t.problem.id,e.map(t.problem_repair,"id"))}))),t.problem_reinspect&&(i=i.then((function(){return v.a.removeInvalidData(t.problem.id,e.map(t.problem_reinspect,"id"))}))),t.problem_cc&&(i=i.then((function(){return b.a.removeInvalidData(t.problem.id,e.map(t.problem_cc,"id"))}))),t.children_Problem&&(i=i.then((function(){return _.a.removeInvalidChildProblem(t.problem.id,t.children_Problem)}))),i},removeLocalInvalidProblem1:function(t,i){var r=i.checkquality_problem;return n.a.when().then((function(){if(i.checkquality_problem)return _.a.deleteProblemById(r.id)})).then((function(){if(i.checkquality_repair)return y.a.removeInvalidData(r.id,e.map(i.checkquality_repair,"id"))})).then((function(){if(i.checkquality_cc)return b.a.removeInvalidData(r.id,e.map(i.checkquality_cc,"id"))}))},removeClosedBatchProblem:function(){return l.a.getClosedBatchIdList().then((function(e){return r.deleteBatchProblems(e)}))},deleteBatchProblems:function(t){return $log.log("删除已关闭批次的问题"),_.a.getProblemsByBatch(t).then((function(t){var i=n.a.when(),r=["image_file","repair_image_file","sent_back_image_file"],a=[];return e.each(t,(function(t){for(var i=0;i<r.length;++i){var n=t[r[i]]=JSON.parse(t[r[i]]||"[]");e.each(n,(function(e){e.local&&a.push(e.local),e.thumbnail&&a.push(e.thumbnail),e.temp&&a.push(e.temp)}))}})),e.each(a,(function(e){i=i.then((function(){return c.a.isFileExists(e)})).then((function(t){if(t)return c.a.deleteFile(e)}))})),i})).then((function(){return _.a.deleteProblemByBatch(t)}))},getLeaderComments:function(t){return _.a.getLeaderComments(t).then((function(t){return e.each(t,(function(e){e.user={id:e.user_id,name:e.user_name,mobile:e.mobile,is_im_user:e.is_im_user},e.image_file&&(e.image_file=JSON.parse(e.image_file))})),t}))},getPhotoRequired:function(e,t){var i=g.a.state.global.allGrayRelease.UsingProjectParameter;return P.a.getProjParameter(e,"is_photo_required",t).then((function(e){return i&&e&&e.length?Number(e[0].value):g.a.state.global.isPhotoRequired[t]})).catch((function(e){console.log("error",e)}))}},t.a=r}).call(this,i("391c"))},"5c19":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .content-not-empty[data-v-43042f0d] .layout-content{display:auto;overflow:auto;padding-bottom:100px}.zjapp .check-guide-detail-hd[data-v-43042f0d]{margin-left:30px;padding:25px 30px 5px 0}.zjapp .check-guide-detail-title[data-v-43042f0d]{margin:0;line-height:20px;font-size:18px;color:#111;font-weight:700;word-break:break-all}.zjapp .check-guide-detail-info[data-v-43042f0d]{line-height:20px;font-size:14px;color:#8c8c8c}.zjapp .check-guide-detail-content[data-v-43042f0d]{padding:30px;line-height:30px;color:#333;font-size:16px}.zjapp .check-guide-detail-content p[data-v-43042f0d]{margin-bottom:30px;min-height:1em}.zjapp .check-guide-detail-content img[data-v-43042f0d]{max-width:100%}.zjapp .check-guide-detail-content .img-not-ready[data-v-43042f0d]{width:80px;height:auto}.zjapp .error[data-v-43042f0d]{max-width:50%}",""])},6810:function(e,t,i){"use strict";i("1448")},7378:function(e,t,i){"use strict";var r=i("fa4f"),n=i("eb36"),a=i.n(n),o=i("6bf2"),c=i.n(o),s={name:"ProblemList",components:{ItemList:r.a},props:{edit:{type:Boolean,default:function(){return!1}},list:{type:Array,default:function(){return[]}}},data:function(){return{png_empty:a.a}},computed:{},methods:{createProblem:function(){this.$emit("add")},openProblemDetail:function(e){this.$emit("clickItem",e)},formatDate:function(e){return c()(e).format("YYYY-MM-DD HH:mm")}}},l=(i("8e66"),i("17cc")),d=Object(l.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"problem-wrap"},[i("div",{staticClass:"problem-wrap-title"},[i("div",{staticClass:"problem-title"},[e._v("问题列表("+e._s(e.list.length)+")")]),e.edit?i("div",{staticClass:"problem-btn",on:{click:e.createProblem}},[e._v("新增")]):e._e()]),i("div",{staticClass:"problem-list"},[e.list&&e.list.length?e._l(e.list,(function(t,r){return i("item-list",{key:r,attrs:{"is-unread":t.unread,"is-timeout":t.is_timeout,"is-urgent":"紧急"==t.emergency_degree||"特急"==t.emergency_degree,"is-return":t.sent_back_times>0,img:t.thumbnail,title:t.item_full_name,detail:t.desc||""+t.remark||"",footer:e.formatDate(t.created_on)+" "+(t.place||""),status:t.status,"status-text":t.status},on:{click:function(i){e.openProblemDetail(t)}}})})):[i("div",{staticClass:"empty"},[i("img",{attrs:{src:e.png_empty,alt:""}}),i("span",[e._v("暂无新增问题")])])]],2)])}),[],!1,null,"4cfa77e4",null);t.a=d.exports},"7c70":function(e,t,i){"use strict";(function(e){i("5ab2"),i("e10e");var r,n,a,o,c,s,l=i("28f8"),d=(i("06a2"),i("6d57"),i("163d"),i("6a61"),i("2e91")),u=i("8693"),p=i("162a"),m=i("48f4"),f=i("c058"),h=i("1b7e"),g=i("e2a7");function _(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function b(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?_(Object(i),!0).forEach((function(t){Object(l.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.a={networkTest:(s=Object(d.a)(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getHasNetwork();case 2:if(e.sent){e.next=6;break}return g.a.alert("当前无网络"),e.abrupt("return",Promise.reject());case 6:return e.next=8,g.a.confirm({message:t,okText:"删除",cancelText:"取消",className:"dialog-customize confirm-color-red"});case 8:return(i=e.sent)&&g.a.loading("正在提交..."),e.abrupt("return",Promise.resolve(i));case 11:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)}),measureCheckItemsRest:(c=Object(d.a)(regeneratorRuntime.mark((function t(i){var r,n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r={special_inspect_ids:i.map((function(e){return e.special_inspect_id})).join(",")},$log.log("专项巡检-实测实量-检查项重置-请求的参数：",r),t.next=5,p.a.post("/online/special-inspect/delete-data-of-checkitem",null,r);case 5:if(n=t.sent,!Number(n.errcode)||0===Number(n.errcode)){t.next=8;break}return t.abrupt("return",Promise.reject(n));case 8:return a=[],e.forEach(i,(function(e){var t={remark:"",status:"未设置",image_file:"[]",id:e.special_inspect_id,download_time:n.update_timestamp},i={id:e.id,group_id:"",measurement_points:"",problem_points:"",problem_values:"",problem_values_zip:""};$log.log("专项巡检-实测实量-检查项重置-请求的参数："," special_inspect => ",t," special_inspect_measure_item =>",i);var r=u.a.updateSpecialInspectData(t),o=u.a.updateSpecialInspectMeasureItem(i),c=m.default.removeSyncGroup(e.special_inspect_id);a.push(r,o,c)})),t.next=12,Promise.all(a);case 12:return $log.log("专项巡检-实测实量-检查项重置-成功"),t.abrupt("return",Promise.resolve());case 16:return t.prev=16,t.t0=t.catch(0),$log.log("专项巡检-实测实量-检查项重置-error：",t.t0),t.abrupt("return",Promise.reject(t.t0));case 20:case"end":return t.stop()}}),t,null,[[0,16]])}))),function(e){return c.apply(this,arguments)}),postDeleteProblem:(o=Object(d.a)(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.a.post("/online/problem-secure/delete",null,{id:t});case 3:if(i=e.sent,!Number(i.errcode)||0===Number(i.errcode)){e.next=6;break}return e.abrupt("return",Promise.reject(i));case 6:return e.abrupt("return",Promise.resolve(i));case 9:return e.prev=9,e.t0=e.catch(0),$log.log("专项巡检-删除问题-error：",e.t0),e.abrupt("return",Promise.reject(e.t0));case 13:case"end":return e.stop()}}),e,null,[[0,9]])}))),function(e){return o.apply(this,arguments)}),postRestCheckItemTemplate11:(a=Object(d.a)(regeneratorRuntime.mark((function e(t){var i,r,n,a,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.specialInspectId,r=t.placeCheckitemId,n=t.problemIds,$log.log("专项巡检-观感模板-删除检查项内容-传入数据：",t),a={special_inspect_ids:i,place_checkitem_id:r},e.next=6,p.a.post("/online/special-inspect/delete-data-of-checkitem",null,a);case 6:if(o=e.sent,!Number(o.errcode)||0===Number(o.errcode)){e.next=9;break}return e.abrupt("return",Promise.reject(o));case 9:return e.next=11,this.sqlDeleteProblem(n);case 11:return $log.log("专项巡检-观感模板-删除检查项内容-删除问题成功"),c={id:r,status:"未设置",remark:null,checker:"",image_file:"[]",deduction:null,download_time:o.update_timestamp},$log.log("更新special_inspect_place_checkitem数据：",c),e.next=16,u.a.updatePlaceSpecialInspectData(c);case 16:return $log.log("专项巡检-观感模板-删除检查项内容-删除检查项的内容成功"),e.next=19,m.default.removeSyncGroup(r);case 19:return $log.log("专项巡检-观感模板-删除检查项内容-删除上传队列成功"),e.abrupt("return",Promise.resolve());case 23:return e.prev=23,e.t0=e.catch(0),$log.log("专项巡检-删除问题-error：",e.t0),e.abrupt("return",Promise.reject(e.t0));case 27:case"end":return e.stop()}}),e,this,[[0,23]])}))),function(e){return a.apply(this,arguments)}),postRestProblemCheckitem:(n=Object(d.a)(regeneratorRuntime.mark((function t(i){var r,n,a,o,c,s,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=i.specialInspectId,n=i.restSpecialField,a=void 0===n?{}:n,$log.log("专项巡检-重置检查项内容-传入数据：",i),o={special_inspect_ids:r},t.next=6,p.a.post("/online/special-inspect/delete-data-of-checkitem",null,o);case 6:if(c=t.sent,!Number(c.errcode)||0===Number(c.errcode)){t.next=9;break}return t.abrupt("return",Promise.reject(c));case 9:return s=b({id:r,status:"未设置",remark:null,image_file:"[]",download_time:c.update_timestamp},a),$log.log("更新special_inspect数据：",s),t.next=13,u.a.updateSpecialInspectData(s);case 13:return $log.log("专项巡检-重置检查项内容-重置成功"),t.next=16,m.default.removeSyncGroup(r);case 16:return $log.log("专项巡检-重置检查项内容-删除上传队列成功"),t.next=19,u.a.getProblemBySpecialInspect(r);case 19:return l=t.sent,(l=e.map(l,(function(e){return e.id})))&&this.sqlDeleteProblem(l),t.abrupt("return",Promise.resolve());case 25:return t.prev=25,t.t0=t.catch(0),$log.log("专项巡检-重置检查项-error：",t.t0),t.abrupt("return",Promise.reject(t.t0));case 29:case"end":return t.stop()}}),t,this,[[0,25]])}))),function(e){return n.apply(this,arguments)}),sqlDeleteProblem:(r=Object(d.a)(regeneratorRuntime.mark((function e(t){var i,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>1&&void 0!==a[1]&&a[1],e.prev=1,Array.isArray(t)||(t=[t]),$log.log("专项巡检-删除问题-传入ids：",t),e.next=6,u.a.deleteProblemAllIds(t);case 6:return $log.log("专项巡检-删除问题-删除问题表和关联表成功"),r=[],t.forEach((function(e){r.push(m.default.removeSyncGroup(e))})),e.next=11,Promise.all(r);case 11:if($log.log("专项巡检-删除问题-删除上传队列成功"),i){e.next=18;break}return n=[],t.forEach((function(e){var t=f.a.addLog({relation_id:e,business_type:"special-inspect",event:"删除"});n.push(t)})),e.next=17,Promise.all(n);case 17:$log.log("专项巡检-删除问题-添加删除业务日志");case 18:return e.abrupt("return",Promise.resolve());case 21:return e.prev=21,e.t0=e.catch(1),$log.log("专项巡检-删除问题-error：",e.t0),e.abrupt("return",Promise.reject(e.t0));case 25:case"end":return e.stop()}}),e,null,[[1,21]])}))),function(e){return r.apply(this,arguments)})}}).call(this,i("391c"))},"7d4e":function(e,t,i){var r=i("c59b");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,i("85cb").default)("62c5f5a2",r,!0,{sourceMap:!1,shadowMode:!1})},"7e59":function(e,t,i){"use strict";(function(e){i("6a61");var r,n=i("2e91"),a=(i("cc57"),i("f369")),o=i("07d2"),c=i("e68e"),s=i("774b"),l=i("cd05"),d=i("7378"),u=i("6bf2"),p=i.n(u),m=i("e2a7"),f=i("3bd5"),h=i("6e1b"),g=i("114f"),_=i("6f9e"),b=i("7c70"),y=f.a.getUser();t.a={name:"CheckEdit",components:{CheckGuide:a.a,Item:o.default,ItemImgList:c.a,Scroller:s.default,UserSelect:l.a,ProblemList:d.a},data:function(){return{isLoading:!0,specialInspectId:"",placeId:"",isBatchPlaceMode:!1,detailData:{},problemList:[],editable:!1,allowRest:!1}},computed:{title:function(){return this.detailData&&this.detailData.checkitem&&this.detailData.checkitem.name||""},checkitemRule:function(){var e=this.detailData&&this.detailData.checkitem&&this.detailData.checkitem.extension||{};return e.rating_rule&&e.rating_rule.value||""}},created:function(){var e=this;Object(_.d)((function(t){t.id===e.problemData.id&&e.loadData()}))},activated:function(){this.specialInspectId=this.$route.query.specialInspectId,this.placeId=this.$route.query.placeId,this.isBatchPlaceMode=!!this.placeId,this.$router.isBack||(this.isLoading=!0),this.init()},methods:{fomatDate:function(e){return p()(e).format("YYYY-MM-DD HH:mm")},init:function(){var e=this;return this.getDetailData().then((function(){return e.getBatchData(e.detailData.batch_id)})).then((function(){return e.getProblemList()})).finally((function(){e.isLoading=!1})).catch((function(t){$log.error(t),e.detailData={}}))},getDetailData:function(){var e=this;return this.specialInspectId?Promise.resolve().then((function(){return e.isBatchPlaceMode?h.a.getPlaceSpecialInspectData(e.specialInspectId,e.placeId):h.a.getSpecialInspectData(e.specialInspectId)})).then((function(t){e.detailData=t})):Promise.reject("缺少参数")},getBatchData:function(t){var i=this;return t?h.a.getBatchDetailAndCheckers(t).then((function(t){var r=e.some(t.checkers,{user_id:y.user_id});return i.editable="检查完毕"!==t.status&&r,t})).then((function(e){return h.a.getDetailToAllow(i.detailData.status,e.status,e.checkers,e.mode).then((function(e){i.allowRest=e.allowRest}))})):Promise.reject("缺少批次id")},getProblemList:function(){var e=this;return g.a.getProblemList(this.specialInspectId,this.placeId).then((function(t){e.problemList=t}))},createProblem:function(){this.$router.push({name:"SpecialInspecProblemPureEdit",query:{specialInspectId:this.specialInspectId,placeId:this.placeId}})},openProblemDetail:function(e){var t;t="草稿"===e.status?"SpecialInspecProblemPureEdit":"SpecialInspecProblemPureView",this.$router.push({name:t,query:{problemId:e.id}})},checkItemRest:(r=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={specialInspectId:this.specialInspectId,problemIds:this.problemList.map((function(e){return e.id})),placeCheckitemId:this.detailData.id},e.prev=1,e.next=4,b.a.networkTest("确定删除已检查内容与问题？\n删除的已检查内容与问题将无法找回。");case 4:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,b.a.postRestCheckItemTemplate11(t);case 9:m.a.hideLoading(),m.a.alert("删除成功"),this.$router.go(-1),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),m.a.hideLoading(),m.a.alert(e.t0.errmsg);case 18:case"end":return e.stop()}}),e,this,[[1,14]])}))),function(){return r.apply(this,arguments)})}}}).call(this,i("391c"))},"81f2":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,'.zjapp .main[data-v-2cac8864]{position:fixed;width:100%;bottom:0}.zjapp .arrow[data-v-2cac8864]{position:absolute;top:-7px;right:18px;width:0;height:0;border-bottom:7px solid #fff;border-right:7px solid transparent;border-left:7px solid transparent}.zjapp .content[data-v-2cac8864]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.4);overflow:hidden}.zjapp .box[data-v-2cac8864]{display:flex;flex-direction:column;background-color:#fff;overflow:auto}.zjapp .box-single[data-v-2cac8864]{display:flex;flex-direction:column;flex:1}.zjapp .detail-hd[data-v-2cac8864]{display:flex;padding:6px 15px}.zjapp .detail-arrow-right[data-v-2cac8864]{width:13px;height:34px;overflow:hidden}.zjapp .detail-arrow-right[data-v-2cac8864]:before{display:block;content:"";width:0;height:0;margin-top:12px;border:5px solid transparent;border-left:5px solid #c8c8c8}.zjapp .detail-arrow-down[data-v-2cac8864]{width:13px;height:34px;overflow:hidden}.zjapp .detail-arrow-down[data-v-2cac8864]:before{display:block;content:"";width:0;height:0;margin-top:15px;border:5px solid transparent;border-top:5px solid #c8c8c8}.zjapp .detail-title[data-v-2cac8864]{flex:1;line-height:34px;color:#111;font-size:16px}.zjapp .detail-bd[data-v-2cac8864]{padding:8px 15px 8px 35px;background-color:#fafafa}.zjapp .text-line[data-v-2cac8864]{font-size:14px;color:#666;line-height:30px;margin-bottom:30px}.zjapp .detail-hd-single[data-v-2cac8864]{padding:6px 0;margin:0 15px}.zjapp .detail-bd-single[data-v-2cac8864]{display:flex;flex-direction:column;flex:1;padding:8px 15px;background-color:#fff}',""])},"8e66":function(e,t,i){"use strict";i("0dc2")},"8fdd":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .problem-wrap-title[data-v-4cfa77e4]{display:flex;justify-content:space-between;align-items:center;font-size:14px;color:#666;padding-left:15px;height:43px}.zjapp .problem-wrap-title .problem-btn[data-v-4cfa77e4]{padding:13px 15px;color:#4275e8}.zjapp .problem-wrap .problem-list[data-v-4cfa77e4]{background:#fff}.zjapp .problem-wrap .problem-list .problem-item[data-v-4cfa77e4]{display:flex;border-bottom:1px solid #ececec;padding:12px 15px}.zjapp .problem-wrap .problem-list .problem-item img[data-v-4cfa77e4]{width:70px;height:70px;background:coral;margin-right:10px}.zjapp .problem-wrap .problem-list .problem-item .content[data-v-4cfa77e4]{margin-right:10px;flex:1;display:flex;flex-direction:column;justify-content:space-between}.zjapp .problem-wrap .problem-list .problem-item .content .desc[data-v-4cfa77e4]{font-size:16px;color:#333;line-height:22px}.zjapp .problem-wrap .problem-list .problem-item .content .date[data-v-4cfa77e4]{color:#999;line-height:20px}.zjapp .problem-wrap .problem-list .problem-item .status[data-v-4cfa77e4]{display:flex;align-items:center;color:#0bc666}.zjapp .problem-wrap .problem-list .empty[data-v-4cfa77e4]{padding:40px 0;display:flex;flex-direction:column;align-items:center;color:#999}.zjapp .problem-wrap .problem-list .empty img[data-v-4cfa77e4]{width:150px;margin-bottom:24px}",""])},"91c1":function(e,t,i){"use strict";(function(e){i("5ab2"),i("6d57"),i("e10e"),i("9a33");var r=i("28f8"),n=i("e68e"),a=i("6f9e"),o=i("bcc7"),c=i("e89f");function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){Object(r.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.a={name:"CheckGuideDetailDrop",components:{ItemImgList:n.a},mixins:[c.a],data:function(){return{show:!1,showList:!1,isLoading:!1,isOpening:!1,isClosing:!1,contentTop:64,listHeight:510,module:"",itemIds:[],data:[],target:""}},watch:{show:function(e){var t=this;e&&this.$nextTick((function(){t.showList=!0}))}},created:function(){a.a.$on("routerBeforeEach",this.closePopup),a.a.$on("pageContentClick",this.onClickOther)},destroyed:function(){a.a.$off("routerBeforeEach",this.closePopup),a.a.$off("pageContentClick",this.onClickOther)},methods:{openPopup:function(t){this.show=!0,this.$emit("open"),this.module=t.module,this.itemIds=t.itemIds,this.options=t.options;var i=document.querySelector(".layout-main .layout-header");if(this.contentTop=i.offsetHeight,t.el){var r=t.el.getBoundingClientRect();this.contentTop=r.bottom}this.target=t.el,this.listHeight=e.minBy([window.innerHeight-this.contentTop-50,510]),this.getData()},closePopup:function(){var e=this;if(!this.isOpening)return this.showList=!1,this.$emit("close"),new Promise((function(t){e.$on("afterClosePopup",t)}))},afterClose:function(){this.show=!1,this.isClosing=!1,this.$emit("afterClosePopup")},onClickOther:function(e){e&&e.target&&e.target!==this.target&&this.show&&this.closePopup()},getData:function(){var t=this;return this.options&&this.options.length?(this.data=e.map(this.options,(function(e){return l(l({},e),{},{isOpen:!1})})),Promise.resolve()):o.a.getMeasureCheckItem(this.itemIds).then((function(i){t.data=e.map(i,(function(t){var i=t.content?t.content.trim():"",r=i?i.split("\n"):[],n=t.content_image?JSON.parse(t.content_image):[],a=e.filter(r,(function(e){return!/<img([\s\S]*)>/gm.test(e)}));return e.each(n,(function(e){e.url=e.url.split("@")[0]})),{id:t.id,name:t.full_name,textArr:a,contentImage:n,isOpen:!1}}))})).catch((function(e){console.error(e)}))},toggleItem:function(e){this.data.length>1&&this.$set(e,"isOpen",!e.isOpen)}}}}).call(this,i("391c"))},"967a":function(e,t,i){"use strict";var r=i("8d95");t.a={REPAIR_DEADLINE_STATUS:{name:"repair_deadline_status",status:["待整改"],module:[r.a.CHECK]}}},"9b25":function(e,t,i){"use strict";i("b09a")},b09a:function(e,t,i){var r=i("2939");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,i("85cb").default)("65170d73",r,!0,{sourceMap:!1,shadowMode:!1})},c59b:function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .item-list{position:relative;padding:10px;display:flex;align-items:center;background-color:#fff;min-height:100px}.zjapp .item-list .img{display:block;width:80px;height:80px;background:no-repeat 50%;background-size:cover;background-color:#ddd}.zjapp .item-list .item-list-con{flex:1;padding:0 15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.zjapp .item-list .item-list-con .title{height:30px;line-height:24px;color:#111;font-size:16px;padding-top:6px;margin:0;padding-right:10px;margin-right:-10px;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important;font-weight:400}.zjapp .item-list .item-list-con .title .type-tag{display:inline-block;height:16px;line-height:16px;padding:0 4px;border-radius:2px;border:1px solid #4275e8;color:#4275e8;font-size:12px;zoom:.8;margin:3px 0 0 0;vertical-align:text-top}.zjapp .item-list .item-list-con .text{height:30px;line-height:24px;color:#8c8c8c;padding-bottom:6px;padding-right:11px;margin-right:-10px}.zjapp .item-list .item-list-con .text,.zjapp .item-list .item-list-con .time{font-size:14px;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important}.zjapp .item-list .item-list-con .time{height:20px;line-height:20px;color:#b3b3b3;padding-right:11px!important;margin-right:-10px!important}.zjapp .item-list .item-list-con .time .ion{color:#a6a6a6;font-size:20px;font-weight:700;margin-right:5px;vertical-align:top}.zjapp .item-list .item-list-r{width:60px;line-height:18px;text-align:center}.zjapp .item-list .item-list-status{min-width:4em;line-height:18px;text-align:center;white-space:normal;font-size:14px}.zjapp .item-list .icon-unread{display:inline-block;text-align:center;width:12px;height:12px;border-radius:6px;background-color:red}.zjapp .item-list .icon-return,.zjapp .item-list .icon-timeout,.zjapp .item-list .icon-urgent{display:inline-block;width:16px;height:16px;text-align:center;line-height:16px;font-size:12px;font-style:normal;color:#fff;border-radius:2px;-webkit-border-radius:2px;vertical-align:top;margin-top:4px;margin-right:5px}.zjapp .item-list .icon-timeout{background:#964bfe}.zjapp .item-list .icon-return{background:#fe8b00}.zjapp .item-list .icon-urgent{background:#ff3c3d}.zjapp .item-list .icon-return:last-child,.zjapp .item-list .icon-timeout:last-child,.zjapp .item-list .icon-urgent:last-child{margin-right:0}.zjapp .item-list-tip{height:70px;line-height:60px;color:#b4b4b4;text-align:center}.zjapp .status-new-tag{position:absolute;right:0;top:0;width:50px;height:50px;overflow:hidden;z-index:10}.zjapp .status-new-tag>.tag{position:absolute;right:-32px;bottom:22px;height:20px;line-height:20px;width:100px;color:#fff;font-size:12px;transform:rotate(45deg);text-align:center;border-width:1px;border-style:solid}.zjapp .time-status{font-size:10px;color:#999}",""])},d0fb:function(e,t,i){"use strict";(function(e){var r=i("fd50"),n=i("bcc7"),a=i("515e"),o=i("e89f"),c=i("07d2"),s=i("7bac"),l=i("a7c3"),d=i("4360");t.a={name:"CheckGuideList",components:{Item:c.default},mixins:[o.a],store:d.a,props:{data:{type:String,default:""}},data:function(){return{show:!1,isLoading:!0,listData:[],module:"",itemId:"",batchId:"",sectionId:"",options:""}},computed:{moduleAttribute:function(){return this.$store.state.global.moduleAttribute}},mounted:function(){this.data=[]},methods:{openPopup:function(t){var i,n=this;for(var a in this.value=!0,this.show=!0,this.module=t.module,this.itemId=t.itemId,this.batchId=t.batchId,this.sectionId=t.sectionId,this.options=t.options,this.$emit("open"),t)this[a]=t[a];this.checkType={check:31,"check-safety":36,"check-quality":37,"measure-v3":41,process:32,"fly-inspect":101}[this.module];var o=!1;e.isEmpty(this.itemId)?!e.isEmpty(this.checkType)&&e.isEmpty(this.sectionId)?i=this.initByType():e.isEmpty(this.batchId)?e.isEmpty(this.options)?e.isEmpty(this.sectionId)?i=r.a.when():(o=!0,i=this.initByBidsection()):i=this.initByOptions():i=this.initByBatch():i=this.initById(),this.isLoading=!0,i.then((function(t){var i=n.moduleAttribute[n.module]||{};!e.isEmpty(i)&&i.setUsualItems&&o?s.a.getUserKey(n.mmkvCode()).then((function(e){e=null===e?t:n.mergeArray(n.deepClone(t),e),n.listData=e||[],n.isLoading=!1})):(n.listData=t||[],n.isLoading=!1)}))},mmkvCode:function(){var e=this.moduleAttribute[this.module]||{};return l.a[e.mmkv_item]+"_"+this.sectionId},mergeArray:function(t,i){var r=this;return e.filter(t,(function(t){var n=i[t.id];return e.isEmpty(t.subitem)||(t.subitem=r.mergeArray(t.subitem,i)),!e.isEmpty(n)||"desc"===t.type}))},closePopup:function(){this.value=!1,this.show=!1,this.$emit("close")},clickItem:function(e){e.subitem&&e.subitem.length?this.$set(e,"isOpen",!e.isOpen):"special-inspect"===this.module?a.a.openPopup({itemId:e.id,module:this.module}):a.a.openPopup({itemId:e.item_id,module:this.module})},initById:function(){var e=this;if("special-inspect"!==this.module)return n.a.getCheckItem(this.itemId,this.checkType).then((function(t){return t?e.sectionId?n.a.getBidSectionCheckItemListByCode(e.sectionId,t.code):n.a.getCheckItemTreeByCode(t.code):r.a.when()}))},initByType:function(){return n.a.getCheckItemGuidelineList(this.checkType)},initByBatch:function(){return r.a.when()},initByBidsection:function(){return n.a.getBidSectionCheckItemTreeByType(this.sectionId,this.checkType)},initByOptions:function(){return r.a.resolve(this.options)},deepClone:function(e){return JSON.parse(JSON.stringify(e))}}}}).call(this,i("391c"))},dc98:function(e,t,i){"use strict";i("0732")},dd16:function(e,t,i){"use strict";(function(e){t.a={name:"StatusText",props:{status:{type:String},text:{type:String},extend:{type:Object,default:function(){return{}}}},data:function(){return{classSet:e.extend({"草稿":"color-gray","暂存":"color-gray","检查中":"color-orange","待整改":"color-red","待复验":"color-orange","待验收":"color-red","待报验":"color-red","待申请进场":"color-red","待初验":"color-red","待送检":"color-red","待上传报告":"color-red","待退场":"color-red","待建设单位验收":"color-red","待区域验收":"color-red","供应链退回":"color-red","预创建":"color-status-blue","已提交":"color-green","已整改":"color-green","已验收":"color-green","已通过":"color-green","已退场":"color-gray","已关闭":"color-gray","非正常关闭":"color-gray","已退回":"color-red","已完成":"color-green","已甩项":"color-gray","检查完毕":"color-green","送检合格":"color-green","复验合格":"color-green","验收合格":"color-green","验收不合格":"color-red","未验收":"color-orange","待点评":"color-orange","已点评":"color-green","合格":"color-green","不合格":"color-red","进度正常":"color-green","进度滞后":"color-red","正常":"color-green","滞后":"color-red","施工单位验收合格":"color-green","监理单位验收合格":"color-green","建设单位验收合格":"color-green","施工单位验收不合格":"color-red","监理单位验收不合格":"color-red","建设单位验收不合格":"color-red"},this.extend)}},mounted:function(){}}}).call(this,i("391c"))},f1e4:function(e,t,i){"use strict";(function(e){i("5ab2"),i("e10e");var r=i("28f8"),n=(i("9e76"),i("6d57"),i("9a33"),i("f548"),i("cc57"),i("4ad6")),a=i("e89f"),o=i("bcc7"),c=i("3122"),s=i("6e1b"),l=i("c130"),d=i("0636");function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){Object(r.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.a={name:"CheckGuideDetail",components:{},mixins:[a.a],data:function(){return{show:!1,isLoading:!0,isImageDownloading:!1,title:"",content:[],module:"",itemId:""}},methods:{openPopup:function(t){var i=this;for(var r in this.value=!0,this.show=!0,this.module=t.module,this.itemId=t.itemId,this.$emit("open"),t)this[r]=t[r];this.checkType={check:31,"check-safety":36,"check-quality":37,"measure-v3":41,process:32,"fly-inspect":101}[this.module],this.isLoading=!0,("special-inspect"===this.module?s.a.getSpecialInspectCheckItemDetail(this.itemId):"templet-plan"===this.module?l.a.getTempletDetail(this.itemId):"material"===this.module?d.a.getMaterialDetail(this.itemId):o.a.getCheckItem(this.itemId,this.checkType)).then((function(t){console.log("checkitemData",t),i.checkitemData=t,i.title=t.full_name||t.name,"special-inspect"!==i.module&&"inspect"!==i.module&&"fly-inspect"!==i.module&&"material"!==i.module||(t.content=t.guideline||t.content);var r=t.content?t.content.trim():"";if(r=(r=(r=(r=(r=r.replace(/<\/p><p>/gm,"\n")).replace(/<p>/gm,"")).replace(/<\/p>/gm,"")).replace(/<br>/gm,"")).replace(/<br \/>/gm,""),/(<img[^\>]*>)/gm.test(r)){var n=r.split(/(<img[^\>]*>)/gm);(n=n.filter((function(e){return!!e}))).forEach((function(e,t){e&&!/^\s*\n/.test(e)&&t&&!/\n\s*$/.test(n[t-1])&&(n[t]="\n"+e)})),r=n.join("")}var a=r?r.split("\n"):[];i.content=e.map(a,(function(e,t){var i;if(/<img([\s\S]*)>/gm.test(e)){var r=e.split(/\ssrc="([^"]*)"/gm)[1],n=r?r.match(/[\w|-]{36}/gm)[0]:(new Date).getTime()+"-"+t;i={isImg:!0,src:"",url:r,status:"pending",id:n,ready:!0}}else i={isImg:!1,val:e};return i})),i.downloadImage(),i.isLoading=!1})).catch((function(e){$log.log(e)}))},closePopup:function(){this.value=!1,this.show=!1,this.$emit("close")},getThumbnail:function(e){return"pending"===e.status?c.a.IMAGE_LOADING:"rejected"===e.status?c.a.IMAGE_RELOAD:"dev"===APP_ENV?e.url:"fulfilled"===e.status?e.src:($log.log("检查指引-显示图片：",e),c.a.IMAGE_PLACEHOLD)},imgError:function(e,t){$log.error("检查指引-加载图片出现错误：",e);var i=p({},e);i.status="rejected",this.$set(this.content,t,i)},downloadImage:function(t){var i=this;t=t?[t]:this.imageList(),e.each(t,(function(t){var r=p({},t),n=e.map(i.content,(function(e){return e.id})).indexOf(t.id);c.a.isNeedDownload(t.url).then((function(e){e?c.a.download(t.url).then((function(e){r.status="fulfilled",r.src=c.a.fixUrl(e),i.$set(i.content,n,r)})).catch((function(e){$log.error("检查指引-下载图片：",e)})):(r.status="fulfilled",r.src=c.a.fixUrl(c.a.getPathFromUrl(t.url)),i.$set(i.content,n,r))}))}))},imageList:function(){return e.filter(this.content,(function(e){return e.isImg}))},imgClick:function(t){var i=this;if("pending"===t.status)return!1;if("rejected"===t.status)return this.downloadImage(t),$log.log("检查指引-点击重新加载-重新下载图片：",t),!1;var r=this.imageList(),a=e.map(r,(function(e){return e.id})).indexOf(t.id);r=e.map(r,(function(e){return i.getThumbnail(e)})),n.a.openImageBrowser(r,a)}}}}).call(this,i("391c"))},f369:function(e,t,i){"use strict";var r=i("fd50"),n=i("bcc7"),a=i("329b"),o=i("d0fb").a,c=(i("9b25"),i("17cc")),s=Object(c.a)(o,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"slide-right"}},[e.show?i("page-content",{attrs:{mode:"dialog",title:"检查指引","on-close":e.closePopup}},[!e.isLoading&&e.listData.length?i("div",{staticClass:"page-scroll"},e._l(e.listData,(function(t,r){return i("div",{key:r},[i("item",{attrs:{border:"bottom","icon-right":t.subitem&&t.subitem.length?t.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){e.clickItem(t)}}},[i("div",{staticClass:"item-text fw-b color-blue one-line"},[e._v(e._s(t.item_name))])]),t.isOpen?e._l(t.subitem,(function(t,r){return i("div",{key:r,staticClass:"sublist"},[i("item",{staticClass:"pl0",attrs:{border:"bottom","icon-right":t.subitem&&t.subitem.length?t.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){e.clickItem(t)}}},[i("div",{staticClass:"item-text checkitem-list-name"},[e._v(e._s(t.item_name))])]),t.isOpen?e._l(t.subitem,(function(t,r){return i("div",{key:r,staticClass:"sublist"},[i("item",{staticClass:"pl0",attrs:{border:"bottom","icon-right":t.subitem&&t.subitem.length?t.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){e.clickItem(t)}}},[i("div",{staticClass:"item-text checkitem-list-name"},[e._v(e._s(t.item_name))])]),t.isOpen?e._l(t.subitem,(function(t,r){return i("div",{key:r,staticClass:"sublist"},[i("item",{staticClass:"pl0",attrs:{border:"bottom","icon-right":t.subitem&&t.subitem.length?t.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){e.clickItem(t)}}},[i("div",{staticClass:"item-text checkitem-list-name"},[e._v(e._s(t.item_name))])])],1)})):e._e()],2)})):e._e()],2)})):e._e()],2)}))):e._e(),i("loading-status",{attrs:{"is-loading":e.isLoading,"is-empty":!e.listData.length,"empty-text":"没有检查项"}})],1):e._e()],1)}),[],!1,null,"74102c05",null).exports,l=!1;l||(l=new(a.default.extend(s))({el:document.createElement("div")}),document.body.appendChild(l.$el));var d=l,u=i("515e"),p=i("91c1").a,m=(i("dc98"),Object(c.a)(p,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.show?i("div",{staticClass:"main",style:{top:e.contentTop+"px"}},[i("i",{staticClass:"arrow"}),i("div",{staticClass:"content",on:{click:function(t){return t.target!==t.currentTarget?null:e.closePopup(t)}}},[i("transition",{attrs:{name:"slide-down"},on:{enter:function(t){e.isOpening=!0},"after-enter":function(t){e.isOpening=!1},leave:function(t){e.isClosing=!0},"after-leave":e.afterClose}},[e.showList?i("div",{staticClass:"box",style:{height:e.listHeight+"px"}},e._l(e.data,(function(t,r){return i("div",{key:r,class:{"border-bottom":e.data.length>1,"box-single":1===e.data.length}},[i("div",{staticClass:"detail-hd",class:{"border-bottom":e.data.length<=1,"detail-hd-single":e.data.length<=1},on:{click:function(i){e.toggleItem(t)}}},[e.data.length>1?i("i",{class:{"detail-arrow-right":!t.isOpen,"detail-arrow-down":t.isOpen}}):e._e(),i("div",{staticClass:"detail-title"},[e._v(e._s(t.name))])]),e.data.length<=1||t.isOpen?i("div",{staticClass:"detail-bd",class:{"detail-bd-single":e.data.length<=1}},[e._l(t.textArr,(function(t,r){return i("p",{key:r,staticClass:"text-line"},[e._v("\n              "+e._s(t)+"\n            ")])})),i("item-img-list",{attrs:{editabled:!1},model:{value:t.contentImage,callback:function(i){e.$set(t,"contentImage",i)},expression:"item.contentImage"}}),i("loading-status",{attrs:{"is-empty":!t.textArr.length&&!t.contentImage.length,"empty-text":"PC端未设置检查指引"}})],2):e._e()])}))):e._e()])],1)]):e._e()}),[],!1,null,"2cac8864",null).exports),f=!1;f||(f=new(a.default.extend(m))({el:document.createElement("div")}),document.body.appendChild(f.$el));var h=f,g={name:"CheckGuide",components:{},props:{module:{type:String,default:""},mode:{type:String,default:"page"},itemId:{type:String,default:""},itemIds:{type:Array,default:function(){return[]}},batchId:{type:String,default:""},sectionId:{type:String,default:""},options:{type:Array,default:function(){return[]}},optionsPromise:{type:Function,default:function(){}},beforeOpen:{type:Function,default:function(){}}},data:function(){return{isLoading:!1}},methods:{openCheckGuide:function(){var e=this,t=this.beforeOpen&&this.beforeOpen();t instanceof Promise||(t=Promise.resolve(t)),t.then((function(t){!1!==t&&("drop"===e.mode?h.openPopup({itemIds:e.itemIds,el:e.$refs["check-guide-btn"],options:e.options}):("templet-plan"===e.module?r.a.when(!1):e.itemId&&e.sectionId?n.a.hasChildSectionCheckItem(e.itemId,e.sectionId):e.itemId?n.a.hasChildCheckItem(e.itemId):r.a.when(!0)).then((function(t){t?d.openPopup({module:e.module,itemId:e.itemId,batchId:e.batchId,sectionId:e.sectionId,options:e.options}):u.a.openPopup({itemId:e.itemId,module:e.module})})))}))}}},_=Object(c.a)(g,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"check-guide-btn",staticClass:"header-btn",on:{click:function(t){e.openCheckGuide()}}},[i("icon",{attrs:{name:"nav-info"}})],1)}),[],!1,null,null,null);t.a=_.exports},fa4f:function(e,t,i){"use strict";var r=i("4aef"),n=i("967a"),a={name:"ItemList",components:{StatusText:r.a},props:{img:{type:String,default:""},title:{type:String,default:""},detail:{type:String,default:""},footer:{type:String,default:""},status:{type:String,default:""},isShowNewStatus:{type:Boolean,default:!1},statusText:{type:String,default:""},statusClassSet:{type:Object,default:function(){return{}}},typeTag:{type:String,default:""},isUnread:{type:Boolean,default:!1},isTimeout:{type:Boolean,default:!1},isUrgent:{type:Boolean,default:!1},isReturn:{type:Boolean,default:!1},repairDeadline:{type:String,default:null}},data:function(){return{repairDeadlineStatus:n.a.REPAIR_DEADLINE_STATUS.status}},computed:{bgNewClass:function(){return{"草稿":"bg-gray7 b-color","暂存":"bg-gray b-color","检查中":"bg-orange b-color","待整改":"bg-red2 b-color ","待复验":"bg-purple b-color","待验收":"bg-red b-color","待报验":"bg-red b-color","待申请进场":"bg-red b-color","待初验":"bg-red b-color","待送检":"bg-red b-color","待上传报告":"bg-red b-color","待退场":"bg-red b-color","待建设单位验收":"bg-red b-color","待区域验收":"bg-red b-color","已提交":"bg-green b-color","已整改":"bg-green b-color","已验收":"bg-green b-color","已通过":"bg-green2 b-color","已退场":"bg-gray b-color","已关闭":"bg-gray7 b-color","非正常关闭":"bg-gray b-color","已退回":"bg-red b-color","已完成":"bg-green b-color","已甩项":"bg-gray b-color","检查完毕":"bg-green b-color","送检合格":"bg-green b-color","复验合格":"bg-green b-color","验收合格":"bg-green b-color","验收不合格":"bg-red b-color","未验收":"bg-orange b-color","待点评":"bg-orange b-color","已点评":"bg-green b-color","合格":"bg-green b-color","不合格":"bg-red b-color","进度正常":"bg-green2 b-color","进度滞后":"bg-red2 b-color","施工单位验收合格":"bg-green b-color","监理单位验收合格":"bg-green b-color","建设单位验收合格":"bg-green b-color","施工单位验收不合格":"bg-red b-color","监理单位验收不合格":"bg-red b-color","建设单位验收不合格":"bg-red b-color"}}},activated:function(){}},o=(i("19a9"),i("17cc")),c=Object(o.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._g({staticClass:"item-list border-bottom"},e.$listeners),[e.isShowNewStatus?i("div",{staticClass:"status-new-tag"},[i("div",{staticClass:"tag",class:e.bgNewClass[e.status]},[e._v("\n      "+e._s(e.status)+"\n    ")])]):e._e(),e.img?i("div",{staticClass:"img",style:{"background-image":"url("+e.img+")"}}):e._e(),i("div",{staticClass:"item-list-con"},[i("h2",{staticClass:"title"},[e.isUnread?i("i",{staticClass:"icon-unread"}):e._e(),e.isTimeout?i("i",{staticClass:"icon-timeout"},[e._v("\n        超\n      ")]):e._e(),e.isUrgent?i("i",{staticClass:"icon-urgent"},[e._v("\n        急\n      ")]):e._e(),e.isReturn?i("i",{staticClass:"icon-return"},[e._v("\n        退\n      ")]):e._e(),e.$slots.title?e._t("title"):[e.typeTag?i("span",{staticClass:"type-tag"},[e._v(e._s(e.typeTag))]):e._e(),e._v("\n        "+e._s(e.title||"")+"\n      ")]],2),i("p",{staticClass:"text"},[e._v(e._s(e.detail||""))]),e.$slots.footer?e._t("footer"):i("p",{staticClass:"time",domProps:{innerHTML:e._s(e.footer||"")}})],2),e.status&&!e.isShowNewStatus?i("div",{staticClass:"item-list-status"},[i("status-text",{attrs:{status:e.status,text:e.statusText,extend:e.statusClassSet}}),e.repairDeadline&&e.repairDeadlineStatus.includes(e.status)?i("p",{staticClass:"time-status"},[e._v("\n      "+e._s(e._f("timeStatus")(e.repairDeadline))+"\n    ")]):e._e()],1):e._e()])}),[],!1,null,null,null);t.a=c.exports},fe9e:function(e,t,i){"use strict";i("3cd8")}}]);