(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-4a10e10a","chunk-1cd94a56","chunk-2709989a"],{"0732":function(e,t,i){var a=i("81f2");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("1b5b07de",a,!0,{sourceMap:!1,shadowMode:!1})},"0aac":function(e,t,i){"use strict";i("2814")},2334:function(e,t,i){var a=i("b1fe");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("3e5e876f",a,!0,{sourceMap:!1,shadowMode:!1})},2596:function(e,t,i){"use strict";i("e4cd")},2814:function(e,t,i){var a=i("5033");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("9db19832",a,!0,{sourceMap:!1,shadowMode:!1})},"2ebb":function(e,t,i){"use strict";(function(e){i("c904");var a=i("fd50"),n=i("1b7e"),o=i("3bd5"),s=i("e2a7"),c=i("ed08"),r=i("c518"),l=i("16c6"),d=i("f97c"),h=i("0136"),p=i("48f4"),u=i("14c3"),f=i("a500"),m=i("7cb8"),g=i("a7bc"),v=i("6144"),A=i("bc69"),b=i("4360"),x=null,y="",w="",_="",k="",P="",I=o.a.getUser(),C="",D="",O="",j="{}",S=!1,E=!1,R="",B="",T=null,z=(a.a.when(),l.a.processDraft);function M(t){var i=a.a.when(),n=[];return e.each(t.checkPointDetail,(function(e){i=i.then((function(){return function(e){var t={id:e.id,title:e.title,checkpoint_id:e.checkpoint_id,content:e.content,image_file:Object(m.o)(e.image_file),problem_values:Object(m.o)(e.problem_values),sort:e.sort,is_open:e.isOpen?1:0,process_accept_id:e.process_accept_id};return a.a.when().then((function(){return t.process_accept_id=t.process_accept_id||P,l.a.saveAcceptDetail(t)})).then((function(t){return e.id=t,t}))}(e).then((function(e){n.push(e)}))}))})),i.then((function(){e.each(x.checkPointDetail,(function(e,t){e.id=n[t]}))}))}function H(t){if(!x.isEdit)return a.a.reject("无法编辑...");if(t=t||!1,S&&!t||E)return a.a.reject("正在保存数据...");E=!0;var i=JSON.parse(JSON.stringify(x));return function(e,t){var i={id:P,proj_id:O,bidsection_id:t.baseInfo.sectionId,item_id:y,building_id:90!==C?w:"",unit:90!==C&&(_||t.unit)||"",status:e?"待移交":t.status,pile_data:j&&"{}"!==j?j:t.pile_data||"{}",accept_by:I.user_id,process_mode:C,created_by:I.user_id,pile_address:t.pileAddress||"",created_on:c.a.now(),location_id:90===C?t.locationId?t.locationId:_||w:"",custom_location:t.acceptData.custom_location||""};return a.a.when().then((function(){return P?l.a.getAcceptData(P).then((function(e){return e?l.a.updateAccept(i):l.a.save(i,t.cachedHandOverPlace).then((function(e){P=e}))})):l.a.save(i,t.cachedHandOverPlace).then((function(e){P=e}))}))}(t,i).then((function(){return M(i)})).then((function(){return t=i.cc,a=e.map(t,(function(e){return{id:e.id,type:"抄送人"}})),e.isEmpty(a)&&(a=[{id:"",type:"抄送人"}]),l.a.saveAcceptUsers(P,a,"抄送人");var t,a})).then((function(){return t=i.partners,a=[],e.each(t,(function(e){a.push({id:e.id,type:"同验人"})})),0===a.length&&a.push({id:"",type:"同验人"}),l.a.saveAcceptUsers(P,a,"同验人");var t,a})).then((function(){if(x.isSingleRoom&&x.cachedHandOverPlace[0].roomtype_diagram)return l.a.updateHandOverRooms(P,x.cachedHandOverPlace)})).then((function(){u.a.clear()})).then((function(){return z.remove(T)})).finally((function(){E=!1}))}t.a={data:function(){return{model:{isLoading:!0,checkPointDetail:[]},checkItemId:"",deliverType:"",canBeModified:!1,draft:null,cachedHandOverPlace:[]}},activated:function(){this.init()},methods:{init:function(){var t=this;I=o.a.getUser(),S=!1,E=!1,R="",T=null,a.a.when(),z=l.a.processDraft,x=this.model=r.a.createInstance(),D=d.a.getDefaultProject(),O=D?D.id:"",y=this.checkItemId=this.$route.query.check_item_id,w=this.$route.query.building_id,_=this.$route.query.unit,k=this.$route.query.status,P=this.$route.query.process_accept_id,C=this.deliverType=parseInt(this.$route.query.deliver_type),this.cachedHandOverPlace=v.a.getObject(A.a.PROCESS_ACCEPT_HAND_OVER_PLACE,v.a.level.user),j=this.$route.query.point,this.canBeModified=b.a.state.user.isSuper,B=this.$route.query.primaryKeys&&JSON.parse(this.$route.query.primaryKeys)||{},4!==C&&90!==C||P||(P=c.a.uuid()),x.draft=null,x.checkItemId=y,x.buildingId=w,x.pile_data=j,x.primaryKeys=e.extend(B,{deliverType:C,processAcceptId:P}),$log.log("工序验收 primaryKeys：",x.primaryKeys),z.config({deliverType:C,buildingId:w,checkpointId:y,locationId:_||w,model:x,modelKeys:["primaryKeys","checkPointDetail","partners","cc","pileAddress","pile_data","acceptData","cachedHandOverPlace","buildingId","checkItemId"]}),T=l.a.createPrimaryKeys(x.primaryKeys,this.cachedHandOverPlace&&this.cachedHandOverPlace.length>1?this.cachedHandOverPlace:[]),z.get(T).then((function(e){var i=a.a.when();return"已验收"===k?e&&($log.log("工序验收 状态已验收，存在草稿，删除草稿",e),i=i.then((function(){return z.remove(T)}))):(x.draft=e,$log.log("工序验收 暂存数据：",e)),i.finally((function(){return x.init(P,k,w,_,y,C).then((function(){return u.a.getRecoverData().then((function(e){return e&&"process-accept"===e.module?e.processAcceptId!==P?a.a.resolve():u.a.getRecoverMedia().then((function(i){return $log.log("恢复工序验收数据",e,i),f.a.addTrack("工序验收v1-闪退恢复","",""),x.recoverData(e,i).then((function(){e.processAcceptId&&(x.primaryKeys=x.primaryKeys||{},x.primaryKeys.processAcceptId=e.processAcceptId,T=l.a.createPrimaryKeys(x.primaryKeys)),t.saveDraft()}))})).then((function(){u.a.clear()})):a.a.resolve()}))})).catch((function(e){console.error(e)}))}))}))},togglePoint:function(t){var i,a,n,o=(i=e.some(x.checkPointDetail,(function(e){return!!e.id})),a=!e.isEmpty(x.partners),n=!e.isEmpty(x.cc),i||a||n);this.$set(t,"isOpen",!t.isOpen),o&&this.changeImage(t)},changeImage:function(e){this.saveDraft(),u.a.clear()},prepareTakePicture:function(t){$log.log("当前验收点",t),u.a.save({module:"process-accept",details:e.clone(x.checkPointDetail),point:t,pileAddress:x.pileAddress,processAcceptId:P,cachedHandOverPlace:x.cachedHandOverPlace})},cancelTakePicture:function(){u.a.clear()},checkPileAddressEffective:function(){if(4===this.deliverType)return""===x.pileAddress||null===x.pileAddress||void 0===x.pileAddress?a.a.reject("请先填写桩号"):l.a.isPileAddressExist(w,y,P,this.deliverType,x.pileAddress).then((function(e){if(e)return a.a.reject("此桩号已存在，请重新输入")}))},saveDraft:function(e){var t=this;return x.isEdit?(e=e||!1,S&&!e?a.a.reject("正在保存数据..."):a.a.when().then((function(){return t.checkPileAddressEffective()})).then((function(){return x.isChanged=!0,z.save(T)})).catch((function(e){return s.a.alert(e),a.a.reject(e)}))):a.a.reject("无法编辑...")},changePartners:function(){this.saveDraft()},changeCC:function(){this.saveDraft()},save:function(){var e=this;return this.saveDraft().then((function(){return s.a.alert("保存成功").then((function(){e.$router.go(-1)}))}))},submit:function(){var e=this,t="已验收",i=!1;if(E)return s.a.alert("正在暂存数据...");var n=x.acceptData,o=x.baseInfo;if(90===C&&!x.acceptData.custom_location)return s.a.alert("请填写验收部位");if(4===C&&!x.pileAddress)return s.a.alert("请填写桩号");if(!x.checkPointDetail.length)return s.a.alert("请设置验收点");for(var c=0;c<x.checkPointDetail.length;c++)x.checkPointDetail[c].image_file.length?i=!0:t="待验收";return i?(S=!0,a.a.when().then((function(){if(90===C)return l.a.isCustomLocationDuplicate(o.itemId,o.locationId,n.custom_location,P)})).then((function(e){if(e)return a.a.reject("此部位已存在，不可重复")})).then((function(){return e.checkPileAddressEffective()})).then((function(){if("已验收"!==t)return s.a.confirm("确认提交？",{okText:"提交",cancelText:"取消"});e.showSubmitMenu=!0})).then((function(i){i&&e.submitData(t)})).catch((function(e){s.a.alert(e)})).finally((function(){S=!1}))):s.a.alert("至少需拍摄一张验收照片")},submitData:function(t){var i=this;return x.isChanged=!1,H(!0).then((function(){return l.a.submit(P,x.checkPointDetail.length,t).then((function(){i.$router.go(-1)}))})).then((function(){return h.a.saveTodo({biz_id:P,type:2,module_code:"process-accept",proj_id:D.id})})).then((function(){var e;e=[{id:I.user_id,type:"验收人"}],l.a.saveAcceptor(P,e)})).then((function(){return a.a.all([l.a.getDetailUserId(P),l.a.getBussindessDraft()]).then((function(t){var i=e.map(t[0],"id"),a=e.map(t[1],"id"),n=e.intersection(i,a);return l.a.removeDraft(n)}))}))},submitProcess:function(e){var t=e.status;this.submitData(t),this.showSubmitMenu=!1},deleteDraft:function(){var e=this;return f.a.addTrack("工序验收v1-删除草稿","","工序验收v1"),s.a.confirm("确认删除？").then((function(t){if(t){var i=a.a.when();x.draft&&(i=i.then((function(){return z.remove(T)}))),P&&(i=i.then((function(){return l.a.deleteAcceptData(P)}))),i.then((function(){e.$router.go(-1)}))}}))},deleteDetail:function(){var e=this;return s.a.confirm("此操作将删除本条记录的全部内容且不可恢复，确定删除？",{okText:"删除"}).then((function(t){if(t&&P)return n.a.getHasNetwork().then((function(t){if(t)return l.a.deleteAcceptDetail(P).then((function(){return p.default.setLocalChanged(),h.a.removeTodo(P)})).then((function(){return z.remove(T)})).then((function(){e.$router.go(-1)}));s.a.alert("请检查网络")}))}))},pointImageEdit:function(t){var i=this,a=x.cachedHandOverPlace[0].drawing_file[0]?x.cachedHandOverPlace[0].drawing_file[0].url:"";return g.a.open({url:a,images:t.image_file,points:t.problem_values,checkPointDetail:x.checkPointDetail,checkPointId:t.id,checkPointDetailId:t.checkpoint_id,mode:x.isEdit?"edit":"view",processAcceptId:P,callback:function(a){t.image_file=a.images,t.problem_values=a.points,x.checkPointImgSet=[],e.each(x.checkPointDetail,(function(t){x.checkPointImgSet=e.union(x.checkPointImgSet,t.image_file)})),x.checkPointImageModels=e.map(x.checkPointDetail,(function(e){return{model:e.image_file,id:e.id,checkpoint_id:e.checkpoint_id,field:"image_file",table:"process_accept_detail"}})),i.saveDraft()}})},pointImageView:function(){var t=x.cachedHandOverPlace[0].drawing_file[0]?x.cachedHandOverPlace[0].drawing_file[0].url:"",i=[];e.each(x.checkPointDetail,(function(e){i=i.concat(e.image_file)})),g.a.open({url:t,images:i,points:x.problem_values_view,created_by:x.acceptData.acceptor.id,mode:"view"})},savePileAddressTemp:function(){R=x.pileAddress},saveCustomLocation:function(){var e=this;a.a.when().then((function(){if(4===e.deliverType){if(""===x.pileAddress||null===x.pileAddress||void 0===x.pileAddress){if(""===R||null==R)return a.a.reject("请先填写桩号");x.pileAddress=R}return e.checkPileAddressEffective()}})).then((function(){e.saveDraft()})).catch((function(e){s.a.alert(e)}))},savePileAddress:function(){var e=!!P;P||(P=c.a.uuid());var t={id:P,proj_id:O,bidsection_id:x.baseInfo.sectionId,item_id:y,building_id:w,unit:_||"",status:"待移交",pile_data:j,accept_by:I.user_id,process_mode:C,created_by:I.user_id,pile_address:x.pileAddress||"",created_on:c.a.now()};return l.a.saveAccept(t,e)},blurPileAddress:function(){}}}}).call(this,i("391c"))},"302b":function(e,t,i){"use strict";i("8934")},3411:function(e,t,i){"use strict";i("ef1c")},5033:function(e,t,i){var a=i("5454");(e.exports=i("690e")(!1)).push([e.i,".zjapp .drawing-con[data-v-fba5990a]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;font-size:0;line-height:0}.zjapp .drawing-con canvas[data-v-fba5990a]{display:block;height:100%;width:100%;background:url("+a(i("eb66"))+") #fff;background-size:4px 4px}.zjapp .loading-text[data-v-fba5990a]{margin-top:15px;color:#aaa}.zjapp .error-text[data-v-fba5990a],.zjapp .loading-text[data-v-fba5990a]{padding:0 15px;line-height:20px;text-align:center;font-size:16px}.zjapp .error-text[data-v-fba5990a]{color:#ff3d3d}",""])},"515e":function(e,t,i){"use strict";var a=i("329b"),n=i("f1e4").a,o=(i("302b"),i("17cc")),s=Object(o.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"slide-right"}},[e.show?i("page-content",{class:{"content-not-empty":e.content.length},attrs:{mode:"dialog",title:"检查指引","on-close":e.closePopup}},[!e.isLoading&&e.title?i("div",{staticClass:"check-guide-detail-hd border-bottom"},[i("h2",{staticClass:"check-guide-detail-title pb10"},[e._v(e._s(e.title))])]):e._e(),!e.isLoading&&e.content.length?i("div",{staticClass:"check-guide-detail-content"},e._l(e.content,(function(t,a){return i("span",{key:a},[t.isImg&&t.src?i("p",[i("img",{class:{"img-not-ready":!t.ready,error:"rejected"===t.status},attrs:{src:e.getThumbnail(t)},on:{error:function(i){e.imgError(t,a)},click:function(i){e.imgClick(t)}}})]):e._e(),t.isHref&&t.url?i("span",{staticClass:"href-text",on:{click:function(i){e.openHref(t.url)}}},[e._v("\n          "+e._s(t.val)+"\n        ")]):i("span",[e._v("\n          "+e._s(t.val)+"\n        ")]),t.joinBrToSplitLine?i("br"):e._e()])}))):e._e(),i("loading-status",{attrs:{"is-loading":e.isLoading,"is-empty":!e.content.length,"empty-text":"PC端未设置检查指引"}})],1):e._e()],1)}),[],!1,null,"092cce02",null).exports,c=!1;c||(c=new(a.default.extend(s))({el:document.createElement("div")}),document.body.appendChild(c.$el));t.a=c},"58c5":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .process-accept-detail-header{background-color:#fff;padding:10px 15px}.zjapp .process-accept-detail-header .process-accept-detail-title{font-size:18px;color:#111;margin-bottom:10px}.zjapp .process-accept-detail-header .process-accept-detail-content{height:auto;line-height:20px;font-size:14px;color:#8c8c8c}.zjapp .process-accept-detail-list{position:relative;padding-top:1px;padding-bottom:1px;padding-left:0}.zjapp .process-accept-detail-list .process-accept-detail-item-header{position:relative;align-items:center}.zjapp .content-bottom-btn-con{text-align:center}.zjapp .delete-btn{display:inline-block!important;padding:3px 10px!important;width:80px!important;height:28px!important;border:1px solid #dcdcdc!important;background:transparent!important;line-height:20px!important;text-align:center!important;font-size:14px!important;color:#666!important;border-radius:14px!important}.zjapp .process-accept-point-content{font-size:14px;background-color:#f0f0f0;padding:10px;color:#666;border-radius:3px}.zjapp .process-accept-icon-sys{position:absolute;left:0;width:4px;height:16px;background-color:#4275e8}.zjapp .process-accept-edit-content{display:flex;flex-direction:column}.zjapp .process-accept-detail-img-list{padding:15px}.zjapp .bar-fixed-buttons{background-color:#fff;border:none;background-image:linear-gradient(180deg,#dcdcdc,#dcdcdc 100%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:top;display:flex;flex-direction:horizontal;justify-content:center}.zjapp .btn-text-blue{display:block;padding:10px;margin:0 auto;width:auto;height:40px;line-height:20px;font-size:14px;color:#7a95d1;border:none;background:transparent}",""])},"5bbb":function(e,t,i){"use strict";(function(e){var a=i("3e83");i("2b45");function n(t){switch(function(e){if(null===e)return"null";var t=Object.prototype.toString.call(e);return t.substring(8,t.length-1).toLocaleLowerCase()}(t)){case"object":return function(e){if(function(e){if("object"!==Object(a.a)(e)||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e)){var t=new e.constructor;for(var i in e)t[i]=n(e[i]);return t}return e}(t);case"array":return function(e){for(var t=new e.constructor(e.length),i=0;i<e.length;i++)t[i]=n(e[i]);return t}(t);default:return e.clone(t)}}t.a=n}).call(this,i("391c"))},6481:function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .content-not-empty[data-v-092cce02] .layout-content{display:auto;overflow:auto;padding-bottom:100px}.zjapp .check-guide-detail-hd[data-v-092cce02]{margin-left:30px;padding:25px 30px 5px 0}.zjapp .check-guide-detail-title[data-v-092cce02]{margin:0;line-height:20px;font-size:18px;color:#111;font-weight:700;word-break:break-all}.zjapp .check-guide-detail-info[data-v-092cce02]{line-height:20px;font-size:14px;color:#8c8c8c}.zjapp .check-guide-detail-content[data-v-092cce02]{padding:30px;line-height:30px;color:#333;font-size:16px}.zjapp .check-guide-detail-content p[data-v-092cce02]{margin-bottom:30px;min-height:1em}.zjapp .check-guide-detail-content img[data-v-092cce02]{max-width:100%}.zjapp .check-guide-detail-content .img-not-ready[data-v-092cce02]{width:80px;height:auto}.zjapp .check-guide-detail-content .href-text[data-v-092cce02]{text-decoration:underline;color:#4275e8}.zjapp .error[data-v-092cce02]{max-width:50%}",""])},"81f2":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,'.zjapp .main[data-v-2cac8864]{position:fixed;width:100%;bottom:0}.zjapp .arrow[data-v-2cac8864]{position:absolute;top:-7px;right:18px;width:0;height:0;border-bottom:7px solid #fff;border-right:7px solid transparent;border-left:7px solid transparent}.zjapp .content[data-v-2cac8864]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.4);overflow:hidden}.zjapp .box[data-v-2cac8864]{display:flex;flex-direction:column;background-color:#fff;overflow:auto}.zjapp .box-single[data-v-2cac8864]{display:flex;flex-direction:column;flex:1}.zjapp .detail-hd[data-v-2cac8864]{display:flex;padding:6px 15px}.zjapp .detail-arrow-right[data-v-2cac8864]{width:13px;height:34px;overflow:hidden}.zjapp .detail-arrow-right[data-v-2cac8864]:before{display:block;content:"";width:0;height:0;margin-top:12px;border:5px solid transparent;border-left:5px solid #c8c8c8}.zjapp .detail-arrow-down[data-v-2cac8864]{width:13px;height:34px;overflow:hidden}.zjapp .detail-arrow-down[data-v-2cac8864]:before{display:block;content:"";width:0;height:0;margin-top:15px;border:5px solid transparent;border-top:5px solid #c8c8c8}.zjapp .detail-title[data-v-2cac8864]{flex:1;line-height:34px;color:#111;font-size:16px}.zjapp .detail-bd[data-v-2cac8864]{padding:8px 15px 8px 35px;background-color:#fafafa}.zjapp .text-line[data-v-2cac8864]{font-size:14px;color:#666;line-height:30px;margin-bottom:30px}.zjapp .detail-hd-single[data-v-2cac8864]{padding:6px 0;margin:0 15px}.zjapp .detail-bd-single[data-v-2cac8864]{display:flex;flex-direction:column;flex:1;padding:8px 15px;background-color:#fff}',""])},8934:function(e,t,i){var a=i("6481");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("266da06d",a,!0,{sourceMap:!1,shadowMode:!1})},"91c1":function(e,t,i){"use strict";(function(e){i("5ab2"),i("6d57"),i("e10e"),i("9a33");var a=i("28f8"),n=i("e68e"),o=i("6f9e"),s=i("bcc7"),c=i("e89f");function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){Object(a.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.a={name:"CheckGuideDetailDrop",components:{ItemImgList:n.a},mixins:[c.a],data:function(){return{show:!1,showList:!1,isLoading:!1,isOpening:!1,isClosing:!1,contentTop:64,listHeight:510,module:"",itemIds:[],data:[],target:""}},watch:{show:function(e){var t=this;e&&this.$nextTick((function(){t.showList=!0}))}},created:function(){o.a.$on("routerBeforeEach",this.closePopup),o.a.$on("pageContentClick",this.onClickOther)},destroyed:function(){o.a.$off("routerBeforeEach",this.closePopup),o.a.$off("pageContentClick",this.onClickOther)},methods:{openPopup:function(t){this.show=!0,this.$emit("open"),this.module=t.module,this.itemIds=t.itemIds,this.options=t.options;var i=document.querySelector(".layout-main .layout-header");if(this.contentTop=i.offsetHeight,t.el){var a=t.el.getBoundingClientRect();this.contentTop=a.bottom}this.target=t.el,this.listHeight=e.minBy([window.innerHeight-this.contentTop-50,510]),this.getData()},closePopup:function(){var e=this;if(!this.isOpening)return this.showList=!1,this.$emit("close"),new Promise((function(t){e.$on("afterClosePopup",t)}))},afterClose:function(){this.show=!1,this.isClosing=!1,this.$emit("afterClosePopup")},onClickOther:function(e){e&&e.target&&e.target!==this.target&&this.show&&this.closePopup()},getData:function(){var t=this;return this.options&&this.options.length?(this.data=e.map(this.options,(function(e){return l(l({},e),{},{isOpen:!1})})),Promise.resolve()):s.a.getMeasureCheckItem(this.itemIds).then((function(i){t.data=e.map(i,(function(t){var i=t.content?t.content.trim():"",a=i?i.split("\n"):[],n=t.content_image?JSON.parse(t.content_image):[],o=e.filter(a,(function(e){return!/<img([\s\S]*)>/gm.test(e)}));return e.each(n,(function(e){e.url=e.url.split("@")[0]})),{id:t.id,name:t.full_name,textArr:o,contentImage:n,isOpen:!1}}))})).catch((function(e){console.error(e)}))},toggleItem:function(e){this.data.length>1&&this.$set(e,"isOpen",!e.isOpen)}}}}).call(this,i("391c"))},"94fb":function(e,t,i){var a=i("5454");(e.exports=i("690e")(!1)).push([e.i,".zjapp .peocess-accept-point-image-detail[data-v-5e150fb7]{position:absolute;top:0;left:0;height:100px;width:100%;padding:0 42px;background-color:rgba(0,0,0,.8)}.zjapp .peocess-accept-point-image-remove[data-v-5e150fb7]{position:absolute;left:5px;top:34px;width:32px;height:32px;background:url("+a(i("ec2c"))+");background-size:32px 32px}.zjapp .peocess-accept-point-image-save[data-v-5e150fb7]{position:absolute;right:5px;top:34px;width:32px;height:32px;background:url("+a(i("be38"))+");background-size:32px 32px}.zjapp .peocess-accept-point-image-shadow-l[data-v-5e150fb7]{position:absolute;z-index:9;top:0;left:42px;width:23px;height:100px;background:url("+a(i("b8a6"))+") repeat-y;background-size:22.6667px 100px}.zjapp .peocess-accept-point-image-shadow-r[data-v-5e150fb7]{position:absolute;z-index:9;top:0;right:42px;width:23px;height:100px;background:url("+a(i("9ec9"))+") repeat-y;background-size:22.6667px 100px}.zjapp .back-button[data-v-5e150fb7]{height:44px;top:0;right:0;padding:11px 12px 11px 15px;border:none;background:none;font-size:16px;line-height:22px;color:#000}.zjapp .item-img-list-point[data-v-5e150fb7] .item-img-list{display:inline}",""])},"9ec9":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAEsCAMAAABNHeUDAAAAPFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQLyYwAAAAFHRSTlMBBQkSDUU+JioWGS5QTDIiHxw3OXG7iVMAAANESURBVHja7ZxrcuQgDIQRzMNj5zm+/113a/fHpIITbL7GyKn4AF2AhB7dwuHjZ/+/+O87/f3SKaV0u93G8f397e319Xq9DsM0vbzc7/Plcjmfz8/PT0/DEoiZDCRWgdjCSlIOMq1cSfwEMlZsJ64AmRnIVAThZ1I2cRnEFkyc6vzkcShV1rEFkNN2E4fCwWITc2cDt/gBwvwktY4n/O7c3d+dbDvkAuYgY3V4jBVBiQdqbuL8TLLt+DTx0AckkWjPM6CZLrKxlBF1K4nwTOKRAvXc0mOtAEIOtgyiT17aQP0tyLCjn0SxsyXJwXY2sQLEorjfcZN3thc5WVkOa3ueMvKVQD+heQdmQOJsUhCjt5g3CGERJG0CsZBvpwTCWYv2oaA3iPG+WJ9GMxC527cHMW3e2SuezPuYGCQvAUjObqGVcD6WV0qBnomeo5YFpShmy0c9SInJ4XRQKIPwDKi/gDPz2GFtVUDY8vBVjHWgIJBGknssv4C8yAlSdqs7axFa9jvc2XgGTFTz8kBg9hIT85WoVZXK7XA6iIeCZlwBDAWRglBn0yd0LhIVrMMOVqg0OZgrGJyV5XOBNmT8iYUHhpR75G0+B4kOTPwpsiXFShKuChh/wnVARcpYwRXMLRvJoNWLf4RyXRCdQaCudvsoAcHx5AHigKOWT31IKiUKwiMbH4o7lBBPrdO+VbEMBEX7AoiupT0OMUVysS3RhtWKpIHBY5PSy9G0RHdq2yD0oZdHN4JIP2KKyFXaDl2uF/OajUt47qdSpz1GAoIT9c3kgz1cQz8Ik1OxHWFk+y1BM/6kVaU0b4/2jLVIlD9x8FjMzGFVwEB40+RmTqkQ2bTNNR+edCCIkOTF3R6BcCqVzrPp3T4pVpJwDwitEx085csjm8/J/6nTI6DOk7ryyJa7PeDt9y0tgqAYNgAibVXMzaNCVSOZg/R6XfWTJnUltb1lIL1ezVizAXXa76j1Yhge3VBksn4nAQ09QhATC/HCbtSBXuyHZxOCjDsXw7apBHW/ncIAGBgd8TBH/eWZOPspExRYp+K0If/ZjkEQfWkRhdaBjzvcqG/iC8hF54NMG27Si908Pj254e3xLVZP1lXXsXE9yB/OoPQBm7p22AAAAABJRU5ErkJggg=="},a7bc:function(e,t,i){"use strict";var a=i("329b"),n=i("cfdc").a,o=(i("e7ce"),i("17cc")),s=Object(o.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"slide-right"},on:{afterLeave:e.onClose}},[e.show?i("page-content",{attrs:{mode:"dialog",title:"点位图","on-close":e.close}},["edit"===e.mode?i("div",{staticClass:"back-button button-clear mr0 pr10",attrs:{slot:"header-bar-right"},on:{click:e.save},slot:"header-bar-right"},[e._v("\n      保存\n    ")]):e._e(),e.showDetail?i("div",{staticClass:"peocess-accept-point-image-detail"},[i("div",{staticClass:"peocess-accept-point-image-remove",on:{click:function(t){e.removePoint()}}}),e.showLeftShadow?i("div",{staticClass:"peocess-accept-point-image-shadow-l"}):e._e(),i("scroller",{style:"width: "+(e.viewSize.width-84)+"px; margin-top:0"},[i("div",{staticClass:"item-img-list-popup item-img-list-point border-none"},[i("item-img-list",{attrs:{"prepare-callback":function(){return e.prepareTakePicture()},maxlength:50,editabled:"edit"===e.mode,"user-link":!0},model:{value:e.imageFiles,callback:function(t){e.imageFiles=t},expression:"imageFiles"}})],1)]),e.showRightShadow?i("div",{staticClass:"peocess-accept-point-image-shadow-r"}):e._e(),i("div",{staticClass:"peocess-accept-point-image-save",on:{click:function(t){e.savePoint()}}})],1):e._e(),e.url?i("drawing",{staticStyle:{flex:"1"},attrs:{url:e.url,points:e.points},on:{onclick:e.onDrawingClick}}):e._e(),e.url?e._e():i("loading-status",{attrs:{"is-empty":!e.url,"empty-text":"没有户型图","content-height":e.viewSize.contentHeight}})],1):e._e()],1)}),[],!1,null,"5e150fb7",null).exports,c=!1;c||(c=new(a.default.extend(s))({el:document.createElement("div")}),document.body.appendChild(c.$el));t.a=c},b1fe:function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .list[data-v-68affbfe]{margin-bottom:10px}.zjapp .item-base[data-v-68affbfe]{align-items:center;border:none;background-image:linear-gradient(0deg,#dcdcdc,#dcdcdc 33.3333%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}.zjapp .item-base[data-v-68affbfe] .van-icon{position:relative;display:block;padding-right:10px;margin-right:-10px;width:34px;height:34px;line-height:34px;text-align:right;font-size:20px;color:#c8c8c8}.zjapp .btn[data-v-68affbfe]{border-radius:0}.zjapp .btn-link[data-v-68affbfe]{background:#fff;color:#4275e8}",""])},b8a2:function(e,t,i){var a=i("94fb");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("0b4d1565",a,!0,{sourceMap:!1,shadowMode:!1})},b8a6:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAEsCAMAAABNHeUDAAAAPFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQLyYwAAAAFHRSTlMBBQkNFRJFPiYqGS5QTDIiHxw3OUztAEcAAAMqSURBVHja3ZsJkqswDESRAtmYnfvf9U/9SZUzS4HNa2MRDtBlS6IlteTu8vT0/Hw8Hk+n0/Tx8fIyjpfL+Xx+fX17e3+/XvvPbxgOw+Hz8/+ffX3d3VcKYsZAvARk/A0ysJNcf4D4IsiUAeJ5IGMeiNW3yVjJxcMfLrZy7ySTrHJxCrZCFy8btgPBlmAqg8wEG3IxACHB9oj/zgwIcPHfILaKlBIGJ+pi7+jD3kGcAHpccDEG4d5xhxmQs/1vw4YBsVU2cR2zbUDU6ToBwn4qAbH1Cd3bJS9MBQkEXidYVXAHshwnO+l3UFWgpwK3dnlHH/bpNoq80ylOYi1AeN7phRW1mO0jVI/fQDrE9quCLRgVDJBj6/bFBtIoSOjiSmlLEJ53OMgE+KS6i/uIIL5Aj3l6bIQih9BjAglTxybDgogt8c5UCMLlIAMijLAvXla3NuPYDqjlCQTRo2XWJwF6wJyIdekPaI3rE1t2cTDJPa/zaqSWDzIQ13ZeXAV9gGGi5DoHiYAZplWh11GCJI7lwcbnO9KqgM+Lve2Gw0FNBQGKYRCxNbc+OqQVJDmIG7ZrpuSk2zyAWq7pAUHnBZomqFpMGVqBo7Kc20Q9ENnP5DonjXqAYjidBPNJBBA8rpLUseWLggHE/6kExABIrosfxTu8VVlWt2TLTi5dp9mBMLXVkCh5uHzFCA4TxeK/ty23+jrdaLRJE1tOaPMXcz2Wd+h8gjDr4gg7w18H2fdiD6gKloOtA8EmUstzc3GAzbobSBjdnnZehSDcJha+BBWLdVy1qMj2fL7D9RPejQbbNhRr1GaSbcMoy07WuLk+1BqIGKhPWr4k4hHbS0DApi6Jk2C75SMk6lqGDdY0bb+BKZzvxHzwInoanEAibExVesrXSUCoTfgP6Mr5TiCdzYBhKT1GmBfr4sRp9QgrJXWDsOXQuYTtrXUa1b+55ut5zdj+hhFQyQERa2HeNNm+12luhg0g1s3obGGuw3MxX9rn8rJvbhMuYHJ6HOGAdRnkziTGQWgG5N5xcVXA1fL2bxAKTsLpMfzkGlTUQHvk0sdOgg0UOYAexSDzcfIPNrH3W8QMvyIAAAAASUVORK5CYII="},be38:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAaVBMVEUAAAAAAAAAAAAAAAAAAAAJoFMKtV4CHQ8AAAAAAAAIhUUAAAAAAAAAAAAAAAAAAAAAAAAAAAALvmIEOx4AAAAAAAAAAAAAAAAAAAAAAAAKplUKrVoFXjAHdDwHajcMwGMLt14IlE0LxmbmPBzHAAAAInRSTlNmAFNjHsTfbyQGqV9ZTkQ5KBXvfF4/NBgNCMzVjp6V8eS3T8DfkgAAAjRJREFUaN7NmlmaEzEMBv/IBuxe3Uz2ZAbo+x8SEbaZwUnUsvWROkDVqy0JKxFxCtuhp651ru2oH7ZhiisREMj9SMhAo4/lgZh63KBPsSjgB4c7uMGrA4EggoIqkDqI6dLiwI6wCNotChw2WMzmIA/4FgpaLw2MUDKKAnuCGtrfD0xrFLCe7gW8QxHO3w4Eh0JcuBUIqEC4HvAOFXD+WmByqIKb8oH9GpVY77MBQjUoFxhRkfHfgEdV/PvAoUVV2sO7wAaV2bwN7FCd3ZsAoTr0OpBgQHoV6GBA9zcQYEL4EyCYQL8DHkb4X4EBRgw/A9GhjE/fvp5ekMHFSyCV+j/OzBkZ0iXQl/uZIzL0PwKx2H89gMgBX8HPPCOH58BYxf8BWUYOkKEftEK09IP1k6mf9cHUz/qtqZ/1g6mf9b2pn/Vk6gehM/WzvkWW5st8eir3s94hx8vMfH4q9sNdCRznTEHhZ317I8CFQj/rO+Q4z5mCws96QpYmU1D4QeghKKj9rB8gKKj9rN9CUFD7WR8gKKj9rJ8gKWj9rI8QFZR+1q9IVtD56fJsERVUfowc8BAVVH54wdOxKfAjSh6/jd7fy57vjdaPJPyANEq/i9IvVKPyY5B/As/H0zMW462/seYfcetRgvkwxHqcYz6Qsh6pmQ8Frcea1oNZ69Gy+XDcerxvvaCwXrFYL4ms11zWi7r/v2osWpY+yrpXu7B+pJX78qOBRzx7kB9uPPLpif3xTPn5z3csI0atYW/xDAAAAABJRU5ErkJggg=="},c40a:function(e,t,i){"use strict";(function(e){i("cc57"),i("6d57"),i("6f84"),i("163d");var a=i("a32d"),n=i.n(a),o=i("e900"),s=i("3122"),c=i("4ad6"),r=i("3bd5"),l=i("1b7e");function d(e){var t=e.changedTouches.length,i=e.touches.length;return 1===t||2===t||2===i}function h(e){return 1===e.touches.length}t.a={name:"Drawing",props:{url:{type:String},points:{type:Array,default:function(){return[]}},regions:{type:Array,default:function(){return[]}},pointColor:{type:String,default:"#ff4546"},pointRadius:{type:Number,default:7},scaleMax:{type:Number,default:4},clickDelay:{type:Number,default:500},folder:{type:String,default:"house-image"},onlineMode:{type:Boolean,default:!1},contentScroll:{type:Boolean,default:!0}},data:function(){return{isDownloading:!1,error:"",canvas:null,ctx:null,img:null,src:"",width:0,height:0,x:0,y:0,scale:1,defaultScale:1,pixelRatio:1,markPosition:null,markPositionImageData:[],markCoordinates:[],pinchRatio:0,scaleBetween:[],isPinch:!1,clickPoints:[],touchStart:{x:0,y:0,cx:0,cy:0,time:0}}},watch:{url:function(){this.getImage()},points:function(e){this.ctx&&this.draw()},regions:function(e){this.ctx&&this.draw()}},mounted:function(){this.getImage()},destroyed:function(){this.canvas&&(this.canvas.width=0,this.canvas.height=0)},methods:{getImage:function(){var t=this;if(this.isDownloading=!0,this.url){var i=r.a.getUser().user_id,a=n.a.replaceAll(this.url,"\\?x-oss-process=image\\/resize,","@"),o=n.a.strRightBack(a,"/");if(!o)return this.error="户型图地址错误",void(this.isDownloading=!1);this.error="";var d=[c.a.appImagePath()+i+"/"+this.folder+"/"+o,c.a.appImagePath()+i+"/house-image/"+o,c.a.appImagePath()+i+"/drawing/"+o,c.a.appImagePath()+i+"/location-image/"+o,c.a.appImagePath()+i+"/images/"+o,c.a.appDataPath()+i+"/"+this.folder+"/"+o,c.a.appDataPath()+i+"/house-image/"+o,c.a.appDataPath()+i+"/drawing/"+o,c.a.appDataPath()+i+"/location-image/"+o,c.a.appDataPath()+i+"/images/"+o],h=Promise.resolve();return"dev"===APP_ENV||this.onlineMode?h=h.then((function(){return t.url})):e.each(d,(function(e){h=h.then((function(t){return t||c.a.isFileExists(e).then((function(t){if(t)return s.a._fixPath(e)}))}))})),h.then((function(e){if(!e)return l.a.getHasNetwork().then((function(e){return e?s.a.download(t.url,!0,t.folder).then((function(e){t.src=e})):Promise.reject("当前无网络")}));t.src=e})).then((function(){t.src?(t.img=new Image,t.img.onload=function(){t.img.complete?(t.isDownloading=!1,t.$nextTick(t.init)):(t.error="加载图片失败",t.isDownloading=!1)},t.img.onerror=function(){t.error="加载图片失败",t.isDownloading=!1},t.img.src=t.src):(t.error="下载户型图失败",t.isDownloading=!1)})).catch((function(i){t.error=e.isString(i)?i:"下载户型图失败",t.isDownloading=!1}))}this.error="户型图地址错误",this.isDownloading=!1},init:function(){if(this.$refs["drawing-canvas"]){var e=this.$refs.content;this.canvas=this.$refs["drawing-canvas"],this.ctx=this.canvas.getContext("2d"),this.width=e.offsetWidth,this.height=e.offsetHeight,this.pixelRatio=this.getPixelRatio(this.ctx),this.canvas.style.height=this.height+"px",this.canvas.style.width=this.width+"px",this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,!this.ctx.extended&&Object(o.a)(this.ctx),this.bindTouchEvent(),this.calc(),this.draw()}},getPixelRatio:function(e){var t=e.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},calc:function(e){var t=this.width/this.img.width,i=this.img.height*t,a=this.height||i;i>this.height&&(t*=a/i),this.scale=t*this.pixelRatio,this.defaultScale=this.scale,this.scaleBetween=[this.scale,this.scale*this.scaleMax]},winToCanvas:function(e,t){var i=this.canvas.getBoundingClientRect();return{x:e-i.left*(this.canvas.width/(i.width*this.pixelRatio)),y:t-i.top*(this.canvas.height/(i.height*this.pixelRatio))}},isBoundary:function(e){switch(e){case"t":if(0===this.y)return!0;break;case"r":if(this.x<=this.canvas.width-this.img.width*this.scale)return!0;break;case"b":if(this.y<=this.img.height*this.scaleBetween[0]-this.img.height*this.scale)return!0;break;case"l":if(0===this.x)return!0}return!1},bindTouchEvent:function(){this.canvas.addEventListener("touchstart",this.onTouchstart),this.canvas.addEventListener("touchmove",this.onTouchmove),this.canvas.addEventListener("touchend",this.touchMoveAndEndHandler)},unbindTouchEvent:function(){this.canvas.removeEventListener("touchstart",this.onTouchstart),this.canvas.removeEventListener("touchmove",this.onTouchmove),this.canvas.removeEventListener("touchend",this.touchMoveAndEndHandler)},onTouchstart:function(e){if(this.isPinch=!1,h(e)){var t=e.touches[0],i=this.winToCanvas(t.clientX,t.clientY);this.touchStart={x:i.x,y:i.y,cx:t.clientX,cy:t.clientY,time:Date.now()}}else if(d(e)){var a,n=e.touches[0],o=e.touches[1],s=this.winToCanvas(n.clientX,n.clientY),c=this.winToCanvas(o.clientX,o.clientY);a=Math.sqrt(Math.pow(c.x-s.x,2)+Math.pow(c.y-s.y,2)),this.pinchRatio=this.scale/a}},onTouchmove:function(e){if(!1===this.contentScroll&&(e.preventDefault(),e.stopPropagation()),h(e))this.touchStart.cy>e.pageY&&this.isBoundary("b")||this.touchStart.cy<e.pageY&&this.isBoundary("t")||this.touchStart.cx>e.pageX&&this.isBoundary("r")||this.touchStart.cx<e.pageX&&this.isBoundary("l")||e.stopPropagation(),this.touchMoveAndEndHandler(e);else if(d(e)){e.stopPropagation();var t,i,a,n,o,s=e.touches[0],c=e.touches[1],r=this.winToCanvas(s.clientX,s.clientY),l=this.winToCanvas(c.clientX,c.clientY);i=Math.sqrt(Math.pow(l.x-r.x,2)+Math.pow(l.y-r.y,2)),this.isPinch=!0,(t=this.pinchRatio*i)>this.scaleBetween[0]&&t<this.scaleBetween[1]&&(n={x:((a={x:(r.x+l.x)/2*this.pixelRatio,y:(r.y+l.y)/2*this.pixelRatio}).x-this.x)/(this.img.width*this.scale),y:(a.y-this.y)/(this.img.height*this.scale)},a.newX=this.x+this.img.width*t*n.x,a.newY=this.y+this.img.height*t*n.y,o={x:a.newX-a.x,y:a.newY-a.y},t<this.scale&&this.setRange(this.x-o.x,this.y-o.y,t),t>this.scale&&(this.x=this.x-o.x,this.y=this.y-o.y),t!==this.scale&&(this.scale=t,this.draw()))}},touchMoveAndEndHandler:function(e){var t,i,a=e.type,n={touchmove:e.touches[0],touchend:e.changedTouches[0]}[a],o=this.winToCanvas(n.clientX,n.clientY);t=(o.x-this.touchStart.x)*this.pixelRatio,i=(o.y-this.touchStart.y)*this.pixelRatio,"touchend"===a&&Date.now()-this.touchStart.time<this.clickDelay&&Math.abs(n.clientX-this.touchStart.cx)<6&&Math.abs(n.clientY-this.touchStart.cy)<6?this.clickHandler(e):"touchmove"!==a||this.isPinch||(this.touchStart.x=o.x,this.touchStart.y=o.y,this.setRange(this.x+t,this.y+i,this.scale),this.draw())},isCanClick:function(e){for(var t=!1,i=0;i<this.markPosition.length;i++)if(parseFloat(e.x)>parseFloat(this.markPosition[i].x)&&parseFloat(e.x)<parseFloat(this.markPosition[i].x)+parseFloat(this.markPosition[i].w)&&parseFloat(e.y)>parseFloat(this.markPosition[i].y)&&parseFloat(e.y)<parseFloat(this.markPosition[i].y)+parseFloat(this.markPosition[i].h)){t=!0;break}return t},clickHandler:function(e){var t=e.changedTouches[0];if(this.mark){var i=this.winToCanvas(t.clientX,t.clientY),a={x:(i.x-this.x/this.pixelRatio)/(this.img.width*this.scale/this.pixelRatio),y:(i.y-this.y/this.pixelRatio)/(this.img.height*this.scale/this.pixelRatio)};if(i={x:a.x*this.img.width,y:a.y*this.img.height},this.isCanClick(i)){this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i.x*this.scale/this.pixelRatio+this.x/this.pixelRatio,i.y*this.scale/this.pixelRatio+this.y/this.pixelRatio,this.scale===this.defaultScale?this.pointRadius:this.pointRadius*(1+(this.scale-this.defaultScale)/this.pixelRatio),0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore();var n={x:i.x,y:i.y};this.markCoordinates.push(n),this.points.push(n)}return!1}this.redraw(e,this.winToCanvas(t.clientX,t.clientY))},setRange:function(e,t,i){var a=this.img.width*i,n=this.img.height*i,o=this.canvas.width,s=this.canvas.height,c=this.img.height*this.scaleBetween[0];e=a<o?(o-a)/2:(e=e+a<o?o-a:e)>0?0:e,t=n<s?(s-n)/2:(t=t+n<c?c-n:t)>0?0:t,this.x=e,this.y=t},draw:function(){this.setRange(this.x,this.y,this.scale),this.drawImage(),this.drawPoints(),this.drawRegions()},redraw:function(e,t){this.clickPoints=[],this.drawImage(),this.drawPoints(t),this.drawRegions(t),this.clickCallback(e,this.clickPoints)},clickCallback:function(e,t){var i;t.some((function(e,t){return"points"===e.tag?(i=e,!0):(i=e,!1)}));var a=e.changedTouches[0],n=this.winToCanvas(a.clientX,a.clientY),o=(n.x-this.x/this.pixelRatio)/(this.img.width*this.scale/this.pixelRatio),s=(n.y-this.y/this.pixelRatio)/(this.img.height*this.scale/this.pixelRatio);(n={x:parseFloat((o*this.img.width).toFixed(2)),y:parseFloat((s*this.img.height).toFixed(2))}).y>=0&&n.x>=0&&n.y<=this.img.height&&n.x<=this.img.width&&this.$emit("onclick",{type:i?"point":"",points:this.points,point:i,clickPoint:i,x:n.x,y:n.y,scale:this.scale/this.pixelRatio})},drawImage:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,0,0,this.img.width,this.img.height,this.x,this.y,this.img.width*this.scale,this.img.height*this.scale)},drawPoints:function(e){var t=this;this.points.forEach((function(i,a){t.drawPoint(i.x*t.scale/t.pixelRatio+t.x/t.pixelRatio,i.y*t.scale/t.pixelRatio+t.y/t.pixelRatio,t.pointRadius,a,e,i.color)}))},drawPoint:function(e,t,i,a,n,o){this.ctx.save(),this.ctx.beginPath(),this.ctx.shadowBlur=i/2,this.ctx.shadowColor="black",this.ctx.fillStyle=o||this.pointColor,this.ctx.arc(e,t,i,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.shadowColor="transparent",this.ctx.restore(),i*=2,this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="transparent",this.ctx.fillStyle="transparent",this.ctx.rect(e-i,t-i,2*i,2*i),this.ctx.stroke(),this.ctx.restore(),n&&this.ctx.isPointInPath(n.x*this.pixelRatio,n.y*this.pixelRatio)&&this.clickPoints.push({tag:"points",pos:n,index:a})},drawRegions:function(e){var t=this;this.regions&&this.regions.length&&this.regions.forEach((function(i,a){var n,o,s,c;t.ctx.beginPath(),i.area.forEach((function(e,i){var a=e[0]*t.scale/t.pixelRatio+t.x/t.pixelRatio,r=e[1]*t.scale/t.pixelRatio+t.y/t.pixelRatio;i?t.ctx.lineTo(a,r):t.ctx.moveTo(a,r),n=void 0===n?a:n<a?n:a,o=void 0===o?a:o>a?o:a,s=void 0===s?r:s<r?s:r,c=void 0===c?r:c>r?c:r})),t.ctx.closePath(),t.ctx.fillStyle="rgba(255, 144, 0, 0.4)",t.ctx.fill(),t.ctx.lineWidth=3,t.ctx.strokeStyle="#feda8e",t.ctx.stroke(),t.ctx.lineWidth=2,t.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",t.ctx.stroke(),e&&t.ctx.isPointInPath(e.x*t.pixelRatio,e.y*t.pixelRatio)&&t.clickPoints.push({tag:"region",pos:e,index:a,regionData:i}),t.ctx.font='18px bold -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',t.ctx.textAlign="center",t.ctx.lineWidth=4,t.ctx.strokeStyle="#ffffff",t.ctx.strokeText(i.name,(o+n)/2,(c+s)/2+10),t.ctx.fillStyle="#111111",t.ctx.fillText(i.name,(o+n)/2,(c+s)/2+10)}))}}}}).call(this,i("391c"))},c518:function(e,t,i){"use strict";(function(e){i("ed63"),i("8cf2"),i("f548"),i("e697"),i("6d57"),i("cc57");var a=i("fd50"),n=i("16c6"),o=i("bcc7"),s=i("3bd5"),c=i("aab3"),r=i("bc69"),l=i("6144"),d=i("37d5"),h=i("06f6"),p=i("3122"),u=i("48f4"),f=i("7cb8"),m=i("329b"),g={isLoading:!0,baseInfo:{},checkPointDetail:[],checkPointImageModels:[],checkPointImgSet:[],cachedHandOverPlace:[],acceptData:{},placeName:"",partners:[],cc:[],process_mode:1,isChanged:!1,primaryKeys:{deliverType:0,floor:"",unitName:"",roomId:""},draft:null,init:function(t,i,o,s,c,v){var A,b;g.reset();var x=g.locationId=s||o,y=l.a.getObject(r.a.HOME_PAGE_DEFAULT_PROJECT,l.a.level.user)||{},w=g.draft;return g.isLoading=!0,d.default.getProjectUsers(y.id,[31,32,33]).then((function(e){g.partnerOptions=e,g.ccOptions=e})),A=a.a.when().then((function(){if(t)return n.a.getAcceptData(t).then((function(e){e&&(i=e.status,o=e.building_id,s=e.unit,x=e.location_id,c=e.item_id,v=e.process_mode,g.pileAddress=e.pile_address,g.pile_data=e.pile_data,g.locationId=x,g.unit=s)}))})).then((function(){g.mergePileAddress(w),g.mergeAcceptData(w),g.isEdit="已验收"!==i,g.status=i,g.process_mode=v})).then((function(){return g.getBaseInfo(c,o,s,x)})).then((function(){return t?g.getHandOverPlace(t).then((function(t){return!e.isEmpty(t)&&t.length>0?t:w&&w.cachedHandOverPlace&&w.cachedHandOverPlace.length?w.cachedHandOverPlace:l.a.getObject(r.a.PROCESS_ACCEPT_HAND_OVER_PLACE,l.a.level.user)})):w&&w.cachedHandOverPlace&&w.cachedHandOverPlace.length?w.cachedHandOverPlace:l.a.getObject(r.a.PROCESS_ACCEPT_HAND_OVER_PLACE,l.a.level.user)})).then((function(e){return-1!==[1,2,3,5].indexOf(+v)&&(g.cachedHandOverPlace=e),g.setPlaceDisplayName(o,s,v).then((function(){return e}))})).then((function(t){return 1===parseInt(v)&&1===t.length?(t[0].drawing_file=e.isArray(t[0].drawing_file)?t[0].drawing_file:Object(f.f)(t[0].drawing_file||"[]"),t[0].roomtype_diagram=e.isEmpty(t[0].drawing_file)?"":p.a.getImageFromObject(t[0].drawing_file[0]),t[0].problem_values=e.isArray(t[0].problem_values)?t[0].problem_values:Object(f.f)(t[0].problem_values||"[]"),g.isSingleRoom=!0,"已验收"!==i?h.default.getRoomTypeDiagram(t[0].id).then((function(i){if(e.isEmpty(i))t[0].drawing_file=[],t[0].roomtype_diagram="";else if(t[0].drawing_file=[i],t[0].roomtype_diagram=p.a.getImageFromObject(i),p.a.isNeedDownloadImage(t[0].drawing_file))return h.default.getRoomTypeId(t[0].id).then((function(e){return u.default.requireHouseImage(e,t[0].drawing_file).then((function(e){return t[0].drawing_file=e,t[0].roomtype_diagram=p.a.getImageFromObject(e[0]),t}))}));return t})):t):(g.isSingleRoom=!1,t)})).then((function(e){return e&&e[0].process_accept_floor_id&&g.isSingleRoom&&p.a.isNeedDownloadImage(e[0].drawing_file)?u.default.requireRedundanceImage(e[0].process_accept_floor_id,e[0].drawing_file,"process_accept_floor").then((function(t){return e[0].roomtype_diagram=p.a.getImageFromObject(t[0]),e})):e})),(b=t?A.then((function(){return n.a.getAcceptData(t).then((function(e){return e&&(g.acceptData={id:e.id,acceptor:{id:e.accept_by,name:e.acceptor_name,mobile:e.mobile,is_im_user:e.is_im_user},accept_date:e.accept_date,custom_location:e.custom_location}),n.a.getAcceptDetail(t,e?e.status:"")}))})).then((function(i){return n.a.getAcceptPartners(t).then((function(i){var o=[];return e.each(i,(function(e){var t=n.a.getAcceptUserDetail(e.id,e.process_accept_id,e.type).then((function(t){if(t.length>1)return console.log("删除同验人",e.id,e.process_accept_id,e.type),n.a.delRepeatDraftUser(e.id,e.process_accept_id,e.type).then((function(){return n.a.deleteRepeatUser(e.id,e.process_accept_id,e.type)}))}));o.push(t)})),a.a.all(o).then((function(){return n.a.getAcceptPartners(t).then((function(e){g.partners=e}))}))})).then((function(){return n.a.getAcceptCC(t).then((function(i){var o=[];return e.each(i,(function(e){var t=n.a.getAcceptUserDetail(e.id,e.process_accept_id,e.type).then((function(t){if(t.length>1)return console.log("删除抄送人",e.id,e.process_accept_id,e.type),n.a.delRepeatDraftUser(e.id,e.process_accept_id,e.type).then((function(){return n.a.deleteRepeatUser(e.id,e.process_accept_id,e.type)}))}));o.push(t)})),a.a.all(o).then((function(){return n.a.getAcceptCC(t).then((function(e){g.cc=e}))}))}))})).then((function(){return n.a.getAccept(t).then((function(t){t&&t.length&&e.each(t,(function(e){g.accepts.push({date:e.created_on,user:{id:e.user_id,name:e.name,mobile:e.mobile,is_im_user:e.is_im_user}})}))}))})).then((function(){return i&&i.length?i:g.createTempData(c)}))})):A.then((function(){return g.createTempData(c)}))).then((function(){g.partners=g.mergePartners(g.partners,w),g.cc=g.mergeCC(g.cc,w)})),b.then((function(t){e.each(t,(function(e){null!==e.is_open&&void 0!==e.is_open&&""!==e.is_open||(e.is_open=!0),e.isOpen=!g.isEdit||!!e.is_open})),t&&t.length&&e.each(t,(function(t){if(t.problem_values&&"[]"!==t.problem_values&&"[{}]"!==t.problem_values){var i=Object(f.f)(t.problem_values),a=i.reverse();a=e.uniqBy(a,(function(e){return e.x+"_"+e.y})),i.length!==a.length&&$log.warn("验收点 点位图的problem_values存在重复x/y，前端已过滤",i),t.problem_values=a.reverse()}})),g.mergeCheckPointDetail(t,w),g.checkPointImgSet=[],g.isPointImageMode=!e.some(t,(function(e){return!(!e.image_file||"[]"===e.image_file||"[{}]"===e.image_file||e.problem_values&&"[]"!==e.problem_values)})),g.checkPointImageModels=[],g.problem_values_view=[],g.image_file_view=[],t.forEach((function(t){t.image_file&&"[{}]"!==t.image_file?(t.image_file=Object(f.f)(t.image_file),m.default.prototype.$set(t)):t.image_file=[],t.problem_values?t.problem_values=Object(f.f)(t.problem_values):t.problem_values=[],g.checkPointImgSet=e.union(g.checkPointImgSet,t.image_file);var i=e.clone(t.problem_values);e.each(i,(function(e){e.point_id=t.id})),g.problem_values_view=g.problem_values_view.concat(i),g.image_file_view=g.image_file_view.concat(t.image_file),g.checkPointImageModels.push({model:t.image_file,id:t.id,checkpoint_id:t.checkpoint_id,field:"image_file",table:"process_accept_detail"})})),g.checkPointDetail=t})).then((function(){})).finally((function(){g.isLoading=!1}))},mergeAcceptData:function(e){e&&e.acceptData&&(g.acceptData=e.acceptData)},mergePileAddress:function(e){e&&e.pileAddress&&(g.pileAddress=e.pileAddress)},mergeCheckPointDetail:function(t,i){var a=s.a.getUser();return i&&i.checkPointDetail?(e.forEach(t,(function(t,n){var o=[],s=e.find(i.checkPointDetail,(function(e){return e.checkpoint_id===t.checkpoint_id}));if(e.isEmpty(s))return!1;if(!e.isEmpty(s.image_file)){var c="[{}]"===t.image_file?[]:t.image_file;c=(c=e.isObject(c)?c:Object(f.f)(c))||[],c=e.filter(c,(function(e){return e.user_id!==a.user_id}));var r=e.filter(s.image_file,(function(e){return e.user_id===a.user_id}));c.push.apply(c,r),o=e.map(c,"id"),t.image_file=Object(f.o)(c)}if(!e.isEmpty(s.problem_values)){var l=e.isObject(t.problem_values)?t.problem_values:Object(f.f)(t.problem_values);l=l||[];var d=[];e.each(s.problem_values,(function(t){e.find(l,(function(i){return i.x===t.x&&i.y===t.y&&(i.image_ids.push.apply(i.image_ids,t.image_ids),i.image_ids=e.uniqBy(i.image_ids),!0)}))||d.push(t)})),l=l.concat(d),l=e.filter(l,(function(t){return t.image_ids=e.filter(t.image_ids,(function(e){return-1!==o.indexOf(e)})),!(!t.image_ids||!t.image_ids.length)})),t.problem_values=l}})),t):t},mergePartners:function(t,i){return i&&i.partners?(t=t.concat.apply(t,i.partners),t=e.uniqBy(t,(function(e){return e.id}))):t},mergeCC:function(t,i){return i&&i.cc?(t=t.concat.apply(t,i.cc),t=e.uniqBy(t,(function(e){return e.id}))):t},createTempData:function(e){return n.a.getCheckPoints(e)},cancalRepeat:function(e){for(var t=[],i={},a=0;a<e.length;a++){var n=e[a].user.id,o=e[a].date;i[n]&&i[o]||(i[n]=!0,i[o]=!0,t.push(e[a]))}return t},getBaseInfo:function(e,t,i,n){var s=[o.a.getCheckItem(e)];return 90===g.process_mode?s.push(o.a.getSelfDefinitionPlaceInfo(n)):s.push(c.a.getBuildingInfo(t)),a.a.all(s).then((function(a){var o=a[0],s=a[1][0]||{};g.baseInfo={itemId:e,itemName:o.full_name,sectionId:s.sec_id,sectionName:s.sec_name,buildingId:t,buildingName:s.name,projName:s.proj_name,unit:i,unitName:i?i.replace("单元","")+"单元":"",locationId:n},g.selfDefinitionPlacesName=n?(s.parent_name?s.parent_name+"-":"")+s.name:""}))},setPlaceDisplayName:function(t,i,a){return g.placeName="",c.a.getBuildingRooms(t,i).then((function(t){var i=g.cachedHandOverPlace;if(1===a){var n=e.groupBy(i,"floor");e.each(n,(function(i,a){var n=e.find(t,(function(e){if(e.id===a)return i.length===e.rooms.length}));g.placeName+=n?"、"+n.floor_text:e.reduce(i,(function(e,t){return e+"、"+t.name}),"")}))}else 2===a||5===a?g.placeName+=e.reduce(i,(function(e,t){return e+"、"+t.name.replace(/层$/,"")+"层"}),""):3===a&&(g.placeName+=" 整栋");g.placeName=g.placeName.slice(1)}))},getHandOverPlace:function(e){return n.a.getHandOverPlace(e)},reset:function(){g.baseInfo={},g.checkPointDetail=[],g.checkPointImageModels=[],g.checkPointImgSet=[],g.cachedHandOverPlace=[],g.acceptData={},g.accepts=[],g.placeName="",g.partners=[],g.cc=[],g.process_mode=1,g.pileAddress="",g.unit=""},recoverData:function(t,i){var n,o=t;if(i)if(o.point)(n=e.find(g.checkPointDetail,e.matches({checkpoint_id:o.point.checkpoint_id})))&&($log.log("工序验收恢复闪退照片/视频",{currentPoint:n,recoverMedia:i}),n.image_file.push(i));else if(o.checkPointDetailId&&(n=e.find(g.checkPointDetail,e.matches({checkpoint_id:o.checkPointDetailId})))){$log.log("工序验收恢复闪退点位照片/视频",{currentPoint:n,recoverMedia:i});var s=o.pointsImagesData.points[o.highLightIndex],c=e.find(n.problem_values,e.matches({x:s.x,y:s.y}));c||(c=s,n.problem_values.push(c)),e.find(n.image_file,e.matches({id:i.id}))||n.image_file.push(i),c.image_ids.push(i.id),e.each(o.pointsImagesData.points,(function(t){e.find(n.problem_values,e.matches({x:t.x,y:t.y}))||n.problem_values.push(t)})),e.each(o.pointsImagesData.images,(function(t){e.some(n.problem_values,(function(i){return e.includes(i.image_ids,t.id)}))||c.image_ids.push(t.id)}))}return o.pileAddress&&(g.pileAddress=o.pileAddress),o.cachedHandOverPlace&&(g.cachedHandOverPlace=o.cachedHandOverPlace),g.isChanged=!0,a.a.when()}};t.a={createInstance:function(){return g}}}).call(this,i("391c"))},cfdc:function(e,t,i){"use strict";(function(e){i("5ab2"),i("6d57"),i("e10e"),i("6491"),i("ed63"),i("8cf2");var a=i("28f8"),n=(i("e697"),i("e204"),i("e68e")),o=i("774b"),s=i("e223"),c=i("48f4"),r=i("3122"),l=i("162a"),d=i("e2a7"),h=i("4ad6"),p=i("fc9f"),u=i("a32d"),f=i.n(u),m=i("fd50"),g=i("5bbb"),v=i("4360"),A=i("7cb8"),b=i("14c3"),x=i("e89f"),y=i("d873");function w(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function _(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?w(Object(i),!0).forEach((function(t){Object(a.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var k,P,I;t.a={name:"ProcessAcceptPointImageWidget",components:{ItemImgList:n.a,Scroller:o.default,Drawing:s.a},mixins:[x.a],store:v.a,data:function(){return{show:!1,showDetail:!1,imageFiles:[],url:"",points:[],mode:"",isOnlineMode:!1,viewSize:$rootScope.viewSize,modal:{},callback:function(){},created_by:"",showLeftShadow:!1,showRightShadow:!1,processAcceptId:""}},methods:{open:function(t){this.url=t.url,this.images="view"===t.mode?t.images:Object(g.a)(t.images),this.points="view"===t.mode?t.points:Object(g.a)(t.points),this.checkPointId=t.checkPointId,this.checkPointDetailId=t.checkPointDetailId,this.checkPointDetail=t.checkPointDetail,this.mode=t.mode,this.isOnlineMode=t.isOnlineMode||!1,this.callback=t.callback,this.created_by=t.created_by,this.showLeftShadow=t.showLeftShadow,this.showRightShadow=t.showRightShadow,this.processAcceptId=t.processAcceptId||"",e.each(this.points,(function(e){e.color="#0bc666"})),k=JSON.stringify(this.getPointAndImages().points),this.show=!0,this.showDetail=!1,this.imageFiles=[]},onClose:function(){this.show=!1},collectImageAndPoint:function(){var t=this,i=e.findIndex(this.points,{color:"#4275e8"}),a=i<0?"":this.points[i];a&&(e.each(this.imageFiles,(function(i){e.some(t.images,{id:i.id})||t.images.push(i)})),a.image_ids=e.map(this.imageFiles,"id"))},getPointAndImages:function(){var t=this,i=[],a=Object(g.a)(this.points);return e.each(a,(function(a){var n=[];e.each(a.image_ids,(function(a){var o=e.find(t.images,{id:a});o&&(i.push(o),n.push(a))})),delete a.color,delete a.index,a.image_ids=n})),{images:i,points:a}},setLightPoint:function(t){if(!isNaN(t)){var i=this.points[t];this.points=e.map(this.points,(function(e,i){var a=_({},e);return a.color=t===i?"#4275e8":"#0bc666",a})),this.imageFiles=e.filter(this.images,(function(t){return!!i&&e.includes(i.image_ids,t.id)})),this.showDetail=!0}},changeViewImage:function(t,i){f.a.startsWith(t.change.imagePath,"file://")&&(t.change.imagePath=t.change.imagePath.substr(7));e.each(P,(function(e){if(e.temp===t.change.imagePath||e.local===t.change.imagePath||e.thumbnail===t.change.imagePath||e.url===t.change.imagePath)return e.key,e.temp=t.change.exchangePath,delete e.local,delete e.thumbnail,delete e.url,m.a.when().then((function(){return h.a.getWaterMark([y.e],1===t.change.changeMode)})).then((function(t){return h.a.addWaterMark(e.temp,t).then((function(){if("dev"===APP_ENV)return r.a.uploadImage(e.temp).then((function(t){delete e.temp,e.url=t,e.thumbnailUrl=t}));e.thumbnailUrl=e.temp}))})).then((function(){var e={image_file:Object(A.o)(P)};return p.a.update("process_accept_detail",e,{id:i.point_id}).then((function(){c.default.addSyncGroup([["process_accept_detail",i.point_id,"id"]])}))})),!1}))},onDrawingClick:function(t){var i,a=this,n=this.$store.state.global.allowSelectPictureFromAlbums["process-accept"];if(console.log("data",t),"point"===t.type)if("edit"===this.mode)this.imageFiles&&this.imageFiles.length?this.savePoint():this.removePoint(),this.setLightPoint(t.point.index);else{var o={toolBar:{isShow:!0,isShowChange:!1}};n||(o.toolBar.changeOption=[1]);var s=this.points[t.point.index];if(this.points=e.map(this.points,(function(e,i){var a=_({},e);return t.point.index===i?a.color="#4275e8":a.color="#0bc666",a})),P=this.imageFiles=e.filter(this.images,(function(t){return!!s&&e.includes(s.image_ids,t.id)})),!this.isOnlineMode&&e.find(this.imageFiles,(function(e){return r.a.isNeedDownloadImage([e])})))return d.a.loading("正在下载图片..."),l.a.canUpdate(!0).then((function(){var i=e.filter(a.imageFiles,(function(e){return r.a.isNeedDownloadImage([e])}));return m.a.when().then((function(){if(i.length)return c.default.requireImage([s.point_id],null,"process_accept_detail").then((function(t){var a={};e.each(t.data.image_file,(function(e,t){a[e.id]=e.local})),e.each(i,(function(e,t){e.local=a[e.id]}))}))})).then((function(){var e;h.a.openImageBrowser(r.a.convertMediaList(a.imageFiles),0,o).then(null,null,(e=t.point,function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var o=[].slice.call(i,0);o.push(e),a.changeViewImage(o)}))}))})).catch((function(e){var i;r.a.isNeedThumbnail(_self.itemModel)?d.a.alert(e):h.a.openImageBrowser(r.a.convertMediaList(a.imageFiles),0,o).then(null,null,(i=t.point,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=[].slice.call(t,0);o.push(i),a.changeViewImage(o)})),d.a.hideLoading()})).finally((function(){d.a.hideLoading()}));h.a.openImageBrowser(r.a.convertMediaList(this.imageFiles,this.isOnlineMode),0,o).then(null,null,(i=t.point,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=[].slice.call(t,0);o.push(i),a.changeViewImage(o)}))}else""===t.type&&"edit"===this.mode&&(this.imageFiles&&this.imageFiles.length?this.savePoint():this.removePoint(),this.points.push({x:t.x,y:t.y,image_ids:[]}),this.setLightPoint(this.points.length-1))},removePoint:function(){var t=this,i=e.findIndex(this.points,{color:"#4275e8"});if(!(i<0))return this.imageFiles&&this.imageFiles.length?d.a.confirm("确定删除该点位及照片？",{okText:"删除"}).then((function(e){e&&(t.points.splice(i,1),t.showDetail=!1,t.imageFiles=[])})):(this.points.splice(i,1),this.showDetail=!1,void(this.imageFiles=[]))},save:function(){this.imageFiles&&this.imageFiles.length||this.removePoint(),this.savePoint();var e=this.getPointAndImages();this.show=!1,this.callback(e)},savePoint:function(){if(this.url){if(this.showDetail&&(!this.imageFiles||!this.imageFiles.length))return d.a.alert("请先拍照");this.collectImageAndPoint(),this.points=e.map(this.points,(function(e,t){var i=_({},e);return i.color="#0bc666",i})),this.showDetail=!1,this.imageFiles=[]}},close:function(){var e=this;this.collectImageAndPoint();var t=JSON.stringify(this.getPointAndImages().points);if(!I)return k!==t?I=d.a.confirm("是否保存此页内容？",{okText:"保存",cancelText:"不保存"}).then((function(t){t?e.save():e.show=!1})).then((function(){I=null})):void(this.show=!1)},prepareTakePicture:function(){var t=e.find(this.checkPointDetail,e.matches({checkpoint_id:this.checkPointDetailId}));$log.log("当前验收点",t),b.a.save({module:"process-accept",pointsImagesData:this.getPointAndImages(),highLightIndex:e.findIndex(this.points,{color:"#4275e8"}),checkPointDetailId:this.checkPointDetailId,checkPointDetail:this.checkPointDetail,processAcceptId:this.processAcceptId})}}}}).call(this,i("391c"))},d1d1:function(e,t,i){"use strict";(function(e){var a=i("fd50"),n=i("bcc7"),o=i("515e"),s=i("07d2"),c=i("7bac"),r=i("a7c3"),l=i("4360");t.a={name:"CheckGuideList",components:{Item:s.default},store:l.a,data:function(){return{isLoading:!0,listData:[],module:"",itemId:"",batchId:"",sectionId:"",options:""}},computed:{moduleAttribute:function(){return this.$store.state.global.moduleAttribute}},methods:{init:function(t){var i,n=this;for(var o in this.module=t.module,this.itemId=t.itemId,this.batchId=t.batchId,this.sectionId=t.sectionId,this.options=t.options,t)this[o]=t[o];this.checkType={check:31,"check-safety":36,"check-quality":37,"measure-v3":41,process:32,"fly-inspect":101}[this.module];var s=!1;e.isEmpty(this.itemId)?!e.isEmpty(this.checkType)&&e.isEmpty(this.sectionId)?i=this.initByType():e.isEmpty(this.batchId)?e.isEmpty(this.options)?e.isEmpty(this.sectionId)?i=a.a.when():(s=!0,i=this.initByBidsection()):i=this.initByOptions():i=this.initByBatch():i=this.initById(),this.isLoading=!0,i.then((function(t){var i=n.moduleAttribute[n.module]||{};!e.isEmpty(i)&&i.setUsualItems&&s?c.a.getUserKey(n.mmkvCode()).then((function(e){e=null===e?t:n.mergeArray(n.deepClone(t),e),n.listData=e||[],n.isLoading=!1})):(n.listData=t||[],n.isLoading=!1)}))},mmkvCode:function(){var e=this.moduleAttribute[this.module]||{};return r.a[e.mmkv_item]+"_"+this.sectionId},mergeArray:function(t,i){var a=this;return e.filter(t,(function(t){var n=i[t.id];return e.isEmpty(t.subitem)||(t.subitem=a.mergeArray(t.subitem,i)),!e.isEmpty(n)||"desc"===t.type}))},clickItem:function(e){e.subitem&&e.subitem.length?this.$set(e,"isOpen",!e.isOpen):"special-inspect"===this.module?o.a.openPopup({itemId:e.id,module:this.module}):o.a.openPopup({itemId:e.item_id,module:this.module})},initById:function(){var e=this;if("special-inspect"!==this.module)return n.a.getCheckItem(this.itemId,this.checkType).then((function(t){return t?e.sectionId?n.a.getBidSectionCheckItemListByCode(e.sectionId,t.code):n.a.getCheckItemTreeByCode(t.code):a.a.when()}))},initByType:function(){return n.a.getCheckItemGuidelineList(this.checkType)},initByBatch:function(){return a.a.when()},initByBidsection:function(){return n.a.getBidSectionCheckItemTreeByType(this.sectionId,this.checkType)},initByOptions:function(){return a.a.resolve(this.options)},deepClone:function(e){return JSON.parse(JSON.stringify(e))}}}}).call(this,i("391c"))},d789:function(e,t,i){"use strict";i.r(t);var a=i("2ebb"),n=i("774b"),o=i("e68e"),s=i("cd05"),c=i("f369"),r={components:{Scroller:n.default,ItemImgList:o.a,UserSelect:s.a,CheckGuide:c.a},mixins:[a.a],data:function(){return{viewSize:$rootScope.viewSize,showSubmitMenu:!1,submitActions:[{name:"未完成验收，先提交",status:"待验收"},{name:"验收完成并提交（提交后不可修改）",status:"已验收"}]}}},l=(i("fe6f8"),i("2596"),i("17cc")),d=Object(l.a)(r,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("page-content",{attrs:{title:"工序验收","show-go-root":!0}},[e.model.isLoading?e._e():i("check-guide",{attrs:{slot:"header-bar-right","item-id":e.model.baseInfo.itemId},slot:"header-bar-right"}),e.model.isLoading?e._e():i("scroller",{staticClass:"footer-blank",style:"height: "+(e.viewSize.contentHeight-(e.model.isEdit?e.viewSize.fixedButtonsHeight:0))+"px; margin: 0"},[i("div",{staticClass:"list process-accept-detail-header"},[i("h4",{staticClass:"process-accept-detail-title f18 color-black"},[e._v(e._s(e.model.baseInfo.itemName))]),i("p",{staticClass:"process-accept-detail-content"},[e._v("标段："+e._s(e.model.baseInfo.sectionName)+"("+e._s(e.model.baseInfo.projName)+")")]),90!=e.deliverType?i("p",{staticClass:"process-accept-detail-content"},[e._v("楼栋："+e._s(e.model.baseInfo.buildingName)+e._s(e.model.baseInfo.unitName))]):e._e(),4!=e.deliverType&&90!=e.deliverType?i("p",{staticClass:"process-accept-detail-content"},[e._v("部位："+e._s(e.model.placeName))]):e._e(),90===e.deliverType?i("p",{staticClass:"process-accept-detail-content"},[e._v("部位："+e._s(e.model.selfDefinitionPlacesName+(e.model.isEdit?"":"-"+e.model.acceptData.custom_location)))]):e._e()]),90===e.deliverType&&e.model.isEdit?i("label",{staticClass:"item item-base"},[i("span",{staticClass:"item-label"},[e._v("验收部位")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.model.acceptData.custom_location,expression:"model.acceptData.custom_location"}],staticClass:"input-align-r f16",attrs:{type:"text",maxlength:"50",placeholder:"必填，最多50字"},domProps:{value:e.model.acceptData.custom_location},on:{blur:function(t){e.saveCustomLocation()},input:function(t){t.target.composing||e.$set(e.model.acceptData,"custom_location",t.target.value)}}})]):e._e(),1===e.deliverType&&e.model.isSingleRoom&&e.model.cachedHandOverPlace[0].roomtype_diagram&&!e.model.isPointImageMode?i("div",{staticClass:"item item-base border-top mb10",staticStyle:{"margin-top":"-10px"},on:{click:function(t){e.huxing()}}},[i("div",{staticClass:"item-label"},[e._v("户型图")]),i("div",{staticClass:"item-text align-r color-gray3"},[e._v(e._s(e.model.isEdit?"标点位":"查看"))]),i("div",{staticClass:"icon ion-ios-arrow-right"})]):e._e(),4===e.deliverType&&e.model.isEdit||e.model.pileAddress?i("div",{staticClass:"item item-base border-top mb10"},[i("i",{staticClass:"process-accept-icon-sys"}),i("div",{staticStyle:{flex:"0 0 auto",width:"54px","line-height":"34px"}},[e._v("桩号")]),e.model.isEdit?i("input",{directives:[{name:"model",rawName:"v-model",value:e.model.pileAddress,expression:"model.pileAddress"}],staticStyle:{border:"1px solid #d9d9d9","border-radius":"4px","padding-left":"5px"},attrs:{type:"text",maxlength:"50",placeholder:"请填写"},domProps:{value:e.model.pileAddress},on:{focus:function(t){e.savePileAddressTemp()},blur:function(t){e.saveCustomLocation()},input:function(t){t.target.composing||e.$set(e.model,"pileAddress",t.target.value)}}}):e._e(),!e.model.isEdit&&e.model.pileAddress?i("span",{staticStyle:{flex:"auto","line-height":"34px"}},[e._v(e._s(e.model.pileAddress))]):e._e()]):e._e(),e.model.isEdit?e._l(e.model.checkPointDetail,(function(t,a){return i("div",{key:a,staticClass:"list bg-white process-accept-edit-content"},[i("div",{staticClass:"item-base",class:{"border-none":!t.isOpen},on:{click:function(i){e.togglePoint(t)}}},[i("i",{staticClass:"process-accept-icon-sys"}),i("div",{staticClass:"item-text"},[e._v(e._s(t.title))]),i("van-icon",{attrs:{name:t.isOpen?"arrow-up":"arrow-down"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isOpen,expression:"point.isOpen"}],staticClass:"process-accept-detail-img-list border-none"},[i("item-img-list",{attrs:{maxlength:e.model.isSingleRoom&&e.model.isPointImageMode?99999:50,"prepare-callback":function(){return e.prepareTakePicture(t)},"cancel-callback":function(){return e.cancelTakePicture(t)},editabled:e.model.isEdit,"point-image-mode":e.model.isSingleRoom&&e.model.isPointImageMode,"point-image-edit":function(){return e.pointImageEdit(t)},"user-link":!0,"before-edit":e.checkPileAddressEffective,group:"process-accept-edit"},on:{callback:function(i){e.changeImage(t)}},model:{value:t.image_file,callback:function(i){e.$set(t,"image_file",i)},expression:"point.image_file"}})],1),t.content&&t.isOpen?i("div",{staticClass:"pl15 pr15 pb10"},[i("div",{staticClass:"process-accept-point-content"},[e._v("\n            "+e._s(t.content)+"\n          ")])]):e._e()])})):e._e(),e.model.isEdit?e._e():i("div",{staticClass:"list bg-white  process-accept-detail-list"},[1===e.deliverType&&e.model.isSingleRoom&&e.model.isPointImageMode?i("div",{staticClass:"item item-base border-bottom",on:{click:function(t){e.pointImageView()}}},[i("div",{staticClass:"item-label"},[e._v("户型图点位")]),i("div",{staticClass:"item-text align-r color-gray3"},[e._v(e._s(e.model.problem_values_view.length)+"个")]),i("div",{staticClass:"item-icon-right icon icon-arrow-right"})]):e._e(),e._l(e.model.checkPointDetail,(function(t,a){return i("div",{key:a},[i("div",{staticClass:"item-base border-none process-accept-detail-item-header"},[i("i",{staticClass:"process-accept-icon-sys"}),i("div",{staticClass:"item-text"},[e._v(e._s(t.title))])]),i("div",{staticClass:"p15 border-none pt0"},[i("item-img-list",{attrs:{editabled:!1,group:"process-accept-view"},model:{value:t.image_file,callback:function(i){e.$set(t,"image_file",i)},expression:"point.image_file"}})],1)])}))],2),e.model.isEdit&&"待验收"!=e.model.status?e._e():i("div",{staticClass:"list bg-white"},[e._l(e.model.accepts,(function(t,a){return i("div",{key:a,staticClass:"process-accept-user-list"},[e.model.isEdit&&"待验收"!=e.model.status||0!==a?e._e():i("user-select",{attrs:{title:"验收人",date:e._f("formatDate")(t.date),mode:"view",editabled:!1},model:{value:t.user,callback:function(i){e.$set(t,"user",i)},expression:"item.user"}}),e.model.isEdit&&"待验收"!=e.model.status||0===a?e._e():i("user-select",{attrs:{title:"",date:e._f("formatDate")(t.date),mode:"view",editabled:!1},model:{value:t.user,callback:function(i){e.$set(t,"user",i)},expression:"item.user"}})],1)})),e.model.isEdit?e._e():i("user-select",{attrs:{title:"共同验收人",multi:!0,mode:"view",editabled:!1},model:{value:e.model.partners,callback:function(t){e.$set(e.model,"partners",t)},expression:"model.partners"}}),e.model.isEdit?e._e():i("user-select",{attrs:{title:"抄送人",multi:!0,mode:"view",editabled:!1},model:{value:e.model.cc,callback:function(t){e.$set(e.model,"cc",t)},expression:"model.cc"}})],2),e.model.isEdit?i("user-select",{attrs:{options:e.model.partnerOptions,title:"共同验收人",multi:!0,editabled:!0,"before-select":e.checkPileAddressEffective,"before-open":e.checkPileAddressEffective,required:!1},on:{onSelect:e.changePartners},model:{value:e.model.partners,callback:function(t){e.$set(e.model,"partners",t)},expression:"model.partners"}}):e._e(),e.model.isEdit?i("user-select",{attrs:{options:e.model.ccOptions,title:"抄送人",multi:!0,editabled:!0,"before-select":e.checkPileAddressEffective,"before-open":e.checkPileAddressEffective,required:!1,memory:!0},on:{onSelect:e.changeCC},model:{value:e.model.cc,callback:function(t){e.$set(e.model,"cc",t)},expression:"model.cc"}}):e._e(),e.model.isEdit&&(e.model.draft||e.model.acceptData.id)&&"待验收"!==e.model.status?i("div",{staticClass:"content-bottom-btn-con mt20"},[i("button",{staticClass:"btn-text-blue",on:{click:e.deleteDraft}},[e._v("删除此草稿")])]):e._e(),!e.model.isEdit&&e.model.acceptData.id&&e.canBeModified||"待验收"==e.model.status&&e.canBeModified?i("div",{staticClass:"content-bottom-btn-con mt20 text-center"},[i("app-button",{staticClass:"btn-border delete-btn",attrs:{"active-title":"正在操作"},on:{click:function(t){e.deleteDetail()}}},[e._v("删除")])],1):e._e()],2),e.model.isEdit&&!e.model.isLoading?i("app-button-group",{attrs:{"fixed-bottom":"",seamless:""}},[i("app-button",{staticStyle:{width:"35%"},attrs:{plain:"","active-text":"暂存"},on:{click:e.save}},[e._v("暂存")]),i("app-button",{staticClass:"btn",attrs:{"active-text":"正在操作"},on:{click:e.submit}},[e._v("提交")])],1):e._e(),e.model.isLoading?i("loading-status",{attrs:{"is-loading":e.model.isLoading,"content-height":e.viewSize.contentHeight}}):e._e(),i("van-action-sheet",{attrs:{actions:e.submitActions,"cancel-text":"取消","get-container":"body",round:!0},on:{cancel:function(t){e.showSubmitMenu=!1},select:e.submitProcess},model:{value:e.showSubmitMenu,callback:function(t){e.showSubmitMenu=t},expression:"showSubmitMenu"}})],1)}),[],!1,null,"68affbfe",null);t.default=d.exports},dc98:function(e,t,i){"use strict";i("0732")},e223:function(e,t,i){"use strict";var a=i("c40a").a,n=(i("0aac"),i("17cc")),o=Object(n.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._g({ref:"content",staticClass:"drawing-con"},e.$listeners),[e.isDownloading?[i("p",[i("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[i("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]),i("p",{staticClass:"loading-text"},[e._v("正在下载...")])]:[e.error?e._e():i("canvas",{ref:"drawing-canvas"}),e.error?i("p",{staticClass:"error-text"},[e._v(e._s(e.error))]):e._e()]],2)}),[],!1,null,"fba5990a",null);t.a=o.exports},e4cd:function(e,t,i){var a=i("58c5");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("30171246",a,!0,{sourceMap:!1,shadowMode:!1})},e7ce:function(e,t,i){"use strict";i("b8a2")},e900:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));i("f548");function a(e){var t,i,a,n=(i=(t=e).backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,(window.devicePixelRatio||1)/i);1!==n&&(!function(e,t){for(var i in e)e.hasOwnProperty(i)&&t(e[i],i)}({fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all"},(function(t,i){var a;e[i]=(a=e[i],function(){var e,i,o=Array.prototype.slice.call(arguments);if("all"===t)o=o.map((function(e){return e*n}));else if(Array.isArray(t))for(e=0,i=t.length;e<i;e++)o[t[e]]*=n;return a.apply(this,o)})})),e.stroke=(a=e.stroke,function(){this.lineWidth*=n,a.apply(this,arguments),this.lineWidth/=n}),e.fillText=function(e){return function(){var t=Array.prototype.slice.call(arguments);t[1]*=n,t[2]*=n,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(e,t,i){return t*n+i})),e.apply(this,t),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(e,t,i){return t/n+i}))}}(e.fillText),e.strokeText=function(e){return function(){var t=Array.prototype.slice.call(arguments);t[1]*=n,t[2]*=n,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(e,t,i){return t*n+i})),e.apply(this,t),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(e,t,i){return t/n+i}))}}(e.strokeText),e.extended=!0)}var n=function(e){var t,i;(t=e).getContext=(i=t.getContext,function(e){var t,n,o=i.call(this,e);return"2d"===e&&(t=o.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1,(n=(window.devicePixelRatio||1)/t)>1&&(this.style.height=this.height+"px",this.style.width=this.width+"px",this.width*=n,this.height*=n)),a(o),o})}},e9ea:function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .guide-box[data-v-ff0679ce]{flex:1;display:flex}.zjapp .page-scroll[data-v-ff0679ce]{flex:1;overflow:auto;padding-bottom:100px;transform:translateZ(0)}.zjapp .sublist[data-v-ff0679ce]{padding-left:25px;padding-top:1px;background-color:#fff}.zjapp .sublist>.sublist[data-v-ff0679ce]{padding-left:10px;padding-top:0}",""])},ec2c:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAS1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD9PEb5O0XkNkCgJixmGR02DQ//PEarKmZqAAAAGHRSTlNmAGNUHl9CJBYGWTkoTlI0DQj79dyjhXVr+MqyAAABv0lEQVRo3rTNB2KDMAwF0B9JHvJg3P+ypelKUgIGrHeBh1sTjWH0lZMjcomrH0PUW5OGQCUzVnAWvR5oqdhQi14KxBN2kJfTQWA04XAqKAnNUjkcRMYhHA8Fs8dhfm4PxOEEJ61Bxkm5KZgGnDZM+0F0uMDFvUAIl5BsB4FwEYWtIKCD8D4QQgck74JI6ILiejA5dOKm1WBAN8NakNFR/h8IupLXYHboys0vgUdn/jmI6C4+BYzu+DEoMFAeggQD6S8IMBF+A4YJ/gkERuQ78DDivwIlGCG9BwVmyj2oMFM/A4UhXQKBIVmCDEN5CRiG+AaFKUWEqYgAUwEjTI3wMOUxwFT9IM5eTgAEgiCINooXwYuf3c0/UiMYWA8PKwFBZWa6Omsoa/ZUtPscU5x3S8WeLQX9GtNcPQVblhQ84wNPChb+AP6K+Ef2v+kRysFHBR92fFzzhcNXpl76/Gzhhxc/HfXxy893HkB0hOIhUMdYHsS1SuAyROscLqS0UuNSUGtNLWa1WuZyXOt9XVDoikWXRLrm0kXd/1XjO4omSwfLdC+5E9aDacqd9EUDg3HZA/ELNwbz0hPaL56hfPkPACoPKZ49CVToAAAAAElFTkSuQmCC"},ef1c:function(e,t,i){var a=i("e9ea");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("2e832052",a,!0,{sourceMap:!1,shadowMode:!1})},f1e4:function(e,t,i){"use strict";(function(e){i("5ab2"),i("e10e");var a=i("28f8"),n=(i("9dd9"),i("616f"),i("9e76"),i("ed63"),i("8cf2"),i("6d57"),i("9a33"),i("f548"),i("cc57"),i("4ad6")),o=i("e89f"),s=i("bcc7"),c=i("3122"),r=i("6e1b"),l=i("c130"),d=i("0636");function h(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?h(Object(i),!0).forEach((function(t){Object(a.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.a={name:"CheckGuideDetail",components:{},mixins:[o.a],data:function(){return{show:!1,isLoading:!0,isImageDownloading:!1,title:"",content:[],module:"",itemId:""}},methods:{openPopup:function(t){var i=this;for(var a in this.value=!0,this.show=!0,this.module=t.module,this.itemId=t.itemId,this.$emit("open"),t)this[a]=t[a];this.checkType={check:31,"check-safety":36,"check-quality":37,"measure-v3":41,process:32,"fly-inspect":101}[this.module],this.isLoading=!0,("special-inspect"===this.module?r.a.getSpecialInspectCheckItemDetail(this.itemId):"templet-plan"===this.module?l.a.getTempletDetail(this.itemId):"material"===this.module?d.a.getMaterialDetail(this.itemId):s.a.getCheckItem(this.itemId,this.checkType)).then((function(t){console.log("checkitemData",t),t=t||{},i.checkitemData=t,i.title=t.full_name||t.name,"special-inspect"!==i.module&&"inspect"!==i.module&&"fly-inspect"!==i.module&&"material"!==i.module||(t.content=t.guideline||t.content);var a=t.content?t.content.trim():"",n="【------<REPLACE_SRT>-------】";a=(a=(a=(a=(a=(a=a.replace(/<\/p><p>/gm,"\n")).replace(/<p>/gm,"")).replace(/<\/p>/gm,"")).replace(/<br>/gm,"")).replace(/<br \/>/gm,"")).replace(/\n/gm,"".concat(n,"\n"));var o=/(<img[^\>]*>|<a[^>]*href=['"][^"]*['"][^>]*>.*?<\/a>)/gm;if(o.test(a)){var s=a.split(o);(s=s.filter((function(e){return!!e}))).forEach((function(e,t){e&&!/^\s*\n/.test(e)&&t&&!/\n\s*$/.test(s[t-1])&&(s[t]="\n"+e)})),a=s.join("")}var c=a?a.split("\n"):[],r=e.map(c,(function(e,t){if(e!==n&&!e.includes(n)){var i=c[t+1];i&&i===n&&(e+=n)}var a;if(/<img([\s\S]*)>/gm.test(e)){var o=e.split(/\ssrc="([^"]*)"/gm)[1],s=o?o.match(/[\w|-]{36}/gm)[0]:(new Date).getTime()+"-"+t;a={isImg:!0,isHref:!1,src:"",url:o,status:"pending",id:s,ready:!0}}else if(/<a.*<\/a>/gm.test(e)){var r=e.split(/href="([^"]*)".*>(.*)<\/a>/);a={isImg:!1,isHref:!0,val:r[2],url:r[1]}}else a={isImg:!1,isHref:!1,val:e};return a.val&&(a.joinBrToSplitLine=e!==n&&e.endsWith(n)),a}));i.content=[];for(var l=0;l<r.length;l++){var d=r[l];!(d.val===n)&&(d.val&&(d.val=d.val.replace(new RegExp("".concat(n),"gm"),"")),i.content.push(d))}i.downloadImage(),i.isLoading=!1})).catch((function(e){$log.log(e)}))},openHref:function(e){n.a.openUrl(e)},closePopup:function(){this.value=!1,this.show=!1,this.$emit("close")},getThumbnail:function(e){return"pending"===e.status?c.a.IMAGE_LOADING:"rejected"===e.status?c.a.IMAGE_RELOAD:"dev"===APP_ENV?e.url:"fulfilled"===e.status?e.src:($log.log("检查指引-显示图片：",e),c.a.IMAGE_PLACEHOLD)},imgError:function(e,t){$log.error("检查指引-加载图片出现错误：",e);var i=p({},e);i.status="rejected",this.$set(this.content,t,i)},downloadImage:function(t){var i=this;t=t?[t]:this.imageList(),e.each(t,(function(t){var a=p({},t),n=e.map(i.content,(function(e){return e.id})).indexOf(t.id);c.a.isNeedDownload(t.url).then((function(e){e?c.a.download(t.url).then((function(e){a.status="fulfilled",a.src=c.a.fixUrl(e),i.$set(i.content,n,a)})).catch((function(e){$log.error("检查指引-下载图片：",e)})):(a.status="fulfilled",a.src=c.a.fixUrl(c.a.getPathFromUrl(t.url)),i.$set(i.content,n,a))}))}))},imageList:function(){return e.filter(this.content,(function(e){return e.isImg}))},imgClick:function(t){var i=this;if("pending"===t.status)return!1;if("rejected"===t.status)return this.downloadImage(t),$log.log("检查指引-点击重新加载-重新下载图片：",t),!1;var a=this.imageList(),o=e.map(a,(function(e){return e.id})).indexOf(t.id);a=e.map(a,(function(e){return i.getThumbnail(e)})),n.a.openImageBrowser(a,o)}}}}).call(this,i("391c"))},f369:function(e,t,i){"use strict";var a=i("fd50"),n=i("bcc7"),o=i("329b"),s=i("d1d1").a,c=(i("3411"),i("17cc")),r={name:"CheckGuideList",components:{GuideList:Object(c.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"guide-box"},[!e.isLoading&&e.listData.length?i("div",{staticClass:"page-scroll"},e._l(e.listData,(function(t,a){return i("div",{key:a},[i("item",{attrs:{border:"bottom","icon-right":t.subitem&&t.subitem.length?t.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){e.clickItem(t)}}},[i("div",{staticClass:"item-text fw-b color-blue one-line"},[e._v(e._s(t.item_name))])]),t.isOpen?e._l(t.subitem,(function(t,a){return i("div",{key:a,staticClass:"sublist"},[i("item",{staticClass:"pl0",attrs:{border:"bottom","icon-right":t.subitem&&t.subitem.length?t.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){e.clickItem(t)}}},[i("div",{staticClass:"item-text checkitem-list-name"},[e._v(e._s(t.item_name))])]),t.isOpen?e._l(t.subitem,(function(t,a){return i("div",{key:a,staticClass:"sublist"},[i("item",{staticClass:"pl0",attrs:{border:"bottom","icon-right":t.subitem&&t.subitem.length?t.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){e.clickItem(t)}}},[i("div",{staticClass:"item-text checkitem-list-name"},[e._v(e._s(t.item_name))])]),t.isOpen?e._l(t.subitem,(function(t,a){return i("div",{key:a,staticClass:"sublist"},[i("item",{staticClass:"pl0",attrs:{border:"bottom","icon-right":t.subitem&&t.subitem.length?t.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){e.clickItem(t)}}},[i("div",{staticClass:"item-text checkitem-list-name"},[e._v(e._s(t.item_name))])])],1)})):e._e()],2)})):e._e()],2)})):e._e()],2)}))):e._e(),i("loading-status",{attrs:{"is-loading":e.isLoading,"is-empty":!e.listData.length,"empty-text":"没有检查项"}})],1)}),[],!1,null,"ff0679ce",null).exports},mixins:[i("e89f").a],data:function(){return{show:!1}},methods:{openPopup:function(e){var t=this;this.value=!0,this.show=!0,this.$nextTick((function(){t.$refs["guide-list"].init(e),t.$emit("open")}))},closePopup:function(){this.value=!1,this.show=!1,this.$emit("close")}}},l=Object(c.a)(r,(function(){var e=this.$createElement,t=this._self._c||e;return t("transition",{attrs:{name:"slide-right"}},[this.show?t("page-content",{attrs:{mode:"dialog",title:"检查指引","on-close":this.closePopup}},[t("guide-list",{ref:"guide-list"})],1):this._e()],1)}),[],!1,null,null,null).exports,d=!1;d||(d=new(o.default.extend(l))({el:document.createElement("div")}),document.body.appendChild(d.$el));var h=d,p=i("515e"),u=i("91c1").a,f=(i("dc98"),Object(c.a)(u,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.show?i("div",{staticClass:"main",style:{top:e.contentTop+"px"}},[i("i",{staticClass:"arrow"}),i("div",{staticClass:"content",on:{click:function(t){return t.target!==t.currentTarget?null:e.closePopup(t)}}},[i("transition",{attrs:{name:"slide-down"},on:{enter:function(t){e.isOpening=!0},"after-enter":function(t){e.isOpening=!1},leave:function(t){e.isClosing=!0},"after-leave":e.afterClose}},[e.showList?i("div",{staticClass:"box",style:{height:e.listHeight+"px"}},e._l(e.data,(function(t,a){return i("div",{key:a,class:{"border-bottom":e.data.length>1,"box-single":1===e.data.length}},[i("div",{staticClass:"detail-hd",class:{"border-bottom":e.data.length<=1,"detail-hd-single":e.data.length<=1},on:{click:function(i){e.toggleItem(t)}}},[e.data.length>1?i("i",{class:{"detail-arrow-right":!t.isOpen,"detail-arrow-down":t.isOpen}}):e._e(),i("div",{staticClass:"detail-title"},[e._v(e._s(t.name))])]),e.data.length<=1||t.isOpen?i("div",{staticClass:"detail-bd",class:{"detail-bd-single":e.data.length<=1}},[e._l(t.textArr,(function(t,a){return i("p",{key:a,staticClass:"text-line"},[e._v("\n              "+e._s(t)+"\n            ")])})),i("item-img-list",{attrs:{editabled:!1},model:{value:t.contentImage,callback:function(i){e.$set(t,"contentImage",i)},expression:"item.contentImage"}}),i("loading-status",{attrs:{"is-empty":!t.textArr.length&&!t.contentImage.length,"empty-text":"PC端未设置检查指引"}})],2):e._e()])}))):e._e()])],1)]):e._e()}),[],!1,null,"2cac8864",null).exports),m=!1;m||(m=new(o.default.extend(f))({el:document.createElement("div")}),document.body.appendChild(m.$el));var g=m,v={name:"CheckGuide",components:{},props:{module:{type:String,default:""},mode:{type:String,default:"page"},itemId:{type:String,default:""},itemIds:{type:Array,default:function(){return[]}},batchId:{type:String,default:""},sectionId:{type:String,default:""},options:{type:Array,default:function(){return[]}},optionsPromise:{type:Function,default:function(){}},beforeOpen:{type:Function,default:function(){}}},data:function(){return{isLoading:!1}},methods:{openCheckGuide:function(){var e=this,t=this.beforeOpen&&this.beforeOpen();t instanceof Promise||(t=Promise.resolve(t)),t.then((function(t){!1!==t&&("drop"===e.mode?g.openPopup({itemIds:e.itemIds,el:e.$refs["check-guide-btn"],options:e.options}):("templet-plan"===e.module?a.a.when(!1):e.itemId&&e.sectionId?n.a.hasChildSectionCheckItem(e.itemId,e.sectionId):e.itemId?n.a.hasChildCheckItem(e.itemId):a.a.when(!0)).then((function(t){t?h.openPopup({module:e.module,itemId:e.itemId,batchId:e.batchId,sectionId:e.sectionId,options:e.options}):p.a.openPopup({itemId:e.itemId,module:e.module})})))}))}}},A=Object(c.a)(v,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"check-guide-btn",staticClass:"header-btn",on:{click:function(t){e.openCheckGuide()}}},[i("icon",{attrs:{name:"nav-info"}})],1)}),[],!1,null,null,null);t.a=A.exports},fe6f8:function(e,t,i){"use strict";i("2334")}}]);