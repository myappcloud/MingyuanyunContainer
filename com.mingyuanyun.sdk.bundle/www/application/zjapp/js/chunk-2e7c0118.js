(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-2e7c0118"],{4277:function(t,e,a){"use strict";a("5ab2"),a("e10e");var n=a("4c09"),o=(a("06a2"),a("28f8")),c=(a("163d"),a("6d57"),a("fc9f")),i=function(t){var e="select * from batch where id = '".concat(t,"'");return c.a.queryOne(e)},r=function(t){var e="select sipc.*,\n      si.checkitem_id, si.checkitem_parent_id, si.score \n      from special_inspect_place_checkitem sipc\n      join special_inspect si on si.id = sipc.special_inspect_id\n      where (sipc.status = '合格' or sipc.status = '不合格') and sipc.batch_id = '".concat(t,"'\n      order by si.checkitem_code");return c.a.query(e)},s=function(t){var e="select * from special_inspect \n      where batch_id = '".concat(t,"'\n      order by checkitem_code");return c.a.query(e)},u=a("7cb8");function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){Object(o.a)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function f(t){return isNaN(t)?t:Math.round(100*t)/100}e.a={getPassrateMode:function(t){return i(t).then((function(t){var e;try{e=JSON.parse(t.template_extension).mode11_passrate_mode||1}catch(t){e=1}return e}))},getMode1TotalData:function(t){return r(t).then((function(t){if(!t&&!t.length)return[];var e={};t.forEach((function(t){e[t.special_inspect_id]||(e[t.special_inspect_id]={total:0,score:t.score,deduction:0,qualified:0}),e[t.special_inspect_id].total+=1,e[t.special_inspect_id].deduction+=Number(t.deduction)||0,"合格"===t.status&&(e[t.special_inspect_id].qualified+=1)}));var a=[];for(var n in e)a.push(d(d({},e[n]),{},{id:n}));return a}))},getMode2TotalData:function(t){var e=this;return Promise.all([s(t),r(t)]).then((function(t){var a=t[0],o=t[1],c={};(a||[]).forEach((function(t){try{var e=JSON.parse(t.checkitem_extension);t.isDeductionItem=!!e.is_deduction_item}catch(e){t.isDeductionItem=!1}c[t.checkitem_id]=t})),(o||[]).forEach((function(t){c[t.checkitem_id]&&(c[t.checkitem_id].problems||(c[t.checkitem_id].problems=[]),c[t.checkitem_id].problems.push(t))}));var i=Object(u.c)(a,{key:"checkitem_id",relationKey:"checkitem_parent_id"});return(i||[]).forEach((function(t){var a=e.getItemAllProblems(t,(function(t){return!t.isDeductionItem})),o=a.filter((function(t){return"合格"===t.status})),c=a.filter((function(t){return"不合格"===t.status})).reduce((function(t,e){return t+(e.deduction||0)}),0),i=e.getItemAllProblems(t,(function(t){return t.isDeductionItem})),r=i.reduce((function(t,e){return t+(e.deduction||0)}),0);t.allProblems=[].concat(Object(n.a)(a),Object(n.a)(i)),a&&a.length?(t.rejection=!1,t.passrate=o.length/a.length,t.deductionTotal=f(c),t.ducuctionItemTotal=f(r),t.result=t.score*t.passrate-t.deductionTotal-t.ducuctionItemTotal):t.rejection=!0})),i}))},getItemAllProblems:function(t,e){var a=this,n=[];return t.children&&t.children.length?t.children.forEach((function(t){n=n.concat(a.getItemAllProblems(t,e))})):e?e(t)&&(n=t.problems||[]):n=t.problems||[],n}}},"682f":function(t,e,a){"use strict";a("b2bb")},"9b61":function(t,e,a){"use strict";a.r(e);a("6d57");var n=a("07d2"),o=a("4277"),c=a("e2a7");var i={name:"IndexFooter",components:{Item:n.a},props:{batchId:{type:String}},data:function(){return{isLoading:!1,passrateMode:1,scoreRate:"",totalData:[]}},watch:{batchId:{handler:function(t){t?this.getTotalData():(this.scoreRate="",this.totalData=[])},immediate:!0}},created:function(){this.$on("reload",this.getTotalData)},activated:function(){this.getTotalData()},methods:{getTotalData:function(){var t=this,e=this.batchId;return o.a.getPassrateMode(e).then((function(a){return t.passrateMode=a,2===a?t.getMode2TotalData(e):t.getMode1TotalData(e)}))},getMode1TotalData:function(t){var e=this;return o.a.getMode1TotalData(t).then((function(a){if(t===e.batchId){e.totalData=a;var n=0,o=0;(a||[]).forEach((function(t){var e=t.qualified/t.total;n+=e*t.score-t.deduction,o+=t.score})),e.scoreRate=o?Math.round(n/o*1e4)/100+"%":""}}))},getMode2TotalData:function(t){var e=this;return o.a.getMode2TotalData(t).then((function(a){if(t===e.batchId){e.totalData=a;var n=(a||[]).filter((function(t){return!t.rejection})),o=0,c=0,i=a.some((function(t){return t.allProblems&&t.allProblems.length}));n.forEach((function(t){o+=t.result,c+=t.score})),e.scoreRate=c?Math.round(o/c*1e4)/100+"%":i?"0.00%":""}}))},formulaTips:function(){2===this.passrateMode?this.formulaTipsMode2():this.formulaTipsMode1()},formulaTipsMode1:function(){var t="当前综合得分=∑（已检项的合格率*满分值-倒扣分）/∑（已检项的满分值）";if(this.totalData&&this.totalData.length){var e=[],a=[];this.totalData.forEach((function(t){var n,o=Math.round(t.qualified/t.total*1e4)/100+"%";e.push("(".concat(o,"*").concat(t.score,"-").concat((n=t.deduction,isNaN(n)?n:Math.round(1e5*n)/1e5),")")),a.push(t.score)})),t+="=(".concat(e.join("+"),")/(").concat(a.join("+"),")=").concat(this.scoreRate)}c.a.notify(t,{buttonName:"知道了",className:"broad-dialog"})},formulaTipsMode2:function(){var t="综合扣分=Σ（已检查一级项合格率*已检一级项满分值-Σ已检一级项内末级项倒扣分-Σ已检一级项内带星末级项倒扣分）/Σ（已检查一级项满分）",e=(this.totalData||[]).filter((function(t){return!t.rejection}));if(e&&e.length){var a=[],n=[];e.forEach((function(t){var e=Math.round(1e4*t.passrate)/100+"%";a.push("(".concat(e,"*").concat(t.score,"-").concat(t.deductionTotal,"-").concat(t.ducuctionItemTotal,")")),n.push(t.score)})),t+="=(".concat(a.join("+"),")/(").concat(n.join("+"),")=").concat(this.scoreRate)}c.a.notify(t,{buttonName:"知道了",className:"broad-dialog"})}}},r=(a("682f"),a("17cc")),s=Object(r.a)(i,(function(){var t=this.$createElement,e=this._self._c||t;return e("item",{attrs:{border:"top"}},[e("div",{staticClass:"item-text"},[this._v("当前综合得分")]),e("div",{staticClass:"item-font color-theme f18 fw-b"},[this._v(this._s(this.scoreRate))]),e("icon",{attrs:{name:"yiwen"},on:{click:this.formulaTips}})],1)}),[],!1,null,"25ef2435",null);e.default=s.exports},a88c:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .icon-yiwen[data-v-25ef2435]{font-size:18px;color:#b4b4b4;line-height:30px;padding-left:10px}.zjapp .ios-bezel-less .item[data-v-25ef2435]{padding-bottom:42px}",""])},b2bb:function(t,e,a){var n=a("a88c");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("1d4874cb",n,!0,{sourceMap:!1,shadowMode:!1})}}]);