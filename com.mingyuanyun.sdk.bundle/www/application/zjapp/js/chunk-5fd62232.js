(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-5fd62232"],{"04a3":function(t,a,e){var i=e("4e94");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,e("85cb").default)("4b2d59e7",i,!0,{sourceMap:!1,shadowMode:!1})},1743:function(t,a,e){"use strict";e("210b")},"210b":function(t,a,e){var i=e("ea8a");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,e("85cb").default)("9c916272",i,!0,{sourceMap:!1,shadowMode:!1})},"28e4":function(t,a,e){"use strict";e("04a3")},"49b9":function(t,a,e){"use strict";(function(t){e("616f"),e("cc57");var i=e("a32d"),o=e.n(i),s=e("e2a7"),n=e("3bd5"),c=e("fd50"),r=e("3516"),p=e("7b81"),u=e("9864"),l=e("07d2");a.a={name:"CheckSafetyBatchDetail",components:{CheckUserContact:u.a,Item:l.a},data:function(){return{isLoading:!1,batchId:"",batch:{},batchData:{},editable:!1,mode:""}},computed:{isDefault:function(){return Boolean(this.batch.is_default)}},activated:function(){$log.log("安全检查批次详情，activated"),this.init()},methods:{init:function(){var a=this,e=this.$route.params;this.isLoading=!0,this.batchId=e&&e.id?e.id:"",c.a.all([r.a.getBatch(this.batchId),r.a.getBatchUsers(this.batchId),r.a.getBatchCCs(this.batchId)]).then((function(e){a.batch=e[0];var i=e[1],s=e[2];if(a.editable=a.batch.in_charge_by===n.a.getUser().user_id,"实测实量"===a.batch.batch_type?a.mode="measure":"工序移交"===a.batch.batch_type?a.mode="process":"安全检查"===a.batch.batch_type&&(a.mode="check-safety"),a.batchData={name:a.batch.name,timeLimit:a.batch.repair_deadline,bidsection:a.batch.section_name+"（"+a.batch.proj_name+"）",inspector:i,cc:s,room:[],type:function(){switch(a.batch.batch_type){case"安全检查":return"随机检查";case"工序移交":return"工序移交";case"实测实量":return""}}(),building_name:a.batch.unit?(o.a.endsWith(a.batch.unit,"单元")||(a.batch.unit+="单元"),a.batch.building_name+a.batch.unit):a.batch.building_name,item_name:a.batch.item_name,purpose:a.batch.batch_purpose||"正式",created_on:a.batch.created_on},p.a.getUsersByIds([a.batch.in_charge_by||a.batch.created_by]).then((function(t){t[0]=t[0]?[t[0]]:[],a.$set(a.batchData,"charger_info",t[0])})),"measure"===a.mode)return r.a.getBatchRooms(a.batchId).then((function(e){var i=t.groupBy(e,(function(t){return t.unit&&!o.a.endsWith(t.unit,"单元")&&(t.unit+="单元"),t.building_name+t.unit})),s=t.map(i,(function(a,e){return e+t.map(a,"room_name").join("、")}));a.$set(a.batchData,"room",s)}));a.isLoading=!1}))},batchDelete:function(){var t=this;this.batch.id&&("测试"===this.batch.batch_purpose||"1"!==this.batch.is_downloaded?s.a.confirm("确定要删除批次吗？",(function(){s.a.loading("请稍等..."),r.a.deleteBatch(t.batch.id).then((function(){t.$router.go(-1),s.a.hideLoading()})).catch((function(t){s.a.hideLoading(),s.a.alert(t.errmsg)}))})):s.a.alert("被他人下载过的批次不能删除"))},closeBatch:function(){var t=this;this.batch.id&&s.a.confirm("关闭批次后，在APP将看不到该批次及相关问题，可在PC端统计报表中查看。确定关闭批次？",(function(){s.a.loading("请稍等..."),r.a.closeBatch(t.batch.id).then((function(){t.$router.go(-1)})).catch((function(t){s.a.alert(t)})).finally((function(){s.a.hideLoading()}))}))},batchEdit:function(){this.batchId?this.$router.push("/checkSafetyBatchEdit/".concat(this.batchId)):s.a.alert("缺少批次id")}}}}).call(this,e("391c"))},"4e94":function(t,a,e){(t.exports=e("690e")(!1)).push([t.i,".zjapp .content-wrap[data-v-17cb439c]{max-height:100%;overflow:auto;padding-bottom:50px}",""])},9864:function(t,a,e){"use strict";var i=e("cdce").a,o=(e("1743"),e("17cc")),s=Object(o.a)(i,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"root"},[t.list.length?t._e():e("div",{staticClass:"item-user-unit"},[e("span",{staticClass:"item-user-name"},[t._v("\n      无\n    ")])]),t._l(t.list,(function(a,i){return e("div",{key:i,staticClass:"item-user-unit"},[e("span",{staticClass:"item-user-name"},[t._v("\n      "+t._s(a&&a.name?a.name:"")+"\n    ")]),e("div",{staticClass:"icon-im-btn",on:{click:function(e){if(e.stopPropagation(),e.target!==e.currentTarget)return null;t.openImPopup(a,e)}}},[t.popupOpenItemId===a.id?e("div",{staticClass:"popup-user-im",class:{"popup-user-posi-bottom":t.popupUserPosiBottom},style:{left:t.popupL}},[e("div",{directives:[{name:"track",rawName:"v-track",value:"公共-发起聊天",expression:"'公共-发起聊天'"}],staticClass:"popup-user-im-item",class:{disabled:t.isImDisabled(a)},on:{click:function(e){t.openIm(a)}}},[e("icon",{staticClass:"popup-user-im-icon",attrs:{name:"liaotian"}}),e("p",{staticClass:"popup-user-im-text"},[t._v("聊天")])],1),a.mobile&&t.userInfo.user_id!==a.id?e("a",{directives:[{name:"track",rawName:"v-track",value:"公共-打电话",expression:"'公共-打电话'"}],staticClass:"popup-user-im-item",attrs:{href:"tel:"+a.mobile}},[e("icon",{staticClass:"popup-user-im-icon",attrs:{name:"dianhua"}}),e("p",{staticClass:"popup-user-im-text"},[t._v("电话")])],1):e("div",{staticClass:"popup-user-im-item disabled"},[e("icon",{staticClass:"popup-user-im-icon",attrs:{name:"dianhua"}}),e("p",{staticClass:"popup-user-im-text"},[t._v("电话")])],1),e("div",{staticClass:"popup-user-im-arrow",style:{left:t.arrowL}})]):t._e()])])}))],2)}),[],!1,null,"423c0b90",null);a.a=s.exports},ae4c:function(t,a,e){"use strict";e.r(a);var i=e("49b9").a,o=(e("28e4"),e("17cc")),s=Object(o.a)(i,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("page-content",{attrs:{title:"批次详情","show-go-root":!0}},[e("div",{staticClass:"content-wrap"},[t.isLoading?t._e():e("div",{staticClass:"list bg-white pt10 pb10 border"},[e("item",{attrs:{label:"批次名称",text:t.batchData.name}}),e("item",{attrs:{label:"所属标段",text:t.batchData.bidsection}}),e("item",{attrs:{label:"检查人"}},[e("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[t.isDefault?e("div",[t._v("所有有权限的用户")]):e("check-user-contact",{attrs:{list:t.batchData.inspector}})],1)]),e("item",{attrs:{label:"默认整改期限",text:t.batchData.timeLimit+"天"}}),t.isDefault?t._e():e("item",{attrs:{label:"抄送人"}},[e("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[e("check-user-contact",{attrs:{list:t.batchData.cc}})],1)]),e("item",{attrs:{label:"负责人"}},[e("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[t.isDefault?e("div",[t._v("系统预置")]):e("check-user-contact",{attrs:{list:t.batchData.charger_info}}),e("div",{staticClass:"color-light mt10"},[t._v(t._s(t._f("formatDate")(t.batchData.created_on)))])],1)])],1),!t.editable||t.isLoading||t.isDefault?t._e():e("app-button-group",{attrs:{direction:"row"}},[e("app-button",{directives:[{name:"track",rawName:"v-track",value:"安全检查-批次列表-删除批次",expression:"'安全检查-批次列表-删除批次'"}],attrs:{type:"operate"},on:{click:t.batchDelete}},[t._v("\n        删除\n      ")]),e("app-button",{attrs:{type:"operate"},on:{click:t.closeBatch}},[t._v("\n        关闭\n      ")]),e("app-button",{directives:[{name:"track",rawName:"v-track",value:"安全检查-批次列表-修改批次",expression:"'安全检查-批次列表-修改批次'"}],attrs:{type:"operate"},on:{click:t.batchEdit}},[t._v("\n        修改\n      ")])],1),e("loading-status",{attrs:{"is-loading":t.isLoading}})],1)])}),[],!1,null,"17cb439c",null);a.default=s.exports},cdce:function(t,a,e){"use strict";(function(t){e("cc57");var i=e("4360"),o=e("3bd5"),s=e("1601"),n=e("e2a7"),c=e("6f9e");a.a={name:"CheckUserContact",props:{list:{type:Array,default:function(){return[]}}},data:function(){return{popupOpenItemId:"",popupL:"50%",arrowL:"50%",popupUserPosiBottom:!1}},computed:{allowIM:function(){return window&&window.$rootScope&&window.$rootScope.allowIM},userInfo:function(){return o.a.getUser()}},created:function(){c.a.$on("pageContentClick",this.closeImPopup)},destroyed:function(){c.a.$off("pageContentClick",this.closeImPopup)},methods:{hasIm:function(t){return!!parseInt(t.is_im_user)},openImPopup:function(t,a){if($log.log("打开聊天窗口",t),c.a.$emit("pageContentClick"),this.popupOpenItemId=t.id,a&&a.target){$log.log(a.target);var e=a.target.getBoundingClientRect(),o=window.innerWidth,s=i.a.state.app.isIOS?i.a.state.app.isIOSBezelLess?88:64:44;e.top<s+68?this.popupUserPosiBottom=!0:this.popupUserPosiBottom=!1,o-e.right<50?(this.popupL=16-(50-(o-e.right))+"px",this.arrowL=50-(o-e.right)+65+"px"):(this.popupL="50%",this.arrowL="50%")}},closeImPopup:function(){this.popupOpenItemId=""},openIm:function(a){var e=this.isImDisabled(a),i=this.allowIM&&!e;if(console.log(e,i,this.allowIM),i)if(t.has(a,"headimg_url")){var o=this.userInfo.tenant_code+"_"+a.id;s.a.openIm(o,a.name,a.headimg_url).catch((function(t){n.a.alert(t)}))}else s.a.openUserChat(a.id).catch((function(t){n.a.alert(t)}));else n.a.alert("聊天功能优化中暂不可用")},isImDisabled:function(t){return 1!==parseInt(t.is_im_user)||t.id===this.userInfo.user_id}}}}).call(this,e("391c"))},ea8a:function(t,a,e){var i=e("5454");(t.exports=e("690e")(!1)).push([t.i,".zjapp .item-user-unit[data-v-423c0b90]{position:relative;display:inline-block;vertical-align:top;font-size:0}.zjapp .item-user-name[data-v-423c0b90]{font-size:16px;display:inline-block;vertical-align:middle}.zjapp .icon-im-btn[data-v-423c0b90]{position:relative;z-index:5;display:inline-block;vertical-align:middle;width:34px;height:22px;background:url("+i(e("f77a"))+") no-repeat 6px;background-size:16px 10px}.zjapp .popup-user-im[data-v-423c0b90]{position:absolute;z-index:5;bottom:30px;left:50%;margin-left:-65px;padding:0 5px;width:130px;height:60px;background-color:rgba(0,0,0,.8);border-radius:5px}.zjapp .popup-user-im-item[data-v-423c0b90]{float:left;width:60px;height:60px;text-align:center;color:#fff;padding-top:10px}.zjapp .popup-user-im-item.disabled[data-v-423c0b90]{color:#666}.zjapp .popup-user-im-arrow[data-v-423c0b90]{position:absolute;bottom:-5px;left:50%;margin-left:-5px;border:5px solid transparent;border-bottom:none;border-top-color:rgba(0,0,0,.8)}.zjapp .popup-user-im-icon[data-v-423c0b90]{display:block;font-size:21px}.zjapp .popup-user-im-text[data-v-423c0b90]{font-size:12px;line-height:16px;margin-top:4px}.zjapp .popup-user-posi-bottom[data-v-423c0b90]{bottom:auto;top:30px}.zjapp .popup-user-posi-bottom .popup-user-im-arrow[data-v-423c0b90]{top:-5px;bottom:auto;border-top:none;border-bottom:5px solid rgba(0,0,0,.8)}",""])},f77a:function(t,a){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAeCAYAAABqpJ3BAAAAAXNSR0IArs4c6QAAAnlJREFUWAntmD1PFEEYx2dmbxUhd0eABAQsjAap0AIagYYYayWUxMaCaIJQGg1kQ0VNAdkY/QA0JH4AQyEdDRdB74xGQ4CYUABnJMfezsM8JHvKMs8ei4GdGDe57O3zMvP7z8vO7HBW5QIAPjmX65Oc93JgrcDY5Sop5+JW9ZY4Z5sCYGnqSdd7zhWNunhUbdPul2zRLz5mTNyKirtoHwD7lEnVvXk+cmNXUJVjy5sIj7yqJzqRDRktSoBsHuwHJgYof/J23rS4/GOH7AEc88lDRhMgIykAJ2x0evJeZCQFJPW2idMsyEgKiFNQkrH/BSTZ+li3tgdcF+ykwU5b/4mV2Jn5nPHs/acM2PXTFpJk3DEBL9y1q8LzRkHwxrhQtiXEw4G27o5r6Q7MLawXCwvvNpY9X0pdWXHjdWWgrbISO26u0y/740zwDBUcZR+6197TdbP+TiolbPw1N9S0NGQvidWvexu6vLjxujLQdjQHJuY+9B5IeKZ2eFeowGr2oOX/jNPZAr/Op7MF8dRdOK9W2iXIRzxiX0Qlm2AXjKd+qRXN+1sYHPPhMnS2IEbn09mCeOpuLb6d3b//YOyjD+XbaqN65o+VwvefWzjms3V2puyDt/ZtbxUnsVR7Xl3lceN1ZaCt8hZy3HyT55dGla2FCjbRXhGAcI67WXtQ3h7BDwYTYXVMxwRgwPw8WCvbuWHVOXd1CabZTggIAF/O5tzgv8l37V7IZOAw278rQI2tUlitac/ISPYAqEMk04DDPMhICsATsHCCac/ISArA4zvGZN406N88Mo+MpAA8e0xb6ddmipB5ZENGch0IlJpyuIsT9mjMhw53DwElT/W1PxsJFAAAAABJRU5ErkJggg=="}}]);