(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-e17bca40"],{"56bf":function(t,e,i){"use strict";i("ea6b")},"8cb7":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,'.zjapp .item-img-list{display:flex;flex-direction:row;flex-wrap:wrap;align-content:flex-start;align-items:flex-start;margin-top:-15px;margin-left:-15px}.zjapp .item-img-list li{position:relative;width:70px;height:70px;margin-left:15px;margin-top:15px;background:no-repeat 50%;background-size:cover;background-color:#eee;transform:translateZ(0)}.zjapp .item-img-list-popup{padding:0}.zjapp .item-img-list-popup .item-img-list{margin-top:0;text-align:center;font-size:0;white-space:nowrap}.zjapp .item-img-list-popup .item-img-list li{float:none;display:inline-block;vertical-align:top;background-color:transparent;border-color:#fff;color:#fff}.zjapp .item-img-list .icon-minus{position:absolute;top:-10px;right:-10px;width:20px;height:20px;line-height:20px;border-radius:10px;background-color:#ff4546;color:#fff;font-size:14px;text-align:center}.zjapp .item-img-list .icon-minus:before{content:"";position:absolute;left:5px;top:9px;width:10px;height:2px;background-color:#fff}.zjapp .item-img-list .no-img{color:#4275e8;background:#fff;line-height:70px;text-align:center;font-size:45px;border:1px dotted #4275e8}.zjapp .item-img-list .add-img{color:#b6b6b6;background:#fff;line-height:70px;text-align:center;font-size:40px;border:1px dotted #c6c6c6}.zjapp .item-img-list .list-icon{height:40px;line-height:30px;padding-top:10px;overflow:hidden;font-size:40px}.zjapp .item-img-list .list-icon i{font-size:28px;display:block}.zjapp .item-img-list .list-icon i:before{vertical-align:top}.zjapp .item-img-list .list-icon .icon-shoot-video{font-size:24px;margin-top:1px}.zjapp .item-img-list .list-text{line-height:20px;font-size:14px}.zjapp .item-img-list .van-icon-play{position:absolute;top:15px;left:20px;padding-left:2px;width:30px;height:30px;line-height:28px;text-align:center;font-size:22px;color:hsla(0,0%,100%,.8);border:1px solid hsla(0,0%,100%,.8);border-radius:15px}.zjapp .item-img-list .size{position:absolute;bottom:0;right:5px;line-height:18px;color:#fff;font-size:10px;font-style:normal}',""])},d209:function(t,e,i){"use strict";(function(t){i("5ab2"),i("e10e"),i("309f"),i("0b53"),i("ec25"),i("cc57"),i("2b45"),i("6a61");var n=i("2e91"),a=i("4c09"),o=(i("6d57"),i("06a2"),i("28f8")),r=(i("ed63"),i("8cf2"),i("e204"),i("163d"),i("a32d")),l=i.n(r),s=i("48f4"),c=i("4ad6"),u=i("a500"),d=i("3122"),p=i("162a"),m=i("e2a7"),h=i("3bd5"),f=i("ed08"),g=i("4360"),b=i("7cb8"),v=i("6cb4"),w=i("cc90"),x=(i("8d95"),i("d873")),I=i("7010"),S=i("b6ea");function y(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function P(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?y(Object(i),!0).forEach((function(e){Object(o.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function A(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return k(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return k(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){l=!0,o=t},f:function(){try{r||null==i.return||i.return()}finally{if(l)throw o}}}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}e.a={name:"ItemImgList",store:g.a,props:{value:{type:Array,default:function(){return[]}},maxlength:{type:Number,default:3},editabled:{type:Boolean,default:!0},allowSelectAlbum:{type:Boolean,default:void 0},allowBuildinAlbum:{type:Boolean,default:void 0},allowMultiSelect:{type:Boolean,default:!0},editedBy:{type:String,default:""},prepareCallback:{type:Function,default:function(){}},cancelCallback:{type:Function,default:function(){}},onlineMode:{type:Boolean},trackText:{type:String,default:""},userLink:{type:Boolean,default:!1},allowVideo:{type:Boolean,default:!0},beforeEdit:{type:Function,default:function(){}},folder:{type:String,default:"images"},group:{type:String},modelId:{type:String},modelTable:{type:String},modelField:{type:String},pointImageMode:{type:Boolean,default:!1},pointImageEdit:{type:Function,default:function(){}}},data:function(){return{moduleCode:s.default.getCurrentModuleCode(),currentUserId:h.a.getUser().user_id,thumbnailSet:{},statusSet:{},throttleAddImage:t.throttle(this.addImage,2e3,{trailing:!1}),throttleAddVideo:t.throttle(this.addVideo,2e3,{trailing:!1}),throttleSelectImage:t.throttle(this.selectImage,2e3,{trailing:!1}),throttleAppImage:t.throttle(this.selectAppImage,2e3,{trailing:!1}),viewImages:[],pluginAllowVideo:c.a.allowShootVideo(),imageLoading:d.a.IMAGE_LOADING}},computed:{allowAlbum:function(){return t.isBoolean(this.allowSelectAlbum)?this.allowSelectAlbum:this.$store.state.global.allowSelectPictureFromAlbums[this.moduleCode]},allowBuildin:function(){return t.isBoolean(this.allowBuildinAlbum)?this.allowBuildinAlbum:this.$store.state.global.allowSelectPictureFromBuildinAlbums[this.moduleCode]},hasVideoItem:function(){return this.allowVideo&&this.pluginAllowVideo}},watch:{value:{handler:function(t){t&&t.length&&(this.init(),this.setThumbnail(t))},immediate:!0}},created:function(){var e=this;this.$on("changeViewValue",(function(i){var n=t.clone(e.value),a=t.findIndex(n,{id:i.id}),o=e.modelId,r=e.modelTable,l=e.modelField;n[a]=i,e.$emit("input",n),o&&r&&l||console.error("更换图片失败，数据库参数不全",{modelId:o,modelTable:r,modelField:l});var c={};c[l]=Object(b.o)(n),localDB.update(r,c,{id:o}).then((function(){s.default.addSyncGroup([[r,o,"id"]])}))}))},methods:{init:function(){var e=this;t.each(this.value,(function(t){if(!t.id){var i=t.url||t.temp||"";i=l.a.replaceAll(i,"\\?x-oss-process=image\\/resize,","@");var n=l.a.strRightBack(i,"/"),a=l.a.strLeftBack(n,".")||+new Date;e.$set(t,"id",a)}t.temp&&e.$set(t,"temp",c.a.fixImagePath(t.temp)),t.videoTemp&&e.$set(t,"videoTemp",c.a.fixImagePath(t.videoTemp)),t.local&&e.$set(t,"local",c.a.fixImagePath(t.local))}))},setThumbnail:function(){var t,e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=A(i);try{var a=function(){var i=t.value,n=i||{},a=n.temp,o=n.id,r=n.url;if(void 0!==e.thumbnailSet[o]){if(![d.a.IMAGE_LOADING,d.a.IMAGE_RELOAD].includes(e.thumbnailSet[o]))return"continue"}else e.$set(e.statusSet,o,""),e.$set(e.thumbnailSet,o,d.a.IMAGE_LOADING);if("dev"===APP_ENV)return r&&(e.thumbnailSet[o]=d.a.getImageThumbnail(i)),"continue";if(i.temp){if("loading"!==e.statusSet[o]){e.statusSet[o]="loading",e.thumbnailSet[o]=d.a.IMAGE_LOADING;var l={width:270,height:270},s=I.a.createThumbnailPath(a,l);S.a.isFileExists(s).then((function(t){t?(e.statusSet[o]="successed",e.thumbnailSet[o]=s):I.a.createThumbnail(a,s,l).then((function(){e.statusSet[o]="successed",e.thumbnailSet[o]=s})).catch((function(){e.statusSet[o]="successed",e.thumbnailSet[o]=a}))}))}return"continue"}if(e.onlineMode)e.thumbnailSet[o]=r;else if(r){if("loading"!==e.statusSet[o]){e.statusSet[o]="loading";var c=d.a.getImageThumbnail(i);d.a.isNeedDownload(c,"thumbnail").then((function(t){t?d.a.download(c,"","thumbnail").then((function(t){e.statusSet[o]="successed",e.thumbnailSet[o]=t})).catch((function(t){console.error(t),e.statusSet[o]="failed",e.thumbnailSet[o]=d.a.IMAGE_RELOAD})):(e.statusSet[i.id]="successed",e.thumbnailSet[o]=d.a.getPathFromUrl(c,"thumbnail"))}))}}else e.thumbnailSet[o]=d.a.IMAGE_PLACEHOLD};for(n.s();!(t=n.n()).done;)a()}catch(t){n.e(t)}finally{n.f()}},getSizeText:function(t){return t&&t.size?f.a.formatFilesize(t.size):""},getAllItems:function(){var e=this;if(this.group){var i=[],n=document.querySelectorAll(".item-img-list-"+this.group),a=t.map(n,(function(t){return t.__vue__}));return t.each(a,(function(e){t.each(e.value,(function(t){var n=P(P({},t),{},{component:e});i.push(n)}))})),i}return t.map(this.value,(function(t){return P(P({},t),{},{component:e})}))},imgView:function(e){var i=this,n=this.getAllItems(),a=t.findIndex(n,{id:e.id}),o=t.some(n,(function(t){return"loading"===i.statusSet[t.id]}));if(o)m.a.alert("正在下载图片，请稍等");else{var r={};if(this.editabled||this.editedBy!==this.currentUserId||"process-accept"===this.moduleCode||(r.toolBar={isShow:!0,isShowChange:!0},this.allowAlbum||(r.toolBar.changeOption=[1])),this.onlineMode)return this.viewImages=d.a.convertMediaList(n,!0),void c.a.openImageBrowser(this.viewImages,a,r).then(null,null,this.changeViewImage);if("dev"===APP_ENV)return this.viewImages=d.a.convertMediaList(n,!0),void c.a.openImageBrowser(this.viewImages,a,r).then(null,null,this.changeViewImage);var l=[];t.each(n,(function(t){var e;if("dev"===APP_ENV)e=Promise.resolve(t.url);else if(t.temp)e=Promise.resolve(t.temp);else{var n=d.a.getImageUrl(t);e=d.a.isNeedDownload(n,i.folder).then((function(e){return e?(i.$set(i.statusSet,t.id,"loading"),d.a.download(n,!1,i.folder).then((function(e){return i.$set(i.statusSet,t.id,"successed"),e}))):d.a.getPathFromUrl(n,i.folder)}))}l.push(e)})),Promise.all(l).then((function(e){var o=t.map(n,(function(t,i){return t&&(t.videoUrl||t.videoTemp)?{image:d.a.fixUrl(e[i]),video:d.a.fixUrl(t.videoUrl||t.videoTemp)}:d.a.fixUrl(e[i])}));i.viewImages=o,c.a.openImageBrowser(o,a,r).then(null,null,i.changeViewImage)}))}},changeViewImage:function(e){var i=this.getAllItems(),n=e.change,a=n.imagePath,o=n.exchangePath,r=n.changeMode,s=l.a.strRightBack(a,"/"),u=i[t.findIndex(this.viewImages,(function(e){var i;if(t.isObject(e)){var n=e.image;i=l.a.strRightBack(n,"/")}else i=t.isString(e)?l.a.strRightBack(e,"/"):"";return i===s}))];if(u){var p={id:u.id,temp:o},m=u.component;return c.a.getWaterMark(1===r?[x.e,x.d,x.c]:[x.e],1===r).then((function(t){return c.a.addWaterMark(p.temp,t).then((function(t){if(p.temp=t,1===r&&w.a.handelPicture(t),"dev"===APP_ENV)return d.a.uploadImage(t).then((function(t){p.url=t}))}))})).then((function(){m.$emit("changeViewValue",p)})).catch((function(t){console.error(t)}))}console.error("更换图片错误",e,i)},addImage:function(){var t=this;return Promise.resolve().then((function(){return t.beforeEdit()})).then((function(){return t.prepareCallback()})).then((function(){return d.a.takePicture()})).then((function(e){if(!e)return!1;console.log("获取图片数据",e),!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show();var i=t.value.concat(e);return e.user_id=t.currentUserId,w.a.handelPicture(e.temp).then((function(){"dev"===APP_ENV&&(t.$set(t.statusSet,e.id,"loading"),d.a.uploadImage(e.temp).then((function(t){e.url=t})).then((function(){t.$emit("input",Object(a.a)(i)),t.$emit("callback",Object(a.a)(i))})))})).then((function(){t.$emit("input",i),t.$emit("callback",i)})),!0})).catch((function(e){return $log.error(e),m.a.alert(e||"发生了错误"),t.cancelCallback(),!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show(),!1}))},addVideo:function(){var e=this;return Promise.resolve().then((function(){return e.beforeEdit()})).then((function(){return e.prepareCallback()})).then((function(){return d.a.shootVideo()})).then((function(i){if(!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show(),t.isEmpty(i))return!1;i.user_id=e.currentUserId;var n=e.value.concat(i);return e.$emit("input",n),e.$emit("callback",n),"dev"===APP_ENV&&(e.$set(e.statusSet,i.id,"loading"),d.a.uploadImage(i.temp).then((function(t){i.url=t})).then((function(){return p.a.uploadFile(i.videoTemp).then((function(t){i.videoUrl=t}))})).then((function(){e.$emit("input",Object(a.a)(n)),e.$emit("callback",Object(a.a)(n))}))),!0})).catch((function(t){return $log.error(t),m.a.alert(t||"发生了错误"),e.cancelCallback(),!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show(),!1}))},selectImage:function(){var e,i=this;if(this.allowMultiSelect){var n=Math.max(this.maxlength-this.value.length,0);e={maxSelectCount:n}}return Promise.resolve().then((function(){return i.beforeEdit()})).then((function(){return i.prepareCallback()})).then((function(){return d.a.selectPicture(e)})).then((function(e){if(!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show(),t.isEmpty(e))return!1;t.each(e,(function(t){t.user_id=i.currentUserId}));var n=i.value.concat(e);if(i.$emit("input",n),i.$emit("callback",n),"dev"===APP_ENV){var o=Promise.resolve();t.each(e,(function(t){i.$set(i.statusSet,t.id,"loading"),o=o.then((function(){return d.a.uploadImage(t.temp).then((function(e){delete t.temp,t.url=e}))}))})),o.then((function(){i.$emit("input",Object(a.a)(n)),i.$emit("callback",Object(a.a)(n))}))}return!0})).catch((function(t){return $log.error(t),m.a.alert(t||"发生了错误"),i.cancelCallback(),!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show(),!1}))},addAppImage:function(e){var i=this;if(t.isEmpty(e))return Promise.reject("没有选择图片");var n=this.value.concat(e);return this.trackText&&u.a.addTrack(this.trackText+"-从APP相册选择照片","",""),Promise.all(t.map(e,(function(t){var e=f.a.uuid(),n=c.a.appImagePath()+"images/"+e+".jpg";return c.a.copyFile(t.temp,n).then((function(){t.id=e,t.temp=n,t.user_id=i.currentUserId})).then((function(){"dev"===APP_ENV&&(i.$set(i.statusSet,t.id,"loading"),d.a.uploadImage(t.temp).then((function(e){t.url=e})))}))}))).then((function(){i.$emit("input",n),i.$emit("callback",n)}))},selectAppImage:function(){var t=this;return new Promise(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(i,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.beforeEdit();case 3:w.a.maxImageLength=Math.max(t.maxlength-t.value.length,0),v.a.openPopup({bool:!0,callback:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.addAppImage(n).catch((function(t){m.a.alert(t),i(!1)}));case 2:i(!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),m.a.alert(e.t0),i(!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,i){return e.apply(this,arguments)}}())},removeImage:function(e){var i=this,n=e.videoTemp?"确定要删除视频吗？":"确定要删除图片吗？";Promise.resolve().then((function(){return i.beforeEdit()})).then((function(){m.a.confirm(n).then((function(n){if(n){var a=i.value,o=t.indexOf(a,e);o>-1&&a.splice(o,1),i.$emit("remove",{index:o}),i.$emit("input",a),i.$emit("callback",a)}}))})).catch((function(t){m.a.alert(t)}))}}}}).call(this,i("391c"))},e68e:function(t,e,i){"use strict";var n=i("d209").a,a=(i("56bf"),i("17cc")),o=Object(a.a)(n,(function(){var t,e=this,i=e.$createElement,n=e._self._c||i;return e.editabled||e.value.length?n("ul",{staticClass:"item-img-list",class:(t={},t["item-img-list-"+e.group]=e.group,t)},[e.value.length?e._l(e.value,(function(t,i){return n("li",{key:i,style:{"background-image":"url("+(e.thumbnailSet[t.id]||e.imageLoading)+")"},on:{click:function(n){e.imgView(t,i)}}},[!1===e.editabled||e.userLink&&(!e.userLink||t.user_id!==e.currentUserId)||e.pointImageMode?e._e():n("i",{staticClass:"icon-minus",on:{click:function(i){i.stopPropagation(),e.removeImage(t)}}}),t.videoUrl?n("van-icon",{attrs:{name:"play"}}):e._e(),t.size?n("i",{staticClass:"size"},[e._v(e._s(e.getSizeText(t)))]):e._e()],1)})):e._e(),e.pointImageMode?[e.value.length<e.maxlength&&!1!==e.editabled?n("li",{staticClass:"no-img",on:{click:e.pointImageEdit}},[n("p",{staticClass:"list-icon"},[n("icon",{attrs:{name:"dianweizhao"}})],1),n("p",{staticClass:"list-text"},[e._v("点位照")])]):e._e()]:[e.value.length<e.maxlength&&!1!==e.editabled?n("li",{staticClass:"no-img",on:{click:e.throttleAddImage}},[n("p",{staticClass:"list-icon"},[n("icon",{attrs:{name:"paizhao"}})],1),n("p",{staticClass:"list-text"},[e._v("拍照")])]):e._e(),e.value.length<e.maxlength&&!1!==e.editabled&&e.hasVideoItem?n("li",{staticClass:"no-img",on:{click:e.throttleAddVideo}},[n("p",{staticClass:"list-icon"},[n("icon",{attrs:{name:"shoot-video"}})],1),n("p",{staticClass:"list-text"},[e._v("拍视频")])]):e._e(),e.value.length<e.maxlength&&!1!==e.editabled&&e.allowAlbum?n("li",{staticClass:"no-img",on:{click:e.throttleSelectImage}},[n("p",{staticClass:"list-icon"},[n("icon",{attrs:{name:"xiangce"}})],1),n("p",{staticClass:"list-text"},[e._v("手机相册")])]):e._e(),e.value.length<e.maxlength&&!1!==e.editabled&&e.allowBuildin?n("li",{staticClass:"no-img",on:{click:e.throttleAppImage}},[n("p",{staticClass:"list-icon"},[n("icon",{attrs:{name:"xiangce"}})],1),n("p",{staticClass:"list-text"},[e._v("APP相册")])]):e._e()]],2):e._e()}),[],!1,null,null,null);e.a=o.exports},ea6b:function(t,e,i){var n=i("8cb7");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,i("85cb").default)("2c75d179",n,!0,{sourceMap:!1,shadowMode:!1})}}]);