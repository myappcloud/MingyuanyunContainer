(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-e17bca40"],{"56bf":function(e,t,i){"use strict";i("ea6b")},"8cb7":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,'.zjapp .item-img-list{display:flex;flex-direction:row;flex-wrap:wrap;align-content:flex-start;align-items:flex-start;margin-top:-15px;margin-left:-15px}.zjapp .item-img-list li{position:relative;width:70px;height:70px;margin-left:15px;margin-top:15px;background:no-repeat 50%;background-size:cover;background-color:#eee;transform:translateZ(0)}.zjapp .item-img-list-popup{padding:0}.zjapp .item-img-list-popup .item-img-list{margin-top:0;text-align:center;font-size:0;white-space:nowrap}.zjapp .item-img-list-popup .item-img-list li{float:none;display:inline-block;vertical-align:top;background-color:transparent;border-color:#fff;color:#fff}.zjapp .item-img-list .icon-minus{position:absolute;top:-10px;right:-10px;width:20px;height:20px;line-height:20px;border-radius:10px;background-color:#ff4546;color:#fff;font-size:14px;text-align:center}.zjapp .item-img-list .icon-minus:before{content:"";position:absolute;left:5px;top:9px;width:10px;height:2px;background-color:#fff}.zjapp .item-img-list .no-img{color:#4275e8;background:#fff;line-height:70px;text-align:center;font-size:45px;border:1px dotted #4275e8}.zjapp .item-img-list .add-img{color:#b6b6b6;background:#fff;line-height:70px;text-align:center;font-size:40px;border:1px dotted #c6c6c6}.zjapp .item-img-list .list-icon{height:40px;line-height:30px;padding-top:10px;overflow:hidden;font-size:40px}.zjapp .item-img-list .list-icon i{font-size:28px;display:block}.zjapp .item-img-list .list-icon i:before{vertical-align:top}.zjapp .item-img-list .list-icon .icon-shoot-video{font-size:24px;margin-top:1px}.zjapp .item-img-list .list-text{line-height:20px;font-size:14px}.zjapp .item-img-list .van-icon-play{position:absolute;top:15px;left:20px;padding-left:2px;width:30px;height:30px;line-height:28px;text-align:center;font-size:22px;color:hsla(0,0%,100%,.8);border:1px solid hsla(0,0%,100%,.8);border-radius:15px}.zjapp .item-img-list .size{position:absolute;bottom:0;right:5px;line-height:18px;color:#fff;font-size:10px;font-style:normal}',""])},d209:function(e,t,i){"use strict";(function(e){i("5ab2"),i("e10e"),i("309f"),i("0b53"),i("ec25"),i("cc57"),i("2b45"),i("6a61");var n=i("2e91"),a=i("4c09"),o=(i("6d57"),i("06a2"),i("28f8")),r=(i("ed63"),i("8cf2"),i("e204"),i("163d"),i("a32d")),l=i.n(r),s=i("48f4"),c=i("4ad6"),u=i("a500"),d=i("3122"),p=i("162a"),m=i("e2a7"),h=i("3bd5"),f=i("ed08"),g=i("4360"),b=i("7cb8"),v=i("6cb4"),w=i("cc90"),x=(i("8d95"),i("d873")),I=i("7010"),S=i("b6ea");function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function P(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?y(Object(i),!0).forEach((function(t){Object(o.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function k(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return A(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,l=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return r=e.done,e},e:function(e){l=!0,o=e},f:function(){try{r||null==i.return||i.return()}finally{if(l)throw o}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}t.a={name:"ItemImgList",store:g.a,props:{value:{type:Array,default:function(){return[]}},maxlength:{type:Number,default:3},editabled:{type:Boolean,default:!0},allowSelectAlbum:{type:Boolean,default:void 0},allowBuildinAlbum:{type:Boolean,default:void 0},allowMultiSelect:{type:Boolean,default:!0},editedBy:{type:String,default:""},prepareCallback:{type:Function,default:function(){}},cancelCallback:{type:Function,default:function(){}},onlineMode:{type:Boolean},trackText:{type:String,default:""},userLink:{type:Boolean,default:!1},allowVideo:{type:Boolean,default:!0},beforeEdit:{type:Function,default:function(){}},folder:{type:String,default:"images"},group:{type:String},modelId:{type:String},modelTable:{type:String},modelField:{type:String},pointImageMode:{type:Boolean,default:!1},pointImageEdit:{type:Function,default:function(){}}},data:function(){return{moduleCode:s.default.getCurrentModuleCode(),currentUserId:h.a.getUser().user_id,thumbnailSet:{},statusSet:{},throttleAddImage:e.throttle(this.addImage,2e3,{trailing:!1}),throttleAddVideo:e.throttle(this.addVideo,2e3,{trailing:!1}),throttleSelectImage:e.throttle(this.selectImage,2e3,{trailing:!1}),throttleAppImage:e.throttle(this.selectAppImage,2e3,{trailing:!1}),viewImages:[],imageLoading:d.a.IMAGE_LOADING}},computed:{allowAlbum:function(){return e.isBoolean(this.allowSelectAlbum)?this.allowSelectAlbum:this.$store.state.global.allowSelectPictureFromAlbums[this.moduleCode]},allowBuildin:function(){return e.isBoolean(this.allowBuildinAlbum)?this.allowBuildinAlbum:this.$store.state.global.allowSelectPictureFromBuildinAlbums[this.moduleCode]},hasVideoItem:function(){return this.allowVideo}},watch:{value:{handler:function(e){e&&e.length&&(this.init(),this.setThumbnail(e))},immediate:!0}},created:function(){var t=this;this.$on("changeViewValue",(function(i){var n=e.clone(t.value),a=e.findIndex(n,{id:i.id}),o=t.modelId,r=t.modelTable,l=t.modelField;n[a]=i,t.$emit("input",n),o&&r&&l||console.error("更换图片失败，数据库参数不全",{modelId:o,modelTable:r,modelField:l});var c={};c[l]=Object(b.o)(n),localDB.update(r,c,{id:o}).then((function(){s.default.addSyncGroup([[r,o,"id"]])}))}))},methods:{init:function(){var t=this;e.each(this.value,(function(e){if(!e.id){var i=e.url||e.temp||"";i=l.a.replaceAll(i,"\\?x-oss-process=image\\/resize,","@");var n=l.a.strRightBack(i,"/"),a=l.a.strLeftBack(n,".")||+new Date;t.$set(e,"id",a)}e.temp&&t.$set(e,"temp",c.a.fixImagePath(e.temp)),e.videoTemp&&t.$set(e,"videoTemp",c.a.fixImagePath(e.videoTemp)),e.local&&t.$set(e,"local",c.a.fixImagePath(e.local))}))},setThumbnail:function(){var e,t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=k(i);try{var a=function(){var i=e.value,n=i||{},a=n.temp,o=n.id,r=n.url;if(void 0!==t.thumbnailSet[o]){if(![d.a.IMAGE_LOADING,d.a.IMAGE_RELOAD].includes(t.thumbnailSet[o]))return"continue"}else t.$set(t.statusSet,o,""),t.$set(t.thumbnailSet,o,d.a.IMAGE_LOADING);if("dev"===APP_ENV)return r&&(t.thumbnailSet[o]=d.a.getImageThumbnail(i)),"continue";if(i.temp){if("loading"!==t.statusSet[o]){t.statusSet[o]="loading",t.thumbnailSet[o]=d.a.IMAGE_LOADING;var l={width:270,height:270},s=I.a.createThumbnailPath(a,l);S.a.isFileExists(s).then((function(e){e?(t.statusSet[o]="successed",t.thumbnailSet[o]=s):I.a.createThumbnail(a,s,l).then((function(){t.statusSet[o]="successed",t.thumbnailSet[o]=s})).catch((function(){t.statusSet[o]="successed",t.thumbnailSet[o]=a}))}))}return"continue"}if(t.onlineMode)t.thumbnailSet[o]=r;else if(r){if("loading"!==t.statusSet[o]){t.statusSet[o]="loading";var c=d.a.getImageThumbnail(i);d.a.isNeedDownload(c,"thumbnail").then((function(e){e?d.a.download(c,"","thumbnail").then((function(e){t.statusSet[o]="successed",t.thumbnailSet[o]=e})).catch((function(e){console.error(e),t.statusSet[o]="failed",t.thumbnailSet[o]=d.a.IMAGE_RELOAD})):(t.statusSet[i.id]="successed",t.thumbnailSet[o]=d.a.getPathFromUrl(c,"thumbnail"))}))}}else t.thumbnailSet[o]=d.a.IMAGE_PLACEHOLD};for(n.s();!(e=n.n()).done;)a()}catch(e){n.e(e)}finally{n.f()}},getSizeText:function(e){return e&&e.size?f.a.formatFilesize(e.size):""},getAllItems:function(){var t=this;if(this.group){var i=[],n=document.querySelectorAll(".item-img-list-"+this.group),a=e.map(n,(function(e){return e.__vue__}));return e.each(a,(function(t){e.each(t.value,(function(e){var n=P(P({},e),{},{component:t});i.push(n)}))})),i}return e.map(this.value,(function(e){return P(P({},e),{},{component:t})}))},imgView:function(t){var i=this,n=this.getAllItems(),a=e.findIndex(n,{id:t.id}),o=e.some(n,(function(e){return"loading"===i.statusSet[e.id]}));if(o)m.a.alert("正在下载图片，请稍等");else{var r={};if(this.editabled||this.editedBy!==this.currentUserId||"process-accept"===this.moduleCode||(r.toolBar={isShow:!0,isShowChange:!0},this.allowAlbum||(r.toolBar.changeOption=[1])),this.onlineMode)return this.viewImages=d.a.convertMediaList(n,!0),void c.a.openImageBrowser(this.viewImages,a,r).then(null,null,this.changeViewImage);if("dev"===APP_ENV)return this.viewImages=d.a.convertMediaList(n,!0),void c.a.openImageBrowser(this.viewImages,a,r).then(null,null,this.changeViewImage);var l=[];e.each(n,(function(e){var t;if("dev"===APP_ENV)t=Promise.resolve(e.url);else if(e.temp)t=Promise.resolve(e.temp);else{var n=d.a.getImageUrl(e);t=d.a.isNeedDownload(n,i.folder).then((function(t){return t?(i.$set(i.statusSet,e.id,"loading"),d.a.download(n,!1,i.folder).then((function(t){return i.$set(i.statusSet,e.id,"successed"),t}))):d.a.getPathFromUrl(n,i.folder)}))}l.push(t)})),Promise.all(l).then((function(t){var o=e.map(n,(function(e,i){return e&&(e.videoUrl||e.videoTemp)?{image:d.a.fixUrl(t[i]),video:d.a.fixUrl(e.videoUrl||e.videoTemp)}:d.a.fixUrl(t[i])}));i.viewImages=o,c.a.openImageBrowser(o,a,r).then(null,null,i.changeViewImage)}))}},changeViewImage:function(t){var i=this.getAllItems(),n=t.change,a=n.imagePath,o=n.exchangePath,r=n.changeMode,s=l.a.strRightBack(a,"/"),u=i[e.findIndex(this.viewImages,(function(t){var i;if(e.isObject(t)){var n=t.image;i=l.a.strRightBack(n,"/")}else i=e.isString(t)?l.a.strRightBack(t,"/"):"";return i===s}))];if(u){var p={id:u.id,temp:o},m=u.component;return c.a.getWaterMark(1===r?[x.e,x.d,x.c]:[x.e],1===r).then((function(e){return c.a.addWaterMark(p.temp,e).then((function(e){if(p.temp=e,1===r&&w.a.handelPicture(e),"dev"===APP_ENV)return d.a.uploadImage(e).then((function(e){p.url=e}))}))})).then((function(){m.$emit("changeViewValue",p)})).catch((function(e){console.error(e)}))}console.error("更换图片错误",t,i)},addImage:function(){var e=this;return Promise.resolve().then((function(){return e.beforeEdit()})).then((function(){return e.prepareCallback()})).then((function(){return d.a.takePicture()})).then((function(t){if(!t)return!1;console.log("获取图片数据",t),!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show();var i=e.value.concat(t);return t.user_id=e.currentUserId,w.a.handelPicture(t.temp).then((function(){"dev"===APP_ENV&&(e.$set(e.statusSet,t.id,"loading"),d.a.uploadImage(t.temp).then((function(e){t.url=e})).then((function(){e.$emit("input",Object(a.a)(i)),e.$emit("callback",Object(a.a)(i))})))})).then((function(){e.$emit("input",i),e.$emit("callback",i)})),!0})).catch((function(t){return $log.error(t),m.a.alert(t||"发生了错误"),e.cancelCallback(),!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show(),!1}))},addVideo:function(){var t=this;return Promise.resolve().then((function(){return t.beforeEdit()})).then((function(){return t.prepareCallback()})).then((function(){return d.a.shootVideo()})).then((function(i){if(!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show(),e.isEmpty(i))return!1;i.user_id=t.currentUserId;var n=t.value.concat(i);return t.$emit("input",n),t.$emit("callback",n),"dev"===APP_ENV&&(t.$set(t.statusSet,i.id,"loading"),d.a.uploadImage(i.temp).then((function(e){i.url=e})).then((function(){return p.a.uploadFile(i.videoTemp).then((function(e){i.videoUrl=e}))})).then((function(){t.$emit("input",Object(a.a)(n)),t.$emit("callback",Object(a.a)(n))}))),!0})).catch((function(e){return $log.error(e),m.a.alert(e||"发生了错误"),t.cancelCallback(),!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show(),!1}))},selectImage:function(){var t,i=this;if(this.allowMultiSelect){var n=Math.max(this.maxlength-this.value.length,0);t={maxSelectCount:n}}return Promise.resolve().then((function(){return i.beforeEdit()})).then((function(){return i.prepareCallback()})).then((function(){return d.a.selectPicture(t)})).then((function(t){if(!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show(),e.isEmpty(t))return!1;console.log("images",t),e.each(t,(function(e){e.user_id=i.currentUserId}));var n=i.value.concat(t);if(i.$emit("input",n),i.$emit("callback",n),"dev"===APP_ENV){var o=Promise.resolve();e.each(t,(function(e){i.$set(i.statusSet,e.id,"loading"),o=o.then((function(){return d.a.uploadImage(e.temp).then((function(t){delete e.temp,e.url=t}))})).then((function(){if(e.videoTemp)return p.a.uploadFile(e.videoTemp).then((function(t){e.videoUrl=t}))}))})),o.then((function(){i.$emit("input",Object(a.a)(n)),i.$emit("callback",Object(a.a)(n))}))}return!0})).catch((function(e){return $log.error(e),m.a.alert(e||"发生了错误"),i.cancelCallback(),!g.a.state.global.hasTopProgress&&window&&window.StatusBar&&window.StatusBar.show(),!1}))},addAppImage:function(t){var i=this;if(e.isEmpty(t))return Promise.reject("没有选择图片");var n=this.value.concat(t);return this.trackText&&u.a.addTrack(this.trackText+"-从APP相册选择照片","",""),Promise.all(e.map(t,(function(e){var t=f.a.uuid(),n=c.a.appImagePath()+"images/"+t+".jpg";return c.a.copyFile(e.temp,n).then((function(){e.id=t,e.temp=n,e.user_id=i.currentUserId})).then((function(){"dev"===APP_ENV&&(i.$set(i.statusSet,e.id,"loading"),d.a.uploadImage(e.temp).then((function(t){e.url=t})))}))}))).then((function(){i.$emit("input",n),i.$emit("callback",n)}))},selectAppImage:function(){var e=this;return new Promise(function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(i,a){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.beforeEdit();case 3:w.a.maxImageLength=Math.max(e.maxlength-e.value.length,0),v.a.openPopup({bool:!0,callback:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.addAppImage(n).catch((function(e){m.a.alert(e),i(!1)}));case 2:i(!0);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),m.a.alert(t.t0),i(!1);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,i){return t.apply(this,arguments)}}())},removeImage:function(t){var i=this,n=t.videoTemp?"确定要删除视频吗？":"确定要删除图片吗？";Promise.resolve().then((function(){return i.beforeEdit()})).then((function(){m.a.confirm(n).then((function(n){if(n){var a=i.value,o=e.indexOf(a,t);o>-1&&a.splice(o,1),i.$emit("remove",{index:o}),i.$emit("input",a),i.$emit("callback",a)}}))})).catch((function(e){m.a.alert(e)}))}}}}).call(this,i("391c"))},e68e:function(e,t,i){"use strict";var n=i("d209").a,a=(i("56bf"),i("17cc")),o=Object(a.a)(n,(function(){var e,t=this,i=t.$createElement,n=t._self._c||i;return t.editabled||t.value.length?n("ul",{staticClass:"item-img-list",class:(e={},e["item-img-list-"+t.group]=t.group,e)},[t.value.length?t._l(t.value,(function(e,i){return n("li",{key:i,style:{"background-image":"url("+(t.thumbnailSet[e.id]||t.imageLoading)+")"},on:{click:function(n){t.imgView(e,i)}}},[!1===t.editabled||t.userLink&&(!t.userLink||e.user_id!==t.currentUserId)||t.pointImageMode?t._e():n("i",{staticClass:"icon-minus",on:{click:function(i){i.stopPropagation(),t.removeImage(e)}}}),e.videoUrl?n("van-icon",{attrs:{name:"play"}}):t._e(),e.size?n("i",{staticClass:"size"},[t._v(t._s(t.getSizeText(e)))]):t._e()],1)})):t._e(),t.pointImageMode?[t.value.length<t.maxlength&&!1!==t.editabled?n("li",{staticClass:"no-img",on:{click:t.pointImageEdit}},[n("p",{staticClass:"list-icon"},[n("icon",{attrs:{name:"dianweizhao"}})],1),n("p",{staticClass:"list-text"},[t._v("点位照")])]):t._e()]:[t.value.length<t.maxlength&&!1!==t.editabled?n("li",{staticClass:"no-img",on:{click:t.throttleAddImage}},[n("p",{staticClass:"list-icon"},[n("icon",{attrs:{name:"paizhao"}})],1),n("p",{staticClass:"list-text"},[t._v("拍照")])]):t._e(),t.value.length<t.maxlength&&!1!==t.editabled&&t.hasVideoItem?n("li",{staticClass:"no-img",on:{click:t.throttleAddVideo}},[n("p",{staticClass:"list-icon"},[n("icon",{attrs:{name:"shoot-video"}})],1),n("p",{staticClass:"list-text"},[t._v("拍视频")])]):t._e(),t.value.length<t.maxlength&&!1!==t.editabled&&t.allowAlbum?n("li",{staticClass:"no-img",on:{click:t.throttleSelectImage}},[n("p",{staticClass:"list-icon"},[n("icon",{attrs:{name:"xiangce"}})],1),n("p",{staticClass:"list-text"},[t._v("手机相册")])]):t._e(),t.value.length<t.maxlength&&!1!==t.editabled&&t.allowBuildin?n("li",{staticClass:"no-img",on:{click:t.throttleAppImage}},[n("p",{staticClass:"list-icon"},[n("icon",{attrs:{name:"xiangce"}})],1),n("p",{staticClass:"list-text"},[t._v("APP相册")])]):t._e()]],2):t._e()}),[],!1,null,null,null);t.a=o.exports},ea6b:function(e,t,i){var n=i("8cb7");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,i("85cb").default)("2c75d179",n,!0,{sourceMap:!1,shadowMode:!1})}}]);