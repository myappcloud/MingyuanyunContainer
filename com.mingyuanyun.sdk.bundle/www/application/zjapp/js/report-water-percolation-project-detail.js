(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["report-water-percolation-project-detail","chunk-2709989a"],{"01fe":function(t,e,i){"use strict";var a=i("329b"),n=i("ff1c").a,s=(i("43a7"),i("17cc")),o=Object(s.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"slide-right"},on:{afterLeave:t.onClose}},[t.show?i("page-content",{attrs:{mode:"dialog",title:"点位图","on-close":t.close}},["view"!==t.mode?i("div",{staticClass:"back-button button-clear mr0 pr10",attrs:{slot:"header-bar-right"},on:{click:t.save},slot:"header-bar-right"},[t._v("\n      保存\n    ")]):t._e(),t.showDetail?i("div",{staticClass:"peocess-accept-point-image-detail"},["accept"!=t.mode?i("div",{staticClass:"peocess-accept-point-image-remove",on:{click:function(e){t.removePoint()}}}):t._e(),i("div",{staticClass:"item-img-list-popup item-img-list-point border-none peocess-accept-point-center"},[i("item-img-list",{attrs:{maxlength:15,editabled:"view"!==t.mode,"user-link":!0},model:{value:t.imageFiles,callback:function(e){t.imageFiles=e},expression:"imageFiles"}})],1),i("div",{staticClass:"peocess-accept-point-image-save",on:{click:function(e){t.savePoint()}}})]):t._e(),"view"!==t.mode?i("div",{staticClass:"tips"},[i("i",{staticClass:"iconfont icon-tishi"}),t._v("\n      "+t._s("accept"===t.mode?"在户型图已有点位上点击可添加照片":"在户型图上适当位置点击可标记点位")+"\n    ")]):t._e(),t.url?i("drawing",{staticStyle:{flex:"1"},attrs:{url:t.url,points:t.points},on:{onclick:t.onDrawingClick}}):t._e(),t.url?t._e():i("loading-status",{attrs:{"is-empty":!t.url,"empty-text":"没有户型图","content-height":t.viewSize.contentHeight}})],1):t._e()],1)}),[],!1,null,"bf62585e",null).exports,r=!1;r||(r=new(a.default.extend(o))({el:document.createElement("div")}),document.body.appendChild(r.$el));e.a=r},"0aac":function(t,e,i){"use strict";i("2814")},"0cb6":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .problem-detail-header[data-v-0901aadd]{display:flex;align-items:center;justify-content:center;height:40px;padding:0 15px;line-height:40px;background-color:#f2f2f2}.zjapp .problem-detail-header .status[data-v-0901aadd]{flex:1;height:16px;line-height:16px;border-left:5px solid #ddd;padding-left:5px;color:#111;font-size:16px}.zjapp .problem-detail-header .status-red[data-v-0901aadd]{border-color:#ff3d3d}.zjapp .problem-detail-header .status-blue[data-v-0901aadd]{border-color:#4275e8}.zjapp .problem-detail-header .status-green[data-v-0901aadd]{border-color:#0bc666}.zjapp .problem-detail-header .status-orange[data-v-0901aadd]{border-color:#fc8b01}.zjapp .problem-detail-header .status-black[data-v-0901aadd]{border-color:#333}.zjapp .problem-detail-header .status-gray[data-v-0901aadd]{border-color:#999}.zjapp .problem-detail-header .return[data-v-0901aadd],.zjapp .problem-detail-header .timeout[data-v-0901aadd],.zjapp .problem-detail-header .urgent[data-v-0901aadd]{display:block;padding:0 5px;margin-left:6px;height:16px;line-height:16px;color:#fff;font-size:12px;border-radius:2px;-webkit-border-radius:2px}.zjapp .problem-detail-header .urgent[data-v-0901aadd]{background-color:#ff3d3d}.zjapp .problem-detail-header .timeout[data-v-0901aadd]{background-color:#954cfe}.zjapp .problem-detail-header .return[data-v-0901aadd]{background-color:#fc8b01}.zjapp .problem-detail-header .operat[data-v-0901aadd]{height:40px;line-height:40px;white-space:nowrap;font-size:16px;color:#6b7ba9}",""])},"0d9c":function(t,e,i){"use strict";i("bbe1")},1011:function(t,e,i){"use strict";(function(t){var a=i("e2a7"),n=i("07d2"),s=i("774b"),o=i("e68e"),r=i("cd05"),c=i("da1c"),l=i("5a71"),h=i("6718"),d=i("01fe"),u=i("0818"),p=i("162a"),f=i("06f6");e.a={name:"WaterPercolationDetail",components:{item:n.default,Scroller:s.default,ItemImgList:o.a,UserSelect:r.a,ProblemDetailHeader:c.a,SingleSelect:l.a,SwipeTabs:h.b,SwipeTab:h.a},data:function(){return{isLoading:!0,errorType:"report",title:"...",list:[],projId:"",roomId:"",pageIndex:0,url:""}},computed:{projectSelected:function(){return this.$store.state.global.currentReportProject}},activated:function(){var t=this;if(!this.$router.isBack){this.projId=this.projectSelected.id;var e=this.$route.query.id;this.title=this.$route.query.title,this.roomId=this.$route.query.roomId,this.getTestData(e).then((function(){return t.loadDiagram(t.roomId)})).then((function(e){console.log(e),t.url=e}))}},methods:{getTestData:function(e){var i=this;return this.list=[],this.isLoading=!0,this.errorType="report",p.a.request("/report/close-water-test-detail",{id:e}).then((function(e){t.each(e,(function(t){t.accept_image_file=JSON.parse(t.accept_image_file),t.point_values=JSON.parse(t.point_values||"[]"),t.accept_point_values=JSON.parse(t.accept_point_values||"[]"),t.image_file=JSON.parse(t.image_file),t.timeCost=t.accept_date?u.a.calcTime(t.regist_date,t.accept_date):""})),i.list=e,i.pageIndex=e.length-1})).catch((function(t){i.list=[],i.errorType="error",a.a.alert(t)})).finally((function(){i.isLoading=!1}))},loadDiagram:function(t){return f.default.getRoomTypeDiagram(t).then((function(t){return t.url}))},pointImageAccept:function(t,e){var i=this.url;return d.a.open({url:t.roomtype_diagram_url||i,images:t[e+"image_file"],points:t[e+"point_values"],mode:"view",callback:function(i){t[e+"image_file"]=i.images,t[e+"point_values"]=i.points}})}}}}).call(this,i("391c"))},1304:function(t,e,i){"use strict";var a=i("c5a7");e.__esModule=!0,e.SlotsMixin=void 0;var n=a(i("329b")).default.extend({methods:{slots:function(t,e){void 0===t&&(t="default");var i=this.$slots,a=this.$scopedSlots[t];return a?a(e):i[t]}}});e.SlotsMixin=n},"195a":function(t,e,i){"use strict";i.r(e);var a=i("1011").a,n=(i("0d9c"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("page-content",{attrs:{title:t.title,"show-go-root":"Report"}},[!t.isLoading&&t.list.length?i("swipe-tabs",{staticStyle:{overflow:"hidden"},attrs:{"mark-type":"point","show-tabs":t.list.length>1},model:{value:t.pageIndex,callback:function(e){t.pageIndex=e},expression:"pageIndex"}},t._l(t.list,(function(e,a){return i("swipe-tab",{key:a,attrs:{title:"第"+(a+1)+"次"}},[i("scroller",[i("problem-detail-header",{staticStyle:{"background-color":"#ffffff"},attrs:{status:e.status}}),i("div",{},[(e.roomtype_diagram_url||t.url)&&e.point_values&&e.point_values.length?[i("van-cell",{attrs:{"is-link":"","value-class":"color-gray1",title:"放水点位",value:e.point_values.length+"个"},on:{click:function(i){t.pointImageAccept(e,"")}}})]:t._e(),i("item",{attrs:{label:"放水照片"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[i("item-img-list",{attrs:{editabled:!1},model:{value:e.image_file,callback:function(i){t.$set(e,"image_file",i)},expression:"detail.image_file"}})],1)]),i("item",{directives:[{name:"show",rawName:"v-show",value:e.remark,expression:"detail.remark"}],attrs:{label:"备注",text:e.remark}}),i("user-select",{attrs:{title:"检查人",mode:"view",date:t._f("formatDate")(e.regist_date),editabled:!1},model:{value:e.regist_by,callback:function(i){t.$set(e,"regist_by",i)},expression:"detail.regist_by"}}),"已放水待验收"===e.status?i("user-select",{staticClass:"mt10",attrs:{title:"验收人",mode:"view",editabled:!1},model:{value:e.acceptor,callback:function(i){t.$set(e,"acceptor",i)},expression:"detail.acceptor"}}):t._e(),"合格"===e.status||"不合格"===e.status?[i("div",{staticClass:"mt10"}),(e.roomtype_diagram_url||t.url)&&e.accept_point_values&&e.accept_point_values.length?[i("van-cell",{attrs:{"is-link":"","value-class":"color-gray1",title:"验收点位",value:e.accept_point_values.length+"个"},on:{click:function(i){t.pointImageAccept(e,"accept_")}}})]:t._e(),i("item",{attrs:{label:"验收照片"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[i("item-img-list",{attrs:{editabled:!1},model:{value:e.accept_image_file,callback:function(i){t.$set(e,"accept_image_file",i)},expression:"detail.accept_image_file"}})],1)]),e.accept_remark?i("item",{attrs:{label:"备注",text:e.accept_remark}}):t._e(),i("item",{attrs:{label:"责任单位",text:e.contractor||"无"}}),i("user-select",{attrs:{title:"验收人",mode:"view",date:t._f("formatDate")(e.accept_date),editabled:!1},model:{value:e.acceptor,callback:function(i){t.$set(e,"acceptor",i)},expression:"detail.acceptor"}}),i("item",{staticClass:"item-time-cost",attrs:{label:" ",text:"放水后"+e.timeCost}}),e.cc.length?i("user-select",{attrs:{title:"抄送人",mode:"view",multi:!0,editabled:!1},model:{value:e.cc,callback:function(i){t.$set(e,"cc",i)},expression:"detail.cc"}}):t._e()]:t._e()],2)],1)],1)}))):t._e(),i("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.list.length,type:t.errorType,"empty-text":"report"===t.errorType?"没有报表数据":""}})],1)}),[],!1,null,"65662c88",null);e.default=s.exports},"1f63":function(t,e,i){"use strict";i("7434")},2064:function(t,e,i){"use strict";e.__esModule=!0,e.addUnit=function(t){if(!(0,a.isDef)(t))return;return t=String(t),(0,n.isNumber)(t)?t+"px":t};var a=i("b7b4"),n=i("f24f")},"27c4":function(t,e,i){var a=i("db6b2");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("42e360af",a,!0,{sourceMap:!1,shadowMode:!1})},2814:function(t,e,i){var a=i("5033");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("9db19832",a,!0,{sourceMap:!1,shadowMode:!1})},3050:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;e.default={name:"姓名",tel:"电话",save:"保存",confirm:"确认",cancel:"取消",delete:"删除",complete:"完成",loading:"加载中...",telEmpty:"请填写电话",nameEmpty:"请填写姓名",confirmDelete:"确定要删除么",telInvalid:"请填写正确的电话",vanContactCard:{addText:"添加联系人"},vanContactList:{addText:"新建联系人"},vanPagination:{prev:"上一页",next:"下一页"},vanPullRefresh:{pulling:"下拉即可刷新...",loosing:"释放即可刷新..."},vanSubmitBar:{label:"合计："},vanCoupon:{valid:"有效期",unlimited:"无使用门槛",discount:function(t){return t+"折"},condition:function(t){return"满"+t+"元可用"}},vanCouponCell:{title:"优惠券",tips:"使用优惠",count:function(t){return t+"张可用"}},vanCouponList:{empty:"暂无优惠券",exchange:"兑换",close:"不使用优惠",enable:"可使用优惠券",disabled:"不可使用优惠券",placeholder:"请输入优惠码"},vanAddressEdit:{area:"地区",postal:"邮政编码",areaEmpty:"请选择地区",addressEmpty:"请填写详细地址",postalEmpty:"邮政编码格式不正确",defaultAddress:"设为默认收货地址",telPlaceholder:"收货人手机号",namePlaceholder:"收货人姓名",areaPlaceholder:"选择省 / 市 / 区"},vanAddressEditDetail:{label:"详细地址",placeholder:"街道门牌、楼层房间号等信息"},vanAddressList:{add:"新增地址"}}},"38a9":function(t,e,i){var a=i("6e3b");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("5a624970",a,!0,{sourceMap:!1,shadowMode:!1})},"43a7":function(t,e,i){"use strict";i("38a9")},4412:function(t,e,i){"use strict";e.__esModule=!0,e.createBEM=function(t){return function(e,i){return e&&"string"!=typeof e&&(i=e,e=""),e=a(t,e,"__"),i?[e,n(e,i)]:e}};function a(t,e,i){return e?t+i+e:t}function n(t,e){if("string"==typeof e)return a(t,e,"--");if(Array.isArray(e))return e.map((function(e){return n(t,e)}));var i={};return e&&Object.keys(e).forEach((function(a){i[t+"--"+a]=e[a]})),i}},"4d1b":function(t,e,i){"use strict";var a=i("c5a7");e.__esModule=!0,e.default=void 0;var n=a(i("329b")),s=i("53a5"),o=a(i("3050")),r=n.default.prototype,c=n.default.util.defineReactive;c(r,"$vantLang","zh-CN"),c(r,"$vantMessages",{"zh-CN":o.default});var l={messages:function(){return r.$vantMessages[r.$vantLang]},use:function(t,e){var i;r.$vantLang=t,this.add(((i={})[t]=e,i))},add:function(t){void 0===t&&(t={}),(0,s.deepAssign)(r.$vantMessages,t)}};e.default=l},5033:function(t,e,i){var a=i("5454");(t.exports=i("690e")(!1)).push([t.i,".zjapp .drawing-con[data-v-fba5990a]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;font-size:0;line-height:0}.zjapp .drawing-con canvas[data-v-fba5990a]{display:block;height:100%;width:100%;background:url("+a(i("eb66"))+") #fff;background-size:4px 4px}.zjapp .loading-text[data-v-fba5990a]{margin-top:15px;color:#aaa}.zjapp .error-text[data-v-fba5990a],.zjapp .loading-text[data-v-fba5990a]{padding:0 15px;line-height:20px;text-align:center;font-size:16px}.zjapp .error-text[data-v-fba5990a]{color:#ff3d3d}",""])},"53a5":function(t,e,i){"use strict";e.__esModule=!0,e.deepAssign=s;var a=i("b7b4"),n=Object.prototype.hasOwnProperty;function s(t,e){return Object.keys(e).forEach((function(i){!function(t,e,i){var o=e[i];(0,a.isDef)(o)&&(n.call(t,i)&&(0,a.isObj)(o)&&"function"!=typeof o?t[i]=s(Object(t[i]),e[i]):t[i]=o)}(t,e,i)})),t}},"5bbb":function(t,e,i){"use strict";(function(t){var a=i("3e83");i("2b45");function n(e){switch(function(t){if(null===t)return"null";var e=Object.prototype.toString.call(t);return e.substring(8,e.length-1).toLocaleLowerCase()}(e)){case"object":return function(t){if(function(t){if("object"!==Object(a.a)(t)||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}(t)){var e=new t.constructor;for(var i in t)e[i]=n(t[i]);return e}return t}(e);case"array":return function(t){for(var e=new t.constructor(t.length),i=0;i<t.length;i++)e[i]=n(t[i]);return e}(e);default:return t.clone(e)}}e.a=n}).call(this,i("391c"))},6147:function(t,e,i){"use strict";e.__esModule=!0,e.createNamespace=function(t){return t="van-"+t,[(0,n.createComponent)(t),(0,a.createBEM)(t),(0,s.createI18N)(t)]};var a=i("4412"),n=i("7e06"),s=i("65af")},"65af":function(t,e,i){"use strict";var a=i("c5a7");e.__esModule=!0,e.createI18N=function(t){var e=(0,s.camelize)(t)+".";return function(t){for(var i=(0,n.get)(o.default.messages(),e+t)||(0,n.get)(o.default.messages(),t),a=arguments.length,s=new Array(a>1?a-1:0),r=1;r<a;r++)s[r-1]=arguments[r];return"function"==typeof i?i.apply(void 0,s):i}};var n=i("b7b4"),s=i("a1aa"),o=a(i("4d1b"))},6718:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));i("163d"),i("cc57");var a=i("b7b4"),n={name:"SwipeTab",props:{title:{type:String}},data:function(){return{offset:0,style:{},bem:Object(a.createNamespace)("swipe-item")[1](),parent:{}}},computed:{index:function(){return this.parent.tabs.indexOf(this)}},beforeCreate:function(){this.$parent.swipes.push(this)},created:function(){this.findParent("SwipeTabs")},destroyed:function(){this.$parent.swipes.splice(this.$parent.swipes.indexOf(this),1)},mounted:function(){var t=this,e=this.parent.tabs,i=this.parent.$slots.default.indexOf(this.$vnode);e.splice(-1===i?e.length:i,0,this),this.$nextTick((function(){var e=t.$parent,i=e.vertical,a=e.computedWidth,n=e.computedHeight;t.style={width:a+"px",height:i?a+"px":n+"px",transform:"translate".concat(i?"Y":"X","(").concat(t.offset,"px)")}}))},methods:{findParent:function(t){for(var e=this.$parent;e;){if(e.$options.name===t){this.parent=e;break}e=e.$parent}}}},s=i("17cc"),o=Object(s.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("div",this._g({class:this.bem,style:this.style},this.$listeners),[this._t("default")],2)}),[],!1,null,null,null).exports,r={name:"SwipeTabs",model:{prop:"tabIndex",event:"change"},props:{tabIndex:{type:Number,default:0},markType:{type:String,default:"line"},showTabs:{type:Boolean,default:!0},touchable:{type:Boolean,default:!0}},data:function(){return{curIndex:0,initIndex:0,tabs:[],tabScrollVersion:null}},computed:{tabsPadding:function(){return Math.max(24-4*this.tabs.length,0)},markLeft:function(){var t=(100-2*this.tabsPadding)/this.tabs.length;return this.tabsPadding+(this.curIndex+.5)*t}},watch:{tabIndex:function(t){t!==this.curIndex&&(this.curIndex=t,this.$refs.swipe.swipeTo(t,{immediate:!0}))},curIndex:function(){this.scrollTabsTocurrent()}},created:function(){this.initIndex=this.tabIndex,this.curIndex=this.tabIndex},activated:function(){this.initIndex=this.tabIndex,this.curIndex=this.tabIndex},mounted:function(){this.$nextTick(this.scrollTabsTocurrent)},methods:{changeIndex:function(t){this.$refs.swipe.swipeTo(t)},onChange:function(t){this.curIndex=t,this.$emit("change",t)},scrollTabsTocurrent:function(){var t=this.$refs["tabs-scroll"],e=this.$refs["tab-point"]?this.$refs["tab-point"][this.curIndex]:null;if(t&&e){var i=t.getBoundingClientRect(),a=e.getBoundingClientRect(),n=a.left-i.left,s=i.right-a.right;n<0&&this.tabScrollBy(n),s<0&&this.tabScrollBy(-s)}},tabScrollBy:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=this.$refs["tabs-scroll"];if(a){var n=a.scrollLeft,s=n+t,o=Math.round(i/16.7),r=t/o,c=n,l=this.tabScrollVersion=+new Date;return n===s?Promise.resolve():new Promise((function(t){!function i(){window.requestAnimationFrame((function(){l===e.tabScrollVersion&&(c+=r,a.scrollLeft=c,n<s&&c<s||n>s&&c>s?i():(a.scrollTop=s,t()))}))}()}))}}}},c=(i("bcf4"),Object(s.a)(r,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"swipe-tabs"},[t.showTabs?["line"===t.markType?i("div",{staticClass:"tabs border-bottom",style:{padding:"0 "+Math.max(24-4*t.tabs.length,0)+"%"}},[t._l(t.tabs,(function(e){return i("div",{key:e.index,staticClass:"tab",class:{"tab-current":e.index===t.curIndex},on:{click:function(i){t.changeIndex(e.index)}}},[t._v("\n        "+t._s(e.title)+"\n      ")])})),i("div",{staticClass:"mark-line",style:{left:t.markLeft+"%"}})],2):t._e(),"point"===t.markType?i("div",{staticClass:"tabs-point border-bottom"},[i("div",{ref:"tabs-scroll",staticClass:"tabs-scroll"},t._l(t.tabs,(function(e){return i("div",{key:e.index,ref:"tab-point",refInFor:!0,staticClass:"tab-point",class:{"tab-current":e.index===t.curIndex},on:{click:function(i){t.changeIndex(e.index)}}},[t._v("\n          "+t._s(e.title)+"\n        ")])})))]):t._e()]:t._e(),t._t("fixed"),i("van-swipe",{ref:"swipe",attrs:{"initial-swipe":t.initIndex,"show-indicators":!1,duration:250,loop:!1,touchable:t.touchable},on:{change:t.onChange}},[t._t("default")],2)],2)}),[],!1,null,"025feb99",null));e.b=c.exports},"6e3b":function(t,e,i){var a=i("5454");(t.exports=i("690e")(!1)).push([t.i,".zjapp .peocess-accept-point-image-detail[data-v-bf62585e]{position:absolute;top:0;left:0;height:100px;width:100%;display:flex;align-items:center;background-color:rgba(0,0,0,.8)}.zjapp .peocess-accept-point-image-remove[data-v-bf62585e]{flex-shrink:0;width:40px;height:40px;background:url("+a(i("ec2c"))+") no-repeat 50%;background-size:32px 32px}.zjapp .peocess-accept-point-image-save[data-v-bf62585e]{flex-shrink:0;width:40px;height:40px;background:url("+a(i("be38"))+") no-repeat 50%;background-size:32px 32px}.zjapp .peocess-accept-point-center[data-v-bf62585e]{padding:0 10px;height:100%;flex:1;overflow:auto}.zjapp .back-button[data-v-bf62585e]{height:44px;top:0;right:0;padding:11px 12px 11px 15px;border:none;background:none;font-size:16px;line-height:22px;color:#000}.zjapp .item-img-list-point[data-v-bf62585e] .item-img-list{display:inline}.zjapp .tips[data-v-bf62585e]{line-height:27px;padding-left:15px;font-size:12px;color:#999}.zjapp .tips i[data-v-bf62585e]{font-size:12px;margin-right:2px}",""])},7434:function(t,e,i){var a=i("0cb6");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("f6a1180a",a,!0,{sourceMap:!1,shadowMode:!1})},"7e06":function(t,e,i){"use strict";var a=i("c5a7");e.__esModule=!0,e.unifySlots=r,e.createComponent=function(t){return function(e){var i;return"function"==typeof e&&(e={functional:!0,props:(i=e).props,model:i.model,render:function(t,e){return i(t,e.props,r(e),e)}}),e.functional||(e.mixins=e.mixins||[],e.mixins.push(s.SlotsMixin)),e.name=t,e.install=o,e}},i("4d1b");var n=i("a1aa"),s=i("1304");a(i("329b"));function o(t){var e=this.name;t.component(e,this),t.component((0,n.camelize)("-"+e),this)}function r(t){var e=t.scopedSlots||t.data.scopedSlots||{},i=t.slots();return Object.keys(i).forEach((function(t){e[t]||(e[t]=function(){return i[t]})})),e}},a1aa:function(t,e,i){"use strict";e.__esModule=!0,e.camelize=function(t){return t.replace(a,(function(t,e){return e.toUpperCase()}))},e.padZero=function(t,e){void 0===e&&(e=2);var i=t+"";for(;i.length<e;)i="0"+i;return i};var a=/-(\w)/g},b7b4:function(t,e,i){"use strict";var a=i("c5a7");e.__esModule=!0,e.noop=function(){},e.isDef=c,e.isObj=function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)},e.get=function(t,e){var i=e.split("."),a=t;return i.forEach((function(t){a=c(a[t])?a[t]:""})),a},e.isServer=e.addUnit=e.createNamespace=void 0;var n=a(i("329b")),s=i("6147");e.createNamespace=s.createNamespace;var o=i("2064");e.addUnit=o.addUnit;var r=n.default.prototype.$isServer;function c(t){return null!=t}e.isServer=r},bbe1:function(t,e,i){var a=i("cf0e");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("7962b580",a,!0,{sourceMap:!1,shadowMode:!1})},bcf4:function(t,e,i){"use strict";i("27c4")},be38:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAaVBMVEUAAAAAAAAAAAAAAAAAAAAJoFMKtV4CHQ8AAAAAAAAIhUUAAAAAAAAAAAAAAAAAAAAAAAAAAAALvmIEOx4AAAAAAAAAAAAAAAAAAAAAAAAKplUKrVoFXjAHdDwHajcMwGMLt14IlE0LxmbmPBzHAAAAInRSTlNmAFNjHsTfbyQGqV9ZTkQ5KBXvfF4/NBgNCMzVjp6V8eS3T8DfkgAAAjRJREFUaN7NmlmaEzEMBv/IBuxe3Uz2ZAbo+x8SEbaZwUnUsvWROkDVqy0JKxFxCtuhp651ru2oH7ZhiisREMj9SMhAo4/lgZh63KBPsSjgB4c7uMGrA4EggoIqkDqI6dLiwI6wCNotChw2WMzmIA/4FgpaLw2MUDKKAnuCGtrfD0xrFLCe7gW8QxHO3w4Eh0JcuBUIqEC4HvAOFXD+WmByqIKb8oH9GpVY77MBQjUoFxhRkfHfgEdV/PvAoUVV2sO7wAaV2bwN7FCd3ZsAoTr0OpBgQHoV6GBA9zcQYEL4EyCYQL8DHkb4X4EBRgw/A9GhjE/fvp5ekMHFSyCV+j/OzBkZ0iXQl/uZIzL0PwKx2H89gMgBX8HPPCOH58BYxf8BWUYOkKEftEK09IP1k6mf9cHUz/qtqZ/1g6mf9b2pn/Vk6gehM/WzvkWW5st8eir3s94hx8vMfH4q9sNdCRznTEHhZ317I8CFQj/rO+Q4z5mCws96QpYmU1D4QeghKKj9rB8gKKj9rN9CUFD7WR8gKKj9rJ8gKWj9rI8QFZR+1q9IVtD56fJsERVUfowc8BAVVH54wdOxKfAjSh6/jd7fy57vjdaPJPyANEq/i9IvVKPyY5B/As/H0zMW462/seYfcetRgvkwxHqcYz6Qsh6pmQ8Frcea1oNZ69Gy+XDcerxvvaCwXrFYL4ms11zWi7r/v2osWpY+yrpXu7B+pJX78qOBRzx7kB9uPPLpif3xTPn5z3csI0atYW/xDAAAAABJRU5ErkJggg=="},c40a:function(t,e,i){"use strict";(function(t){i("cc57"),i("6d57"),i("6f84"),i("163d");var a=i("a32d"),n=i.n(a),s=i("e900"),o=i("3122"),r=i("4ad6"),c=i("3bd5"),l=i("1b7e");function h(t){var e=t.changedTouches.length,i=t.touches.length;return 1===e||2===e||2===i}function d(t){return 1===t.touches.length}e.a={name:"Drawing",props:{url:{type:String},points:{type:Array,default:function(){return[]}},regions:{type:Array,default:function(){return[]}},pointColor:{type:String,default:"#ff4546"},pointRadius:{type:Number,default:7},scaleMax:{type:Number,default:4},clickDelay:{type:Number,default:500},folder:{type:String,default:"house-image"},onlineMode:{type:Boolean,default:!1},contentScroll:{type:Boolean,default:!0}},data:function(){return{isDownloading:!1,error:"",canvas:null,ctx:null,img:null,src:"",width:0,height:0,x:0,y:0,scale:1,defaultScale:1,pixelRatio:1,markPosition:null,markPositionImageData:[],markCoordinates:[],pinchRatio:0,scaleBetween:[],isPinch:!1,clickPoints:[],touchStart:{x:0,y:0,cx:0,cy:0,time:0}}},watch:{url:function(){this.getImage()},points:function(t){this.ctx&&this.draw()},regions:function(t){this.ctx&&this.draw()}},mounted:function(){this.getImage()},destroyed:function(){this.canvas&&(this.canvas.width=0,this.canvas.height=0)},methods:{getImage:function(){var e=this;if(this.isDownloading=!0,this.url){var i=c.a.getUser().user_id,a=n.a.replaceAll(this.url,"\\?x-oss-process=image\\/resize,","@"),s=n.a.strRightBack(a,"/");if(!s)return this.error="户型图地址错误",void(this.isDownloading=!1);this.error="";var h=[r.a.appImagePath()+i+"/"+this.folder+"/"+s,r.a.appImagePath()+i+"/house-image/"+s,r.a.appImagePath()+i+"/drawing/"+s,r.a.appImagePath()+i+"/location-image/"+s,r.a.appImagePath()+i+"/images/"+s,r.a.appDataPath()+i+"/"+this.folder+"/"+s,r.a.appDataPath()+i+"/house-image/"+s,r.a.appDataPath()+i+"/drawing/"+s,r.a.appDataPath()+i+"/location-image/"+s,r.a.appDataPath()+i+"/images/"+s],d=Promise.resolve();return"dev"===APP_ENV||this.onlineMode?d=d.then((function(){return e.url})):t.each(h,(function(t){d=d.then((function(e){return e||r.a.isFileExists(t).then((function(e){if(e)return o.a._fixPath(t)}))}))})),d.then((function(t){if(!t)return l.a.getHasNetwork().then((function(t){return t?o.a.download(e.url,!0,e.folder).then((function(t){e.src=t})):Promise.reject("当前无网络")}));e.src=t})).then((function(){e.src?(e.img=new Image,e.img.onload=function(){e.img.complete?(e.isDownloading=!1,e.$nextTick(e.init)):(e.error="加载图片失败",e.isDownloading=!1)},e.img.onerror=function(){e.error="加载图片失败",e.isDownloading=!1},e.img.src=e.src):(e.error="下载户型图失败",e.isDownloading=!1)})).catch((function(i){e.error=t.isString(i)?i:"下载户型图失败",e.isDownloading=!1}))}this.error="户型图地址错误",this.isDownloading=!1},init:function(){if(this.$refs["drawing-canvas"]){var t=this.$refs.content;this.canvas=this.$refs["drawing-canvas"],this.ctx=this.canvas.getContext("2d"),this.width=t.offsetWidth,this.height=t.offsetHeight,this.pixelRatio=this.getPixelRatio(this.ctx),this.canvas.style.height=this.height+"px",this.canvas.style.width=this.width+"px",this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,!this.ctx.extended&&Object(s.a)(this.ctx),this.bindTouchEvent(),this.calc(),this.draw()}},getPixelRatio:function(t){var e=t.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},calc:function(t){var e=this.width/this.img.width,i=this.img.height*e,a=this.height||i;i>this.height&&(e*=a/i),this.scale=e*this.pixelRatio,this.defaultScale=this.scale,this.scaleBetween=[this.scale,this.scale*this.scaleMax]},winToCanvas:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:t-i.left*(this.canvas.width/(i.width*this.pixelRatio)),y:e-i.top*(this.canvas.height/(i.height*this.pixelRatio))}},isBoundary:function(t){switch(t){case"t":if(0===this.y)return!0;break;case"r":if(this.x<=this.canvas.width-this.img.width*this.scale)return!0;break;case"b":if(this.y<=this.img.height*this.scaleBetween[0]-this.img.height*this.scale)return!0;break;case"l":if(0===this.x)return!0}return!1},bindTouchEvent:function(){this.canvas.addEventListener("touchstart",this.onTouchstart),this.canvas.addEventListener("touchmove",this.onTouchmove),this.canvas.addEventListener("touchend",this.touchMoveAndEndHandler)},unbindTouchEvent:function(){this.canvas.removeEventListener("touchstart",this.onTouchstart),this.canvas.removeEventListener("touchmove",this.onTouchmove),this.canvas.removeEventListener("touchend",this.touchMoveAndEndHandler)},onTouchstart:function(t){if(this.isPinch=!1,d(t)){var e=t.touches[0],i=this.winToCanvas(e.clientX,e.clientY);this.touchStart={x:i.x,y:i.y,cx:e.clientX,cy:e.clientY,time:Date.now()}}else if(h(t)){var a,n=t.touches[0],s=t.touches[1],o=this.winToCanvas(n.clientX,n.clientY),r=this.winToCanvas(s.clientX,s.clientY);a=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)),this.pinchRatio=this.scale/a}},onTouchmove:function(t){if(!1===this.contentScroll&&(t.preventDefault(),t.stopPropagation()),d(t))this.touchStart.cy>t.pageY&&this.isBoundary("b")||this.touchStart.cy<t.pageY&&this.isBoundary("t")||this.touchStart.cx>t.pageX&&this.isBoundary("r")||this.touchStart.cx<t.pageX&&this.isBoundary("l")||t.stopPropagation(),this.touchMoveAndEndHandler(t);else if(h(t)){t.stopPropagation();var e,i,a,n,s,o=t.touches[0],r=t.touches[1],c=this.winToCanvas(o.clientX,o.clientY),l=this.winToCanvas(r.clientX,r.clientY);i=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2)),this.isPinch=!0,(e=this.pinchRatio*i)>this.scaleBetween[0]&&e<this.scaleBetween[1]&&(n={x:((a={x:(c.x+l.x)/2*this.pixelRatio,y:(c.y+l.y)/2*this.pixelRatio}).x-this.x)/(this.img.width*this.scale),y:(a.y-this.y)/(this.img.height*this.scale)},a.newX=this.x+this.img.width*e*n.x,a.newY=this.y+this.img.height*e*n.y,s={x:a.newX-a.x,y:a.newY-a.y},e<this.scale&&this.setRange(this.x-s.x,this.y-s.y,e),e>this.scale&&(this.x=this.x-s.x,this.y=this.y-s.y),e!==this.scale&&(this.scale=e,this.draw()))}},touchMoveAndEndHandler:function(t){var e,i,a=t.type,n={touchmove:t.touches[0],touchend:t.changedTouches[0]}[a],s=this.winToCanvas(n.clientX,n.clientY);e=(s.x-this.touchStart.x)*this.pixelRatio,i=(s.y-this.touchStart.y)*this.pixelRatio,"touchend"===a&&Date.now()-this.touchStart.time<this.clickDelay&&Math.abs(n.clientX-this.touchStart.cx)<6&&Math.abs(n.clientY-this.touchStart.cy)<6?this.clickHandler(t):"touchmove"!==a||this.isPinch||(this.touchStart.x=s.x,this.touchStart.y=s.y,this.setRange(this.x+e,this.y+i,this.scale),this.draw())},isCanClick:function(t){for(var e=!1,i=0;i<this.markPosition.length;i++)if(parseFloat(t.x)>parseFloat(this.markPosition[i].x)&&parseFloat(t.x)<parseFloat(this.markPosition[i].x)+parseFloat(this.markPosition[i].w)&&parseFloat(t.y)>parseFloat(this.markPosition[i].y)&&parseFloat(t.y)<parseFloat(this.markPosition[i].y)+parseFloat(this.markPosition[i].h)){e=!0;break}return e},clickHandler:function(t){var e=t.changedTouches[0];if(this.mark){var i=this.winToCanvas(e.clientX,e.clientY),a={x:(i.x-this.x/this.pixelRatio)/(this.img.width*this.scale/this.pixelRatio),y:(i.y-this.y/this.pixelRatio)/(this.img.height*this.scale/this.pixelRatio)};if(i={x:a.x*this.img.width,y:a.y*this.img.height},this.isCanClick(i)){this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i.x*this.scale/this.pixelRatio+this.x/this.pixelRatio,i.y*this.scale/this.pixelRatio+this.y/this.pixelRatio,this.scale===this.defaultScale?this.pointRadius:this.pointRadius*(1+(this.scale-this.defaultScale)/this.pixelRatio),0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore();var n={x:i.x,y:i.y};this.markCoordinates.push(n),this.points.push(n)}return!1}this.redraw(t,this.winToCanvas(e.clientX,e.clientY))},setRange:function(t,e,i){var a=this.img.width*i,n=this.img.height*i,s=this.canvas.width,o=this.canvas.height,r=this.img.height*this.scaleBetween[0];t=a<s?(s-a)/2:(t=t+a<s?s-a:t)>0?0:t,e=n<o?(o-n)/2:(e=e+n<r?r-n:e)>0?0:e,this.x=t,this.y=e},draw:function(){this.setRange(this.x,this.y,this.scale),this.drawImage(),this.drawPoints(),this.drawRegions()},redraw:function(t,e){this.clickPoints=[],this.drawImage(),this.drawPoints(e),this.drawRegions(e),this.clickCallback(t,this.clickPoints)},clickCallback:function(t,e){var i;e.some((function(t,e){return"points"===t.tag?(i=t,!0):(i=t,!1)}));var a=t.changedTouches[0],n=this.winToCanvas(a.clientX,a.clientY),s=(n.x-this.x/this.pixelRatio)/(this.img.width*this.scale/this.pixelRatio),o=(n.y-this.y/this.pixelRatio)/(this.img.height*this.scale/this.pixelRatio);(n={x:parseFloat((s*this.img.width).toFixed(2)),y:parseFloat((o*this.img.height).toFixed(2))}).y>=0&&n.x>=0&&n.y<=this.img.height&&n.x<=this.img.width&&this.$emit("onclick",{type:i?"point":"",points:this.points,point:i,clickPoint:i,x:n.x,y:n.y,scale:this.scale/this.pixelRatio})},drawImage:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,0,0,this.img.width,this.img.height,this.x,this.y,this.img.width*this.scale,this.img.height*this.scale)},drawPoints:function(t){var e=this;this.points.forEach((function(i,a){e.drawPoint(i.x*e.scale/e.pixelRatio+e.x/e.pixelRatio,i.y*e.scale/e.pixelRatio+e.y/e.pixelRatio,e.pointRadius,a,t,i.color)}))},drawPoint:function(t,e,i,a,n,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.shadowBlur=i/2,this.ctx.shadowColor="black",this.ctx.fillStyle=s||this.pointColor,this.ctx.arc(t,e,i,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.shadowColor="transparent",this.ctx.restore(),i*=2,this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="transparent",this.ctx.fillStyle="transparent",this.ctx.rect(t-i,e-i,2*i,2*i),this.ctx.stroke(),this.ctx.restore(),n&&this.ctx.isPointInPath(n.x*this.pixelRatio,n.y*this.pixelRatio)&&this.clickPoints.push({tag:"points",pos:n,index:a})},drawRegions:function(t){var e=this;this.regions&&this.regions.length&&this.regions.forEach((function(i,a){var n,s,o,r;e.ctx.beginPath(),i.area.forEach((function(t,i){var a=t[0]*e.scale/e.pixelRatio+e.x/e.pixelRatio,c=t[1]*e.scale/e.pixelRatio+e.y/e.pixelRatio;i?e.ctx.lineTo(a,c):e.ctx.moveTo(a,c),n=void 0===n?a:n<a?n:a,s=void 0===s?a:s>a?s:a,o=void 0===o?c:o<c?o:c,r=void 0===r?c:r>c?r:c})),e.ctx.closePath(),e.ctx.fillStyle="rgba(255, 144, 0, 0.4)",e.ctx.fill(),e.ctx.lineWidth=3,e.ctx.strokeStyle="#feda8e",e.ctx.stroke(),e.ctx.lineWidth=2,e.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",e.ctx.stroke(),t&&e.ctx.isPointInPath(t.x*e.pixelRatio,t.y*e.pixelRatio)&&e.clickPoints.push({tag:"region",pos:t,index:a,regionData:i}),e.ctx.font='18px bold -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',e.ctx.textAlign="center",e.ctx.lineWidth=4,e.ctx.strokeStyle="#ffffff",e.ctx.strokeText(i.name,(s+n)/2,(r+o)/2+10),e.ctx.fillStyle="#111111",e.ctx.fillText(i.name,(s+n)/2,(r+o)/2+10)}))}}}}).call(this,i("391c"))},c5a7:function(t,e){t.exports=function(t){return t&&t.__esModule?t:{default:t}}},cf0e:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .item-time-cost[data-v-65662c88]{padding-top:0;margin-top:-4px}.zjapp .item-time-cost[data-v-65662c88] .item-text{padding-top:0;color:#b3b3b3}",""])},da1c:function(t,e,i){"use strict";i("163d");var a=i("65a8"),n={name:"ProblemHeader",props:{status:{type:String,default:""},statusText:{type:String,default:""},level:{type:String,default:""},isTimeout:{type:Boolean,default:!1},sentBackTimes:{type:[Number,String],default:0}},data:function(){return{edOptions:{}}},created:function(){var t=this;a.a.getOptions("紧急程度").then((function(e){t.edOptions=e}))}},s=(i("1f63"),i("17cc")),o=Object(s.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",t._g({staticClass:"problem-detail-header border-bottom"},t.$listeners),[i("div",{staticClass:"status",class:{"待整改":"status-red","不合格":"status-red","已退回":"status-red","待复验":"status-orange","已放水待验收":"status-orange","检查中":"status-orange","待验收":"status-orange","已通过":"status-green","已整改":"status-green","已提交":"status-green","合格":"status-green","检查完毕":"status-green","已验收":"status-green","已关闭":"status-black","进度正常":"status-green","进度滞后":"status-red","验收中":"status-orange","已抽验":"status-green"}[t.status]},[t._v(t._s(t.statusText||t.status))]),"紧急"===t.level||"特急"===t.level?i("span",{staticClass:"urgent"},[t._v(t._s(t.edOptions[t.level]))]):t._e(),t.isTimeout?i("span",{staticClass:"timeout"},[t._v("超时")]):t._e(),t.sentBackTimes>0?i("span",{staticClass:"return"},[t._v("退回"+t._s(t.sentBackTimes)+"次")]):t._e(),t._t("operat")],2)}),[],!1,null,"0901aadd",null);e.a=o.exports},db6b2:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,'.zjapp .swipe-tabs[data-v-025feb99]{display:flex;flex-direction:column;flex:1;overflow:hidden}.zjapp .tabs[data-v-025feb99]{position:relative;display:flex;background-color:#fff}.zjapp .tab[data-v-025feb99]{flex:1;height:40px;line-height:20px;padding:10px;font-size:14px;text-align:center;box-sizing:border-box}.zjapp .tab-current[data-v-025feb99]{color:#4275e8}.zjapp .mark-line[data-v-025feb99]{position:absolute;bottom:0;left:0;width:20px;height:2px;margin-left:-10px;background-image:linear-gradient(90deg,#5ea2ff,#4f83eb 50%,#4275e8);transition:left .4s cubic-bezier(.1,.7,.1,1)}.zjapp .tabs-point[data-v-025feb99]{position:relative;z-index:1;height:40px;font-size:0;text-align:center;background-color:#fff;overflow:visible}.zjapp .tabs-scroll[data-v-025feb99]{position:relative;padding-bottom:3px;margin-bottom:-3px;white-space:nowrap;overflow-x:auto}.zjapp .tabs-scroll[data-v-025feb99]::-webkit-scrollbar{display:none}.zjapp .tab-point[data-v-025feb99]{display:inline-block;padding:10px 15px;line-height:20px;font-size:16px;color:#333;white-space:nowrap}.zjapp .tab-point.tab-current[data-v-025feb99]{position:relative;z-index:3;color:#4275e8}.zjapp .tab-point.tab-current[data-v-025feb99]:after{content:"";position:absolute;z-index:3;bottom:-3px;left:50%;margin-left:-3px;width:7px;height:7px;border-radius:50%;background-color:#4275e8}',""])},e223:function(t,e,i){"use strict";var a=i("c40a").a,n=(i("0aac"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",t._g({ref:"content",staticClass:"drawing-con"},t.$listeners),[t.isDownloading?[i("p",[i("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[i("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]),i("p",{staticClass:"loading-text"},[t._v("正在下载...")])]:[t.error?t._e():i("canvas",{ref:"drawing-canvas"}),t.error?i("p",{staticClass:"error-text"},[t._v(t._s(t.error))]):t._e()]],2)}),[],!1,null,"fba5990a",null);e.a=s.exports},e900:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return n}));i("f548");function a(t){var e,i,a,n=(i=(e=t).backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,(window.devicePixelRatio||1)/i);1!==n&&(!function(t,e){for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)}({fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all"},(function(e,i){var a;t[i]=(a=t[i],function(){var t,i,s=Array.prototype.slice.call(arguments);if("all"===e)s=s.map((function(t){return t*n}));else if(Array.isArray(e))for(t=0,i=e.length;t<i;t++)s[e[t]]*=n;return a.apply(this,s)})})),t.stroke=(a=t.stroke,function(){this.lineWidth*=n,a.apply(this,arguments),this.lineWidth/=n}),t.fillText=function(t){return function(){var e=Array.prototype.slice.call(arguments);e[1]*=n,e[2]*=n,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,e,i){return e*n+i})),t.apply(this,e),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,e,i){return e/n+i}))}}(t.fillText),t.strokeText=function(t){return function(){var e=Array.prototype.slice.call(arguments);e[1]*=n,e[2]*=n,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,e,i){return e*n+i})),t.apply(this,e),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,e,i){return e/n+i}))}}(t.strokeText),t.extended=!0)}var n=function(t){var e,i;(e=t).getContext=(i=e.getContext,function(t){var e,n,s=i.call(this,t);return"2d"===t&&(e=s.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1,(n=(window.devicePixelRatio||1)/e)>1&&(this.style.height=this.height+"px",this.style.width=this.width+"px",this.width*=n,this.height*=n)),a(s),s})}},ec2c:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAS1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD9PEb5O0XkNkCgJixmGR02DQ//PEarKmZqAAAAGHRSTlNmAGNUHl9CJBYGWTkoTlI0DQj79dyjhXVr+MqyAAABv0lEQVRo3rTNB2KDMAwF0B9JHvJg3P+ypelKUgIGrHeBh1sTjWH0lZMjcomrH0PUW5OGQCUzVnAWvR5oqdhQi14KxBN2kJfTQWA04XAqKAnNUjkcRMYhHA8Fs8dhfm4PxOEEJ61Bxkm5KZgGnDZM+0F0uMDFvUAIl5BsB4FwEYWtIKCD8D4QQgck74JI6ILiejA5dOKm1WBAN8NakNFR/h8IupLXYHboys0vgUdn/jmI6C4+BYzu+DEoMFAeggQD6S8IMBF+A4YJ/gkERuQ78DDivwIlGCG9BwVmyj2oMFM/A4UhXQKBIVmCDEN5CRiG+AaFKUWEqYgAUwEjTI3wMOUxwFT9IM5eTgAEgiCINooXwYuf3c0/UiMYWA8PKwFBZWa6Omsoa/ZUtPscU5x3S8WeLQX9GtNcPQVblhQ84wNPChb+AP6K+Ef2v+kRysFHBR92fFzzhcNXpl76/Gzhhxc/HfXxy893HkB0hOIhUMdYHsS1SuAyROscLqS0UuNSUGtNLWa1WuZyXOt9XVDoikWXRLrm0kXd/1XjO4omSwfLdC+5E9aDacqd9EUDg3HZA/ELNwbz0hPaL56hfPkPACoPKZ49CVToAAAAAElFTkSuQmCC"},f24f:function(t,e,i){"use strict";e.__esModule=!0,e.isNumber=function(t){return/^\d+(\.\d+)?$/.test(t)},e.isNaN=function(t){if(Number.isNaN)return Number.isNaN(t);return t!=t}},ff1c:function(t,e,i){"use strict";(function(t){i("5ab2"),i("e10e"),i("6d57"),i("06a2"),i("6491"),i("ed63"),i("8cf2");var a=i("28f8"),n=(i("e697"),i("e204"),i("e68e")),s=i("774b"),o=i("e223"),r=i("48f4"),c=i("3122"),l=i("162a"),h=i("e2a7"),d=i("4ad6"),u=i("fc9f"),p=i("a32d"),f=i.n(p),g=i("fd50"),m=i("5bbb"),x=i("4360"),v=i("7cb8"),b=i("e89f"),A=i("d873");function w(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function y(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?w(Object(i),!0).forEach((function(e){Object(a.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):w(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var k,_,P;e.a={name:"CloseWaterTestPointImageWidget",components:{ItemImgList:n.a,Scroller:s.default,Drawing:o.a},mixins:[b.a],store:x.a,data:function(){return{show:!1,showDetail:!1,imageFiles:[],url:"",points:[],mode:"",isOnlineMode:!1,viewSize:$rootScope.viewSize,callback:function(){}}},methods:{open:function(e){var i=this;this.url=e.url,this.images="view"===e.mode?e.images:Object(m.a)(e.images),this.points="view"===e.mode?e.points:Object(m.a)(e.points),this.mode=e.mode,this.isOnlineMode=e.isOnlineMode||!1,this.callback=e.callback,t.each(this.points,(function(t){t.color="#0bc666","accept"!==i.mode||t.image_ids.length||(t.color="#FF7439")})),k=JSON.stringify(this.getPointAndImages().points),this.show=!0,this.showDetail=!1,this.imageFiles=[]},onClose:function(){this.show=!1},collectImageAndPoint:function(){var e=this,i=t.findIndex(this.points,{color:"#4275e8"}),a=i<0?"":this.points[i];a&&(t.each(this.imageFiles,(function(i){t.some(e.images,{id:i.id})||e.images.push(i)})),a.image_ids=t.map(this.imageFiles,"id"))},getPointAndImages:function(){var e=this,i=[],a=Object(m.a)(this.points);return t.each(a,(function(a){var n=[];t.each(a.image_ids,(function(a){var s=t.find(e.images,{id:a});s&&(i.push(s),n.push(a))})),delete a.color,delete a.index,a.image_ids=n})),{images:i,points:a}},setLightPoint:function(e){var i=this;if(!isNaN(e)){var a=this.points[e];this.points=t.map(this.points,(function(t,a){var n=y({},t);return e===a?n.color="#4275e8":(n.color="#0bc666","accept"!==i.mode||n.image_ids.length||(n.color="#FF7439")),n})),this.imageFiles=t.filter(this.images,(function(e){return!!a&&t.includes(a.image_ids,e.id)})),this.showDetail=!0}},changeViewImage:function(e,i){f.a.startsWith(e.change.imagePath,"file://")&&(e.change.imagePath=e.change.imagePath.substr(7));t.each(_,(function(t){if(t.temp===e.change.imagePath||t.local===e.change.imagePath||t.thumbnail===e.change.imagePath||t.url===e.change.imagePath)return t.key,t.temp=e.change.exchangePath,delete t.local,delete t.thumbnail,delete t.url,g.a.when().then((function(){return d.a.getWaterMark([A.e],1===e.change.changeMode)})).then((function(e){return d.a.addWaterMark(t.temp,e).then((function(){if("dev"===APP_ENV)return c.a.uploadImage(t.temp).then((function(e){delete t.temp,t.url=e,t.thumbnailUrl=e}));t.thumbnailUrl=t.temp}))})).then((function(){var t={image_file:Object(v.o)(_)};return u.a.update("closed_water_test_detail",t,{id:i.point_id}).then((function(){r.default.addSyncGroup([["closed_water_test_detail",i.point_id,"id"]])}))})),!1}))},onDrawingClick:function(e){var i,a=this,n=this.$store.state.global.allowSelectPictureFromAlbums["closed-water-test"];if(console.log("data",e),"point"===e.type)if("edit"===this.mode)this.imageFiles&&this.imageFiles.length?this.savePoint():this.removePoint(),this.setLightPoint(e.point.index);else if("accept"===this.mode)this.imageFiles&&this.imageFiles.length&&this.savePoint(),this.setLightPoint(e.point.index);else{var s={toolBar:{isShow:!0,isShowChange:!1}};n||(s.toolBar.changeOption=[1]);var o=this.points[e.point.index];if(this.points=t.map(this.points,(function(t,i){var a=y({},t);return e.point.index===i?a.color="#4275e8":a.color="#0bc666",a})),_=this.imageFiles=t.filter(this.images,(function(e){return!!o&&t.includes(o.image_ids,e.id)})),!this.isOnlineMode&&t.find(this.imageFiles,(function(t){return c.a.isNeedDownloadImage([t])})))return h.a.loading("正在下载图片..."),l.a.canUpdate(!0).then((function(){var i=t.filter(a.imageFiles,(function(t){return c.a.isNeedDownloadImage([t])}));return g.a.when().then((function(){return i.length&&console.log("needDownloadModelData==========",i),Promise.all(i.map((function(t){return c.a.download(t.url)}))).then((function(t){i.forEach((function(e,i){return e.local=t[i]}))}))})).then((function(){var t;d.a.openImageBrowser(c.a.convertMediaList(a.imageFiles),0,s).then(null,null,(t=e.point,function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];var s=[].slice.call(i,0);s.push(t),a.changeViewImage(s)}))}))})).catch((function(t){var i;c.a.isNeedThumbnail(_self.itemModel)?h.a.alert(t):d.a.openImageBrowser(c.a.convertMediaList(a.imageFiles),0,s).then(null,null,(i=e.point,function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var s=[].slice.call(e,0);s.push(i),a.changeViewImage(s)})),h.a.hideLoading()})).finally((function(){h.a.hideLoading()}));d.a.openImageBrowser(c.a.convertMediaList(this.imageFiles,this.isOnlineMode),0,s).then(null,null,(i=e.point,function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var s=[].slice.call(e,0);s.push(i),a.changeViewImage(s)}))}else""===e.type&&"edit"===this.mode&&(this.imageFiles&&this.imageFiles.length?this.savePoint():this.removePoint(),this.points.push({x:e.x,y:e.y,image_ids:[]}),this.setLightPoint(this.points.length-1))},removePoint:function(){var e=this;if("accept"!==this.mode){var i=t.findIndex(this.points,{color:"#4275e8"});if(!(i<0))return this.imageFiles&&this.imageFiles.length?h.a.confirm("确定删除该点位及照片？",{okText:"删除"}).then((function(t){t&&(e.points.splice(i,1),e.showDetail=!1,e.imageFiles=[])})):(this.points.splice(i,1),this.showDetail=!1,void(this.imageFiles=[]))}},save:function(){this.imageFiles&&this.imageFiles.length||this.removePoint(),this.savePoint("accept"===this.mode);var t=this.getPointAndImages();this.show=!1,this.callback(t)},savePoint:function(e){var i=this;if(this.url){if(this.showDetail&&(!this.imageFiles||!this.imageFiles.length)&&!e)return h.a.alert("请先拍照");this.collectImageAndPoint(),this.points=t.map(this.points,(function(t,e){var a=y({},t);return a.color="#0bc666","accept"!==i.mode||a.image_ids.length||(a.color="#FF7439"),a})),this.showDetail=!1,this.imageFiles=[]}},close:function(){var t=this;this.collectImageAndPoint();var e=JSON.stringify(this.getPointAndImages().points);if(!P)return k!==e?P=h.a.confirm("是否保存此页内容？",{okText:"保存",cancelText:"不保存"}).then((function(e){e?t.save():t.show=!1})).then((function(){P=null})):void(this.show=!1)}}}}).call(this,i("391c"))}}]);