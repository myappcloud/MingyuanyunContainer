(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-85072b28"],{1304:function(t,e,i){"use strict";var a=i("c5a7");e.__esModule=!0,e.SlotsMixin=void 0;var n=a(i("329b")).default.extend({methods:{slots:function(t,e){void 0===t&&(t="default");var i=this.$slots,a=this.$scopedSlots[t];return a?a(e):i[t]}}});e.SlotsMixin=n},"19a9":function(t,e,i){"use strict";i("7d4e")},2064:function(t,e,i){"use strict";e.__esModule=!0,e.addUnit=function(t){if(!(0,a.isDef)(t))return;return t=String(t),(0,n.isNumber)(t)?t+"px":t};var a=i("b7b4"),n=i("f24f")},"27c4":function(t,e,i){var a=i("db6b2");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("42e360af",a,!0,{sourceMap:!1,shadowMode:!1})},"2d24":function(t,e,i){"use strict";i.r(e);var a=i("5dd1").a,n=(i("7dd9"),i("17cc")),r=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("page-content",{attrs:{title:"飞检&专项","on-close":t.backEvent}},[i("check-guide",{attrs:{slot:"header-bar-right",module:"fly-inspect","section-id":t.defaultBatch.template_id,"before-open":t.beforeCheckGuideOpen},slot:"header-bar-right"}),i("item",{staticClass:"bg-sub-theme",attrs:{border:"bottom","icon-right":t.batchArrow?"arrow-right":""},on:{click:t.batchClick}},[i("div",{staticClass:"item-text"},[t._v(t._s(t.batchText))]),i("div",{staticClass:"item-font color-gray"},[t._v(t._s(t.batchTips))])]),i("swipe-tabs",{model:{value:t.tabIndex,callback:function(e){t.tabIndex=e},expression:"tabIndex"}},[i("swipe-tab",{attrs:{title:"草稿"}},[i("synchronize-tip-bar",{attrs:{"automatic-update-callback":t.init,"use-download":!1}}),i("scroller",{attrs:{"has-next":t.draftLimit<t.draftData.length,"is-empty":!t.draftData.length,"end-text":""},on:{pullDown:t.init,loadNext:t.pageDraft}},[t._l(t.draftDataShow,(function(e,a){return i("item-list",{key:a,attrs:{img:e.thumbnail,title:e.item_full_name||"未选检查项",detail:(e.desc_name?e.desc_name+" ":"")+(e.remark||""),footer:e.regist_date+" "+(e.place||"")},on:{click:function(i){t.problemEdit(e)}}})})),i("loading-status",{attrs:{"is-loading":t.isDraftLoading,"is-empty":!t.draftData.length,"empty-text":"请登记问题"}})],2)],1),i("swipe-tab",{attrs:{title:"已提交"}},[i("synchronize-tip-bar",{attrs:{"use-download":!1}}),i("scroller",{attrs:{"has-next":t.submittedLimit<t.submittedData.length,"is-empty":!t.submittedData.length},on:{pullDown:t.init,loadNext:t.pageSubmit}},[t._l(t.submittedDataShow,(function(e,a){return i("item-list",{key:a,attrs:{"is-unread":e.unread,"is-timeout":e.is_timeout,"is-urgent":"紧急"==e.emergency_degree||"特急"==e.emergency_degree,"is-return":e.sent_back_times>0,img:e.thumbnail,title:e.item_full_name||"未选检查项",detail:(e.desc_name?e.desc_name+" ":"")+(e.remark||""),footer:e.regist_date+" "+(e.place||""),status:e.status,"status-text":e.status_text},on:{click:function(i){t.problemDetail(e)}}})})),i("loading-status",{attrs:{"is-loading":t.isSubmitLoading,"is-empty":!t.submittedData||!t.submittedData.length,"empty-text":"这里暂无数据"}})],2)],1)],1),i("app-button-group",{attrs:{"fixed-bottom":""}},[i("app-button",{on:{click:function(e){t.problemAdd()}}},[i("van-icon",{attrs:{name:"plus"}}),t._v("\n      登记问题\n    ")],1)],1)],1)}),[],!1,null,"dd812256",null);e.default=r.exports},"2d6e":function(t,e,i){var a=i("7eb2");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("53a2fbaa",a,!0,{sourceMap:!1,shadowMode:!1})},3050:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;e.default={name:"姓名",tel:"电话",save:"保存",confirm:"确认",cancel:"取消",delete:"删除",complete:"完成",loading:"加载中...",telEmpty:"请填写电话",nameEmpty:"请填写姓名",confirmDelete:"确定要删除么",telInvalid:"请填写正确的电话",vanContactCard:{addText:"添加联系人"},vanContactList:{addText:"新建联系人"},vanPagination:{prev:"上一页",next:"下一页"},vanPullRefresh:{pulling:"下拉即可刷新...",loosing:"释放即可刷新..."},vanSubmitBar:{label:"合计："},vanCoupon:{valid:"有效期",unlimited:"无使用门槛",discount:function(t){return t+"折"},condition:function(t){return"满"+t+"元可用"}},vanCouponCell:{title:"优惠券",tips:"使用优惠",count:function(t){return t+"张可用"}},vanCouponList:{empty:"暂无优惠券",exchange:"兑换",close:"不使用优惠",enable:"可使用优惠券",disabled:"不可使用优惠券",placeholder:"请输入优惠码"},vanAddressEdit:{area:"地区",postal:"邮政编码",areaEmpty:"请选择地区",addressEmpty:"请填写详细地址",postalEmpty:"邮政编码格式不正确",defaultAddress:"设为默认收货地址",telPlaceholder:"收货人手机号",namePlaceholder:"收货人姓名",areaPlaceholder:"选择省 / 市 / 区"},vanAddressEditDetail:{label:"详细地址",placeholder:"街道门牌、楼层房间号等信息"},vanAddressList:{add:"新增地址"}}},4412:function(t,e,i){"use strict";e.__esModule=!0,e.createBEM=function(t){return function(e,i){return e&&"string"!=typeof e&&(i=e,e=""),e=a(t,e,"__"),i?[e,n(e,i)]:e}};function a(t,e,i){return e?t+i+e:t}function n(t,e){if("string"==typeof e)return a(t,e,"--");if(Array.isArray(e))return e.map((function(e){return n(t,e)}));var i={};return e&&Object.keys(e).forEach((function(a){i[t+"--"+a]=e[a]})),i}},"4aef":function(t,e,i){"use strict";var a=i("dd16").a,n=i("17cc"),r=Object(n.a)(a,(function(){var t=this.$createElement;return(this._self._c||t)("span",{class:this.classSet[this.status]},[this._v(this._s(this.text||this.status))])}),[],!1,null,null,null);e.a=r.exports},"4d1b":function(t,e,i){"use strict";var a=i("c5a7");e.__esModule=!0,e.default=void 0;var n=a(i("329b")),r=i("53a5"),o=a(i("3050")),c=n.default.prototype,s=n.default.util.defineReactive;s(c,"$vantLang","zh-CN"),s(c,"$vantMessages",{"zh-CN":o.default});var u={messages:function(){return c.$vantMessages[c.$vantLang]},use:function(t,e){var i;c.$vantLang=t,this.add(((i={})[t]=e,i))},add:function(t){void 0===t&&(t={}),(0,r.deepAssign)(c.$vantMessages,t)}};e.default=u},"53a5":function(t,e,i){"use strict";e.__esModule=!0,e.deepAssign=r;var a=i("b7b4"),n=Object.prototype.hasOwnProperty;function r(t,e){return Object.keys(e).forEach((function(i){!function(t,e,i){var o=e[i];(0,a.isDef)(o)&&(n.call(t,i)&&(0,a.isObj)(o)&&"function"!=typeof o?t[i]=r(Object(t[i]),e[i]):t[i]=o)}(t,e,i)})),t}},"5dd1":function(t,e,i){"use strict";(function(t){i("f548"),i("cc57");var a=i("fd50"),n=i("f369"),r=i("774b"),o=i("fa4f"),c=i("3bd5"),s=i("3516"),u=i("6144"),d=i("d3aa"),l=i("3122"),p=i("48f4"),f=i("07d2"),h=i("6bf2"),b=i.n(h),g=i("a500"),m=i("f7ab"),_=i("e2a7"),y=i("6718"),v=i("a18c");e.a={name:"FlyInspectIndex",components:{CheckGuide:n.a,Scroller:r.default,ItemList:o.a,Item:f.default,SynchronizeTipBar:m.a,SwipeTabs:y.b,SwipeTab:y.a},data:function(){return{isLoadingBatch:!0,defaultBatch:{},hasNewBatchRights:!1,tabIndex:0,draftLimit:10,draftData:[],isDraftLoading:!1,submittedLimit:10,submittedData:[],isSubmitLoading:!1}},computed:{tabsWidth:function(){return window.innerWidth/2},draftDataShow:function(){return this.draftData&&this.draftData.length?this.draftData.slice(0,this.draftLimit):[]},submittedDataShow:function(){return this.submittedData&&this.submittedData.length?this.submittedData.slice(0,this.submittedLimit):[]},batchText:function(){return this.isLoadingBatch?"正在加载检批次...":this.defaultBatch&&this.defaultBatch.id?this.defaultBatch.is_closed?"上次使用的批次已关闭":this.defaultBatch.name:this.hasNewBatchRights?"请新建一个检查批次":"暂无与你相关的检查批次"},batchTips:function(){return this.isLoadingBatch?"":this.defaultBatch&&this.defaultBatch.id&&!this.defaultBatch.is_closed?"切换批次":""},batchArrow:function(){return!this.isLoadingBatch&&(!(!this.defaultBatch||!this.defaultBatch.id)||this.hasNewBatchRights)}},activated:function(){window.flyinpestTest=this;var t=u.a.getString("fly-inspect-index-tab-index");t&&(this.tabIndex=parseInt(t),u.a.remove("fly-inspect-index-tab-index")),this.init()},methods:{backEvent:function(){window.__YL_SUPER_APP__?v.a.back():this.$router.replace("/layout/workbench",!0)},onRefresh:function(t){this.init().then((function(){"function"==typeof t&&t(!1)}))},beforeCheckGuideOpen:function(){if(!this.defaultBatch||!this.defaultBatch.id)return _.a.alert("请先选择批次"),!1},batchClick:function(){this.isLoadingBatch||(this.defaultBatch&&this.defaultBatch.id?(g.a.addTrack("飞检&专项-首页-进入批次列表"),this.$router.push("/fly-inspect-batch-list")):this.hasNewBatchRights&&this.$router.push("/fly-inspect-batch-add"))},problemAdd:function(t){this.defaultBatch.id&&!this.defaultBatch.is_closed?this.$router.push({name:"FlyInspectEdit"}):_.a.alert("请先选择检查批次")},problemEdit:function(t){this.$router.push({name:"FlyInspectEdit",params:{id:t.id}})},problemDetail:function(t){this.$router.push({name:"FlyInspectDetail",params:{id:t.id}})},init:function(){var t=this;return this.getDetaulBatch().then((function(){return t.getDraftData()})).then((function(){return t.getSubmittedData()}))},getDetaulBatch:function(){var t=this,e=c.a.getUser(),i=this.$store.state.global.currentProject;return this.isLoadingBatch=!0,s.a.checkUserBatchRights(e.user_id).then((function(e){t.hasNewBatchRights=!!e})).then((function(){return s.a.getDefaultBatch("飞检&专项",i.id).then((function(e){e?t.defaultBatch=e:(t.defaultBatch={},t.draftData=[],t.submittedData=[])}))})).finally((function(){t.isLoadingBatch=!1}))},getDraftData:function(){var e=this;return this.isDraftLoading=!0,this.defaultBatch.is_closed?(this.draftData=[],this.isDraftLoading=!1,a.a.when()):d.a.getCheckProblemDraftList(this.defaultBatch.id).then((function(i){t.each(i,(function(t){t.thumbnail=l.a.getDefaultThumbnailFromList(t.image_file,"飞检&专项"),t.regist_date=b()(t.created_on).format("MM-DD HH:mm")})),e.draftData=i,e.isDraftLoading=!1}))},getSubmittedData:function(){var e=this;return this.isSubmitLoading=!0,this.defaultBatch.is_closed?(this.submittedData=[],this.isSubmitLoading=!1,a.a.when()):d.a.getCheckProblemList(this.defaultBatch.id).then((function(i){var a=t.filter(i.data,(function(t){var e=JSON.parse(t.image_file||"[]");return t.thumbnail=l.a.getDefaultThumbnailFromList(e,"飞检&专项"),t.regist_date=b()(t.regist_date).format("MM-DD HH:mm"),l.a.isNeedThumbnail(e)}));p.default.autoLoadThumbnail(a,"飞检&专项","image_file","thumbnail","checkquality_problem"),e.submittedData=i.data,e.isSubmitLoading=!1}))},pageDraft:function(){this.draftLimit=this.draftLimit+10},pageSubmit:function(){this.submittedLimit=this.submittedLimit+10}}}}).call(this,i("391c"))},6147:function(t,e,i){"use strict";e.__esModule=!0,e.createNamespace=function(t){return t="van-"+t,[(0,n.createComponent)(t),(0,a.createBEM)(t),(0,r.createI18N)(t)]};var a=i("4412"),n=i("7e06"),r=i("65af")},"65af":function(t,e,i){"use strict";var a=i("c5a7");e.__esModule=!0,e.createI18N=function(t){var e=(0,r.camelize)(t)+".";return function(t){for(var i=(0,n.get)(o.default.messages(),e+t)||(0,n.get)(o.default.messages(),t),a=arguments.length,r=new Array(a>1?a-1:0),c=1;c<a;c++)r[c-1]=arguments[c];return"function"==typeof i?i.apply(void 0,r):i}};var n=i("b7b4"),r=i("a1aa"),o=a(i("4d1b"))},"65e9":function(t,e,i){"use strict";(function(t){i("5ab2"),i("6d57"),i("e10e");var a=i("28f8"),n=i("4360"),r=i("48f4"),o=i("162a"),c=i("f2d3"),s=i("6906"),u=i("a18c"),d=i("c745");function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){Object(a.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}e.a={name:"SynchronizeTipBar",props:{isTodo:{type:Boolean},useDownload:{type:Boolean,default:!0},enterDoCheck:{type:Boolean,default:!0},buildingId:{type:String,default:""},automaticUpdateCallback:{type:Function,default:null}},data:function(){return{currentModuleCode:"",oneUpdateData:!0}},computed:{projId:function(){return n.a.state.global.currentProject.id},waitUploadNum:function(){return n.a.state.global.waitUploadNum},hasTopProgress:function(){return n.a.state.global.hasTopProgress},hasChanged:function(){if(!this.useDownload)return!1;if(this.currentModuleCode){var t,e=r.default.isModuleNeedBuilding(this.currentModuleCode)&&!this.isTodo;return!(e&&!this.buildingId)&&(t=this.isTodo?n.a.state.global.todoChangedStatus||{}:n.a.state.global.businessChangedStatus||{},e?!!t[this.currentModuleCode]&&t[this.currentModuleCode][this.buildingId]:t[this.currentModuleCode])}return!1},show:function(){return(this.hasChanged||this.waitUploadNum)&&!this.hasTopProgress},oneDataSync:function(){return this.$store.state.app.oneDataSync}},watch:{hasChanged:function(t){var e=this;t&&this.$nextTick((function(){setTimeout((function(){var t=e.$refs["synchronize-tip-bar"];if(t&&t.style){t.style.display="none";t.offsetHeight;t.style.display="block"}}),100)}))},buildingId:function(t){this.currentModuleCode&&r.default.isModuleNeedBuilding(this.currentModuleCode)&&t&&(console.log("楼栋重新加载，是否再次自动加载数据：",this.oneUpdateData),this.oneUpdateData&&this.automaticLogic(),this.checkSync())},show:function(t){t?this.$emit("show"):this.$emit("hide")}},activated:function(){this.init()},methods:{init:function(){this.getCurrentModuleCode(),this.enterDoCheck&&!u.a.isBack&&this.checkSync(),this.automaticLogic()},automaticLogic:function(){var t=this;this.$router.isBack||(this.oneUpdateData=!0,d.a.getAutomaticLoadData().then((function(e){$log.log("是否要自动加载 ===> ",e&&t.oneDataSync&&"function"==typeof t.automaticUpdateCallback),e&&t.oneDataSync&&"function"==typeof t.automaticUpdateCallback&&t.dataSync().then((function(e){console.log("是否需要初始化页面 ====> ",Boolean(e)),e&&t.automaticUpdateCallback()}))})))},getCurrentModuleCode:function(){var t=r.default.getCurrentModuleCode(),e=this.isTodo?"todo":"";this.currentModuleCode=t||e},checkSync:function(){var e=this,i="checkDataUpdate",a=this.currentModuleCode,o=this.buildingId,u=n.a.state.global.isLeader?this.projId:"";return!r.default.isModuleNeedBuilding(a)||o||this.isTodo?(this.isTodo&&(i+="_todo"),a&&(i+="_".concat(a)),o&&(i+="_".concat(o)),s.a.execAfterInterval(120,i).then((function(){return e.isTodo?"todo"===a?c.a.getModuleList().then((function(e){var i=t.map(e,"code");return r.default.hasTodoChangedData("",i)})):r.default.hasTodoChangedData("",[a]):r.default.hasBusinessChangedData(u,[a],o)})).then((function(t){if(e.isTodo){var i=p({},n.a.state.global.todoChangedStatus);i[a]=t,n.a.commit("global/SET_TODO_CHANGED_STATUS",i)}else{var r=p({},n.a.state.global.businessChangedStatus);if(o){var c=r[a]?r[a]:{};c[o]=t,r[a]=c}else r[a]=t;n.a.commit("global/SET_BUSINESS_CHANGED_STATUS",r)}})).catch((function(t){return t&&!0===t.timeNotTo?($log.debug(t.msg),!1):$q.reject(t)}))):Promise.resolve()},dataSync:function(){var t=this.currentModuleCode,e=this.buildingId,i=r.default.isModuleNeedBuilding(t),a=i&&!e;return $log.log(["模块名：",t," 楼栋id：",e," 当前模块是否需要楼栋id：",i," 判断是否终止自动更新：",a]),a?Promise.resolve():(this.oneUpdateData=!1,o.a.beginManualUpdate(),r.default.checkSync(e).then((function(t){return o.a.endManualUpdate(),t})).catch((function(t){$log.error("自动更新错误",t),o.a.endManualUpdate()})))}}}}).call(this,i("391c"))},6718:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));i("163d"),i("cc57");var a=i("b7b4"),n={name:"SwipeTab",props:{title:{type:String}},data:function(){return{offset:0,style:{},bem:Object(a.createNamespace)("swipe-item")[1](),parent:{}}},computed:{index:function(){return this.parent.tabs.indexOf(this)}},beforeCreate:function(){this.$parent.swipes.push(this)},created:function(){this.findParent("SwipeTabs")},destroyed:function(){this.$parent.swipes.splice(this.$parent.swipes.indexOf(this),1)},mounted:function(){var t=this,e=this.parent.tabs,i=this.parent.$slots.default.indexOf(this.$vnode);e.splice(-1===i?e.length:i,0,this),this.$nextTick((function(){var e=t.$parent,i=e.vertical,a=e.computedWidth,n=e.computedHeight;t.style={width:a+"px",height:i?a+"px":n+"px",transform:"translate".concat(i?"Y":"X","(").concat(t.offset,"px)")}}))},methods:{findParent:function(t){for(var e=this.$parent;e;){if(e.$options.name===t){this.parent=e;break}e=e.$parent}}}},r=i("17cc"),o=Object(r.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("div",this._g({class:this.bem,style:this.style},this.$listeners),[this._t("default")],2)}),[],!1,null,null,null).exports,c={name:"SwipeTabs",model:{prop:"tabIndex",event:"change"},props:{tabIndex:{type:Number,default:0},markType:{type:String,default:"line"},showTabs:{type:Boolean,default:!0},touchable:{type:Boolean,default:!0}},data:function(){return{curIndex:0,initIndex:0,tabs:[],tabScrollVersion:null}},computed:{tabsPadding:function(){return Math.max(24-4*this.tabs.length,0)},markLeft:function(){var t=(100-2*this.tabsPadding)/this.tabs.length;return this.tabsPadding+(this.curIndex+.5)*t}},watch:{tabIndex:function(t){t!==this.curIndex&&(this.curIndex=t,this.$refs.swipe.swipeTo(t,{immediate:!0}))},curIndex:function(){this.scrollTabsTocurrent()}},created:function(){this.initIndex=this.tabIndex,this.curIndex=this.tabIndex},activated:function(){this.initIndex=this.tabIndex,this.curIndex=this.tabIndex},mounted:function(){this.$nextTick(this.scrollTabsTocurrent)},methods:{changeIndex:function(t){this.$refs.swipe.swipeTo(t)},onChange:function(t){this.curIndex=t,this.$emit("change",t)},scrollTabsTocurrent:function(){var t=this.$refs["tabs-scroll"],e=this.$refs["tab-point"]?this.$refs["tab-point"][this.curIndex]:null;if(t&&e){var i=t.getBoundingClientRect(),a=e.getBoundingClientRect(),n=a.left-i.left,r=i.right-a.right;n<0&&this.tabScrollBy(n),r<0&&this.tabScrollBy(-r)}},tabScrollBy:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=this.$refs["tabs-scroll"];if(a){var n=a.scrollLeft,r=n+t,o=Math.round(i/16.7),c=t/o,s=n,u=this.tabScrollVersion=+new Date;return n===r?Promise.resolve():new Promise((function(t){!function i(){window.requestAnimationFrame((function(){u===e.tabScrollVersion&&(s+=c,a.scrollLeft=s,n<r&&s<r||n>r&&s>r?i():(a.scrollTop=r,t()))}))}()}))}}}},s=(i("bcf4"),Object(r.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"swipe-tabs"},[t.showTabs?["line"===t.markType?i("div",{staticClass:"tabs border-bottom",style:{padding:"0 "+Math.max(24-4*t.tabs.length,0)+"%"}},[t._l(t.tabs,(function(e){return i("div",{key:e.index,staticClass:"tab",class:{"tab-current":e.index===t.curIndex},on:{click:function(i){t.changeIndex(e.index)}}},[t._v("\n        "+t._s(e.title)+"\n      ")])})),i("div",{staticClass:"mark-line",style:{left:t.markLeft+"%"}})],2):t._e(),"point"===t.markType?i("div",{staticClass:"tabs-point border-bottom"},[i("div",{ref:"tabs-scroll",staticClass:"tabs-scroll"},t._l(t.tabs,(function(e){return i("div",{key:e.index,ref:"tab-point",refInFor:!0,staticClass:"tab-point",class:{"tab-current":e.index===t.curIndex},on:{click:function(i){t.changeIndex(e.index)}}},[t._v("\n          "+t._s(e.title)+"\n        ")])})))]):t._e()]:t._e(),t._t("fixed"),i("van-swipe",{ref:"swipe",attrs:{"initial-swipe":t.initIndex,"show-indicators":!1,duration:250,loop:!1,touchable:t.touchable},on:{change:t.onChange}},[t._t("default")],2)],2)}),[],!1,null,"025feb99",null));e.b=s.exports},"7d4e":function(t,e,i){var a=i("c59b");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("62c5f5a2",a,!0,{sourceMap:!1,shadowMode:!1})},"7dd9":function(t,e,i){"use strict";i("7ff4")},"7e06":function(t,e,i){"use strict";var a=i("c5a7");e.__esModule=!0,e.unifySlots=c,e.createComponent=function(t){return function(e){var i;return"function"==typeof e&&(e={functional:!0,props:(i=e).props,model:i.model,render:function(t,e){return i(t,e.props,c(e),e)}}),e.functional||(e.mixins=e.mixins||[],e.mixins.push(r.SlotsMixin)),e.name=t,e.install=o,e}},i("4d1b");var n=i("a1aa"),r=i("1304");a(i("329b"));function o(t){var e=this.name;t.component(e,this),t.component((0,n.camelize)("-"+e),this)}function c(t){var e=t.scopedSlots||t.data.scopedSlots||{},i=t.slots();return Object.keys(i).forEach((function(t){e[t]||(e[t]=function(){return i[t]})})),e}},"7eb2":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .synchronize-tip-bar[data-v-66826030]{height:30px;padding:5px 15px;line-height:20px;text-align:center;background-color:#ffe6e6;color:#ff6060;font-size:14px}.zjapp .synchronize-tip-bar .icon-caution[data-v-66826030]{line-height:20px;margin-right:5px}@media screen and (-webkit-min-device-pixel-ratio:1){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 100%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:1.5){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 66.6667%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2.625){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 38.0952%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:3){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 33.3333%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:4){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 25%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}",""])},"7ff4":function(t,e,i){var a=i("9ffe");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("50795718",a,!0,{sourceMap:!1,shadowMode:!1})},"967a":function(t,e,i){"use strict";var a=i("8d95");e.a={REPAIR_DEADLINE_STATUS:{name:"repair_deadline_status",status:["待整改"],module:[a.a.CHECK]}}},"9ffe":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .swipe-tabs[data-v-dd812256]{flex:1}",""])},a1aa:function(t,e,i){"use strict";e.__esModule=!0,e.camelize=function(t){return t.replace(a,(function(t,e){return e.toUpperCase()}))},e.padZero=function(t,e){void 0===e&&(e=2);var i=t+"";for(;i.length<e;)i="0"+i;return i};var a=/-(\w)/g},b7b4:function(t,e,i){"use strict";var a=i("c5a7");e.__esModule=!0,e.noop=function(){},e.isDef=s,e.isObj=function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)},e.get=function(t,e){var i=e.split("."),a=t;return i.forEach((function(t){a=s(a[t])?a[t]:""})),a},e.isServer=e.addUnit=e.createNamespace=void 0;var n=a(i("329b")),r=i("6147");e.createNamespace=r.createNamespace;var o=i("2064");e.addUnit=o.addUnit;var c=n.default.prototype.$isServer;function s(t){return null!=t}e.isServer=c},bcf4:function(t,e,i){"use strict";i("27c4")},c59b:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .item-list{position:relative;padding:10px;display:flex;align-items:center;background-color:#fff;min-height:100px}.zjapp .item-list .img{display:block;width:80px;height:80px;background:no-repeat 50%;background-size:cover;background-color:#ddd}.zjapp .item-list .item-list-con{flex:1;padding:0 15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.zjapp .item-list .item-list-con .title{height:30px;line-height:24px;color:#111;font-size:16px;padding-top:6px;margin:0;padding-right:10px;margin-right:-10px;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important;font-weight:400}.zjapp .item-list .item-list-con .title .type-tag{display:inline-block;height:16px;line-height:16px;padding:0 4px;border-radius:2px;border:1px solid #4275e8;color:#4275e8;font-size:12px;zoom:.8;margin:3px 0 0 0;vertical-align:text-top}.zjapp .item-list .item-list-con .text{height:30px;line-height:24px;color:#8c8c8c;padding-bottom:6px;padding-right:11px;margin-right:-10px}.zjapp .item-list .item-list-con .text,.zjapp .item-list .item-list-con .time{font-size:14px;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important}.zjapp .item-list .item-list-con .time{height:20px;line-height:20px;color:#b3b3b3;padding-right:11px!important;margin-right:-10px!important}.zjapp .item-list .item-list-con .time .ion{color:#a6a6a6;font-size:20px;font-weight:700;margin-right:5px;vertical-align:top}.zjapp .item-list .item-list-r{width:60px;line-height:18px;text-align:center}.zjapp .item-list .item-list-status{min-width:4em;line-height:18px;text-align:center;white-space:normal;font-size:14px}.zjapp .item-list .icon-unread{display:inline-block;text-align:center;width:12px;height:12px;border-radius:6px;background-color:red}.zjapp .item-list .icon-return,.zjapp .item-list .icon-timeout,.zjapp .item-list .icon-urgent{display:inline-block;width:16px;height:16px;text-align:center;line-height:16px;font-size:12px;font-style:normal;color:#fff;border-radius:2px;-webkit-border-radius:2px;vertical-align:top;margin-top:4px;margin-right:5px}.zjapp .item-list .icon-timeout{background:#964bfe}.zjapp .item-list .icon-return{background:#fe8b00}.zjapp .item-list .icon-urgent{background:#ff3c3d}.zjapp .item-list .icon-return:last-child,.zjapp .item-list .icon-timeout:last-child,.zjapp .item-list .icon-urgent:last-child{margin-right:0}.zjapp .item-list-tip{height:70px;line-height:60px;color:#b4b4b4;text-align:center}.zjapp .status-new-tag{position:absolute;right:0;top:0;width:50px;height:50px;overflow:hidden;z-index:10}.zjapp .status-new-tag>.tag{position:absolute;right:-32px;bottom:22px;height:20px;line-height:20px;width:100px;color:#fff;font-size:12px;transform:rotate(45deg);text-align:center;border-width:1px;border-style:solid}.zjapp .time-status{font-size:10px;color:#999}",""])},c5a7:function(t,e){t.exports=function(t){return t&&t.__esModule?t:{default:t}}},d3aa:function(t,e,i){"use strict";(function(t){i("e697");var a,n=i("fd50"),r=i("3bd5"),o=i("ed08"),c=i("4ad6"),s=i("3122"),u=i("3516"),d=i("37d5"),l=i("f2d3"),f=i("48f4"),h=i("6bf2"),b=i.n(h),g=i("334f"),m=i("b725"),_=i("6b81"),y=i("2f02"),v=i("7364"),x=i("ab59"),k=i("59f8"),w=i("0136"),S=function(e){if(!e.checkItem.id)return n.a.reject("请先选择检查项");if(!e.repair_set||!e.repair_set.id)return n.a.reject("请选择问题的整改人");if(!e.contractor||!e.contractor.id)return n.a.reject("请选择问题的责任单位");if(t.isEmpty(e.reinspect_set))return n.a.reject("请选择问题的复验人");var i=r.a.getUser();e.status="待整改";var a=new Date;return a.setDate(a.getDate()+parseInt(e.deadline)),e.repair_deadline=b()(a).format("YYYY-MM-DD"),e.regist_by=i.user_id,e.regist_date=o.a.getNowDate(),e.created_by=i.user_id,e.created_on=o.a.getNowDate(),e.image_file=JSON.stringify(e.image_file),e.drawing_file&&(e.drawing_file=JSON.stringify(e.drawing_file)),$log.log("飞检&专项--\x3e提交问题"),x.a.submit(e).then((function(){return v.a.saveProblemStatusLog(e.proj_id,e.bidsection_id,e.batch_id,e.id,"已提交","","",e.image_file)})).then((function(){return j(e.id,"登记人")})).then((function(){var t=2;e.repair_set.id&&e.repair_set.id===i.user_id&&(t=1);var a=w.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"fly-inspect");return w.a.insertTodoData(i.user_id,e.id,"fly-inspect",t,a)})).then((function(){return _.a.getReinspectByList(e.id)})).then((function(i){return f.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_repair",e.id],["checkquality_reinspect",e.id],["checkquality_reinspect_by",t.map(i,"id")],["checkquality_cc",e.id]])})).catch((function(t){return $log.error(t),n.a.reject(t)}))},j=function(e,i){var a=r.a.getUser();return g.a.getProblemCCAllColumn(e).then((function(n){if(t.some(n,(function(t){return t.cc===a.user_id&&t.type===i})))return g.a.updateProblemReadingTime(e);var r={id:a.user_id,name:a.user_name,type:i,reading_time:o.a.getNowDate()};return g.a.appendCC(e,r).then((function(){return g.a.updateProblemReadingTime(e)}))}))};a={getCheckProblemDraftList:function(t){return x.a.getCheckProblemDraftList(t).catch((function(t){return $log.error(t),n.a.reject(t)}))},getCheckProblemList:function(e,i){var o=r.a.getUser().user_id;return x.a.getCheckProblemList(e,o,i).then((function(i){return t.map(i,(function(t){a.getProblemLocalStatus({status:t.status}).then((function(e){t.status_text=e.status_text}))})),x.a.getCheckProblemCount(e,o).then((function(t){return n.a.resolve({data:i,total:t.count})}))})).catch((function(t){return $log.error(t),n.a.reject(t)}))},getCheckProblemInfo:function(e){return e?n.a.all([x.a.getCheckProblem(e),x.a.getRepair(e),x.a.getMutliReinspect(e),x.a.getCC(e),x.a.getProblemCCAllColumn(e),x.a.getReinspectByList(e)]).then((function(e){var i=e[0],a=e[5],r=e[1];r&&(i.repair_set=r,i.has_read=r.has_read);var o=e[2];o&&(i.reinspect_set=o);var c=e[3];c&&c.length>0&&(i.cc_set_id_array=t.map(c,(function(t){return{id:t.user_id}})),i.cc_set_name_array=t.map(c,(function(t){return{name:t.user_name}})),i.cc_set_array=t.map(c,(function(t){return{id:t.user_id,name:t.user_name,mobile:t.mobile,is_im_user:t.is_im_user}})));var s=e[4];return s&&s.length>0&&(i.cc_set_all_id_array=t.map(s,(function(t){return{id:t.cc}}))),i.regist_by||i.sent_back_by||i.repair_by||i.reinspect_by?d.default.getAllProjectUsers(i.proj_id).then((function(e){if(i.regist_by){var n=t.find(e,(function(t){return t.user_id===i.regist_by}));n&&(i.regist=n)}if(i.sent_back_by){var r=t.find(e,(function(t){return t.user_id===i.sent_back_by}));r&&(i.sent_back={id:r.user_id,name:r.user_name,mobile:r.mobile,is_im_user:r.is_im_user})}if(i.repair_by){var o=t.find(e,(function(t){return t.user_id===i.repair_by}));o&&(i.repair=o)}return t.isEmpty(a)||(i.reinspectBy=t.map(a,(function(i){var a=t.find(e,(function(t){return t.user_id===i.reinspect}));return a?{id:a.user_id,name:a.user_name,mobile:a.mobile,is_im_user:a.is_im_user,reinspect_date:i.reinspect_date,reinspect_remark:i.reinspect_remark,reinspect_image_file:JSON.parse(i.reinspect_image_file||"[]"),reinspectById:i.id}:{id:i.reinspect,name:"该用户已被删除",mobile:"",is_im_user:null,reinspect_date:i.reinspect_date,reinspect_remark:"",reinspect_image_file:[],reinspectById:i.id}})),i.reinspectBy=t.filter(i.reinspectBy,(function(t){return!!t})),i.reinspect=t.filter(i.reinspectBy,(function(t){return!!t.reinspect_date}))),i.regist=i.regist||{},i.sent_back=i.sent_back||{},i.repair=i.repair||{},i.reinspect=i.reinspect||[],i})):(i.regist={},i.sent_back={},i.repair={},i.reinspect=[],n.a.resolve(i))})).catch((function(t){$log.log(t)})):n.a.resolve({})},getCheckItemDesc:function(t){return x.a.getCheckItemDesc(t)},submit:function(t,e){if(e)return S(t);if(!t.checkItem.id)return n.a.reject("请先选择检查项");var i=r.a.getUser();return t.status="检查完毕",t.regist_by=i.user_id,t.regist_date=o.a.getNowDate(),t.created_by=i.user_id,t.created_on=o.a.getNowDate(),t.image_file=JSON.stringify(t.image_file),t.drawing_file&&(t.drawing_file=JSON.stringify(t.drawing_file)),x.a.submit(t).then((function(){return f.default.addSyncGroup([["checkquality_problem",t.id]])})).then((function(){return w.a.saveTodo({biz_id:t.id,proj_id:t.proj_id,module_code:"fly-inspect",type:2})})).catch((function(t){return $log.error(t),n.a.reject(t)}))},save:function(t){if("待提交"!==t.status&&"草稿"!==t.status)return n.a.reject("问题单状态异常。");var e={id:t.id,remark:t.remark,image_file:t.image_file,batch_id:t.batch_id,batch_type:t.batch_type,biz_id:t.biz_id||"",proj_id:t.proj_id,created_by:t.created_by,created_on:o.a.getNowDate(),status:t.status,room_id:t.room_id||"",building_id:t.building_id||"",unit:t.unit||"",floor:t.floor||"",deduction:t.deduction,repair_deadline:t.repair_deadline,deadline:t.deadline};return t.checkItem&&t.checkItem.id&&(e.item_id=t.checkItem.id,e.item_name=t.checkItem.item_name,e.item_full_name=t.checkItem.full_name),t.place&&t.place.full_name&&(e.place=t.place.full_name),t.description&&t.description.id?e.desc_id=t.description.id:e.desc_id="",t.contractor&&t.contractor.id&&(e.contractor_id=t.contractor.id),e.emergency_degree=t.level,t.place_point&&(e.problem_values=JSON.stringify(t.place_point)),e.image_file=JSON.stringify(t.image_file),t.drawing_file&&(e.drawing_file=JSON.stringify(t.drawing_file)),t.id?x.a.update(e,t.cc_set,t.repair_set,t.reinspect_set).then((function(){return n.a.resolve(t.id)})).catch((function(t){return $log.error(t),n.a.reject(t)})):(e.id=o.a.uuid(),x.a.insert(e).then((function(){return x.a.update(e,t.cc_set,t.repair_set,t.reinspect_set)})).then((function(){return n.a.resolve(e.id)})).catch((function(t){return $log.error(t),n.a.reject(t)})))},delete:function(t){return x.a.getCheckProblem(t).then((function(e){return"待提交"===e.status||"草稿"===e.status?x.a.delete(t).catch((function(t){return $log.error(t),n.a.reject(t)})):($log.log("问题单状态异常："+t),n.a.reject("问题单状态异常"))}))},getProblemLocalStatusById:function(t){return _getProblemLocalStatus({status:p.status})},changeRepairDeadline:function(t){if(!/^(\d+)-(\d{1,2})-(\d{1,2})$/.test(t.repair_deadline))return n.a.reject("整改期限需要一个日期格式的值");var e=b()(t.repair_deadline).format("YYYY-MM-DD"),i=b()().format("YYYY-MM-DD");return t.is_timeout=e<i,$log.log("飞检&专项--\x3e修改整改期限"),x.a.updateProblemRepairDeadline(t.id,t.repair_deadline).then((function(){return f.default.addSyncGroup([["checkquality_problem",t.id]])})).catch((function(t){return $log.error(t),n.a.reject(t)}))},saveRepairInfo:function(t,e,i){return i=JSON.stringify(i),x.a.saveRepairInfo(t,e,i).then((function(){return x.a.getCheckProblemDraft(t).then((function(e){return l.a.backUpDraft(t,e.proj_id,"checkquality_problem",e)}))}))},changeContractor:function(t){return t.contractor&&t.contractor.id?($log.log("飞检&专项--\x3e修改责任单位"),x.a.updateProblemContractor(t.id,t.contractor.id).then((function(){return f.default.addSyncGroup([["checkquality_problem",t.id]])})).catch((function(t){return $log.error(t),n.a.reject(t)}))):n.a.reject("请指定责任单位")},changeCC:function(t){return $log.log("飞检&专项--\x3e修改抄送人"),x.a.updateProblemModifiedBy(t.id).then((function(){return x.a.saveProblemCC(t.id,t.cc_set)})).then((function(){return f.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_cc",t.id]])})).catch((function(t){return $log.error(t),n.a.reject(t)}))},takePictureAndSave:function(t){return s.a.takePicture().then((function(e){if(e)return u.a.getBatch(t).then((function(t){var i={proj_id:t.proj_id,biz_id:t.template_id,batch_id:t.id,repair_deadline:t.repair_deadline,batch_type:t.batch_type,created_by:r.a.getUser().user_id,created_on:o.a.now(),image_file:[e],status:"待提交"};return a.save(i)}))})).catch((function(t){return $log.error(t),n.a.reject(t)}))},takePicture:function(){return s.a.takePicture()},allowSelectPicture:function(){return k.a.getValue("upload_from_phone_albums").then((function(t){return"1"===t}))},removeLocalInvalidProblem:function(e){var i=n.a.when();return e.problem_repair&&(i=i.then((function(){return m.a.removeInvalidData(e.problem.id,t.map(e.problem_repair,"id"))}))),e.problem_reinspect&&(i=i.then((function(){return _.a.removeInvalidData(e.problem.id,t.map(e.problem_reinspect,"id"))}))),e.problem_cc&&(i=i.then((function(){return g.a.removeInvalidData(e.problem.id,t.map(e.problem_cc,"id"))}))),e.children_Problem&&(i=i.then((function(){return x.a.removeInvalidChildProblem(e.problem.id,e.children_Problem)}))),i},removeLocalInvalidProblem1:function(e,i){var a=i.checkquality_problem;return n.a.when().then((function(){if(i.checkquality_problem)return x.a.deleteProblemById(a.id)})).then((function(){if(i.checkquality_repair)return m.a.removeInvalidData(a.id,t.map(i.checkquality_repair,"id"))})).then((function(){if(i.checkquality_cc)return g.a.removeInvalidData(a.id,t.map(i.checkquality_cc,"id"))}))},removeClosedBatchProblem:function(){return u.a.getClosedBatchIdList().then((function(t){return a.deleteBatchProblems(t)}))},deleteBatchProblems:function(e){return $log.log("删除已关闭批次的问题"),x.a.getProblemsByBatch(e).then((function(e){var i=n.a.when(),a=["image_file","repair_image_file","sent_back_image_file"],r=[];return t.each(e,(function(e){for(var i=0;i<a.length;++i){var n=e[a[i]]=JSON.parse(e[a[i]]||"[]");t.each(n,(function(t){t.local&&r.push(t.local),t.thumbnail&&r.push(t.thumbnail),t.temp&&r.push(t.temp)}))}})),t.each(r,(function(t){i=i.then((function(){return c.a.isFileExists(t)})).then((function(e){if(e)return c.a.deleteFile(t)}))})),i})).then((function(){return x.a.deleteProblemByBatch(e)}))},getLeaderComments:function(e){return x.a.getLeaderComments(e).then((function(e){return t.each(e,(function(t){t.user={id:t.user_id,name:t.user_name,mobile:t.mobile,is_im_user:t.is_im_user},t.image_file&&(t.image_file=JSON.parse(t.image_file))})),e}))},repair:function(t){if("待整改"!==t.status)return n.a.reject("问题单状态异常");var e=r.a.getUser();t.status="待复验",t.repair_by=e.user_id,t.repair_date=o.a.getNowDate();var i=JSON.stringify(t.repair_image_file);return x.a.getCheckProblem(t.id).then((function(e){if(!e||"待整改"===e.status)return $log.log("飞检&专项--\x3e完成整改"),x.a.repairProblem(t.id,t.status,t.repair_by,t.repair_remark,t.repair_date,i).then((function(){return v.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已整改","",t.repair_remark,i)})).then((function(){return j(t.id,"操作人")})).then((function(){var e=2;t.reinspect_set.id===t.repair_by&&(e=1);var i=w.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"fly-inspect");return w.a.insertTodoData(t.repair_by,t.id,"fly-inspect",e,i)})).then((function(){return f.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_cc",t.id]])}));$log.log("提交整改时数据已变为")})).catch((function(t){return $log.error(t),n.a.reject(t)}))},changeRepair:function(t,e){if(!t.repair_set||!t.repair_set.id)return n.a.reject("请指定一个整改人");var i=r.a.getUser();return $log.log("飞检&专项--\x3e修改整改人"),x.a.updateProblemModifiedBy(t.id).then((function(){if(e){var i=t.contractor&&t.contractor.id||"";return x.a.updateProblemContractor(t.id,i)}})).then((function(){return x.a.changeProblemRepairer(t)})).then((function(){return x.a.saveProblemFpInfo(t.proj_id,t.bidsection_id,t.batch_id,t.id,t.repair_set.id,t.repair_set_old.id,"分配整改人")})).then((function(){return j(t.id,"操作人")})).then((function(){var e=2;t.repair_set.id&&t.repair_set.id===i.user_id&&(e=1);var a=w.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"fly-inspect");return w.a.insertTodoData(i.user_id,t.id,"fly-inspect",e,a)})).then((function(){return f.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_repair",t.id],["checkquality_cc",t.id],["checkquality_problem_fpinfo",t.id]])})).catch((function(t){return $log.error(t),n.a.reject(t)}))},close:function(t){if("待整改"!==t.status)return n.a.reject("问题单状态异常");if(!t.close_reason)return n.a.reject("请填写关闭原因");var e=r.a.getUser();return t.close_date=o.a.getNowDate(),t.status="已关闭",$log.log("飞检&专项--\x3e非正常关闭"),x.a.closeProblem(t.id,t.status,t.close_date,t.close_reason).then((function(){return v.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已关闭",t.close_reason,"","")})).then((function(){return j(t.id,"操作人")})).then((function(){var i=w.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"fly-inspect");return w.a.insertTodoData(e.user_id,t.id,"fly-inspect",2,i)})).then((function(){return f.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_cc",t.id]])})).catch((function(t){return $log.error(t),n.a.reject(t)}))},changeReinspect:function(e){if(t.isEmpty(e.reinspect_set))return n.a.reject("请指定一个复验人");var i=r.a.getUser();return $log.log("飞检&专项--\x3e修改复验人"),x.a.updateProblemModifiedBy(e.id).then((function(){return x.a.changeProblemReinspect(e.id,e.reinspect_set,!0)})).then((function(){var i=t.map(e.reinspect_set,(function(t){return t.id})).join(","),a=t.map(e.reinspect_set_old,(function(t){return t.id})).join(",");return y.a.saveProblemFpInfo(e.proj_id,e.bidsection_id,e.batch_id,e.id,i,a,"分配复验人")})).then((function(){return j(e.id,"操作人")})).then((function(){var t=2;e.reinspect_set.user_id===i.user_id&&"待复验"===e.status&&(t=1);var a=w.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"fly-inspect");return w.a.insertTodoData(i.user_id,e.id,"fly-inspect",t,a)})).then((function(){return x.a.getReinspectByList(e.id)})).then((function(i){return f.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_reinspect",e.id],["checkquality_reinspect_by",t.map(i,"id")],["checkquality_cc",e.id],["checkquality_problem_fpinfo",e.id]])})).catch((function(t){return $log.error(t),n.a.reject(t)}))},reinspectPass:function(e,i){if("待复验"!==e.status)return n.a.reject("问题单状态异常");e.currentReinspectBy=e.currentReinspectBy||{};var a=r.a.getUser(),c="",s=t.isEmpty(e.currentReinspectBy.reinspect_image_file)?"":JSON.stringify(e.currentReinspectBy.reinspect_image_file);return x.a.getCheckProblem(e.id).then((function(i){if(!i||"待复验"===i.status)return $log.log("飞检&专项--\x3e复验通过"),x.a.reinspectPass(e.id,a.user_id,o.a.now(),s,e.currentReinspectBy.reinspect_remark||"").then((function(){return x.a.getReinspectByList(e.id).then((function(i){var r=t.every(i,(function(t){return!!t.reinspect_date})),s=t.find(i,{reinspect:a.user_id});return s?(c=s.id,r?(e.status="已通过",e.respect_by=a.user_id,e.reinspect_completed_date=o.a.getNowDate(),x.a.reinspectProblemPass(e.id,e.status,e.reinspect_completed_date,e.respect_by).then((function(){return v.a.saveProblemStatusLog(e.proj_id,e.bidsection_id,e.batch_id,e.id,"已复验","","","")}))):void 0):n.a.reject("问题单复验人异常")}))})).then((function(){return j(e.id,"操作人")})).then((function(){var t=w.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"fly-inspect");return w.a.insertTodoData(a.user_id,e.id,"fly-inspect",2,t)})).then((function(){return f.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_reinspect_by",c],["checkquality_cc",e.id]])}));$log.log("提交复验时数据已变为")})).catch((function(t){return $log.error(t),n.a.reject(t)}))},reinspectReject:function(e){var i=[["checkquality_problem",e.id],["checkquality_cc",e.id]];if("待复验"!==e.status)return n.a.reject("问题单状态异常");if(!e.sent_back_remark)return n.a.reject("请填写退回原因");var a=r.a.getUser();e.sent_back_times?e.sent_back_times++:e.sent_back_times=1,e.status="待整改",e.sent_back_date=o.a.getNowDate(),e.sent_back_by=a.user_id;var c=JSON.stringify(e.sent_back_image_file);return $log.log("飞检&专项--\x3e复验退回"),x.a.reinspectProblemReject(e.id,e.status,e.sent_back_date,e.sent_back_remark,c,e.sent_back_by,e.sent_back_times).then((function(){return v.a.saveProblemStatusLog(e.proj_id,e.bidsection_id,e.batch_id,e.id,"已退回",e.sent_back_remark,"",c)})).then((function(){return x.a.clearReinspectByData(e.id)})).then((function(){return j(e.id,"操作人")})).then((function(){var t=2;e.repair_set.id&&e.repair_set.id===a.user_id&&(t=1);var i=w.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"fly-inspect");return w.a.insertTodoData(a.user_id,e.id,"fly-inspect",t,i)})).then((function(){return x.a.getReinspectByList(e.id).then((function(e){i.push(["checkquality_reinspect_by",t.map(e,"id")])}))})).then((function(){if(1===e.has_read)return m.a.update({has_read:0},{checkquality_problem_id:e.id}).then((function(){i.push(["checkquality_repair",e.id])}))})).then((function(){return f.default.addSyncGroup(i)})).catch((function(t){return $log.error(t),n.a.reject(t)}))},getProblemLocalStatus:function(t){var e=t.status;return"已关闭"===t.status&&(e="非正常关闭"),n.a.resolve({status_text:e})},noConflict:function(e,i){var a=i.checkquality_problem.id;return x.a.deleteCheckqualityProblem(a).then((function(){return w.a.removeTodo(a)})).then((function(){var i=[];return t.each(e.data,(function(e,a){t.isArray(e)?t.each(e,(function(t,e){i.push(localDB.delete(a,{id:t.id}).then((function(){return localDB.insertObject(a,t)})))})):t.isObject(e)&&i.push(localDB.delete(a,{id:e.id}).then((function(){return localDB.insertObject(a,e)})))})),n.a.all(i)}))},problemRead:function(t){return x.a.updateRepair({has_read:1},{checkquality_problem_id:t}).then((function(){return f.default.addSyncGroup([["checkquality_problem",t],["checkquality_repair",t]])}))}},e.a=a}).call(this,i("391c"))},db6b2:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,'.zjapp .swipe-tabs[data-v-025feb99]{display:flex;flex-direction:column;flex:1;overflow:hidden}.zjapp .tabs[data-v-025feb99]{position:relative;display:flex;background-color:#fff}.zjapp .tab[data-v-025feb99]{flex:1;height:40px;line-height:20px;padding:10px;font-size:14px;text-align:center;box-sizing:border-box}.zjapp .tab-current[data-v-025feb99]{color:#4275e8}.zjapp .mark-line[data-v-025feb99]{position:absolute;bottom:0;left:0;width:20px;height:2px;margin-left:-10px;background-image:linear-gradient(90deg,#5ea2ff,#4f83eb 50%,#4275e8);transition:left .4s cubic-bezier(.1,.7,.1,1)}.zjapp .tabs-point[data-v-025feb99]{position:relative;z-index:1;height:40px;font-size:0;text-align:center;background-color:#fff;overflow:visible}.zjapp .tabs-scroll[data-v-025feb99]{position:relative;padding-bottom:3px;margin-bottom:-3px;white-space:nowrap;overflow-x:auto}.zjapp .tabs-scroll[data-v-025feb99]::-webkit-scrollbar{display:none}.zjapp .tab-point[data-v-025feb99]{display:inline-block;padding:10px 15px;line-height:20px;font-size:16px;color:#333;white-space:nowrap}.zjapp .tab-point.tab-current[data-v-025feb99]{position:relative;z-index:3;color:#4275e8}.zjapp .tab-point.tab-current[data-v-025feb99]:after{content:"";position:absolute;z-index:3;bottom:-3px;left:50%;margin-left:-3px;width:7px;height:7px;border-radius:50%;background-color:#4275e8}',""])},dd16:function(t,e,i){"use strict";(function(t){e.a={name:"StatusText",props:{status:{type:String},text:{type:String},extend:{type:Object,default:function(){return{}}}},data:function(){return{classSet:t.extend({"草稿":"color-gray","暂存":"color-gray","检查中":"color-orange","待整改":"color-red","待复验":"color-orange","待验收":"color-red","待报验":"color-red","待申请进场":"color-red","待初验":"color-red","待送检":"color-red","待上传报告":"color-red","待退场":"color-red","待建设单位验收":"color-red","待区域验收":"color-red","供应链退回":"color-red","预创建":"color-status-blue","已提交":"color-green","已整改":"color-green","已验收":"color-green","已通过":"color-green","已退场":"color-gray","已关闭":"color-gray","非正常关闭":"color-gray","已退回":"color-red","已完成":"color-green","已甩项":"color-gray","检查完毕":"color-green","送检合格":"color-green","复验合格":"color-green","验收合格":"color-green","验收不合格":"color-red","未验收":"color-orange","待点评":"color-orange","已点评":"color-green","合格":"color-green","不合格":"color-red","进度正常":"color-green","进度滞后":"color-red","正常":"color-green","滞后":"color-red","施工单位验收合格":"color-green","监理单位验收合格":"color-green","建设单位验收合格":"color-green","施工单位验收不合格":"color-red","监理单位验收不合格":"color-red","建设单位验收不合格":"color-red"},this.extend)}},mounted:function(){}}}).call(this,i("391c"))},e89f:function(t,e,i){"use strict";var a=i("04f3"),n=i("cf09"),r=i("4360"),o=0;e.a={name:"PopupMixin",data:function(){return{backButtonEvent:null}},watch:{show:function(t){var e=this;if(t){if(this.$nextTick((function(){e.$el&&e.$el.style&&(e.$el.style.zIndex=++n.a.zIndex,o++,r.a.commit("app/SET_HAS_POPUP",!!o))})),!this.backButtonEvent){var i=this.close||this.closePopup;this.backButtonEvent=Object(a.a)(i)}}else--o<0&&(o=0),r.a.commit("app/SET_HAS_POPUP",!!o),this.backButtonEvent&&(Object(a.c)(this.backButtonEvent),this.backButtonEvent=null)}},methods:{}}},f24f:function(t,e,i){"use strict";e.__esModule=!0,e.isNumber=function(t){return/^\d+(\.\d+)?$/.test(t)},e.isNaN=function(t){if(Number.isNaN)return Number.isNaN(t);return t!=t}},f7ab:function(t,e,i){"use strict";var a=i("65e9").a,n=(i("f7d4"),i("17cc")),r=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{ref:"synchronize-tip-bar",staticClass:"synchronize-tip-bar"},[i("icon",{attrs:{name:"caution"}}),t.waitUploadNum?i("span",[t._v("您有"+t._s(t.waitUploadNum)+"条数据待上传")]):t._e(),!t.waitUploadNum&&t.hasChanged?i("span",[t._v("有新数据")]):t._e(),t._v("\n  ，下拉可"+t._s(t.waitUploadNum?"上传":"刷新")+"\n")],1):t._e()}),[],!1,null,"66826030",null);e.a=r.exports},f7d4:function(t,e,i){"use strict";i("2d6e")},fa4f:function(t,e,i){"use strict";var a=i("4aef"),n=i("967a"),r={name:"ItemList",components:{StatusText:a.a},props:{img:{type:String,default:""},title:{type:String,default:""},detail:{type:String,default:""},footer:{type:String,default:""},status:{type:String,default:""},isShowNewStatus:{type:Boolean,default:!1},statusText:{type:String,default:""},statusClassSet:{type:Object,default:function(){return{}}},typeTag:{type:String,default:""},isUnread:{type:Boolean,default:!1},isTimeout:{type:Boolean,default:!1},isUrgent:{type:Boolean,default:!1},isReturn:{type:Boolean,default:!1},repairDeadline:{type:String,default:null}},data:function(){return{repairDeadlineStatus:n.a.REPAIR_DEADLINE_STATUS.status}},computed:{bgNewClass:function(){return{"草稿":"bg-gray7 b-color","暂存":"bg-gray b-color","检查中":"bg-orange b-color","待整改":"bg-red2 b-color ","待复验":"bg-purple b-color","待验收":"bg-red b-color","待报验":"bg-red b-color","待申请进场":"bg-red b-color","待初验":"bg-red b-color","待送检":"bg-red b-color","待上传报告":"bg-red b-color","待退场":"bg-red b-color","待建设单位验收":"bg-red b-color","待区域验收":"bg-red b-color","已提交":"bg-green b-color","已整改":"bg-green b-color","已验收":"bg-green b-color","已通过":"bg-green2 b-color","已退场":"bg-gray b-color","已关闭":"bg-gray7 b-color","非正常关闭":"bg-gray b-color","已退回":"bg-red b-color","已完成":"bg-green b-color","已甩项":"bg-gray b-color","检查完毕":"bg-green b-color","送检合格":"bg-green b-color","复验合格":"bg-green b-color","验收合格":"bg-green b-color","验收不合格":"bg-red b-color","未验收":"bg-orange b-color","待点评":"bg-orange b-color","已点评":"bg-green b-color","合格":"bg-green b-color","不合格":"bg-red b-color","进度正常":"bg-green2 b-color","进度滞后":"bg-red2 b-color","施工单位验收合格":"bg-green b-color","监理单位验收合格":"bg-green b-color","建设单位验收合格":"bg-green b-color","施工单位验收不合格":"bg-red b-color","监理单位验收不合格":"bg-red b-color","建设单位验收不合格":"bg-red b-color"}}},activated:function(){}},o=(i("19a9"),i("17cc")),c=Object(o.a)(r,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",t._g({staticClass:"item-list border-bottom"},t.$listeners),[t.isShowNewStatus?i("div",{staticClass:"status-new-tag"},[i("div",{staticClass:"tag",class:t.bgNewClass[t.status]},[t._v("\n      "+t._s(t.status)+"\n    ")])]):t._e(),t.img?i("div",{staticClass:"img",style:{"background-image":"url("+t.img+")"}}):t._e(),i("div",{staticClass:"item-list-con"},[i("h2",{staticClass:"title"},[t.isUnread?i("i",{staticClass:"icon-unread"}):t._e(),t.isTimeout?i("i",{staticClass:"icon-timeout"},[t._v("\n        超\n      ")]):t._e(),t.isUrgent?i("i",{staticClass:"icon-urgent"},[t._v("\n        急\n      ")]):t._e(),t.isReturn?i("i",{staticClass:"icon-return"},[t._v("\n        退\n      ")]):t._e(),t.$slots.title?t._t("title"):[t.typeTag?i("span",{staticClass:"type-tag"},[t._v(t._s(t.typeTag))]):t._e(),t._v("\n        "+t._s(t.title||"")+"\n      ")]],2),i("p",{staticClass:"text"},[t._v(t._s(t.detail||""))]),t.$slots.footer?t._t("footer"):i("p",{staticClass:"time",domProps:{innerHTML:t._s(t.footer||"")}})],2),t.status&&!t.isShowNewStatus?i("div",{staticClass:"item-list-status"},[i("status-text",{attrs:{status:t.status,text:t.statusText,extend:t.statusClassSet}}),t.repairDeadline&&t.repairDeadlineStatus.includes(t.status)?i("p",{staticClass:"time-status"},[t._v("\n      "+t._s(t._f("timeStatus")(t.repairDeadline))+"\n    ")]):t._e()],1):t._e()])}),[],!1,null,null,null);e.a=c.exports}}]);