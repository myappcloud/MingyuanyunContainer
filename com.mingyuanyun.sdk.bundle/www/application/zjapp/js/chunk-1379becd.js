(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-1379becd"],{"6dfe":function(t,e,o){"use strict";o("6a61");var i,a=o("2e91"),n=o("f24e"),r=o("e2a7"),l=o("fe6f"),s={props:{editData:{type:Object,default:function(){return{points:[],url:""}}},isLandscape:{type:Boolean,default:!1}},data:function(){return{selectPointData:{},show:!1,loading:!1,iserror:!1,style:{width:"",height:"",left:"",top:"",imgWidth:"",imgHeight:""}}},watch:{editData:{handler:function(t){var e=this;this.loading=!0,this.iserror=!1,this.loadImg(t.url).then((function(t){e.loading=!1,e.showCenterImage(t)})).catch((function(t){r.a.alert(t.errMsg||t),e.iserror=!0,e.loading=!1}))},immediate:!0,deep:!0}},methods:{loadImg:function(t){if(!t)return Promise.resolve();var e=new Image;return e.src=t,new Promise((function(o,i){e.onload=function(){console.log("视频图片加载成功！",t),o(e)},e.onerror=function(){console.log("视频图片加载失败！",t),i({errMsg:"获取平面图失败，请退出重试"})}}))},showCenterImage:function(t){var e,o,i,a,n,r,l=this.$refs.MainBox;l.offsetWidth/l.offsetHeight>t.width/t.height?(a="100%",i="auto",e=l.offsetHeight*t.width/t.height,o=l.offsetHeight,n=(l.offsetWidth-e)/2,r="0"):(a="auto",i="100%",e=l.offsetWidth,o=l.offsetWidth*t.height/t.width,n="0",r=(l.offsetHeight-o)/2),this.style={top:r+"px",left:n+"px",width:e+"px",height:o+"px",imgWidth:i,imgHeight:a}},selectPoint:function(t){this.selectPointData=t,this.show=!0},showVideo:(i=Object(a.a)(regeneratorRuntime.mark((function t(){var e,o,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.selectPointData,o=null,"hik"===e.video_type){t.next=7;break}return t.next=5,n.a.getVideoDetail(e.url);case 5:o=t.sent,e.data=o.data;case 7:t.t0=e.video_type,t.next="gld"===t.t0?10:"ys"===t.t0?13:"url"===t.t0?15:"hik"===t.t0?17:18;break;case 10:return this.isLandscape&&Object(l.b)()&&MUtils.setDeviceOrientation(""),n.a.playGld(e).then((function(t){i.isLandscape&&Object(l.b)()&&MUtils.setDeviceOrientation("landscape")})),t.abrupt("break",18);case 13:return n.a.playYsy(e).then((function(t){i.isLandscape&&Object(l.b)()&&MUtils.setDeviceOrientation("landscape")})),t.abrupt("break",18);case 15:return n.a.playUrl({url:e.data,title:e.title}),t.abrupt("break",18);case 17:n.a.playHik(e);case 18:this.selectPointData={},this.show=!1;case 20:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})}},c=(o("e1a3"),o("17cc")),u=Object(c.a)(s,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"MainBox",staticClass:"main-box",class:{flex:t.loading||t.iserror}},[t.loading?o("van-loading",{attrs:{size:"24px",vertical:""}},[t._v("加载中...")]):t.iserror?o("span",[t._v("图片加载失败")]):t._e(),o("div",{directives:[{name:"zj-scale",rawName:"v-zj-scale"},{name:"zj-move",rawName:"v-zj-move"},{name:"show",rawName:"v-show",value:!t.loading&&!t.iserror,expression:"!loading && !iserror"}],ref:"ImgBox",staticClass:"bg-img",style:{width:t.style.width,height:t.style.height,left:t.style.left,top:t.style.top}},[t._l(t.editData.points,(function(e,i){return o("div",{key:i,staticClass:"points"},[o("div",{staticClass:"monitor-items",class:{active:e.device_id===t.selectPointData.device_id},style:"left:"+e.x+"%;top:"+e.y+"%;",attrs:{title:e.title||"暂未绑定监控"},on:{click:function(o){t.selectPoint(e)}}},[o("i",{staticClass:"iconfont icon-shipinjiankong"})])])})),o("img",{ref:"Img",style:{width:t.style.imgWidth,height:t.style.imgHeight},attrs:{src:t.editData.url,alt:""}})],2),o("van-popup",{style:{height:"70px"},attrs:{position:"bottom"},on:{click:t.showVideo},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[o("div",{staticClass:"bottom-select-box"},[o("div",{staticClass:"monitor-icon"},[o("i",{staticClass:"iconfont icon-shipinjiankong"})]),o("span",{staticClass:"text"},[t._v(t._s(t.selectPointData.title))]),o("i",{staticClass:"iconfont icon-arrow-right right-icon"})])])],1)}),[],!1,null,"24def59a",null);e.a=u.exports},"774b":function(t,e,o){"use strict";var i=o("d18d").a,a=(o("b225"),o("17cc")),n=Object(a.a)(i,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"scroll-warp",staticClass:"scroll-warp",class:{"scroll-warp-pulling":t.pulling,"scroll-warp-complete":!t.hasNext&&!t.isEmpty,"scroll-warp-empty":t.isEmpty},style:{"padding-bottom":t.numberKeyboardCoverHeight+"px"},on:{scroll:t.onScroll,touchstart:t.onTouchstart,touchmove:t.onTouchmove,touchend:t.onTouchend}},[t.allowPullDown?o("div",{staticClass:"pull-refresh-warp",style:{height:t.pullDist+"px"}},[o("div",{staticClass:"pull-refresh"},[o("div",{staticClass:"animation-refresher",class:{refreshing:t.refreshing}}),t.updateTime?o("p",{staticClass:"pull-refresh-date"},[t._v("最后成功同步："+t._s(t.updateTime))]):t._e()])]):t._e(),t._t("default"),t.loading?o("div",{staticClass:"page-loading"},[o("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[o("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]):t._e(),t.hasNext||t.isEmpty?t._e():[t.$slots.end?t._t("end"):t._e(),!t.$slots.end&&t.endText?o("div",{staticClass:"end-text"},[t._v("\n      "+t._s(t.endText)+"\n    ")]):t._e()]],2)}),[],!1,null,"2b1a346c",null);e.a=n.exports},"87e6":function(t,e,o){var i=o("c7b1");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,o("85cb").default)("df4a96a6",i,!0,{sourceMap:!1,shadowMode:!1})},"9d55":function(t,e,o){(t.exports=o("690e")(!1)).push([t.i,'.zjapp .scroll-warp[data-v-2b1a346c]{flex:1;overflow:auto;-webkit-overflow-scrolling:touch}.zjapp .scroll-warp-pulling[data-v-2b1a346c]{overflow:hidden}.zjapp .scroll-warp-complete[data-v-2b1a346c]:after{content:"";display:block;height:100px}.zjapp .scroll-warp-empty[data-v-2b1a346c]{display:flex;flex-direction:column}.zjapp .pull-refresh-warp[data-v-2b1a346c]{position:relative;height:0;overflow:hidden}.zjapp .pull-refresh[data-v-2b1a346c]{position:absolute;left:0;bottom:0;height:70px;width:100%;padding:6px;text-align:center}.zjapp .pull-refresh-date[data-v-2b1a346c]{margin-top:4px;height:16px;line-height:16px;font-size:12px;color:#bcbcbc}.zjapp .page-loading[data-v-2b1a346c]{padding:10px;text-align:center}.zjapp .end-text[data-v-2b1a346c]{color:#c8c8c8;background:#f4f4f4;position:relative;line-height:76px;height:76px;text-align:center}.zjapp .end-text[data-v-2b1a346c]:after,.zjapp .end-text[data-v-2b1a346c]:before{content:"";position:absolute;width:48px;height:1px;background:#e4e4e4;top:50%;margin-top:-1px}.zjapp .end-text[data-v-2b1a346c]:after{left:50%;transform:translateX(-92px)}.zjapp .end-text[data-v-2b1a346c]:before{right:50%;transform:translateX(90px)}.zjapp .end-slot[data-v-2b1a346c]{padding:30px;line-height:18px;text-align:center;color:#c8c8c8}',""])},b225:function(t,e,o){"use strict";o("ef48")},c7b1:function(t,e,o){(t.exports=o("690e")(!1)).push([t.i,'.zjapp .main-box[data-v-24def59a]{height:100%;position:relative;overflow:hidden}.zjapp .main-box.flex[data-v-24def59a]{display:flex;justify-content:center;align-items:center}.zjapp .bg-img[data-v-24def59a]{position:absolute;height:100%;width:100%}.zjapp .monitor-icon[data-v-24def59a]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;background-color:#1f93ff;color:#fff;border-radius:4px}.zjapp .bottom-select-box[data-v-24def59a]{height:100%;display:flex;align-items:center;padding:15px}.zjapp .bottom-select-box .text[data-v-24def59a]{padding:0 10px;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:16px}.zjapp .bottom-select-box .icon-arrow-right[data-v-24def59a]{color:#969799}.zjapp .bottom-select-box .icon-shipinjiankong[data-v-24def59a]{font-size:24px}.zjapp .monitor-items[data-v-24def59a]{position:absolute;margin-left:-18px;margin-top:-42px;display:flex;align-items:center;justify-content:center;width:40px;height:40px;background-color:#fff;color:#1f93ff;border-radius:4px;box-shadow:1px 1px 4px rgba(0,0,0,.4)}.zjapp .monitor-items .close[data-v-24def59a]{position:absolute;right:-6px;top:-6px;width:12px;height:12px;color:#f44;background-color:#fff;border-radius:50%;overflow:hidden}.zjapp .monitor-items .close.icon-quxiao[data-v-24def59a]{font-size:12px}.zjapp .monitor-items .iconfont[data-v-24def59a]{font-size:24px}.zjapp .monitor-items[data-v-24def59a]:before{content:" ";position:absolute;bottom:-6px;width:0;height:0;border-color:transparent;border-style:solid;border-width:6px;border-top-color:#fff;border-bottom-width:0}.zjapp .monitor-items.active[data-v-24def59a],.zjapp .monitor-items[data-v-24def59a]:hover{color:#fff;background-color:#1f93ff}.zjapp .monitor-items.active[data-v-24def59a]:before,.zjapp .monitor-items[data-v-24def59a]:hover:before{border-top-color:#1f93ff}',""])},cba0:function(t,e,o){"use strict";o.d(e,"a",(function(){return l})),o.d(e,"b",(function(){return s})),o.d(e,"c",(function(){return c})),o.d(e,"d",(function(){return u}));var i=o("5e8d"),a=o("162a"),n=o("bcc78"),r=o("da71");function l(t){return Object(i.a)().then((function(){var e=n.a.monitorPointsData.url;return a.a.request(e,t)}))}function s(t){return Object(i.a)().then((function(){var e=r.a.commonProxy.url;return a.a.post(e,{},t)}))}function c(t){return Object(i.a)().then((function(){var e=n.a.monitorList.url;return a.a.request(e,t)}))}function u(t){return Object(i.a)().then((function(){var e=n.a.monitorUpdateCoverUrl.url;return a.a.post(e,{},t)}))}},d18d:function(t,e,o){"use strict";(function(t){o("2b45");var i,a=o("4360"),n=o("48f4"),r=o("162a"),l=o("e2a7"),s=o("a500"),c=o("6f9e"),u={};e.a={name:"Scroller",props:{buildingId:{type:String,default:""},hasNext:{type:Boolean,default:!1},isEmpty:{type:Boolean,default:!1},isSync:{type:Boolean,default:!0},endText:{type:String,default:""},memoryScrollTop:{type:Boolean,default:!0},keepScrollTop:{type:Boolean},hasPullDown:{type:Boolean,default:!0},onPullDown:{type:Function}},data:function(){return{pullDist:0,refreshing:!1,pulling:!1,loading:!1,scrollTop:0,isCurrKeyboard:!1,gapBottom:0}},computed:{allowPullDown:function(){return this.hasPullDown&&(!!this.$listeners.pullDown||!!this.onPullDown)},updateTime:function(){return a.a.state.global.businessDownloadTime},numberKeyboardCoverHeight:function(){return a.a.state.global.isNumberInputOpen?a.a.state.global.numberKeyboardHeight-this.gapBottom:0}},mounted:function(){var t=this;c.a.$on("numberKeyboardOpen",this.onNumberKeyboardOpen),this.$nextTick((function(){var e=t.$refs["scroll-warp"]&&t.$refs["scroll-warp"].getBoundingClientRect&&t.$refs["scroll-warp"].getBoundingClientRect();e&&(t.gapBottom=document.documentElement.clientHeight-e.bottom),t.$el&&t.$el.addEventListener("focus",(function(e){var o=e&&e.target,i=o&&o.tagName&&o.tagName.toLowerCase();if("input"===i||"textarea"===i){window.addEventListener("resize",(function e(){var i=o.getBoundingClientRect(),a=t.$el.getBoundingClientRect(),n=i.bottom-a.bottom;n>0&&t.scrollBy(n),window.removeEventListener("resize",e,!1)}),!1)}}),!0)}))},destroyed:function(){c.a.$off("numberKeyboardOpen",this.onNumberKeyboardOpen)},activated:function(){var t=this.keepScrollTop||this.$router.isBack&&this.memoryScrollTop;this.scrollTop&&t&&(this.$refs["scroll-warp"].scrollTop=this.scrollTop)},deactivated:function(){this.memoryScrollTop&&(this.scrollTop=this.$refs["scroll-warp"].scrollTop)},methods:{onScroll:function(t){var e=this,o=this.$refs["scroll-warp"].scrollTop,i=this.$refs["scroll-warp"].scrollHeight;if(o+this.$refs["scroll-warp"].clientHeight>=i-5&&!this.loading&&this.hasNext){this.loading=!0;var a=this.$listeners.loadNext();a&&a.then&&"function"==typeof a.then?a.then((function(){e.loading=!1})):this.loading=!1}this.$emit("scroll",t)},getTouchDiretion:function(t){if(!(u&&t&&t.touches&&t.touches[0]))return"";var e=t.touches[0].clientX,o=t.touches[0].clientY;return Math.abs(o-u.y)>Math.abs(e-u.x)&&Math.abs(o-u.y)>=3?o>u.y?"down":"up":""},onTouchstart:function(t){this.allowPullDown&&t.touches&&1===t.touches.length&&(u={x:t.touches[0].clientX,y:t.touches[0].clientY,scrollTop:this.$refs["scroll-warp"].scrollTop,pullDist:this.pullDist})},onTouchmove:function(t){if(this.allowPullDown&&t.touches&&1===t.touches.length){var e=this.$refs["scroll-warp"].scrollTop,o=t.touches[0].clientY,i=o-u.y,a=this.getTouchDiretion(t);"down"===a?!this.refreshing&&e<=0?(this.pulling=!0,this.pullDist=(i-u.scrollTop)/2,t.preventDefault()):this.pulling=!1:"up"===a?this.pullDist>0&&(this.pullDist=u.pullDist-(u.y-o),t.preventDefault()):this.pullDist=u.pullDist}},onTouchend:function(){var t=this;this.allowPullDown&&(u={},this.pulling=!1,this.pullDist>=70&&this.isSync?this.refreshing?this.makePullTo(70):this.makePullTo(70).then((function(){if(t.refreshing=!0,t.onPullDown){var e=t.onPullDown();e&&e.then&&"function"==typeof e?e.finally((function(){t.refreshing=!1,t.makePullTo(0)})):(t.refreshing=!1,t.makePullTo(0))}else t.dataSync().then((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")})).catch((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")}))})):(this.refreshing=!1,this.makePullTo(0)))},makePullTo:function(t){var e=this,o=this.pullDist,i=t,a=i-o,n=o;return o===i?Promise.resolve():new Promise((function(t){!function r(){window.requestAnimationFrame((function(){n+=a/6,e.pullDist=n,o<i&&n<i||o>i&&n>i?r():(e.pullDist=i,e.refreshing=!1,t())}))}()}))},dataSync:function(){var t,e=n.default.getCurrentModuleCode(),o=n.default.getCurrentRoute(),i=o.meta&&o.meta.isTodo;if(n.default.isModuleNeedBuilding(e)&&!i){if(!this.buildingId)return new Promise((function(t){setTimeout((function(){t()}),500)}));t=this.buildingId}return s.a.addTrack("公共-手动下拉刷新","",""),r.a.beginManualUpdate(),n.default.checkSync(t).then((function(t){return r.a.endManualUpdate(),t})).catch((function(t){$log.error("下拉刷新错误",t),t&&"Error: Network Error"===t.toString()?l.a.alert("当前网络无法同步数据"):l.a.alert(t),r.a.endManualUpdate()}))},getScrollHeight:function(){return this.$refs["scroll-warp"].offsetHeight},getScrollTop:function(){return this.$refs["scroll-warp"].scrollTop},setScrollTop:function(t){this.$refs["scroll-warp"].scrollTop=t},scrollBy:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=this.getScrollTop(),n=a+t,r=Math.round(o/16.7),l=t/r,s=a,c=i=+new Date;return a===n?Promise.resolve():new Promise((function(t){!function o(){window.requestAnimationFrame((function(){c===i&&(s+=l,e.$refs["scroll-warp"].scrollTop=s,a<n&&s<n||a>n&&s>n?o():(e.$refs["scroll-warp"].scrollTop=n,t()))}))}()}))},scrollTo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,o=this.getScrollTop(),i=t-o;return this.scrollBy(i,e)},scrollToEle:function(t){var e=t.keyboardHeight||232,o=(t=t.$el?t.$el:t).getBoundingClientRect(),i=this.$refs["scroll-warp"].getBoundingClientRect();if(o&&i){var n=document.documentElement.clientHeight-(a.a.state.global.isNumberInputOpen?e:0),r=i.bottom<n?i.bottom:n,l=i.top-o.top,s=o.bottom-r;l>0?this.scrollBy(-l-10):s>0&&this.scrollBy(s+10)}},isCurrent:function(e,o){var i=this;e.length&&t.each(e,(function(t){t._uid===o?i.isCurrKeyboard=!0:i.isCurrent(t.$children,o)}))},onNumberKeyboardOpen:function(t){this.isCurrKeyboard=!1,this.isCurrent(this.$children,t._uid),this.isCurrKeyboard&&this.scrollToEle(t)}}}}).call(this,o("391c"))},e1a3:function(t,e,o){"use strict";o("87e6")},ef48:function(t,e,o){var i=o("9d55");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,o("85cb").default)("a1a65c0c",i,!0,{sourceMap:!1,shadowMode:!1})},f24e:function(t,e,o){"use strict";(function(t){o("5ab2"),o("6d57"),o("e10e");var i=o("28f8"),a=(o("9a33"),o("e3ee")),n=o("cba0"),r=o("4ad6"),l=o("e2a7"),s=o("162a"),c=o("24de"),u=o("a18c");function p(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,i)}return o}function d(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?p(Object(o),!0).forEach((function(e){Object(i.a)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var f={200:"操作成功",10001:"参数错误",10002:"accessToken异常或过期",10004:"用户不存在",10005:"appKey异常",10017:"appKey不存在",20002:"设备不存在",20007:"设备不在线",20014:"deviceSerial不合法",20018:"该用户不拥有该设备",20032:"该用户下通道不存在",60020:"不支持该命令",60060:"地址未绑定",49999:"数据异常"},h={0:"未使用或直播已关闭",1:"使用中",2:"已过期",3:"直播已暂停"},g={0:"正常",1:"设备不在线",2:"设备开启视频加密",3:"设备删除",4:"失效",5:"未绑定",6:"账户下流量已超出"};function m(e){if(t.get(e,"id")&&t.get(e,"cover_url")){var o={id:e.id,cover_url:e.cover_url};Object(n.d)(o)}else console.error("上传视频封面参数不完整")}e.a={getPointData:function(t){return Object(n.a)({proj_id:t}).then((function(t){if(t){var e=t.point_info||[];return{url:t.house_type_img,points:e.map((function(t){var e=t.location&&t.location.split(",")||[],o=Object(a.a)(e,2),i=o[0],n=o[1];return d(d({},t),{},{x:i,y:n})}))}}}))},uploadVideoImage:m,getVideoDetail:function(e){return t.isEmpty(e)?l.a.alert("获取视频地址失败"):Object(n.b)({url:e}).then((function(t){return t&&-1!==t.code?t:(t&&t.message&&l.a.alert(t.message),null)})).catch((function(t){return console.log("获取萤石云数据失败",t),Promise.reject(null)}))},playHik:function(t){u.a.push({name:"VideoMonitorPlay",params:{url:t.url,title:t.title}})},playUrl:function(t){u.a.push({name:"VideoMonitorPlay",params:{url:t.url,title:t.title}})},playGld:function(t){return c.a.checkHasNetwork().then((function(){return r.a.openUrl(t.data)}))},playYsy:function(t){if(!t.data)return l.a.alert("萤石云获取参数失败，请重试");var e=d(d({},t),t.data);if(delete e.data,"200"===e.ret)if(1===e.status){if(0===e.exception){var o={appkey:e.appKey,accessToken:e.accessToken,deviceSerial:e.deviceSerial,cameraNo:e.channelNo},i=r.a.appImagePath()+"monitor/"+e.deviceSerial+".jpg";return o.path=i,r.a.openVideoMonitor(o).then((function(e){e=e||i,s.a.uploadFile(e).then((function(e){console.log("url",e),t.cover_url=e,m(t)}))}))}var a=g[e.exception]||e.desc||"数据错误";l.a.alert(a)}else{var n=h[e.status]||e.desc||"数据错误";l.a.alert(n)}else{var c=f[e.ret]||e.desc||"数据错误";l.a.alert(c)}}}}).call(this,o("391c"))}}]);