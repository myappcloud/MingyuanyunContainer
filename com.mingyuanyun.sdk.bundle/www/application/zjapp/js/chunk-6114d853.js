(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-6114d853"],{"2c76":function(t,e,a){"use strict";a("c070")},"3c64":function(t,e,a){"use strict";a("163d");var i={name:"ItemTextarea",components:{},props:{value:{type:String,default:""},placeholder:{type:String,default:""},maxlength:{type:Number,default:200},borderBottom:{type:Boolean,default:!0}},data:function(){return{textareaHeight:40,isLock:!1,blurTime:null}},computed:{lastLength:function(){var t=this.value&&this.value.length||0,e=this.maxlength-t;return e>0?e:0}},mounted:function(){var t=this;this.$nextTick((function(){t.textareaHeight=t.$refs.rule&&t.$refs.rule.offsetHeight||40}))},methods:{onfocus:function(){var t=(new Date).getTime();this.blurTime&&t-this.blurTime<300&&window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(this.$refs.input.blur(),window.cordova.plugins.Keyboard.close()),this.blurTime=null,this.$emit("focus")},onblur:function(){this.blurTime=(new Date).getTime(),this.$emit("blur")},setStatus:function(t){console.log(t),this.isLock=t},oninput:function(t){var e=this;setTimeout((function(){if(!e.isLock){var a=t.target.value;a.length>e.maxlength&&(a=a.substring(0,e.maxlength),e.$refs.input.value=a),e.$refs.rule.innerText=a,e.textareaHeight=e.$refs.rule&&e.$refs.rule.offsetHeight+20,e.$emit("input",a),e.$emit("change",a)}}),0)}}},s=(a("2c76"),a("17cc")),o=Object(s.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"item-textarea",class:{"border-bottom":t.borderBottom}},[a("div",{staticClass:"item-textarea-content"},[a("textarea",{ref:"input",style:{height:t.textareaHeight+"px"},attrs:{placeholder:t.placeholder},domProps:{value:t.value},on:{focus:t.onfocus,blur:t.onblur,compositionstart:function(e){t.setStatus(!0)},compositionend:function(e){t.setStatus(!1)},input:t.oninput}}),a("div",{ref:"rule",staticClass:"rule"},[t._v("\n      "+t._s(t.value)+"\n    ")]),t.maxlength!==1/0?a("p",{staticClass:"counter"},[t._v("\n      "+t._s(t.lastLength)+"\n    ")]):t._e()])])}),[],!1,null,null,null);e.a=o.exports},"48a3":function(t,e,a){"use strict";a.r(e);var i=a("6dec").a,s=(a("8523"),a("17cc")),o=Object(s.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-content",{attrs:{title:t.title,"show-go-root":!t.isReport||"Report"}},[t.isLoading?t._e():a("scroller",["add"===t.type?[a("item",{attrs:{mode:"edit",label:"消杀时间",text:t._f("formatDate")(t.params.dis_time),editabled:!0},on:{click:t.setStartDate}}),a("item",{attrs:{mode:"edit",label:"消杀地点"}},[a("template",{slot:"right"},[a("div",{staticClass:"item-con"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.params.dis_site,expression:"params.dis_site"}],staticClass:"location-place-input",attrs:{type:"text",placeholder:"请输入",maxlength:"20"},domProps:{value:t.params.dis_site},on:{input:function(e){e.target.composing||t.$set(t.params,"dis_site",e.target.value)}}})])])],2),a("item",{attrs:{mode:"edit",label:"消杀人员"}},[a("template",{slot:"right"},[a("div",{staticClass:"item-con"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.params.dis_personnel,expression:"params.dis_personnel"}],staticClass:"location-place-input",attrs:{type:"text",placeholder:"请输入",maxlength:"20"},domProps:{value:t.params.dis_personnel},on:{input:function(e){e.target.composing||t.$set(t.params,"dis_personnel",e.target.value)}}})])])],2),a("div",{staticClass:"bg-white"},[[a("item",{staticClass:"mt10",attrs:{text:"消杀照片"}},[a("i",{staticClass:"icon-point",attrs:{slot:"icon-left"},slot:"icon-left"})]),a("item",{staticClass:"pt0 pb15"},[a("item-img-list",{attrs:{maxlength:15,"allow-select-album":!0,"allow-buildin-album":!0},model:{value:t.params.dis_image,callback:function(e){t.$set(t.params,"dis_image",e)},expression:"params.dis_image"}})],1)]],2),a("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"备注"},model:{value:t.params.remark,callback:function(e){t.$set(t.params,"remark",e)},expression:"params.remark"}})]:t._e(),"detail"===t.type?[a("div",{staticClass:"status-title van-hairline--bottom"},[t._v("已消杀")]),a("item",{attrs:{label:"消杀时间",text:t._f("formatDate")(t.detail.dis_time)}}),a("item",{attrs:{label:"消杀地点",text:t.detail.dis_site}}),a("item",{attrs:{label:"消杀人员",text:t.detail.dis_personnel}}),a("item",{attrs:{label:"消杀照片"}},[a("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[a("item-img-list",{attrs:{editabled:!1},model:{value:t.detail.dis_image,callback:function(e){t.$set(t.detail,"dis_image",e)},expression:"detail.dis_image"}})],1)]),a("item",{directives:[{name:"show",rawName:"v-show",value:t.detail.remark,expression:"detail.remark"}],attrs:{label:"备注",text:t.detail.remark}}),a("user-select",{attrs:{title:"提交人",mode:"view",date:t._f("formatDate")(t.detail.created_on),editabled:!1},model:{value:t.detail.created_by,callback:function(e){t.$set(t.detail,"created_by",e)},expression:"detail.created_by"}})]:t._e()],2),t.isShowSelDate?a("van-popup",{attrs:{position:"bottom"},model:{value:t.isShowSelDate,callback:function(e){t.isShowSelDate=e},expression:"isShowSelDate"}},[a("van-datetime-picker",{attrs:{type:"datetime","max-date":t.maxRegistDate,title:"消杀时间"},on:{confirm:t.selDate,cancel:t.cancelDate},model:{value:t.currentRigistDate,callback:function(e){t.currentRigistDate=e},expression:"currentRigistDate"}})],1):t._e(),"add"!==t.type||t.isLoading?t._e():a("app-button-group",{attrs:{"fixed-bottom":""}},[a("app-button",{on:{click:t.submit}},[t._v("提交")])],1),a("loading-status",{attrs:{"is-loading":t.isLoading}})],1)}),[],!1,null,"36005324",null);e.default=o.exports},"574c":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .item-textarea{background-color:#fff;padding:5px 15px}.zjapp .item-textarea-content{position:relative}.zjapp .item-textarea .rule,.zjapp .item-textarea textarea{width:100%;min-height:40px;line-height:20px;font-size:16px;padding:0;border:none}.zjapp .item-textarea .rule{position:absolute;top:0;left:0;visibility:hidden;word-break:break-all}.zjapp .item-textarea .counter{text-align:right;margin:0 0 -5px 0;height:15px;line-height:15px;color:#b2b2b2;font-size:12px}",""])},"6b9b":function(t,e,a){var i=a("a8b8");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("463291b8",i,!0,{sourceMap:!1,shadowMode:!1})},"6dec":function(t,e,a){"use strict";(function(t){a("5ab2"),a("e10e"),a("f548"),a("6d57"),a("06a2");var i=a("28f8"),s=a("e2a7"),o=a("3bd5"),n=a("774b"),r=a("6bf2"),l=a.n(r),c=a("07d2"),d=a("e68e"),u=a("3c64"),p=a("cd05"),m=a("7cb8"),f=a("3122"),h=a("162a"),g=a("1b7e"),b=a("6144");function v(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function x(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?v(Object(a),!0).forEach((function(e){Object(i.a)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}e.a={name:"NcovDisinfectDetail",components:{Scroller:n.default,Item:c.default,ItemImgList:d.a,ItemTextarea:u.a,UserSelect:p.a},data:function(){return{isLoading:!0,isReport:!1,type:"add",title:"...",projId:"",sectionId:"",params:{},detail:{},isShowSelDate:!1,currentRigistDate:new Date,maxRegistDate:new Date}},activated:function(){var t=this.$route.query,e=t.id,a=t.projId,i=t.sectionId,s=t.type,o=t.isReport;this.type=s,this.isReport=o,this.projId=a||this.$store.state.global.currentProject.id,this.title="add"===s?"新增消杀记录":"防疫消杀";var n=b.a.getObject("ncov-index-section-default"+this.projId,b.a.level.user)||{};this.sectionId=i||n.id,this.isLoading="detail"===s,"add"===s?this.defaultData():this.getRecordData(e)},methods:{defaultData:function(){var t=o.a.getUser().user_name,e=l()(new Date).format("YYYY-MM-DD HH:mm:ss");this.params={dis_personnel:t,dis_site:"",dis_image:[],dis_time:e,remark:""}},getRecordData:function(t){var e=this;h.a.request("/online/ncov-disinfection/get-disinfection-node",{id:t}).then((function(t){console.log({res:t}),t&&(e.detail=x(x({},t),{},{dis_image:JSON.parse(t.dis_image||"[]")}))})).catch((function(t){e.detail={},e.errorType="error",s.a.alert(t)})).finally((function(){e.isLoading=!1}))},setStartDate:function(){this.currentRigistDate=new Date,this.maxRegistDate=new Date,this.isShowSelDate=!0},selDate:function(t){this.isShowSelDate=!1,this.params.dis_time=l()(t).format("YYYY-MM-DD HH:mm:ss"),console.log(this.params)},cancelDate:function(){this.isShowSelDate=!1},uploadImages:function(){var e=[];return t.each(this.params.dis_image,(function(t){!t.url&&t.temp&&e.push(f.a.uploadImage(t.temp).then((function(e){t.url=e}))),!t.videoUrl&&t.videoTemp&&e.push(f.a.uploadImage(t.videoTemp).then((function(e){t.videoUrl=e})))})),Promise.all(e)},submit:function(){var e=this,a=this.params,i=a.dis_time,o=a.dis_site,n=a.dis_personnel,r=a.remark,l=a.dis_image;if(!i)return s.a.alert("请填写消杀时间");if(!o)return s.a.alert("请填写消杀地点");if(!n)return s.a.alert("请填写消杀人员");if(!l.length)return s.a.alert("请添加消杀照片");console.log("this.params",this.params),s.a.loading("正在提交...");try{return g.a.getHasNetwork().then((function(t){if(!t)return Promise.reject({errmsg:"当前无网络连接"})})).then((function(){return s.a.loading("正在提交..."),e.uploadImages()})).then((function(){var a=Object(m.o)(t.map(e.params.dis_image,(function(t){var e=x({},t);return delete e.thumbnail,delete e.temp,delete e.videoTemp,e}))),l={proj_id:e.projId,bidsection_id:e.sectionId,dis_time:i,dis_site:o,dis_personnel:n,remark:r,dis_image:a};return console.log(l),h.a.post("/online/ncov-disinfection/save-disinfection",null,l).then((function(t){console.log({res:t}),setTimeout((function(){s.a.hideLoading(),s.a.alert("提交成功"),e.$router.replace({name:"NcovDisinfectIndex",query:{sectionId:e.sectionId}})}),1e3)})).catch((function(t){$log.log(t),setTimeout((function(){s.a.hideLoading(),s.a.alert(t)}),1e3)}))})).catch((function(t){s.a.hideLoading(),s.a.alert(t.errmsg||"提交失败"),console.error(t)}))}catch(t){console.log(t)}}}}}).call(this,a("391c"))},8523:function(t,e,a){"use strict";a("6b9b")},a8b8:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .item-con input[data-v-36005324]{width:100%;text-align:right}.zjapp .status-title[data-v-36005324]{position:relative;height:46px;padding:0 27px;line-height:46px;background-color:#fff;color:#333;font-size:16px}.zjapp .status-title[data-v-36005324]:before{content:"";position:absolute;top:15px;left:15px;width:4px;height:16px;background:#0bc666}',""])},c070:function(t,e,a){var i=a("574c");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("35590dcb",i,!0,{sourceMap:!1,shadowMode:!1})}}]);