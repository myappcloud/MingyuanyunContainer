(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-436a2aa8","chunk-2d0d2f53","chunk-2709989a","chunk-2d2263f6"],{"017a":function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .item[data-v-1a7b90ef]{align-items:center}.zjapp .icon[data-v-1a7b90ef]{color:#4275e8}.zjapp .item>[class*=icon-checkbox][data-v-1a7b90ef]{margin-right:10px}.zjapp .item-disabled>[class*=icon-checkbox][data-v-1a7b90ef]{color:#b2b2b2;background-color:#b2b2b2}",""])},"024b":function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,'.zjapp .item-log[data-v-92a9a1d0]{position:relative;margin-left:54px;padding:15px 15px 15px 0}.zjapp .item-log .hd[data-v-92a9a1d0]{display:flex}.zjapp .title[data-v-92a9a1d0]{flex:1;color:#333}.zjapp .date[data-v-92a9a1d0],.zjapp .title[data-v-92a9a1d0]{line-height:22px;font-size:16px}.zjapp .date[data-v-92a9a1d0]{padding:0 10px;color:#999}.zjapp .icon-toggle[data-v-92a9a1d0]{line-height:22px;font-size:14px}.zjapp .remark[data-v-92a9a1d0]{font-size:14px;color:#666;line-height:18px}.zjapp .icon-status[data-v-92a9a1d0]{position:absolute;z-index:2;left:-44px;top:9px;padding:10px;background-color:#fff}.zjapp .icon-status[data-v-92a9a1d0]:before{content:"";display:block;width:14px;height:14px;border:2px solid #999;border-radius:7px}.zjapp .icon-status-blue[data-v-92a9a1d0]:before{border-color:#1f93fe}.zjapp .icon-status-green[data-v-92a9a1d0]:before{border-color:#3db641}.zjapp .icon-status-red[data-v-92a9a1d0]:before{border-color:#ff3c46}.zjapp .icon-status-gray[data-v-92a9a1d0]:before{border-color:#999}.zjapp .line-progress[data-v-92a9a1d0]{position:absolute;z-index:1;left:-28px;top:0;bottom:0;width:2px;background-color:#cad5ec}.zjapp .item-log[data-v-92a9a1d0]:last-child{background-image:none}.zjapp .item-log:first-child .line-progress[data-v-92a9a1d0]{top:26px}.zjapp .item-log:last-child .line-progress[data-v-92a9a1d0]{height:9px;bottom:auto}.zjapp .text-change[data-v-92a9a1d0]{padding:0 10px;color:#c8c8c8}',""])},"0aac":function(e,t,a){"use strict";a("2814")},"105d":function(e,t,a){var i=a("99f0");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("e4faa610",i,!0,{sourceMap:!1,shadowMode:!1})},"14dd":function(e,t,a){"use strict";a("3a38")},"1a09":function(e,t,a){"use strict";a("4e60")},"1bb9":function(e,t,a){var i=a("024b");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("e6d471ce",i,!0,{sourceMap:!1,shadowMode:!1})},"1d0a":function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .weiget-box[data-v-5920a10e]{display:flex;flex:1;flex-direction:column;overflow:hidden}[data-v-5920a10e] .app-search-bar .border-bottom{background-image:none}",""])},"1f8b":function(e,t,a){"use strict";a("7fa9")},2258:function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .body-box[data-v-8dab4862]{display:flex;flex-direction:column;width:100%;flex:1}",""])},2814:function(e,t,a){var i=a("5033");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("9db19832",i,!0,{sourceMap:!1,shadowMode:!1})},"2a54":function(e,t,a){var i=a("d77c");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("a2ffe54e",i,!0,{sourceMap:!1,shadowMode:!1})},"2c76":function(e,t,a){"use strict";a("c070")},"2dd6":function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .single-item[data-v-6920dde7]{min-height:44px}.zjapp .single-item>div[data-v-6920dde7]{display:flex}.zjapp .single-item>div>span[data-v-6920dde7]{flex:1;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical}.zjapp .single-item>div>span[data-v-6920dde7] label{color:#4174e9}.zjapp .single-item i[data-v-6920dde7]{line-height:24px;font-size:24px;color:#4275e8}.zjapp .single-item .disabled-item[data-v-6920dde7]{color:#aaa}",""])},"3156b":function(e,t,a){"use strict";a("163d");var i={name:"SingleSelectItem",props:{item:{type:Object,default:function(){return{id:"",name:""}}},checked:{type:Boolean,default:!1},renderField:{type:String,default:"name"},lineLimit:{type:[Number,String],default:1}},methods:{selectItem:function(e){e.disabled||this.$emit("click",e)}}},r=(a("9788"),a("17cc")),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("van-cell",{staticClass:"single-item",attrs:{clickable:!0},on:{click:function(t){e.selectItem(e.item)}}},[a("span",{class:{"disabled-item":e.item.disabled},style:{"-webkit-line-clamp":"unlimited"===e.lineLimit?"initial":e.lineLimit},domProps:{innerHTML:e._s(e.item[e.renderField])}}),e.checked?a("van-icon",{attrs:{name:"success"}}):e._e()],1)}),[],!1,null,"6920dde7",null);t.a=n.exports},3480:function(e,t,a){"use strict";(function(e){a("5ab2"),a("6d57"),a("e10e");var i=a("28f8"),r=a("e2a7"),n=a("e89f"),s=a("07d2"),o=a("3c64"),c=a("e68e");function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}t.a={name:"ProblemBack",components:{Item:s.default,ItemTextarea:o.a,ItemImgList:c.a},mixins:[n.a],props:{},data:function(){return{show:!1,multiple:!1,reasonList:[],reason:{},remark:"",images:[],placeholder:"补充说明",isBack:!1,photoRequest:"",allowSelectAlbum:void 0,allowBuildinAlbum:void 0}},methods:{openPopup:function(t){t.reasonList?this.reasonList=e.clone(t.reasonList):this.reasonList=[{id:1,text:"整改不合格"},{id:2,text:"其它",remarkRequire:!0}],this.isBack=t.isBack||!1,this.reason=e.clone(t.reason)||{},this.images=e.map(t.images,(function(e){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)})),this.remark=t.remark||"",this.placeholder=t.placeholder?t.placeholder:"补充说明",this.multiple=t.multiple,e.isEmpty(t.reasonList)||(this.reasonList=e.clone(t.reasonList)),this.callback=t.callback,this.beforeCallback=t.beforeCallback,this.photoRequest=t.photoRequest||"",t.allowSelectAlbum&&(this.allowSelectAlbum=Boolean(t.allowSelectAlbum)),t.allowBuildinAlbum&&(this.allowBuildinAlbum=Boolean(t.allowBuildinAlbum)),this.value=!0,this.show=!0,this.$emit("open")},closePopup:function(){this.value=!1,this.show=!1,this.$emit("close")},selectItem:function(e){this.multiple?this.$set(e,"checked",!e.checked):this.reason=e},submit:function(){var t=this;if(this.multiple){if(this.reason=e.filter(this.reasonList,{checked:!0}),e.isEmpty(this.remark))return void r.a.alert("补充说明必填")}else{if(e.isUndefined(this.reason.id))return void r.a.alert("请填写退回原因");if(this.reason.remarkRequire&&e.isEmpty(this.remark))return void r.a.alert("补充说明必填");if(this.photoRequest&&e.isEmpty(this.images))return void r.a.alert("请拍摄退回照片")}var a={reason:this.reason,remark:this.remark,images:this.images},i=!this.beforeCallback||this.beforeCallback(a);i&&i.then&&e.isFunction(i.then)?i.then((function(e){!1!==e&&(t.callback&&t.callback(a),t.closePopup())})):!1!==i&&(this.callback&&this.callback(a),this.closePopup())}}}}).call(this,a("391c"))},"34b6":function(e,t,a){"use strict";var i=a("d23f").a,r=(a("c6cf"),a("17cc")),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("popup-has-header",{attrs:{height:"93%",title:e.title},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e.multi?a("template",{slot:"header_left"},[a("span",{staticClass:"f-gray",on:{click:e.closeEvent}},[e._v("取消")])]):e._e(),a("template",{slot:"header_right"},[e.multi?a("div",{staticClass:"f-blue",attrs:{slot:"header-bar-right"},on:{click:e.onConfirm},slot:"header-bar-right"},[e._v("\n        确定("+e._s(e.selected.length)+")\n      ")]):e._e()]),a("template",{slot:"body_main"},[a("div",{staticClass:"body-box"},[a("app-search-bar",{ref:"app-search-bar",attrs:{placeholder:"搜索","history-key":e.storageKey},on:{changeSearchStatus:e.onSearchTypeChange},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),!e.searchStatus||e.searchStatus&&e.keyword?[e.multi&&e.selected.length?a("div",{ref:"select-box",staticClass:"selected"},[a("label",{staticClass:"selected-label"},[e._v("已选：")]),a("div",{staticClass:"select_result"},e._l(e.selected,(function(t){return a("span",{key:t.id,staticClass:"selected-item",class:{"selected-item-disabled":t.disabled}},[e._v("\n                "+e._s(t.name)+"\n                "),a("icon",{staticClass:"selected-remove",attrs:{name:"unqualified"},on:{click:function(a){e.onSelectUser(t)}}})],1)})))]):e._e(),!e.searchStatus||e.searchStatus&&e.keyword?a("van-tabs",{model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},e._l(e.roleGroup,(function(t){return a("van-tab",{key:t.id,attrs:{title:t.name}},[a("div",{staticClass:"tab-box",style:"height: "+e.maxScrollHeight+"px;"},[e.canSelectAllRole&&t.children&&t.children.length?a("item",{key:-1,attrs:{text:"全选",border:"bottom"}},[a("icon",{attrs:{slot:"icon-right",name:e.allRoleSelected?"checkbox-checked":"checkbox"},on:{click:function(t){return t.stopPropagation(),e.selectAllRole(t)}},slot:"icon-right"})],1):e._e(),31===t.id&&e.contractorGroup&&e.contractorGroup.length?[e._l(e.contractorGroup,(function(t){return[a("item",{key:t.id,attrs:{text:t.name,border:"bottom"},on:{click:function(a){e.toggleGroup(t)}}},[a("icon",{staticClass:"triangle",class:{"triangle-down":e.openSet[t.id]},attrs:{slot:"icon-left",name:"triangle-right"},slot:"icon-left"}),e.multi?a("icon",{attrs:{slot:"icon-right",name:e.groupSelectedSet[t.id]?"checkbox-checked":"checkbox"},on:{click:function(a){a.stopPropagation(),e.selectedAll(t)}},slot:"icon-right"}):e._e()],1),e.openSet[t.id]?e._l(t.children,(function(i){return a("user-item",{key:t.id+i.id,staticClass:"item-data",attrs:{"head-portrait":e.getImageThumbnail(i.head_portrait),name:i.name,post:i.post,keyword:e.keyword,multi:e.multi,selected:e.selectedSet[i.id],disabled:e.disabledSet[i.id]},on:{click:function(t){e.onSelectUser(i)}}})})):e._e()]}))]:e._l(t.children,(function(t){return a("user-item",{key:t.id,staticClass:"item-data",attrs:{"head-portrait":e.getImageThumbnail(t.head_portrait),name:(t.role_name||"")+t.name,post:t.post,keyword:e.keyword,multi:e.multi,selected:e.selectedSet[t.id],disabled:e.disabledSet[t.id]},on:{click:function(a){e.onSelectUser(t)}}})})),a("loading-status",{attrs:{"is-empty":!t.children.length,"empty-text":Boolean(e.keyword)&&t.id?"没有查询到结果":"暂无数据",type:Boolean(e.keyword)?"search":"common"}})],2)])}))):e._e()]:e._e()],2)])],2)],1)}),[],!1,null,"3ce9ba4e",null);t.a=n.exports},3518:function(e,t,a){var i=a("5454");(e.exports=a("690e")(!1)).push([e.i,".zjapp .item-user-unit[data-v-43750b3d]{position:relative;display:inline-block;vertical-align:top;font-size:0}.zjapp .item-user-unit.bg[data-v-43750b3d]{background:#f4f4f4;border-radius:4px;padding-left:6px;margin:0 5px 5px}.zjapp .item-user-name[data-v-43750b3d]{font-size:16px;display:inline-block;vertical-align:middle}.zjapp .icon-im-btn[data-v-43750b3d]{position:relative;z-index:5;display:inline-block;vertical-align:middle;width:34px;height:22px;background:url("+i(a("f77a"))+") no-repeat 6px;background-size:16px 10px}.zjapp .popup-user-im[data-v-43750b3d]{position:absolute;z-index:5;bottom:30px;left:50%;margin-left:-65px;padding:0 5px;width:130px;height:60px;background-color:rgba(0,0,0,.8);border-radius:5px}.zjapp .popup-user-im-item[data-v-43750b3d]{float:left;width:60px;height:60px;text-align:center;color:#fff;padding-top:10px}.zjapp .popup-user-im-item.disabled[data-v-43750b3d]{color:#666}.zjapp .popup-user-im-arrow[data-v-43750b3d]{position:absolute;bottom:-5px;left:50%;margin-left:-5px;border:5px solid transparent;border-bottom:none;border-top-color:rgba(0,0,0,.8)}.zjapp .popup-user-im-icon[data-v-43750b3d]{display:block;font-size:21px}.zjapp .popup-user-im-text[data-v-43750b3d]{font-size:12px;line-height:16px;margin-top:4px}.zjapp .popup-user-posi-bottom[data-v-43750b3d]{bottom:auto;top:30px}.zjapp .popup-user-posi-bottom .popup-user-im-arrow[data-v-43750b3d]{top:-5px;bottom:auto;border-top:none;border-bottom:5px solid rgba(0,0,0,.8)}",""])},37478:function(e,t,a){"use strict";var i=a("d866").a,r=a("17cc"),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("item",{class:e.required,attrs:{label:e.title,text:e.value&&e.value.id?e.value.name:"view"===e.mode?"无":"",mode:e.mode,editabled:e.editabled,placeholder:e.required?e.placeholder||"请选择":"选填","form-check":e.formCheck,border:e.border},on:{click:e.openSelect}}),a("popup-single-select",{ref:"popup-single-select"})],1)}),[],!1,null,null,null);t.a=n.exports},"3a38":function(e,t,a){var i=a("755b");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("4f2485ca",i,!0,{sourceMap:!1,shadowMode:!1})},"3c64":function(e,t,a){"use strict";a("163d");var i={name:"ItemTextarea",components:{},props:{value:{type:String,default:""},placeholder:{type:String,default:""},maxlength:{type:Number,default:200},borderBottom:{type:Boolean,default:!0}},data:function(){return{textareaHeight:40,isLock:!1,blurTime:null}},computed:{lastLength:function(){var e=this.value&&this.value.length||0,t=this.maxlength-e;return t>0?t:0}},mounted:function(){var e=this;this.$nextTick((function(){e.textareaHeight=e.$refs.rule&&e.$refs.rule.offsetHeight||40}))},methods:{onfocus:function(){var e=(new Date).getTime();this.blurTime&&e-this.blurTime<300&&window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(this.$refs.input.blur(),window.cordova.plugins.Keyboard.close()),this.blurTime=null,this.$emit("focus")},onblur:function(){this.blurTime=(new Date).getTime(),this.$emit("blur")},setStatus:function(e){console.log(e),this.isLock=e},oninput:function(e){var t=this;setTimeout((function(){if(!t.isLock){var a=e.target.value;a.length>t.maxlength&&(a=a.substring(0,t.maxlength),t.$refs.input.value=a),t.$refs.rule.innerText=a,t.textareaHeight=t.$refs.rule&&t.$refs.rule.offsetHeight+20,t.$emit("input",a),t.$emit("change",a)}}),0)}}},r=(a("2c76"),a("17cc")),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-textarea",class:{"border-bottom":e.borderBottom}},[a("div",{staticClass:"item-textarea-content"},[a("textarea",{ref:"input",style:{height:e.textareaHeight+"px"},attrs:{placeholder:e.placeholder},domProps:{value:e.value},on:{focus:e.onfocus,blur:e.onblur,compositionstart:function(t){e.setStatus(!0)},compositionend:function(t){e.setStatus(!1)},input:e.oninput}}),a("div",{ref:"rule",staticClass:"rule"},[e._v("\n      "+e._s(e.value)+"\n    ")]),e.maxlength!==1/0?a("p",{staticClass:"counter"},[e._v("\n      "+e._s(e.lastLength)+"\n    ")]):e._e()])])}),[],!1,null,null,null);t.a=n.exports},"409b":function(e,t,a){"use strict";(function(e){a("5ab2"),a("6d57"),a("e10e");var i=a("28f8"),r=a("e2a7"),n=a("e89f"),s=a("07d2"),o=a("3c64"),c=a("e68e");function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}t.a={name:"ProblemBack",components:{Item:s.default,ItemTextarea:o.a,ItemImgList:c.a},mixins:[n.a],props:{},data:function(){return{show:!1,reasonList:[],hasImages:!1,fixedRemark:!1,reason:{id:"",text:""},images:[],remark:""}},methods:{openPopup:function(t){e.isEmpty(t.reasonList)?this.reasonList=[{id:1,text:"问题登记错误"},{id:2,text:"已整改并复验通过"},{id:4,text:"无法整改"},{id:5,text:"延误整改窗口期"},{id:6,text:"留待后期整改"},{id:3,text:"其它",remarkRequire:!0}]:this.reasonList=e.clone(t.reasonList),this.callback=t.callback,this.beforeCallback=t.beforeCallback,this.value=!0,this.show=!0,e.isEmpty(t.reason)?(this.reason.id="",this.reason.text=""):(this.reason.id=t.reason.id,this.reason.text=t.reason.text),this.images=e.map(t.images,(function(e){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)})),this.remark=t.remark||"",this.hasImages=!!t.hasImages,this.fixedRemark=!!t.fixedRemark,this.$emit("open")},closePopup:function(){this.value=!1,this.show=!1,this.$emit("close")},selectItem:function(e){this.reason=e},submit:function(){var t,a=this,i="";if(this.reason&&this.reason.id)i=this.reason.text;else if(""===this.remark)return void r.a.alert("请选择关闭原因");if(this.reason.remarkRequire){if(""===this.remark)return void r.a.alert("请输入关闭原因");i=this.remark}t=this.hasImages?{reason:this.reason,remark:this.remark,images:this.images}:i;var n=!this.beforeCallback||this.beforeCallback(t);n&&n.then&&e.isFunction(n.then)?n.then((function(e){!1!==e&&(a.callback&&a.callback(t),a.closePopup())})):!1!==n&&(this.callback&&this.callback(t),this.closePopup())}}}}).call(this,a("391c"))},4164:function(e,t,a){"use strict";var i=a("329b"),r=a("e9fe").a,n=(a("6fe3"),a("17cc")),s=Object(n.a)(r,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"slide-right"}},[e.show?a("page-content",{attrs:{mode:"dialog",title:e.title,"on-close":e.close}},[a("scroller",{attrs:{"is-empty":e.isLoading||!e.logs.length}},[e.isLoading?e._e():a("div",{staticClass:"bg-white"},e._l(e.logs,(function(t){return a("div",{key:t.id,staticClass:"item-log border-bottom"},[a("div",{staticClass:"icon-status",class:"icon-status-"+t.statusColor}),a("div",{staticClass:"line-progress"}),a("div",{staticClass:"hd",on:{click:function(a){e.toggleLog(t)}}},[a("div",{staticClass:"title"},[e._v(e._s(t.event))]),a("div",{staticClass:"date"},[e._v(e._s(e._f("formatDate")(t.operation_time,"YYYY-MM-DD HH:mm")))]),a("icon",{staticClass:"icon-toggle",attrs:{name:t.isOpen?"arrow-up":"arrow-down"}})],1),t.isOpen?a("div",{staticClass:"bd"},[a("user-contact",{staticClass:"mt10",attrs:{list:t.user}}),t.images&&t.images.length?a("item-img-list",{staticClass:"mt5",attrs:{editabled:!1},model:{value:t.images,callback:function(a){e.$set(t,"images",a)},expression:"log.images"}}):e._e(),t.oldValue||t.newValue?a("div",{staticClass:"remark mt10"},["修改分数"===t.event?a("span",[e._v("扣分:")]):e._e(),e._v(e._s(t.oldValue)+"\n              "),a("span",{staticClass:"text-change"},[e._v("变更")]),e._v(" "+e._s(t.newValue)+"\n            ")]):e._e(),t.diff.remark||t.diff.desc?a("div",{staticClass:"remark mt10"},[e._v("\n              "+e._s(t.diff.desc||"")+e._s(t.diff.remark?t.diff.desc?"（"+t.diff.remark+"）":t.diff.remark:"")+"\n            ")]):e._e()],1):e._e()])}))),a("loading-status",{attrs:{"is-loading":e.isLoading,"is-empty":!e.logs.length,"empty-text":e.emptyTips}})],1)],1):e._e()],1)}),[],!1,null,"92a9a1d0",null).exports,o=!1;o||(o=new(i.default.extend(s))({el:document.createElement("div")}),document.body.appendChild(o.$el));var c=o,l={name:"BusinessLogs",props:{id:{type:String,default:""},title:{type:String,default:"整改销项日志"}},data:function(){return{}},methods:{showLogs:function(){c.open({id:this.id,title:this.title})}}},d=Object(n.a)(l,(function(){var e=this.$createElement,t=this._self._c||e;return this.$slots.default?t("div",{on:{click:this.showLogs}},[this._t("default")],2):t("div",{staticClass:"header-btn",on:{click:this.showLogs}},[t("icon",{attrs:{name:"logs"}})],1)}),[],!1,null,null,null);t.a=d.exports},4460:function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .item-text[data-v-74990eb9]{padding:2px 0;margin-bottom:-4px}.zjapp .item-text .bg[data-v-74990eb9]{display:inline-block;background:#f4f4f4;border-radius:4px;padding:3px 6px;margin-bottom:4px}.zjapp .item-text .bg+.bg[data-v-74990eb9]{margin-left:4px}",""])},"4e60":function(e,t,a){var i=a("3518");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("6d528d9e",i,!0,{sourceMap:!1,shadowMode:!1})},5033:function(e,t,a){var i=a("5454");(e.exports=a("690e")(!1)).push([e.i,".zjapp .drawing-con[data-v-fba5990a]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;font-size:0;line-height:0}.zjapp .drawing-con canvas[data-v-fba5990a]{display:block;height:100%;width:100%;background:url("+i(a("eb66"))+") #fff;background-size:4px 4px}.zjapp .loading-text[data-v-fba5990a]{margin-top:15px;color:#aaa}.zjapp .error-text[data-v-fba5990a],.zjapp .loading-text[data-v-fba5990a]{padding:0 15px;line-height:20px;text-align:center;font-size:16px}.zjapp .error-text[data-v-fba5990a]{color:#ff3d3d}",""])},"528f":function(e,t,a){"use strict";var i=a("8e75").a,r=(a("f4c1"),a("17cc")),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("item",{attrs:{label:e.title,mode:e.mode,editabled:e.editabled,border:e.border},on:{click:e.openSelect}},[!e.multi&&e.title?a("div",{class:{"item-label":!0,"color-gray2":"view"===e.mode},attrs:{slot:"left"},slot:"left"},[e._v("\n      "+e._s(e.title)+"\n      "),""!==e.isRead?a("span",{staticClass:"item-status-read",class:{"color-red":!e.isRead,"color-gray2":e.isRead}},[e._v("\n        "+e._s(e.isRead?"已读":"未读")+"\n      ")]):e._e()]):e._e(),e.multi?e._e():a("div",{class:{"item-text":!0,"align-r":"edit"===e.mode,"color-gray1":"edit"===e.mode&&e.selected&&e.selected.id,"item-placeholder":"edit"===e.mode&&!(e.selected&&e.selected.id),"border-editabled":"view"===e.mode&&e.editabled},attrs:{slot:"right"},slot:"right"},[a("div",{staticClass:"item-display-flex"},[e.selected&&e.selected.id?a("div",{staticClass:"item-flex"},["edit"===e.mode?a("span",{staticClass:"bg"},[e._v(e._s(e.selected.name))]):a("check-user-contact",{attrs:{list:[e.selected]}})],1):e._e(),e.note&&e.selected&&e.selected.id?a("div",{staticClass:"item-note color-gray"},[e._v("\n          "+e._s(e.note)+"\n        ")]):e._e()]),e.selected&&e.selected.id?e._e():a("span",{class:{"item-placeholder":e.editabled&&!e.formCheck,"item-text-error":e.formCheck}},[e._v("\n        "+e._s("edit"===e.mode?e.required?"请选择":"选填":e.emptyText)+"\n      ")]),e.date&&!e.editabled?a("div",{staticClass:"color-light mt10"},[a("span",[e._v(e._s(e.date))]),e.modifyDate?a("span",{staticClass:"ml10"},[e._v("提交")]):e._e(),e.status?a("span",{staticClass:"ml10",class:e.statusClass},[e._v("\n          "+e._s(e.status)+"\n        ")]):e._e()]):e._e(),e.modifyDate&&!e.editabled?a("div",{staticClass:"color-light mt10"},[a("span",[e._v(e._s(e.modifyDate))]),a("span",{staticClass:"ml10"},[e._v("最后修改")])]):e._e()]),e.multi?a("div",{class:{"item-text":!0,"align-r":"edit"===e.mode,"color-gray1":"edit"===e.mode&&e.selected&&e.selected.length,"item-placeholder":"edit"===e.mode&&!(e.selected&&e.selected.length),"border-editabled":"view"===e.mode&&e.editabled},attrs:{slot:"right"},slot:"right"},[e.selected&&e.selected.length?["edit"===e.mode?e._l(e.selected,(function(t,i){return a("span",{key:i,staticClass:"bg"},[e._v("\n            "+e._s(t.name)+"\n          ")])})):a("check-user-contact",{attrs:{list:e.selected}})]:a("span",{class:{"item-placeholder":e.editabled&&!e.formCheck,"item-text-error":e.formCheck}},[e._v("\n        "+e._s(e.editabled?e.required?"请选择":"选填":e.emptyText)+"\n      ")])],2):e._e()]),a("popup-user-select",{ref:"popup-user-select"})],1)}),[],!1,null,"74990eb9",null);t.a=n.exports},"542f":function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .layout-main[data-v-29e0b631] .layout-content{overflow:auto}[data-v-29e0b631] .item .icon{color:#4275e8}.zjapp .item-con[data-v-29e0b631] .item-img-list{margin-top:-8px}",""])},"574c":function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .item-textarea{background-color:#fff;padding:5px 15px}.zjapp .item-textarea-content{position:relative}.zjapp .item-textarea .rule,.zjapp .item-textarea textarea{width:100%;min-height:40px;line-height:20px;font-size:16px;padding:0;border:none}.zjapp .item-textarea .rule{position:absolute;top:0;left:0;visibility:hidden;word-break:break-all}.zjapp .item-textarea .counter{text-align:right;margin:0 0 -5px 0;height:15px;line-height:15px;color:#b2b2b2;font-size:12px}",""])},"59a7":function(e,t,a){"use strict";var i=a("329b"),r=a("409b").a,n=(a("d2d4"),a("17cc")),s=Object(n.a)(r,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"slide-right"}},[e.show?a("page-content",{attrs:{mode:"dialog",title:"选择非正常关闭原因","on-close":e.closePopup}},[e._l(e.reasonList,(function(t,i){return a("item",{key:i,staticStyle:{"min-height":"46px","align-items":"center"},attrs:{mode:"view",border:"bottom",text:t.text,"icon-right":t.id===e.reason.id?"qualified":"","icon-right-color":"color-theme"},on:{click:function(a){e.selectItem(t)}}})})),a("div",{staticClass:"mt10"},[e.hasImages?a("item",{staticClass:"p15"},[a("item-img-list",{model:{value:e.images,callback:function(t){e.images=t},expression:"images"}})],1):e._e(),e.reason.remarkRequire||e.fixedRemark?a("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"补充说明"},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}}):e._e()],1),a("app-button-group",[a("app-button",{on:{click:e.submit}},[e._v("提交")])],1)],2):e._e()],1)}),[],!1,null,"e24c0d3a",null).exports,o=!1;o||(o=new(i.default.extend(s))({el:document.createElement("div")}),document.body.appendChild(o.$el));t.a=o},"5b5e":function(e,t,a){"use strict";(function(e){a("9e76"),a("163d"),a("e697");var i,r=a("fd50"),n=a("3bd5"),s=a("ed08"),o=a("4ad6"),c=a("3122"),l=a("3516"),d=a("37d5"),u=a("f2d3"),h=a("48f4"),m=a("6bf2"),f=a.n(m),g=a("4360"),b=a("4921"),_=a("334f"),v=a("b725"),y=a("6b81"),x=a("2f02"),k=a("7364"),w=a("59f8"),D=a("c745"),S=a("0136"),j=function(t,a){var i=n.a.getUser();return _.a.getProblemCCAllColumn(t).then((function(r){if(e.some(r,(function(e){return e.cc===i.user_id&&e.type===a})))return _.a.updateProblemReadingTime(t);var n={id:i.user_id,name:i.user_name,type:a,reading_time:s.a.getNowDate()};return _.a.appendCC(t,n).then((function(){return _.a.updateProblemReadingTime(t)}))}))},P=function(e){var t=e.status;return"已关闭"===e.status&&(t="非正常关闭"),r.a.resolve({status_text:t})};i={getCheckProblemDraftList:function(e){return b.a.getCheckProblemDraftList(e).catch((function(e){return $log.error(e),r.a.reject(e)}))},getCheckProblemList:function(t){var a=n.a.getUser().user_id;return b.a.getCheckProblemList(t,a).then((function(n){return e.map(n,(function(e){i.getProblemLocalStatus({status:e.status}).then((function(t){e.status_text=t.status_text}))})),b.a.getCheckProblemCount(t,a).then((function(e){return r.a.resolve({data:n,total:e.count})}))})).catch((function(e){return $log.error(e),r.a.reject(e)}))},getCheckProblemInfo:function(t){return t?r.a.all([b.a.getCheckProblem(t),v.a.getRepair(t),y.a.getMutliReinspect(t),_.a.getCC(t),_.a.getProblemCCAllColumn(t),y.a.getReinspectByList(t)]).then((function(t){var a=t[0],i=t[5],n=t[1];n&&(a.repair_set=n,a.has_read=n.has_read);var s=t[2];e.isEmpty(s)?a.reinspect_set=[]:a.reinspect_set=s;var o=t[3];o&&o.length>0&&(a.cc_set_id_array=e.map(o,(function(e){return{id:e.user_id}})),a.cc_set_name_array=e.map(o,(function(e){return{name:e.user_name}})),a.cc_set_array=e.map(o,(function(e){return{id:e.user_id,name:e.user_name,mobile:e.mobile,is_im_user:e.is_im_user}})));var c=t[4];return c&&c.length>0&&(a.cc_set_all_id_array=e.map(c,(function(e){return{id:e.cc}}))),a.regist_by||a.sent_back_by||a.repair_by||a.reinspect_by?d.default.getAllProjectUsers(a.proj_id).then((function(t){if(a.regist_by){var r=e.find(t,(function(e){return e.user_id===a.regist_by}));r&&(a.regist=r)}if(a.sent_back_by){var n=e.find(t,(function(e){return e.user_id===a.sent_back_by}));n&&(a.sent_back={id:n.user_id,name:n.user_name,mobile:n.mobile,is_im_user:n.is_im_user})}if(a.repair_by){var s=e.find(t,(function(e){return e.user_id===a.repair_by}));s&&(a.repair=s)}return e.isEmpty(i)||(a.reinspectBy=e.map(i,(function(a){var i=e.find(t,(function(e){return e.user_id===a.reinspect}));return i?{id:i.user_id,name:i.user_name,mobile:i.mobile,is_im_user:i.is_im_user,reinspect_date:a.reinspect_date,reinspect_remark:a.reinspect_remark,reinspect_image_file:JSON.parse(a.reinspect_image_file||"[]"),reinspectById:a.id}:{id:a.reinspect,name:"该用户已被删除",mobile:"",is_im_user:null,reinspect_date:a.reinspect_date,reinspect_remark:"",reinspect_image_file:[],reinspectById:a.id}})),a.reinspectBy=e.filter(a.reinspectBy,(function(e){return!!e})),a.reinspect=e.filter(a.reinspectBy,(function(e){return!!e.reinspect_date}))),a.regist=a.regist||{},a.sent_back=a.sent_back||{},a.repair=a.repair||{},a.reinspect=a.reinspect||[],a})):(a.regist={},a.sent_back={},a.repair={},a.reinspect=[],r.a.resolve(a))})).catch((function(e){$log.log(e)})):r.a.resolve({})},submit:function(t,a,i){if(!1===i)return function(e,t){var a=n.a.getUser();return e.repair_deadline="",e.regist_by=a.user_id,e.regist_date=s.a.getNowDate(),e.created_by=a.user_id,e.created_on=s.a.getNowDate(),e.image_file=JSON.stringify(e.image_file),e.drawing_file&&(e.drawing_file=JSON.stringify(e.drawing_file)),$log.log("专项巡检--\x3e不通知整改"),b.a.submit(e).then((function(){return k.a.saveProblemStatusLog(e.proj_id,"",e.batch_id,e.id,"已提交","","",e.image_file)})).then((function(){return j(e.id,"登记人")})).then((function(t){return h.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).then((function(){if("special-inspect-problem"!==t)return S.a.saveTodo({biz_id:e.id,proj_id:e.proj_id,module_code:t||"",type:2})})).catch((function(e){return $log.error(e),r.a.reject(e)}))}(t,a);if("待提交"!==t.status&&"草稿"!==t.status&&"合格草稿"!==t.status&&"不合格草稿"!==t.status)return r.a.reject("问题单状态异常");if(!t.checkItem.id)return r.a.reject("请先选择检查项");if(!t.repair_set||!t.repair_set.id)return r.a.reject("请选择问题的整改人");if(e.isEmpty(t.reinspect_set))return r.a.reject("请选择问题的复验人");var o=n.a.getUser();t.status="待整改";var c=new Date;return c.setDate(c.getDate()+Number(t.deadline)),t.repair_deadline=f()(c).format("YYYY-MM-DD"),"special-inspect-problem"===a&&t.regist_by&&t.regist_date&&t.created_by&&t.created_on||(t.regist_by=o.user_id,t.regist_date=s.a.getNowDate(),t.created_by=o.user_id,t.created_on=s.a.getNowDate()),t.image_file=JSON.stringify(t.image_file),t.drawing_file&&(t.drawing_file=JSON.stringify(t.drawing_file)),$log.log("现场检查--\x3e提交问题"),b.a.submit(t).then((function(){return k.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已提交","","",t.image_file)})).then((function(){return j(t.id,"登记人")})).then((function(){if("special-inspect-problem"!==a){var e=t.created_by===t.repair_set.id?1:2;return S.a.insertTodoData(t.created_by,t.id,a,e,0)}})).then((function(){return y.a.getReinspectByList(t.id)})).then((function(a){return h.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_repair",t.id],["checkquality_reinspect",t.id],["checkquality_reinspect_by",e.map(a,"id")],["checkquality_cc",t.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},save:function(t){if("待提交"!==t.status&&"草稿"!==t.status&&"合格草稿"!==t.status&&"不合格草稿"!==t.status)return r.a.reject("问题单状态异常。");if(!/^\+?[0-9]*$/.test(t.deadline))return r.a.reject("整改期限必须是正整数");var a={id:t.id,remark:t.remark,image_file:t.image_file,batch_id:t.batch_id,batch_type:t.batch_type,bidsection_id:t.bidsection_id||"",proj_id:t.proj_id,created_by:t.created_by,created_on:s.a.getNowDate(),status:t.status,room_id:t.room_id||"",building_id:t.building_id||"",unit:t.unit||"",floor:t.floor||"",biz_id:t.biz_id||"",biz_children_id:t.biz_children_id||"",deduction:void 0===t.deduction?"":t.deduction,redline_deduction:4===t.mode||8===t.mode?t.redline_deduction:0,contract_id:t.contract&&t.contract.id?t.contract.id:"",voice_file:e.isEmpty(t.voice_file)?null:JSON.stringify(t.voice_file)};return t.repair_requirements&&(a.repair_requirements=t.repair_requirements||""),t.checkItem&&t.checkItem.id&&(a.item_id=t.checkItem.id),t.place&&t.place.full_name&&(a.place=t.place.full_name),t.contractor&&t.contractor.id&&(a.contractor_id=t.contractor.id),t.description&&t.description.id?a.desc_id=t.description.id:a.desc_id="",a.emergency_degree=t.level,t.deadline&&(a.deadline=t.deadline),t.place_point&&(a.problem_values=JSON.stringify(t.place_point)),a.image_file=JSON.stringify(t.image_file),t.drawing_file&&(a.drawing_file=JSON.stringify(t.drawing_file)),(t.process_mode||null===t.process_mode)&&(a.process_mode=t.process_mode),8===t.mode&&(a.deduction_level=t.deduction_level),t.id?b.a.update(a,t.cc_set,t.repair_set,t.reinspect_set).then((function(){return r.a.resolve(t.id)})).catch((function(e){return $log.error(e),r.a.reject(e)})):(a.id=s.a.uuid(),b.a.insert(a).then((function(){return b.a.update(a,t.cc_set,t.repair_set,t.reinspect_set)})).then((function(){return r.a.resolve(a.id)})).catch((function(e){return $log.error(e),r.a.reject(e)})))},delete:function(e){return b.a.getCheckProblem(e).then((function(t){return"待提交"===t.status||"草稿"===t.status||"合格草稿"===t.status||"不合格草稿"===t.status?b.a.delete(e).catch((function(e){return $log.error(e),r.a.reject(e)})):($log.log("问题单状态异常："+e),r.a.reject("问题单状态异常"))}))},repair:function(t,a){if("待整改"!==t.status)return r.a.reject("问题单状态异常");var i=n.a.getUser();t.status="待复验",t.repair_by=i.user_id,t.repair_date=s.a.getNowDate();var o=JSON.stringify(t.repair_image_file);return b.a.getCheckProblem(t.id).then((function(i){if(!i||"待整改"===i.status)return $log.log("现场检查--\x3e完成整改"),b.a.repairProblem(t.id,t.status,t.repair_by,t.repair_remark,t.repair_date,o).then((function(){return k.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已整改","",t.repair_remark,o)})).then((function(){return j(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==a){var i=2;e.filter(t.reinspect_set,{user_id:t.repair_by}).length&&(i=1);var r=S.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return S.a.insertTodoData(t.repair_by,t.id,"check",i,r)}})).then((function(){return h.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_cc",t.id]])}));$log.log("提交整改时数据已变为")})).catch((function(e){return $log.error(e),r.a.reject(e)}))},reinspectPass:function(t,a){if("待复验"!==t.status)return r.a.reject("问题单状态异常");t.currentReinspectBy=t.currentReinspectBy||{};var i=n.a.getUser(),o="",c=e.isEmpty(t.currentReinspectBy.reinspect_image_file)?"":JSON.stringify(t.currentReinspectBy.reinspect_image_file);return b.a.getCheckProblem(t.id).then((function(n){if(!n||"待复验"===n.status)return y.a.reinspectPass(t.id,i.user_id,s.a.now(),c,t.currentReinspectBy.reinspect_remark||"").then((function(){return y.a.getReinspectByList(t.id).then((function(a){var n=e.every(a,(function(e){return!!e.reinspect_date})),c=e.find(a,{reinspect:i.user_id});return c?(o=c.id,n?(t.status="已通过",t.respect_by=i.user_id,t.reinspect_completed_date=s.a.getNowDate(),b.a.reinspectProblemPass(t.id,t.status,t.reinspect_completed_date,t.respect_by).then((function(){return k.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已复验","","","")}))):void 0):r.a.reject("问题单复验人异常")}))})).then((function(){return j(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==a){var e=S.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return S.a.insertTodoData(i.user_id,t.id,a||"check",2,e)}})).then((function(){return h.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_reinspect_by",o],["checkquality_cc",t.id]])}))})).catch((function(e){return $log.error(e),r.a.reject(e)}))},reinspectReject:function(t,a){var i=[["checkquality_problem",t.id],["checkquality_cc",t.id]];if("待复验"!==t.status)return r.a.reject("问题单状态异常");if(!t.sent_back_remark)return r.a.reject("请填写退回原因");var o=n.a.getUser();t.sent_back_times?t.sent_back_times++:t.sent_back_times=1,t.status="待整改",t.sent_back_date=s.a.getNowDate(),t.sent_back_by=o.user_id;var c=JSON.stringify(t.sent_back_image_file);return $log.log("现场检查--\x3e复验退回"),b.a.reinspectProblemReject(t.id,t.status,t.sent_back_date,t.sent_back_remark,c,t.sent_back_by,t.sent_back_times).then((function(){return k.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已退回",t.sent_back_remark,"",c)})).then((function(){return y.a.clearReinspectByData(t.id)})).then((function(){return j(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==a){var e=2;t.repair_set.id&&t.repair_set.id===o.user_id&&(e=1);var i=S.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return S.a.insertTodoData(o.user_id,t.id,"check",e,i)}})).then((function(){return y.a.getReinspectByList(t.id).then((function(t){i.push(["checkquality_reinspect_by",e.map(t,"id")])}))})).then((function(){if(1===t.has_read)return v.a.update({has_read:0},{checkquality_problem_id:t.id}).then((function(){i.push(["checkquality_repair",t.id])}))})).then((function(){return h.default.addSyncGroup(i)})).catch((function(e){return $log.error(e),r.a.reject(e)}))},close:function(e,t){if("待整改"!==e.status)return r.a.reject("问题单状态异常");if(!e.close_reason)return r.a.reject("请填写关闭原因");var a=n.a.getUser();return e.close_date=s.a.getNowDate(),e.status="已关闭",$log.log("现场检查--\x3e非正常关闭"),b.a.closeProblem(e.id,e.status,e.close_date,e.close_reason).then((function(){return k.a.saveProblemStatusLog(e.proj_id,e.bidsection_id,e.batch_id,e.id,"已关闭",e.close_reason,"","")})).then((function(){return j(e.id,"操作人")})).then((function(){if("special-inspect-problem"!==t){var i=S.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"check");return S.a.insertTodoData(a.user_id,e.id,"check",2,i)}})).then((function(){return h.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},changeRepair:function(e,t,a){if(!e.repair_set||!e.repair_set.id)return r.a.reject("请指定一个整改人");var i=n.a.getUser();return $log.log("现场检查--\x3e修改整改人"),b.a.updateProblemModifiedBy(e.id).then((function(){if(t)return b.a.updateProblemContractor(e.id,e.contractor.id)})).then((function(){if(t){var a=e.contractor&&e.contractor.id||"";return b.a.updateProblemContractor(e.id,a)}})).then((function(){return v.a.changeProblemRepairer(e)})).then((function(){return x.a.saveProblemFpInfo(e.proj_id,e.bidsection_id,e.batch_id,e.id,e.repair_set.id,e.repair_set_old.id,"分配整改人")})).then((function(){return j(e.id,"操作人")})).then((function(){if("special-inspect-problem"!==a){var t=2;e.repair_set.id&&e.repair_set.id===i.user_id&&(t=1);var r=S.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"check");return S.a.insertTodoData(i.user_id,e.id,"check",t,r)}})).then((function(){return h.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_repair",e.id],["checkquality_cc",e.id],["checkquality_problem_fpinfo",e.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},changeReinspect:function(t,a){if(e.isEmpty(t.reinspect_set))return r.a.reject("请指定一个复验人");var i=n.a.getUser();return $log.log("现场检查--\x3e修改复验人"),b.a.updateProblemModifiedBy(t.id).then((function(){return y.a.changeProblemReinspect(t.id,t.reinspect_set,!0)})).then((function(){var a=e.map(t.reinspect_set,(function(e){return e.id})).join(","),i=e.map(t.reinspect_set_old,(function(e){return e.id})).join(",");return x.a.saveProblemFpInfo(t.proj_id,t.bidsection_id,t.batch_id,t.id,a,i,"分配复验人")})).then((function(){return j(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==a){var r=2;e.filter(t.reinspect_set,{user_id:i.user_id}).length&&"待复验"===t.status&&(r=1);var n=S.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return S.a.insertTodoData(i.user_id,t.id,"check",r,n)}})).then((function(){return y.a.getReinspectByList(t.id)})).then((function(a){return h.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_reinspect",t.id],["checkquality_reinspect_by",e.map(a,"id")],["checkquality_cc",t.id],["checkquality_problem_fpinfo",t.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},changeCC:function(e){return $log.log("现场检查--\x3e修改抄送人"),b.a.updateProblemModifiedBy(e.id).then((function(){return _.a.saveProblemCC(e.id,e.cc_set)})).then((function(){return h.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},changeContractor:function(e){return e.contractor&&e.contractor.id?($log.log("现场检查--\x3e修改责任单位"),b.a.updateProblemContractor(e.id,e.contractor.id).then((function(){return h.default.addSyncGroup([["checkquality_problem",e.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))):r.a.reject("请指定责任单位")},changeRepairDeadline:function(e){if(!/^(\d+)-(\d{1,2})-(\d{1,2})$/.test(e.repair_deadline))return r.a.reject("整改期限需要一个日期格式的值");var t=f()(e.repair_deadline).format("YYYY-MM-DD"),a=f()().format("YYYY-MM-DD");return e.is_timeout=t<a,$log.log("现场检查--\x3e修改整改期限"),b.a.updateProblemRepairDeadline(e.id,e.repair_deadline).then((function(){return h.default.addSyncGroup([["checkquality_problem",e.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},getProblemLocalStatusById:function(e){return P({status:p.status})},getProblemLocalStatus:P,saveRepairInfo:function(e,t,a){return a=JSON.stringify(a),b.a.saveRepairInfo(e,t,a).then((function(){return b.a.getCheckProblemDraft(e).then((function(t){return u.a.backUpDraft(e,t.proj_id,"checkquality_problem",t)}))}))},problemRead:function(e){return v.a.update({has_read:1},{checkquality_problem_id:e}).then((function(){return h.default.addSyncGroup([["checkquality_problem",e],["checkquality_repair",e]])}))},takePictureAndSave:function(e){return c.a.takePicture().then((function(t){if(t)return l.a.getBatch(e).then((function(e){var a={proj_id:e.proj_id,bidsection_id:e.bidsection_id,batch_id:e.id,deadline:e.repair_deadline,batch_type:e.batch_type,created_by:n.a.getUser().user_id,created_on:s.a.now(),image_file:[t],status:"待提交"};return i.save(a)}))})).catch((function(e){return $log.error(e),r.a.reject(e)}))},saveByPicture:function(e,t){return e?l.a.getBatch(t).then((function(t){var a={proj_id:t.proj_id,bidsection_id:t.bidsection_id,batch_id:t.id,deadline:t.repair_deadline,batch_type:t.batch_type,created_by:n.a.getUser().user_id,created_on:s.a.now(),image_file:[{temp:e}],status:"待提交"};return i.save(a)})).catch((function(e){return $log.error(e),r.a.reject(e)})):r.a.when()},createProblem:function(e,t){return l.a.getBatch(t).then((function(t){var a={proj_id:t.proj_id,bidsection_id:t.bidsection_id,batch_id:t.id,deadline:t.repair_deadline,batch_type:t.batch_type,created_by:n.a.getUser().user_id,created_on:s.a.now(),image_file:[{temp:e}],status:"待提交"};return i.save(a)}))},takePicture:function(){return c.a.takePicture()},allowSelectPicture:function(){return w.a.getValue("upload_from_phone_albums").then((function(e){return"1"===e}))},reinspectByConflict:function(t){return e.isEmpty(t.reinspectBy)?r.a.when():y.a.removeProblemReinspectBy(t.reinspectBy[0].checkquality_problem_id).then((function(){return y.a.insertReinspectByList(t.reinspectBy)})).then((function(){return TodoRepository.removeProblemTodo(t.reinspectBy[0].checkquality_problem_id)})).then((function(){return TodoRepository.insertTodoList(t.todo)}))},copyProblem:function(t){return r.a.all([b.a.getProblemAllColumn(t),v.a.getRepairAllColumn(t),y.a.getReinspectAllColumn(t),y.a.getReinspectByList(t),_.a.getProblemCCAllColumn(t)]).then((function(t){var a=t[0],i=t[1],o=t[2],c=t[3],l=t[4];if(a.id=s.a.uuid(),a.status="待提交",a.regist_by="",a.repair_by="",a.repair_remark="",a.repair_date="",a.repair_image_file="",a.sent_back_by="",a.sent_back_date="",a.sent_back_times=0,a.sent_back_remark="",a.sent_back_image_file="",a.reinspect_by="",a.reinspect_completed_date="",a.close_date="",a.close_reason="",a.created_by=n.a.getUser().user_id,a.created_on=s.a.now(),a.modified_by=n.a.getUser().user_id,a.download_time="",a.update_timestamp="",a.repair_deadline&&!a.deadline&&a.regist_date){for(var d=a.repair_deadline.match(/\d+/g),p=0;p<d.length;p++)d[p]=parseInt(d[p]);for(var u=new Date(d[0],d[1]-1,d[2],d[3]||0,d[4]||0,d[5]||0),h=a.regist_date.match(/\d+/g),m=0;m<h.length;m++)h[m]=parseInt(h[m]);var f=new Date(h[0],h[1]-1,h[2],h[3]||0,h[4]||0,h[5]||0);a.deadline=Math.ceil((u.getTime()-f.getTime())/864e5)}a.regist_date="",a.repair_deadline="",e.each(i,(function(e){e.id=s.a.uuid(),e.checkquality_problem_id=a.id,e.download_time=""})),e.each(o,(function(e){e.id=s.a.uuid(),e.checkquality_problem_id=a.id,e.download_time=""})),e.each(c,(function(e){e.id=s.a.uuid(),e.checkquality_problem_id=a.id,e.reinspect_date="",i.reinspect_remark="",i.reinspect_image_file="",e.download_time=""}));var g=e.filter(l,(function(e){return"默认"===e.type}));return g=e.map(g,(function(e){return{id:e.cc}})),l=e.filter(l,(function(e){return"被抄送"===e.type})),l=e.map(l,(function(e){return{id:e.cc}})),r.a.all([b.a.insert(a),v.a.insert(i),y.a.insertReinspect(o),y.a.insertReinspectByList(c),_.a.saveProblemCC(a.id,l),_.a.saveDefaultCc(a.id,g)])}))},removeLocalInvalidProblem:function(t){var a=r.a.when();return t.problem_repair&&(a=a.then((function(){return v.a.removeInvalidData(t.problem.id,e.map(t.problem_repair,"id"))}))),t.problem_reinspect&&(a=a.then((function(){return y.a.removeInvalidData(t.problem.id,e.map(t.problem_reinspect,"id"))}))),t.problem_cc&&(a=a.then((function(){return _.a.removeInvalidData(t.problem.id,e.map(t.problem_cc,"id"))}))),t.children_Problem&&(a=a.then((function(){return b.a.removeInvalidChildProblem(t.problem.id,t.children_Problem)}))),a},removeLocalInvalidProblem1:function(t,a){var i=a.checkquality_problem;return r.a.when().then((function(){if(a.checkquality_problem)return b.a.deleteProblemById(i.id)})).then((function(){if(a.checkquality_repair)return v.a.removeInvalidData(i.id,e.map(a.checkquality_repair,"id"))})).then((function(){if(a.checkquality_cc)return _.a.removeInvalidData(i.id,e.map(a.checkquality_cc,"id"))}))},removeClosedBatchProblem:function(){return l.a.getClosedBatchIdList().then((function(e){return i.deleteBatchProblems(e)}))},deleteBatchProblems:function(t){return $log.log("删除已关闭批次的问题"),b.a.getProblemsByBatch(t).then((function(t){var a=r.a.when(),i=["image_file","repair_image_file","sent_back_image_file"],n=[];return e.each(t,(function(t){for(var a=0;a<i.length;++a){var r=t[i[a]]=JSON.parse(t[i[a]]||"[]");e.each(r,(function(e){e.local&&n.push(e.local),e.thumbnail&&n.push(e.thumbnail),e.temp&&n.push(e.temp)}))}})),e.each(n,(function(e){a=a.then((function(){return o.a.isFileExists(e)})).then((function(t){if(t)return o.a.deleteFile(e)}))})),a})).then((function(){return b.a.deleteProblemByBatch(t)}))},getLeaderComments:function(t){return b.a.getLeaderComments(t).then((function(t){return e.each(t,(function(e){e.user={id:e.user_id,name:e.user_name,mobile:e.mobile,is_im_user:e.is_im_user},e.image_file&&(e.image_file=JSON.parse(e.image_file))})),t}))},getPhotoRequired:function(e,t){var a=g.a.state.global.allGrayRelease.UsingProjectParameter;return D.a.getProjParameter(e,"is_photo_required",t).then((function(e){return a&&e&&e.length?Number(e[0].value):g.a.state.global.isPhotoRequired[t]})).catch((function(e){console.log("error",e)}))}},t.a=i}).call(this,a("391c"))},"5c87":function(e,t,a){var i=a("1d0a");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("4a8be0e4",i,!0,{sourceMap:!1,shadowMode:!1})},"5d05":function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .page-scroll[data-v-451b00f8]{flex:1;overflow:auto;padding-bottom:100px}.zjapp .page-scroll[data-v-451b00f8] .item-text{line-height:normal}.zjapp .leader-comment[data-v-451b00f8]{padding:3px 0}.zjapp .leader-comment .comment-time[data-v-451b00f8]{color:#bbb}.zjapp .leader-comment .comment-item[data-v-451b00f8]{margin-bottom:15px}.zjapp .leader-comment p[data-v-451b00f8]{margin:5px 0}",""])},"5e1b":function(e,t,a){"use strict";var i=a("329b"),r=(a("6d57"),a("e10e"),a("6bf2")),n=a.n(r);var s={name:"DatepickerDialog",components:{},mixins:[a("e89f").a],props:{},data:function(){return{show:!1,isLoading:!0,today:"",currentYear:"",currentMonth:"",currentDate:"",yearsList:[],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weeksList:["日","一","二","三","四","五","六"],showYearSelect:!1,showMonthSelect:!1,dayList:[]}},methods:{openPopup:function(e){this.value=!0,this.show=!0,this.from=e.from,this.to=e.to,this.inputDate=n()(e.inputDate).isValid()?n()(n()(e.inputDate).format("YYYY-MM-DD")):n()(n()().format("YYYY-MM-DD")),this.callback=e.callback,this.today=n()(n()().format("YYYY-MM-DD")).valueOf(),this.from?this.fromDate=n()(n()(this.from).format("YYYY-MM-DD")).valueOf():this.fromDate=0,this.to?this.toDate=n()(n()(this.to).format("YYYY-MM-DD")).valueOf():this.toDate=1/0,this.selctedDateEpoch=n()(n()(this.inputDate).format("YYYY-MM-DD")).valueOf(),this.refreshDateList(this.inputDate),this.$emit("open")},closePopup:function(){this.value=!1,this.show=!1,this.$emit("close")},closeSelectList:function(){this.showYearSelect=!1,this.showMonthSelect=!1},prevMonth:function(){this.currentDate=n()(this.currentDate).subtract(1,"month"),this.currentMonth=this.monthsList[this.currentDate.month()],this.currentYear=this.currentDate.year(),this.refreshDateList(this.currentDate)},nextMonth:function(){this.currentDate=n()(this.currentDate).add(1,"month"),this.currentMonth=this.monthsList[this.currentDate.month()],this.currentYear=this.currentDate.year(),this.refreshDateList(this.currentDate)},selectYear:function(){this.showYearSelect=!this.showYearSelect,this.showMonthSelect=!1},setYear:function(e){this.currentYear=e,this.yearChanged(e),this.showYearSelect=!1},selectMonth:function(){this.showYearSelect=!1,this.showMonthSelect=!this.showMonthSelect},setMonth:function(e){this.currentMonth=e,this.monthChanged(e),this.showMonthSelect=!1},dateSelected:function(e){e&&0!==Object.keys(e).length&&(this.selctedDateEpoch=e.epoch,this.callback(this.selctedDateEpoch),this.closePopup())},monthChanged:function(e){var t=this.monthsList.indexOf(e);this.currentDate.month(t),this.refreshDateList(this.currentDate)},yearChanged:function(e){this.currentDate.year(e),this.refreshDateList(this.currentDate)},refreshDateList:function(e){var t=[];this.isLoading=!0,e=n()(n()(e).format("YYYY-MM-DD")),this.currentDate=e,this.currentYear="",this.currentMonth="";var a,i,r=this.currentDate.daysInMonth();this.yearsList=function(e,t){var a=[],i=2015,r=2100;i=e?n()(e).year():i,r=t?n()(t).year():r;for(var s=i;s<=r;s++)a.push(s);return a}(),this.dayList=[];var s=n()(this.currentDate).startOf("month").day();this.firstDayEpoch=n()(this.currentDate).startOf("month").valueOf(),this.lastDayEpoch=n()(this.currentDate).endOf("month").startOf("day").valueOf();for(var o=1;o<=r;o++)i=(a=n()(this.currentDate).date(o)).valueOf()<this.fromDate||a.valueOf()>this.toDate,t.push({date:a.date(),month:a.month(),year:a.year(),day:a.day(),epoch:a.valueOf(),disabled:i}),this.dayList=t;for(var c=0;c<s;c++)this.dayList.unshift({});this.rows=[0,7,14,21,28,35],this.cols=[0,1,2,3,4,5,6],this.currentMonth=this.monthsList[e.month()],this.currentYear=this.currentDate.year(),this.numColumns=7,this.isLoading=!1}}},o=(a("80d8"),a("17cc")),c=Object(o.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"slide-right"}},[e.show?a("page-content",{attrs:{mode:"dialog",title:"选择日期","on-close":e.closePopup},on:{click:function(t){e.closeSelectList()}}},[e.isLoading?e._e():a("div",{staticClass:"datepicker-hd"},[a("div",{class:{"datepicker-prev":!0,disabled:e.firstDayEpoch-864e5<e.fromDate},on:{click:e.prevMonth}},[a("icon",{attrs:{name:"arrow-left"}})],1),a("div",{staticClass:"datepicker-hd-center"},[a("div",{staticClass:"datepicker-year",on:{click:function(t){return t.stopPropagation(),e.selectYear(t)}}},[e._v("\n          "+e._s(e.currentYear)+"\n\n          "),a("transition",{attrs:{name:"spread"}},[e.showYearSelect?a("div",{staticClass:"select-list",on:{click:function(e){e.stopPropagation()}}},e._l(e.yearsList,(function(t,i){return a("div",{key:i,class:{"select-item":!0,"item-selected":e.currentYear===t},on:{click:function(a){e.setYear(t)}}},[e._v("\n                "+e._s(t)+"\n              ")])}))):e._e()])],1),a("div",{staticClass:"datepicker-month",on:{click:function(t){t.stopPropagation(),e.selectMonth()}}},[e._v("\n          "+e._s(e.currentMonth)+"\n          "),a("transition",{attrs:{name:"spread"}},[e.showMonthSelect?a("div",{staticClass:"select-list",on:{click:function(e){e.stopPropagation()}}},e._l(e.monthsList,(function(t,i){return a("div",{key:i,class:{"select-item":!0,"item-selected":e.currentMonth===t},on:{click:function(a){e.setMonth(t)}}},[e._v("\n                "+e._s(t)+"\n              ")])}))):e._e()])],1)]),a("div",{class:{"datepicker-next":!0,disabled:e.lastDayEpoch+864e5>e.toDate},on:{click:e.nextMonth}},[a("icon",{attrs:{name:"arrow-right"}})],1)]),e.isLoading?e._e():a("div",{staticClass:"calendar"},[a("div",{staticClass:"weeks-row"},e._l(e.weeksList,(function(t,i){return a("div",{key:i,staticClass:"weeks-cell"},[e._v("\n          "+e._s(t)+"\n        ")])}))),e._l(e.rows,(function(t,i){return a("div",{key:i,staticClass:"date-row"},e._l(e.cols,(function(i,r){return a("div",{key:r,staticClass:"date-cell",class:{"date-cell-selected":e.dayList[t+i]&&e.dayList[t+i].epoch===e.selctedDateEpoch,today:e.dayList[t+i]&&e.dayList[t+i].epoch===e.today,disabled:e.dayList[t+i]&&e.dayList[t+i].disabled},on:{click:function(a){e.dateSelected(e.dayList[t+i])}}},[e._v("\n          "+e._s(e.dayList[t+i]&&e.dayList[t+i].date)+"\n        ")])})))}))],2)]):e._e()],1)}),[],!1,null,"0a266c44",null).exports,l=!1;l||(l=new(i.default.extend(c))({el:document.createElement("div")}),document.body.appendChild(l.$el));t.a=l},6025:function(e,t,a){var i=a("5d05");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("05eb10b6",i,!0,{sourceMap:!1,shadowMode:!1})},6807:function(e,t,a){"use strict";var i=a("c65d").a,r=(a("6d82"),a("17cc")),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.isEmpty?e._e():a("div",{staticClass:"app-voice-play"},[a("div",{staticClass:"play-main"},[a("div",{staticClass:"play-btn"},["start"===e.isPlay?a("div",{staticClass:"play-btn_style play-btn_start",on:{click:e.startPlay}},[a("i",{staticClass:"start-icon"})]):e._e(),"middle"===e.isPlay?a("div",{staticClass:"play-btn_style play-btn_middle",on:{click:e.pausePlay}},[a("i"),a("i")]):e._e(),"loading"===e.isPlay?a("div",{staticClass:"play-btn_style play-btn_loadding",on:{click:e.loadingPlay}},[a("van-loading",{staticClass:"loading-icon",attrs:{type:"spinner",color:"#ffffff",size:"16"}})],1):e._e()]),a("div",{staticClass:"play-progress"},[a("i",{staticClass:"play-progress_spot"}),a("i",{staticClass:"play-progress_solidLine"}),a("div",{staticClass:"play-progress_layer"},[a("van-slider",{staticClass:"play-progress_slider",class:{"disabled-animation":e.startDrap},attrs:{"active-color":"#4275e8","inactive-color":"#F6F6F6",disabled:e.disabled},on:{input:e.dragInput,"drag-start":e.dragStart,"drag-end":e.dragEnd},model:{value:e.progress,callback:function(t){e.progress=t},expression:"progress"}},[a("template",{slot:"button"},[a("div",{staticClass:"play-progress_btn"},[e._v(e._s(e.seekText)),a("span",[e._v("/")]),e._v(e._s(e.duration))])])],2)],1),a("i",{staticClass:"play-progress_dotted"})]),e.isDelete?a("div",{staticClass:"play-delete"},[a("icon",{staticClass:"delete-icon",attrs:{name:"delete"},on:{click:e.deleteVoive}})],1):e._e()]),e.isText?a("div",{staticClass:"play-text"},[a("div",[e._v(e._s(e.text))])]):e._e()])}),[],!1,null,"d51aec2c",null);t.a=n.exports},"6be0":function(e,t,a){var i=a("4460");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("9260fce2",i,!0,{sourceMap:!1,shadowMode:!1})},"6d82":function(e,t,a){"use strict";a("b26b")},"6fe3":function(e,t,a){"use strict";a("1bb9")},"755b":function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .problem-detail-header[data-v-1894f361]{display:flex;align-items:center;justify-content:center;height:40px;padding:0 15px;line-height:40px;background-color:#f2f2f2}.zjapp .problem-detail-header .status[data-v-1894f361]{flex:1;height:16px;line-height:16px;border-left:5px solid #ddd;padding-left:5px;color:#111;font-size:16px}.zjapp .problem-detail-header .status-red[data-v-1894f361]{border-color:#ff3d3d}.zjapp .problem-detail-header .status-blue[data-v-1894f361]{border-color:#4275e8}.zjapp .problem-detail-header .status-green[data-v-1894f361]{border-color:#0bc666}.zjapp .problem-detail-header .status-orange[data-v-1894f361]{border-color:#fc8b01}.zjapp .problem-detail-header .status-black[data-v-1894f361]{border-color:#333}.zjapp .problem-detail-header .status-gray[data-v-1894f361]{border-color:#999}.zjapp .problem-detail-header .return[data-v-1894f361],.zjapp .problem-detail-header .timeout[data-v-1894f361],.zjapp .problem-detail-header .urgent[data-v-1894f361]{display:block;padding:0 5px;margin-left:6px;height:16px;line-height:16px;color:#fff;font-size:12px;border-radius:2px;-webkit-border-radius:2px}.zjapp .problem-detail-header .urgent[data-v-1894f361]{background-color:#ff3d3d}.zjapp .problem-detail-header .timeout[data-v-1894f361]{background-color:#954cfe}.zjapp .problem-detail-header .return[data-v-1894f361]{background-color:#fc8b01}.zjapp .problem-detail-header .operat[data-v-1894f361]{height:40px;line-height:40px;white-space:nowrap;font-size:16px;color:#6b7ba9}",""])},7583:function(e,t,a){"use strict";a("c351")},"75ca":function(e,t,a){"use strict";var i=a("329b"),r=a("3480").a,n=(a("d6fa"),a("17cc")),s=Object(n.a)(r,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"slide-right"}},[e.show?a("page-content",{attrs:{mode:"dialog",title:(e.multiple?"":"选择")+"退回原因","on-close":e.closePopup}},[e.multiple?e._e():a("div",[a("div",{staticClass:"list"},e._l(e.reasonList,(function(t,i){return a("item",{key:i,attrs:{mode:"edit","icon-right":t.id===e.reason.id?"qualified":"","icon-right-color":"color-theme"},on:{click:function(a){e.selectItem(t)}}},[a("div",{staticClass:"item-text"},[e._v("\n            "+e._s(t.text)+"\n          ")])])}))),a("item-textarea",{staticClass:"mt10",attrs:{placeholder:e.placeholder},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}}),a("item",{staticClass:"p15"},[a("item-img-list",{attrs:{maxlength:15,"allow-select-album":e.allowSelectAlbum,"allow-buildin-album":e.allowBuildinAlbum},model:{value:e.images,callback:function(t){e.images=t},expression:"images"}})],1),a("app-button-group",[a("app-button",{on:{click:e.submit}},[e._v("提交")])],1)],1),e.multiple?a("div",[a("div",{staticClass:"list"},e._l(e.reasonList,(function(t,i){return a("item",{key:i,attrs:{mode:"edit","icon-back":e.isBack,"icon-left":t.checked?"qualified":""},on:{click:function(a){e.selectItem(t)}}},[a("div",{staticClass:"item-text"},[e._v("\n            "+e._s(t.text)+"\n          ")])])}))),a("div",{staticClass:"list mt10"},[a("item",{staticClass:"p15"},[a("item-img-list",{attrs:{maxlength:15,"allow-select-album":e.allowSelectAlbum,"allow-buildin-album":e.allowBuildinAlbum},model:{value:e.images,callback:function(t){e.images=t},expression:"images"}})],1),a("item-textarea",{staticClass:"mt10",attrs:{placeholder:e.placeholder},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1),a("app-button-group",[a("app-button",{on:{click:e.submit}},[e._v("确认退回")])],1)],1):e._e()]):e._e()],1)}),[],!1,null,"29e0b631",null).exports,o=!1;o||(o=new(i.default.extend(s))({el:document.createElement("div")}),document.body.appendChild(o.$el));t.a=o},"7fa9":function(e,t,a){var i=a("2258");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("38301f76",i,!0,{sourceMap:!1,shadowMode:!1})},"80d8":function(e,t,a){"use strict";a("e60b")},8166:function(e,t,a){"use strict";(function(e){a("5ab2"),a("6d57"),a("e10e"),a("6a61");var i,r,n=a("2e91"),s=(a("ed63"),a("8cf2"),a("28f8")),o=(a("e697"),a("cc57"),a("f369")),c=a("4164"),l=a("da1c"),d=a("07d2"),p=a("e68e"),u=a("5e1b"),h=a("3c64"),m=a("37478"),f=a("528f"),g=a("6807"),b=a("6bf2"),_=a.n(b),v=a("e2a7"),y=a("3bd5"),x=a("5b5e"),k=a("37d5"),w=a("5ff0"),D=a("75ca"),S=a("59a7"),j=a("b6da"),P=a("06f6"),C=a("6144"),O=a("9864"),R=a("6f9e"),z=a("c058"),L=a("7b81");function $(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function B(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$(Object(a),!0).forEach((function(t){Object(s.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t.a={name:"CheckEdit",components:{CheckGuide:o.a,BusinessLogs:c.a,ProblemDetailHeader:l.default,Item:d.default,ItemImgList:p.a,ItemTextarea:h.a,SingleSelect:m.a,UserSelect:f.a,CheckUserContact:O.a,AppVoicePlay:g.a},data:function(){return{isLoading:!0,comeFrom:"",user:y.a.getUser(),problemData:{},repairOptions:[],reinspectOptions:[],contractorOptions:[],ccOptions:[],hasColseRole:!0,allowChangeRepair:!1,allowChangeCC:!1,allowRepair:!1,allowChangeContractor:!1,allowClose:!1,allowChangeReinspect:!1,allowReinspectReject:!1,allowReinspectPass:!1,allowChangeRepairDeadline:!1,allowView:!1}},created:function(){var e=this;Object(R.d)((function(t){t.id===e.problemData.id&&(e.initAllowData(),e.loadData())}))},activated:function(){this.user=y.a.getUser(),this.comeFrom=this.$store.state.global.prevRouter.meta.isTodo?"todo":"check",this.initAllowData(),this.loadData(this.$route.params.id)},methods:{initAllowData:function(){this.allowChangeRepair=!1,this.allowChangeCC=!1,this.allowRepair=!1,this.allowChangeContractor=!1,this.allowClose=!1,this.allowChangeReinspect=!1,this.allowReinspectReject=!1,this.allowReinspectPass=!1,this.allowChangeRepairDeadline=!1,this.allowView=!1},fomatDate:function(e){return _()(e).format("YYYY-MM-DD HH:mm")},loadData:function(t){var a=this;if(t=t||this.$route.params.id||"",!e.isEmpty(t))return this.isLoading=!0,x.a.getCheckProblemInfo(t).then((function(e){e.repair=e.repair||{},e.repair_set=e.repair_set||{},a.problemData={id:e.id,status:e.status,status_text:e.status,proj_id:e.proj_id,proj_name:e.proj_name,bidsection_id:e.bidsection_id,bidsection_name:e.bidsection_name,place:{full_name:e.place},batch_id:e.batch_id,checkItem:{id:e.item_id,name:e.item_name,full_name:e.item_full_name},description:{id:e.desc_id,name:e.desc},image_file:JSON.parse(e.image_file||"[]"),remark:e.remark,repair_requirements:e.repair_requirements,level:e.emergency_degree||"一般",deadline:e.deadline||7,regist:e.regist,regist_date:e.regist_date,sent_back:{id:e.sent_back.id,name:e.sent_back.name,mobile:e.sent_back.mobile},sent_back_date:e.sent_back_date,sent_back_times:e.sent_back_times,sent_back_remark:e.sent_back_remark,sent_back_image_file:JSON.parse(e.sent_back_image_file||"[]"),repair:e.repair,repair_remark:e.repair_remark,repair_set:e.repair_set,repair_deadline:_()(e.repair_deadline).format("YYYY-MM-DD"),repair_date:e.repair_date,repair_image_file:JSON.parse(e.repair_image_file||"[]"),contractor:{id:e.contractor_id,name:e.contractor_name},cc_set:e.cc_set_array,cc_set_all_id_array:e.cc_set_all_id_array,reinspect:e.reinspect,reinspectBy:e.reinspectBy,reinspect_set:e.reinspect_set,reinspect_complete_date:e.reinspect_complete_date?_()(e.reinspect_complete_date).format("YYYY-MM-DD HH:mm"):"",close_date:e.close_date?_()(e.close_date).format("YYYY-MM-DD HH:mm"):"",close_reason:e.close_reason,created_by:e.created_by,place_point:JSON.parse(e.problem_values||"[]"),room_id:e.room_id,drawing_file:JSON.parse(e.drawing_file||"[]"),has_read:e.has_read,currentReinspectBy:{},leaderComments:[],voice_file:JSON.parse(e.voice_file||"[]")},$log.log(a.problemData,"problemData"),$log.log(a.problemData.reinspectBy),e.repair_set.id===a.user.user_id&&0===e.has_read&&"待整改"===e.status&&(a.problemData.has_read=1,x.a.problemRead(e.id))})).then((function(){return L.a.hasRoles(a.user.user_id,310).then((function(e){a.hasColseRole=e,a.reloadActionPermissions()}))})).then((function(){a.problemData.currentReinspectBy=e.find(e.clone(a.problemData.reinspectBy),(function(e){return e.id===a.user.user_id}))||{reinspect_image_file:[]}})).then((function(){a.problemData.repair_set.id===a.user.user_id&&0===a.problemData.has_read&&"待整改"===a.problemData.status&&(a.problemData.has_read=1,x.a.problemRead(a.problemData.id))})).then((function(){return k.default.getProjectUsers(a.problemData.proj_id,[31,32,33]).then((function(t){a.repairOptions=e.clone(t),a.reinspectOptions=e.clone(t),a.ccOptions=e.clone(t)}))})).then((function(){return a.loadContractor()})).then((function(){return x.a.getLeaderComments(a.problemData.id).then((function(e){a.problemData.leaderComments=e.map((function(e){return B(B({},e),{},{comment_on:_()(e.comment_on).format("YYYY-MM-DD HH:mm")})}))}))})).catch((function(e){console.log(e,"loadData出错了")})).finally((function(){a.isLoading=!1}))},reloadActionPermissions:function(){var t=this;this.allowChangeRepair="待整改"===this.problemData.status&&(this.user.user_id===this.problemData.repair_set.id||this.user.user_id===this.problemData.created_by),this.allowChangeCC="待整改"===this.problemData.status&&this.user.user_id===this.problemData.created_by||"待复验"===this.problemData.status&&e.includes(e.map(this.problemData.reinspect_set,"id"),this.user.user_id),this.allowRepair="待整改"===this.problemData.status&&this.user.user_id===this.problemData.repair_set.id,this.allowChangeContractor="待整改"===this.problemData.status&&this.user.user_id===this.problemData.created_by||"待复验"===this.problemData.status&&e.includes(e.map(this.problemData.reinspect_set,"id"),this.user.user_id),this.allowClose="待整改"===this.problemData.status&&this.user.user_id===this.problemData.created_by&&this.hasColseRole,this.allowChangeReinspect="待整改"===this.problemData.status&&this.user.user_id===this.problemData.created_by||"待复验"===this.problemData.status&&(this.user.user_id===this.problemData.created_by||e.includes(e.map(this.problemData.reinspect_set,"id"),this.user.user_id))&&e.isEmpty(this.problemData.reinspect),this.allowReinspectReject="待复验"===this.problemData.status&&e.includes(e.map(this.problemData.reinspect_set,"id"),this.user.user_id)&&!e.includes(e.map(this.problemData.reinspect,"id"),this.user.user_id),this.allowReinspectPass="待复验"===this.problemData.status&&e.includes(e.map(this.problemData.reinspect_set,"id"),this.user.user_id)&&!e.includes(e.map(this.problemData.reinspect,"id"),this.user.user_id),this.allowChangeRepairDeadline="待整改"===this.problemData.status&&this.user.user_id===this.problemData.created_by&&this.$store.state.global.allowModifyRepairDeadline,this.allowView=this.user.user_id===this.problemData.created_by||"待整改"===this.problemData.status&&this.user.user_id===this.problemData.repair_set.id||"待复验"===this.problemData.status&&e.includes(e.map(this.problemData.reinspect_set,"id"),this.user.user_id)||e.some(this.problemData.cc_set_all_id_array,(function(e){return e.id===t.user.user_id})),this.problemData.is_timeout="待整改"===t.problemData.status?t.problemData.repair_deadline<_()().format("YYYY-MM-DD"):"已关闭"===t.problemData.status?t.problemData.repair_deadline<_()(t.problemData.close_date).format("YYYY-MM-DD"):t.problemData.repair_deadline<_()(t.problemData.repair_date).format("YYYY-MM-DD"),this.refreshProblemStatusText()},refreshProblemStatusText:function(){var e=this;this.problemData.status_text=this.problemData.status,x.a.getProblemLocalStatus({status:this.problemData.status}).then((function(t){e.problemData.status_text=t.status_text}))},showHuxingMark:function(){e.isEmpty(this.problemData.drawing_file)?P.default.getRoomTypeDiagram(this.problemData.room_id).then((function(e){j.a.openPopup({mode:"view",url:e.url,points:this.problemData.place_point})})):j.a.openPopup({mode:"view",url:this.problemData.drawing_file[0]?this.problemData.drawing_file[0].url:"",points:this.problemData.place_point})},loadContractor:function(t){var a=this,i=this.problemData.repair_set&&this.problemData.repair_set.id||"";return w.a.getContractorListByUser(i,this.problemData.bidsection_id).then((function(i){a.contractorOptions=i.list,!e.isEmpty(i.list)&&t&&i.isGroupList&&(a.problemData.contractor=i.list[0])}))},selectDeadline:function(){var e=this;this.allowChangeRepairDeadline&&u.a.openPopup({from:_()().toDate(),inputDate:_()(this.problemData.repair_deadline).toDate(),callback:function(t){var a=e.problemData.repair_deadline,i=_()(t).format("YYYY-MM-DD");e.problemData.repair_deadline=i,e.changeRepairDeadline().then((function(){z.a.addLog({relation_id:e.problemData.id,business_type:"check",event:"变更整改期限",diff:{old:a,new:i}})}))}})},changeRepairDeadline:function(){var e=this;return this.allowChangeRepairDeadline?(v.a.loading("正在修改..."),x.a.changeRepairDeadline(this.problemData).then((function(){e.reloadActionPermissions(),v.a.hideLoading(),v.a.alert("修改成功")})).catch((function(e){v.a.hideLoading(),v.a.alert(e)}))):Promise.resolve()},beforeChangeRepair:function(e){return this.problemData.repair_set_old=this.problemData.repair_set,v.a.confirm("确定将整改人修改为【"+e.name+"】吗？")},changeRepair:function(e,t){var a=this;if(this.allowChangeRepair&&e&&e.id&&e.name){var i=this.problemData.contractor?this.problemData.contractor.id:"";v.a.loading("正在提交..."),this.problemData.repair_set=e,this.loadContractor(!0).then((function(){var e=i!==a.problemData.contractor?a.problemData.contractor.id:"";return x.a.changeRepair(a.problemData,e)})).then((function(){a.problemData.cc_set_all_id_array.push({id:y.a.getUser().user_id}),v.a.hideLoading(),v.a.alert("修改成功"),a.reloadActionPermissions(a.problemData),e.id===a.user.user_id?a.problemData.has_read=1:(a.problemData.has_read=0,a.$set(a.problemData,"repair_image_file",[]),a.repairRemarkUpdate())})).then((function(){return z.a.addLog({relation_id:a.problemData.id,business_type:"check",event:"变更整改人",diff:{old:[{id:t.id,name:t.name}],new:[{id:e.id,name:e.name}]}})})).catch((function(e){v.a.hideLoading(),v.a.alert(e)}))}},beforeChangeReinspect:function(t){return this.problemData.reinspect_set_old=this.problemData.reinspect_set,e.isEmpty(t)?(v.a.alert("请指定一个复验人"),!1):v.a.confirm("确定修改复验人吗？")},changeReinspect:function(t,a){var i=this;v.a.loading("正在提交..."),x.a.changeReinspect(this.problemData).then((function(){i.problemData.cc_set_all_id_array.push({id:y.a.getUser().user_id}),i.reloadActionPermissions(i.problemData),v.a.hideLoading(),v.a.alert("修改成功")})).then((function(){return z.a.addLog({relation_id:i.problemData.id,business_type:"check",event:"变更复验人",diff:{old:e.map(a,(function(e){return{id:e.id,name:e.name}})),new:e.map(t,(function(e){return{id:e.id,name:e.name}}))}})})).catch((function(e){v.a.hideLoading(),v.a.alert(e)}))},repairRemarkUpdate:function(){x.a.saveRepairInfo(this.problemData.id,this.problemData.repair_remark,this.problemData.repair_image_file)},repairSubmit:(r=Object(n.a)(regeneratorRuntime.mark((function t(){var a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.allowRepair){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,x.a.getPhotoRequired(this.problemData.proj_id,"TYPE_SECURE");case 4:if(!t.sent||!e.isEmpty(this.problemData.repair_image_file)){t.next=8;break}return v.a.alert("请拍摄整改照片"),t.abrupt("return");case 8:return v.a.loading("处理中"),t.abrupt("return",x.a.repair(this.problemData).then((function(){a.problemData.cc_set_all_id_array.push({id:y.a.getUser().user_id}),v.a.hideLoading(),v.a.alert("提交成功"),a.loadData()})).then((function(){return z.a.addLog({relation_id:a.problemData.id,business_type:"check",event:"完成整改",diff:{remark:a.problemData.repair_remark},images:a.problemData.repair_image_file})})).catch((function(e){v.a.hideLoading(),v.a.alert(e)})));case 10:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)}),reinspectSubmit:(i=Object(n.a)(regeneratorRuntime.mark((function t(){var a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.allowReinspectPass){t.next=2;break}return t.abrupt("return");case 2:if(this.problemData.contractor.id){t.next=4;break}return t.abrupt("return",v.a.alert("请指定责任单位"));case 4:if(!e.isEmpty(this.problemData.reinspect_set)){t.next=7;break}return v.a.alert("请选择复验人"),t.abrupt("return",!1);case 7:return t.next=9,x.a.getPhotoRequired(this.problemData.proj_id,"TYPE_SECURE_REVIEW");case 9:if(!t.sent||!e.isEmpty(this.problemData.currentReinspectBy.reinspect_image_file)){t.next=13;break}return v.a.alert("请拍摄复验照片"),t.abrupt("return");case 13:return e.each(this.problemData.reinspectBy,(function(e,t){e.id===a.user.user_id&&(a.problemData.reinspectBy[t]=a.problemData.currentReinspectBy)})),t.abrupt("return",v.a.popBox({title:"确定通过吗？",cancelText:"取消",okText:"通过"}).then((function(e){e&&(v.a.loading("正在提交..."),x.a.reinspectPass(a.problemData,"check").then((function(){a.problemData.reinspect_complete_date=_()().format("YYYY-MM-DD HH:mm:ss"),a.problemData.cc_set_all_id_array.push({id:a.user.user_id}),v.a.hideLoading(),v.a.alert("提交成功"),a.loadData()})).then((function(){return z.a.addLog({relation_id:a.problemData.id,business_type:"check",event:"复验通过",diff:{remark:a.problemData.currentReinspectBy.reinspect_remark},images:a.problemData.currentReinspectBy.reinspect_image_file})})).catch((function(e){v.a.hideLoading(),v.a.alert(e)})))})));case 15:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)}),changeCC:function(t,a){var i=this;this.allowChangeCC&&e.isArray(t)&&(v.a.loading("正在提交..."),this.problemData.cc_set=t,x.a.changeCC(this.problemData).then((function(){v.a.hideLoading(),v.a.alert("修改成功"),i.reloadActionPermissions(i.problemData)})).then((function(){return z.a.addLog({relation_id:i.problemData.id,business_type:"check",event:"变更抄送人",diff:{old:e.map(a||[],(function(e){return{id:e.id,name:e.name}})),new:e.map(t||[],(function(e){return{id:e.id,name:e.name}}))}})})).catch((function(e){v.a.hideLoading(),v.a.alert(e)})))},changeContractor:function(t,a){var i=this;this.allowChangeContractor&&(e.isEmpty(t)||(v.a.loading("正在提交..."),this.problemData.contractor=t,x.a.changeContractor(this.problemData).then((function(){v.a.hideLoading(),v.a.alert("修改成功"),i.reloadActionPermissions(i.problemData)})).then((function(){return z.a.addLog({relation_id:i.problemData.id,business_type:"check",event:"变更责任单位",diff:{old:{id:a.id,name:a.name},new:{id:t.id,name:t.name}}})})).catch((function(e){v.a.hideLoading(),v.a.alert(e)}))))},back:function(){var t=this;D.a.openPopup({callback:function(a){if(t.allowReinspectReject){var i=[];a&&a.reason&&a.reason.id&&(1===a.reason.id&&i.push(a.reason.text),a.remark&&i.push(a.remark),t.problemData.sent_back_remark=i.join(";")),e.isEmpty(a.images)?t.problemData.sent_back_image_file=[]:t.problemData.sent_back_image_file=a.images,v.a.loading("正在提交..."),x.a.reinspectReject(t.problemData).then((function(){t.problemData.cc_set_all_id_array.push({id:y.a.getUser().user_id}),v.a.hideLoading(),v.a.alert("提交成功"),t.reloadActionPermissions(t.problemData)})).then((function(){return z.a.addLog({relation_id:t.problemData.id,business_type:"check",event:"退回",diff:{remark:t.problemData.sent_back_remark},images:t.problemData.sent_back_image_file})})).catch((function(e){v.a.hideLoading(),v.a.alert(e)}))}}})},close:function(){var e=this;S.a.openPopup({callback:function(t){e.allowClose&&(e.problemData.close_reason=t,v.a.loading("正在提交..."),x.a.close(e.problemData).then((function(){e.problemData.close_date=_()(e.problemData.close_date).format("YYYY-MM-DD HH:mm"),e.problemData.cc_set_all_id_array.push({id:y.a.getUser().user_id}),v.a.hideLoading(),v.a.alert("提交成功"),e.reloadActionPermissions(e.problemData)})).then((function(){return z.a.addLog({relation_id:e.problemData.id,business_type:"check",event:"非正常关闭",diff:{remark:e.problemData.close_reason}})})).catch((function(e){v.a.hideLoading(),v.a.alert(e)})))}})},copyProblem:function(){var e=this;return $log.log("复制问题"),x.a.copyProblem(this.problemData.id).then((function(){return C.a.saveString("check-index-tab-index","0"),v.a.alert("复制成功").then((function(){return e.$router.go(-1)}))})).catch((function(e){$log.error(e),v.a.alert("发生了错误")}))}}}}).call(this,a("391c"))},"82db":function(e,t,a){"use strict";a("5c87")},"8e75":function(e,t,a){"use strict";(function(e){a("2b45"),a("e697"),a("cc57"),a("163d");var i=a("07d2"),r=a("6144"),n=a("9864"),s=a("e2a7"),o=a("a18c"),c=a("34b6");t.a={name:"UserSelect",components:{Item:i.default,CheckUserContact:n.a,PopupUserSelect:c.a},props:{title:{type:String},value:{type:[Object,Array]},options:{type:Array,default:function(){return[]}},multi:{type:Boolean,default:!1},date:{type:String,default:""},modifyDate:{type:String,default:""},isRead:{type:[String,Boolean],default:""},note:{type:String,default:""},status:{type:String,default:""},statusClass:{type:[Object,String]},max:{type:Number,default:1/0},maxTip:{type:String,default:""},border:{type:String,default:""},mode:{type:String,default:"edit"},editabled:{type:Boolean,default:!0},memory:{type:Boolean,default:!1},autoSelect:{type:Boolean,default:!1},required:{type:Boolean,default:!0},emptyText:{type:String,default:"空"},beforeOpen:{type:Function,default:function(){}},beforeSelect:{type:Function,default:function(){}},beforeConfirm:{type:Function,default:function(){}},formCheck:{type:Boolean,default:!1},linkedData:{type:Object,default:function(){return{}}}},data:function(){return{isOpen:!1,memoryKey:(this.$route?this.$route.name:o.a.history.current.name)+encodeURI(this.title||"选人组件")}},computed:{selected:function(){return this.multi?e.isArray(this.value)?this.value:e.isEmpty(this.value)?[]:[this.value]:e.isArray(this.value)?this.value[0]||{}:e.isEmpty(this.value)?{}:this.value}},watch:{options:function(){this.setSelected()}},mounted:function(){this.setSelected()},methods:{openSelect:function(){var t=this;if(this.editabled){var a=this.beforeOpen(this.linkedData);a&&a.then&&e.isFunction(a.then)?a.then((function(e){!1!==e&&t.openPopup()})).catch((function(e){$log.error(e),s.a.alert(e||"发生了错误")})):!1!==a&&this.openPopup()}},openPopup:function(){var t=this;this.$refs["popup-user-select"].openPopup({title:"选择"+(this.title||""),selected:this.selected,options:this.options,multi:this.multi,max:this.max,maxTip:this.maxTip,beforeSelect:this.beforeSelect,beforeConfirm:this.beforeConfirm,onSelect:function(a){var i=e.cloneDeep(t.selected);t.multi?(t.$emit("input",a,i),t.$emit("onSelect",a,i)):(t.$emit("input",a[0],i),t.$emit("onSelect",a[0],i)),t.memory&&r.a.saveObject(t.memoryKey,t.multi?a:a[0],r.a.level.user)}})},closeSelect:function(){this.isOpen=!1},getSame:function(t,a){var i=[];return e.each(t,(function(t){t&&t.id&&e.find(a,(function(e){return e.id.toString().toUpperCase()===t.id.toString().toUpperCase()}))&&i.push(t)})),i},setSelected:function(){var t,a=r.a.getObject(this.memoryKey,r.a.level.user);!1===this.editabled||e.isEmpty(this.options)||(this.multi?e.isEmpty(this.selected)?a&&a.length&&this.memory?(t=this.getSame(a,this.options)).length&&(this.$emit("input",t),this.autoSelect&&this.$emit("defaultSelect",t)):this.selectDefault&&(t=this.getSame(this.selectDefault,this.options)).length&&(this.$emit("input",t),this.autoSelect&&this.$emit("defaultSelect",t)):(t=this.getSame(this.selected,this.options)).length?this.autoSelect&&this.$emit("defaultSelect",this.selected):this.autoSelect&&this.$emit("defaultSelect",[]):!e.isEmpty(this.selected)&&this.selected.id?this.autoSelect&&this.$emit("defaultSelect",this.selected):this.memory&&!e.isEmpty(a)&&(e.isArray(a)&&(a=a[0]),e.some(this.options,{id:a.id})&&(this.$emit("input",a),this.autoSelect&&this.$emit("defaultSelect",a))))}}}}).call(this,a("391c"))},"936a":function(e,t,a){var i=a("e46b"),r=a("e7ad").isFinite;i(i.S,"Number",{isFinite:function(e){return"number"==typeof e&&r(e)}})},9446:function(e,t,a){var i=a("2dd6");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("2192cd00",i,!0,{sourceMap:!1,shadowMode:!1})},9586:function(e,t,a){"use strict";a("6025")},9788:function(e,t,a){"use strict";a("9446")},9864:function(e,t,a){"use strict";var i=a("cdce").a,r=(a("1a09"),a("17cc")),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"root"},[e.list.length?e._e():a("div",{staticClass:"item-user-unit"},[a("span",{staticClass:"item-user-name"},[e._v("\n      无\n    ")])]),e._l(e.list,(function(t,i){return a("div",{key:i,staticClass:"item-user-unit bg"},[a("span",{staticClass:"item-user-name"},[e._v("\n      "+e._s(t&&t.name?t.name:"")+"\n    ")]),a("div",{staticClass:"icon-im-btn",on:{click:function(a){if(a.stopPropagation(),a.target!==a.currentTarget)return null;e.openImPopup(t,a)}}},[e.popupOpenItemId===t.id?a("div",{staticClass:"popup-user-im",class:{"popup-user-posi-bottom":e.popupUserPosiBottom},style:{left:e.popupL}},[a("div",{directives:[{name:"track",rawName:"v-track",value:"公共-发起聊天",expression:"'公共-发起聊天'"}],staticClass:"popup-user-im-item",class:{disabled:e.isImDisabled(t)},on:{click:function(a){e.openIm(t)}}},[a("icon",{staticClass:"popup-user-im-icon",attrs:{name:"liaotian"}}),a("p",{staticClass:"popup-user-im-text"},[e._v("聊天")])],1),t.mobile&&e.userInfo.user_id!==t.id?a("a",{directives:[{name:"track",rawName:"v-track",value:"公共-打电话",expression:"'公共-打电话'"}],staticClass:"popup-user-im-item",attrs:{href:"tel:"+t.mobile}},[a("icon",{staticClass:"popup-user-im-icon",attrs:{name:"dianhua"}}),a("p",{staticClass:"popup-user-im-text"},[e._v("电话")])],1):a("div",{staticClass:"popup-user-im-item disabled"},[a("icon",{staticClass:"popup-user-im-icon",attrs:{name:"dianhua"}}),a("p",{staticClass:"popup-user-im-text"},[e._v("电话")])],1),a("div",{staticClass:"popup-user-im-arrow",style:{left:e.arrowL}})]):e._e()])])}))],2)}),[],!1,null,"43750b3d",null);t.a=n.exports},"99f0":function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .popup-customize-use-header[data-v-5fef0434]{display:flex;flex-direction:column;font-size:14px}[data-v-5fef0434] .popup-customize-use-header.van-popup--bottom.van-popup--round{border-radius:10px 10px 0 0}.zjapp .popup-customize-use-header .popup-header[data-v-5fef0434]{display:flex;align-items:center;justify-content:space-between;padding:0 15px;height:46px;border:none;background-image:linear-gradient(0deg,#ececec,#ececec 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}.zjapp .popup-customize-use-header .popup-header .popup-header__left[data-v-5fef0434]{width:80px;flex-shrink:0}.zjapp .popup-customize-use-header .popup-header .popup-header__title[data-v-5fef0434]{flex:1;text-align:center;font-size:18px}.zjapp .popup-customize-use-header .popup-header .popup-header__right[data-v-5fef0434]{width:80px;flex-shrink:0;font-weight:800;text-align:right}.zjapp .popup-customize-use-header .popup-body[data-v-5fef0434]{display:flex;position:relative;height:calc(100% - 46px);overflow:hidden}.zjapp .f-blue[data-v-5fef0434]{color:#4275e8}.zjapp .f-gray[data-v-5fef0434]{color:#666}",""])},"9ab7":function(e,t,a){var i=a("542f");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("8c69df94",i,!0,{sourceMap:!1,shadowMode:!1})},a207:function(e,t,a){var i=a("c081");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("4bbf528c",i,!0,{sourceMap:!1,shadowMode:!1})},a300:function(e,t,a){"use strict";(function(e){a("5ab2"),a("6d57"),a("e10e");var i=a("28f8"),r=a("e89f"),n=a("e2a7"),s=a("4360"),o=a("e223");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}t.a={name:"DrawingDialog",store:s.a,components:{Drawing:o.a},mixins:[r.a],data:function(){return{show:!1,mode:"",url:"",points:[],folder:"",maxMarks:1/0,onmark:function(){}}},methods:{openPopup:function(e){return this.mode=e.mode,this.url=e.url,this.points=e.points,this.folder=e.folder,this.maxMarks=isNaN(e.maxMarks)?1/0:e.maxMarks,this.onmark=e.onmark,this.show=!0,this.$emit("open"),this},closePopup:function(){this.show=!1,this.$emit("close")},undo:function(){this.points.pop()},sure:function(){this.points.length?(this.closePopup(),this.onmark&&this.onmark(this.points)):n.a.alert("请先在户型图标记位置")},pointLight:function(t){this.points=e.map(this.points,(function(e,a){var r=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e);return t===a?r.color="#4275e8":r.found?r.color="#14ff56":r.color="#ff4546",r}))},onclick:function(e){var t=this;if("view"===this.mode){if(e.clickPoint&&"points"===e.clickPoint.tag){var a=e.clickPoint.index;this.pointLight(a)}}else if("mark-val-group"===this.mode){if(this.points.length>=maxMarks)return void n.a.alert("爆点个数不能大于实测点数");this.points.push({x:e.x,y:e.y})}else if("multiple-remark"===this.mode)this.points.push({x:e.x,y:e.y});else{var i={x:e.x,y:e.y};this.points=[i],setTimeout((function(){t.closePopup(),t.onmark&&t.onmark(i)}),200)}}}}}).call(this,a("391c"))},b26b:function(e,t,a){var i=a("ef5e");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("4373af40",i,!0,{sourceMap:!1,shadowMode:!1})},b280:function(e,t,a){"use strict";var i=a("bf9f"),r=a("6f9e"),n=a("eba8").a,s=(a("82db"),a("17cc")),o=Object(s.a)(n,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"weiget-box"},[e.searchBar?a("app-search-bar",{ref:"app-search-bar",attrs:{placeholder:"搜索","history-key":e.storageKey},on:{changeSearchStatus:e.onSearchTypeChange},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}):e._e(),a("scroller",{attrs:{"has-next":!e.searchStatus&&!e.grouping&&e.optionsLimit<e.options.length,"end-text":"","is-empty":0===e.optionsShow.length},on:{loadNext:e.pageOptions}},[e.searchStatus?[e.keyword?[e.grouping?a("van-collapse",{model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},e._l(e.searchData,(function(t,i){return a("van-collapse-item",{key:i,attrs:{title:t.name,name:i}},e._l(t.children,(function(t,i){return a("item",{key:i,attrs:{checked:e.checkedItem.id===t.id,item:t,"line-limit":e.lineLimit,"render-field":"rename"},on:{click:e.selectItem}})})))}))):e._e(),e.grouping&&!e.searchData.length?a("loading-status",{attrs:{"is-empty":!0,"empty-text":"没有内容","show-style":"search"}}):e._e(),e.grouping?e._e():[e._l(e.searchData,(function(t,i){return a("item",{key:i,attrs:{checked:e.checkedItem.id===t.id,item:t,"line-limit":e.lineLimit,"render-field":"rename"},on:{click:e.selectItem}})})),e.searchData.length?e._e():a("loading-status",{attrs:{"is-empty":!0,"empty-text":"没有内容","show-style":"search"}})]]:e._e()]:[e.grouping?a("van-collapse",{model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},e._l(e.optionsShow,(function(t,i){return a("van-collapse-item",{key:i,attrs:{title:t.name,name:i}},e._l(t.children,(function(t,i){return a("item",{key:i,attrs:{checked:e.checkedItem.id===t.id,item:t,"line-limit":e.lineLimit},on:{click:e.selectItem}})})))}))):e._l(e.optionsShow,(function(t,i){return a("item",{key:i,attrs:{checked:e.checkedItem.id===t.id,item:t,"line-limit":e.lineLimit},on:{click:e.selectItem}})})),e.optionsShow.length?e._e():a("loading-status",{attrs:{"is-empty":!0,"empty-text":"暂无数据","show-style":"search"}})]],2)],1)}),[],!1,null,"5920a10e",null).exports,c={components:{PopupHasHeader:i.a,Widget:o},data:function(){return{show:!1,title:""}},methods:{openPopup:function(e){var t=this;r.a.$on("closeDialog",this.closePopup),this.show=!0,this.title=e.title,this.$nextTick((function(){t.$refs["single-select"].init(e)}))},closePopup:function(){r.a.$off("closeDialog",this.closePopup),this.show=!1},clearStatus:function(){this.$refs["single-select"].closePopup()}}},l=(a("1f8b"),Object(s.a)(c,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("popup-has-header",{attrs:{height:"93%",title:e.title},on:{closed:e.clearStatus},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("template",{slot:"body_main"},[a("div",{staticClass:"body-box"},[a("widget",{ref:"single-select",on:{close:e.closePopup}})],1)])],2)],1)}),[],!1,null,"8dab4862",null));t.a=l.exports},b6da:function(e,t,a){"use strict";var i=a("329b"),r=a("a300").a,n=a("17cc"),s=Object(n.a)(r,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"slide-right"}},[e.show?a("page-content",{attrs:{mode:"dialog",title:"户型图","on-close":e.closePopup}},[a("drawing",{staticStyle:{flex:"1"},attrs:{url:e.url,points:e.points,folder:e.folder},on:{onclick:e.onclick}}),"multiple-remark"===e.mode?a("app-button-group",{attrs:{"fixed-bottom":"",seamless:""}},[a("app-button",{staticStyle:{width:"50%"},attrs:{type:e.points.length?"warning":"normal",plain:""},on:{click:e.undo}},[e._v("\n        撤销\n      ")]),a("app-button",{on:{click:e.sure}},[e._v(" 确定 ")])],1):e._e()],1):e._e()],1)}),[],!1,null,null,null).exports,o=!1;o||(o=new(i.default.extend(s))({el:document.createElement("div")}),document.body.appendChild(o.$el));t.a=o},b747:function(e,t,a){"use strict";a("f548"),a("9dd9"),a("cc57");var i={name:"UserSelectItem",components:{Item:a("07d2").default},props:{name:{type:String},post:{type:String},headPortrait:{type:String,default:""},multi:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},keyword:{type:String,default:""}},data:function(){return{}},computed:{showName:function(){var e="";if(""===this.keyword)e=this.name;else{var t=new RegExp("("+this.keyword+")","gmi");e=this.name.replace(t,'<span color="color-theme">$1</span>')}return e}}},r=(a("7583"),a("17cc")),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("item",e._g({class:{"item-disabled":e.disabled},attrs:{border:"bottom"}},e.$listeners),[e.headPortrait?a("img",{staticClass:"item-headimg",attrs:{src:e.headPortrait}}):e._e(),a("div",{staticClass:"item-text",class:{"color-theme":!e.multi&&e.selected}},[a("span",{domProps:{innerHTML:e._s(e.showName)}}),e.post?a("span",[e._v("("+e._s(e.post)+")")]):e._e()]),e.multi?a("icon",{attrs:{name:e.selected?"checkbox-checked":"checkbox"}}):a("icon",{attrs:{name:e.selected?"qualified":""}})],1)}),[],!1,null,"1a7b90ef",null);t.a=n.exports},bf9f:function(e,t,a){"use strict";var i={props:{title:{type:String,default:""},value:{type:Boolean,default:!1},height:{type:String,default:"70%"}},data:function(){return{show:this.value}},watch:{value:function(e){e!==this.show&&(this.show=e)},show:function(e){e!==this.value&&this.$emit("input",e)}},methods:{closePopup:function(){this.show=!1}}},r=(a("f4c9"),a("17cc")),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("van-popup",e._g({staticClass:"popup-customize-use-header",style:{height:e.height},attrs:{position:"bottom",round:"","get-container":"#app","safe-area-inset-bottom":"","close-on-popstate":""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},e.$listeners),[a("div",{staticClass:"popup-header"},[a("div",{staticClass:"popup-header__left"},[e._t("header_left")],2),a("div",{staticClass:"popup-header__title"},[e._v(e._s(e.title))]),a("div",{staticClass:"popup-header__right"},[e._t("header_right",[a("icon",{staticClass:"f-gray",attrs:{name:"nav-close"},on:{click:e.closePopup}})])],2)]),a("div",{staticClass:"popup-body"},[e._t("body_main")],2)])],1)}),[],!1,null,"5fef0434",null);t.a=n.exports},c070:function(e,t,a){var i=a("574c");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("35590dcb",i,!0,{sourceMap:!1,shadowMode:!1})},c081:function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .f-blue[data-v-3ce9ba4e]{color:#4275e8!important}.zjapp .f-gray[data-v-3ce9ba4e]{color:#666}[data-v-3ce9ba4e] .app-search-bar .border-bottom{background-image:none}[data-v-3ce9ba4e] .van-tabs__nav{padding-left:8%;padding-right:8%}[data-v-3ce9ba4e] .van-tabs__wrap:after{border-width:0;border-bottom-width:1px}.zjapp .triangle[data-v-3ce9ba4e]{font-size:14px;margin-right:8px;color:#c8c8c8;transform:rotate(0deg)}.zjapp .triangle.translate[data-v-3ce9ba4e]{color:transparent}.zjapp .triangle-down[data-v-3ce9ba4e]{transform:rotate(90deg)}.zjapp .tab-box[data-v-3ce9ba4e]{overflow:auto;padding-bottom:50px}.zjapp .selected[data-v-3ce9ba4e]{position:relative;flex-shrink:0;z-index:3;padding:5px 15px 10px 60px;line-height:24px;background-color:#fff;scroll-behavior:smooth;border:none;background-image:linear-gradient(0deg,#dcdcdc,#dcdcdc 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}.zjapp .selected-label[data-v-3ce9ba4e]{position:absolute;top:10px;left:15px;line-height:24px;font-size:16px;color:#999}.zjapp .selected-item[data-v-3ce9ba4e]{position:relative;display:inline-block;min-height:24px;line-height:20px;padding:2px 20px 2px 5px;margin:5px 5px 0 0;font-size:14px;color:#666;background-color:#f4f4f4;border-radius:4px}.zjapp .select_result[data-v-3ce9ba4e]{max-height:90px;overflow-y:auto}.zjapp .selected-remove[data-v-3ce9ba4e]{position:absolute;top:0;right:0;width:20px;height:24px;line-height:24px;text-align:center;font-size:8px;color:#ccc}.zjapp .selected-item-disabled[data-v-3ce9ba4e]{padding:2px 5px}.zjapp .selected-item-disabled .selected-remove[data-v-3ce9ba4e]{display:none}.zjapp .scroll-wrap[data-v-3ce9ba4e]{flex:1;background:#fff;height:100%;overflow:auto;transform:translateZ(0)}.zjapp .fixed[data-v-3ce9ba4e]{position:absolute;top:0;left:0;right:0;background-color:#fff;z-index:4}.zjapp .part-title[data-v-3ce9ba4e]{padding:9px 15px 5px 15px;line-height:18px;font-size:12px;color:#999;background-color:#f4f4f4}.zjapp .item[data-v-3ce9ba4e]{align-items:center}.zjapp .item>[class*=icon-checkbox][data-v-3ce9ba4e]{margin-right:10px}.zjapp .body-box[data-v-3ce9ba4e]{display:flex;flex-direction:column;width:100%;flex:1}",""])},c351:function(e,t,a){var i=a("017a");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("73ddfab9",i,!0,{sourceMap:!1,shadowMode:!1})},c40a:function(e,t,a){"use strict";(function(e){a("cc57"),a("6d57"),a("6f84"),a("163d");var i=a("a32d"),r=a.n(i),n=a("e900"),s=a("3122"),o=a("4ad6"),c=a("3bd5"),l=a("1b7e");function d(e){var t=e.changedTouches.length,a=e.touches.length;return 1===t||2===t||2===a}function p(e){return 1===e.touches.length}t.a={name:"Drawing",props:{url:{type:String},points:{type:Array,default:function(){return[]}},regions:{type:Array,default:function(){return[]}},pointColor:{type:String,default:"#ff4546"},pointRadius:{type:Number,default:7},scaleMax:{type:Number,default:4},clickDelay:{type:Number,default:500},folder:{type:String,default:"house-image"},onlineMode:{type:Boolean,default:!1},contentScroll:{type:Boolean,default:!0}},data:function(){return{isDownloading:!1,error:"",canvas:null,ctx:null,img:null,src:"",width:0,height:0,x:0,y:0,scale:1,defaultScale:1,pixelRatio:1,markPosition:null,markPositionImageData:[],markCoordinates:[],pinchRatio:0,scaleBetween:[],isPinch:!1,clickPoints:[],touchStart:{x:0,y:0,cx:0,cy:0,time:0}}},watch:{url:function(){this.getImage()},points:function(e){this.ctx&&this.draw()},regions:function(e){this.ctx&&this.draw()}},mounted:function(){this.getImage()},destroyed:function(){this.canvas&&(this.canvas.width=0,this.canvas.height=0)},methods:{getImage:function(){var t=this;if(this.isDownloading=!0,this.url){var a=c.a.getUser().user_id,i=r.a.replaceAll(this.url,"\\?x-oss-process=image\\/resize,","@"),n=r.a.strRightBack(i,"/");if(!n)return this.error="户型图地址错误",void(this.isDownloading=!1);this.error="";var d=[o.a.appImagePath()+a+"/"+this.folder+"/"+n,o.a.appImagePath()+a+"/house-image/"+n,o.a.appImagePath()+a+"/drawing/"+n,o.a.appImagePath()+a+"/location-image/"+n,o.a.appImagePath()+a+"/images/"+n,o.a.appDataPath()+a+"/"+this.folder+"/"+n,o.a.appDataPath()+a+"/house-image/"+n,o.a.appDataPath()+a+"/drawing/"+n,o.a.appDataPath()+a+"/location-image/"+n,o.a.appDataPath()+a+"/images/"+n],p=Promise.resolve();return"dev"===APP_ENV||this.onlineMode?p=p.then((function(){return t.url})):e.each(d,(function(e){p=p.then((function(t){return t||o.a.isFileExists(e).then((function(t){if(t)return s.a._fixPath(e)}))}))})),p.then((function(e){if(!e)return l.a.getHasNetwork().then((function(e){return e?s.a.download(t.url,!0,t.folder).then((function(e){t.src=e})):Promise.reject("当前无网络")}));t.src=e})).then((function(){t.src?(t.img=new Image,t.img.onload=function(){t.img.complete?(t.isDownloading=!1,t.$nextTick(t.init)):(t.error="加载图片失败",t.isDownloading=!1)},t.img.onerror=function(){t.error="加载图片失败",t.isDownloading=!1},t.img.src=t.src):(t.error="下载户型图失败",t.isDownloading=!1)})).catch((function(a){t.error=e.isString(a)?a:"下载户型图失败",t.isDownloading=!1}))}this.error="户型图地址错误",this.isDownloading=!1},init:function(){if(this.$refs["drawing-canvas"]){var e=this.$refs.content;this.canvas=this.$refs["drawing-canvas"],this.ctx=this.canvas.getContext("2d"),this.width=e.offsetWidth,this.height=e.offsetHeight,this.pixelRatio=this.getPixelRatio(this.ctx),this.canvas.style.height=this.height+"px",this.canvas.style.width=this.width+"px",this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,!this.ctx.extended&&Object(n.a)(this.ctx),this.bindTouchEvent(),this.calc(),this.draw()}},getPixelRatio:function(e){var t=e.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},calc:function(e){var t=this.width/this.img.width,a=this.img.height*t,i=this.height||a;a>this.height&&(t*=i/a),this.scale=t*this.pixelRatio,this.defaultScale=this.scale,this.scaleBetween=[this.scale,this.scale*this.scaleMax]},winToCanvas:function(e,t){var a=this.canvas.getBoundingClientRect();return{x:e-a.left*(this.canvas.width/(a.width*this.pixelRatio)),y:t-a.top*(this.canvas.height/(a.height*this.pixelRatio))}},isBoundary:function(e){switch(e){case"t":if(0===this.y)return!0;break;case"r":if(this.x<=this.canvas.width-this.img.width*this.scale)return!0;break;case"b":if(this.y<=this.img.height*this.scaleBetween[0]-this.img.height*this.scale)return!0;break;case"l":if(0===this.x)return!0}return!1},bindTouchEvent:function(){this.canvas.addEventListener("touchstart",this.onTouchstart),this.canvas.addEventListener("touchmove",this.onTouchmove),this.canvas.addEventListener("touchend",this.touchMoveAndEndHandler)},unbindTouchEvent:function(){this.canvas.removeEventListener("touchstart",this.onTouchstart),this.canvas.removeEventListener("touchmove",this.onTouchmove),this.canvas.removeEventListener("touchend",this.touchMoveAndEndHandler)},onTouchstart:function(e){if(this.isPinch=!1,p(e)){var t=e.touches[0],a=this.winToCanvas(t.clientX,t.clientY);this.touchStart={x:a.x,y:a.y,cx:t.clientX,cy:t.clientY,time:Date.now()}}else if(d(e)){var i,r=e.touches[0],n=e.touches[1],s=this.winToCanvas(r.clientX,r.clientY),o=this.winToCanvas(n.clientX,n.clientY);i=Math.sqrt(Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2)),this.pinchRatio=this.scale/i}},onTouchmove:function(e){if(!1===this.contentScroll&&(e.preventDefault(),e.stopPropagation()),p(e))this.touchStart.cy>e.pageY&&this.isBoundary("b")||this.touchStart.cy<e.pageY&&this.isBoundary("t")||this.touchStart.cx>e.pageX&&this.isBoundary("r")||this.touchStart.cx<e.pageX&&this.isBoundary("l")||e.stopPropagation(),this.touchMoveAndEndHandler(e);else if(d(e)){e.stopPropagation();var t,a,i,r,n,s=e.touches[0],o=e.touches[1],c=this.winToCanvas(s.clientX,s.clientY),l=this.winToCanvas(o.clientX,o.clientY);a=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2)),this.isPinch=!0,(t=this.pinchRatio*a)>this.scaleBetween[0]&&t<this.scaleBetween[1]&&(r={x:((i={x:(c.x+l.x)/2*this.pixelRatio,y:(c.y+l.y)/2*this.pixelRatio}).x-this.x)/(this.img.width*this.scale),y:(i.y-this.y)/(this.img.height*this.scale)},i.newX=this.x+this.img.width*t*r.x,i.newY=this.y+this.img.height*t*r.y,n={x:i.newX-i.x,y:i.newY-i.y},t<this.scale&&this.setRange(this.x-n.x,this.y-n.y,t),t>this.scale&&(this.x=this.x-n.x,this.y=this.y-n.y),t!==this.scale&&(this.scale=t,this.draw()))}},touchMoveAndEndHandler:function(e){var t,a,i=e.type,r={touchmove:e.touches[0],touchend:e.changedTouches[0]}[i],n=this.winToCanvas(r.clientX,r.clientY);t=(n.x-this.touchStart.x)*this.pixelRatio,a=(n.y-this.touchStart.y)*this.pixelRatio,"touchend"===i&&Date.now()-this.touchStart.time<this.clickDelay&&Math.abs(r.clientX-this.touchStart.cx)<6&&Math.abs(r.clientY-this.touchStart.cy)<6?this.clickHandler(e):"touchmove"!==i||this.isPinch||(this.touchStart.x=n.x,this.touchStart.y=n.y,this.setRange(this.x+t,this.y+a,this.scale),this.draw())},isCanClick:function(e){for(var t=!1,a=0;a<this.markPosition.length;a++)if(parseFloat(e.x)>parseFloat(this.markPosition[a].x)&&parseFloat(e.x)<parseFloat(this.markPosition[a].x)+parseFloat(this.markPosition[a].w)&&parseFloat(e.y)>parseFloat(this.markPosition[a].y)&&parseFloat(e.y)<parseFloat(this.markPosition[a].y)+parseFloat(this.markPosition[a].h)){t=!0;break}return t},clickHandler:function(e){var t=e.changedTouches[0];if(this.mark){var a=this.winToCanvas(t.clientX,t.clientY),i={x:(a.x-this.x/this.pixelRatio)/(this.img.width*this.scale/this.pixelRatio),y:(a.y-this.y/this.pixelRatio)/(this.img.height*this.scale/this.pixelRatio)};if(a={x:i.x*this.img.width,y:i.y*this.img.height},this.isCanClick(a)){this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(a.x*this.scale/this.pixelRatio+this.x/this.pixelRatio,a.y*this.scale/this.pixelRatio+this.y/this.pixelRatio,this.scale===this.defaultScale?this.pointRadius:this.pointRadius*(1+(this.scale-this.defaultScale)/this.pixelRatio),0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore();var r={x:a.x,y:a.y};this.markCoordinates.push(r),this.points.push(r)}return!1}this.redraw(e,this.winToCanvas(t.clientX,t.clientY))},setRange:function(e,t,a){var i=this.img.width*a,r=this.img.height*a,n=this.canvas.width,s=this.canvas.height,o=this.img.height*this.scaleBetween[0];e=i<n?(n-i)/2:(e=e+i<n?n-i:e)>0?0:e,t=r<s?(s-r)/2:(t=t+r<o?o-r:t)>0?0:t,this.x=e,this.y=t},draw:function(){this.setRange(this.x,this.y,this.scale),this.drawImage(),this.drawPoints(),this.drawRegions()},redraw:function(e,t){this.clickPoints=[],this.drawImage(),this.drawPoints(t),this.drawRegions(t),this.clickCallback(e,this.clickPoints)},clickCallback:function(e,t){var a;t.some((function(e,t){return"points"===e.tag?(a=e,!0):(a=e,!1)}));var i=e.changedTouches[0],r=this.winToCanvas(i.clientX,i.clientY),n=(r.x-this.x/this.pixelRatio)/(this.img.width*this.scale/this.pixelRatio),s=(r.y-this.y/this.pixelRatio)/(this.img.height*this.scale/this.pixelRatio);(r={x:parseFloat((n*this.img.width).toFixed(2)),y:parseFloat((s*this.img.height).toFixed(2))}).y>=0&&r.x>=0&&r.y<=this.img.height&&r.x<=this.img.width&&this.$emit("onclick",{type:a?"point":"",points:this.points,point:a,clickPoint:a,x:r.x,y:r.y,scale:this.scale/this.pixelRatio})},drawImage:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,0,0,this.img.width,this.img.height,this.x,this.y,this.img.width*this.scale,this.img.height*this.scale)},drawPoints:function(e){var t=this;this.points.forEach((function(a,i){t.drawPoint(a.x*t.scale/t.pixelRatio+t.x/t.pixelRatio,a.y*t.scale/t.pixelRatio+t.y/t.pixelRatio,t.pointRadius,i,e,a.color)}))},drawPoint:function(e,t,a,i,r,n){this.ctx.save(),this.ctx.beginPath(),this.ctx.shadowBlur=a/2,this.ctx.shadowColor="black",this.ctx.fillStyle=n||this.pointColor,this.ctx.arc(e,t,a,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.shadowColor="transparent",this.ctx.restore(),a*=2,this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="transparent",this.ctx.fillStyle="transparent",this.ctx.rect(e-a,t-a,2*a,2*a),this.ctx.stroke(),this.ctx.restore(),r&&this.ctx.isPointInPath(r.x*this.pixelRatio,r.y*this.pixelRatio)&&this.clickPoints.push({tag:"points",pos:r,index:i})},drawRegions:function(e){var t=this;this.regions&&this.regions.length&&this.regions.forEach((function(a,i){var r,n,s,o;t.ctx.beginPath(),a.area.forEach((function(e,a){var i=e[0]*t.scale/t.pixelRatio+t.x/t.pixelRatio,c=e[1]*t.scale/t.pixelRatio+t.y/t.pixelRatio;a?t.ctx.lineTo(i,c):t.ctx.moveTo(i,c),r=void 0===r?i:r<i?r:i,n=void 0===n?i:n>i?n:i,s=void 0===s?c:s<c?s:c,o=void 0===o?c:o>c?o:c})),t.ctx.closePath(),t.ctx.fillStyle="rgba(255, 144, 0, 0.4)",t.ctx.fill(),t.ctx.lineWidth=3,t.ctx.strokeStyle="#feda8e",t.ctx.stroke(),t.ctx.lineWidth=2,t.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",t.ctx.stroke(),e&&t.ctx.isPointInPath(e.x*t.pixelRatio,e.y*t.pixelRatio)&&t.clickPoints.push({tag:"region",pos:e,index:i,regionData:a}),t.ctx.font='18px bold -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',t.ctx.textAlign="center",t.ctx.lineWidth=4,t.ctx.strokeStyle="#ffffff",t.ctx.strokeText(a.name,(n+r)/2,(o+s)/2+10),t.ctx.fillStyle="#111111",t.ctx.fillText(a.name,(n+r)/2,(o+s)/2+10)}))}}}}).call(this,a("391c"))},c65d:function(t,a,i){"use strict";(function(t){i("6a61");var r,n,s=i("2e91"),o=i("1b7e"),c=i("e2a7"),l=i("4ad6"),d=i("3122"),p="00:00",u="00:00";a.a={name:"AppVoiceRecord",components:{},props:{value:{type:Array,default:function(){return[]}},isText:{type:Boolean,default:!1},isDelete:{type:Boolean,default:!1}},data:function(){return{sound:null,isPlay:"start",seekTime:null,progress:0,seekText:p,duration:u,initDuratin:0,disabled:!0,startDrap:!1,src:[],text:""}},computed:{isEmpty:function(){return t.isEmpty(this.value)}},watch:{value:function(e){var a=this;this.$nextTick((function(){t.isEmpty(e)||a.init()}))}},created:function(){this.init()},deactivated:function(){this.closeHowler()},methods:{init:(n=Object(s.a)(regeneratorRuntime.mark((function e(){var a,i,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.value[0],!t.isEmpty(a)){e.next=3;break}return e.abrupt("return");case 3:i=Math.ceil(a.duration),r=null,a.voiceUrl?r=a.voiceUrl:a.voiceTemp&&(r=d.a.fixUrl(a.voiceTemp)),this.text=a.text,this.sound=null,this.src=r,this.duration=this.formatTime(i),this.initDuratin=i,this.disabled=!0,this.startDrap=!1,$log.log("语音初始化：",this.value);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),player:function(){$log.log("语音加载中-路径：",this.src);var e=new Audio;e.src=this.src,this.isPlay="loading",e.removeEventListener("canplaythrough",this.load),e.addEventListener("canplaythrough",this.load,!1),e.removeEventListener("error",this.error),e.addEventListener("error",this.error,!1),e.removeEventListener("playing",this.playing),e.addEventListener("playing",this.playing,!1),e.removeEventListener("pause",this.pause),e.addEventListener("pause",this.pause,!1),e.removeEventListener("ended",this.ended),e.addEventListener("ended",this.ended,!1),this.sound=e},load:function(){var e=this.sound.duration;e=Math.ceil(e),this.isPlay="middle",this.duration=this.formatTime(e),this.initDuratin=e,this.disabled=!1,$log.log("语音播放-加载完成",{"实际总时长":this.sound.duration,"显示时长":e})},error:function(t){var a=this;o.a.getHasNetwork().then((function(t){var i="播放失败";t||(i="当前无网络"),a.sound=null,a.isPlay="start",c.a.alert(i),$log.error("语音播放-加载异常",{"获取路径":e.currentTarget.src,"audio失败原因":e.currentTarget.error,"网络原因":!t})}))},playing:function(){$log.log("语音播放-开始时"),this.isPlay="middle",this.openInterval()},pause:function(){$log.log("语音播放-关闭时"),this.isPlay="start"},ended:function(){var e=this;$log.log("语音播放-播放完毕时"),cancelAnimationFrame(this.seekTime);var t=setTimeout((function(){e.isPlay="start",e.progress=0,e.seekText=p,clearTimeout(t)}),60)},unload:function(){this.sound&&this.sound.pause(),this.sound=null},startPlay:(r=Object(s.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sound){e.next=4;break}return e.next=3,this.init();case 3:this.player();case 4:this.sound.play(),0===this.sound.currentTime&&(this.seekText=p,this.progress=0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)}),pausePlay:function(){this.sound.pause(),this.isPlay="start"},loadingPlay:function(){this.unload(),this.sound=null,this.isPlay="start"},deleteVoive:function(){var e=this;c.a.confirm({message:"确定删除语音？",okText:"删除"},(function(){e.closeHowler();var t=e.value[0];t.voiceTemp&&l.a.deleteFile(t.voiceTemp),e.$emit("delte-voice",t.id)}))},closeHowler:function(){this.unload(),cancelAnimationFrame(this.seekTime)},dragStart:function(){this.startDrap=!0,cancelAnimationFrame(this.seekTime)},dragInput:function(e){var t=e/100,a=this.initDuratin*t;this.seekText=this.formatTime(Math.floor(a))},dragEnd:function(){this.startDrap=!1;var e=this.progress/100,t=this.initDuratin*e;this.sound&&(this.sound.paused?this.sound.play():this.openInterval(),this.sound.currentTime=t)},openInterval:function(){this.seekTime=requestAnimationFrame(this.step.bind(this))},step:function(){var e=this.sound,t=Math.ceil(e.currentTime||0),a=Math.ceil(e.duration);this.progress=Math.round(t/a*100),this.seekText=this.formatTime(t),e.paused||this.openInterval()},formatTime:function(e){var t=Math.floor(e/60)||0,a=Math.round(e-60*t)||0;return(t=t>=10?t:"0"+t)+":"+(a=a>=10?a:"0"+a)}}}}).call(this,i("391c"))},c6cf:function(e,t,a){"use strict";a("a207")},ca5c:function(e,t,a){"use strict";a.r(t);var i=a("8166").a,r=(a("9586"),a("17cc")),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("page-content",{attrs:{title:"问题详情","show-go-root":!0}},[a("template",{slot:"header-bar-right"},[e.isLoading?e._e():a("business-logs",{attrs:{id:e.problemData.id}}),"check"!==e.comeFrom&&e.problemData.checkItem&&e.problemData.checkItem.id?a("check-guide",{attrs:{"item-id":e.problemData.checkItem.id}}):e._e()],1),e.isLoading?e._e():a("problem-detail-header",{attrs:{status:e.problemData.status,"status-text":e.problemData.status_text,level:e.problemData.level,"is-timeout":e.problemData.is_timeout,"sent-back-times":e.problemData.sent_back_times}}),e.isLoading?e._e():a("div",{staticClass:"page-scroll"},[a("div",{staticClass:"list mb10"},[a("item",{attrs:{label:"标段",text:e.problemData.bidsection_name+"（"+e.problemData.proj_name+"）"}}),e.problemData.place&&e.problemData.place.full_name?a("item",{attrs:{label:"部位"}},[a("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[e._v("\n          "+e._s(e.problemData.place.full_name)+"\n          "),e.problemData.place_point.length?a("span",{staticClass:"icon-huxing-mark ml10",on:{click:e.showHuxingMark}},[e._v("\n            图\n          ")]):e._e()])]):e._e(),a("item",{attrs:{label:"检查项",text:e.problemData.checkItem.full_name}}),e.problemData.description.name?a("item",{attrs:{label:"描述",text:e.problemData.description.name}}):e._e(),e.problemData.remark||e.problemData.voice_file&&e.problemData.voice_file.length?a("item",{attrs:{label:"补充说明"}},[a("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[a("p",[e._v(e._s(e.problemData.remark||""))]),a("app-voice-play",{attrs:{value:e.problemData.voice_file,"is-text":!0}})],1)]):e._e(),e.problemData.image_file&&e.problemData.image_file.length?a("item",{attrs:{label:"问题照片"}},[a("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[a("item-img-list",{attrs:{editabled:!1},model:{value:e.problemData.image_file,callback:function(t){e.$set(e.problemData,"image_file",t)},expression:"problemData.image_file"}})],1)]):e._e(),a("user-select",{attrs:{title:"提交人",date:e._f("formatDate")(e.problemData.regist_date),mode:"view",editabled:!1},model:{value:e.problemData.regist,callback:function(t){e.$set(e.problemData,"regist",t)},expression:"problemData.regist"}}),a("item",{attrs:{label:"整改期限",text:e.problemData.repair_deadline,editabled:e.allowChangeRepairDeadline},on:{click:function(t){e.selectDeadline()}}}),a("item",{attrs:{label:"整改要求",text:e.problemData.repair_requirements}}),e.problemData.repair_set&&e.problemData.repair_set.id?e._e():a("user-select",{attrs:{options:e.repairOptions,title:"整改人",date:e._f("formatDate")(e.problemData.repair_date),mode:"view",editabled:e.allowChangeRepair,"is-read":e.problemData.repair.id===e.user.user_id?"":1===e.problemData.has_read||0!==e.problemData.has_read&&"","before-select":e.beforeChangeRepair},on:{onSelect:e.changeRepair},model:{value:e.problemData.repair,callback:function(t){e.$set(e.problemData,"repair",t)},expression:"problemData.repair"}}),e.problemData.repair_set&&e.problemData.repair_set.id?a("user-select",{attrs:{options:e.repairOptions,title:"整改人",date:e._f("formatDate")(e.problemData.repair_date),mode:"view",editabled:e.allowChangeRepair,"is-read":e.problemData.repair_set.id===e.user.user_id?"":1===e.problemData.has_read||0!==e.problemData.has_read&&"","before-select":e.beforeChangeRepair},on:{onSelect:e.changeRepair},model:{value:e.problemData.repair_set,callback:function(t){e.$set(e.problemData,"repair_set",t)},expression:"problemData.repair_set"}}):e._e(),e.problemData.repair_image_file&&e.problemData.repair_image_file.length>0||e.allowRepair?a("item",{attrs:{label:"整改照片"}},[a("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[e.problemData.repair_remark&&!e.allowRepair?a("p",{staticClass:"mb10"},[e._v("\n            "+e._s(e.problemData.repair_remark)+"\n          ")]):e._e(),a("item-img-list",{attrs:{editabled:e.allowRepair,maxlength:15},on:{callback:e.repairRemarkUpdate},model:{value:e.problemData.repair_image_file,callback:function(t){e.$set(e.problemData,"repair_image_file",t)},expression:"problemData.repair_image_file"}})],1)]):e._e(),e.problemData.repair_image_file.length||!e.problemData.repair_remark||e.allowRepair?e._e():a("item",{attrs:{label:"整改补充说明",text:e.problemData.repair_remark}}),e.allowRepair?a("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"整改补充说明"},on:{blur:e.repairRemarkUpdate},model:{value:e.problemData.repair_remark,callback:function(t){e.$set(e.problemData,"repair_remark",t)},expression:"problemData.repair_remark"}}):e._e(),e.allowChangeReinspect?a("user-select",{attrs:{options:e.reinspectOptions,multi:!0,title:"复验人",mode:"view",editabled:e.allowChangeReinspect,max:4,"max-tip":"最多4个复验人","before-select":e.beforeChangeReinspect},on:{onSelect:e.changeReinspect},model:{value:e.problemData.reinspect_set,callback:function(t){e.$set(e.problemData,"reinspect_set",t)},expression:"problemData.reinspect_set"}}):e._e(),e.allowChangeReinspect?e._e():e._l(e.problemData.reinspectBy,(function(t,i){return a("div",{key:i},[a("user-select",{attrs:{value:t,title:"复验人",date:t.reinspect_date?e.fomatDate(t.reinspect_date):"",mode:"view",editabled:!1,note:!t.reinspect_date&&e.problemData.reinspectBy.length>1?"尚未复验":""}}),(t.reinspect_remark||t.reinspect_image_file.length>0)&&t.reinspect_date?a("item",[a("div",{staticClass:"item-label"}),a("div",{staticClass:"item-con"},[t.reinspect_remark?a("p",[e._v(e._s(t.reinspect_remark))]):e._e(),t.reinspect_image_file.length>0?a("item-img-list",{attrs:{editabled:!1},model:{value:t.reinspect_image_file,callback:function(a){e.$set(t,"reinspect_image_file",a)},expression:"reinspect.reinspect_image_file"}}):e._e()],1)]):e._e()],1)})),e.allowReinspectPass?a("item",{attrs:{label:"复验照片"}},[a("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[a("item-img-list",{attrs:{maxlength:15},model:{value:e.problemData.currentReinspectBy.reinspect_image_file,callback:function(t){e.$set(e.problemData.currentReinspectBy,"reinspect_image_file",t)},expression:"problemData.currentReinspectBy.reinspect_image_file"}})],1)]):e._e(),e.allowReinspectPass?a("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"复验补充说明（选填）"},model:{value:e.problemData.currentReinspectBy.reinspect_remark,callback:function(t){e.$set(e.problemData.currentReinspectBy,"reinspect_remark",t)},expression:"problemData.currentReinspectBy.reinspect_remark"}}):e._e(),e.problemData.sent_back_remark?a("item",{attrs:{label:"退回原因"}},[a("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[a("p",{class:{pb10:e.problemData.sent_back_image_file.length}},[e._v("\n            "+e._s(e.problemData.sent_back_remark)+"\n          ")]),e.problemData.sent_back_image_file.length?a("item-img-list",{attrs:{editabled:!1},model:{value:e.problemData.sent_back_image_file,callback:function(t){e.$set(e.problemData,"sent_back_image_file",t)},expression:"problemData.sent_back_image_file"}}):e._e()],1)]):e._e(),a("user-select",{attrs:{options:e.ccOptions,title:"抄送人",multi:!0,mode:"view",editabled:e.allowChangeCC},on:{onSelect:e.changeCC},model:{value:e.problemData.cc_set,callback:function(t){e.$set(e.problemData,"cc_set",t)},expression:"problemData.cc_set"}}),a("single-select",{attrs:{options:e.contractorOptions,"if-toggle":!0,title:"责任单位",mode:"view",editabled:e.allowChangeContractor},on:{onSelect:e.changeContractor},model:{value:e.problemData.contractor,callback:function(t){e.$set(e.problemData,"contractor",t)},expression:"problemData.contractor"}}),e.problemData.close_date?a("item",{attrs:{label:"关闭时间",text:e.problemData.close_date}}):e._e(),e.problemData.close_reason?a("item",{attrs:{label:"关闭原因",text:e.problemData.close_reason}}):e._e(),e.problemData.leaderComments&&e.problemData.leaderComments.length>0?[a("item",{attrs:{label:"批示"}},[a("div",{staticClass:"item-text leader-comment",attrs:{slot:"right"},slot:"right"},e._l(e.problemData.leaderComments,(function(t,i){return a("div",{key:i,staticClass:"comment-item"},[a("check-user-contact",{attrs:{list:[t.user]}}),a("p",{staticClass:"comment-time"},[e._v(e._s(t.comment_on))]),t.content?a("p",[e._v(e._s(t.content))]):e._e(),t.image_file&&t.image_file.length?[a("item-img-list",{attrs:{editabled:!1},model:{value:t.image_file,callback:function(a){e.$set(t,"image_file",a)},expression:"leaderComment.image_file"}})]:e._e()],2)})))])]:e._e()],2),a("app-button-group",{attrs:{direction:"column"}},[e.allowView&&e.allowReinspectPass?a("app-button",{on:{click:e.reinspectSubmit}},[e._v("\n        通过\n      ")]):e._e(),e.allowView&&e.allowRepair?a("app-button",{on:{click:e.repairSubmit}},[e._v(" 完成整改 ")]):e._e(),e.allowView&&e.allowReinspectReject?a("app-button",{attrs:{type:"warning",plain:"",rimless:""},on:{click:e.back}},[e._v("\n        退回\n      ")]):e._e(),e.allowView&&e.allowClose?a("app-button",{attrs:{type:"warning",plain:"",rimless:""},on:{click:e.close}},[e._v("\n        非正常关闭\n      ")]):e._e(),"check"===e.comeFrom?a("app-button",{directives:[{name:"track",rawName:"v-track",value:"现场检查-问题详情页-复制问题",expression:"'现场检查-问题详情页-复制问题'"}],attrs:{type:"text"},on:{click:e.copyProblem}},[e._v("\n        复制问题\n      ")]):e._e()],1)],1),a("loading-status",{attrs:{"is-loading":e.isLoading,"is-empty":!e.problemData.id,"empty-text":"加载问题失败"}})],2)}),[],!1,null,"451b00f8",null);t.default=n.exports},cdce:function(e,t,a){"use strict";(function(e){a("cc57");var i=a("4360"),r=a("3bd5"),n=a("1601"),s=a("e2a7"),o=a("6f9e");t.a={name:"CheckUserContact",props:{list:{type:Array,default:function(){return[]}}},data:function(){return{popupOpenItemId:"",popupL:"50%",arrowL:"50%",popupUserPosiBottom:!1}},computed:{allowIM:function(){return window&&window.$rootScope&&window.$rootScope.allowIM},userInfo:function(){return r.a.getUser()}},created:function(){o.a.$on("pageContentClick",this.closeImPopup)},destroyed:function(){o.a.$off("pageContentClick",this.closeImPopup)},methods:{hasIm:function(e){return!!parseInt(e.is_im_user)},openImPopup:function(e,t){if($log.log("打开聊天窗口",e),o.a.$emit("pageContentClick"),this.popupOpenItemId=e.id,t&&t.target){var a=t.target.getBoundingClientRect(),r=window.innerWidth,n=i.a.state.app.isIOS?i.a.state.app.isIOSBezelLess?88:64:44;a.top<n+68?this.popupUserPosiBottom=!0:this.popupUserPosiBottom=!1,r-a.right<50?(this.popupL=16-(50-(r-a.right))+"px",this.arrowL=50-(r-a.right)+65+"px"):(this.popupL="50%",this.arrowL="50%")}},closeImPopup:function(){this.popupOpenItemId=""},openIm:function(t){var a=this.isImDisabled(t),i=this.allowIM&&!a;if(console.log(a,i,this.allowIM),i)if(e.has(t,"headimg_url")){var r=this.userInfo.tenant_code+"_"+t.id;n.a.openIm(r,t.name,t.headimg_url).catch((function(e){s.a.alert(e)}))}else n.a.openUserChat(t.id).catch((function(e){s.a.alert(e)}));else s.a.alert("聊天功能优化中暂不可用")},isImDisabled:function(e){return 1!==parseInt(e.is_im_user)||e.id===this.userInfo.user_id}}}}).call(this,a("391c"))},cf0d:function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,'.zjapp .layout-main[data-v-0a266c44] .layout-content{overflow:auto}.zjapp .datepicker-hd[data-v-0a266c44]{display:flex;text-align:center;padding:5px 5px 15px 5px}.zjapp .datepicker-hd-center[data-v-0a266c44]{flex:1;display:flex;padding:10px 5px}.zjapp .datepicker-month[data-v-0a266c44],.zjapp .datepicker-year[data-v-0a266c44]{position:relative;flex:1;border:none;border-bottom:1px solid #4374ea;padding:0;line-height:26px;font-size:14px;text-align:center}.zjapp .datepicker-month[data-v-0a266c44]{margin-left:10px}.zjapp .datepicker-month[data-v-0a266c44]:after,.zjapp .datepicker-year[data-v-0a266c44]:after{position:absolute;top:50%;right:5px;margin-top:-3px;width:0;height:0;border-top:5px solid;border-right:5px solid transparent;border-left:5px solid transparent;content:"";pointer-events:none;color:#4374ea}.zjapp .datepicker-next[data-v-0a266c44],.zjapp .datepicker-prev[data-v-0a266c44]{width:10%;padding:10px 5px;font-size:24px;color:#4374ea}.zjapp .select-list[data-v-0a266c44]{position:absolute;top:27px;left:0;width:100%;max-height:380px;overflow:auto;background-color:#fff;box-shadow:0 0 5px #333}.zjapp .select-item[data-v-0a266c44]{padding:5px;height:38px;line-height:28px}.zjapp .item-selected[data-v-0a266c44]{background-color:#4374ea;color:#fff}.zjapp .weeks-row[data-v-0a266c44]{padding:5px;display:flex}.zjapp .weeks-cell[data-v-0a266c44]{flex:1;line-height:20px;text-align:center;font-size:14px;font-weight:700}.zjapp .date-row[data-v-0a266c44]{padding:0 5px;display:flex}.zjapp .date-cell[data-v-0a266c44]{flex:1;height:50px;line-height:50px;text-align:center;font-size:14px}.zjapp .date-cell-selected[data-v-0a266c44]{background-color:#4374ea;color:#fff;font-weight:700}.zjapp .date-cell.today[data-v-0a266c44]{border:1px solid #4374ea}.zjapp .disabled[data-v-0a266c44]{pointer-events:none;color:#aaa}',""])},d23f:function(e,t,a){"use strict";(function(e){a("5ab2"),a("e10e"),a("e204"),a("6d57"),a("ed63"),a("8cf2"),a("e697");var i=a("28f8"),r=(a("cc57"),a("9dd9"),a("163d"),a("936a"),a("e2a7")),n=a("9eea"),s=a("774b"),o=a("07d2"),c=a("b747"),l=a("6144"),d=a("a18c"),p=a("4360"),u=a("bf9f"),h=a("3122");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var g={31:"施工单位",32:"监理单位",33:"建设单位"};t.a={name:"AppUserSelect",components:{appSearchBar:n.default,Scroller:s.default,Item:o.default,UserItem:c.a,PopupHasHeader:u.a},data:function(){return{getImageThumbnail:h.a.getImageThumbnail.bind(h.a),storageKey:encodeURI(this.title||"userSelectMark"),show:!1,searchStatus:!1,keyword:"",options:[],selected:[],disabled:[],max:1/0,maxTip:"",title:"",multi:!1,lastSelected:[],openSet:{},active:0,maxScrollHeight:0}},computed:{allRoleSelected:function(){var e=this,t=(this.roleGroup[this.active]||{}).children;return(void 0===t?[]:t).map((function(t){return e.disabledSet[t.id]?null:t.id})).filter(Boolean).every((function(t){return e.selectedSet[t]}))},canSelectAllRole:function(){return this.multi&&!Number.isFinite(this.max)},selectedSet:function(){var t={};return e.isArray(this.selected)?e.each(this.selected,(function(e){t[e.id]=!0})):this.selected&&this.selected.id&&(t[this.selected.id]=!0),t},disabledSet:function(){var t={};return e.each(this.disabled||[],(function(e){t[e.id]=!0})),t},roleGroup:function(){var t,a=this,i=[{id:31,name:"施工单位",children:[]},{id:32,name:"监理单位",children:[]},{id:33,name:"建设单位",children:[]}];t=this.keyword?e.filter(this.options,(function(e){return new RegExp("("+a.keyword.trim()+")","gmi").test(e.name)})):this.options,e.each(i,(function(a){a.children=e.filter(t,(function(e){return e.role===a.id}))}));var r=this.lastSelected.map((function(e){return f(f({},e),{},{role_name:"".concat(g[e.role],"-")})}));return console.log(r),i.push({name:"最近选择",children:r||[]}),i},contractorGroup:function(){var t=this,a=[];if(p.a.state.global.allowGroupUserByConstructor){var i,r={id:"other",name:"其他",children:[]};i=this.keyword?e.filter(this.options,(function(e){return new RegExp("("+t.keyword+")","gmi").test(e.name)})):this.options,e.each(i,(function(t){31===t.role&&(t.contractors&&t.contractors.length?e.each(t.contractors,(function(i){var r=e.find(a,(function(e){return e.id===i.id}));r||(r=f(f({},i),{},{children:[]}),a.push(r)),r.children.push(f({},t))})):r.children.push(f({},t)))})),e.isEmpty(r.children)||a.push(r)}return a},groupSelectedSet:function(){var t=this,a={};return e.each(this.roleGroup,(function(i){var r=e.some(i.children,(function(e){return!t.selectedSet[e.id]}));a[i.id]=!r})),e.each(this.contractorGroup,(function(i){var r=e.some(i.children,(function(e){return!t.selectedSet[e.id]}));a[i.id]=!r})),a}},watch:{keyword:function(e){this.setSearchOpenSet()},selected:function(){var e=this;this.$nextTick((function(){var t=e.$refs["select-box"],a=0;t&&(a=t.offsetHeight||0),$log.log("user-select选人组件",{desc:"选取结果高度",data:a}),e.maxScrollHeight=Math.floor(.93*$rootScope.viewSize.height-144-a)}))}},methods:{openPopup:function(t){this.active=0,t.selected=t.selected||[];var a=e.isArray(t.selected)?t.selected:[t.selected],i=e.filter(t.options,(function(t){return e.some(a,{id:t.id})||t.checked}));t.disabled=t.disabled||[];var r=e.isArray(t.disabled)?t.disabled:[t.disabled],n=e.filter(t.options,(function(t){return e.some(r,{id:t.id})||t.disabled}));this.show=!0,this.title=t.title,this.selected=i,this.disabled=n,this.options=t.options,this.multi=t.multi,this.onSelect=t.onSelect,this.beforeSelect=t.beforeSelect,this.beforeConfirm=t.beforeConfirm,this.max=t.max||1/0,this.maxTip=t.maxTip||"";var s=this.getLastSelected(),o=e.filter(t.options,(function(t){return e.includes(s,t.id)}));o=e.sortBy(o,(function(t){return e.indexOf(s,t.id)})),this.lastSelected=o,this.storageKey=encodeURI(this.title||"userSelectMark"),this.setDefaultOpen(),this.$refs["app-search-bar"]&&this.$refs["app-search-bar"].cancelSearch(),this.$emit("open")},setDefaultOpen:function(){var t=this;this.openSet={};var a=e.uniqBy(e.map(this.selected,"role"));e.each(a,(function(e){t.$set(t.openSet,e,!0)}));var i=[];e.each(this.selected,(function(e){e&&e.contractors&&e.contractors.length&&(i=i.concat(e.contractors))})),i=e.uniqBy(i,"id"),e.each(i,(function(e){t.$set(t.openSet,e.id,!0)}))},setSearchOpenSet:function(){var t=this;this.keyword?(e.each(this.roleGroup,(function(e){t.$set(t.openSet,e.id,!0)})),e.each(this.contractorGroup,(function(e){t.$set(t.openSet,e.id,!0)}))):this.setDefaultOpen()},toggleGroup:function(e){this.$set(this.openSet,e.id,!this.openSet[e.id])},getLastSetKey:function(){var e=d.a.history.current,t=e?e.name:"";return"".concat(p.a.state.global.currentProject.id,"-").concat(t,"-").concat(encodeURI(this.title))},saveLastSelected:function(t){if(t&&(e.isArray(t)||(t=[t]),!(t.length>11))){var a=this.getLastSelected();e.each(t,(function(e){a.unshift(e.id)})),(a=e.uniqBy(a)).length>11&&(a=a.splice(0,11));var i=this.getLastSetKey(),r=l.a.getUserObject("user-select-last-selected")||{};r[i]=a,l.a.saveUserObject("user-select-last-selected",r)}},getLastSelected:function(){var e=this.getLastSetKey();return(l.a.getUserObject("user-select-last-selected")||{})[e]||[]},closePopup:function(){this.show=!1,this.$emit("close")},onSure:function(){this.saveLastSelected(this.selected),this.onSelect(this.selected),this.closeEvent()},onConfirm:function(){var e=this,t=this.multi?this.beforeSelect(this.selected):null,a=this.beforeConfirm(this.selected);t instanceof Promise||(t=Promise.resolve(t)),a instanceof Promise||(a=Promise.resolve(a)),t.then((function(t){!1!==t&&a.then((function(t){!1!==t&&window.setTimeout((function(){e.onSure()}),300)}))}))},closeEvent:function(){this.closePopup(),this.$refs["app-search-bar"]&&this.$refs["app-search-bar"].cancelSearch(),this.onSearchTypeChange(!1)},onSearchTypeChange:function(e){this.searchStatus=e,e||(this.keyword="")},selectAllRole:function(){var e=this,t=this.roleGroup[this.active]||{},a=t.children||[],i=this.allRoleSelected;$log.log("user-select选人组件",{desc:"全选=>单位id-单位名称-选择之前的状态",data:{id:t.id,name:t.name,allSelected:i}});var r=a.filter((function(t){return!e.disabledSet[t.id]}));i?r.forEach((function(t){var a=e.selected.findIndex((function(e){return e.id===t.id}));~a&&e.selected.splice(a,1)})):r.forEach((function(t){~e.selected.findIndex((function(e){return e.id===t.id}))||e.selected.push(t)})),this.recordSearch()},selectedAll:function(t){var a=this;if(t&&t.children&&t.children.length){var i="";if(i=!this.groupSelectedSet[t.id]){var n=e.filter(t.children,(function(e){return!a.selectedSet[e.id]&&!a.disabledSet[e.id]})).length;if(this.selected.length+n>this.max)return void r.a.alert(this.maxTip||"最多选择".concat(this.max,"个"))}e.each(t.children,(function(t){if(!a.disabledSet[t.id]){var r=e.findIndex(a.selected,{id:t.id});r<0?i&&a.selected.unshift(t):i||a.selected.splice(r,1)}}))}},onSelectUser:function(t){var a=this;$log.log("user-select选人组件",{desc:"单选",data:t});var i=this.multi?null:this.beforeSelect(t);i instanceof Promise||(i=Promise.resolve(i)),i.then((function(i){if(!1===i)return!1;if(!a.disabledSet[t.id]){if(a.multi){var n=e.findIndex(a.selected,{id:t.id});if(n<0){if(a.selected.length>=a.max)return void r.a.alert(a.maxTip||"最多选择".concat(a.max,"个"));a.selected.unshift(t)}else a.selected.splice(n,1)}else a.selected=[t],window.setTimeout((function(){a.onSure()}),300);a.recordSearch()}}))},recordSearch:function(){this.$refs["app-search-bar"].saveHistory()}}}}).call(this,a("391c"))},d2d4:function(e,t,a){"use strict";a("2a54")},d6fa:function(e,t,a){"use strict";a("9ab7")},d77c:function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .layout-main[data-v-e24c0d3a] .layout-content{overflow:auto}[data-v-e24c0d3a] .item .icon{color:#4275e8}",""])},d866:function(e,t,a){"use strict";(function(e){a("5ab2"),a("6d57"),a("e10e");var i=a("28f8"),r=(a("cc57"),a("163d"),a("07d2")),n=a("b280"),s=a("6144");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t.a={name:"SingleSelect",components:{Item:r.default,PopupSingleSelect:n.a},props:{title:{type:String,default:""},border:{type:String,default:""},pageTitle:{type:String,default:""},placeholder:{type:String,default:""},value:{type:Object,default:function(){return{}}},options:{type:Array,default:function(){return[]}},optionsDisabled:{type:Array,default:function(){return[]}},required:{type:Boolean,default:!0},mode:{type:String,default:"edit"},editabled:{type:Boolean,default:!0},memory:{type:Boolean,default:!1},autoSelect:{type:Boolean,default:!1},beforeOpen:{type:Function,default:function(){}},searchBar:{type:Boolean,default:!0},grouping:{type:String,default:""},autoOpen:{type:Boolean,default:!1},rightBtn:{type:String,default:""},rightBtnEvent:{type:Function,default:function(){return 0}},ifToggle:{type:Boolean,default:!1},formCheck:{type:Boolean,default:!1},editorAddData:{type:Boolean,default:!1},lineLimit:{type:[Number,String],default:1}},data:function(){return{memoryKey:this.$route.name+encodeURI(this.title)}},watch:{options:function(){this.setSelected()}},mounted:function(){this.setSelected()},methods:{openSelect:function(){var t=this;if(this.editabled){var a=this.beforeOpen();a&&a.then&&e.isFunction(a.then)?a.then((function(e){!1!==e&&t.openPopup()})):!1!==a&&this.openPopup()}},openPopup:function(){var t=this;if(this.optionsDisabled&&this.optionsDisabled.length){var a={};e.each(this.optionsDisabled,(function(e){e.id&&(a[e.id]=e)})),e.each(this.options,(function(e,i){a[e.id]?t.options[i].disabled=!0:t.options[i].disabled=!1}))}this.$refs["popup-single-select"].openPopup({title:this.pageTitle||"选择"+this.title,selected:this.value,options:this.options,required:this.required,searchBar:this.searchBar,grouping:this.grouping,autoOpen:this.autoOpen,rightBtn:this.rightBtn,ifToggle:this.ifToggle,lineLimit:this.lineLimit,editorAddData:this.editorAddData,onSelect:function(a){var i=e.cloneDeep(t.value);a=e.isArray(a)?e.map(a,(function(e){return c({},e)})):c({},a),t.$emit("input",a,i),t.$emit("onSelect",a,i)},rightBtnEvent:function(a){var i=e.cloneDeep(t.value);t.$emit("rightBtnEvent",a,i)}})},closePopup:function(){this.$refs["popup-single-select"].closePopup()},onSelect:function(e){s.a.saveObject(this.memoryKey,e,s.a.level.user),this.$emit("input",e[0]),this.$emit("onSelect",e[0])},setSelected:function(){var t=s.a.getObject(this.memoryKey,s.a.level.user);!1===this.editabled||e.isEmpty(this.options)||(e.isEmpty(this.value)?this.memory&&!e.isEmpty(t)&&e.some(this.options,{id:t.id})&&(this.$emit("input",t),this.autoSelect&&this.$emit("onSelect",t)):this.autoSelect&&this.$emit("onSelect",this.value))}}}}).call(this,a("391c"))},da1c:function(e,t,a){"use strict";a.r(t);a("163d");var i=a("65a8"),r={name:"ProblemHeader",props:{status:{type:String,default:""},statusText:{type:String,default:""},level:{type:String,default:""},isTimeout:{type:Boolean,default:!1},sentBackTimes:{type:[Number,String],default:0}},data:function(){return{edOptions:{}}},created:function(){var e=this;i.a.getOptions("紧急程度").then((function(t){e.edOptions=t}))}},n=(a("14dd"),a("17cc")),s=Object(n.a)(r,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._g({staticClass:"problem-detail-header border-bottom"},e.$listeners),[a("div",{staticClass:"status",class:{"待整改":"status-red","不合格":"status-red","已退回":"status-red","待复验":"status-orange","已放水待验收":"status-orange","检查中":"status-orange","待验收":"status-orange","已通过":"status-green","已整改":"status-green","已提交":"status-green","合格":"status-green","检查完毕":"status-green","已验收":"status-green","已关闭":"status-black","进度正常":"status-green","进度滞后":"status-red","验收中":"status-orange","已抽验":"status-green","逾期未完成":"status-red","未完成":"status-orange","逾期完成":"status-green","按时完成":"status-green"}[e.status]},[e._v(e._s(e.statusText||e.status))]),"紧急"===e.level||"特急"===e.level?a("span",{staticClass:"urgent"},[e._v(e._s(e.edOptions[e.level]))]):e._e(),e.isTimeout?a("span",{staticClass:"timeout"},[e._v("超时")]):e._e(),e.sentBackTimes>0?a("span",{staticClass:"return"},[e._v("退回"+e._s(e.sentBackTimes)+"次")]):e._e(),e._t("operat")],2)}),[],!1,null,"1894f361",null);t.default=s.exports},e223:function(e,t,a){"use strict";var i=a("c40a").a,r=(a("0aac"),a("17cc")),n=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._g({ref:"content",staticClass:"drawing-con"},e.$listeners),[e.isDownloading?[a("p",[a("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[a("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]),a("p",{staticClass:"loading-text"},[e._v("正在下载...")])]:[e.error?e._e():a("canvas",{ref:"drawing-canvas"}),e.error?a("p",{staticClass:"error-text"},[e._v(e._s(e.error))]):e._e()]],2)}),[],!1,null,"fba5990a",null);t.a=n.exports},e60b:function(e,t,a){var i=a("cf0d");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("85cb").default)("1be2b028",i,!0,{sourceMap:!1,shadowMode:!1})},e89f:function(e,t,a){"use strict";var i=a("04f3"),r=a("cf09"),n=a("4360"),s=0;t.a={name:"PopupMixin",data:function(){return{backButtonEvent:null}},watch:{show:function(e){var t=this;if(e){if(this.$nextTick((function(){t.$el&&t.$el.style&&(t.$el.style.zIndex=++r.a.zIndex,s++,n.a.commit("app/SET_HAS_POPUP",!!s))})),!this.backButtonEvent){var a=this.close||this.closePopup;this.backButtonEvent=Object(i.a)(a)}}else--s<0&&(s=0),n.a.commit("app/SET_HAS_POPUP",!!s),this.backButtonEvent&&(Object(i.c)(this.backButtonEvent),this.backButtonEvent=null)}},methods:{}}},e900:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return r}));a("f548");function i(e){var t,a,i,r=(a=(t=e).backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,(window.devicePixelRatio||1)/a);1!==r&&(!function(e,t){for(var a in e)e.hasOwnProperty(a)&&t(e[a],a)}({fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all"},(function(t,a){var i;e[a]=(i=e[a],function(){var e,a,n=Array.prototype.slice.call(arguments);if("all"===t)n=n.map((function(e){return e*r}));else if(Array.isArray(t))for(e=0,a=t.length;e<a;e++)n[t[e]]*=r;return i.apply(this,n)})})),e.stroke=(i=e.stroke,function(){this.lineWidth*=r,i.apply(this,arguments),this.lineWidth/=r}),e.fillText=function(e){return function(){var t=Array.prototype.slice.call(arguments);t[1]*=r,t[2]*=r,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(e,t,a){return t*r+a})),e.apply(this,t),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(e,t,a){return t/r+a}))}}(e.fillText),e.strokeText=function(e){return function(){var t=Array.prototype.slice.call(arguments);t[1]*=r,t[2]*=r,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(e,t,a){return t*r+a})),e.apply(this,t),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(e,t,a){return t/r+a}))}}(e.strokeText),e.extended=!0)}var r=function(e){var t,a;(t=e).getContext=(a=t.getContext,function(e){var t,r,n=a.call(this,e);return"2d"===e&&(t=n.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1,(r=(window.devicePixelRatio||1)/t)>1&&(this.style.height=this.height+"px",this.style.width=this.width+"px",this.width*=r,this.height*=r)),i(n),n})}},e9fe:function(e,t,a){"use strict";(function(e){a("5ab2"),a("6d57"),a("e10e"),a("cc57");var i=a("28f8"),r=(a("e204"),a("774b")),n=a("07d2"),s=a("e68e"),o=a("9864"),c=a("e89f"),l=(a("3122"),a("1b7e")),d=a("162a");function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t.a={name:"BusinessLogsDetail",components:{Scroller:r.default,Item:n.default,ItemImgList:s.a,UserContact:o.a},mixins:[c.a],data:function(){return{show:!1,isLoading:!0,id:"",title:"",logs:[],emptyTips:""}},methods:{open:function(e){if(this.id=e.id,this.title=e.title,this.show=!0,!this.id)return this.isLoading=!1,this.emptyTips="缺少参数",void $log.error("business-logs-detail, 缺少 id");this.getLogs()},close:function(){this.show=!1},getLogs:function(){var t=this;return this.isLoading=!0,l.a.getHasNetwork().then((function(e){if(!e)return $q.reject({errmsg:"当前无网络连接"})})).then((function(){return d.a.request("/online/business-log/get-log",{id:t.id}).then((function(a){if(!a)return Promise.reject({errmsg:"获取数据失败"});var i=a.findIndex((function(e){return"登记问题"===e.event}));i>=0&&i!==a.length-1&&(a=a.concat(a.splice(i,1)));var r=e.map(a||[],(function(e){var a;try{a=JSON.parse(e.diff||"{}")}catch(e){a={}}var i,r=t.getValueText(a.old),n=t.getValueText(a.new);try{i=JSON.parse(e.images||"[]")}catch(e){i=[]}var s={"登记问题":"blue","通知整改":"blue","完成整改":"green","退回":"red","变更整改人":"blue","复验通过":"green","非正常关闭":"gray","变更复验人":"blue","变更抄送人":"blue","变更责任单位":"blue","变更整改期限":"blue","修改分数":"blue","删除":"red","添加批示":"blue"}[e.event]||"";return u(u({},e),{},{statusColor:s,diff:a,oldValue:r,newValue:n,images:i,user:[{id:e.operator_id,name:e.operator_name,mobile:e.mobile,is_im_user:e.is_im_user}],isOpen:!0})}));console.log("logs ====",r),t.logs=r,e.isEmpty(t.logs)&&(t.emptyTips="暂无日志记录"),t.isLoading=!1}))})).catch((function(e){t.emptyTips=e.errmsg||"获取日志失败",t.isLoading=!1}))},getValueText:function(t){if(null==t)return"";e.isArray(t)||(t=[t]);var a=e.map(t,(function(t){return e.isObject(t)?t.name:t}));return e.isEmpty(a)?"-":a.join("、")},toggleLog:function(e){e.isOpen=!e.isOpen}}}}).call(this,a("391c"))},eba8:function(e,t,a){"use strict";(function(e){a("5ab2"),a("6d57"),a("e10e"),a("f548");var i=a("28f8"),r=(a("9dd9"),a("cc57"),a("e204"),a("9eea")),n=a("3156b"),s=a("774b"),o=a("6f9e");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t.a={name:"AppSingleSelect",components:{appSearchBar:r.default,item:n.a,Scroller:s.default},props:{},data:function(){return{activeTab:[],storageKey:encodeURI(this.title||"singleSelectMark"),storageVal:[],keyword:"",searchStatus:!1,checkedItem:{},show:!1,searchData:[],options:[],optionsLimit:20,pagingOptions:!1,searchBar:!0,category:[],ifToggle:!1,editorAddData:!1,lineLimit:1,title:"",grouping:""}},computed:{optionsShow:function(){return this.options&&this.options.length?this.grouping?this.getGroupData():this.options.slice(0,this.optionsLimit):[]}},watch:{keyword:function(e){var t=this;this.$nextTick((function(){t.filterList(e)}))}},methods:{init:function(t){if(o.a.$on("closeDialog",this.closePopup),this.category=[],this.title=t.title,this.selected=t.selected,this.checkedItem=t.selected,this.options=t.options,this.onSelect=t.onSelect,this.searchBar=t.searchBar,this.grouping=t.grouping,this.ifToggle=t.ifToggle,this.lineLimit=t.lineLimit,this.editorAddData=t.editorAddData,t.grouping&&t.autoOpen){var a=e.uniqBy(e.map(this.options,t.grouping));this.activeTab=e.map(a,(function(e,t){return t}))}this.storageKey=encodeURI(this.title||"singleSelectMark")},closePopup:function(){o.a.$off("closeDialog",this.closePopup),this.keyword="",this.searchStatus=!1,this.$refs["app-search-bar"]&&this.$refs["app-search-bar"].cancelSearch(),this.$emit("close")},customAddSupplier:function(e){return this.options.findIndex((function(t){return t.name===e}))},selectItem:function(e){var t=this;this.ifToggle&&this.checkedItem.id===e.id?this.checkedItem={}:this.checkedItem=e,this.onSelect(this.checkedItem),this.$refs["app-search-bar"]&&this.$refs["app-search-bar"].saveHistory(),window.setTimeout((function(){t.closePopup()}),300)},onSearchTypeChange:function(e){this.searchStatus=e},filterList:function(e){var t,a,i=this,r=new RegExp("("+e+")","gmi");if(this.category=[],this.keyword=e,this.searchData=[],!e)return!1;this.options.map((function(e){return r.test(e.name)&&(a=l(l({},e),{},{rename:e.name.replace(r,"<label>$1</label>")}),i.grouping?-1===(t=i.category.indexOf(a[i.grouping]))?(i.category.push(a[i.grouping]),i.searchData.push({name:a[i.grouping],children:[a]})):i.searchData[t].children.push(a):i.searchData.push(a)),e}))},pageOptions:function(){this.optionsLimit=this.optionsLimit+20,this.pagingOptions=!1},getGroupData:function(){var e,t=this,a=[];return this.category=[],this.options.map((function(i){return-1===(e=t.category.indexOf(i[t.grouping]))?(t.category.push(i[t.grouping]),a.push({name:i[t.grouping],children:[i]})):a[e].children.push(i),i})),a}}}}).call(this,a("391c"))},ef5e:function(e,t,a){(e.exports=a("690e")(!1)).push([e.i,".zjapp .app-voice-play .play-main[data-v-d51aec2c]{min-height:46px;padding:8px 0;width:100%;height:100%;display:flex;align-items:center}.zjapp .app-voice-play .play-btn_style[data-v-d51aec2c]{width:30px;height:30px;border-radius:30px;display:flex;align-items:center;color:#fff;background:#4275e8;margin-right:10px}.zjapp .app-voice-play .start-icon[data-v-d51aec2c]{width:0;height:0;border-top:6px solid transparent;border-left:10px solid #fff;border-bottom:6px solid transparent;margin-left:11.5px}.zjapp .app-voice-play .play-btn_middle i[data-v-d51aec2c]{width:2px;height:12px;display:inline-block;background:#f2f2f2}.zjapp .app-voice-play .play-btn_middle i[data-v-d51aec2c]:first-child{margin-right:5px;margin-left:10px}.zjapp .app-voice-play .play-btn_loadding .loading-icon[data-v-d51aec2c]{margin-left:7px}.zjapp .app-voice-play .play-progress[data-v-d51aec2c]{flex:1;height:100%;display:flex;align-items:center;justify-content:center;position:relative}.zjapp .app-voice-play .play-progress_dotted[data-v-d51aec2c],.zjapp .app-voice-play .play-progress_solidLine[data-v-d51aec2c]{height:2px;display:inline-block;top:50%}.zjapp .app-voice-play .play-progress_solidLine[data-v-d51aec2c]{width:40px;background:#4275e8}.zjapp .app-voice-play .play-progress_dotted[data-v-d51aec2c]{width:40px;background:#f6f6f6}.zjapp .app-voice-play .play-progress_spot[data-v-d51aec2c]{width:4px;height:4px;border-radius:4px;position:absolute;left:0;top:50%;transform:translateY(-50%);background:#4275e8}.zjapp .app-voice-play .play-progress_layer[data-v-d51aec2c]{height:100%;flex:1}.zjapp .app-voice-play .play-progress_slider[data-v-d51aec2c] .play-progress_btn{width:80px;height:14px;line-height:14px;border-radius:14px;color:#fff;background:#4275e8;text-align:center;font-size:12px}.zjapp .app-voice-play .play-progress_slider.disabled-animation[data-v-d51aec2c] .van-slider__bar{transition:initial!important}.zjapp .app-voice-play .play-progress_slider.van-slider--disabled[data-v-d51aec2c]{opacity:1}.zjapp .app-voice-play .play-delete[data-v-d51aec2c]{margin-left:10px;color:#999}.zjapp .app-voice-play .play-text[data-v-d51aec2c]{margin:10px 0;color:#333;background:#f6f6f6;padding:10px;font-size:14px}",""])},f4c1:function(e,t,a){"use strict";a("6be0")},f4c9:function(e,t,a){"use strict";a("105d")},f77a:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAeCAYAAABqpJ3BAAAAAXNSR0IArs4c6QAAAnlJREFUWAntmD1PFEEYx2dmbxUhd0eABAQsjAap0AIagYYYayWUxMaCaIJQGg1kQ0VNAdkY/QA0JH4AQyEdDRdB74xGQ4CYUABnJMfezsM8JHvKMs8ei4GdGDe57O3zMvP7z8vO7HBW5QIAPjmX65Oc93JgrcDY5Sop5+JW9ZY4Z5sCYGnqSdd7zhWNunhUbdPul2zRLz5mTNyKirtoHwD7lEnVvXk+cmNXUJVjy5sIj7yqJzqRDRktSoBsHuwHJgYof/J23rS4/GOH7AEc88lDRhMgIykAJ2x0evJeZCQFJPW2idMsyEgKiFNQkrH/BSTZ+li3tgdcF+ykwU5b/4mV2Jn5nPHs/acM2PXTFpJk3DEBL9y1q8LzRkHwxrhQtiXEw4G27o5r6Q7MLawXCwvvNpY9X0pdWXHjdWWgrbISO26u0y/740zwDBUcZR+6197TdbP+TiolbPw1N9S0NGQvidWvexu6vLjxujLQdjQHJuY+9B5IeKZ2eFeowGr2oOX/jNPZAr/Op7MF8dRdOK9W2iXIRzxiX0Qlm2AXjKd+qRXN+1sYHPPhMnS2IEbn09mCeOpuLb6d3b//YOyjD+XbaqN65o+VwvefWzjms3V2puyDt/ZtbxUnsVR7Xl3lceN1ZaCt8hZy3HyT55dGla2FCjbRXhGAcI67WXtQ3h7BDwYTYXVMxwRgwPw8WCvbuWHVOXd1CabZTggIAF/O5tzgv8l37V7IZOAw278rQI2tUlitac/ISPYAqEMk04DDPMhICsATsHCCac/ISArA4zvGZN406N88Mo+MpAA8e0xb6ddmipB5ZENGch0IlJpyuIsT9mjMhw53DwElT/W1PxsJFAAAAABJRU5ErkJggg=="}}]);