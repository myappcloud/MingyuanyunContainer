(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-7b7d1414"],{"0753":function(e,t,i){"use strict";i("1260")},1059:function(e,t,i){"use strict";var a=i("ebf1").a,o=(i("9dea"),i("17cc")),n=Object(o.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"redio-box-group",class:"align-"+e.align+" "+e.customClass},e._l(e.options,(function(t,a){return i("span",{key:a,staticClass:"radio-box",class:{selected:"array"===e.optionsType?e.value===t:"object"===e.optionsType&&e.value===a},on:{click:function(t){e.onSelect(a)}}},[e._v("\n    "+e._s(t)+"\n  ")])})))}),[],!1,null,"b0a30924",null);t.a=n.exports},1260:function(e,t,i){var a=i("87b2");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("5fc64d1a",a,!0,{sourceMap:!1,shadowMode:!1})},"19a7":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .redio-box-group[data-v-b0a30924]{font-size:0;margin-top:-10px}.zjapp .redio-box-group.align-l[data-v-b0a30924]{text-align:left}.zjapp .redio-box-group.align-r[data-v-b0a30924]{text-align:right}.zjapp .radio-box[data-v-b0a30924]{display:inline-block;height:34px;line-height:32px;min-width:60px;padding:0 5px;margin:10px 0 0 10px;border:1px solid #d9d9d9;background:#fff;color:#666;vertical-align:top;font-size:14px;text-align:center;border-radius:3px}.zjapp .radio-box[data-v-b0a30924]:first-child{margin-left:0}.zjapp .radio-box.selected[data-v-b0a30924]{border-color:#4275e8;color:#4275e8}",""])},"29e0":function(e,t,i){"use strict";(function(e){i("5ab2"),i("e10e"),i("6d57"),i("06a2");var a=i("3e83"),o=i("28f8"),n=(i("cc57"),i("fd50")),r=i("3bd5"),l=i("e2a7"),s=i("48f4"),c=i("f97c"),u=i("37d5"),d=i("07d2"),p=i("e68e"),b=i("3c64"),f=i("1059"),m=i("cd05"),g=i("162a"),h=i("1b7e"),v=i("ed08"),_=i("3122"),x=i("6f9e"),y=i("83e4");function j(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}t.a={name:"ImageProcessAdd",components:{Item:d.a,ItemImgList:p.a,ItemTextarea:b.a,RadioBox:f.a,UserSelect:m.a},data:function(){return{loaded:!1,user:"",id:"",title:"",beforeEditData:{},isSelectBuildVisible:!1,isSelectTypeVisible:!1,selectBuildData:[],problemData:{image_file:[]},ccOptions:[],edOptions:["进度正常","进度滞后"],typeOptions:[]}},beforeRouteLeave:function(e,t,i){this.checkEditing()?l.a.confirm("未提交返回，将丢失已填内容",{okText:"返回",cancelText:"继续编辑"}).then((function(e){e?i():i(!1)})):i()},activated:function(){var t=this;this.getBuildingData();var i=this.$route.params,a=c.a.getDefaultProject().id;this.id=i&&i.id?i.id:"",this.title=i&&i.id?"修改形象进度":"新增形象进度",this.user=r.a.getUser(),this.id?this.getDetail(this.id).then((function(i){if(t.beforeEditData=e.clone(t.problemData),"dev"===APP_ENV&&i){var a=t.problemData.image_file;a[0]&&!a[0].url&&a[0].temp&&s.default.uploadImage(t.problemData.id,"image_process").then((function(e){t.problemData.image_file=e[0].image_file}))}})):(this.problemData={id:v.a.uuid(),process_status:"进度正常",proj_id:a,image_file:[],remark:"",created_by:this.user.user_id,cc_set:[],building_name:"",building_id:""},this.beforeEditData=e.clone(this.problemData)),this.getCC(a).finally((function(){t.loaded=!1})).then((function(){t.getTypeOptions()}))},methods:{checkNetWork:function(){return h.a.getHasNetwork().then((function(e){if(!e)return n.a.reject({errmsg:"当前无网络连接"})}))},getDetail:function(e){var t=this;return this.loaded=!1,Object(y.c)({id:e}).then((function(e){return t.problemData={id:e.id,process_status:e.process_status,proj_id:e.proj_id,proj_name:e.proj_name,type:e.type,image_file:JSON.parse(e.image_file||"[]"),remark:e.remark,created_by:e.created_by.id,created_by_name:e.created_by.name,created_by_mobile:e.created_by.mobile,building_name:e.building_name||"",building_id:e.building_id||"",creator:{id:e.created_by.id,name:e.created_by.name,mobile:e.created_by.mobile,is_im_user:e.created_by.is_im_user},created_on:e.created_on,cc_set:e.cc&&e.cc.map((function(e){return{id:e.id,name:e.name,mobile:e.mobile,is_im_user:e.is_im_user}})),modified_on:e.modified_on!==e.created_on&&e.modified_on},t.problemData})).catch((function(e){$log.log("获取形象进度详情失败",e)})).finally((function(){t.loaded=!1}))},checkEditing:function(){return JSON.stringify(this.beforeEditData)!==JSON.stringify(this.problemData)},addProblem:function(){var t=this;return e.isEmpty(this.problemData.image_file)?(l.a.alert("请拍摄或上传形象进度照片"),!1):e.isEmpty(this.problemData.remark)?(l.a.alert("请填写进度说明"),!1):(l.a.loading("正在提交"),$log.log("提交形象进度",this.problemData),g.a.beginManualUpdate(),g.a.canUpdate().then((function(){return t.uploadImages(t.problemData.image_file)})).then((function(e){var i=t.problemData.image_file.map((function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?j(Object(i),!0).forEach((function(t){Object(o.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):j(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},e);return delete t.thumbnail,delete t.temp,delete t.videoTemp,t}));return Object(y.f)({id:t.problemData.id,created_by:t.problemData.created_by,remark:t.problemData.remark,created_on:t.problemData.created_on,process_status:t.problemData.process_status,image_file:i,proj_id:t.problemData.proj_id,modified_on:v.a.getNowDate(),building_name:t.problemData.building_name,building_id:t.problemData.building_id,type:t.problemData.type,cc:t.problemData.cc_set.map((function(e){return e.id}))})})).then((function(e){l.a.hideLoading(),l.a.alert("提交成功"),t.beforeEditData={},t.problemData={},x.a.$emit("upDateList"),t.$router.back()})).catch((function(e){l.a.hideLoading();var t=("object"===Object(a.a)(e)?e.errmsg:e)||"提交失败";l.a.alert(t),$log.log("提交形象进度错误提示",e)})))},uploadImages:function(t){var i=[];return e.each(t,(function(e){!e.url&&e.temp&&i.push(_.a.uploadImage(e.temp).then((function(t){e.url=t}))),!e.videoUrl&&e.videoTemp&&i.push(_.a.uploadImage(e.videoTemp).then((function(t){e.videoUrl=t})))})),Promise.all(i)},getBuildingData:function(){var e=this;return this.isLoading=!0,Object(y.b)({proj_id:c.a.getDefaultProject().id}).then((function(t){e.selectBuildData=t})).catch((function(t){e.selectBuildData=[{name:"无",disabled:!0}]}))},selectBuilding:function(e){this.problemData.building_name=e.name,this.problemData.building_id=e.id,this.isSelectBuildVisible=!1},selectType:function(e){this.problemData.type=e,this.isSelectTypeVisible=!1},getCC:function(e){var t=this;return u.default.getProjectUsers(e,[31,32,33]).then((function(e){t.ccOptions=e}))},getTypeOptions:function(){var e=this;return Object(y.e)().then((function(t){e.typeOptions=t})).catch((function(e){console.error(e)})).finally((function(){}))}}}}).call(this,i("391c"))},"2c76":function(e,t,i){"use strict";i("c070")},"3c64":function(e,t,i){"use strict";i("163d");var a={name:"ItemTextarea",components:{},props:{value:{type:String,default:""},placeholder:{type:String,default:""},maxlength:{type:Number,default:200},borderBottom:{type:Boolean,default:!0}},data:function(){return{textareaHeight:40,isLock:!1,blurTime:null}},computed:{lastLength:function(){var e=this.value&&this.value.length||0,t=this.maxlength-e;return t>0?t:0}},mounted:function(){var e=this;this.$nextTick((function(){e.textareaHeight=e.$refs.rule&&e.$refs.rule.offsetHeight||40}))},methods:{onfocus:function(){var e=(new Date).getTime();this.blurTime&&e-this.blurTime<300&&window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(this.$refs.input.blur(),window.cordova.plugins.Keyboard.close()),this.blurTime=null,this.$emit("focus")},onblur:function(){this.blurTime=(new Date).getTime(),this.$emit("blur")},setStatus:function(e){console.log(e),this.isLock=e},oninput:function(e){var t=this;setTimeout((function(){if(!t.isLock){var i=e.target.value;i.length>t.maxlength&&(i=i.substring(0,t.maxlength),t.$refs.input.value=i),t.$refs.rule.innerText=i,t.textareaHeight=t.$refs.rule&&t.$refs.rule.offsetHeight+20,t.$emit("input",i),t.$emit("change",i)}}),0)}}},o=(i("2c76"),i("17cc")),n=Object(o.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"item-textarea",class:{"border-bottom":e.borderBottom}},[i("div",{staticClass:"item-textarea-content"},[i("textarea",{ref:"input",style:{height:e.textareaHeight+"px"},attrs:{placeholder:e.placeholder},domProps:{value:e.value},on:{focus:e.onfocus,blur:e.onblur,compositionstart:function(t){e.setStatus(!0)},compositionend:function(t){e.setStatus(!1)},input:e.oninput}}),i("div",{ref:"rule",staticClass:"rule"},[e._v("\n      "+e._s(e.value)+"\n    ")]),e.maxlength!==1/0?i("p",{staticClass:"counter"},[e._v("\n      "+e._s(e.lastLength)+"\n    ")]):e._e()])])}),[],!1,null,null,null);t.a=n.exports},"4f82":function(e,t,i){"use strict";i.r(t);var a=i("29e0").a,o=(i("0753"),i("17cc")),n=Object(o.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("page-content",{attrs:{title:e.title,"show-go-root":!0}},[i("div",{staticClass:"scroll-wrap"},[e.loaded?e._e():i("div",{staticClass:"content mb10"},[i("item",{staticClass:"p15",attrs:{mode:"edit"}},[i("item-img-list",{attrs:{maxlength:15,"track-text":"形象进度"},on:{callback:e.checkEditing},model:{value:e.problemData.image_file,callback:function(t){e.$set(e.problemData,"image_file",t)},expression:"problemData.image_file"}})],1),i("item-textarea",{attrs:{"default-height":600,placeholder:"进度说明（必填）"},model:{value:e.problemData.remark,callback:function(t){e.$set(e.problemData,"remark",t)},expression:"problemData.remark"}}),i("van-cell",{staticClass:"mt10",attrs:{title:"类型","is-link":"","title-style":"color: #333",value:e.problemData.type||"请选择","value-class":e.problemData.building_name?"color-gray1":""},on:{click:function(t){e.isSelectTypeVisible=!0}}}),i("van-cell",{attrs:{title:"部位","is-link":"","title-style":"color: #333",value:e.problemData.building_name||"请选择","value-class":e.problemData.building_name?"color-gray1":""},on:{click:function(t){e.isSelectBuildVisible=!0}}}),i("item",{attrs:{label:"进度状态",mode:"edit"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[i("radio-box",{attrs:{options:e.edOptions},model:{value:e.problemData.process_status,callback:function(t){e.$set(e.problemData,"process_status",t)},expression:"problemData.process_status"}})],1)]),i("div",[i("user-select",{attrs:{title:"抄送人",multi:!0,options:e.ccOptions,required:!1},model:{value:e.problemData.cc_set,callback:function(t){e.$set(e.problemData,"cc_set",t)},expression:"problemData.cc_set"}})],1)],1),i("app-button-group",[i("app-button",{on:{click:e.addProblem}},[e._v("提交")])],1)],1),i("van-action-sheet",{staticClass:"select-build-box",attrs:{"close-on-click-action":!0,round:""},model:{value:e.isSelectBuildVisible,callback:function(t){e.isSelectBuildVisible=t},expression:"isSelectBuildVisible"}},[i("div",{staticClass:"build-title"},[e._v("请选择部位")]),i("div",{staticClass:"build-body"},e._l(e.selectBuildData,(function(t){return i("div",{key:t.id,staticClass:"build-item",on:{click:function(i){e.selectBuilding(t)}}},[i("span",{staticClass:"over-text item-left"},[e._v(e._s(t.name))]),i("span",{staticClass:"item-right"},[e.problemData.building_id===t.id?i("i",{staticClass:"van-icon van-icon-success"}):e._e()])])})))]),i("van-action-sheet",{staticClass:"select-build-box",attrs:{"close-on-click-action":!0,round:""},model:{value:e.isSelectTypeVisible,callback:function(t){e.isSelectTypeVisible=t},expression:"isSelectTypeVisible"}},[i("div",{staticClass:"build-title"},[e._v("请选择类型")]),i("div",{staticClass:"build-body"},e._l(e.typeOptions,(function(t,a){return i("div",{key:a,staticClass:"build-item",on:{click:function(i){e.selectType(t)}}},[i("span",{staticClass:"over-text item-left"},[e._v(e._s(t))]),i("span",{staticClass:"item-right"},[e.problemData.type===t?i("i",{staticClass:"van-icon van-icon-success"}):e._e()])])})))])],1)}),[],!1,null,"7bd99248",null);t.default=n.exports},"574c":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .item-textarea{background-color:#fff;padding:5px 15px}.zjapp .item-textarea-content{position:relative}.zjapp .item-textarea .rule,.zjapp .item-textarea textarea{width:100%;min-height:40px;line-height:20px;font-size:16px;padding:0;border:none}.zjapp .item-textarea .rule{position:absolute;top:0;left:0;visibility:hidden;word-break:break-all}.zjapp .item-textarea .counter{text-align:right;margin:0 0 -5px 0;height:15px;line-height:15px;color:#b2b2b2;font-size:12px}",""])},"83e4":function(e,t,i){"use strict";i.d(t,"d",(function(){return r})),i.d(t,"a",(function(){return l})),i.d(t,"c",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"f",(function(){return u})),i.d(t,"e",(function(){return d}));var a=i("5e8d"),o=i("162a"),n=i("bcc78");function r(e){return Object(a.a)().then((function(){var t=n.a.imageProcessList.url;return o.a.request(t,e)}))}function l(e){return Object(a.a)().then((function(){var t=n.a.imageProcessDeleted.url;return o.a.post(t,null,e)}))}function s(e){return Object(a.a)().then((function(){var t=n.a.imageProcessDetails.url;return o.a.request(t,e)}))}function c(e){return Object(a.a)().then((function(){var t=n.a.imageProcessBuildingList.url;return o.a.request(t,e)}))}function u(e){return Object(a.a)().then((function(){var t=n.a.imageProcessSave.url;return o.a.post(t,null,e)}))}function d(){return Object(a.a)().then((function(){var e=n.a.imageProcessTypeList.url;return o.a.request(e)}))}},"87b2":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,'.zjapp .color-gray1[data-v-7bd99248]{color:#333}.zjapp .scroll-wrap[data-v-7bd99248]{height:100%;overflow:auto;padding-bottom:100px}.zjapp .content[data-v-7bd99248] .rule{height:130px}.zjapp .over-text[data-v-7bd99248]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.zjapp .select-build-box[data-v-7bd99248]{color:#333;height:60%}.zjapp .select-build-box[data-v-7bd99248] .van-action-sheet__content{display:flex;flex-direction:column;height:100%}.zjapp .select-build-box .build-title[data-v-7bd99248]{position:relative;font-size:16px;text-align:center;line-height:44px;height:44px}.zjapp .select-build-box .build-body[data-v-7bd99248]{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch}.zjapp .select-build-box .build-item[data-v-7bd99248]{position:relative;display:flex;justify-content:space-between;padding:0 15px;font-size:14px;line-height:46px}.zjapp .select-build-box .build-item .item-left[data-v-7bd99248]{flex:1;display:block}.zjapp .select-build-box .build-item .item-right[data-v-7bd99248]{flex-shrink:0;display:block;width:20px;text-align:right}.zjapp .select-build-box .build-item .van-icon[data-v-7bd99248]{color:#1989fa}.zjapp .select-build-box .build-item[data-v-7bd99248]:after,.zjapp .select-build-box .build-title[data-v-7bd99248]:after{position:absolute;box-sizing:border-box;content:" ";pointer-events:none;right:0;bottom:0;left:0;border-bottom:1px solid #ebedf0;transform:scaleY(.5)}',""])},"9dea":function(e,t,i){"use strict";i("fda1")},c070:function(e,t,i){var a=i("574c");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("35590dcb",a,!0,{sourceMap:!1,shadowMode:!1})},ebf1:function(e,t,i){"use strict";(function(e){t.a={name:"RadioBox",props:{options:{type:[Array,Object],default:function(){return[]}},value:{type:String,default:""},align:{type:String,default:"r"},customClass:{type:String,default:""}},data:function(){return{}},computed:{optionsType:function(){return e.isArray(this.options)?"array":e.isObject(this.options)?"object":""}},methods:{onSelect:function(e){var t;"array"===this.optionsType?t=this.options[e]:"object"===this.optionsType&&(t=e),this.$emit("input",t),this.$emit("onSelect",t)}}}}).call(this,i("391c"))},fda1:function(e,t,i){var a=i("19a7");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("cb2469e8",a,!0,{sourceMap:!1,shadowMode:!1})}}]);