(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-7f5d5a83","chunk-739f37c8"],{"045f":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .text-area-border{border:1px solid #eee;border-bottom:null}",""])},1154:function(t,e,a){var n=a("045f");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("186d4104",n,!0,{sourceMap:!1,shadowMode:!1})},1430:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .material-v2-task{padding-bottom:80px}",""])},"15f5":function(t,e,a){"use strict";(function(t){a("cc57"),a("6d57");var n=a("3bd5"),r=a("fc9f"),i=a("fd50"),o={getTaskInfo:function(t){return r.a.queryOne("select ms.*, ms.material as material_name, c.name as recipient_unit_name,                     log.id as log_id, cu.name as created_by_name, ru.name as recipient_name,                    section.id as section_id, section.name as section_name, mso.id as supply_id                     from material_task as ms                     left join material_task_log log on ms.id = log.task_id and log.status = '待送检'                     left join user as cu on ms.created_by = cu.id                     left join user as ru on ms.recipient = ru.id                     left join contractor as c on ms.recipient_unit = c.id                     left join section on ms.bidsection_id = section.id                     left join material_supply_order as mso on ms.id = mso.task_id                     where ms.id = ?",[t])},getCurrentUserOperation:function(t){var e=n.a.getUser().user_id;return r.a.queryOne("select mt.id as task_id, mt.status, mtpu.user_id as user_id, mtl.status_before as log_status_before,                   mtl.status as log_status, mtl.occurrence_date, mtl.operate_status                    from material_task as mt                    left join material_task_process_user as mtpu on mtpu.task_id = mt.id and mtpu.task_process_id = mt.current_task_process_id                    left join material_task_log as mtl on mtl.task_id = mt.id and mtl.task_process_id = mt.current_task_process_id                    where mt.id = ? and mtpu.user_id = ?",[t,e])},getProcessDetails:function(t){return r.a.query("select mtl.*, cu.name as user_name, cu.mobile as user_mobile, c.name as recipient_unit_name from material_task_process as mtp                    inner join material_task_log as mtl on mtl.task_process_id = mtp.id                   left join user as cu on mtl.operate_user = cu.id                    left join contractor as c on mtl.recipient_unit = c.id                    where mtp.task_id = ? and mtl.status != '已退场'",[t])},getProcess:function(t){return r.a.query("select * from material_task_process where task_id = ?",[t])},getProcessUser:function(t,e){return r.a.query("select mtp.*, cu.*                     from material_task_process_user as mtp                     left join user as cu on mtp.user_id = cu.id                     where mtp.task_id = ? and mtp.task_process_id = ?",[t,e])},getPhotoRequirement:function(t,e){return r.a.query("SELECT * from material_task_photo_requirement where task_id = ? and task_process_id = ?",[t,e])},getPhotoDetails:function(t){return r.a.query("SELECT * from material_task_photo_requirement where task_id = ?",[t])},getUserStatus:function(t,e){return r.a.query("select * from material_task_log where task_id = ? and task_process_id = ?",[t,e])},deleteLocalData:function(e){var a=[];return t.forEach([{name:"material_task",field:"id"},{name:"material_task_log",field:"task_id"},{name:"material_task_detail",field:"task_id"},{name:"material_task_user",field:"task_id"},{name:"material_task_cc",field:"task_id"},{name:"material_task_photo_requirement",field:"task_id"},{name:"material_task_process",field:"task_id"},{name:"material_task_process_user",field:"task_id"},{name:"todo",field:"biz_id"}],(function(t){a.push(r.a.executeSql("delete from ".concat(t.name," where ").concat(t.field," = ?"),[e]))})),i.a.all(a)},deleteTask:function(e){return r.a.executeSql("delete from material_task where id = ?",[e]).then((function(){return i.a.all(t.map(["material_task_log","material_task_detail","material_task_user","material_task_cc","material_task_photo_requirement"],(function(t){return r.a.delete(t,{taskId:e})})))}))},getTaskByStatus:function(t,e,a,n){var i="select mtl.*, ru.name as recipient_name, ru.mobile as recipient_mobile, ru.is_im_user as recipient_im,                       su.name as supervisor_name, su.mobile as supervisor_mobile, su.is_im_user as supervisor_im,                      ou.name as operate_user_name, ou.mobile as operate_user_mobile, ou.is_im_user as operate_user_im,                      c.name as recipient_unit_name                       from material_task_log mtl                       left join user as ru on mtl.recipient = ru.id                       left join user as su on mtl.supervisor = su.id                       left join user as ou on mtl.operate_user = ou.id                       left join contractor as c on mtl.recipient_unit = c.id                       where mtl.task_id =?";return(e=e||"")&&(i+=" and ifnull(mtl.status_before, '') = '"+e+"'"),(a=a||"")&&(i+=" and ifnull(mtl.status, '') = '"+a+"'"),i+=" order by mtl.created_on desc",!1===n?r.a.query(i,[t]):r.a.queryOne(i,[t])}};e.a=o}).call(this,a("391c"))},"1db3":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .custom-material-dialog /deep/ .van-dialog__content{padding:20px}.zjapp .custom-material-dialog /deep/ .van-dialog__content span{display:inline-block;color:#333;height:30px;line-height:30px;padding:0 13px;text-align:center;font-size:15px;border:1px solid #dcdcdc;border-radius:4px}.zjapp .custom-material-dialog /deep/ .van-dialog__content span.checked{position:relative;border-color:#4275e8;color:#4275e8!important}.zjapp .custom-material-dialog /deep/ .van-dialog__content span.checked:before{position:absolute;content:" ";display:block;border:1px solid #4275e8;border-top:none;border-right:none;width:8px;height:4px;transform:rotate(-45deg);right:3px;bottom:5px}.zjapp .custom-material-dialog /deep/ .van-dialog__content>span{margin:0 5px 5px 0}',""])},2286:function(t,e,a){"use strict";a.d(e,"e",(function(){return n})),a.d(e,"d",(function(){return r})),a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return o})),a.d(e,"f",(function(){return s})),a.d(e,"a",(function(){return l}));var n={add:{allowSection:!0,allowMaterial:!0,allowPeople:!0,allowIsConstructerBtn:!0,allowIsNews:!0,allowSupplyOrderTaskVoide:!1},edit:{allowSection:!0,allowMaterial:!1,allowPeople:!0,allowIsConstructerBtn:!0,allowIsNews:!1,allowSupplyOrderTaskVoide:!1}},r={TASK:"任务",APPROACH:"进场",BACK:"退场",INSPECT:"送检",REPORT:"报告"},i=[3],o={1:"receiver",2:"checker",3:"constructer",4:"areaChecker"},s="view",l="edit"},2904:function(t,e,a){"use strict";var n=a("64ce").a,r=(a("eca2"),a("17cc")),i=Object(r.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"materialV2TaskEdit",staticClass:"material-v2-task"},[a("single-select",{attrs:{options:t.sectionOptions,editabled:t.allowSection,title:"所属标段"},on:{onSelect:t.onChangeSection},model:{value:t.taskData.section,callback:function(e){t.$set(t.taskData,"section",e)},expression:"taskData.section"}}),a("material-info-select",{attrs:{options:t.materialList,"before-open":t.checkSectionIsAvailable,editabled:t.allowMaterial,title:"材料名称",grouping:"category_name","right-btn":t.allowCustomMaterialName?"手工添加":"","custom-type":"3"},on:{onSelect:t.onChangeMaterialName},model:{value:t.taskData.material,callback:function(e){t.$set(t.taskData,"material",e)},expression:"taskData.material"}}),t.taskData.material&&t.taskData.material.name?a("material-info-select",{ref:"selectMaterialType",attrs:{options:t.materialTypeList,"before-open":t.onCheckMaterialType,multi:!0,"standard-unit":t.taskData.material.quantity_unit,editabled:t.allowMaterial,"custom-type":"2",title:"材料类型","right-btn":t.allowCustomMaterialType?"手工添加":"",required:!1},on:{onSelect:t.onChangeMaterialType},model:{value:t.taskData.materialType,callback:function(e){t.$set(t.taskData,"materialType",e)},expression:"taskData.materialType"}}):t._e(),a("material-task-supplier",{attrs:{options:t.supplierOptions,"section-id":t.taskData.section&&t.taskData.section.id},model:{value:t.taskData.supplier,callback:function(e){t.$set(t.taskData,"supplier",e)},expression:"taskData.supplier"}}),t.allowUsingMaterialContract||t.taskData.contract&&t.taskData.contract.id?a("material-task-contract",{ref:"MaterialTaskContractRef",on:{onSelect:t.onSetMaterialTaskContract},model:{value:t.taskData.contract,callback:function(e){t.$set(t.taskData,"contract",e)},expression:"taskData.contract"}}):t._e(),a("item",{attrs:{label:"使用部位",border:"bottom",mode:"edit"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.taskData.place,expression:"taskData.place"}],staticClass:"input-align-r f16",attrs:{slot:"right",type:"text",placeholder:t.placeRequired?"必填":"选填"},domProps:{value:t.taskData.place},on:{input:function(e){e.target.composing||t.$set(t.taskData,"place",e.target.value)}},slot:"right"})]),a("item-textarea",{attrs:{"default-height":400,placeholder:"补充说明（选填）"},model:{value:t.taskData.remark,callback:function(e){t.$set(t.taskData,"remark",e)},expression:"taskData.remark"}}),a("div",{staticClass:"mt10"},[t._l(t.taskData.flowUsers,(function(e){return[a("user-select",{key:e.node_id,attrs:{title:e.name,options:t.userOptionsObj[e.type],editabled:t.allowPeople},model:{value:e.users,callback:function(a){t.$set(e,"users",a)},expression:"item.users"}}),1===e.node_id?a("single-select",{key:"contractor-"+e.node_id,attrs:{options:t.contractorOptions,"before-open":t.checkSectionIsAvailable,title:"接收单位"},model:{value:e.contractor,callback:function(a){t.$set(e,"contractor",a)},expression:"item.contractor"}}):t._e()]}))],2),a("div",{staticClass:"mt10"},[a("user-select",{attrs:{title:"抄送人",options:t.userOptionsObj.cc,multi:!0,required:!1,editabled:t.allowPeople},model:{value:t.taskData.cc,callback:function(e){t.$set(t.taskData,"cc",e)},expression:"taskData.cc"}}),t.allowIsNews?t._e():a("user-select",{attrs:{title:"创建人",editabled:!1},model:{value:t.taskData.creater,callback:function(e){t.$set(t.taskData,"creater",e)},expression:"taskData.creater"}})],1),a("app-button-group",{staticClass:"ctrl",attrs:{direction:"column"}},[t.allowIsNews?a("app-button",{on:{click:t.onSubmit}},[t._v("提交")]):a("app-button",{on:{click:t.onSaveTask}},[t._v("保存")])],1)],1)}),[],!1,null,null,null);e.a=i.exports},"43d8":function(t,e,a){var n=a("a79e");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("66a38c7d",n,!0,{sourceMap:!1,shadowMode:!1})},"573a1":function(t,e,a){"use strict";a("43d8")},"613e":function(t,e,a){"use strict";(function(t){a.d(e,"a",(function(){return m})),a.d(e,"b",(function(){return f})),a.d(e,"g",(function(){return h})),a.d(e,"c",(function(){return g})),a.d(e,"d",(function(){return k})),a.d(e,"f",(function(){return b})),a.d(e,"e",(function(){return _}));a("6a61");var n,r=a("2e91"),i=a("e2a7"),o=a("5e8d"),s=a("da71"),l=a("e3c6"),c=a("162a"),u=a("48f4"),p=new l.a,d={updateMaterialData:(n=Object(r.a)(regeneratorRuntime.mark((function e(a,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=3;break}return e.next=3,p.deleteLocalData(a);case 3:if(t.isEmpty(n)){e.next=7;break}return e.next=6,p.insertRemoteData(n);case 6:u.default.setLocalChanged();case 7:case"end":return e.stop()}}),e)}))),function(t,e){return n.apply(this,arguments)}),popup:function(t){t&&t.errmsg&&i.a.alert(t.errmsg)}};function m(t){return Object(o.a)().then((function(){var e=s.a.getProcessConfig.url;return c.a.request(e,t)}))}function f(t){return Object(o.a)().then((function(){var e=s.a.createTask.url;return c.a.post(e,null,t).then((function(t){return d.updateMaterialData("",t)}))})).catch((function(t){if(-1===t.errcode)return Promise.reject("请在有网络的环境下新建任务")}))}function h(e,a){return Object(o.a)().then((function(){var n=s.a.updateTask.url;return c.a.post(n,null,e).then((function(t){return d.updateMaterialData(a,t)})).catch((function(e){if(d.popup(e),e&&!t.isEmpty(e.data))return d.updateMaterialData(a,e.data)}))}))}function g(t){return Object(o.a)().then((function(){var e=s.a.deleteTask.url;return c.a.post(e,null,t)}))}function k(e,a){return Object(o.a)().then((function(){var n=s.a.recipientQualified.url;return c.a.post(n,null,e).then((function(t){return d.updateMaterialData(a,t)})).catch((function(e){if(d.popup(e),e&&!t.isEmpty(e.data))return d.updateMaterialData(a,e.data)}))}))}function b(e,a){return Object(o.a)().then((function(){var n=s.a.recipientUnqualified.url;return c.a.post(n,null,e).then((function(t){return d.updateMaterialData(a,t)})).catch((function(e){if(d.popup(e),e&&!t.isEmpty(e.data))return d.updateMaterialData(a,e.data)}))}))}function _(e,a){return Object(o.a)().then((function(){var n=s.a.recipientSendback.url;return c.a.post(n,null,e).then((function(t){return d.updateMaterialData(a,t)})).catch((function(e){if(d.popup(e),e&&!t.isEmpty(e.data))return d.updateMaterialData(a,e.data)}))}))}}).call(this,a("391c"))},"64ce":function(t,e,a){"use strict";(function(t){a("6a61");var n,r,i,o,s,l,c,u=a("2e91"),p=a("2286"),d=a("07d2"),m=a("3c64"),f=a("cd05"),h=a("5a71"),g=a("7a80"),k=a("fee3"),b=a("f711"),_=a("f5bd"),v=a("3bd5"),y=a("e2a7"),w=a("e320");e.a={name:"MaterialV2TaskEdit",components:{Item:d.default,ItemTextarea:m.a,UserSelect:f.a,SingleSelect:h.a,MaterialInfoSelect:g.a,MaterialTaskSupplier:k.a,MaterialTaskVoidDialog:b.a,MaterialTaskContract:_.a},props:{status:{type:String,default:"add"},taskId:{type:String,default:""},taskDetails:{type:Object,default:function(){}}},data:function(){return{allowSection:!0,allowMaterial:!0,allowPeople:!0,allowIsNews:!0,allowSupplyOrder:!1,allowSupplyOrderTaskVoide:!1,sectionOptions:[],materialList:[],materialTypeList:[],supplierOptions:[],contractorOptions:[],userOptionsObj:{},taskData:{section:{},material:{},materialType:[],supplier:{},place:"",remark:"",contract:{},cc:{},receiver:{},flowUsers:[]},supplierData:{},showSupplier:!1,allowCustomMaterialName:!1,allowCustomMaterialType:!1,allowUsingMaterialContract:!1}},computed:{proj_id:function(){return this.$route.query.projId||this.taskData.proj_id},placeRequired:function(){return w.a.getPlaceRequired()},statusComputed:function(){var t=this.$route.query.status;return t||(t=this.status),t},statusData:function(){return p.e[this.statusComputed]||{}},curUserData:function(){var t=v.a.getUser();return{id:t.user_id,name:t.user_name}}},watch:{},created:function(){this.taskId&&this.init()},activated:function(){this.init()},methods:{init:function(){this.getPermissions(),this.getInitBaseData(),this.taskId?(this.setTaskData(),this.setEditPermissions(),this.getSupplierOptions(),this.getContractorOptions()):(this.setEditPermissions(),this.resetDefaultData())},resetDefaultData:function(){this.taskData={section:{},material:{},materialType:[],supplier:{},place:"",remark:"",contract:{},cc:{},receiver:{},flowUsers:[]}},setTaskData:function(){this.taskData=this.taskDetails},setEditPermissions:function(){var t=this.statusData,e=(t.allowSection,t.allowMaterial),a=(t.allowPeople,t.allowIsConstructerBtn),n=t.allowIsNews,r=t.allowSupplyOrderTaskVoide,i=this.taskData.status&&"待申请进场"===this.taskData.status;this.allowSection=i,this.allowMaterial=e,this.allowPeople=i,this.allowIsConstructerBtn=a,this.allowIsNews=n,this.allowSupplyOrderTaskVoide=r},getPermissions:(c=Object(u.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.a.isAllowCustomMaterial("MATERIAL_NAME");case 2:return this.allowCustomMaterialName=t.sent,t.next=5,w.a.isAllowCustomMaterial("MATERIAL_TYPE");case 5:this.allowCustomMaterialType=t.sent,this.allowUsingMaterialContract=this.$store.state.global.allGrayRelease.UsingMaterialContract;case 7:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)}),getInitBaseData:(l=Object(u.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.a.getSectionList(this.proj_id);case 2:return this.sectionOptions=t.sent,t.next=5,w.a.getUserOptions(this.proj_id);case 5:this.userOptionsObj=t.sent;case 6:case"end":return t.stop()}}),t,this)}))),function(){return l.apply(this,arguments)}),checkSectionIsAvailable:function(){if(!this.taskData.section||!this.taskData.section.id||t.isEmpty(this.contractorOptions))return y.a.alert("请先选择标段"),!1},onChangeSection:(s=Object(u.a)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.taskData.section&&this.taskData.section.id,!this.allowIsNews){t.next=7;break}return this.$set(this.taskData,"material",{}),this.$set(this.taskData,"supplier",{}),t.next=6,w.a.getSectionMaterial(e);case 6:this.materialList=t.sent;case 7:this.getSupplierOptions(),this.getContractorOptions();case 9:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)}),getSupplierOptions:(o=Object(u.a)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.taskData.section&&this.taskData.section.id,t.next=3,w.a.selectMaterialSupplier(e,this.taskData.supplier);case 3:this.supplierOptions=t.sent;case 4:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)}),getContractorOptions:(i=Object(u.a)(regeneratorRuntime.mark((function t(e){var a,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e||this.curUserData.id,n=this.taskData.section&&this.taskData.section.id,t.next=4,w.a.getContractorOptions(a,n);case 4:this.contractorOptions=t.sent;case 5:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)}),getFlowUsers:(r=Object(u.a)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.a.getFlowUsers(e);case 2:this.taskData.flowUsers=t.sent;case 3:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)}),onChangeMaterialName:(n=Object(u.a)(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.taskData.section&&this.taskData.section.id,a=this.taskData.material&&this.taskData.material.id,t.next=3,w.a.getSectionTypeList(e,a);case 3:this.materialTypeList=t.sent,this.taskData.materialType=null,this.getFlowUsers(a);case 6:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)}),onCheckMaterialType:function(){var e=this.taskData.section,a=this.taskData.material;return t.isEmpty(e)?(y.a.alert("请先选择标段"),!1):t.isEmpty(a)?(y.a.alert("请先选择材料名称"),!1):void 0},onChangeMaterialType:function(t){},onSetMaterialTaskContract:function(t){this.$set(this.taskData,"contract",t)},onSubmit:function(){var t=this;return w.a.submitTask(this.taskData,this.proj_id).then((function(){t.$router.back()})).catch((function(t){y.a.alert(t)}))},onSaveTask:function(){var t=this;return w.a.saveTask(this.taskId,this.taskData,this.proj_id).then((function(){y.a.alert("保存成功"),t.$emit("onSave")})).catch((function(e){y.a.alert(e.errmsg),t.$emit("onSave")}))}}}}).call(this,a("391c"))},"774b":function(t,e,a){"use strict";a.r(e);var n=a("d18d").a,r=(a("b225"),a("17cc")),i=Object(r.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"scroll-warp",staticClass:"scroll-warp",class:{"scroll-warp-pulling":t.pulling,"scroll-warp-complete":!t.hasNext&&!t.isEmpty,"scroll-warp-empty":t.isEmpty},style:{"padding-bottom":t.numberKeyboardCoverHeight+"px"},on:{scroll:t.onScroll,touchstart:t.onTouchstart,touchmove:t.onTouchmove,touchend:t.onTouchend}},[t.allowPullDown?a("div",{staticClass:"pull-refresh-warp",style:{height:t.pullDist+"px"}},[a("div",{staticClass:"pull-refresh"},[a("div",{staticClass:"animation-refresher",class:{refreshing:t.refreshing}}),t.updateTime?a("p",{staticClass:"pull-refresh-date"},[t._v("最后成功同步："+t._s(t.updateTime))]):t._e()])]):t._e(),t._t("default"),t.loading?a("div",{staticClass:"page-loading"},[a("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[a("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]):t._e(),t.hasNext||t.isEmpty?t._e():[t.$slots.end?t._t("end"):t._e(),!t.$slots.end&&t.endText?a("div",{staticClass:"end-text"},[t._v("\n      "+t._s(t.endText)+"\n    ")]):t._e()]],2)}),[],!1,null,"2b1a346c",null);e.default=i.exports},"7a80":function(t,e,a){"use strict";var n=a("ab83").a,r=(a("573a1"),a("17cc")),i=Object(r.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[t.multi?a("multi-select",{ref:"multiSelectDialog",attrs:{options:t.options,title:t.title,"right-btn":t.rightBtn,editabled:t.editabled},on:{onSelect:t.onHandleSelect,rightBtnEvent:t.showCustomDialog},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},[t._t("default")],2):a("single-select",{ref:"singleSelectDialog",attrs:{options:t.options,"options-disabled":t.optionsDisabled,title:t.title,"right-btn":t.rightBtn,grouping:t.grouping,"auto-open":!0,"before-open":t.beforeOpen,"standard-unit":t.standardUnit,editabled:t.editabled,"form-check":t.formCheck},on:{onSelect:t.onHandleSelect,rightBtnEvent:t.showCustomDialog},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),a("van-dialog",{attrs:{"show-cancel-button":"","get-container":"body","class-name":"custom-material-dialog","cancel-button-color":"#666","before-close":t.customSubmit},model:{value:t.showCustom,callback:function(e){t.showCustom=e},expression:"showCustom"}},[a("div",{on:{click:function(){t.$refs["custom-input"].blur()}}},["3"===t.customType?t._l(t.materialCategory,(function(e,n){return a("span",{key:"cate-"+n,staticClass:"mr5 mb5",class:t.customMaterialCategory===e?"checked":"",on:{click:function(a){t.selectMaterialCategory(e)}}},[t._v(t._s(e))])})):t._e(),a("div",{class:{"new-name":!0,error:t.customFormError&&!t.customName}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.customName,expression:"customName"}],ref:"custom-input",attrs:{placeholder:"请输入"+t.title,maxlength:"20"},domProps:{value:t.customName},on:{click:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.customName=e.target.value)}}})]),"2"===t.customType||"3"===t.customType?[a("p",{class:{error:t.customFormError&&!t.customMaterialUnit}},[t._v("请选择数量单位")]),a("div",{staticClass:"untis"},t._l(t.units,(function(e,n){return a("span",{key:"unit-"+n,class:t.customMaterialUnit===e.name?"checked":"",on:{click:function(a){t.selectCustomMaterialUnit(e)}}},[t._v(t._s(e.name))])})))]:t._e()],2)])],1)}),[],!1,null,"f6060376",null);e.a=i.exports},"7cd3":function(t,e,a){var n=a("1db3");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("a86bfdc2",n,!0,{sourceMap:!1,shadowMode:!1})},"942a":function(t,e,a){var n=a("1430");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("6164e25a",n,!0,{sourceMap:!1,shadowMode:!1})},"9d55":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .scroll-warp[data-v-2b1a346c]{flex:1;overflow:auto;-webkit-overflow-scrolling:touch}.zjapp .scroll-warp-pulling[data-v-2b1a346c]{overflow:hidden}.zjapp .scroll-warp-complete[data-v-2b1a346c]:after{content:"";display:block;height:100px}.zjapp .scroll-warp-empty[data-v-2b1a346c]{display:flex;flex-direction:column}.zjapp .pull-refresh-warp[data-v-2b1a346c]{position:relative;height:0;overflow:hidden}.zjapp .pull-refresh[data-v-2b1a346c]{position:absolute;left:0;bottom:0;height:70px;width:100%;padding:6px;text-align:center}.zjapp .pull-refresh-date[data-v-2b1a346c]{margin-top:4px;height:16px;line-height:16px;font-size:12px;color:#bcbcbc}.zjapp .page-loading[data-v-2b1a346c]{padding:10px;text-align:center}.zjapp .end-text[data-v-2b1a346c]{color:#c8c8c8;background:#f4f4f4;position:relative;line-height:76px;height:76px;text-align:center}.zjapp .end-text[data-v-2b1a346c]:after,.zjapp .end-text[data-v-2b1a346c]:before{content:"";position:absolute;width:48px;height:1px;background:#e4e4e4;top:50%;margin-top:-1px}.zjapp .end-text[data-v-2b1a346c]:after{left:50%;transform:translateX(-92px)}.zjapp .end-text[data-v-2b1a346c]:before{right:50%;transform:translateX(90px)}.zjapp .end-slot[data-v-2b1a346c]{padding:30px;line-height:18px;text-align:center;color:#c8c8c8}',""])},"9e20":function(t,e,a){"use strict";a("7cd3")},a79e:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .custom-material-dialog[data-v-f6060376] .van-dialog__content{padding:20px}.zjapp .custom-material-dialog[data-v-f6060376] .van-dialog__content span{display:inline-block;color:#333;height:30px;line-height:30px;padding:0 13px;text-align:center;font-size:15px;border:1px solid #dcdcdc;border-radius:4px}.zjapp .custom-material-dialog[data-v-f6060376] .van-dialog__content span.checked{position:relative;border-color:#4275e8;color:#4275e8!important}.zjapp .custom-material-dialog[data-v-f6060376] .van-dialog__content span.checked:before{position:absolute;content:" ";display:block;border:1px solid #4275e8;border-top:none;border-right:none;width:8px;height:4px;transform:rotate(-45deg);right:3px;bottom:5px}.zjapp .custom-material-dialog[data-v-f6060376] .van-dialog__content .untis{margin:0 -3px}.zjapp .custom-material-dialog[data-v-f6060376] .van-dialog__content .untis span{padding:0;width:50px;margin:0 3px 5px 3px;font-size:14px;color:#666}.zjapp .custom-material-dialog[data-v-f6060376] .van-dialog__content p{padding:14px 0 10px 0;line-height:20px;color:#999;font-size:12px}.zjapp .custom-material-dialog[data-v-f6060376] .van-dialog__content p.error{color:#ff3d3d}.zjapp .custom-material-dialog .new-name[data-v-f6060376]{margin-top:10px}.zjapp .custom-material-dialog .new-name input[data-v-f6060376]{width:100%;height:40px;padding:10px;border-radius:0;font-size:14px;border:none;background-image:linear-gradient(180deg,#dcdcdc,#dcdcdc 66.6667%,transparent 0),linear-gradient(270deg,#dcdcdc,#dcdcdc 66.6667%,transparent 0),linear-gradient(0deg,#dcdcdc,#dcdcdc 66.6667%,transparent 0),linear-gradient(90deg,#dcdcdc,#dcdcdc 66.6667%,transparent 0);background-size:100% 1px,1px 100%,100% 1px,1px 100%;background-repeat:no-repeat;background-position:top,100% 0,bottom,0 0}.zjapp .custom-material-dialog .new-name.error input[data-v-f6060376]::-webkit-input-placeholder{color:#ff3d3d}',""])},ab83:function(t,e,a){"use strict";(function(t){var n=a("4c09"),r=(a("e697"),a("cc57"),a("5a71")),i=a("88c7"),o=a("6f9e"),s=a("e2a7"),l=a("a500");e.a={name:"MaterialInfoSelect",components:{SingleSelect:r.a,MultiSelect:i.a},props:{title:{type:String,default:""},value:{type:[Object,Array]},multi:{type:Boolean,default:!1},options:{type:Array,default:function(){return[]}},optionsDisabled:{type:Array,default:function(){return[]}},rightBtn:{type:String,default:""},customType:{type:String,default:"1"},grouping:{type:String,default:""},beforeOpen:{type:Function},standardUnit:{type:String,default:""},editabled:{type:Boolean,default:!0},formCheck:{type:Boolean,default:!1}},data:function(){return{selected:this.multi?[]:{},showCustom:!1,customMaterialCategory:"",customName:"",customMaterialUnit:"",customFormError:!1,materialCategory:[],units:[{id:"包",name:"包"},{id:"卷",name:"卷"},{id:"匹",name:"匹"},{id:"套",name:"套"},{id:"桶",name:"桶"},{id:"支",name:"支"},{id:"只",name:"只"},{id:"组",name:"组"},{id:"根",name:"根"},{id:"箱",name:"箱"},{id:"米",name:"米"},{id:"台",name:"台"},{id:"盏",name:"盏"},{id:"个",name:"个"},{id:"片",name:"片"},{id:"块",name:"块"},{id:"吨",name:"吨"},{id:"樘",name:"樘"},{id:"棵",name:"棵"},{id:"株",name:"株"},{id:"公斤",name:"公斤"},{id:"平方米",name:"平方米"},{id:"立方米",name:"立方米"},{id:"其它",name:"其它"}]}},watch:{value:function(t){this.selected=t},showCustom:function(t){var e=this;t&&this.$nextTick((function(){e.$refs["custom-input"].focus()}))}},mounted:function(){this.value&&(this.selected=this.value)},methods:{onHandleSelect:function(e){t.has(e,"num")&&(e.num=""),this.selected=e,this.$emit("input",e),this.$emit("onSelect",e),o.a.$emit("closeDialog")},showCustomDialog:function(t){this.customMaterialUnit=this.standardUnit,this.materialCategory=t,this.customMaterialCategory=t[0],this.showCustom=!0,l.a.addTrack("材料验收-手工添加材料".concat(this.title),"","")},selectMaterialCategory:function(t){this.customMaterialCategory=t},selectCustomMaterialUnit:function(t){this.customMaterialUnit=t.name},customSubmit:function(e,a){var r,i,o=this;if("confirm"===e){if(!this.customName)return this.customFormError=!0,a(!1);switch(this.customType){case"1":(i=t.find(this.options,(function(t){return t.name===o.customName})))?r=i:(r={id:"custom-"+(new Date).getTime(),name:this.customName,checked:!0},this.options.push(r));break;case"2":if(!this.customMaterialUnit)return this.customFormError=!0,a(!1);(i=t.find(this.options,(function(t){return t.name===o.customName})))?r=i:(r={id:"custom-"+(new Date).getTime(),name:this.customName,checked:!0,quantity_unit:this.customMaterialUnit},this.options.push(r));break;case"3":if(!this.customMaterialUnit)return this.customFormError=!0,a(!1);if(i=t.find(this.options,(function(t){return t.name===o.customName&&t.category_name===o.customMaterialCategory})))r=i;else{var l=(this.options||[]).find((function(t){return t[o.grouping]===o.customMaterialCategory})),c=t.isEmpty(l)?"":l.category_id;if(r={id:"custom-"+(new Date).getTime(),name:this.customName,checked:!0,quantity_unit:this.customMaterialUnit,category_name:this.customMaterialCategory,category_id:c},!this.customMaterialCategory)return s.a.alert("请在PC添加材料阶段后再添加材料"),a(!1);this.options.push(r)}}r.disabled?s.a.alert("“"+this.customName+"”已存在，且不可选"):this.multi?(this.selected=this.$refs.multiSelectDialog.getDialogValue(),this.$refs.multiSelectDialog.setDialogValue([].concat(Object(n.a)(this.selected),[r]))):this.onHandleSelect(r),this.resetData(),a()}else this.resetData(),a()},resetData:function(){this.showCustom=!1,this.customMaterialCategory="",this.customName="",this.customMaterialUnit="",this.customFormError=!1}}}}).call(this,a("391c"))},b225:function(t,e,a){"use strict";a("ef48")},d18d:function(t,e,a){"use strict";(function(t){a("2b45");var n,r=a("4360"),i=a("48f4"),o=a("162a"),s=a("e2a7"),l=a("a500"),c=a("6f9e"),u={};e.a={name:"Scroller",props:{buildingId:{type:String,default:""},hasNext:{type:Boolean,default:!1},isEmpty:{type:Boolean,default:!1},isSync:{type:Boolean,default:!0},endText:{type:String,default:""},memoryScrollTop:{type:Boolean,default:!0},keepScrollTop:{type:Boolean},hasPullDown:{type:Boolean,default:!0},onPullDown:{type:Function}},data:function(){return{pullDist:0,refreshing:!1,pulling:!1,loading:!1,scrollTop:0,isCurrKeyboard:!1,gapBottom:0}},computed:{allowPullDown:function(){return this.hasPullDown&&(!!this.$listeners.pullDown||!!this.onPullDown)},updateTime:function(){return r.a.state.global.businessDownloadTime},numberKeyboardCoverHeight:function(){return r.a.state.global.isNumberInputOpen?r.a.state.global.numberKeyboardHeight-this.gapBottom:0}},mounted:function(){var t=this;c.a.$on("numberKeyboardOpen",this.onNumberKeyboardOpen),this.$nextTick((function(){var e=t.$refs["scroll-warp"]&&t.$refs["scroll-warp"].getBoundingClientRect&&t.$refs["scroll-warp"].getBoundingClientRect();e&&(t.gapBottom=document.documentElement.clientHeight-e.bottom),t.$el&&t.$el.addEventListener("focus",(function(e){var a=e&&e.target,n=a&&a.tagName&&a.tagName.toLowerCase();if("input"===n||"textarea"===n){window.addEventListener("resize",(function e(){var n=a.getBoundingClientRect(),r=t.$el.getBoundingClientRect(),i=n.bottom-r.bottom;i>0&&t.scrollBy(i),window.removeEventListener("resize",e,!1)}),!1)}}),!0)}))},destroyed:function(){c.a.$off("numberKeyboardOpen",this.onNumberKeyboardOpen)},activated:function(){var t=this.keepScrollTop||this.$router.isBack&&this.memoryScrollTop;this.scrollTop&&t&&(this.$refs["scroll-warp"].scrollTop=this.scrollTop)},deactivated:function(){this.memoryScrollTop&&(this.scrollTop=this.$refs["scroll-warp"].scrollTop)},methods:{onScroll:function(t){var e=this,a=this.$refs["scroll-warp"].scrollTop,n=this.$refs["scroll-warp"].scrollHeight;if(a+this.$refs["scroll-warp"].clientHeight>=n-5&&!this.loading&&this.hasNext){this.loading=!0;var r=this.$listeners.loadNext();r&&r.then&&"function"==typeof r.then?r.then((function(){e.loading=!1})):this.loading=!1}this.$emit("scroll",t)},getTouchDiretion:function(t){if(!(u&&t&&t.touches&&t.touches[0]))return"";var e=t.touches[0].clientX,a=t.touches[0].clientY;return Math.abs(a-u.y)>Math.abs(e-u.x)&&Math.abs(a-u.y)>=3?a>u.y?"down":"up":""},onTouchstart:function(t){this.allowPullDown&&t.touches&&1===t.touches.length&&(u={x:t.touches[0].clientX,y:t.touches[0].clientY,scrollTop:this.$refs["scroll-warp"].scrollTop,pullDist:this.pullDist})},onTouchmove:function(t){if(this.allowPullDown&&t.touches&&1===t.touches.length){var e=this.$refs["scroll-warp"].scrollTop,a=t.touches[0].clientY,n=a-u.y,r=this.getTouchDiretion(t);"down"===r?!this.refreshing&&e<=0?(this.pulling=!0,this.pullDist=(n-u.scrollTop)/2,t.preventDefault()):this.pulling=!1:"up"===r?this.pullDist>0&&(this.pullDist=u.pullDist-(u.y-a),t.preventDefault()):this.pullDist=u.pullDist}},onTouchend:function(){var t=this;this.allowPullDown&&(u={},this.pulling=!1,this.pullDist>=70&&this.isSync?this.refreshing?this.makePullTo(70):this.makePullTo(70).then((function(){if(t.refreshing=!0,t.onPullDown){var e=t.onPullDown();e&&e.then&&"function"==typeof e?e.finally((function(){t.refreshing=!1,t.makePullTo(0)})):(t.refreshing=!1,t.makePullTo(0))}else t.dataSync().then((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")})).catch((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")}))})):(this.refreshing=!1,this.makePullTo(0)))},makePullTo:function(t){var e=this,a=this.pullDist,n=t,r=n-a,i=a;return a===n?Promise.resolve():new Promise((function(t){!function o(){window.requestAnimationFrame((function(){i+=r/6,e.pullDist=i,a<n&&i<n||a>n&&i>n?o():(e.pullDist=n,e.refreshing=!1,t())}))}()}))},dataSync:function(){var t,e=i.default.getCurrentModuleCode(),a=i.default.getCurrentRoute(),n=a.meta&&a.meta.isTodo;if(i.default.isModuleNeedBuilding(e)&&!n){if(!this.buildingId)return new Promise((function(t){setTimeout((function(){t()}),500)}));t=this.buildingId}return l.a.addTrack("公共-手动下拉刷新","",""),o.a.beginManualUpdate(),i.default.checkSync(t).then((function(t){return o.a.endManualUpdate(),t})).catch((function(t){$log.error("下拉刷新错误",t),t&&"Error: Network Error"===t.toString()?s.a.alert("当前网络无法同步数据"):s.a.alert(t),o.a.endManualUpdate()}))},getScrollHeight:function(){return this.$refs["scroll-warp"].offsetHeight},getScrollTop:function(){return this.$refs["scroll-warp"].scrollTop},setScrollTop:function(t){this.$refs["scroll-warp"].scrollTop=t},scrollBy:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=this.getScrollTop(),i=r+t,o=Math.round(a/16.7),s=t/o,l=r,c=n=+new Date;return r===i?Promise.resolve():new Promise((function(t){!function a(){window.requestAnimationFrame((function(){c===n&&(l+=s,e.$refs["scroll-warp"].scrollTop=l,r<i&&l<i||r>i&&l>i?a():(e.$refs["scroll-warp"].scrollTop=i,t()))}))}()}))},scrollTo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=this.getScrollTop(),n=t-a;return this.scrollBy(n,e)},scrollToEle:function(t){var e=t.keyboardHeight||232,a=(t=t.$el?t.$el:t).getBoundingClientRect(),n=this.$refs["scroll-warp"].getBoundingClientRect();if(a&&n){var i=document.documentElement.clientHeight-(r.a.state.global.isNumberInputOpen?e:0),o=n.bottom<i?n.bottom:i,s=n.top-a.top,l=a.bottom-o;s>0?this.scrollBy(-s-10):l>0&&this.scrollBy(l+10)}},isCurrent:function(e,a){var n=this;e.length&&t.each(e,(function(t){t._uid===a?n.isCurrKeyboard=!0:n.isCurrent(t.$children,a)}))},onNumberKeyboardOpen:function(t){this.isCurrKeyboard=!1,this.isCurrent(this.$children,t._uid),this.isCurrKeyboard&&this.scrollToEle(t)}}}}).call(this,a("391c"))},e320:function(t,e,a){"use strict";(function(t){a("2b45"),a("fc58"),a("cc57"),a("6a61");var n=a("2e91"),r=(a("ed63"),a("8cf2"),a("163d"),a("6d57"),a("0e4d")),i=a("94ef"),o=a("76ff"),s=a("4b67"),l=a("d703"),c=a("2286"),u=a("3bd5"),p=a("e2a7"),d=a("4360"),m=a("7cb8"),f=a("e3c6"),h=a("48f4"),g=a("0136"),k=a("613e"),b=a("15f5");function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=Object(l.a)(t);if(e){var r=Object(l.a)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return Object(s.a)(this,a)}}var v=new(function(e){Object(o.a)(l,e);var a,s=_(l);function l(){var t;return Object(r.a)(this,l),(t=s.call(this)).state={},t}return Object(i.a)(l,[{key:"getPlaceRequired",value:function(){return d.a.state.global.isPlaceRequired.material}},{key:"selectMaterialSupplier",value:function(t,e){return this.getContractorList(t).then((function(t){return e&&-1===e.id&&t.unshift(e),t}))}},{key:"getFlowUsers",value:function(e){var a=u.a.getUser(),n={id:a.user_id,name:a.user_name},r={item_id:e};return Object(k.a)(r).then((function(e){return t.forEach(e,(function(t){1===Number(t.node_id)?t.users=n:t.users=c.b.includes(t.node_id)?[]:{},t.type=c.c[t.node_id],t.contractor={}})),e}))}},{key:"getUserOptions",value:(a=Object(n.a)(regeneratorRuntime.mark((function t(e){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getCcList(e);case 2:return t.t0=t.sent,t.next=5,this.getAllList(e);case 5:return t.t1=t.sent,t.next=8,this.getCheckerList(e);case 8:return t.t2=t.sent,t.next=11,this.getConstructerList(e);case 11:return t.t3=t.sent,a={cc:t.t0,receiver:t.t1,checker:t.t2,constructer:t.t3},t.abrupt("return",a);case 14:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"submitTask",value:function(e,a){var n=t.cloneDeep(e);if(t.isEmpty(n.section)||!n.section.id)return Promise.reject("请选择所属标段");if(t.isEmpty(n.material)||!n.material.id)return Promise.reject("请选择材料");if(!n.supplier||!n.supplier.id)return Promise.reject("请选择材料供应商");if(this.getPlaceRequired()&&!n.place)return Promise.reject("请填写使用部位");if(n.flowUsers&&n.flowUsers.length){var r="";if(t.forEach(n.flowUsers,(function(e){return t.isEmpty(e.users)||!e.users.id?(r="请选择".concat(e.name),!1):1!==e.node_id||!t.isEmpty(e.contractor)&&e.contractor.id?void 0:(r="请选择接收单位",!1)})),r)return Promise.reject(r)}/^custom\-[\d]+$/.test(n.material.id)&&(n.material.id="");var i=[];n.materialType&&n.materialType.length&&t.each(n.materialType,(function(t){/^custom\-[\d]+$/.test(t.id)&&(t.id=""),i.push({id:t.id,name:t.name,is_manual:t.id?0:1,quantity_unit:t.quantity_unit})}));var o=t.filter(n.flowUsers,(function(t){return 1===t.node_id})),s=o&&o.length&&o[0].users?o[0].users.id:"",l=o&&o.length&&o[0].contractor?o[0].contractor.id:"",c={proj_id:a,bidsection_id:n.section&&n.section.id,category_name:n.material.category_name||"",category_id:n.material.category_id||"",material:{id:n.material.id,name:n.material.name,quantity_unit:n.material.quantity_unit,is_manual:n.material.id?0:1},material_type:i||[],used_part:n.place,contract:n.contract,remark:n.remark,recipient:s,recipient_unit:l,supervisor:"",supplier:n.supplier.name,task_cc:t.map(n.cc||[],"id")};return Object(k.b)({data:Object(m.o)(c)})}},{key:"saveTask",value:function(e,a,n){var r=t.cloneDeep(a);/^custom\-[\d]+$/.test(r.material.id)&&(r.material.id="");var i=t.filter(r.flowUsers,(function(t){return 1===t.node_id})),o=i&&i.length&&i[0].users?i[0].users.id:"",s=i&&i.length&&i[0].contractor?i[0].contractor.id:"",l={task_id:e,proj_id:n,bidsection_id:r.section&&r.section.id,used_part:r.place,contract:r.contract,remark:r.remark,recipient:o,recipient_unit:s,task_cc:t.map(r.cc||[],"id"),task_download_time:a.download_time};return Object(k.g)({data:Object(m.o)(l)},e)}},{key:"deleteTask",value:function(t){$log.log("材料验收--\x3e删除任务",t);var e={id:t};return Object(k.c)(e).then((function(){return b.a.deleteTask(t)})).then((function(){return g.a.removeTodo(t)})).then((function(){h.default.setLocalChanged()})).catch((function(t){return p.a.alert(t)}))}}]),l}(f.a));e.a=v}).call(this,a("391c"))},e3c6:function(t,e,a){"use strict";(function(t){a.d(e,"a",(function(){return b}));a("06a2"),a("6d57"),a("163d"),a("6a61");var n=a("2e91"),r=a("0e4d"),i=a("94ef"),o=a("ed08"),s=a("4ad6"),l=a("7cb8"),c=a("3516"),u=a("37d5"),p=a("3122"),d=a("c745"),m=a("5ff0"),f=a("9ba8"),h=a("59f8"),g=a("9bcb"),k=a("15f5"),b=function(){function e(){Object(r.a)(this,e)}var a,b,_;return Object(i.a)(e,[{key:"getSectionList",value:function(t){return c.a.getSectionList(t)}},{key:"getSectionMaterial",value:function(t){return f.a.getSectionMaterial(t)}},{key:"getContractorList",value:function(t){return m.a.getContractorList(t)}},{key:"getSectionTypeList",value:function(t,e){return f.a.getSectionMaterialTypes(t,e)}},{key:"getGlobalStorage",value:function(t){return h.a.getValue(t)}},{key:"isAllowCustomMaterial",value:(_=Object(n.a)(regeneratorRuntime.mark((function t(e){var a,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getGlobalStorage("allow_add_material_via_app");case 2:return a=t.sent,n="1"===a||"0"===a?"1"===a:Number(JSON.parse(a)[e]),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return _.apply(this,arguments)})},{key:"getContractorOptions",value:(b=Object(n.a)(regeneratorRuntime.mark((function t(e,a){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=null,t.next=3,d.a.allowGroupUserByConstructor();case 3:if(!t.sent){t.next=8;break}return t.next=7,d.a.getOwnedContractorList(e);case 7:n=t.sent;case 8:if(n&&0!==n.length||!a){t.next=12;break}return t.next=11,m.a.getContractorList(a);case 11:n=t.sent;case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}}),t)}))),function(t,e){return b.apply(this,arguments)})},{key:"getUserList",value:function(t,e){return u.default.getProjectUsers(t,e)}},{key:"getCcList",value:function(t){return this.getAllList(t)}},{key:"getConstructerList",value:function(t){return this.getUserList(t,[33])}},{key:"getCheckerList",value:function(t){return this.getAllList(t)}},{key:"getAllList",value:function(t){return this.getUserList(t,[31,32,33])}},{key:"getCurrentUserProjectRoles",value:function(){return u.default.getCurrentUserProjectRoles().then((function(e){return!!t.some(e,t.matches({role_type:32}))}))}},{key:"getMaterialPhotoType",value:function(t,e){return k.a.getMaterialPhotoType(t,e)}},{key:"getPhotoRequirement",value:function(t,e){return k.a.getPhotoRequirement(t,e)}},{key:"getPhotoDetails",value:function(e){return k.a.getPhotoDetails(e).then((function(e){return t.forEach(e,(function(t){t.image_file=Object(l.f)(t.image_file||"[]")})),e}))}},{key:"getProcessDetails",value:(a=Object(n.a)(regeneratorRuntime.mark((function e(a){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPhotoDetails(a);case 2:return r=e.sent,e.abrupt("return",k.a.getProcessDetails(a).then((function(e){return t.forEach(e,function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.user={id:e.operate_user,name:e.user_name,mobile:e.user_mobile},e.recipient_unit={id:e.recipient_unit,name:e.recipient_unit_name},e.photoRequirement=r;case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(t){return a.apply(this,arguments)})},{key:"getTaskLogByStatus",value:function(e,a,n,r){var i=this;return k.a.getTaskByStatus(e,a,n,r).then((function(a){return i.getTaskCcList(e,"被抄送").then((function(e){return a.cc=t.map(e,(function(t){return{id:t.cc,name:t.cc_name,mobile:t.cc_mobile,is_im_user:t.is_im_user}})),a}))}))}},{key:"getTaskCcList",value:function(t,e){return g.a.getTaskCcList(t,e)}},{key:"getCurrentUserOperation",value:function(t){return k.a.getCurrentUserOperation(t)}},{key:"deleteLocalData",value:function(t){return k.a.deleteLocalData(t)}},{key:"uploadImages",value:function(e){var a=[];return t.each(e,(function(t){!t.url&&t.temp?a.push(p.a.uploadImage(t.temp).then((function(e){t.url=e,delete t.temp}))):delete t.temp,!t.videoUrl&&t.videoTemp?a.push(p.a.uploadImage(t.videoTemp).then((function(e){t.videoUrl=e,delete t.videoTemp}))):delete t.videoTemp})),Promise.all(a).then((function(){return e}))}},{key:"insertRemoteData",value:function(e){var a=[];return t.forIn(e,(function(t,e){var n={operation:"replace_insert",table:e,rows:t};a.push(n)})),console.log("insert",a),this.importData({result:a})}},{key:"importData",value:function(t){var e=s.a.appDataPath()+"temp/"+(o.a.uuid()+".json");return s.a.createFile(e,JSON.stringify(t)).then((function(){return s.a.importDataFromFile([e])})).finally((function(){return s.a.deleteFile(e)}))}}]),e}()}).call(this,a("391c"))},e46d:function(t,e,a){"use strict";a.r(e);var n=a("774b"),r=a("2904"),i={name:"MaterialV2TaskAdd",components:{Scroller:n.default,TaskAdd:r.a}},o=a("17cc"),s=Object(o.a)(i,(function(){var t=this.$createElement,e=this._self._c||t;return e("page-content",{attrs:{title:"新建材料验收任务","show-go-root":!0}},[e("scroller",{ref:"scroller"},[e("task-add")],1)],1)}),[],!1,null,null,null);e.default=s.exports},eca2:function(t,e,a){"use strict";a("942a")},ee75:function(t,e,a){"use strict";a("1154")},ef48:function(t,e,a){var n=a("9d55");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("a1a65c0c",n,!0,{sourceMap:!1,shadowMode:!1})},fee3:function(t,e,a){"use strict";a("5ab2"),a("6d57"),a("e10e"),a("cc57");var n=a("28f8"),r=a("e2a7"),i=a("3c64"),o=a("5a71");function s(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?s(Object(a),!0).forEach((function(e){Object(n.a)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var c={name:"MaterialTaskSupplier",components:{ItemTextarea:i.a,SingleSelect:o.a},props:{value:{type:Object,default:function(){}},sectionId:{type:String,default:""},options:{type:Array,default:function(){return[]}}},data:function(){return{selected:{},showSupplier:!1,supplierData:{}}},watch:{value:function(t){this.selected=t}},mounted:function(){this.value&&(this.selected=this.value)},methods:{showSupplierDialog:function(t){var e=this;t.stopPropagation?(t.stopPropagation(),this.supplierData=l({},this.selected)):this.resetSupplierData(),this.showSupplier=!0,setTimeout((function(){e.$refs["textarea-supplier"].$refs.input.focus()}),50)},checkSectionIsAvailable:function(){if(!this.sectionId)return r.a.alert("请先选择标段"),!1},supplierSubmit:function(t,e){var a=this;if("confirm"===t){var n=this.supplierData.name=this.supplierData.name.trim();if(n.length<1)return e(!1);this.options.some((function(t){if(t.name===n)return a.supplierData.id=t.id,!0})),this.selected=l({},this.supplierData),this.$refs.singleSelectDialog.closePopup(),e()}else this.resetSupplierData(),e();this.changeSelected(this.selected)},resetSupplierData:function(){this.supplierData={id:"-1",name:""}},changeSelected:function(t){this.selected=t,this.$emit("input",t)}}},u=(a("9e20"),a("ee75"),a("17cc")),p=Object(u.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("single-select",{ref:"singleSelectDialog",attrs:{options:t.options,"before-open":t.checkSectionIsAvailable,"right-btn":"手工添加","editor-add-data":!0,title:"材料供应商"},on:{rightBtnEvent:t.showSupplierDialog,onSelect:t.changeSelected},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),a("van-dialog",{attrs:{"show-cancel-button":"","get-container":"body","cancel-button-color":"#666","class-name":"custom-material-dialog","before-close":t.supplierSubmit},model:{value:t.showSupplier,callback:function(e){t.showSupplier=e},expression:"showSupplier"}},[a("div",[a("item-textarea",{ref:"textarea-supplier",staticClass:"text-area-border",attrs:{placeholder:"请输入材料供应商名称",maxlength:20},model:{value:t.supplierData.name,callback:function(e){t.$set(t.supplierData,"name",e)},expression:"supplierData.name"}})],1)])],1)}),[],!1,null,null,null);e.a=p.exports}}]);