(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-7cd8882d"],{"2d6e":function(t,i,e){var a=e("7eb2");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,e("85cb").default)("53a2fbaa",a,!0,{sourceMap:!1,shadowMode:!1})},"30e2":function(t,i){t.exports="data:image/png;base64,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"},"65e9":function(t,i,e){"use strict";(function(t){e("5ab2"),e("6d57"),e("e10e");var a=e("28f8"),n=e("4360"),s=e("48f4"),o=e("162a"),h=e("f2d3"),r=e("6906"),c=e("a18c"),l=e("c745");function u(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);i&&(a=a.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,a)}return e}function d(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?u(Object(e),!0).forEach((function(i){Object(a.a)(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):u(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}i.a={name:"SynchronizeTipBar",props:{isTodo:{type:Boolean},useDownload:{type:Boolean,default:!0},enterDoCheck:{type:Boolean,default:!0},buildingId:{type:String,default:""},automaticUpdateCallback:{type:Function,default:null}},data:function(){return{currentModuleCode:"",oneUpdateData:!0}},computed:{projId:function(){return n.a.state.global.currentProject.id},waitUploadNum:function(){return n.a.state.global.waitUploadNum},hasTopProgress:function(){return n.a.state.global.hasTopProgress},hasChanged:function(){if(!this.useDownload)return!1;if(this.currentModuleCode){var t,i=s.default.isModuleNeedBuilding(this.currentModuleCode)&&!this.isTodo;return!(i&&!this.buildingId)&&(t=this.isTodo?n.a.state.global.todoChangedStatus||{}:n.a.state.global.businessChangedStatus||{},i?!!t[this.currentModuleCode]&&t[this.currentModuleCode][this.buildingId]:t[this.currentModuleCode])}return!1},show:function(){return(this.hasChanged||this.waitUploadNum)&&!this.hasTopProgress},oneDataSync:function(){return this.$store.state.app.oneDataSync}},watch:{hasChanged:function(t){var i=this;t&&this.$nextTick((function(){setTimeout((function(){var t=i.$refs["synchronize-tip-bar"];if(t&&t.style){t.style.display="none";t.offsetHeight;t.style.display="block"}}),100)}))},buildingId:function(t){this.currentModuleCode&&s.default.isModuleNeedBuilding(this.currentModuleCode)&&t&&(console.log("楼栋重新加载，是否再次自动加载数据：",this.oneUpdateData),this.oneUpdateData&&this.automaticLogic(),this.checkSync())},show:function(t){t?this.$emit("show"):this.$emit("hide")}},activated:function(){this.init()},methods:{init:function(){this.getCurrentModuleCode(),this.enterDoCheck&&!c.a.isBack&&this.checkSync(),this.automaticLogic()},automaticLogic:function(){var t=this;this.$router.isBack||(this.oneUpdateData=!0,l.a.getAutomaticLoadData().then((function(i){$log.log("是否要自动加载 ===> ",i&&t.oneDataSync&&"function"==typeof t.automaticUpdateCallback),i&&t.oneDataSync&&"function"==typeof t.automaticUpdateCallback&&t.dataSync().then((function(i){console.log("是否需要初始化页面 ====> ",Boolean(i)),i&&t.automaticUpdateCallback()}))})))},getCurrentModuleCode:function(){var t=s.default.getCurrentModuleCode(),i=this.isTodo?"todo":"";this.currentModuleCode=t||i},checkSync:function(){var i=this,e="checkDataUpdate",a=this.currentModuleCode,o=this.buildingId,c=n.a.state.global.isLeader?this.projId:"";return!s.default.isModuleNeedBuilding(a)||o||this.isTodo?(this.isTodo&&(e+="_todo"),a&&(e+="_".concat(a)),o&&(e+="_".concat(o)),r.a.execAfterInterval(120,e).then((function(){return i.isTodo?"todo"===a?h.a.getModuleList().then((function(i){var e=t.map(i,"code");return s.default.hasTodoChangedData("",e)})):s.default.hasTodoChangedData("",[a]):s.default.hasBusinessChangedData(c,[a],o)})).then((function(t){if(i.isTodo){var e=d({},n.a.state.global.todoChangedStatus);e[a]=t,n.a.commit("global/SET_TODO_CHANGED_STATUS",e)}else{var s=d({},n.a.state.global.businessChangedStatus);if(o){var h=s[a]?s[a]:{};h[o]=t,s[a]=h}else s[a]=t;n.a.commit("global/SET_BUSINESS_CHANGED_STATUS",s)}})).catch((function(t){return t&&!0===t.timeNotTo?($log.debug(t.msg),!1):$q.reject(t)}))):Promise.resolve()},dataSync:function(){var t=this.currentModuleCode,i=this.buildingId,e=s.default.isModuleNeedBuilding(t),a=e&&!i;return $log.log(["模块名：",t," 楼栋id：",i," 当前模块是否需要楼栋id：",e," 判断是否终止自动更新：",a]),a?Promise.resolve():(this.oneUpdateData=!1,o.a.beginManualUpdate(),s.default.checkSync(i).then((function(t){return o.a.endManualUpdate(),t})).catch((function(t){$log.error("自动更新错误",t),o.a.endManualUpdate()})))}}}}).call(this,e("391c"))},"7eb2":function(t,i,e){(t.exports=e("690e")(!1)).push([t.i,".zjapp .synchronize-tip-bar[data-v-66826030]{height:30px;padding:5px 15px;line-height:20px;text-align:center;background-color:#ffe6e6;color:#ff6060;font-size:14px}.zjapp .synchronize-tip-bar .icon-caution[data-v-66826030]{line-height:20px;margin-right:5px}@media screen and (-webkit-min-device-pixel-ratio:1){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 100%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:1.5){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 66.6667%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2.625){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 38.0952%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:3){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 33.3333%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:4){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 25%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}",""])},"8aaa":function(t,i,e){var a=e("b877");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,e("85cb").default)("56085726",a,!0,{sourceMap:!1,shadowMode:!1})},b877:function(t,i,e){var a=e("5454");(t.exports=e("690e")(!1)).push([t.i,".zjapp .drawing-con[data-v-45a47aae]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;font-size:0;line-height:0}.zjapp .drawing-con canvas[data-v-45a47aae]{display:block;height:100%;width:100%;background:url("+a(e("eb66"))+") #fff;background-size:4px 4px}.zjapp .loading-text[data-v-45a47aae]{margin-top:15px;color:#aaa}.zjapp .error-text[data-v-45a47aae],.zjapp .loading-text[data-v-45a47aae]{padding:0 15px;line-height:20px;text-align:center;font-size:16px}.zjapp .error-text[data-v-45a47aae]{color:#ff3d3d}",""])},bfbc2:function(t,i,e){"use strict";e("8aaa")},c652:function(t,i,e){"use strict";(function(t){var a=e("e3ee"),n=(e("6f84"),e("6d57"),e("163d"),e("a32d")),s=e.n(n),o=e("e900"),h=e("3122"),r=e("4ad6"),c=e("3bd5"),l=e("1b7e");function u(t){var i=t.changedTouches.length,e=t.touches.length;return 1===i||2===i||2===e}function d(t){return 1===t.touches.length}i.a={name:"Drawing",props:{url:{type:String},points:{type:Array,default:function(){return[]}},pointColor:{type:String,default:"#ff4546"},pointRadius:{type:Number,default:8},scaleMax:{type:Number,default:4},clickDelay:{type:Number,default:500},folder:{type:String,default:"house-image"}},data:function(){return{isDownloading:!1,error:"",canvas:null,ctx:null,img:null,src:"",width:0,height:0,x:0,y:0,scale:1,defaultScale:1,pixelRatio:1,markPosition:null,markPositionImageData:[],markCoordinates:[],pinchRatio:0,xRange:null,yRange:null,scaleBetween:[],isPinch:!1,clickPoints:[],touchStart:{x:0,y:0,cx:0,cy:0,time:0},popupPoint:null,popupCallback:function(){},isMoving:!1,pinchCenter:{}}},watch:{url:function(){this.getImage()},points:function(t){this.ctx&&this.draw()}},mounted:function(){this.getImage()},destroyed:function(){this.canvas&&(this.canvas.width=0,this.canvas.height=0)},methods:{getImage:function(){var i=this;if(this.isDownloading=!0,this.url){var e=c.a.getUser().user_id,a=s.a.replaceAll(this.url,"\\?x-oss-process=image\\/resize,","@"),n=s.a.strRightBack(a,"/");if(!n)return this.error="户型图地址错误",void(this.isDownloading=!1);this.error="";var o=[r.a.appImagePath()+e+"/house-image/"+n,r.a.appImagePath()+e+"/drawing/"+n,r.a.appImagePath()+e+"/images/"+n,r.a.appDataPath()+e+"/house-image/"+n,r.a.appDataPath()+e+"/drawing/"+n,r.a.appDataPath()+e+"/images/"+n],u=Promise.resolve();return"dev"===APP_ENV?u=u.then((function(){return i.url})):t.each(o,(function(t){u=u.then((function(i){return i||r.a.isFileExists(t).then((function(i){if(i)return h.a._fixPath(t)}))}))})),u.then((function(t){if(!t)return l.a.getHasNetwork().then((function(t){return t?h.a.download(i.url,!0,i.folder).then((function(t){i.src=t})):Promise.reject("当前无网络")}));i.src=t})).then((function(){i.src?(i.img=new Image,i.img.onload=function(){i.img.complete?(i.isDownloading=!1,i.$nextTick(i.init)):(i.error="加载图片失败",i.isDownloading=!1)},i.img.onerror=function(){i.error="加载图片失败",i.isDownloading=!1},i.img.src=i.src):(i.error="下载户型图失败",i.isDownloading=!1)})).catch((function(e){i.error=t.isString(e)?e:"下载户型图失败",i.isDownloading=!1}))}this.error="户型图地址错误",this.isDownloading=!1},init:function(){if(this.$refs["drawing-canvas"]){var t=this.$refs.content;this.canvas=this.$refs["drawing-canvas"],this.ctx=this.canvas.getContext("2d"),this.width=t.offsetWidth,this.height=t.offsetHeight,this.pixelRatio=this.getPixelRatio(this.ctx),this.canvas.style.height=this.height+"px",this.canvas.style.width=this.width+"px",this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,!this.ctx.extended&&Object(o.a)(this.ctx),this.bindTouchEvent(),this.calc(),this.draw()}},getPixelRatio:function(t){var i=t.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/i},winToCanvas:function(t,i){var e=this.canvas.getBoundingClientRect();return{x:t-e.left*(this.canvas.width/(e.width*this.pixelRatio)),y:i-e.top*(this.canvas.height/(e.height*this.pixelRatio))}},calc:function(){var t,i;this.width/this.img.width<this.height/this.img.height?(t=this.width/this.img.width,this.x=0,this.y=(this.height-this.img.height*t)/2*this.pixelRatio):(t=this.height/this.img.height,this.x=(this.width-this.img.width*t)/2*this.pixelRatio,this.y=0),this.scale=t*this.pixelRatio,i=this.scale<.25?2:8*this.scale,this.scaleBetween=[this.scale,i],this.xRange=[this.x,this.x],this.yRange=[this.y,this.y]},bindTouchEvent:function(){this.canvas.addEventListener("touchstart",this.onTouchstart),this.canvas.addEventListener("touchmove",this.onTouchmove),this.canvas.addEventListener("touchend",this.onTouchend)},unbindTouchEvent:function(){this.canvas.removeEventListener("touchstart",this.onTouchstart),this.canvas.removeEventListener("touchmove",this.onTouchmove),this.canvas.removeEventListener("touchend",this.onTouchend)},onTouchstart:function(t){if(t.preventDefault(),t.stopPropagation(),this.isPinch=!1,d(t))this.touchStartHandler(t);else if(u(t)){var i,e=t.touches[0],a=t.touches[1],n=this.winToCanvas(e.clientX,e.clientY),s=this.winToCanvas(a.clientX,a.clientY);i=Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2)),this.pinchRatio=this.scale/i}},onTouchmove:function(t){var i=t.touches[0];t.preventDefault(),t.stopPropagation(),d(t)?(Math.abs(i.clientX-this.touchStart.cx)>3||Math.abs(i.clientY-this.touchStart.cy)>3)&&this.touchMoveHandler(t):u(t)&&this.touchPinchHandler(t)},onTouchend:function(t){t.preventDefault(),t.stopPropagation(),this.touchEndHandler(t)},touchStartHandler:function(t){var i=t.touches[0],e=this.winToCanvas(i.clientX,i.clientY);this.touchStart={x:e.x,y:e.y,cx:i.clientX,cy:i.clientY,time:Date.now()}},touchMoveHandler:function(t){var i=t.touches[0],e=this.winToCanvas(i.clientX,i.clientY),a=(e.x-this.touchStart.x)*this.pixelRatio,n=(e.y-this.touchStart.y)*this.pixelRatio,s=this.getMoveOverflow();this.isPinch||(this.touchStart.x=e.x,this.touchStart.y=e.y,this.x<this.xRange[0]||this.x>this.xRange[1]?this.x+=a*Math.abs(this.canvas.width/2-s.x)/this.canvas.width/2:this.x+=a,this.y<this.yRange[0]||this.y>this.yRange[1]?this.y+=n*Math.abs(this.canvas.height/2-s.y)/this.canvas.height/2:this.y+=n,this.draw())},touchPinchHandler:function(t){var i,e,a,n,s,o=t.touches[0],h=t.touches[1],r=this.winToCanvas(o.clientX,o.clientY),c=this.winToCanvas(h.clientX,h.clientY),l=Math.sqrt(Math.pow(c.x-r.x,2)+Math.pow(c.y-r.y,2));this.isPinch=!0,i=this.pinchRatio*l,a=this.getScaleOverflow(i),n=this.scaleBetween[0]/2,s=(Math.abs(a)>n?1:Math.abs(a)/n)/2,i-=a?a*s:0,this.pinchCenter=e={x:(r.x+c.x)/2*this.pixelRatio,y:(r.y+c.y)/2*this.pixelRatio},this.x=e.x-i/this.scale*(e.x-this.x),this.y=e.y-i/this.scale*(e.y-this.y),i!==this.scale&&(this.scale=i,this.setMoveRange(),this.draw())},touchEndHandler:function(t){var i=t.changedTouches[0];Date.now()-this.touchStart.time<this.clickDelay&&Math.abs(i.clientX-this.touchStart.cx)<6&&Math.abs(i.clientY-this.touchStart.cy)<6&&this.clickHandler(t),this.straighten(t)},clickHandler:function(t){var i,e=t.changedTouches[0],a=this.winToCanvas(e.clientX,e.clientY),n={x:(a.x-this.x/this.pixelRatio)/this.scale*this.pixelRatio,y:(a.y-this.y/this.pixelRatio)/this.scale*this.pixelRatio},s=this.getClickPoint(n),o=this.getClickBtn(a);i=o?{type:"btn",pos:a,x:n.x,y:n.y,point:this.popupPoint,btn:o}:{type:s?"point":"",pos:a,x:n.x,y:n.y,point:s,btn:""},o?this.popupCallback(i):n.x>=0&&n.x<=this.img.width&&n.y>=0&&n.y<=this.img.height&&this.$emit("onclick",i)},moveTo:function(t,i){var e=this;t===this.x&&i===this.y||(this.isMoving=!0,setTimeout((function(){var a=!1;Math.abs(t-e.x)<1?e.x=t:(e.x+=.5*(t-e.x),a=!0),Math.abs(i-e.y)<1?e.y=i:(e.y+=.5*(i-e.y),a=!0),a?(e.moveTo(t,i),e.draw()):e.isMoving=!1}),20))},getClickPoint:function(t){var i,e=this,a=2*this.pointRadius+1;return this.points.forEach((function(n){var s=Math.sqrt(Math.pow(Math.abs(t.x-n.x),2)+Math.pow(Math.abs(t.y-n.y),2))*e.scale/e.pixelRatio;s<=2*e.pointRadius&&s<a&&(i=n,a=s)})),i},getClickBtn:function(t){var i,e;return this.popupPoint&&(i=this.getPopupPos(),this.isPointInArea(t.x,t.y,i.x,i.y,80,44)?e="cancel":this.isPointInArea(t.x,t.y,i.x+80,i.y,120,44)&&(e="ok")),e},isPointInArea:function(t,i,e,a,n,s){return t>e&&t<e+n&&i>a&&i<a+s},setMoveRange:function(){var t=this.getMoveRange(this.scale);this.xRange=t.x,this.yRange=t.y},getMoveRange:function(t){var i,e,a,n,s,o,h,r=this.getPopupPos();return t=t||this.scale,e=(i=this.width*this.pixelRatio-this.img.width*t)>0?i/=2:0,n=(a=this.height*this.pixelRatio-this.img.height*t)>0?a/=2:0,this.popupPoint&&(s=(s=this.x-r.x*this.pixelRatio)>0&&s>e?s-e:0,i+=o=(o=this.x+this.img.width*this.scale-(r.x+200)*this.pixelRatio)<0&&o+e>this.img.width*this.scale?o+e-this.img.width*this.scale:0,e+=s,n+=h=(h=this.y-r.y*this.pixelRatio)>0&&h>n?h-n:0),{x:[i,e],y:[a,n]}},straighten:function(t){var i=this;if(!(t&&"touchend"===t.type&&0!==t.touches.length||this.isMoving)){var e=this.scale<this.scaleBetween[0]?this.scaleBetween[0]:this.scale>this.scaleBetween[1]?this.scaleBetween[1]:this.scale,a=this.getMoveRange(e),n=a.x,s=a.y;(this.x<n[0]||this.x>n[1]||this.y<s[0]||this.y>s[1]||this.scale<this.scaleBetween[0]||this.scale>this.scaleBetween[1])&&setTimeout((function(){var t=i.pinchCenter.x?i.pinchCenter.x-e*(i.pinchCenter.x-i.x)/i.scale:i.x,a=i.pinchCenter.y?i.pinchCenter.y-e*(i.pinchCenter.y-i.y)/i.scale:i.y,o=!1;t=t<n[0]?n[0]:t>n[1]?n[1]:t,a=a<s[0]?s[0]:a>s[1]?s[1]:a,Math.abs(t-i.x)<1?i.x=t:(i.x+=.5*(t-i.x),o=!0),Math.abs(a-i.y)<1?i.y=a:(i.y+=.5*(a-i.y),o=!0),Math.abs(e-i.scale)*i.img.width*i.img.height<5?i.scale=e:(i.scale+=.5*(e-i.scale),o=!0),o&&(i.straighten(),i.draw())}),20)}},getMoveOverflow:function(){return{x:this.x<this.xRange[0]?this.x-this.xRange[0]:this.x>this.xRange[1]?this.x-this.xRange[1]:0,y:this.y<this.yRange[0]?this.y-this.yRange[0]:this.y>this.yRange[1]?this.y-this.yRange[1]:0}},getScaleOverflow:function(t){return(t=t||this.scale)<this.scaleBetween[0]?t-this.scaleBetween[0]:t>this.scaleBetween[1]?t-this.scaleBetween[1]:0},openPopup:function(t){var i,e=0,a=0;this.popupPoint=t.point,this.popupCallback=t.callback,this.draw(),(i=this.getPopupPos()).x<0?e=i.x*this.pixelRatio:i.x+200>this.width&&(e=(i.x+200-this.width)*this.pixelRatio),i.y<0&&(a=i.y*this.pixelRatio);var n=this.getMoveRange(this.scale);this.xRange=n.x,this.yRange=n.y,this.moveTo(this.x-e,this.y-a)},closePopup:function(){this.popupPoint=null,this.draw(),this.straighten()},draw:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawImage(),this.drawPoints(),this.drawPopup()},drawImage:function(){this.ctx.drawImage(this.img,0,0,this.img.width,this.img.height,this.x,this.y,this.img.width*this.scale,this.img.height*this.scale)},drawPoints:function(t){var i=this;this.points.forEach((function(e,a){i.drawPoint(e.x*i.scale/i.pixelRatio+i.x/i.pixelRatio,e.y*i.scale/i.pixelRatio+i.y/i.pixelRatio,i.pointRadius,a,t,e.color,e.style),e.index=a}))},drawPoint:function(t,i,e,a,n,s,o){this.ctx.save(),this.ctx.beginPath(),this.ctx.shadowBlur=0,this.ctx.shadowColor="transparent",this.ctx.arc(t,i,e,0,2*Math.PI,!1),this.ctx.globalAlpha="not_fill"===o?.5:.6,s&&(this.ctx.fillStyle="not_fill"===o?"#fff":s),this.ctx.fill(),this.ctx.globalAlpha=1,s&&(this.ctx.strokeStyle=s),this.ctx.lineWidth="not_fill"===o?2:1,this.ctx.stroke()},drawPopup:function(){var t,i,e,a,n;this.popupPoint&&(t=(n=this.getPopupPos()).x,i=n.y,e=200,a=44,4,this.ctx.shadowBlur=5,this.ctx.shadowColor="#999",this.ctx.lineWidth=0,this.ctx.strokeStyle="transparent",this.ctx.fillStyle="#ffffff",this.ctx.beginPath(),this.ctx.arc(t+4,i+4,4,Math.PI,3*Math.PI/2),this.ctx.lineTo(t+80,i),this.ctx.lineTo(t+80,i+a),this.ctx.lineTo(t-4,i+a),this.ctx.arc(4+t,40+i,4,1*Math.PI/2,Math.PI),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#4275e8",this.ctx.beginPath(),this.ctx.arc(196+t,4+i,4,3*Math.PI/2,2*Math.PI),this.ctx.lineTo(e+t,a+i-4),this.ctx.arc(196+t,40+i,4,0,1*Math.PI/2),this.ctx.lineTo(e+t-67.5,a+i),this.ctx.lineTo(e+t-60,a+i+7),this.ctx.lineTo(e+t-52.5,a+i),this.ctx.lineTo(t+80,a+i),this.ctx.lineTo(t+80,i),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowColor="transparent",this.ctx.font='18px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',this.ctx.textAlign="center",this.ctx.fillStyle="#111111",this.ctx.fillText("取消",t+40,i+30),this.ctx.font='18px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',this.ctx.textAlign="center",this.ctx.fillStyle="#ffffff",this.ctx.fillText("开始验收",t+140,i+30))},getPopupPos:function(){var t=54+this.pointRadius+3;return this.popupPoint?{x:this.popupPoint.x*this.scale/this.pixelRatio+this.x/this.pixelRatio-140,y:this.popupPoint.y*this.scale/this.pixelRatio+this.y/this.pixelRatio-t}:{}},refreshLayout:function(){var t=this;this.$nextTick((function(){var i=t.$refs.content;if(i&&t.canvas){t.width=i.offsetWidth,t.height=i.offsetHeight,t.canvas.style.height=t.height+"px",t.canvas.style.width=t.width+"px",t.canvas.width=t.width*t.pixelRatio,t.canvas.height=t.height*t.pixelRatio,t.calc();var e=Object(a.a)(t.xRange,2),n=e[0],s=e[1],o=Object(a.a)(t.yRange,2),h=o[0],r=o[1],c=Object(a.a)(t.scaleBetween,2),l=c[0],u=c[1];t.x<n?t.x=n:t.x>s&&(t.x=s),t.y<h?t.y=h:t.y>r&&(t.y=r),t.scale<l?t.scale=l:t.scale>u&&(t.scale=u),t.draw()}}))}}}}).call(this,e("391c"))},ccf5:function(t,i,e){"use strict";var a=e("c652").a,n=(e("bfbc2"),e("17cc")),s=Object(n.a)(a,(function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",t._g({ref:"content",staticClass:"drawing-con"},t.$listeners),[t.isDownloading?[e("p",[e("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[e("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]),e("p",{staticClass:"loading-text"},[t._v("正在下载...")])]:[t.error?t._e():e("canvas",{ref:"drawing-canvas"}),t.error?e("p",{staticClass:"error-text"},[t._v(t._s(t.error))]):t._e()]],2)}),[],!1,null,"45a47aae",null);i.a=s.exports},e900:function(t,i,e){"use strict";e.d(i,"a",(function(){return a})),e.d(i,"b",(function(){return n}));e("f548");function a(t){var i,e,a,n=(e=(i=t).backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,(window.devicePixelRatio||1)/e);1!==n&&(!function(t,i){for(var e in t)t.hasOwnProperty(e)&&i(t[e],e)}({fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all"},(function(i,e){var a;t[e]=(a=t[e],function(){var t,e,s=Array.prototype.slice.call(arguments);if("all"===i)s=s.map((function(t){return t*n}));else if(Array.isArray(i))for(t=0,e=i.length;t<e;t++)s[i[t]]*=n;return a.apply(this,s)})})),t.stroke=(a=t.stroke,function(){this.lineWidth*=n,a.apply(this,arguments),this.lineWidth/=n}),t.fillText=function(t){return function(){var i=Array.prototype.slice.call(arguments);i[1]*=n,i[2]*=n,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,i,e){return i*n+e})),t.apply(this,i),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,i,e){return i/n+e}))}}(t.fillText),t.strokeText=function(t){return function(){var i=Array.prototype.slice.call(arguments);i[1]*=n,i[2]*=n,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,i,e){return i*n+e})),t.apply(this,i),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,i,e){return i/n+e}))}}(t.strokeText),t.extended=!0)}var n=function(t){var i,e;(i=t).getContext=(e=i.getContext,function(t){var i,n,s=e.call(this,t);return"2d"===t&&(i=s.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1,(n=(window.devicePixelRatio||1)/i)>1&&(this.style.height=this.height+"px",this.style.width=this.width+"px",this.width*=n,this.height*=n)),a(s),s})}},f7ab:function(t,i,e){"use strict";var a=e("65e9").a,n=(e("f7d4"),e("17cc")),s=Object(n.a)(a,(function(){var t=this,i=t.$createElement,e=t._self._c||i;return t.show?e("div",{ref:"synchronize-tip-bar",staticClass:"synchronize-tip-bar"},[e("icon",{attrs:{name:"caution"}}),t.waitUploadNum?e("span",[t._v("您有"+t._s(t.waitUploadNum)+"条数据待上传")]):t._e(),!t.waitUploadNum&&t.hasChanged?e("span",[t._v("有新数据")]):t._e(),t._v("\n  ，下拉可"+t._s(t.waitUploadNum?"上传":"刷新")+"\n")],1):t._e()}),[],!1,null,"66826030",null);i.a=s.exports},f7d4:function(t,i,e){"use strict";e("2d6e")}}]);