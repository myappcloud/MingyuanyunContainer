(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-706adb2e","chunk-2d2263f6"],{"2d6e":function(t,e,a){var o=a("7eb2");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);(0,a("85cb").default)("53a2fbaa",o,!0,{sourceMap:!1,shadowMode:!1})},5830:function(t,e,a){"use strict";a.r(e);var o=a("e0c0").a,n=a("17cc"),r=Object(n.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-content",{attrs:{title:"闭水试验"}},[a("synchronize-tip-bar",{attrs:{"automatic-update-callback":t.init}}),a("drop-down-select",{staticClass:"bg-sub-theme border-bottom",attrs:{value:t.place,options:t.placeOptions,stage:3,"min-select-stage":2,"options-map":[{name:"标段"},{key:"children",name:"楼栋"},{key:"children",name:"单元"}],"empty-text":["无标段","无楼栋","无单元"]},on:{onSelect:t.setPlace}},[a("div",{staticClass:"select-text"},[t._v(t._s(t.placeText))])]),a("scroller",{on:{pullDown:t.init}},[a("status-total-bar",{attrs:{data:t.total}}),a("place-list",{directives:[{name:"track",rawName:"v-track",value:"闭水试验-进入房间",expression:"'闭水试验-进入房间'"}],attrs:{data:t.floorList,"has-title":!0,"status-class":{"合格":"bg-green","不合格":"bg-red","已放水待验收":"bg-orange"}},on:{click:t.gotoDetail}}),a("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.floorList||!t.floorList.length,"empty-text":t.place.building&&t.place.building.id?"没有楼层":"当前项目没有楼栋"}})],1)],1)}),[],!1,null,null,null);e.default=r.exports},"5b85":function(t,e,a){var o=a("e2a8");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);(0,a("85cb").default)("45a0f20c",o,!0,{sourceMap:!1,shadowMode:!1})},"65e9":function(t,e,a){"use strict";(function(t){a("5ab2"),a("6d57"),a("e10e");var o=a("28f8"),n=a("4360"),r=a("48f4"),i=a("162a"),c=a("f2d3"),s=a("6906"),d=a("a18c"),u=a("c745");function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function p(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){Object(o.a)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}e.a={name:"SynchronizeTipBar",props:{isTodo:{type:Boolean},useDownload:{type:Boolean,default:!0},enterDoCheck:{type:Boolean,default:!0},buildingId:{type:String,default:""},automaticUpdateCallback:{type:Function,default:null}},data:function(){return{currentModuleCode:"",oneUpdateData:!0}},computed:{projId:function(){return n.a.state.global.currentProject.id},waitUploadNum:function(){return n.a.state.global.waitUploadNum},hasTopProgress:function(){return n.a.state.global.hasTopProgress},hasChanged:function(){if(!this.useDownload)return!1;if(this.currentModuleCode){var t,e=r.default.isModuleNeedBuilding(this.currentModuleCode)&&!this.isTodo;return!(e&&!this.buildingId)&&(t=this.isTodo?n.a.state.global.todoChangedStatus||{}:n.a.state.global.businessChangedStatus||{},e?!!t[this.currentModuleCode]&&t[this.currentModuleCode][this.buildingId]:t[this.currentModuleCode])}return!1},show:function(){return(this.hasChanged||this.waitUploadNum)&&!this.hasTopProgress},oneDataSync:function(){return this.$store.state.app.oneDataSync}},watch:{hasChanged:function(t){var e=this;t&&this.$nextTick((function(){setTimeout((function(){var t=e.$refs["synchronize-tip-bar"];if(t&&t.style){t.style.display="none";t.offsetHeight;t.style.display="block"}}),100)}))},buildingId:function(t){this.currentModuleCode&&r.default.isModuleNeedBuilding(this.currentModuleCode)&&t&&(console.log("楼栋重新加载，是否再次自动加载数据：",this.oneUpdateData),this.oneUpdateData&&this.automaticLogic(),this.checkSync())},show:function(t){t?this.$emit("show"):this.$emit("hide")}},activated:function(){this.init()},methods:{init:function(){this.getCurrentModuleCode(),this.enterDoCheck&&!d.a.isBack&&this.checkSync(),this.automaticLogic()},automaticLogic:function(){var t=this;this.$router.isBack||(this.oneUpdateData=!0,u.a.getAutomaticLoadData().then((function(e){$log.log("是否要自动加载 ===> ",e&&t.oneDataSync&&"function"==typeof t.automaticUpdateCallback),e&&t.oneDataSync&&"function"==typeof t.automaticUpdateCallback&&t.dataSync().then((function(e){console.log("是否需要初始化页面 ====> ",Boolean(e)),e&&t.automaticUpdateCallback()}))})))},getCurrentModuleCode:function(){var t=r.default.getCurrentModuleCode(),e=this.isTodo?"todo":"";this.currentModuleCode=t||e},checkSync:function(){var e=this,a="checkDataUpdate",o=this.currentModuleCode,i=this.buildingId,d=n.a.state.global.isLeader?this.projId:"";return!r.default.isModuleNeedBuilding(o)||i||this.isTodo?(this.isTodo&&(a+="_todo"),o&&(a+="_".concat(o)),i&&(a+="_".concat(i)),s.a.execAfterInterval(120,a).then((function(){return e.isTodo?"todo"===o?c.a.getModuleList().then((function(e){var a=t.map(e,"code");return r.default.hasTodoChangedData("",a)})):r.default.hasTodoChangedData("",[o]):r.default.hasBusinessChangedData(d,[o],i)})).then((function(t){if(e.isTodo){var a=p({},n.a.state.global.todoChangedStatus);a[o]=t,n.a.commit("global/SET_TODO_CHANGED_STATUS",a)}else{var r=p({},n.a.state.global.businessChangedStatus);if(i){var c=r[o]?r[o]:{};c[i]=t,r[o]=c}else r[o]=t;n.a.commit("global/SET_BUSINESS_CHANGED_STATUS",r)}})).catch((function(t){return t&&!0===t.timeNotTo?($log.debug(t.msg),!1):$q.reject(t)}))):Promise.resolve()},dataSync:function(){var t=this.currentModuleCode,e=this.buildingId,a=r.default.isModuleNeedBuilding(t),o=a&&!e;return $log.log(["模块名：",t," 楼栋id：",e," 当前模块是否需要楼栋id：",a," 判断是否终止自动更新：",o]),o?Promise.resolve():(this.oneUpdateData=!1,i.a.beginManualUpdate(),r.default.checkSync(e).then((function(t){return i.a.endManualUpdate(),t})).catch((function(t){$log.error("自动更新错误",t),i.a.endManualUpdate()})))}}}}).call(this,a("391c"))},"7eb2":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .synchronize-tip-bar[data-v-66826030]{height:30px;padding:5px 15px;line-height:20px;text-align:center;background-color:#ffe6e6;color:#ff6060;font-size:14px}.zjapp .synchronize-tip-bar .icon-caution[data-v-66826030]{line-height:20px;margin-right:5px}@media screen and (-webkit-min-device-pixel-ratio:1){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 100%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:1.5){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 66.6667%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2.625){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 38.0952%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:3){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 33.3333%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:4){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 25%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}",""])},e0c0:function(t,e,a){"use strict";(function(t){a("5ab2"),a("6d57"),a("e10e");var o,n=a("28f8"),r=(a("6a61"),a("2e91")),i=(a("cc57"),a("f7ab")),c=a("774b"),s=a("f546"),d=a("efa7"),u=a("d623"),l=a("e2a7"),p=a("f97c"),f=a("7bac"),b=a("a7c3"),h=a("aab3"),g=a("db50"),m=a("6f9e"),v=a("7cb8");function k(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function y(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?k(Object(a),!0).forEach((function(e){Object(n.a)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}e.a={name:"WaterPercolation",components:{SynchronizeTipBar:i.a,Scroller:c.default,StatusTotalBar:s.a,PlaceList:d.a,DropDownSelect:u.default},data:function(){return{isLoading:!0,placeOptions:[],place:[],floorList:[],total:[]}},computed:{placeText:function(){return this.isLoading?"...":t.isEmpty(this.place)?"请选择":this.place[1].name+(t.isEmpty(this.place[2])?"":this.place[2].name)}},created:function(){Object(m.e)(this.init)},activated:function(){this.projId=p.a.getDefaultProject().id,this.init()},methods:{init:(o=Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getPlaceOptions();case 2:return t.next=4,this.getPlace();case 4:return t.next=6,this.getFloorList();case 6:this.isLoading=!1;case 7:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)}),getPlaceOptions:function(){var e=this;return this.projId?h.a.getSectionAndBuildings(this.projId).then((function(a){e.placeOptions=t.map(a,(function(e){var a=y(y({},e),{},{children:t.map(e.buildings,(function(t){var e=y(y({},t),{},{children:t.units});return delete e.units,e}))});return delete a.buildings,a}))})).catch((function(t){console.error(t)})):Promise.resolve()},getPlace:function(){var t=this;return console.log("我更新了","获取当前位置"),f.a.getUserObject(b.a.WATER_PERCOLATION_BUILDING).then((function(e){var a=(e||{})[t.projId],o=[];o=Object(v.k)(a,t.placeOptions)?a:Object(v.h)(t.placeOptions),t.place=o}))},setPlace:function(t){var e=this;return f.a.getUserObject(b.a.WATER_PERCOLATION_BUILDING).then((function(a){return a=a||{},e.place=t,a[e.projId]=t,f.a.saveUserObject(b.a.WATER_PERCOLATION_BUILDING,a).then((function(){e.getFloorList()}))}))},getFloorList:function(){var e=this,a=this.place[1]?this.place[1].id:"",o=this.place[2]?this.place[2].id:"";return h.a.getFloorListWithRooms(a,o).then((function(e){return t.map(e,(function(t){var e=y(y({},t),{},{name:t.floorName,children:t.rooms});return delete e.rooms,e}))})).then((function(t){e.getTotal(t)})).catch((function(t){console.error(t)}))},getTotal:function(e){var a=this,o=this.place[1]?this.place[1].id:"",n=this.place[2]?this.place[2].id:"";return g.a.getTestData(o,n).then((function(o){var n=t.groupBy(o,"room_id"),r=0,i=0,c=0;t.each(e,(function(e){t.each(e.children,(function(t){if(n[t.id]){var e=n[t.id][0];t.status=e.status,t.testId=e.id}else t.status="",t.testId="";"已放水待验收"===t.status&&(r+=1),"合格"===t.status&&(i+=1),"不合格"===t.status&&(c+=1)}))})),a.floorList=e,a.total=[{status:"已放水待验收",total:r,color:"orange"},{status:"不合格",total:c,color:"red"},{status:"合格",total:i,color:"green"}]})).catch((function(t){console.error(t)}))},gotoDetail:function(t){if(!t.id)return l.a.alert("id为空");this.$router.push({name:"WaterPercolationDetail",query:{roomId:t.id,testId:t.testId||""}})}}}}).call(this,a("391c"))},e2a8:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .status-total-bar[data-v-be07cd9c]{display:flex;flex-direction:row;text-align:center}.zjapp .total-item[data-v-be07cd9c]{flex:1;line-height:20px;padding:10px 5px 0;color:#111;font-size:12px}.zjapp .total-status[data-v-be07cd9c]{white-space:nowrap}.zjapp .total-status[data-v-be07cd9c]:before{content:"";width:10px;height:10px;display:inline-block;vertical-align:top;margin:5px 5px 0 0;background-color:#ddd;border-radius:50%}.zjapp .total-status-orange[data-v-be07cd9c]:before{background-color:#fc8b01}.zjapp .total-status-orange2[data-v-be07cd9c]:before{background-color:#ff8e24}.zjapp .total-status-white2[data-v-be07cd9c]:before{background-color:#fff;border:1px solid #dcdcdc}.zjapp .total-status-red[data-v-be07cd9c]:before{background-color:#ff3d3d}.zjapp .total-status-green[data-v-be07cd9c]:before{background-color:#0bc666}.zjapp .total-status-white[data-v-be07cd9c]:before{background-color:#fff}.zjapp .total-status-white-border[data-v-be07cd9c]:before{background-color:#fff;border:1px solid #dcdcdc}.zjapp .total-status-blue[data-v-be07cd9c]:before{background-color:#4174e9}.zjapp .total-status-purple-border[data-v-be07cd9c]:before{background-color:#fff;border:1px solid #796bfb}.zjapp .total-status-green-border[data-v-be07cd9c]:before{background-color:#fff;border:1px solid #0bc666}.zjapp .status-total-bar.-abs-top-right[data-v-be07cd9c]{position:absolute;top:0;right:13px}.zjapp .status-total-bar.-abs-top-right .total-item[data-v-be07cd9c]{padding-left:3px;padding-right:3px}.zjapp .status-total-bar.-abs-top-right .total-status[data-v-be07cd9c]:before{margin-right:2px}',""])},e89f:function(t,e,a){"use strict";var o=a("04f3"),n=a("cf09"),r=a("4360"),i=0;e.a={name:"PopupMixin",data:function(){return{backButtonEvent:null}},watch:{show:function(t){var e=this;if(t){if(this.$nextTick((function(){e.$el&&e.$el.style&&(e.$el.style.zIndex=++n.a.zIndex,i++,r.a.commit("app/SET_HAS_POPUP",!!i))})),!this.backButtonEvent){var a=this.close||this.closePopup;this.backButtonEvent=Object(o.a)(a)}}else--i<0&&(i=0),r.a.commit("app/SET_HAS_POPUP",!!i),this.backButtonEvent&&(Object(o.c)(this.backButtonEvent),this.backButtonEvent=null)}},methods:{}}},f546:function(t,e,a){"use strict";var o={name:"StatusTotalBar",props:{data:{type:Array,default:function(){return[]}},status:{type:String,default:"default"}},data:function(){return{}}},n=(a("f6de"),a("17cc")),r=Object(n.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"status-total-bar"},t._l(t.data,(function(e,o){return a("div",{key:o,staticClass:"total-item"},["default"===t.status?[a("p",[a("span",{staticClass:"total-status",class:"total-status-"+e.color},[t._v("\n          "+t._s(e.status)+"\n        ")])]),a("p",[t._v("\n        "+t._s(e.total)+"\n      ")])]:t._e(),"laser-scanning"===t.status?[a("p",[a("span",{staticClass:"total-status",class:"total-status-"+e.color},[t._v("\n          "+t._s(e.status)+"\n        ")]),t._v("\n        ("+t._s(e.total)+")\n      ")])]:t._e()],2)})))}),[],!1,null,"be07cd9c",null);e.a=r.exports},f6de:function(t,e,a){"use strict";a("5b85")},f7ab:function(t,e,a){"use strict";var o=a("65e9").a,n=(a("f7d4"),a("17cc")),r=Object(n.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.show?a("div",{ref:"synchronize-tip-bar",staticClass:"synchronize-tip-bar"},[a("icon",{attrs:{name:"caution"}}),t.waitUploadNum?a("span",[t._v("您有"+t._s(t.waitUploadNum)+"条数据待上传")]):t._e(),!t.waitUploadNum&&t.hasChanged?a("span",[t._v("有新数据")]):t._e(),t._v("\n  ，下拉可"+t._s(t.waitUploadNum?"上传":"刷新")+"\n")],1):t._e()}),[],!1,null,"66826030",null);e.a=r.exports},f7d4:function(t,e,a){"use strict";a("2d6e")}}]);