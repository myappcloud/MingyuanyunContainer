(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-1056d57a","chunk-2d0d2f53"],{"03d5":function(e,t,i){var a=i("88ec");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("b2e0bb38",a,!0,{sourceMap:!1,shadowMode:!1})},1304:function(e,t,i){"use strict";var a=i("c5a7");t.__esModule=!0,t.SlotsMixin=void 0;var r=a(i("329b")).default.extend({methods:{slots:function(e,t){void 0===e&&(e="default");var i=this.$slots,a=this.$scopedSlots[e];return a?a(t):i[e]}}});t.SlotsMixin=r},"19a9":function(e,t,i){"use strict";i("7d4e")},2064:function(e,t,i){"use strict";t.__esModule=!0,t.addUnit=function(e){if(!(0,a.isDef)(e))return;return e=String(e),(0,r.isNumber)(e)?e+"px":e};var a=i("b7b4"),r=i("f24f")},2567:function(e,t,i){"use strict";(function(e){i("f548"),i("cc57");var a=i("fd50"),r=i("f369"),n=i("774b"),o=i("fa4f"),c=i("3bd5"),s=i("3516"),d=i("6144"),u=i("bc69"),l=i("5b5e"),p=i("3122"),f=i("48f4"),h=i("07d2"),b=i("6bf2"),g=i.n(b),m=i("a500"),_=i("f7ab"),y=i("6f9e"),v=i("e2a7"),k=i("6718"),x=i("a18c"),w=i("8d95"),j=i("9416");t.a={name:"CheckIndex",components:{CheckGuide:r.a,Scroller:n.default,ItemList:o.a,Item:h.default,SynchronizeTipBar:_.a,SwipeTabs:k.b,SwipeTab:k.a},data:function(){return{title:Object(j.a)(w.a.CHECK)||"现场检查",isLoadingBatch:!0,defaultBatch:{},hasNewBatchRights:!1,tabIndex:0,draftLimit:10,draftData:[],isDraftLoading:!1,submittedLimit:10,submittedData:[],isSubmitLoading:!1}},computed:{tabsWidth:function(){return window.innerWidth/2},draftDataShow:function(){return this.draftData&&this.draftData.length?this.draftData.slice(0,this.draftLimit):[]},submittedDataShow:function(){return this.submittedData&&this.submittedData.length?this.submittedData.slice(0,this.submittedLimit):[]},batchText:function(){return this.isLoadingBatch?"正在加载检批次...":this.defaultBatch&&this.defaultBatch.id?this.defaultBatch.is_closed?"上次使用的批次已关闭":this.defaultBatch.name:this.hasNewBatchRights?"请新建一个检查批次":"暂无与你相关的检查批次"},batchTips:function(){return this.isLoadingBatch?"":this.defaultBatch&&this.defaultBatch.id&&!this.defaultBatch.is_closed?"切换批次":""},batchArrow:function(){return!this.isLoadingBatch&&(!(!this.defaultBatch||!this.defaultBatch.id)||this.hasNewBatchRights)}},created:function(){Object(y.e)(this.init)},activated:function(){var e=d.a.getString("check-index-tab-index");e&&(this.tabIndex=parseInt(e),d.a.remove("check-index-tab-index")),this.init()},methods:{backEvent:function(){window.__YL_SUPER_APP__?x.a.back():this.$router.replace("/layout/workbench",!0)},onRefresh:function(e){this.init().then((function(){"function"==typeof e&&e(!1)}))},beforeCheckGuideOpen:function(){if(!this.defaultBatch||!this.defaultBatch.id)return v.a.alert("请先选择批次"),!1},batchClick:function(){this.isLoadingBatch||(this.defaultBatch&&this.defaultBatch.id?(m.a.addTrack("现场检查-首页-进入批次列表"),this.$router.push("/checkBatchList")):this.hasNewBatchRights&&this.$router.push("/checkBatchAdd"))},problemAdd:function(e){this.defaultBatch.id&&!this.defaultBatch.is_closed?this.$router.push({name:"CheckEdit"}):v.a.alert("请先选择检查批次")},problemEdit:function(e){this.$router.push({name:"CheckEdit",params:{id:e.id}})},problemDetail:function(e){this.$router.push({name:"CheckDetail",params:{id:e.id}})},init:function(){var e=this;return this.getDetaulBatch().then((function(){return e.getDraftData()})).then((function(){return e.getSubmittedData()}))},getDetaulBatch:function(){var e=this,t=c.a.getUser(),i=d.a.getObject(u.a.HOME_PAGE_DEFAULT_PROJECT,d.a.level.user)||{};return this.isLoadingBatch=!0,s.a.checkUserBatchRights(t.user_id).then((function(t){e.hasNewBatchRights=!!t})).then((function(){return s.a.getDefaultBatch("安全文明",i.id).then((function(t){t?e.defaultBatch=t:(e.defaultBatch={},e.draftData=[],e.submittedData=[])}))})).finally((function(){e.isLoadingBatch=!1}))},getDraftData:function(){var t=this;return this.isDraftLoading=!0,this.defaultBatch.is_closed?(this.draftData=[],this.isDraftLoading=!1,a.a.when()):l.a.getCheckProblemDraftList(this.defaultBatch.id).then((function(i){e.each(i,(function(e){e.thumbnail=p.a.getDefaultThumbnailFromList(e.image_file,"安全文明"),e.regist_date=g()(e.created_on).format("MM-DD HH:mm")})),t.draftData=i,t.isDraftLoading=!1}))},getSubmittedData:function(){var t=this;return this.isSubmitLoading=!0,this.defaultBatch.is_closed?(this.submittedData=[],this.isSubmitLoading=!1,a.a.when()):l.a.getCheckProblemList(this.defaultBatch.id).then((function(i){var a=e.filter(i.data,(function(e){var t=JSON.parse(e.image_file||"[]");return e.thumbnail=p.a.getDefaultThumbnailFromList(t,"安全文明"),e.regist_date=g()(e.regist_date).format("MM-DD HH:mm"),p.a.isNeedThumbnail(t)}));f.default.autoLoadThumbnail(a,"安全文明","image_file","thumbnail","checkquality_problem"),t.submittedData=i.data,t.isSubmitLoading=!1}))},pageDraft:function(){this.draftLimit=this.draftLimit+10},pageSubmit:function(){this.submittedLimit=this.submittedLimit+10}}}}).call(this,i("391c"))},"27c4":function(e,t,i){var a=i("db6b2");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("42e360af",a,!0,{sourceMap:!1,shadowMode:!1})},"2d6e":function(e,t,i){var a=i("7eb2");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("53a2fbaa",a,!0,{sourceMap:!1,shadowMode:!1})},3050:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;t.default={name:"姓名",tel:"电话",save:"保存",confirm:"确认",cancel:"取消",delete:"删除",complete:"完成",loading:"加载中...",telEmpty:"请填写电话",nameEmpty:"请填写姓名",confirmDelete:"确定要删除么",telInvalid:"请填写正确的电话",vanContactCard:{addText:"添加联系人"},vanContactList:{addText:"新建联系人"},vanPagination:{prev:"上一页",next:"下一页"},vanPullRefresh:{pulling:"下拉即可刷新...",loosing:"释放即可刷新..."},vanSubmitBar:{label:"合计："},vanCoupon:{valid:"有效期",unlimited:"无使用门槛",discount:function(e){return e+"折"},condition:function(e){return"满"+e+"元可用"}},vanCouponCell:{title:"优惠券",tips:"使用优惠",count:function(e){return e+"张可用"}},vanCouponList:{empty:"暂无优惠券",exchange:"兑换",close:"不使用优惠",enable:"可使用优惠券",disabled:"不可使用优惠券",placeholder:"请输入优惠码"},vanAddressEdit:{area:"地区",postal:"邮政编码",areaEmpty:"请选择地区",addressEmpty:"请填写详细地址",postalEmpty:"邮政编码格式不正确",defaultAddress:"设为默认收货地址",telPlaceholder:"收货人手机号",namePlaceholder:"收货人姓名",areaPlaceholder:"选择省 / 市 / 区"},vanAddressEditDetail:{label:"详细地址",placeholder:"街道门牌、楼层房间号等信息"},vanAddressList:{add:"新增地址"}}},4412:function(e,t,i){"use strict";t.__esModule=!0,t.createBEM=function(e){return function(t,i){return t&&"string"!=typeof t&&(i=t,t=""),t=a(e,t,"__"),i?[t,r(t,i)]:t}};function a(e,t,i){return t?e+i+t:e}function r(e,t){if("string"==typeof t)return a(e,t,"--");if(Array.isArray(t))return t.map((function(t){return r(e,t)}));var i={};return t&&Object.keys(t).forEach((function(a){i[e+"--"+a]=t[a]})),i}},"4aef":function(e,t,i){"use strict";var a=i("dd16").a,r=i("17cc"),n=Object(r.a)(a,(function(){var e=this.$createElement;return(this._self._c||e)("span",{class:this.classSet[this.status]},[this._v(this._s(this.text||this.status))])}),[],!1,null,null,null);t.a=n.exports},"4d1b":function(e,t,i){"use strict";var a=i("c5a7");t.__esModule=!0,t.default=void 0;var r=a(i("329b")),n=i("53a5"),o=a(i("3050")),c=r.default.prototype,s=r.default.util.defineReactive;s(c,"$vantLang","zh-CN"),s(c,"$vantMessages",{"zh-CN":o.default});var d={messages:function(){return c.$vantMessages[c.$vantLang]},use:function(e,t){var i;c.$vantLang=e,this.add(((i={})[e]=t,i))},add:function(e){void 0===e&&(e={}),(0,n.deepAssign)(c.$vantMessages,e)}};t.default=d},"53a5":function(e,t,i){"use strict";t.__esModule=!0,t.deepAssign=n;var a=i("b7b4"),r=Object.prototype.hasOwnProperty;function n(e,t){return Object.keys(t).forEach((function(i){!function(e,t,i){var o=t[i];(0,a.isDef)(o)&&(r.call(e,i)&&(0,a.isObj)(o)&&"function"!=typeof o?e[i]=n(Object(e[i]),t[i]):e[i]=o)}(e,t,i)})),e}},"5b5e":function(e,t,i){"use strict";(function(e){i("9e76"),i("163d"),i("e697");var a,r=i("fd50"),n=i("3bd5"),o=i("ed08"),c=i("4ad6"),s=i("3122"),d=i("3516"),u=i("37d5"),l=i("f2d3"),f=i("48f4"),h=i("6bf2"),b=i.n(h),g=i("4360"),m=i("4921"),_=i("334f"),y=i("b725"),v=i("6b81"),k=i("2f02"),x=i("7364"),w=i("59f8"),j=i("c745"),S=i("0136"),C=function(t,i){var a=n.a.getUser();return _.a.getProblemCCAllColumn(t).then((function(r){if(e.some(r,(function(e){return e.cc===a.user_id&&e.type===i})))return _.a.updateProblemReadingTime(t);var n={id:a.user_id,name:a.user_name,type:i,reading_time:o.a.getNowDate()};return _.a.appendCC(t,n).then((function(){return _.a.updateProblemReadingTime(t)}))}))},D=function(e){var t=e.status;return"已关闭"===e.status&&(t="非正常关闭"),r.a.resolve({status_text:t})};a={getCheckProblemDraftList:function(e){return m.a.getCheckProblemDraftList(e).catch((function(e){return $log.error(e),r.a.reject(e)}))},getCheckProblemList:function(t){var i=n.a.getUser().user_id;return m.a.getCheckProblemList(t,i).then((function(n){return e.map(n,(function(e){a.getProblemLocalStatus({status:e.status}).then((function(t){e.status_text=t.status_text}))})),m.a.getCheckProblemCount(t,i).then((function(e){return r.a.resolve({data:n,total:e.count})}))})).catch((function(e){return $log.error(e),r.a.reject(e)}))},getCheckProblemInfo:function(t){return t?r.a.all([m.a.getCheckProblem(t),y.a.getRepair(t),v.a.getMutliReinspect(t),_.a.getCC(t),_.a.getProblemCCAllColumn(t),v.a.getReinspectByList(t)]).then((function(t){var i=t[0],a=t[5],n=t[1];n&&(i.repair_set=n,i.has_read=n.has_read);var o=t[2];e.isEmpty(o)?i.reinspect_set=[]:i.reinspect_set=o;var c=t[3];c&&c.length>0&&(i.cc_set_id_array=e.map(c,(function(e){return{id:e.user_id}})),i.cc_set_name_array=e.map(c,(function(e){return{name:e.user_name}})),i.cc_set_array=e.map(c,(function(e){return{id:e.user_id,name:e.user_name,mobile:e.mobile,is_im_user:e.is_im_user}})));var s=t[4];return s&&s.length>0&&(i.cc_set_all_id_array=e.map(s,(function(e){return{id:e.cc}}))),i.regist_by||i.sent_back_by||i.repair_by||i.reinspect_by?u.default.getAllProjectUsers(i.proj_id).then((function(t){if(i.regist_by){var r=e.find(t,(function(e){return e.user_id===i.regist_by}));r&&(i.regist=r)}if(i.sent_back_by){var n=e.find(t,(function(e){return e.user_id===i.sent_back_by}));n&&(i.sent_back={id:n.user_id,name:n.user_name,mobile:n.mobile,is_im_user:n.is_im_user})}if(i.repair_by){var o=e.find(t,(function(e){return e.user_id===i.repair_by}));o&&(i.repair=o)}return e.isEmpty(a)||(i.reinspectBy=e.map(a,(function(i){var a=e.find(t,(function(e){return e.user_id===i.reinspect}));return a?{id:a.user_id,name:a.user_name,mobile:a.mobile,is_im_user:a.is_im_user,reinspect_date:i.reinspect_date,reinspect_remark:i.reinspect_remark,reinspect_image_file:JSON.parse(i.reinspect_image_file||"[]"),reinspectById:i.id}:{id:i.reinspect,name:"该用户已被删除",mobile:"",is_im_user:null,reinspect_date:i.reinspect_date,reinspect_remark:"",reinspect_image_file:[],reinspectById:i.id}})),i.reinspectBy=e.filter(i.reinspectBy,(function(e){return!!e})),i.reinspect=e.filter(i.reinspectBy,(function(e){return!!e.reinspect_date}))),i.regist=i.regist||{},i.sent_back=i.sent_back||{},i.repair=i.repair||{},i.reinspect=i.reinspect||[],i})):(i.regist={},i.sent_back={},i.repair={},i.reinspect=[],r.a.resolve(i))})).catch((function(e){$log.log(e)})):r.a.resolve({})},submit:function(t,i,a){if(!1===a)return function(e,t){var i=n.a.getUser();return e.repair_deadline="",e.regist_by=i.user_id,e.regist_date=o.a.getNowDate(),e.created_by=i.user_id,e.created_on=o.a.getNowDate(),e.image_file=JSON.stringify(e.image_file),e.drawing_file&&(e.drawing_file=JSON.stringify(e.drawing_file)),$log.log("专项巡检--\x3e不通知整改"),m.a.submit(e).then((function(){return x.a.saveProblemStatusLog(e.proj_id,"",e.batch_id,e.id,"已提交","","",e.image_file)})).then((function(){return C(e.id,"登记人")})).then((function(t){return f.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).then((function(){if("special-inspect-problem"!==t)return S.a.saveTodo({biz_id:e.id,proj_id:e.proj_id,module_code:t||"",type:2})})).catch((function(e){return $log.error(e),r.a.reject(e)}))}(t,i);if("待提交"!==t.status&&"草稿"!==t.status&&"合格草稿"!==t.status&&"不合格草稿"!==t.status)return r.a.reject("问题单状态异常");if(!t.checkItem.id)return r.a.reject("请先选择检查项");if(!t.repair_set||!t.repair_set.id)return r.a.reject("请选择问题的整改人");if(e.isEmpty(t.reinspect_set))return r.a.reject("请选择问题的复验人");var c=n.a.getUser();t.status="待整改";var s=new Date;return s.setDate(s.getDate()+Number(t.deadline)),t.repair_deadline=b()(s).format("YYYY-MM-DD"),"special-inspect-problem"===i&&t.regist_by&&t.regist_date&&t.created_by&&t.created_on||(t.regist_by=c.user_id,t.regist_date=o.a.getNowDate(),t.created_by=c.user_id,t.created_on=o.a.getNowDate()),t.image_file=JSON.stringify(t.image_file),t.drawing_file&&(t.drawing_file=JSON.stringify(t.drawing_file)),$log.log("现场检查--\x3e提交问题"),m.a.submit(t).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已提交","","",t.image_file)})).then((function(){return C(t.id,"登记人")})).then((function(){if("special-inspect-problem"!==i){var e=t.created_by===t.repair_set.id?1:2;return S.a.insertTodoData(t.created_by,t.id,i,e,0)}})).then((function(){return v.a.getReinspectByList(t.id)})).then((function(i){return f.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_repair",t.id],["checkquality_reinspect",t.id],["checkquality_reinspect_by",e.map(i,"id")],["checkquality_cc",t.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},save:function(t){if("待提交"!==t.status&&"草稿"!==t.status&&"合格草稿"!==t.status&&"不合格草稿"!==t.status)return r.a.reject("问题单状态异常。");if(!/^\+?[0-9]*$/.test(t.deadline))return r.a.reject("整改期限必须是正整数");var i={id:t.id,remark:t.remark,image_file:t.image_file,batch_id:t.batch_id,batch_type:t.batch_type,bidsection_id:t.bidsection_id||"",proj_id:t.proj_id,created_by:t.created_by,created_on:o.a.getNowDate(),status:t.status,room_id:t.room_id||"",building_id:t.building_id||"",unit:t.unit||"",floor:t.floor||"",biz_id:t.biz_id||"",biz_children_id:t.biz_children_id||"",deduction:void 0===t.deduction?"":t.deduction,redline_deduction:4===t.mode||8===t.mode?t.redline_deduction:0,contract_id:t.contract&&t.contract.id?t.contract.id:"",voice_file:e.isEmpty(t.voice_file)?null:JSON.stringify(t.voice_file)};return t.repair_requirements&&(i.repair_requirements=t.repair_requirements||""),t.checkItem&&t.checkItem.id&&(i.item_id=t.checkItem.id),t.place&&t.place.full_name&&(i.place=t.place.full_name),t.contractor&&t.contractor.id&&(i.contractor_id=t.contractor.id),t.description&&t.description.id?i.desc_id=t.description.id:i.desc_id="",i.emergency_degree=t.level,t.deadline&&(i.deadline=t.deadline),t.place_point&&(i.problem_values=JSON.stringify(t.place_point)),i.image_file=JSON.stringify(t.image_file),t.drawing_file&&(i.drawing_file=JSON.stringify(t.drawing_file)),(t.process_mode||null===t.process_mode)&&(i.process_mode=t.process_mode),8===t.mode&&(i.deduction_level=t.deduction_level),t.id?m.a.update(i,t.cc_set,t.repair_set,t.reinspect_set).then((function(){return r.a.resolve(t.id)})).catch((function(e){return $log.error(e),r.a.reject(e)})):(i.id=o.a.uuid(),m.a.insert(i).then((function(){return m.a.update(i,t.cc_set,t.repair_set,t.reinspect_set)})).then((function(){return r.a.resolve(i.id)})).catch((function(e){return $log.error(e),r.a.reject(e)})))},delete:function(e){return m.a.getCheckProblem(e).then((function(t){return"待提交"===t.status||"草稿"===t.status||"合格草稿"===t.status||"不合格草稿"===t.status?m.a.delete(e).catch((function(e){return $log.error(e),r.a.reject(e)})):($log.log("问题单状态异常："+e),r.a.reject("问题单状态异常"))}))},repair:function(t,i){if("待整改"!==t.status)return r.a.reject("问题单状态异常");var a=n.a.getUser();t.status="待复验",t.repair_by=a.user_id,t.repair_date=o.a.getNowDate();var c=JSON.stringify(t.repair_image_file);return m.a.getCheckProblem(t.id).then((function(a){if(!a||"待整改"===a.status)return $log.log("现场检查--\x3e完成整改"),m.a.repairProblem(t.id,t.status,t.repair_by,t.repair_remark,t.repair_date,c).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已整改","",t.repair_remark,c)})).then((function(){return C(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var a=2;e.filter(t.reinspect_set,{user_id:t.repair_by}).length&&(a=1);var r=S.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return S.a.insertTodoData(t.repair_by,t.id,"check",a,r)}})).then((function(){return f.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_cc",t.id]])}));$log.log("提交整改时数据已变为")})).catch((function(e){return $log.error(e),r.a.reject(e)}))},reinspectPass:function(t,i){if("待复验"!==t.status)return r.a.reject("问题单状态异常");t.currentReinspectBy=t.currentReinspectBy||{};var a=n.a.getUser(),c="",s=e.isEmpty(t.currentReinspectBy.reinspect_image_file)?"":JSON.stringify(t.currentReinspectBy.reinspect_image_file);return m.a.getCheckProblem(t.id).then((function(n){if(!n||"待复验"===n.status)return v.a.reinspectPass(t.id,a.user_id,o.a.now(),s,t.currentReinspectBy.reinspect_remark||"").then((function(){return v.a.getReinspectByList(t.id).then((function(i){var n=e.every(i,(function(e){return!!e.reinspect_date})),s=e.find(i,{reinspect:a.user_id});return s?(c=s.id,n?(t.status="已通过",t.respect_by=a.user_id,t.reinspect_completed_date=o.a.getNowDate(),m.a.reinspectProblemPass(t.id,t.status,t.reinspect_completed_date,t.respect_by).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已复验","","","")}))):void 0):r.a.reject("问题单复验人异常")}))})).then((function(){return C(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var e=S.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return S.a.insertTodoData(a.user_id,t.id,i||"check",2,e)}})).then((function(){return f.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_reinspect_by",c],["checkquality_cc",t.id]])}))})).catch((function(e){return $log.error(e),r.a.reject(e)}))},reinspectReject:function(t,i){var a=[["checkquality_problem",t.id],["checkquality_cc",t.id]];if("待复验"!==t.status)return r.a.reject("问题单状态异常");if(!t.sent_back_remark)return r.a.reject("请填写退回原因");var c=n.a.getUser();t.sent_back_times?t.sent_back_times++:t.sent_back_times=1,t.status="待整改",t.sent_back_date=o.a.getNowDate(),t.sent_back_by=c.user_id;var s=JSON.stringify(t.sent_back_image_file);return $log.log("现场检查--\x3e复验退回"),m.a.reinspectProblemReject(t.id,t.status,t.sent_back_date,t.sent_back_remark,s,t.sent_back_by,t.sent_back_times).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已退回",t.sent_back_remark,"",s)})).then((function(){return v.a.clearReinspectByData(t.id)})).then((function(){return C(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var e=2;t.repair_set.id&&t.repair_set.id===c.user_id&&(e=1);var a=S.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return S.a.insertTodoData(c.user_id,t.id,"check",e,a)}})).then((function(){return v.a.getReinspectByList(t.id).then((function(t){a.push(["checkquality_reinspect_by",e.map(t,"id")])}))})).then((function(){if(1===t.has_read)return y.a.update({has_read:0},{checkquality_problem_id:t.id}).then((function(){a.push(["checkquality_repair",t.id])}))})).then((function(){return f.default.addSyncGroup(a)})).catch((function(e){return $log.error(e),r.a.reject(e)}))},close:function(e,t){if("待整改"!==e.status)return r.a.reject("问题单状态异常");if(!e.close_reason)return r.a.reject("请填写关闭原因");var i=n.a.getUser();return e.close_date=o.a.getNowDate(),e.status="已关闭",$log.log("现场检查--\x3e非正常关闭"),m.a.closeProblem(e.id,e.status,e.close_date,e.close_reason).then((function(){return x.a.saveProblemStatusLog(e.proj_id,e.bidsection_id,e.batch_id,e.id,"已关闭",e.close_reason,"","")})).then((function(){return C(e.id,"操作人")})).then((function(){if("special-inspect-problem"!==t){var a=S.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"check");return S.a.insertTodoData(i.user_id,e.id,"check",2,a)}})).then((function(){return f.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},changeRepair:function(e,t,i){if(!e.repair_set||!e.repair_set.id)return r.a.reject("请指定一个整改人");var a=n.a.getUser();return $log.log("现场检查--\x3e修改整改人"),m.a.updateProblemModifiedBy(e.id).then((function(){if(t)return m.a.updateProblemContractor(e.id,e.contractor.id)})).then((function(){if(t){var i=e.contractor&&e.contractor.id||"";return m.a.updateProblemContractor(e.id,i)}})).then((function(){return y.a.changeProblemRepairer(e)})).then((function(){return k.a.saveProblemFpInfo(e.proj_id,e.bidsection_id,e.batch_id,e.id,e.repair_set.id,e.repair_set_old.id,"分配整改人")})).then((function(){return C(e.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var t=2;e.repair_set.id&&e.repair_set.id===a.user_id&&(t=1);var r=S.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"check");return S.a.insertTodoData(a.user_id,e.id,"check",t,r)}})).then((function(){return f.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_repair",e.id],["checkquality_cc",e.id],["checkquality_problem_fpinfo",e.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},changeReinspect:function(t,i){if(e.isEmpty(t.reinspect_set))return r.a.reject("请指定一个复验人");var a=n.a.getUser();return $log.log("现场检查--\x3e修改复验人"),m.a.updateProblemModifiedBy(t.id).then((function(){return v.a.changeProblemReinspect(t.id,t.reinspect_set,!0)})).then((function(){var i=e.map(t.reinspect_set,(function(e){return e.id})).join(","),a=e.map(t.reinspect_set_old,(function(e){return e.id})).join(",");return k.a.saveProblemFpInfo(t.proj_id,t.bidsection_id,t.batch_id,t.id,i,a,"分配复验人")})).then((function(){return C(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var r=2;e.filter(t.reinspect_set,{user_id:a.user_id}).length&&"待复验"===t.status&&(r=1);var n=S.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return S.a.insertTodoData(a.user_id,t.id,"check",r,n)}})).then((function(){return v.a.getReinspectByList(t.id)})).then((function(i){return f.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_reinspect",t.id],["checkquality_reinspect_by",e.map(i,"id")],["checkquality_cc",t.id],["checkquality_problem_fpinfo",t.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},changeCC:function(e){return $log.log("现场检查--\x3e修改抄送人"),m.a.updateProblemModifiedBy(e.id).then((function(){return _.a.saveProblemCC(e.id,e.cc_set)})).then((function(){return f.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},changeContractor:function(e){return e.contractor&&e.contractor.id?($log.log("现场检查--\x3e修改责任单位"),m.a.updateProblemContractor(e.id,e.contractor.id).then((function(){return f.default.addSyncGroup([["checkquality_problem",e.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))):r.a.reject("请指定责任单位")},changeRepairDeadline:function(e){if(!/^(\d+)-(\d{1,2})-(\d{1,2})$/.test(e.repair_deadline))return r.a.reject("整改期限需要一个日期格式的值");var t=b()(e.repair_deadline).format("YYYY-MM-DD"),i=b()().format("YYYY-MM-DD");return e.is_timeout=t<i,$log.log("现场检查--\x3e修改整改期限"),m.a.updateProblemRepairDeadline(e.id,e.repair_deadline).then((function(){return f.default.addSyncGroup([["checkquality_problem",e.id]])})).catch((function(e){return $log.error(e),r.a.reject(e)}))},getProblemLocalStatusById:function(e){return D({status:p.status})},getProblemLocalStatus:D,saveRepairInfo:function(e,t,i){return i=JSON.stringify(i),m.a.saveRepairInfo(e,t,i).then((function(){return m.a.getCheckProblemDraft(e).then((function(t){return l.a.backUpDraft(e,t.proj_id,"checkquality_problem",t)}))}))},problemRead:function(e){return y.a.update({has_read:1},{checkquality_problem_id:e}).then((function(){return f.default.addSyncGroup([["checkquality_problem",e],["checkquality_repair",e]])}))},takePictureAndSave:function(e){return s.a.takePicture().then((function(t){if(t)return d.a.getBatch(e).then((function(e){var i={proj_id:e.proj_id,bidsection_id:e.bidsection_id,batch_id:e.id,deadline:e.repair_deadline,batch_type:e.batch_type,created_by:n.a.getUser().user_id,created_on:o.a.now(),image_file:[t],status:"待提交"};return a.save(i)}))})).catch((function(e){return $log.error(e),r.a.reject(e)}))},saveByPicture:function(e,t){return e?d.a.getBatch(t).then((function(t){var i={proj_id:t.proj_id,bidsection_id:t.bidsection_id,batch_id:t.id,deadline:t.repair_deadline,batch_type:t.batch_type,created_by:n.a.getUser().user_id,created_on:o.a.now(),image_file:[{temp:e}],status:"待提交"};return a.save(i)})).catch((function(e){return $log.error(e),r.a.reject(e)})):r.a.when()},createProblem:function(e,t){return d.a.getBatch(t).then((function(t){var i={proj_id:t.proj_id,bidsection_id:t.bidsection_id,batch_id:t.id,deadline:t.repair_deadline,batch_type:t.batch_type,created_by:n.a.getUser().user_id,created_on:o.a.now(),image_file:[{temp:e}],status:"待提交"};return a.save(i)}))},takePicture:function(){return s.a.takePicture()},allowSelectPicture:function(){return w.a.getValue("upload_from_phone_albums").then((function(e){return"1"===e}))},reinspectByConflict:function(t){return e.isEmpty(t.reinspectBy)?r.a.when():v.a.removeProblemReinspectBy(t.reinspectBy[0].checkquality_problem_id).then((function(){return v.a.insertReinspectByList(t.reinspectBy)})).then((function(){return TodoRepository.removeProblemTodo(t.reinspectBy[0].checkquality_problem_id)})).then((function(){return TodoRepository.insertTodoList(t.todo)}))},copyProblem:function(t){return r.a.all([m.a.getProblemAllColumn(t),y.a.getRepairAllColumn(t),v.a.getReinspectAllColumn(t),v.a.getReinspectByList(t),_.a.getProblemCCAllColumn(t)]).then((function(t){var i=t[0],a=t[1],c=t[2],s=t[3],d=t[4];if(i.id=o.a.uuid(),i.status="待提交",i.regist_by="",i.repair_by="",i.repair_remark="",i.repair_date="",i.repair_image_file="",i.sent_back_by="",i.sent_back_date="",i.sent_back_times=0,i.sent_back_remark="",i.sent_back_image_file="",i.reinspect_by="",i.reinspect_completed_date="",i.close_date="",i.close_reason="",i.created_by=n.a.getUser().user_id,i.created_on=o.a.now(),i.modified_by=n.a.getUser().user_id,i.download_time="",i.update_timestamp="",i.repair_deadline&&!i.deadline&&i.regist_date){for(var u=i.repair_deadline.match(/\d+/g),l=0;l<u.length;l++)u[l]=parseInt(u[l]);for(var p=new Date(u[0],u[1]-1,u[2],u[3]||0,u[4]||0,u[5]||0),f=i.regist_date.match(/\d+/g),h=0;h<f.length;h++)f[h]=parseInt(f[h]);var b=new Date(f[0],f[1]-1,f[2],f[3]||0,f[4]||0,f[5]||0);i.deadline=Math.ceil((p.getTime()-b.getTime())/864e5)}i.regist_date="",i.repair_deadline="",e.each(a,(function(e){e.id=o.a.uuid(),e.checkquality_problem_id=i.id,e.download_time=""})),e.each(c,(function(e){e.id=o.a.uuid(),e.checkquality_problem_id=i.id,e.download_time=""})),e.each(s,(function(e){e.id=o.a.uuid(),e.checkquality_problem_id=i.id,e.reinspect_date="",a.reinspect_remark="",a.reinspect_image_file="",e.download_time=""}));var g=e.filter(d,(function(e){return"默认"===e.type}));return g=e.map(g,(function(e){return{id:e.cc}})),d=e.filter(d,(function(e){return"被抄送"===e.type})),d=e.map(d,(function(e){return{id:e.cc}})),r.a.all([m.a.insert(i),y.a.insert(a),v.a.insertReinspect(c),v.a.insertReinspectByList(s),_.a.saveProblemCC(i.id,d),_.a.saveDefaultCc(i.id,g)])}))},removeLocalInvalidProblem:function(t){var i=r.a.when();return t.problem_repair&&(i=i.then((function(){return y.a.removeInvalidData(t.problem.id,e.map(t.problem_repair,"id"))}))),t.problem_reinspect&&(i=i.then((function(){return v.a.removeInvalidData(t.problem.id,e.map(t.problem_reinspect,"id"))}))),t.problem_cc&&(i=i.then((function(){return _.a.removeInvalidData(t.problem.id,e.map(t.problem_cc,"id"))}))),t.children_Problem&&(i=i.then((function(){return m.a.removeInvalidChildProblem(t.problem.id,t.children_Problem)}))),i},removeLocalInvalidProblem1:function(t,i){var a=i.checkquality_problem;return r.a.when().then((function(){if(i.checkquality_problem)return m.a.deleteProblemById(a.id)})).then((function(){if(i.checkquality_repair)return y.a.removeInvalidData(a.id,e.map(i.checkquality_repair,"id"))})).then((function(){if(i.checkquality_cc)return _.a.removeInvalidData(a.id,e.map(i.checkquality_cc,"id"))}))},removeClosedBatchProblem:function(){return d.a.getClosedBatchIdList().then((function(e){return a.deleteBatchProblems(e)}))},deleteBatchProblems:function(t){return $log.log("删除已关闭批次的问题"),m.a.getProblemsByBatch(t).then((function(t){var i=r.a.when(),a=["image_file","repair_image_file","sent_back_image_file"],n=[];return e.each(t,(function(t){for(var i=0;i<a.length;++i){var r=t[a[i]]=JSON.parse(t[a[i]]||"[]");e.each(r,(function(e){e.local&&n.push(e.local),e.thumbnail&&n.push(e.thumbnail),e.temp&&n.push(e.temp)}))}})),e.each(n,(function(e){i=i.then((function(){return c.a.isFileExists(e)})).then((function(t){if(t)return c.a.deleteFile(e)}))})),i})).then((function(){return m.a.deleteProblemByBatch(t)}))},getLeaderComments:function(t){return m.a.getLeaderComments(t).then((function(t){return e.each(t,(function(e){e.user={id:e.user_id,name:e.user_name,mobile:e.mobile,is_im_user:e.is_im_user},e.image_file&&(e.image_file=JSON.parse(e.image_file))})),t}))},getPhotoRequired:function(e,t){var i=g.a.state.global.allGrayRelease.UsingProjectParameter;return j.a.getProjParameter(e,"is_photo_required",t).then((function(e){return i&&e&&e.length?Number(e[0].value):g.a.state.global.isPhotoRequired[t]})).catch((function(e){console.log("error",e)}))}},t.a=a}).call(this,i("391c"))},6147:function(e,t,i){"use strict";t.__esModule=!0,t.createNamespace=function(e){return e="van-"+e,[(0,r.createComponent)(e),(0,a.createBEM)(e),(0,n.createI18N)(e)]};var a=i("4412"),r=i("7e06"),n=i("65af")},"65af":function(e,t,i){"use strict";var a=i("c5a7");t.__esModule=!0,t.createI18N=function(e){var t=(0,n.camelize)(e)+".";return function(e){for(var i=(0,r.get)(o.default.messages(),t+e)||(0,r.get)(o.default.messages(),e),a=arguments.length,n=new Array(a>1?a-1:0),c=1;c<a;c++)n[c-1]=arguments[c];return"function"==typeof i?i.apply(void 0,n):i}};var r=i("b7b4"),n=i("a1aa"),o=a(i("4d1b"))},"65e9":function(e,t,i){"use strict";(function(e){i("5ab2"),i("6d57"),i("e10e");var a=i("28f8"),r=i("4360"),n=i("48f4"),o=i("162a"),c=i("f2d3"),s=i("6906"),d=i("a18c"),u=i("c745");function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){Object(a.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.a={name:"SynchronizeTipBar",props:{isTodo:{type:Boolean},useDownload:{type:Boolean,default:!0},enterDoCheck:{type:Boolean,default:!0},buildingId:{type:String,default:""},automaticUpdateCallback:{type:Function,default:null}},data:function(){return{currentModuleCode:"",oneUpdateData:!0}},computed:{projId:function(){return r.a.state.global.currentProject.id},waitUploadNum:function(){return r.a.state.global.waitUploadNum},hasTopProgress:function(){return r.a.state.global.hasTopProgress},hasChanged:function(){if(!this.useDownload)return!1;if(this.currentModuleCode){var e,t=n.default.isModuleNeedBuilding(this.currentModuleCode)&&!this.isTodo;return!(t&&!this.buildingId)&&(e=this.isTodo?r.a.state.global.todoChangedStatus||{}:r.a.state.global.businessChangedStatus||{},t?!!e[this.currentModuleCode]&&e[this.currentModuleCode][this.buildingId]:e[this.currentModuleCode])}return!1},show:function(){return(this.hasChanged||this.waitUploadNum)&&!this.hasTopProgress},oneDataSync:function(){return this.$store.state.app.oneDataSync}},watch:{hasChanged:function(e){var t=this;e&&this.$nextTick((function(){setTimeout((function(){var e=t.$refs["synchronize-tip-bar"];if(e&&e.style){e.style.display="none";e.offsetHeight;e.style.display="block"}}),100)}))},buildingId:function(e){this.currentModuleCode&&n.default.isModuleNeedBuilding(this.currentModuleCode)&&e&&(console.log("楼栋重新加载，是否再次自动加载数据：",this.oneUpdateData),this.oneUpdateData&&this.automaticLogic(),this.checkSync())},show:function(e){e?this.$emit("show"):this.$emit("hide")}},activated:function(){this.init()},methods:{init:function(){this.getCurrentModuleCode(),this.enterDoCheck&&!d.a.isBack&&this.checkSync(),this.automaticLogic()},automaticLogic:function(){var e=this;this.$router.isBack||(this.oneUpdateData=!0,u.a.getAutomaticLoadData().then((function(t){$log.log("是否要自动加载 ===> ",t&&e.oneDataSync&&"function"==typeof e.automaticUpdateCallback),t&&e.oneDataSync&&"function"==typeof e.automaticUpdateCallback&&e.dataSync().then((function(t){console.log("是否需要初始化页面 ====> ",Boolean(t)),t&&e.automaticUpdateCallback()}))})))},getCurrentModuleCode:function(){var e=n.default.getCurrentModuleCode(),t=this.isTodo?"todo":"";this.currentModuleCode=e||t},checkSync:function(){var t=this,i="checkDataUpdate",a=this.currentModuleCode,o=this.buildingId,d=r.a.state.global.isLeader?this.projId:"";return!n.default.isModuleNeedBuilding(a)||o||this.isTodo?(this.isTodo&&(i+="_todo"),a&&(i+="_".concat(a)),o&&(i+="_".concat(o)),s.a.execAfterInterval(120,i).then((function(){return t.isTodo?"todo"===a?c.a.getModuleList().then((function(t){var i=e.map(t,"code");return n.default.hasTodoChangedData("",i)})):n.default.hasTodoChangedData("",[a]):n.default.hasBusinessChangedData(d,[a],o)})).then((function(e){if(t.isTodo){var i=p({},r.a.state.global.todoChangedStatus);i[a]=e,r.a.commit("global/SET_TODO_CHANGED_STATUS",i)}else{var n=p({},r.a.state.global.businessChangedStatus);if(o){var c=n[a]?n[a]:{};c[o]=e,n[a]=c}else n[a]=e;r.a.commit("global/SET_BUSINESS_CHANGED_STATUS",n)}})).catch((function(e){return e&&!0===e.timeNotTo?($log.debug(e.msg),!1):$q.reject(e)}))):Promise.resolve()},dataSync:function(){var e=this.currentModuleCode,t=this.buildingId,i=n.default.isModuleNeedBuilding(e),a=i&&!t;return $log.log(["模块名：",e," 楼栋id：",t," 当前模块是否需要楼栋id：",i," 判断是否终止自动更新：",a]),a?Promise.resolve():(this.oneUpdateData=!1,o.a.beginManualUpdate(),n.default.checkSync(t).then((function(e){return o.a.endManualUpdate(),e})).catch((function(e){$log.error("自动更新错误",e),o.a.endManualUpdate()})))}}}}).call(this,i("391c"))},6718:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i("163d"),i("cc57");var a=i("b7b4"),r={name:"SwipeTab",props:{title:{type:String}},data:function(){return{offset:0,style:{},bem:Object(a.createNamespace)("swipe-item")[1](),parent:{}}},computed:{index:function(){return this.parent.tabs.indexOf(this)}},beforeCreate:function(){this.$parent.swipes.push(this)},created:function(){this.findParent("SwipeTabs")},destroyed:function(){this.$parent.swipes.splice(this.$parent.swipes.indexOf(this),1)},mounted:function(){var e=this,t=this.parent.tabs,i=this.parent.$slots.default.indexOf(this.$vnode);t.splice(-1===i?t.length:i,0,this),this.$nextTick((function(){var t=e.$parent,i=t.vertical,a=t.computedWidth,r=t.computedHeight;e.style={width:a+"px",height:i?a+"px":r+"px",transform:"translate".concat(i?"Y":"X","(").concat(e.offset,"px)")}}))},methods:{findParent:function(e){for(var t=this.$parent;t;){if(t.$options.name===e){this.parent=t;break}t=t.$parent}}}},n=i("17cc"),o=Object(n.a)(r,(function(){var e=this.$createElement;return(this._self._c||e)("div",this._g({class:this.bem,style:this.style},this.$listeners),[this._t("default")],2)}),[],!1,null,null,null).exports,c={name:"SwipeTabs",model:{prop:"tabIndex",event:"change"},props:{tabIndex:{type:Number,default:0},markType:{type:String,default:"line"},showTabs:{type:Boolean,default:!0},touchable:{type:Boolean,default:!0}},data:function(){return{curIndex:0,initIndex:0,tabs:[],tabScrollVersion:null}},computed:{tabsPadding:function(){return Math.max(24-4*this.tabs.length,0)},markLeft:function(){var e=(100-2*this.tabsPadding)/this.tabs.length;return this.tabsPadding+(this.curIndex+.5)*e}},watch:{tabIndex:function(e){e!==this.curIndex&&(this.curIndex=e,this.$refs.swipe.swipeTo(e,{immediate:!0}))},curIndex:function(){this.scrollTabsTocurrent()}},created:function(){this.initIndex=this.tabIndex,this.curIndex=this.tabIndex},activated:function(){this.initIndex=this.tabIndex,this.curIndex=this.tabIndex},mounted:function(){this.$nextTick(this.scrollTabsTocurrent)},methods:{changeIndex:function(e){this.$refs.swipe.swipeTo(e)},onChange:function(e){this.curIndex=e,this.$emit("change",e)},scrollTabsTocurrent:function(){var e=this.$refs["tabs-scroll"],t=this.$refs["tab-point"]?this.$refs["tab-point"][this.curIndex]:null;if(e&&t){var i=e.getBoundingClientRect(),a=t.getBoundingClientRect(),r=a.left-i.left,n=i.right-a.right;r<0&&this.tabScrollBy(r),n<0&&this.tabScrollBy(-n)}},tabScrollBy:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=this.$refs["tabs-scroll"];if(a){var r=a.scrollLeft,n=r+e,o=Math.round(i/16.7),c=e/o,s=r,d=this.tabScrollVersion=+new Date;return r===n?Promise.resolve():new Promise((function(e){!function i(){window.requestAnimationFrame((function(){d===t.tabScrollVersion&&(s+=c,a.scrollLeft=s,r<n&&s<n||r>n&&s>n?i():(a.scrollTop=n,e()))}))}()}))}}}},s=(i("bcf4"),Object(n.a)(c,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"swipe-tabs"},[e.showTabs?["line"===e.markType?i("div",{staticClass:"tabs border-bottom",style:{padding:"0 "+Math.max(24-4*e.tabs.length,0)+"%"}},[e._l(e.tabs,(function(t){return i("div",{key:t.index,staticClass:"tab",class:{"tab-current":t.index===e.curIndex},on:{click:function(i){e.changeIndex(t.index)}}},[e._v("\n        "+e._s(t.title)+"\n      ")])})),i("div",{staticClass:"mark-line",style:{left:e.markLeft+"%"}})],2):e._e(),"point"===e.markType?i("div",{staticClass:"tabs-point border-bottom"},[i("div",{ref:"tabs-scroll",staticClass:"tabs-scroll"},e._l(e.tabs,(function(t){return i("div",{key:t.index,ref:"tab-point",refInFor:!0,staticClass:"tab-point",class:{"tab-current":t.index===e.curIndex},on:{click:function(i){e.changeIndex(t.index)}}},[e._v("\n          "+e._s(t.title)+"\n        ")])})))]):e._e()]:e._e(),e._t("fixed"),i("van-swipe",{ref:"swipe",attrs:{"initial-swipe":e.initIndex,"show-indicators":!1,duration:250,loop:!1,touchable:e.touchable},on:{change:e.onChange}},[e._t("default")],2)],2)}),[],!1,null,"025feb99",null));t.b=s.exports},"7d4e":function(e,t,i){var a=i("c59b");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("85cb").default)("62c5f5a2",a,!0,{sourceMap:!1,shadowMode:!1})},"7e06":function(e,t,i){"use strict";var a=i("c5a7");t.__esModule=!0,t.unifySlots=c,t.createComponent=function(e){return function(t){var i;return"function"==typeof t&&(t={functional:!0,props:(i=t).props,model:i.model,render:function(e,t){return i(e,t.props,c(t),t)}}),t.functional||(t.mixins=t.mixins||[],t.mixins.push(n.SlotsMixin)),t.name=e,t.install=o,t}},i("4d1b");var r=i("a1aa"),n=i("1304");a(i("329b"));function o(e){var t=this.name;e.component(t,this),e.component((0,r.camelize)("-"+t),this)}function c(e){var t=e.scopedSlots||e.data.scopedSlots||{},i=e.slots();return Object.keys(i).forEach((function(e){t[e]||(t[e]=function(){return i[e]})})),t}},"7eb2":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .synchronize-tip-bar[data-v-66826030]{height:30px;padding:5px 15px;line-height:20px;text-align:center;background-color:#ffe6e6;color:#ff6060;font-size:14px}.zjapp .synchronize-tip-bar .icon-caution[data-v-66826030]{line-height:20px;margin-right:5px}@media screen and (-webkit-min-device-pixel-ratio:1){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 100%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:1.5){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 66.6667%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2.625){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 38.0952%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:3){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 33.3333%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:4){.zjapp .synchronize-tip-bar[data-v-66826030]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 25%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}",""])},"88ec":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .swipe-tabs[data-v-6bd34364]{flex:1}",""])},"967a":function(e,t,i){"use strict";var a=i("8d95");t.a={REPAIR_DEADLINE_STATUS:{name:"repair_deadline_status",status:["待整改"],module:[a.a.CHECK]}}},a1aa:function(e,t,i){"use strict";t.__esModule=!0,t.camelize=function(e){return e.replace(a,(function(e,t){return t.toUpperCase()}))},t.padZero=function(e,t){void 0===t&&(t=2);var i=e+"";for(;i.length<t;)i="0"+i;return i};var a=/-(\w)/g},abb2:function(e,t,i){"use strict";i("03d5")},b7b4:function(e,t,i){"use strict";var a=i("c5a7");t.__esModule=!0,t.noop=function(){},t.isDef=s,t.isObj=function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)},t.get=function(e,t){var i=t.split("."),a=e;return i.forEach((function(e){a=s(a[e])?a[e]:""})),a},t.isServer=t.addUnit=t.createNamespace=void 0;var r=a(i("329b")),n=i("6147");t.createNamespace=n.createNamespace;var o=i("2064");t.addUnit=o.addUnit;var c=r.default.prototype.$isServer;function s(e){return null!=e}t.isServer=c},bcf4:function(e,t,i){"use strict";i("27c4")},c03a:function(e,t,i){"use strict";i.r(t);var a=i("2567").a,r=(i("abb2"),i("17cc")),n=Object(r.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("page-content",{attrs:{title:e.title,"on-close":e.backEvent}},[i("check-guide",{attrs:{slot:"header-bar-right",module:"check","section-id":e.defaultBatch.bidsection_id,"before-open":e.beforeCheckGuideOpen},slot:"header-bar-right"}),i("item",{staticClass:"bg-sub-theme",attrs:{border:"bottom","icon-right":e.batchArrow?"arrow-right":""},on:{click:e.batchClick}},[i("div",{staticClass:"item-text"},[e._v(e._s(e.batchText))]),i("div",{staticClass:"item-font color-gray"},[e._v(e._s(e.batchTips))])]),i("swipe-tabs",{attrs:{color:"#4275e8","title-active-color":"#4275e8","line-width":e.tabsWidth},model:{value:e.tabIndex,callback:function(t){e.tabIndex=t},expression:"tabIndex"}},[i("swipe-tab",{attrs:{title:"草稿"}},[i("synchronize-tip-bar",{attrs:{"automatic-update-callback":e.init,"use-download":!1}}),i("scroller",{attrs:{"has-next":e.draftLimit<e.draftData.length,"is-empty":!e.draftData.length,"end-text":""},on:{pullDown:e.init,loadNext:e.pageDraft}},[e._l(e.draftDataShow,(function(t,a){return i("item-list",{key:a,attrs:{img:t.thumbnail,title:t.item_full_name||"未选检查项",detail:(t.desc_name?t.desc_name+" ":"")+(t.remark||""),footer:t.regist_date+" "+(t.place||"")},on:{click:function(i){e.problemEdit(t)}}})})),i("loading-status",{attrs:{"is-loading":e.isDraftLoading,"is-empty":!e.draftData.length,"empty-text":"请登记问题"}})],2)],1),i("swipe-tab",{attrs:{title:"已提交"}},[i("synchronize-tip-bar",{attrs:{"use-download":!1}}),i("scroller",{attrs:{"has-next":e.submittedLimit<e.submittedData.length,"is-empty":!e.submittedData.length},on:{pullDown:e.init,loadNext:e.pageSubmit}},[e._l(e.submittedDataShow,(function(t,a){return i("item-list",{key:a,attrs:{"is-unread":t.unread,"is-timeout":t.is_timeout,"is-urgent":"紧急"==t.emergency_degree||"特急"==t.emergency_degree,"is-return":t.sent_back_times>0,img:t.thumbnail,title:t.item_full_name||"未选检查项",detail:(t.desc_name?t.desc_name+" ":"")+(t.remark||""),footer:t.regist_date+" "+(t.place||""),status:t.status,"status-text":t.status_text,"repair-deadline":t.repair_deadline},on:{click:function(i){e.problemDetail(t)}}})})),i("loading-status",{attrs:{"is-loading":e.isSubmitLoading,"is-empty":!e.submittedData||!e.submittedData.length,"empty-text":"这里暂无数据"}})],2)],1)],1),i("app-button-group",{attrs:{"fixed-bottom":""}},[i("app-button",{on:{click:function(t){e.problemAdd()}}},[i("van-icon",{attrs:{name:"plus"}}),e._v("\n      登记问题\n    ")],1)],1)],1)}),[],!1,null,"6bd34364",null);t.default=n.exports},c59b:function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .item-list{position:relative;padding:10px;display:flex;align-items:center;background-color:#fff;min-height:100px}.zjapp .item-list .img{display:block;width:80px;height:80px;background:no-repeat 50%;background-size:cover;background-color:#ddd}.zjapp .item-list .item-list-con{flex:1;padding:0 15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.zjapp .item-list .item-list-con .title{height:30px;line-height:24px;color:#111;font-size:16px;padding-top:6px;margin:0;padding-right:10px;margin-right:-10px;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important;font-weight:400}.zjapp .item-list .item-list-con .title .type-tag{display:inline-block;height:16px;line-height:16px;padding:0 4px;border-radius:2px;border:1px solid #4275e8;color:#4275e8;font-size:12px;zoom:.8;margin:3px 0 0 0;vertical-align:text-top}.zjapp .item-list .item-list-con .text{height:30px;line-height:24px;color:#8c8c8c;padding-bottom:6px;padding-right:11px;margin-right:-10px}.zjapp .item-list .item-list-con .text,.zjapp .item-list .item-list-con .time{font-size:14px;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important}.zjapp .item-list .item-list-con .time{height:20px;line-height:20px;color:#b3b3b3;padding-right:11px!important;margin-right:-10px!important}.zjapp .item-list .item-list-con .time .ion{color:#a6a6a6;font-size:20px;font-weight:700;margin-right:5px;vertical-align:top}.zjapp .item-list .item-list-r{width:60px;line-height:18px;text-align:center}.zjapp .item-list .item-list-status{min-width:4em;line-height:18px;text-align:center;white-space:normal;font-size:14px}.zjapp .item-list .icon-unread{display:inline-block;text-align:center;width:12px;height:12px;border-radius:6px;background-color:red}.zjapp .item-list .icon-return,.zjapp .item-list .icon-timeout,.zjapp .item-list .icon-urgent{display:inline-block;width:16px;height:16px;text-align:center;line-height:16px;font-size:12px;font-style:normal;color:#fff;border-radius:2px;-webkit-border-radius:2px;vertical-align:top;margin-top:4px;margin-right:5px}.zjapp .item-list .icon-timeout{background:#964bfe}.zjapp .item-list .icon-return{background:#fe8b00}.zjapp .item-list .icon-urgent{background:#ff3c3d}.zjapp .item-list .icon-return:last-child,.zjapp .item-list .icon-timeout:last-child,.zjapp .item-list .icon-urgent:last-child{margin-right:0}.zjapp .item-list-tip{height:70px;line-height:60px;color:#b4b4b4;text-align:center}.zjapp .status-new-tag{position:absolute;right:0;top:0;width:50px;height:50px;overflow:hidden;z-index:10}.zjapp .status-new-tag>.tag{position:absolute;right:-32px;bottom:22px;height:20px;line-height:20px;width:100px;color:#fff;font-size:12px;transform:rotate(45deg);text-align:center;border-width:1px;border-style:solid}.zjapp .time-status{font-size:10px;color:#999}",""])},c5a7:function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},db6b2:function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,'.zjapp .swipe-tabs[data-v-025feb99]{display:flex;flex-direction:column;flex:1;overflow:hidden}.zjapp .tabs[data-v-025feb99]{position:relative;display:flex;background-color:#fff}.zjapp .tab[data-v-025feb99]{flex:1;height:40px;line-height:20px;padding:10px;font-size:14px;text-align:center;box-sizing:border-box}.zjapp .tab-current[data-v-025feb99]{color:#4275e8}.zjapp .mark-line[data-v-025feb99]{position:absolute;bottom:0;left:0;width:20px;height:2px;margin-left:-10px;background-image:linear-gradient(90deg,#5ea2ff,#4f83eb 50%,#4275e8);transition:left .4s cubic-bezier(.1,.7,.1,1)}.zjapp .tabs-point[data-v-025feb99]{position:relative;z-index:1;height:40px;font-size:0;text-align:center;background-color:#fff;overflow:visible}.zjapp .tabs-scroll[data-v-025feb99]{position:relative;padding-bottom:3px;margin-bottom:-3px;white-space:nowrap;overflow-x:auto}.zjapp .tabs-scroll[data-v-025feb99]::-webkit-scrollbar{display:none}.zjapp .tab-point[data-v-025feb99]{display:inline-block;padding:10px 15px;line-height:20px;font-size:16px;color:#333;white-space:nowrap}.zjapp .tab-point.tab-current[data-v-025feb99]{position:relative;z-index:3;color:#4275e8}.zjapp .tab-point.tab-current[data-v-025feb99]:after{content:"";position:absolute;z-index:3;bottom:-3px;left:50%;margin-left:-3px;width:7px;height:7px;border-radius:50%;background-color:#4275e8}',""])},dd16:function(e,t,i){"use strict";(function(e){t.a={name:"StatusText",props:{status:{type:String},text:{type:String},extend:{type:Object,default:function(){return{}}}},data:function(){return{classSet:e.extend({"草稿":"color-gray","暂存":"color-gray","检查中":"color-orange","待整改":"color-red","待复验":"color-orange","待验收":"color-red","待报验":"color-red","待申请进场":"color-red","待初验":"color-red","待送检":"color-red","待上传报告":"color-red","待退场":"color-red","待建设单位验收":"color-red","待区域验收":"color-red","供应链退回":"color-red","预创建":"color-status-blue","已提交":"color-green","已整改":"color-green","已验收":"color-green","已通过":"color-green","已退场":"color-gray","已关闭":"color-gray","非正常关闭":"color-gray","已退回":"color-red","已完成":"color-green","已甩项":"color-gray","检查完毕":"color-green","送检合格":"color-green","复验合格":"color-green","验收合格":"color-green","验收不合格":"color-red","未验收":"color-orange","待点评":"color-orange","已点评":"color-green","合格":"color-green","不合格":"color-red","进度正常":"color-green","进度滞后":"color-red","正常":"color-green","滞后":"color-red","施工单位验收合格":"color-green","监理单位验收合格":"color-green","建设单位验收合格":"color-green","施工单位验收不合格":"color-red","监理单位验收不合格":"color-red","建设单位验收不合格":"color-red"},this.extend)}},mounted:function(){}}}).call(this,i("391c"))},e89f:function(e,t,i){"use strict";var a=i("04f3"),r=i("cf09"),n=i("4360"),o=0;t.a={name:"PopupMixin",data:function(){return{backButtonEvent:null}},watch:{show:function(e){var t=this;if(e){if(this.$nextTick((function(){t.$el&&t.$el.style&&(t.$el.style.zIndex=++r.a.zIndex,o++,n.a.commit("app/SET_HAS_POPUP",!!o))})),!this.backButtonEvent){var i=this.close||this.closePopup;this.backButtonEvent=Object(a.a)(i)}}else--o<0&&(o=0),n.a.commit("app/SET_HAS_POPUP",!!o),this.backButtonEvent&&(Object(a.c)(this.backButtonEvent),this.backButtonEvent=null)}},methods:{}}},f24f:function(e,t,i){"use strict";t.__esModule=!0,t.isNumber=function(e){return/^\d+(\.\d+)?$/.test(e)},t.isNaN=function(e){if(Number.isNaN)return Number.isNaN(e);return e!=e}},f7ab:function(e,t,i){"use strict";var a=i("65e9").a,r=(i("f7d4"),i("17cc")),n=Object(r.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.show?i("div",{ref:"synchronize-tip-bar",staticClass:"synchronize-tip-bar"},[i("icon",{attrs:{name:"caution"}}),e.waitUploadNum?i("span",[e._v("您有"+e._s(e.waitUploadNum)+"条数据待上传")]):e._e(),!e.waitUploadNum&&e.hasChanged?i("span",[e._v("有新数据")]):e._e(),e._v("\n  ，下拉可"+e._s(e.waitUploadNum?"上传":"刷新")+"\n")],1):e._e()}),[],!1,null,"66826030",null);t.a=n.exports},f7d4:function(e,t,i){"use strict";i("2d6e")},fa4f:function(e,t,i){"use strict";var a=i("4aef"),r=i("967a"),n={name:"ItemList",components:{StatusText:a.a},props:{img:{type:String,default:""},title:{type:String,default:""},detail:{type:String,default:""},footer:{type:String,default:""},status:{type:String,default:""},isShowNewStatus:{type:Boolean,default:!1},statusText:{type:String,default:""},statusClassSet:{type:Object,default:function(){return{}}},typeTag:{type:String,default:""},isUnread:{type:Boolean,default:!1},isTimeout:{type:Boolean,default:!1},isUrgent:{type:Boolean,default:!1},isReturn:{type:Boolean,default:!1},repairDeadline:{type:String,default:null}},data:function(){return{repairDeadlineStatus:r.a.REPAIR_DEADLINE_STATUS.status}},computed:{bgNewClass:function(){return{"草稿":"bg-gray7 b-color","暂存":"bg-gray b-color","检查中":"bg-orange b-color","待整改":"bg-red2 b-color ","待复验":"bg-purple b-color","待验收":"bg-red b-color","待报验":"bg-red b-color","待申请进场":"bg-red b-color","待初验":"bg-red b-color","待送检":"bg-red b-color","待上传报告":"bg-red b-color","待退场":"bg-red b-color","待建设单位验收":"bg-red b-color","待区域验收":"bg-red b-color","已提交":"bg-green b-color","已整改":"bg-green b-color","已验收":"bg-green b-color","已通过":"bg-green2 b-color","已退场":"bg-gray b-color","已关闭":"bg-gray7 b-color","非正常关闭":"bg-gray b-color","已退回":"bg-red b-color","已完成":"bg-green b-color","已甩项":"bg-gray b-color","检查完毕":"bg-green b-color","送检合格":"bg-green b-color","复验合格":"bg-green b-color","验收合格":"bg-green b-color","验收不合格":"bg-red b-color","未验收":"bg-orange b-color","待点评":"bg-orange b-color","已点评":"bg-green b-color","合格":"bg-green b-color","不合格":"bg-red b-color","进度正常":"bg-green2 b-color","进度滞后":"bg-red2 b-color","施工单位验收合格":"bg-green b-color","监理单位验收合格":"bg-green b-color","建设单位验收合格":"bg-green b-color","施工单位验收不合格":"bg-red b-color","监理单位验收不合格":"bg-red b-color","建设单位验收不合格":"bg-red b-color"}}},activated:function(){}},o=(i("19a9"),i("17cc")),c=Object(o.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._g({staticClass:"item-list border-bottom"},e.$listeners),[e.isShowNewStatus?i("div",{staticClass:"status-new-tag"},[i("div",{staticClass:"tag",class:e.bgNewClass[e.status]},[e._v("\n      "+e._s(e.status)+"\n    ")])]):e._e(),e.img?i("div",{staticClass:"img",style:{"background-image":"url("+e.img+")"}}):e._e(),i("div",{staticClass:"item-list-con"},[i("h2",{staticClass:"title"},[e.isUnread?i("i",{staticClass:"icon-unread"}):e._e(),e.isTimeout?i("i",{staticClass:"icon-timeout"},[e._v("\n        超\n      ")]):e._e(),e.isUrgent?i("i",{staticClass:"icon-urgent"},[e._v("\n        急\n      ")]):e._e(),e.isReturn?i("i",{staticClass:"icon-return"},[e._v("\n        退\n      ")]):e._e(),e.$slots.title?e._t("title"):[e.typeTag?i("span",{staticClass:"type-tag"},[e._v(e._s(e.typeTag))]):e._e(),e._v("\n        "+e._s(e.title||"")+"\n      ")]],2),i("p",{staticClass:"text"},[e._v(e._s(e.detail||""))]),e.$slots.footer?e._t("footer"):i("p",{staticClass:"time",domProps:{innerHTML:e._s(e.footer||"")}})],2),e.status&&!e.isShowNewStatus?i("div",{staticClass:"item-list-status"},[i("status-text",{attrs:{status:e.status,text:e.statusText,extend:e.statusClassSet}}),e.repairDeadline&&e.repairDeadlineStatus.includes(e.status)?i("p",{staticClass:"time-status"},[e._v("\n      "+e._s(e._f("timeStatus")(e.repairDeadline))+"\n    ")]):e._e()],1):e._e()])}),[],!1,null,null,null);t.a=c.exports}}]);