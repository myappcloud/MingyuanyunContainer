(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-49e86c40"],{"08d4":function(t,e,n){"use strict";n("3880")},"0c22":function(t,e,n){"use strict";n("839a")},"0c52":function(t,e,n){(t.exports=n("690e")(!1)).push([t.i,".zjapp .app-stepper[data-v-03df57b7]{display:inline-block;width:110px;height:34px;margin:-2px 0;white-space:nowrap;font-size:0;line-height:0;vertical-align:top}.zjapp .app-stepper .number-input[data-v-03df57b7]{width:51px;height:34px;border:1px solid #dcdcdc;border-radius:0;font-size:14px;text-align:center;background-color:#fff;color:#111;box-sizing:border-box}.zjapp .app-stepper .number-input-focus[data-v-03df57b7]{border-color:#4275e8}.zjapp .btn-add[data-v-03df57b7],.zjapp .btn-minus[data-v-03df57b7]{display:inline-block;width:28px;height:34px;line-height:34px;padding:0;border:1px solid #dcdcdc;color:#666;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;box-sizing:border-box;background-color:#fff}.zjapp .btn-minus[data-v-03df57b7]{border-right:none;border-radius:4px 0 0 4px}.zjapp .btn-add[data-v-03df57b7]{border-left:none;border-radius:0 4px 4px 0}.zjapp .icon-add[data-v-03df57b7],.zjapp .icon-minus[data-v-03df57b7]{font-size:11px;vertical-align:top;display:inline-block;margin-top:10.5px}.zjapp .disabled[data-v-03df57b7]{color:#c8c8c8}.zjapp .activing[data-v-03df57b7]{color:#4275e8}",""])},"0f7b":function(t,e,n){"use strict";n("f548"),n("163d");var a,i,o={name:"AppStepper",components:{NumberInput:n("6948").a},props:{value:{type:[String,Number],default:""},max:{type:[String,Number],default:200},range:{type:Array}},data:function(){return{addActiving:!1,minusActiving:!1}},computed:{rangeMin:function(){return this.range&&this.range[0]||0},rangeMax:function(){return this.range&&this.range[1]?this.range[1]:this.max},allowAdd:function(){return""!==this.value&&this.value<this.rangeMax},allowMinus:function(){return""!==this.value&&this.value>this.rangeMin}},methods:{onChange:function(t){t&&(t=String(t).replace(/\D/g,"")),parseInt(t,10)>parseInt(this.max,10)&&(t=this.max),this.$emit("input",Number(t)),this.$emit("change",Number(t))},add:function(){if(this.allowAdd){var t=parseInt(this.value,10)+1;this.isInRange(t)&&(this.$emit("input",t),this.$emit("change",t)),this.setActiving("add")}},minus:function(){if(this.allowMinus){var t=parseInt(this.value,10)-1;this.isInRange(t)&&(this.$emit("input",t),this.$emit("change",t)),this.setActiving("minus")}},isInRange:function(t){return t>=this.rangeMin&&t<=this.rangeMax},setActiving:function(t){var e=this;t&&("minus"===t?(this.minusActiving=!0,clearTimeout(i),i=setTimeout((function(){e.minusActiving=!1}),300)):(this.addActiving=!0,clearTimeout(a),a=setTimeout((function(){e.addActiving=!1}),300)))}}},r=(n("91cb"),n("17cc")),c=Object(r.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-stepper"},[n("button",{staticClass:"btn-minus",class:{disabled:!t.allowMinus,activing:t.minusActiving},on:{click:t.minus}},[n("icon",{attrs:{name:"minus"}})],1),n("number-input",{attrs:{value:t.value,type:"int",range:t.range},on:{input:t.onChange}}),n("button",{staticClass:"btn-add",class:{disabled:!t.allowAdd,activing:t.addActiving},on:{click:t.add}},[n("icon",{attrs:{name:"add"}})],1)],1)}),[],!1,null,"03df57b7",null);e.a=c.exports},3880:function(t,e,n){var a=n("b66d");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n("85cb").default)("1e2c6191",a,!0,{sourceMap:!1,shadowMode:!1})},"3c77":function(t,e,n){"use strict";n("9dd9"),n("f548");var a=n("28f8"),i=(n("163d"),n("7bac")),o=n("4360");i.a.getUserObject("tree-base-open-set-memory").then((function(t){o.a.commit("components/SET_TREE_BASE_OPEN_SET",t||{})}));var r={name:"TreeBase",props:{data:{type:Array,default:function(){return[]}},keyword:{type:String,default:""},level:{type:Number,default:0},iconPosition:{type:String,default:"left"},indentSize:{type:Number,default:14},memoryOpenSet:{type:Boolean,default:!1},defaultOpenLevel:{type:Number,default:0},hasSlotLeft:{type:Boolean,default:!1},hasSlotRight:{type:Boolean,default:!1},listStyle:{type:Object,default:function(){return{}}},nodeStyle:{type:Object,default:function(){return{}}},textStyle:{type:Object,default:function(){return{}}}},data:function(){return{selfOpenSet:{}}},computed:{openSet:function(){return this.memoryOpenSet?o.a.state.components.treeBaseOpenSet:this.selfOpenSet},showSlotLeft:function(){return this.level?this.hasSlotLeft:!!this.$scopedSlots.left},showSlotRight:function(){return this.level?this.hasSlotRight:!!this.$scopedSlots.right}},methods:{itemClick:function(t){if(t.children&&t.children.length){if(this.memoryOpenSet)!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},o.a.state.components.treeBaseOpenSet,t);o.a.commit("components/SET_TREE_BASE_OPEN_SET",e),i.a.saveUserObject("tree-base-open-set-memory",e)}(Object(a.a)({},t.id,!this.isNodeOpen(t.id)));else this.$set(this.selfOpenSet,t.id,!this.isNodeOpen(t.id));this.$emit("onClickFoldNode",t)}else this.$emit("onClickEndNode",t);this.$emit("onClickNode",t)},isNodeOpen:function(t){return void 0===this.openSet[t]?this.level<this.defaultOpenLevel:this.openSet[t]},onClickNode:function(t){this.$emit("onClickNode",t)},onClickFoldNode:function(t){this.$emit("onClickFoldNode",t)},onClickEndNode:function(t){this.$emit("onClickEndNode",t)},keywordFilter:function(t){return this.keyword?t.replace(new RegExp(this.keyword,"gm"),'<span class="color-blue">'+this.keyword+"</span>"):t}}},c=(n("08d4"),n("17cc")),l=Object(c.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tree-con"},t._l(t.data,(function(e){return n("div",{key:e.id,staticClass:"tree-list",style:Object.assign({},t.listStyle["level-all"],t.listStyle["level-"+t.level])},[n("div",{staticClass:"tree-node border-bottom",class:"tree-node-level-"+t.level,style:Object.assign({},t.nodeStyle["level-all"],t.nodeStyle["level-"+t.level]),on:{click:function(n){t.itemClick(e)}}},[n("div",{staticClass:"tree-indent",style:{width:t.indentSize*t.level+"px"}}),"left"===t.iconPosition?n("div",{staticClass:"tree-icon",class:{"icon-dropdown":e.children&&e.children.length&&(void 0===t.openSet[e.id]?t.level<t.defaultOpenLevel:t.openSet[e.id]),"icon-dropright":e.children&&e.children.length&&!(void 0===t.openSet[e.id]?t.level<t.defaultOpenLevel:t.openSet[e.id])}}):t._e(),n("div",{staticClass:"tree-main"},[t.showSlotLeft?t._t("left",null,{data:e}):n("div",{staticClass:"tree-text",style:Object.assign({},t.textStyle["level-all"],t.textStyle["level-"+t.level]),domProps:{innerHTML:t._s(t.keywordFilter(e.name))}})],2),t.showSlotRight?t._t("right",null,{data:e}):t._e(),"right"===t.iconPosition&&e.children&&e.children.length?n("icon",{staticClass:"icon-right",attrs:{name:(void 0===t.openSet[e.id]?t.level<t.defaultOpenLevel:t.openSet[e.id])?"arrow-up":"arrow-down"}}):t._e()],2),t._t("siblings",null,{data:e}),e.children&&e.children.length&&(void 0===t.openSet[e.id]?t.level<t.defaultOpenLevel:t.openSet[e.id])?[n("tree-base",{key:"children-"+e.id,attrs:{data:e.children,level:t.level+1,keyword:t.keyword,"default-open-level":t.defaultOpenLevel,"memory-open-set":t.memoryOpenSet,"icon-position":t.iconPosition,"has-slot-left":t.showSlotLeft,"has-slot-right":t.showSlotRight,"indent-size":t.indentSize,"list-style":t.listStyle,"node-style":t.nodeStyle,"text-style":t.textStyle},on:{onClickNode:t.onClickNode,onClickFoldNode:t.onClickFoldNode,onClickEndNode:t.onClickEndNode},scopedSlots:t._u([{key:"left",fn:function(e){return[t._t("left",null,{data:e.data})]}},{key:"right",fn:function(e){return[t._t("right",null,{data:e.data})]}},{key:"siblings",fn:function(e){return[t._t("siblings",null,{data:e.data})]}}])})]:t._e()],2)})))}),[],!1,null,"0083fc0a",null);e.a=l.exports},"774b":function(t,e,n){"use strict";var a=n("d18d").a,i=(n("b225"),n("17cc")),o=Object(i.a)(a,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"scroll-warp",staticClass:"scroll-warp",class:{"scroll-warp-pulling":t.pulling,"scroll-warp-complete":!t.hasNext&&!t.isEmpty,"scroll-warp-empty":t.isEmpty},style:{"padding-bottom":t.numberKeyboardCoverHeight+"px"},on:{scroll:t.onScroll,touchstart:t.onTouchstart,touchmove:t.onTouchmove,touchend:t.onTouchend}},[t.allowPullDown?n("div",{staticClass:"pull-refresh-warp",style:{height:t.pullDist+"px"}},[n("div",{staticClass:"pull-refresh"},[n("div",{staticClass:"animation-refresher",class:{refreshing:t.refreshing}}),t.updateTime?n("p",{staticClass:"pull-refresh-date"},[t._v("最后成功同步："+t._s(t.updateTime))]):t._e()])]):t._e(),t._t("default"),t.loading?n("div",{staticClass:"page-loading"},[n("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[n("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]):t._e(),t.hasNext||t.isEmpty?t._e():[t.$slots.end?t._t("end"):t._e(),!t.$slots.end&&t.endText?n("div",{staticClass:"end-text"},[t._v("\n      "+t._s(t.endText)+"\n    ")]):t._e()]],2)}),[],!1,null,"2b1a346c",null);e.a=o.exports},"839a":function(t,e,n){var a=n("c516");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n("85cb").default)("4c0a8f6b",a,!0,{sourceMap:!1,shadowMode:!1})},"91cb":function(t,e,n){"use strict";n("c82d")},9320:function(t,e,n){"use strict";(function(t){n("309f"),n("0b53"),n("ec25"),n("2b45"),n("5ab2"),n("e10e"),n("ed63"),n("6a61");var a=n("2e91"),i=(n("163d"),n("6d57"),n("06a2"),n("e697"),n("28f8")),o=(n("cc57"),n("dc52")),r=n("cd05"),c=n("0f7b"),l=n("fd50"),s=n("3bd5"),p=n("3516"),d=n("37d5"),u=n("e2a7"),h=n("6e1b"),f=n("5a71"),m=n("88c7"),g=n("48f4"),b=(n("6144"),n("07d2")),v=n("3c77"),x=n("774b"),y=n("162a"),w=(n("fc33"),n("7bac"));function _(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return r=t.done,t},e:function(t){c=!0,o=t},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw o}}}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}e.a={components:{AppStepper:c.a,appRadio:o.a,SingleSelect:f.a,UserSelect:r.a,MultiSelect:m.a,Item:b.a,TreeBase:v.a,Scroller:x.a},data:function(){return{type:"add",viewTitle:"新建批次",batchId:"",batch:{},data:this.initData(),tempOptions:[],contractsOptions:[],inspectorOptions:[],cc:[],ccOptions:[],checkItems:[],oldValue:null}},computed:{currentProject:function(){return this.$store.state.global.currentProject},batchLocalStorageKey:function(){return"SpecialInspectBatchStorageKey-"+this.$store.state.global.currentProject.id},hasCombo:function(){if(!this.data||!this.data.temp)return!1;var t=this.data.temp.mode;return(99===t||100===t)&&"add"===this.type}},activated:function(){this.init()},destroyed:function(){window.clearTimeout(this.timeoutEvent)},methods:{initData:function(){return{timeoutEvent:null,batchName:"",timeLimit:7,type:"随机检查",checkItem:{id:"",name:""},building:{id:"",name:"",unit:""},purpose:"正式",batchBidsection:{},batchInspector:[],batchInspectorStr:"",batchCharger:{},temp:{}}},init:function(){var e=this,n=this.$route.params;this.batch={},this.checkItems=[],this.batchId=n&&n.id?n.id:"",this.data=this.initData();var a=s.a.getUser();l.a.when().then((function(){if(e.batchId)return e.type="edit",e.viewTitle="编辑批次",e.loadData();e.type="add",e.viewTitle="新建批次",e.targetUser={id:a.user_id,name:a.user_name},e.data={proj_id:e.currentProject.id,proj_name:e.currentProject.name,batchName:"",type:"专项巡检",temp:{},contracts:[],inspector:[]},e.$nextTick((function(){e.timeoutEvent=window.setTimeout((function(){e.$refs.batch_add_name_input.focus()}),500)}))})).then((function(){h.a.getSpecialFlyInspect().then((function(t){e.tempOptions=t}))})).then((function(){d.default.getProjectUsers(e.currentProject.id,[31,32,33]).then((function(n){var a,o,r;e.inspectorOptions=t.clone(n),e.ccOptions=t.map(n,(function(t){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){Object(i.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t)})),(a=t.find(e.inspectorOptions,(function(t){return t.id===e.targetUser.id})))&&(o=t.indexOf(e.inspectorOptions,a),(r=e.inspectorOptions.splice(o,1))[0].checked=!0,r[0].disabled=!0,e.inspectorOptions.unshift(r[0]),t.find(e.data.inspector,(function(t){return t.id===a.id}))||e.data.inspector.push(a))}))})).then((function(){e.getContractOptions()})).catch((function(t){$log.error(t)}))},getContractOptions:function(){var t=this;h.a.getContractList(this.data.proj_id).then((function(e){t.contractsOptions=e}))},beforeCheckContract:function(e){var n=t.find(this.data.contracts,{id:e.id});if(n&&n.problemNum)return u.a.alert("此合同有相关检查记录，不可删除"),!1},handleConfirm:function(t){this.data.contracts=t},isCheckItemSelected:function(){if(!this.data.batchBidsection.name)return u.a.alert("请选择所属标段"),!1},selectSection:function(t){this.data.temp=t},loadData:function(){var e=this;return Promise.all([h.a.getSpecialInspectBatchById(this.batchId),p.a.getBatchUsers(this.batchId)]).then((function(n){var a=n[0],i=n[1];e.targetUser={id:a.created_by,name:a.created_by_name},e.data={proj_id:a.proj_id,proj_name:a.proj_name,batchName:a.name,type:"专项巡检",temp:{id:a.temp_id,name:a.temp_name,mode:a.temp_mode,template_extension:a.template_extension},contracts:a.contracts,inspector:t.map(i,(function(t){return{id:t.user_id,name:t.user_name,checked:!0}})),created_by:a.created_by,created_by_name:a.created_by_name}}))},saveBatch:function(){var e=this,n=this.data,i=p.a.getBatchType("special-inspect"),o={batch:{id:this.batchId,batch_type:i,proj_id:this.currentProject.id,bidsection_id:"",name:n.batchName,template_id:n.temp.id,batch_purpose:"正式",status:"检查中",contracts:t.map(n.contracts||[],(function(t,e){return{id:t.id,remark:t.remark,sort:e+1}})),template_extension:n.temp.template_extension},batch_user:t.map(this.data.inspector,(function(t){return t.id})),batch_cc:t.map(this.cc,"id")};if(""!==n.batchName)if(n.temp&&n.temp.id)if(6===n.temp.mode&&t.isEmpty(n.contracts))u.a.alert("请选择相关合同");else if(n.inspector&&n.inspector.length){if(this.hasCombo){var r=this.transfer(this.checkItems);$log.log("专项巡检-新增批次-权重随批次走-权重列表：",r);var c,l=_(r);try{for(l.s();!(c=l.n()).done;){var s=c.value;if(!s.weight&&0!==s.weight)return void u.a.alert("请填写 ".concat(s.name," 的权重"));if(!this.inputJudeg(Number(s.weight)))return void u.a.alert("".concat(s.name," 权重限制为0-100数字，保留2位小数"))}}catch(t){l.e(t)}finally{l.f()}o.tree=r.map((function(t){return{id:t.id,weight:Number(t.weight)}}))}$log.log("专项巡检-新增批次-上传批次数据：",o),u.a.loading("请稍等..."),p.a.uploadBatch(o).then(function(){var t=Object(a.a)(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return g.default.setLocalChanged(),t.next=3,w.a.saveUserObject(e.batchLocalStorageKey,n);case 3:e.$router.go(-1);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){return u.a.hideLoading(),u.a.alert(t)})).finally((function(){u.a.hideLoading()}))}else u.a.alert("请选择检查人");else u.a.alert("请选择检查模板");else u.a.alert("请输入批次名称")},singleSelect:function(t){$log.log("专项巡检-新增批次-选中批次：",t),[100,99].includes(t.mode)&&this.getTemplateList(t.id)},getTemplateList:function(t){var e=this;y.a.request("/online/special-inspect/get-template-tree",{template_id:t}).then((function(t){$log.log("专项巡检-新增批次-根据批次id获取模板详情：",t),t&&t.length&&(t=t.map((function(t){return t.template_name=t.name,t})),e.checkItems=e.forumTreeData(t))}))},forumTreeData:function(t){var e="id",n="parent_id",a={},i=[];for(var o in t)a[t[o][e]]=t[o];for(var r in a)0!==a[r][n]&&a[a[r][n]]?(a[a[r][n]].children||(a[a[r][n]].children=[]),a[a[r][n]].children.push(a[r])):i.push(a[r]);return i},transfer:function(t){var e=this;return t.reduce((function(t,n){var a=n.id,i=n.name,o=n.weight,r=n.children,c=void 0===r?[]:r;return t.concat([{id:a,name:i,weight:o}],e.transfer(c,a))}),[])},treeFocus:function(t){this.oldValue=t.weight?Number(t.weight):0},treeInput:function(t,e){""!==t&&(this.inputJudeg(Number(t))?this.oldValue=Number(t):e.weight=this.oldValue)},inputJudeg:function(t){return/^(\d{1,2}(\.\d{1,2})?|100)$/.test(t)}}}}).call(this,n("391c"))},9455:function(t,e,n){"use strict";n("f272")},"9d55":function(t,e,n){(t.exports=n("690e")(!1)).push([t.i,'.zjapp .scroll-warp[data-v-2b1a346c]{flex:1;overflow:auto;-webkit-overflow-scrolling:touch}.zjapp .scroll-warp-pulling[data-v-2b1a346c]{overflow:hidden}.zjapp .scroll-warp-complete[data-v-2b1a346c]:after{content:"";display:block;height:100px}.zjapp .scroll-warp-empty[data-v-2b1a346c]{display:flex;flex-direction:column}.zjapp .pull-refresh-warp[data-v-2b1a346c]{position:relative;height:0;overflow:hidden}.zjapp .pull-refresh[data-v-2b1a346c]{position:absolute;left:0;bottom:0;height:70px;width:100%;padding:6px;text-align:center}.zjapp .pull-refresh-date[data-v-2b1a346c]{margin-top:4px;height:16px;line-height:16px;font-size:12px;color:#bcbcbc}.zjapp .page-loading[data-v-2b1a346c]{padding:10px;text-align:center}.zjapp .end-text[data-v-2b1a346c]{color:#c8c8c8;background:#f4f4f4;position:relative;line-height:76px;height:76px;text-align:center}.zjapp .end-text[data-v-2b1a346c]:after,.zjapp .end-text[data-v-2b1a346c]:before{content:"";position:absolute;width:48px;height:1px;background:#e4e4e4;top:50%;margin-top:-1px}.zjapp .end-text[data-v-2b1a346c]:after{left:50%;transform:translateX(-92px)}.zjapp .end-text[data-v-2b1a346c]:before{right:50%;transform:translateX(90px)}.zjapp .end-slot[data-v-2b1a346c]{padding:30px;line-height:18px;text-align:center;color:#c8c8c8}',""])},b225:function(t,e,n){"use strict";n("ef48")},b66d:function(t,e,n){(t.exports=n("690e")(!1)).push([t.i,'.zjapp .tree-node[data-v-0083fc0a]{display:flex;flex-direction:row;align-items:center;justify-content:center;padding:8px 15px}.zjapp .tree-main[data-v-0083fc0a]{flex:1}.zjapp .tree-text[data-v-0083fc0a]{font-size:14px;color:#333;line-height:20px;padding:5px 0;overflow:hidden;text-overflow:ellipsis;-webkit-line-clamp:2}.zjapp .tree-indent[data-v-0083fc0a]{width:14px;height:20px}.zjapp .tree-icon[data-v-0083fc0a]{position:relative;width:20px;height:20px;line-height:20px;color:#c8c8c8;font-size:26px}.zjapp .icon-dropdown[data-v-0083fc0a]:before,.zjapp .icon-dropright[data-v-0083fc0a]:before{content:"";position:absolute;width:0;height:0;border:6px solid #c8c8c8}.zjapp .icon-dropdown[data-v-0083fc0a]:before{top:7px;left:0;border-left-color:transparent}.zjapp .icon-dropdown[data-v-0083fc0a]:before,.zjapp .icon-dropright[data-v-0083fc0a]:before{border-right-color:transparent;border-bottom-color:transparent}.zjapp .icon-dropright[data-v-0083fc0a]:before{top:4px;left:2px;border-top-color:transparent}.zjapp .icon-right[data-v-0083fc0a]{margin-left:10px;color:#c8c8c8;line-height:30px}',""])},c516:function(t,e,n){(t.exports=n("690e")(!1)).push([t.i,'.zjapp .scroll-wrap[data-v-cf504744]{flex:1;overflow:auto;padding-bottom:100px}.zjapp .date[data-v-cf504744]{padding-right:30px}.zjapp .unit[data-v-cf504744]{position:absolute;right:15px;top:10px}.zjapp .cell-item[data-v-cf504744]{position:relative;font-size:16px;line-height:30px}.zjapp .cell-item input[data-v-cf504744]{border:none;margin:0;display:block;height:34px;color:#111;vertical-align:middle;line-height:16px;text-align:right}.zjapp .cell-item .fr[data-v-cf504744]{color:#b2b2b2;line-height:30px}.zjapp .cell-item i[data-v-cf504744]{float:right;margin-top:2px}.zjapp .cell-item .gray[data-v-cf504744]{color:#666}.zjapp .cell-item[data-v-cf504744] .van-cell__value{padding-left:90px}.zjapp .cell-item[data-v-cf504744] .van-cell__value .custom-text{position:absolute;left:0}.zjapp .cell-item[data-v-cf504744] .van-cell__right-icon{color:#c8c8c8}.zjapp .item-contract[data-v-cf504744]{position:relative;padding:13px 15px;background-color:#fff}.zjapp .item-contract-icon[data-v-cf504744]{top:16px;left:15px;font-size:14px}.zjapp .item-contract-icon[data-v-cf504744],.zjapp .item-contract-index[data-v-cf504744]{position:absolute;width:14px;height:14px;line-height:14px;color:#4275e8}.zjapp .item-contract-index[data-v-cf504744]{top:19px;left:24px;font-size:10px;font-weight:700}.zjapp .item-contract-name[data-v-cf504744]{padding-left:22px;font-size:14px;line-height:20px;color:#666}.zjapp .item-contract-code[data-v-cf504744]{margin-top:4px;padding-left:22px;font-size:12px;line-height:18px;color:#999}.zjapp .item-contract-textarea[data-v-cf504744]{margin-top:13px;padding:13px 0 13px 22px;font-size:12px;line-height:20px;color:#999}.zjapp .item-contract-textarea textarea[data-v-cf504744]{width:100%;line-height:20px;border:none}.zjapp .title[data-v-cf504744]{position:relative;color:#333;height:46px;line-height:46px;background:#fff;padding-left:15px;font-size:16px;border-bottom:1px solid #ececec}.zjapp .title[data-v-cf504744]:after{content:"";width:4px;height:16px;background:#4275e8;position:absolute;top:50%;left:0;margin-top:-8px}.zjapp .tree-base-right[data-v-cf504744]{display:flex;align-items:center;height:28px;padding-left:5px;font-size:16px}.zjapp .tree-input[data-v-cf504744]{width:52px;border:1px solid #ececec;border-radius:4px;padding:5px 5px;margin-right:6px}.zjapp .tree-input[data-v-cf504744] input{color:#333}.zjapp .tree-base[data-v-cf504744] .tree-node{background-color:#fafafa}.zjapp .tree-base[data-v-cf504744] .tree-node-level-0,.zjapp .tree-base[data-v-cf504744] .tree-node-level-1{background-color:#fff}.zjapp .tree-base[data-v-cf504744] .tree-node-level-0,.zjapp .tree-base[data-v-cf504744] .tree-text .tree-node-level-1 .tree-text{color:#333}.zjapp .tree-base[data-v-cf504744] .tree-node .tree-text{color:#666;font-size:16px}.zjapp .tree-base[data-v-cf504744] .tree-node-level-0 .tree-text{font-weight:500}',""])},c62c:function(t,e,n){(t.exports=n("690e")(!1)).push([t.i,'.zjapp .app-radio[data-v-2340da0b]{position:relative;line-height:20px;font-size:0}.zjapp .app-radio>*[data-v-2340da0b]{display:inline-block;vertical-align:middle}.zjapp .app-radio .app-radio-icon[data-v-2340da0b]{width:20px;height:20px;border:1px solid #d9d9d9;border-radius:20px}.zjapp .app-radio .app-radio-icon+*[data-v-2340da0b]{margin-left:10px;font-size:16px}.zjapp .app-radio .checked-icon[data-v-2340da0b]{position:relative;border:1px solid #4275e8}.zjapp .app-radio .checked-icon[data-v-2340da0b]:before{content:" ";background:#4275e8;display:inline-block;width:14px;height:14px;border-radius:20px;position:absolute;top:2px;left:2px}',""])},c82d:function(t,e,n){var a=n("0c52");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n("85cb").default)("26e0fa2e",a,!0,{sourceMap:!1,shadowMode:!1})},d18d:function(t,e,n){"use strict";(function(t){n("2b45");var a,i=n("4360"),o=n("48f4"),r=n("162a"),c=n("e2a7"),l=n("a500"),s=n("6f9e"),p={};e.a={name:"Scroller",props:{buildingId:{type:String,default:""},hasNext:{type:Boolean,default:!1},isEmpty:{type:Boolean,default:!1},isSync:{type:Boolean,default:!0},endText:{type:String,default:""},memoryScrollTop:{type:Boolean,default:!0},keepScrollTop:{type:Boolean},hasPullDown:{type:Boolean,default:!0},onPullDown:{type:Function}},data:function(){return{pullDist:0,refreshing:!1,pulling:!1,loading:!1,scrollTop:0,isCurrKeyboard:!1,gapBottom:0}},computed:{allowPullDown:function(){return this.hasPullDown&&(!!this.$listeners.pullDown||!!this.onPullDown)},updateTime:function(){return i.a.state.global.businessDownloadTime},numberKeyboardCoverHeight:function(){return i.a.state.global.isNumberInputOpen?i.a.state.global.numberKeyboardHeight-this.gapBottom:0}},mounted:function(){var t=this;s.a.$on("numberKeyboardOpen",this.onNumberKeyboardOpen),this.$nextTick((function(){var e=t.$refs["scroll-warp"]&&t.$refs["scroll-warp"].getBoundingClientRect&&t.$refs["scroll-warp"].getBoundingClientRect();e&&(t.gapBottom=document.documentElement.clientHeight-e.bottom),t.$el&&t.$el.addEventListener("focus",(function(e){var n=e&&e.target,a=n&&n.tagName&&n.tagName.toLowerCase();if("input"===a||"textarea"===a){window.addEventListener("resize",(function e(){var a=n.getBoundingClientRect(),i=t.$el.getBoundingClientRect(),o=a.bottom-i.bottom;o>0&&t.scrollBy(o),window.removeEventListener("resize",e,!1)}),!1)}}),!0)}))},destroyed:function(){s.a.$off("numberKeyboardOpen",this.onNumberKeyboardOpen)},activated:function(){var t=this.keepScrollTop||this.$router.isBack&&this.memoryScrollTop;this.scrollTop&&t&&(this.$refs["scroll-warp"].scrollTop=this.scrollTop)},deactivated:function(){this.memoryScrollTop&&(this.scrollTop=this.$refs["scroll-warp"].scrollTop)},methods:{onScroll:function(t){var e=this,n=this.$refs["scroll-warp"].scrollTop,a=this.$refs["scroll-warp"].scrollHeight;if(n+this.$refs["scroll-warp"].clientHeight>=a-5&&!this.loading&&this.hasNext){this.loading=!0;var i=this.$listeners.loadNext();i&&i.then&&"function"==typeof i.then?i.then((function(){e.loading=!1})):this.loading=!1}this.$emit("scroll",t)},getTouchDiretion:function(t){if(!(p&&t&&t.touches&&t.touches[0]))return"";var e=t.touches[0].clientX,n=t.touches[0].clientY;return Math.abs(n-p.y)>Math.abs(e-p.x)&&Math.abs(n-p.y)>=3?n>p.y?"down":"up":""},onTouchstart:function(t){this.allowPullDown&&t.touches&&1===t.touches.length&&(p={x:t.touches[0].clientX,y:t.touches[0].clientY,scrollTop:this.$refs["scroll-warp"].scrollTop,pullDist:this.pullDist})},onTouchmove:function(t){if(this.allowPullDown&&t.touches&&1===t.touches.length){var e=this.$refs["scroll-warp"].scrollTop,n=t.touches[0].clientY,a=n-p.y,i=this.getTouchDiretion(t);"down"===i?!this.refreshing&&e<=0?(this.pulling=!0,this.pullDist=(a-p.scrollTop)/2,t.preventDefault()):this.pulling=!1:"up"===i?this.pullDist>0&&(this.pullDist=p.pullDist-(p.y-n),t.preventDefault()):this.pullDist=p.pullDist}},onTouchend:function(){var t=this;this.allowPullDown&&(p={},this.pulling=!1,this.pullDist>=70&&this.isSync?this.refreshing?this.makePullTo(70):this.makePullTo(70).then((function(){if(t.refreshing=!0,t.onPullDown){var e=t.onPullDown();e&&e.then&&"function"==typeof e?e.finally((function(){t.refreshing=!1,t.makePullTo(0)})):(t.refreshing=!1,t.makePullTo(0))}else t.dataSync().then((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")})).catch((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")}))})):(this.refreshing=!1,this.makePullTo(0)))},makePullTo:function(t){var e=this,n=this.pullDist,a=t,i=a-n,o=n;return n===a?Promise.resolve():new Promise((function(t){!function r(){window.requestAnimationFrame((function(){o+=i/6,e.pullDist=o,n<a&&o<a||n>a&&o>a?r():(e.pullDist=a,e.refreshing=!1,t())}))}()}))},dataSync:function(){var t,e=o.default.getCurrentModuleCode(),n=o.default.getCurrentRoute(),a=n.meta&&n.meta.isTodo;if(o.default.isModuleNeedBuilding(e)&&!a){if(!this.buildingId)return new Promise((function(t){setTimeout((function(){t()}),500)}));t=this.buildingId}return l.a.addTrack("公共-手动下拉刷新","",""),r.a.beginManualUpdate(),o.default.checkSync(t).then((function(t){return r.a.endManualUpdate(),t})).catch((function(t){$log.error("下拉刷新错误",t),t&&"Error: Network Error"===t.toString()?c.a.alert("当前网络无法同步数据"):c.a.alert(t),r.a.endManualUpdate()}))},getScrollHeight:function(){return this.$refs["scroll-warp"].offsetHeight},getScrollTop:function(){return this.$refs["scroll-warp"].scrollTop},setScrollTop:function(t){this.$refs["scroll-warp"].scrollTop=t},scrollBy:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,i=this.getScrollTop(),o=i+t,r=Math.round(n/16.7),c=t/r,l=i,s=a=+new Date;return i===o?Promise.resolve():new Promise((function(t){!function n(){window.requestAnimationFrame((function(){s===a&&(l+=c,e.$refs["scroll-warp"].scrollTop=l,i<o&&l<o||i>o&&l>o?n():(e.$refs["scroll-warp"].scrollTop=o,t()))}))}()}))},scrollTo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=this.getScrollTop(),a=t-n;return this.scrollBy(a,e)},scrollToEle:function(t){var e=t.keyboardHeight||232,n=(t=t.$el?t.$el:t).getBoundingClientRect(),a=this.$refs["scroll-warp"].getBoundingClientRect();if(n&&a){var o=document.documentElement.clientHeight-(i.a.state.global.isNumberInputOpen?e:0),r=a.bottom<o?a.bottom:o,c=a.top-n.top,l=n.bottom-r;c>0?this.scrollBy(-c-10):l>0&&this.scrollBy(l+10)}},isCurrent:function(e,n){var a=this;e.length&&t.each(e,(function(t){t._uid===n?a.isCurrKeyboard=!0:a.isCurrent(t.$children,n)}))},onNumberKeyboardOpen:function(t){this.isCurrKeyboard=!1,this.isCurrent(this.$children,t._uid),this.isCurrKeyboard&&this.scrollToEle(t)}}}}).call(this,n("391c"))},dc52:function(t,e,n){"use strict";var a={props:{text:{type:String,default:""},checked:{type:Boolean,default:!1},changeRadio:{type:Function,default:function(){return 0}}},data:function(){return{status:!1}},watch:{checked:function(t){this.status=t}},created:function(){this.status=this.checked},methods:{clickEvent:function(){this.status=!0,this.$emit("changeRadio",this.status)}}},i=(n("9455"),n("17cc")),o=Object(i.a)(a,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"app-radio",on:{click:this.clickEvent}},[e("span",{class:{"app-radio-icon":!0,"checked-icon":this.status}}),this.text?e("span",[this._v(this._s(this.text))]):e("span",[this._t("default")],2)])}),[],!1,null,"2340da0b",null);e.a=o.exports},e5cd1:function(t,e,n){"use strict";n.r(e);var a=n("9320").a,i=(n("0c22"),n("17cc")),o=Object(i.a)(a,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("page-content",{attrs:{title:"add"==t.type?"新建批次":"编辑批次","show-go-root":!0}},[n("scroller",[n("div",{staticClass:"list"},[n("item",{attrs:{label:"项目",text:t.data.proj_name,mode:"edit"}}),n("item",{attrs:{label:"批次名称",mode:"edit"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.data.batchName,expression:"data.batchName"}],ref:"batch_add_name_input",staticClass:"input-align-r",attrs:{slot:"right",type:"text",placeholder:"请填写"},domProps:{value:t.data.batchName},on:{input:function(e){e.target.composing||t.$set(t.data,"batchName",e.target.value)}},slot:"right"})]),n("single-select",{attrs:{title:"检查模板",options:t.tempOptions,mode:"edit",editabled:"add"===t.type},on:{onSelect:t.singleSelect},model:{value:t.data.temp,callback:function(e){t.$set(t.data,"temp",e)},expression:"data.temp"}}),6===t.data.temp.mode?n("multi-select",{ref:"selectMaterialType",attrs:{options:t.contractsOptions,"selected-text":t.data.contracts&&t.data.contracts.length?t.data.contracts.length+"个":"",title:"相关合同","right-btn":"确定","check-box-ali-right":!0,"before-check":t.beforeCheckContract},on:{onSelect:t.handleConfirm},model:{value:t.data.contracts,callback:function(e){t.$set(t.data,"contracts",e)},expression:"data.contracts"}}):t._e(),t._l(t.data.contracts,(function(e,a){return n("div",{key:a,staticClass:"item-contract",class:{"border-bottom":a+1!==t.data.contracts.length}},[n("icon",{staticClass:"item-contract-icon",attrs:{name:"list-index"}}),n("div",{staticClass:"item-contract-index",domProps:{textContent:t._s(a+1)}}),n("div",{staticClass:"item-contract-name",domProps:{textContent:t._s(e.name)}}),n("div",{staticClass:"item-contract-code",domProps:{textContent:t._s(e.code)}}),n("div",{staticClass:"item-contract-textarea border-top"},[n("textarea",{directives:[{name:"autoheight",rawName:"v-autoheight"},{name:"model",rawName:"v-model",value:e.remark,expression:"contract.remark"}],attrs:{placeholder:"合同当前进度描述(选填)",maxlength:"200"},domProps:{value:e.remark},on:{input:function(n){n.target.composing||t.$set(e,"remark",n.target.value)}}})])],1)}))],2),n("div",{staticClass:"list mt10"},[n("user-select",{attrs:{options:t.inspectorOptions,title:"检查人",multi:!0},model:{value:t.data.inspector,callback:function(e){t.$set(t.data,"inspector",e)},expression:"data.inspector"}}),n("user-select",{attrs:{options:t.ccOptions,title:"抄送人",multi:!0},model:{value:t.cc,callback:function(e){t.cc=e},expression:"cc"}})],1),t.hasCombo?n("div",{staticClass:"list mt10"},[n("div",{staticClass:"title"},[t._v("权重配置")]),t.checkItems.length?n("tree-base",{staticClass:"tree-base",attrs:{data:t.checkItems,"indent-size":10,"default-open-level":1/0},scopedSlots:t._u([{key:"left",fn:function(e){return n("div",{staticClass:"tree-text"},[t._v(t._s(e.data.template_name))])}},{key:"right",fn:function(e){return[n("div",{staticClass:"tree-base-right",on:{click:function(t){t.stopPropagation()}}},["add"===t.type?n("van-field",{staticClass:"tree-input",attrs:{type:"number",border:!1},on:{focus:function(n){t.treeFocus(e.data)},input:function(n){t.treeInput(n,e.data)}},model:{value:e.data.weight,callback:function(n){t.$set(e.data,"weight",n)},expression:"item.data.weight"}}):n("span",[t._v(t._s(e.data.weight))]),n("span",[t._v("%")])],1)]}}])}):t._e(),n("loading-status",{staticStyle:{"min-height":"230px"},attrs:{"is-empty":!t.checkItems.length,"empty-text":"请在PC端添加评分模板"}})],1):t._e(),n("app-button-group",["add"===t.type?n("app-button",{on:{click:t.saveBatch}},[t._v("\n        提交\n      ")]):n("app-button",{on:{click:t.saveBatch}},[t._v("\n        保存\n      ")])],1)],1)],1)}),[],!1,null,"cf504744",null);e.default=o.exports},ef48:function(t,e,n){var a=n("9d55");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n("85cb").default)("a1a65c0c",a,!0,{sourceMap:!1,shadowMode:!1})},f272:function(t,e,n){var a=n("c62c");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n("85cb").default)("6a97aac3",a,!0,{sourceMap:!1,shadowMode:!1})},fc33:function(t,e,n){"use strict";n("2b45"),n("6d57");var a=n("fc9f"),i=function(t){return a.a.query("select b.*, t.name as template_name, t.mode as template_mode, bc.weight\n      from batch b\n      left join special_inspect_template t on t.id = b.template_id\n      left join special_inspect_template_batch_combo bc on bc.batch_id = b.id and bc.template_id = t.id\n      where b.root_id = ? and ifnull(b.parent_id, '') != ''\n      order by bc.sort",[t])},o=function(t){return a.a.query("select b.*, t.name as template_name, t.mode as template_mode, bc.weight\n      from batch b\n      left join special_inspect_template t on t.id = b.template_id\n      left join special_inspect_template_batch_combo bc on bc.batch_id = b.id and bc.template_id = t.id\n      where b.root_id = ?\n      order by bc.sort",[t])},r=n("7cb8");function c(t){if(!t||!t.length)return[];var e=[],n=[];return t.forEach((function(t){e[t.id]=t})),t.forEach((function(t){t.parent_id&&e[t.parent_id]?(e[t.parent_id].children||(e[t.parent_id].children=[]),e[t.parent_id].children.push(t)):n.push(t)})),n}e.a={getBatchTree:function(t){var e=this;return i(t).then((function(t){(t||[]).forEach((function(t){try{var e=JSON.parse(t.template_extension||{});t.algorithm=parseInt(e.total_score_algorithm)||1}catch(e){t.algorithm=1}}));var n=c(t);return e.setBatchTreeScore(n),n}))},setBatchTreeScore:function(t){var e=this;t&&t.length&&t.forEach((function(t){t.children&&t.children.length&&(e.setBatchTreeScore(t.children),t.score=e.getScore(t.children,t.algorithm))}))},getBatchTotalData:function(t){var e=this;return o(t).then((function(t){(t||[]).forEach((function(t){try{var e=JSON.parse(t.template_extension||{});t.algorithm=parseInt(e.total_score_algorithm)}catch(e){t.algorithm=1}}));var n=c(t);return e.setBatchTreeScore(n),n}))},getScoreWeight:function(t,e){return Object(r.i)(t)?Object(r.i)(e)?(t=parseFloat(t))*(e=parseFloat(e)/100):parseFloat(t):0},getScoreWeightText:function(t,e){return Object(r.i)(t)?Object(r.i)(e)?(t="%"===t.toString().substr(-1)?t:"".concat(t,"%"),e="%"===e.toString().substr(-1)?e:"".concat(e,"%"),"".concat(t,"*").concat(e)):t:""},getScore:function(){var t,e,n=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o="";return 1===i?(a.forEach((function(e){if(Object(r.i)(e.score)){var a=e.score,i=e.weight;t=t||0,t+=n.getScoreWeight(a,i)}})),o=t):2===i&&(a.forEach((function(a){if(Object(r.i)(a.score)){var i=a.score,o=a.weight;t=t||0,e=e||0,t+=n.getScoreWeight(i,o),e+=parseFloat(o)/100}})),o=Object(r.i)(t)?e?t/e:0:""),o=Object(r.i)(o)?(Math.round(100*o)/100).toFixed(2)+"%":""},getScoreFormula:function(){var t,e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=[],o=[];return 1===a?(t="得分=组合评分表1*权重1+组合评分表2*权重2+...+组合评分表n*权重n",n.forEach((function(t){if(Object(r.i)(t.score)){var n=t.score,a=t.weight;i.push(e.getScoreWeightText(n,a))}})),i&&i.length&&(t+="=".concat(i.join("+"),"=").concat(this.getScore(n,a)))):2===a&&(t="得分=（组合评分表1*权重1+组合评分表2*权重2+...+组合评分表n*权重n）/（权重1+权重2+...+权重n）",n.forEach((function(t){if(Object(r.i)(t.score)){var n=t.score,a=t.weight;i.push(e.getScoreWeightText(n,a)),o.push("".concat(a,"%"))}})),i&&i.length&&(t+="=(".concat(i.join("+"),")/(").concat(o.join("+"),")=").concat(this.getScore(n,a)))),t}}}}]);