(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-36a54196"],{"05d1":function(t,e,a){"use strict";(function(t){a("616f"),a("cc57");var i=a("a32d"),o=a.n(i),s=a("e2a7"),n=a("3bd5"),c=a("fd50"),r=a("3516"),p=a("7b81"),u=a("9864"),l=a("07d2");e.a={name:"CheckBatchDetail",components:{CheckUserContact:u.a,Item:l.default},data:function(){return{isLoading:!0,batchId:"",batch:{},batchData:{},editable:!1,mode:""}},activated:function(){$log.log("现场检查批次详情，activated"),this.init()},methods:{init:function(){var e=this,a=this.$route.params;this.isLoading=!0,this.batchId=a&&a.id?a.id:"",c.a.all([r.a.getBatch(this.batchId),r.a.getBatchUsers(this.batchId),r.a.getBatchCCs(this.batchId)]).then((function(a){var i=e.batch=a[0],s=a[1],c=a[2];return console.log("batch =======",i),e.batchData={purpose:i.batch_purpose||"正式",name:i.name,bidsection:i.section_name+"（"+i.proj_name+"）",inspector:t.map(s,(function(t){return t})),cc:t.map(c,(function(t){return t})),room:[],checkitem:[],type:"实测巡检",item_name:i.item_name,created_on:i.created_on,create_user_info:{}},e.editable=i.created_by===n.a.getUser().user_id,p.a.getUsersByIds([i.created_by]).then((function(t){e.batchData.create_user_info=t[0]})),r.a.getBatchRooms(e.batchId).then((function(a){var i=t.groupBy(a,(function(t){return t.unit&&!o.a.endsWith(t.unit,"单元")&&(t.unit+="单元"),t.building_name+(t.unit||"")}));e.batchData.room=t.map(i,(function(e,a){return a+t.map(e,"room_name").join("、")}))}))})).then((function(){return r.a.getBatchCheckitems(e.batchId).then((function(t){e.batchData.checkitem=t}))})).then((function(){e.isLoading=!1})).catch((function(t){console.error(t)}))},batchDelete:function(){var t=this;this.batch.id&&("测试"===this.batch.batch_purpose||"1"!==this.batch.is_downloaded?s.a.confirm("确定要删除批次吗？",(function(){s.a.loading("请稍等..."),r.a.deleteBatch(t.batch.id).then((function(){t.$router.go(-1),s.a.hideLoading()})).catch((function(t){s.a.hideLoading(),s.a.alert(t.errmsg)}))})):s.a.alert("被他人下载过的批次不能删除"))},closeBatch:function(){var t=this;this.batch.id&&s.a.confirm("关闭批次后，在APP将看不到该批次及相关问题，可在PC端统计报表中查看。确定关闭批次？",(function(){s.a.loading("请稍等..."),r.a.closeBatch(t.batch.id).then((function(){t.$router.go(-1)})).catch((function(t){s.a.alert(t)})).finally((function(){s.a.hideLoading()}))}))},batchEdit:function(){this.batchId?this.$router.push({name:"MeasureInspectBatchEdit",query:{id:this.batchId}}):s.a.alert("缺少批次id")}}}}).call(this,a("391c"))},"1cde":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .content-wrap[data-v-243b20b0]{max-height:100%;overflow:auto;padding-bottom:50px}",""])},"20e8":function(t,e,a){var i=a("1cde");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("a38e055c",i,!0,{sourceMap:!1,shadowMode:!1})},5816:function(t,e,a){"use strict";a.r(e);var i=a("05d1").a,o=(a("e988"),a("17cc")),s=Object(o.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-content",{attrs:{title:"批次详情","show-go-root":!0}},[a("div",{staticClass:"content-wrap"},[t.isLoading?t._e():a("div",{staticClass:"list bg-white pt10 pb10 border"},[a("item",{attrs:{label:"批次名称",text:t.batchData.name}}),a("item",{attrs:{label:"所属标段",text:t.batchData.bidsection}}),a("item",{attrs:{label:"检查房间"}},[a("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},t._l(t.batchData.room,(function(e,i){return a("p",{key:i},[t._v(t._s(e))])})))]),a("item",{attrs:{label:"检查项",text:t.batchData.checkitem.length+"项"}}),a("item",{attrs:{label:"检查人"}},[a("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[a("check-user-contact",{attrs:{list:t.batchData.inspector}})],1)]),a("item",{attrs:{label:"抄送人"}},[a("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[a("check-user-contact",{attrs:{list:t.batchData.cc}})],1)]),a("item",{attrs:{label:"创建人"}},[a("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[a("check-user-contact",{attrs:{list:[t.batchData.create_user_info]}}),a("div",{staticClass:"color-light mt10"},[t._v(t._s(t._f("formatDate")(t.batchData.created_on)))])],1)])],1),t.editable&&!t.isLoading?a("app-button-group",{attrs:{direction:"row"}},[a("app-button",{directives:[{name:"track",rawName:"v-track",value:"现场检查-批次列表-删除批次",expression:"'现场检查-批次列表-删除批次'"}],attrs:{type:"operate"},on:{click:t.batchDelete}},[t._v("\n        删除\n      ")]),a("app-button",{attrs:{type:"operate"},on:{click:t.closeBatch}},[t._v("\n        关闭\n      ")]),a("app-button",{directives:[{name:"track",rawName:"v-track",value:"现场检查-批次列表-修改批次",expression:"'现场检查-批次列表-修改批次'"}],attrs:{type:"operate"},on:{click:t.batchEdit}},[t._v("\n        修改\n      ")])],1):t._e(),a("loading-status",{attrs:{"is-loading":t.isLoading}})],1)])}),[],!1,null,"243b20b0",null);e.default=s.exports},"788b":function(t,e,a){var i=a("8cca");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("44b486a8",i,!0,{sourceMap:!1,shadowMode:!1})},"8cca":function(t,e,a){var i=a("5454");(t.exports=a("690e")(!1)).push([t.i,".zjapp .item-user-unit[data-v-2ccee61c]{position:relative;display:inline-block;vertical-align:top;font-size:0}.zjapp .item-user-name[data-v-2ccee61c]{font-size:16px;display:inline-block;vertical-align:middle}.zjapp .icon-im-btn[data-v-2ccee61c]{position:relative;z-index:5;display:inline-block;vertical-align:middle;width:34px;height:22px;background:url("+i(a("f77a"))+") no-repeat 6px;background-size:16px 10px}.zjapp .popup-user-im[data-v-2ccee61c]{position:absolute;z-index:5;bottom:30px;left:50%;margin-left:-65px;padding:0 5px;width:130px;height:60px;background-color:rgba(0,0,0,.8);border-radius:5px}.zjapp .popup-user-im-item[data-v-2ccee61c]{float:left;width:60px;height:60px;text-align:center;color:#fff;padding-top:10px}.zjapp .popup-user-im-item.disabled[data-v-2ccee61c]{color:#666}.zjapp .popup-user-im-arrow[data-v-2ccee61c]{position:absolute;bottom:-5px;left:50%;margin-left:-5px;border:5px solid transparent;border-bottom:none;border-top-color:rgba(0,0,0,.8)}.zjapp .popup-user-im-icon[data-v-2ccee61c]{display:block;font-size:21px}.zjapp .popup-user-im-text[data-v-2ccee61c]{font-size:12px;line-height:16px;margin-top:4px}.zjapp .popup-user-posi-bottom[data-v-2ccee61c]{bottom:auto;top:30px}.zjapp .popup-user-posi-bottom .popup-user-im-arrow[data-v-2ccee61c]{top:-5px;bottom:auto;border-top:none;border-bottom:5px solid rgba(0,0,0,.8)}",""])},9864:function(t,e,a){"use strict";var i=a("cdce").a,o=(a("c509"),a("17cc")),s=Object(o.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"root"},[t.list.length?t._e():a("div",{staticClass:"item-user-unit"},[a("span",{staticClass:"item-user-name"},[t._v("\n      无\n    ")])]),t._l(t.list,(function(e,i){return a("div",{key:i,staticClass:"item-user-unit"},[a("span",{staticClass:"item-user-name"},[t._v("\n      "+t._s(e&&e.name?e.name:"")+"\n    ")]),a("div",{staticClass:"icon-im-btn",on:{click:function(a){if(a.stopPropagation(),a.target!==a.currentTarget)return null;t.openImPopup(e,a)}}},[t.popupOpenItemId===e.id?a("div",{staticClass:"popup-user-im",class:{"popup-user-posi-bottom":t.popupUserPosiBottom},style:{left:t.popupL}},[a("div",{directives:[{name:"track",rawName:"v-track",value:"公共-发起聊天",expression:"'公共-发起聊天'"}],staticClass:"popup-user-im-item",class:{disabled:t.isImDisabled(e)},on:{click:function(a){t.openIm(e)}}},[a("icon",{staticClass:"popup-user-im-icon",attrs:{name:"liaotian"}}),a("p",{staticClass:"popup-user-im-text"},[t._v("聊天")])],1),e.mobile&&t.userInfo.user_id!==e.id?a("a",{directives:[{name:"track",rawName:"v-track",value:"公共-打电话",expression:"'公共-打电话'"}],staticClass:"popup-user-im-item",attrs:{href:"tel:"+e.mobile}},[a("icon",{staticClass:"popup-user-im-icon",attrs:{name:"dianhua"}}),a("p",{staticClass:"popup-user-im-text"},[t._v("电话")])],1):a("div",{staticClass:"popup-user-im-item disabled"},[a("icon",{staticClass:"popup-user-im-icon",attrs:{name:"dianhua"}}),a("p",{staticClass:"popup-user-im-text"},[t._v("电话")])],1),a("div",{staticClass:"popup-user-im-arrow",style:{left:t.arrowL}})]):t._e()])])}))],2)}),[],!1,null,"2ccee61c",null);e.a=s.exports},c509:function(t,e,a){"use strict";a("788b")},cdce:function(t,e,a){"use strict";(function(t){a("cc57");var i=a("4360"),o=a("3bd5"),s=a("1601"),n=a("e2a7"),c=a("6f9e");e.a={name:"CheckUserContact",props:{list:{type:Array,default:function(){return[]}}},data:function(){return{popupOpenItemId:"",popupL:"50%",arrowL:"50%",popupUserPosiBottom:!1}},computed:{allowIM:function(){return window&&window.$rootScope&&window.$rootScope.allowIM},userInfo:function(){return o.a.getUser()}},created:function(){c.a.$on("pageContentClick",this.closeImPopup)},destroyed:function(){c.a.$off("pageContentClick",this.closeImPopup)},methods:{hasIm:function(t){return!!parseInt(t.is_im_user)},openImPopup:function(t,e){if($log.log("打开聊天窗口",t),c.a.$emit("pageContentClick"),this.popupOpenItemId=t.id,e&&e.target){var a=e.target.getBoundingClientRect(),o=window.innerWidth,s=i.a.state.app.isIOS?i.a.state.app.isIOSBezelLess?88:64:44;a.top<s+68?this.popupUserPosiBottom=!0:this.popupUserPosiBottom=!1,o-a.right<50?(this.popupL=16-(50-(o-a.right))+"px",this.arrowL=50-(o-a.right)+65+"px"):(this.popupL="50%",this.arrowL="50%")}},closeImPopup:function(){this.popupOpenItemId=""},openIm:function(e){var a=this.isImDisabled(e),i=this.allowIM&&!a;if(console.log(a,i,this.allowIM),i)if(t.has(e,"headimg_url")){var o=this.userInfo.tenant_code+"_"+e.id;s.a.openIm(o,e.name,e.headimg_url).catch((function(t){n.a.alert(t)}))}else s.a.openUserChat(e.id).catch((function(t){n.a.alert(t)}));else n.a.alert("聊天功能优化中暂不可用")},isImDisabled:function(t){return 1!==parseInt(t.is_im_user)||t.id===this.userInfo.user_id}}}}).call(this,a("391c"))},e988:function(t,e,a){"use strict";a("20e8")},f77a:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAeCAYAAABqpJ3BAAAAAXNSR0IArs4c6QAAAnlJREFUWAntmD1PFEEYx2dmbxUhd0eABAQsjAap0AIagYYYayWUxMaCaIJQGg1kQ0VNAdkY/QA0JH4AQyEdDRdB74xGQ4CYUABnJMfezsM8JHvKMs8ei4GdGDe57O3zMvP7z8vO7HBW5QIAPjmX65Oc93JgrcDY5Sop5+JW9ZY4Z5sCYGnqSdd7zhWNunhUbdPul2zRLz5mTNyKirtoHwD7lEnVvXk+cmNXUJVjy5sIj7yqJzqRDRktSoBsHuwHJgYof/J23rS4/GOH7AEc88lDRhMgIykAJ2x0evJeZCQFJPW2idMsyEgKiFNQkrH/BSTZ+li3tgdcF+ykwU5b/4mV2Jn5nPHs/acM2PXTFpJk3DEBL9y1q8LzRkHwxrhQtiXEw4G27o5r6Q7MLawXCwvvNpY9X0pdWXHjdWWgrbISO26u0y/740zwDBUcZR+6197TdbP+TiolbPw1N9S0NGQvidWvexu6vLjxujLQdjQHJuY+9B5IeKZ2eFeowGr2oOX/jNPZAr/Op7MF8dRdOK9W2iXIRzxiX0Qlm2AXjKd+qRXN+1sYHPPhMnS2IEbn09mCeOpuLb6d3b//YOyjD+XbaqN65o+VwvefWzjms3V2puyDt/ZtbxUnsVR7Xl3lceN1ZaCt8hZy3HyT55dGla2FCjbRXhGAcI67WXtQ3h7BDwYTYXVMxwRgwPw8WCvbuWHVOXd1CabZTggIAF/O5tzgv8l37V7IZOAw278rQI2tUlitac/ISPYAqEMk04DDPMhICsATsHCCac/ISArA4zvGZN406N88Mo+MpAA8e0xb6ddmipB5ZENGch0IlJpyuIsT9mjMhw53DwElT/W1PxsJFAAAAABJRU5ErkJggg=="}}]);