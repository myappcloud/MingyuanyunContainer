(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-384ac384"],{"121c":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .inventory-add[data-v-3cfdafe7]{position:absolute;width:100%;height:100%;display:flex;flex-direction:column}.zjapp .inventory-add .input[data-v-3cfdafe7]{width:62px;height:28px;border-radius:4px;margin-right:6px;border:1px solid #f4f4f4;padding:4px 8px}.zjapp .inventory-add .h-10[data-v-3cfdafe7]{height:10px;background:#f4f4f4}.zjapp .inventory-add .col-666[data-v-3cfdafe7]{color:#666;font-size:14px}.zjapp .inventory-add .bar-fixed-buttons[data-v-3cfdafe7]{background:#fff;padding:5px}.zjapp .inventory-add .btn .svg-loading[data-v-3cfdafe7]{margin:9px 10px 0 0}.zjapp .inventory-add .opacity[data-v-3cfdafe7]{opacity:.6}.zjapp .inventory-add .inventory-add_item[data-v-3cfdafe7]{display:flex;align-items:center;justify-content:flex-end}.zjapp .inventory-add .inventory-add_edit[data-v-3cfdafe7]{flex:1;overflow:auto}.zjapp .inventory-add[data-v-3cfdafe7] textarea{height:64px!important}.zjapp .inventory-add[data-v-3cfdafe7] .item-textarea{border-top:1px solid #f4f4f4;padding:10px 15px;box-sizing:content-box;margin-bottom:10px}.zjapp .inventory-add[data-v-3cfdafe7] .van-icon{border-radius:initial}.zjapp .inventory-add[data-v-3cfdafe7] .van-checkbox{display:flex;align-items:center}.zjapp .inventory-add[data-v-3cfdafe7] input{font-size:14px;text-align:center}.zjapp .inventory-add[data-v-3cfdafe7] .item-text{font-size:14px}.zjapp .inventory-add[data-v-3cfdafe7] .item.border-bottom:nth-child(4) .item-label{width:55%}.zjapp .inventory-add[data-v-3cfdafe7] .input.van-cell{border-color:#dcdcdc;box-shadow:none}.zjapp .inventory-add[data-v-3cfdafe7] .input.van-cell:after{content:none}.zjapp .inventory-add[data-v-3cfdafe7] .van-field__control{line-height:20px}",""])},2613:function(t,e,a){"use strict";(function(t){var n=a("28f8"),i=(a("9a33"),a("cc57"),a("f548"),a("163d"),a("4360")),r=a("07d2"),o=a("e68e"),s=a("3c64"),u=a("1b7e"),d=a("3122"),c=a("f97c"),l=a("fd50"),m=a("e2a7"),p=a("f3a3");e.a={name:"InventoryAdd",components:{Item:r.a,ItemImgList:o.a,ItemTextarea:s.a},data:function(){return{data:{used_quantity:"",occurrence_quantity:"",remainder_quantity:"",image_file:[],last_remark:"",remark:""}}},computed:{inventory:function(){var t=i.a.state.inventory.add;return{material_name:t.material_name||"添加材料盘点",inventory_time:(t.start_date||"开工")+" 至 "+t.end_date,quantity_unit:t.quantity_unit||"",remark:t.remark||"设计要求、情况说明等",id:t.id}},hide:function(){var t=this.inventory;return t.quantity_unit.length<=0||!t.id}},activated:function(){var t=this;if(u.a.getHasNetwork().then((function(e){return e||t.$toast("当前无网络！"),e})).catch((function(e){return t.$toast("当前无网络！"),e})),i.a.state.inventory.status){var e={used_quantity:"",remainder_quantity:"",image_file:[],occurrence_quantity:"",last_remark:i.a.state.inventory.add.last_remark||""};this.data=Object.assign(this.data,e),i.a.commit("inventory/SET_STATUS",!1)}},methods:{historyClick:function(){this.$router.push({name:"InventoryHistory",query:{id:this.inventory.id}}),i.a.commit("inventory/SET_STATUS",!1),i.a.commit("inventory/SET_HISTORYTITLE",this.inventory.material_name)},saveProblem:function(e){var a=this,n=[];t.each(e,(function(t){!t.url&&t.temp&&(delete t.sizeText,n.push(d.a.uploadImage(t.temp).then((function(n){return new Promise((function(i){var r=new Image;r.onload=function(){t.url=n,delete t.temp,a.$set(a.data.image_file,e,t)},i(),r.src=n}))})).catch((function(n){t.url=t.temp,t.statue=!0,a.$set(a.data.image_file,e,t)})))),t.videoTemp?(delete t.sizeText,n.push(d.a.uploadImage(t.videoTemp).then((function(n){return new Promise((function(i){var r=new Image;r.onload=function(){t.videoUrl=n,delete t.videoTemp,a.$set(a.data.image_file,e,t)},i(),r.src=n}))})).catch((function(n){t.videoUrl=t.videoTemp,t.statue=!0,a.$set(a.data.image_file,e,t)})))):(delete t.videoTemp,a.$set(a.data.image_file,e,t))}))},onImageRemove:function(t){var e=this.data.image_file;this.data=Object.assign(this.data,{image_file:e})},submitRequired:function(){var t=this.data,e=[t.occurrence_quantity,t.used_quantity,t.remainder_quantity],a=e[0],n=e[1],i=e[2];return Number(a)>=0&&Number(a)<=9999999.999&&""!==a||"0"===a?Number(n)>=0&&Number(n)<=9999999.999&&""!==n||"0"===n?Number(i)>=0&&Number(i)<=9999999.999&&""!==i||"0"===i?t.image_file.length>50?(this.$toast("图片需在50张以内！"),!1):t.last_remark.length<=0?(this.$toast("请填写备注！"),!1):this.submitIsInt():(this.$toast("现场剩余，请输入：0-9999999.999内数字！"),!1):(this.$toast("本期已施工设计用量，请输入：0-9999999.999内数字！"),!1):(this.$toast("本期进场，请输入：0-9999999.999内数字！"),!1)},submitIsInt:function(){var t=this;return u.a.getHasNetwork().then((function(e){return e?t.submitConfirmation():(t.$toast("当前无网络！"),!1)})).catch((function(e){return t.$toast("当前无网络！"),!1}))},submitConfirmation:function(){var t=this;return m.a.confirm({message:"确认提交？",okText:"提交",cancelText:"取消",className:"dialog-customize"},(function(){return t.submitUploadPicture()}))},submitUploadPicture:function(){var e=this,a=this.data,n=[];return console.log("提交数据",a),t.each(a.image_file,(function(t){t.statue||!t.url&&t.temp?(delete t.sizeText,n.push(d.a.uploadImage(t.temp).then((function(e){e&&(t.url=e,delete t.temp,delete t.statue,delete t.sizeText)})))):t.statue||t.videoTemp?(delete t.sizeText,n.push(d.a.uploadImage(t.videoTemp).then((function(e){e&&(t.videoUrl=e,delete t.videoTemp,delete t.statue,delete t.sizeText)})))):(delete t.videoTemp,delete t.sizeText)})),l.a.all(n).then((function(){return e.submitData()})).catch((function(t){return $log.error("图片上传失败：",t),!1}))},submitData:function(){var t=this,e=this.data,a={id:this.inventory.id,proj_id:c.a.getDefaultProject().id,occurrence_quantity:e.occurrence_quantity,used_quantity:e.used_quantity,remainder_quantity:e.remainder_quantity,remark:e.last_remark};return e.image_file&&e.image_file.length>0&&(a.images=JSON.stringify(e.image_file)),$log.log("paramse",a),Object(p.e)(a).then((function(e){return t.$router.replace({name:"InventoryDetail",query:{id:e.id}}),!1})).catch((function(e){return t.submitUploadPictureError(e)}))},submitUploadPictureError:function(t){var e=this;if("29002"!==String(t.errcode))return this.$toast(t.errmsg),!1;m.a.confirm({message:t.errmsg,okText:"查看"}).then((function(a){a?e.$router.replace({name:"InventoryDetail",query:{id:t.data.id}}):e.$router.go(-1)}))},inputChange:function(t){var e=this.data[t];if(e){var a=e.split("."),i=a[0]&&a[0].length>7,r=a[1]&&a[1].length>3;i&&(e=a[0].slice(0,7),a[1]&&(e=e+"."+a[1])),r&&(e=a[0]+"."+a[1].slice(0,3)),(i||r)&&(this.data=Object.assign(this.data,Object(n.a)({},t,e)))}}}}}).call(this,a("391c"))},"2c76":function(t,e,a){"use strict";a("c070")},"3c64":function(t,e,a){"use strict";a("163d");var n={name:"ItemTextarea",components:{},props:{value:{type:String,default:""},placeholder:{type:String,default:""},maxlength:{type:Number,default:200},borderBottom:{type:Boolean,default:!0}},data:function(){return{textareaHeight:40,isLock:!1,blurTime:null}},computed:{lastLength:function(){var t=this.value&&this.value.length||0,e=this.maxlength-t;return e>0?e:0}},mounted:function(){var t=this;this.$nextTick((function(){t.textareaHeight=t.$refs.rule&&t.$refs.rule.offsetHeight||40}))},methods:{onfocus:function(){var t=(new Date).getTime();this.blurTime&&t-this.blurTime<300&&window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(this.$refs.input.blur(),window.cordova.plugins.Keyboard.close()),this.blurTime=null,this.$emit("focus")},onblur:function(){this.blurTime=(new Date).getTime(),this.$emit("blur")},setStatus:function(t){console.log(t),this.isLock=t},oninput:function(t){var e=this;setTimeout((function(){if(!e.isLock){var a=t.target.value;a.length>e.maxlength&&(a=a.substring(0,e.maxlength),e.$refs.input.value=a),e.$refs.rule.innerText=a,e.textareaHeight=e.$refs.rule&&e.$refs.rule.offsetHeight+20,e.$emit("input",a),e.$emit("change",a)}}),0)}}},i=(a("2c76"),a("17cc")),r=Object(i.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"item-textarea",class:{"border-bottom":t.borderBottom}},[a("div",{staticClass:"item-textarea-content"},[a("textarea",{ref:"input",style:{height:t.textareaHeight+"px"},attrs:{placeholder:t.placeholder},domProps:{value:t.value},on:{focus:t.onfocus,blur:t.onblur,compositionstart:function(e){t.setStatus(!0)},compositionend:function(e){t.setStatus(!1)},input:t.oninput}}),a("div",{ref:"rule",staticClass:"rule"},[t._v("\n      "+t._s(t.value)+"\n    ")]),t.maxlength!==1/0?a("p",{staticClass:"counter"},[t._v("\n      "+t._s(t.lastLength)+"\n    ")]):t._e()])])}),[],!1,null,null,null);e.a=r.exports},"574c":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .item-textarea{background-color:#fff;padding:5px 15px}.zjapp .item-textarea-content{position:relative}.zjapp .item-textarea .rule,.zjapp .item-textarea textarea{width:100%;min-height:40px;line-height:20px;font-size:16px;padding:0;border:none}.zjapp .item-textarea .rule{position:absolute;top:0;left:0;visibility:hidden;word-break:break-all}.zjapp .item-textarea .counter{text-align:right;margin:0 0 -5px 0;height:15px;line-height:15px;color:#b2b2b2;font-size:12px}",""])},"8fc99":function(t,e,a){"use strict";a.r(e);var n=a("2613").a,i=(a("c0c4"),a("17cc")),r=Object(i.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-content",{attrs:{"show-go-root":!0,title:t.inventory.material_name}},[t.hide?t._e():a("div",{staticClass:"header-btn",attrs:{slot:"header-bar-right"},on:{click:t.historyClick},slot:"header-bar-right"},[t._v("历史")]),t.hide?t._e():a("div",{staticClass:"inventory-add"},[a("div",{staticClass:"inventory-add_edit"},[a("van-cell-group",[a("item",{attrs:{label:"材料",mode:"edit",text:t.inventory.material_name}}),a("item",{attrs:{label:"盘点时段",mode:"edit",text:t.inventory.inventory_time}}),a("item",{attrs:{label:"本期进场",mode:"edit"},on:{input:function(e){t.inputChange("occurrence_quantity")}}},[a("div",{staticClass:"item-con inventory-add_item",attrs:{slot:"right"},slot:"right"},[a("van-field",{staticClass:"input",attrs:{border:"",type:"number"},model:{value:t.data.occurrence_quantity,callback:function(e){t.$set(t.data,"occurrence_quantity",e)},expression:"data.occurrence_quantity"}}),a("span",{staticClass:"col-666"},[t._v(t._s(t.inventory.quantity_unit))])],1)]),a("item",{attrs:{label:"本期已施工设计用量",mode:"edit"},on:{input:function(e){t.inputChange("used_quantity")}}},[a("div",{staticClass:"item-con inventory-add_item",attrs:{slot:"right"},slot:"right"},[a("van-field",{staticClass:"input",attrs:{border:"",type:"number"},model:{value:t.data.used_quantity,callback:function(e){t.$set(t.data,"used_quantity",e)},expression:"data.used_quantity"}}),a("span",{staticClass:"col-666"},[t._v(t._s(t.inventory.quantity_unit))])],1)]),a("item",{attrs:{label:"现场剩余",mode:"edit"},on:{input:function(e){t.inputChange("remainder_quantity")}}},[a("div",{staticClass:"item-con inventory-add_item",attrs:{slot:"right"},slot:"right"},[a("van-field",{staticClass:"input",attrs:{border:"",type:"number"},model:{value:t.data.remainder_quantity,callback:function(e){t.$set(t.data,"remainder_quantity",e)},expression:"data.remainder_quantity"}}),a("span",{staticClass:"col-666"},[t._v(t._s(t.inventory.quantity_unit))])],1)])],1),a("div",{staticClass:"h-10"}),a("item",{staticClass:"p15"},[a("item-img-list",{attrs:{"allow-select-album":!0,maxlength:50,"online-mode":!0,"allow-buildin-album":!0},on:{callback:t.saveProblem,remove:t.onImageRemove},model:{value:t.data.image_file,callback:function(e){t.$set(t.data,"image_file",e)},expression:"data.image_file"}})],1),a("item-textarea",{attrs:{placeholder:"备注("+t.inventory.remark+")"},model:{value:t.data.last_remark,callback:function(e){t.$set(t.data,"last_remark",e)},expression:"data.last_remark"}})],1),a("app-button-group",{attrs:{"fixed-bottom":""}},[a("app-button",{attrs:{type:"submit","active-text":"提交中"},on:{click:t.submitRequired}},[t._v(" 提交 ")])],1)],1),a("loading-status",{attrs:{"is-empty":t.hide,"empty-text":"请先选择材料！"}})],1)}),[],!1,null,"3cfdafe7",null);e.default=r.exports},c070:function(t,e,a){var n=a("574c");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("35590dcb",n,!0,{sourceMap:!1,shadowMode:!1})},c0c4:function(t,e,a){"use strict";a("e590")},e590:function(t,e,a){var n=a("121c");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a("85cb").default)("ab07e56e",n,!0,{sourceMap:!1,shadowMode:!1})},f3a3:function(t,e,a){"use strict";a.d(e,"c",(function(){return i})),a.d(e,"e",(function(){return r})),a.d(e,"b",(function(){return o})),a.d(e,"a",(function(){return s})),a.d(e,"d",(function(){return u}));var n=a("162a");function i(t){return n.a.request("/online/material-inventory/list",t)}function r(t){return n.a.post("/online/material-inventory/save-data",null,t)}function o(t){return n.a.request("/online/material-inventory/history",t)}function s(t){return n.a.request("/online/material-inventory/detail",t)}function u(t){return n.a.post("/online/material-inventory/change-status",null,t)}}}]);