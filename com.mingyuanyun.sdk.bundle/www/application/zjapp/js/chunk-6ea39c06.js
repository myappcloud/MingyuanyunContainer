(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-6ea39c06","chunk-739f37c8"],{"02e7":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .build-in-photo{flex:1;display:flex;flex-direction:column;overflow:hidden}.zjapp .build-in-photo .circle-check,.zjapp .build-in-photo .circle-o{display:inline-block;width:18px;height:18px;border-radius:50%}.zjapp .build-in-photo .circle-o{border:1px solid #999}.zjapp .build-in-photo .circle-check{background-color:#4275e8;text-align:center;line-height:16px}.zjapp .build-in-photo .circle-check .icon{position:relative;color:#fff;font-size:10px}.zjapp .build-in-photo .photo-box .title-title{margin:0;padding:20px 15px 0;font-size:16px;font-weight:600;display:flex;justify-content:space-between;align-items:center}.zjapp .build-in-photo .photo-box .title-title .btn-select{margin-left:8px}.zjapp .build-in-photo .photo-box .photo-box__list{display:flex;flex-wrap:wrap}.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img{position:relative;width:calc(25% - 2px);margin-right:2px;margin-bottom:2px;height:89px}.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img:nth-child(4n){width:25%;margin-right:0}.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img .is_select,.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img .no_select{position:absolute;z-index:9;right:0;top:0;padding:4px;text-align:right}.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img .is_select .circle-o,.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img .no_select .circle-o{border-color:#fff;background-color:rgba(0,0,0,.4)}.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img img{width:100%;height:100%;-o-object-fit:cover;object-fit:cover}.zjapp .build-in-photo .tips{margin-top:30px;display:flex;align-items:center;justify-content:center}.zjapp .build-in-photo .tips .line-left,.zjapp .build-in-photo .tips .line-right{width:48px;height:1px;background-color:#e4e4e4}.zjapp .build-in-photo .tips .line-center{color:#c8c8c8;margin:6px}.zjapp .build-in-photo .photo-footer{flex-shrink:0;padding:15px;display:flex;justify-content:space-between;align-items:center;font-size:16px;background:#fff;border-top:1px solid #ececec}.zjapp .build-in-photo .photo-footer.index{justify-content:center;border-top:none}.zjapp .build-in-photo .photo-footer.index .img-take-pic{width:66px;height:66px}.zjapp .build-in-photo .photo-footer .tip-left{color:#666}.zjapp .build-in-photo .photo-footer .tip-right{color:#ff3c46}.zjapp .build-in-photo .photo-footer .tip-right.dis{opacity:.4}.zjapp .build-in-photo .photo-footer .tip-right-sure{width:68px;height:30px;line-height:30px;color:#fff}.zjapp .build-in-photo .photo-footer .tip-right-sure:disabled{opacity:.4}",""])},"6cb4":function(t,e,i){"use strict";var n,o,a=i("329b"),l=(i("e204"),i("4c09")),s=(i("6d57"),i("163d"),i("6f84"),i("6a61"),i("2e91")),r=i("915f"),c=i("04f3"),h=i("774b"),u=i("cc90"),p=i("e2a7"),g=i("6f9e"),d=i("4360"),f=i("3122"),m=i("4ad6"),b={name:"SelectPhoto",components:{Scroller:h.default},mixins:[r.a],data:function(){return{show:!1,viewSize:$rootScope.viewSize,isSelect:!1,isLoading:!1,imgList:[],selectList:[],selectImg:{},selectImgLength:0,callback:null,delCallback:null,doneLimit:36,allLength:0,backButtonEvent:null,queryProjId:""}},computed:{projId:function(){return d.a.state.global.currentProject.id}},created:function(){var t=this;this.resetData(),g.a.$on("listenSelectAppPhoto",(function(){t.resetData()}))},methods:{computedLength:function(){var t=0;for(var e in this.selectImg)this.selectImg[e]&&(t+=this.selectImg[e].imgs.filter((function(t){return t})).length);return t},openPopup:function(t){!0===window.__YL_SUPER_APP__||this.queryProjId!==this.projId?this.resetData():this.init(),this.show=!0,this.value=!0,this.isSelect=t.bool,this.callback=t.callback,this.delCallback=t.delCallback,this.backButtonEvent||(this.backButtonEvent=Object(c.a)(this.closePopup))},closePopup:function(){this.show=!1,this.value=!1,this.backButtonEvent&&(Object(c.c)(this.backButtonEvent),this.backButtonEvent=null)},resetData:function(){this.doneLimit=36,this.init(),this.getData(this.doneLimit)},init:function(){this.selectList=[],this.selectImg={},this.selectImgLength=0},getData:function(t){var e=this;return this.queryProjId=this.projId,u.a.getData(t).then((function(t){e.imgList=t,e.allLength=u.a.allLength}))},selectOneDayImg:(o=Object(s.a)(regeneratorRuntime.mark((function t(e,i){var n,o,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.selectImg[e],o=this.selectImgLength,t.next=4,u.a.getLocalImage().then((function(t){return t[i].imgs&&t[i].imgs.length||0}));case 4:a=t.sent,this.selectImg[e]={imgs:new Array(Number(a)).fill(!0),length:a,index:i},this.selectImgLength=this.computedLength(),this.isSelect&&u.a.maxImageLength<this.selectImgLength&&(p.a.alert("最多添加"+u.a.maxImageLength+"张照片"),this.selectImg[e]=n||{length:0,index:i,imgs:[]},this.selectImgLength=o);case 8:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)}),cancelOneDayImg:function(t,e){this.selectImg[t]={length:0,index:e,imgs:[]},this.selectImgLength=this.computedLength()},selectOneImg:function(t){if(this.isSelect&&u.a.maxImageLength<=this.selectImgLength)p.a.alert("最多添加"+u.a.maxImageLength+"张照片");else{this.selectImgLength++;var e=this.selectImg[t.date];e||(this.selectImg[t.date]=e={imgs:[],length:0}),e.index=t.pindex,e.length++,e.imgs[t.cindex]=!0}},cancelOneImg:function(t){this.selectImgLength--;var e=this.selectImg[t.date];e.length--,e.imgs[t.cindex]=!1},selectAll:(n=Object(s.a)(regeneratorRuntime.mark((function t(e){var i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.allLength){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,u.a.getLocalImage();case 4:t.sent.forEach((function(t,n){i.selectImg[t.date]={length:e?t.imgs.length:0,index:n,imgs:t.imgs.map((function(t){return e}))}})),this.selectImgLength=e?this.allLength:0;case 7:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)}),delSelectImg:function(){var t=this,e=this.selectImgLength;if(!(e<1)){var i=!1;e===this.allLength&&(i=!0),p.a.confirm("确定要删除"+e+"张图片吗？").then((function(e){e&&(t.getSelectList(),u.a.delImage(t.selectList).then((function(){if(i)return t.closePopup()})))}))}},addSelectImg:function(){var t=this,e=[];this.getSelectList(),u.a.getLocalImage().then((function(i){t.selectList.forEach((function(t){t.imageIndexList.forEach((function(n){e.push({temp:i[t.dateIndex].imgs[n].path,id:i[t.dateIndex].imgs[n].id})}))})),t.callback&&t.callback(e),t.closePopup()}))},getSelectList:function(){for(var t in this.selectList=[],this.selectImg){if(!this.selectImg[t])return;var e=this.selectImg[t].imgs.map((function(t,e){if(t)return e})).filter((function(t){return null!=t}));this.selectList.push({dateIndex:this.selectImg[t].index,imageIndexList:e})}},nextPage:function(){this.doneLimit+=28,this.getData(this.doneLimit)},showBigImage:function(t){console.log("path",t),u.a.getLocalImage().then((function(t){var e=[];return t.forEach((function(t){var i=t.imgs.map((function(t){return{temp:t.path}}));e.push.apply(e,Object(l.a)(i))})),e})).then((function(e){var i=e.findIndex((function(e){return e.temp===t})),n=f.a.convertImageList(e);m.a.openImageBrowser(n,i)})).catch((function(t){return $log.log("查看大图失败",t)}))}}},v=(i("8c54"),i("17cc")),x=Object(v.a)(b,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",[t.show?i("page-content",{attrs:{title:"APP相册",mode:"dialog","on-close":t.closePopup,"show-go-back":t.isSelect}},[t.isSelect?t._e():i("div",{staticClass:"header-btn",attrs:{slot:"header-bar-left"},on:{click:t.closePopup},slot:"header-bar-left"},[t._v("取消")]),t.isSelect?t._e():i("div",{staticClass:"header-btn",attrs:{slot:"header-bar-right"},slot:"header-bar-right"},[t.selectImgLength!=t.allLength||0==t.allLength?i("div",{staticClass:"buttons save-btn-items",on:{click:function(e){t.selectAll(!0)}}},[t._v("全选")]):i("div",{staticClass:"buttons save-btn-items",on:{click:function(e){t.selectAll(!1)}}},[t._v("取消全选")])]),i("div",{staticClass:"bg-white build-in-photo"},[i("scroller",{style:{height:t.viewSize.contentHeight-96+"px"},attrs:{"has-next":t.doneLimit<t.allLength},on:{loadNext:function(e){t.nextPage()}}},[t.imgList.length>0&&!t.isLoading?t._l(t.imgList,(function(e,n){return i("div",{key:e.id},[e.imgs.length>0?i("div",{staticClass:"photo-box"},[i("h3",{staticClass:"title-title"},[i("div",[t._v("\n                  "+t._s(t._f("sliceDate")(e.date))+"\n                  "),i("span",[t._v(t._s(e.week))])]),t.selectImg[e.date]&&t.selectImg[e.date].length===e.imgs.length?i("span",{staticClass:"circle-check",on:{click:function(i){t.cancelOneDayImg(e.date,n)}}},[i("i",{staticClass:"icon icon-qualified"})]):i("span",{staticClass:"circle-o",on:{click:function(i){t.selectOneDayImg(e.date,n)}}})]),i("div",{staticClass:"photo-box__list"},t._l(e.imgs,(function(o,a){return i("div",{key:o.id,staticClass:"thumb-img"},[t.selectImg[e.date]&&t.selectImg[e.date].imgs[a]?i("div",{staticClass:"is_select",on:{click:function(i){t.cancelOneImg({date:e.date,cindex:a})}}},[i("span",{staticClass:"circle-check"},[i("i",{staticClass:"icon icon-qualified"})])]):i("div",{staticClass:"no_select",on:{click:function(i){t.selectOneImg({pindex:n,date:e.date,cindex:a})}}},[i("span",{staticClass:"circle-o"})]),i("van-image",{attrs:{fit:"cover",src:t._f("fixImageUrl")(o.thumb||o.path),width:"100%",height:"100%","lazy-load":""},on:{click:function(e){t.showBigImage(o.path)}}},[i("template",{slot:"loading"},[i("i",{staticClass:"iconfont icon-tupianzhanweifu"}),i("br"),t._v("加载中\n                    ")]),i("template",{slot:"error"},[t._v("加载失败")])],2)],1)})))]):t._e()])})):t._e(),i("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.isLoading&&0==t.allLength,"empty-text":"暂无图片"}})],2),i("div",{staticClass:"photo-footer"},[i("span",{staticClass:"tip-left"},[t._v("已选"+t._s(t.selectImgLength)+"张")]),t.isSelect?i("button",{staticClass:"btn tip-right-sure",attrs:{disabled:t.selectImgLength<1},on:{click:function(e){t.addSelectImg()}}},[t._v("确定")]):i("span",{class:0===t.selectImgLength?"tip-right dis":"tip-right",on:{click:function(e){t.delSelectImg()}}},[t._v("删除")])])],1)]):t._e()],1)}),[],!1,null,null,null).exports,w=!1;w||(w=new(a.default.extend(x))({el:document.createElement("div")}),document.body.appendChild(w.$el));e.a=w},"774b":function(t,e,i){"use strict";i.r(e);var n=i("d18d").a,o=(i("b225"),i("17cc")),a=Object(o.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"scroll-warp",staticClass:"scroll-warp",class:{"scroll-warp-pulling":t.pulling,"scroll-warp-complete":!t.hasNext&&!t.isEmpty,"scroll-warp-empty":t.isEmpty},style:{"padding-bottom":t.numberKeyboardCoverHeight+"px"},on:{scroll:t.onScroll,touchstart:t.onTouchstart,touchmove:t.onTouchmove,touchend:t.onTouchend}},[t.allowPullDown?i("div",{staticClass:"pull-refresh-warp",style:{height:t.pullDist+"px"}},[i("div",{staticClass:"pull-refresh"},[i("div",{staticClass:"animation-refresher",class:{refreshing:t.refreshing}}),t.updateTime?i("p",{staticClass:"pull-refresh-date"},[t._v("最后成功同步："+t._s(t.updateTime))]):t._e()])]):t._e(),t._t("default"),t.loading?i("div",{staticClass:"page-loading"},[i("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[i("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]):t._e(),t.hasNext||t.isEmpty?t._e():[t.$slots.end?t._t("end"):t._e(),!t.$slots.end&&t.endText?i("div",{staticClass:"end-text"},[t._v("\n      "+t._s(t.endText)+"\n    ")]):t._e()]],2)}),[],!1,null,"2b1a346c",null);e.default=a.exports},"8c54":function(t,e,i){"use strict";i("e4e5")},"9d55":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,'.zjapp .scroll-warp[data-v-2b1a346c]{flex:1;overflow:auto;-webkit-overflow-scrolling:touch}.zjapp .scroll-warp-pulling[data-v-2b1a346c]{overflow:hidden}.zjapp .scroll-warp-complete[data-v-2b1a346c]:after{content:"";display:block;height:100px}.zjapp .scroll-warp-empty[data-v-2b1a346c]{display:flex;flex-direction:column}.zjapp .pull-refresh-warp[data-v-2b1a346c]{position:relative;height:0;overflow:hidden}.zjapp .pull-refresh[data-v-2b1a346c]{position:absolute;left:0;bottom:0;height:70px;width:100%;padding:6px;text-align:center}.zjapp .pull-refresh-date[data-v-2b1a346c]{margin-top:4px;height:16px;line-height:16px;font-size:12px;color:#bcbcbc}.zjapp .page-loading[data-v-2b1a346c]{padding:10px;text-align:center}.zjapp .end-text[data-v-2b1a346c]{color:#c8c8c8;background:#f4f4f4;position:relative;line-height:76px;height:76px;text-align:center}.zjapp .end-text[data-v-2b1a346c]:after,.zjapp .end-text[data-v-2b1a346c]:before{content:"";position:absolute;width:48px;height:1px;background:#e4e4e4;top:50%;margin-top:-1px}.zjapp .end-text[data-v-2b1a346c]:after{left:50%;transform:translateX(-92px)}.zjapp .end-text[data-v-2b1a346c]:before{right:50%;transform:translateX(90px)}.zjapp .end-slot[data-v-2b1a346c]{padding:30px;line-height:18px;text-align:center;color:#c8c8c8}',""])},b225:function(t,e,i){"use strict";i("ef48")},cc90:function(t,e,i){"use strict";i("6a61");var n,o,a=i("2e91"),l=i("4c09"),s=(i("c904"),i("6d57"),i("06a2"),i("4ad6")),r=i("7bac"),c=i("ed08"),h=i("6f9e"),u=i("4360"),p=i("c745"),g=i("a078"),d=i("6bf2"),f=i.n(d);function m(t){this.path=t.path,this.id=t.id,this.thumb=t.thumb}function b(t){this.imgs=[],this.date=t&&t.date,this.week=t&&t.week,this.now=t&&t.now}e.a={todayDate:"",week:["周一","周二","周三","周四","周五","周六","周日"],allLength:0,projectid:"",version:1,maxImageLength:3,getAllProjectImage:function(t){var e=this;this.version=1;var i=t.map((function(t){return e.getProjectImage(t.id)}));return i.push(this.getImageData()),Promise.all(i).then((function(t){if(t)return t.reduce((function(t,e){return[].concat(Object(l.a)(t),Object(l.a)(e))})).sort((function(t,e){return e.date>t.date?1:-1}))})).then((function(t){return t.reduce((function(t,e){var i,n=t[t.length-1];if(n&&n.date===e.date)return(i=n.imgs).push.apply(i,Object(l.a)(e.imgs)),t;return t.push(e),t}),[])}))},getLocalImage:function(){var t=this;return r.a.getUserKey("build-in-image").then((function(e){if(e&&e.version>0)return e.data;var i=u.a.state.global.allProjects;return i&&i.length?t.getAllProjectImage(i).then((function(e){return e&&e.length&&t.setLocalImage(e),e})):(t.version=-1,t.getImageData())}))},getImageData:function(){return r.a.getUserKey("build-in-image").then((function(t){return t?t.data:[]}))},getProjectImage:function(t){if(t)return r.a.getUserKey("build-in-image-"+t).then((function(t){return t||[]}))},getData:function(t){var e=this;return this.getLocalImage().then((function(i){if(!i||!i.length)return e.allLength=0,[];e.allLength=e.getAllLength(i);for(var n=[],o=0;o<i.length;o++){var a=i[o];if(a.imgs){if(!(a.imgs.length<t)){a.imgs=a.imgs.slice(0,t),n.push(a);break}n.push(a),t-=a.imgs.length}}return n}))},setLocalImage:function(t){var e={};return e.version=this.version,e.data=t,r.a.setUserKey("build-in-image",e).then((function(e){return $log.log("APP相册:更新"),h.a.$emit("listenAppPhoto"),h.a.$emit("listenSelectAppPhoto"),t}))},delImage:function(t){var e=this;return this.getLocalImage().then((function(i){return t.forEach((function(t){for(var e=i[t.dateIndex],n=t.imageIndexList,o=0;o<n.length;o++)s.a.deleteFile(e.imgs[n[o]].path),s.a.deleteFile(e.imgs[n[o]].thumb),delete e.imgs[n[o]];e.imgs=e.imgs.filter((function(t){return t}))})),e.setLocalImage(i)}))},addImage:(o=Object(a.a)(regeneratorRuntime.mark((function t(e){var i,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return $log.log("APP相册:添加",e),t.next=3,this.getLocalImage();case 3:return i=(i=t.sent)||[],n=this.getKey().date,(o=i[0])&&o.date===n||(this.addDate(i),o=i[0]),o.imgs.unshift(new m(e)),t.abrupt("return",this.setLocalImage(i));case 10:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)}),addDate:function(t){var e=new b(this.getKey(!0));t.unshift(e),e=null,this.delDate(t)},delDate:function(t){for(var e=Date.now()-7776e6,i=t.length;i>0;i--)t[i-1].now<e&&(t[i-1].imgs.forEach((function(t){return s.a.deleteFile(t.path)})),t.splice(i-1,1))},getKey:function(t){if(!this.todayDate||t){var e=f()((new Date).getTime()).utc().utcOffset("+08:00").locale("zh-cn");this.todayDate={week:this.week[e.weekday()],date:e.format("LL"),now:Date.now()}}return this.todayDate},getAllLength:function(t){var e=0;return t.forEach((function(t){e+=t.imgs&&t.imgs.length||0})),e},handelPicture:(n=Object(a.a)(regeneratorRuntime.mark((function t(e){var i,n,o,a,l,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,i=c.a.uuid(),n=s.a.appImagePath()+"internal-images/"+i+".jpg",t.next=6,s.a.copyFile(e,n);case 6:return t.next=8,s.a.createThumbnail(n,{width:270,height:270});case 8:return o=t.sent,t.next=11,p.a.getPictureAlbumSetting();case 11:if(!(a=t.sent)||!a.picture_saving_album){t.next=24;break}return l=cordova.file.externalRootDirectory+g.a.appName+"/",t.next=16,s.a.isFileExists(l);case 16:if(t.sent){t.next=19;break}return t.next=19,s.a.mkdir(l);case 19:return r=l+i+".jpg",t.next=22,s.a.copyFile(e,r);case 22:return t.next=24,s.a.saveImageToAlbum(r);case 24:return t.next=26,this.addImage({path:n,thumb:o,id:i});case 26:return t.abrupt("return",t.sent);case 29:t.prev=29,t.t0=t.catch(2),$log.log("添加照片失败",t.t0);case 32:case"end":return t.stop()}}),t,this,[[2,29]])}))),function(t){return n.apply(this,arguments)})}},d18d:function(t,e,i){"use strict";(function(t){i("2b45");var n,o=i("4360"),a=i("48f4"),l=i("162a"),s=i("e2a7"),r=i("a500"),c=i("6f9e"),h={};e.a={name:"Scroller",props:{buildingId:{type:String,default:""},hasNext:{type:Boolean,default:!1},isEmpty:{type:Boolean,default:!1},isSync:{type:Boolean,default:!0},endText:{type:String,default:""},memoryScrollTop:{type:Boolean,default:!0},keepScrollTop:{type:Boolean},hasPullDown:{type:Boolean,default:!0},onPullDown:{type:Function}},data:function(){return{pullDist:0,refreshing:!1,pulling:!1,loading:!1,scrollTop:0,isCurrKeyboard:!1,gapBottom:0}},computed:{allowPullDown:function(){return this.hasPullDown&&(!!this.$listeners.pullDown||!!this.onPullDown)},updateTime:function(){return o.a.state.global.businessDownloadTime},numberKeyboardCoverHeight:function(){return o.a.state.global.isNumberInputOpen?o.a.state.global.numberKeyboardHeight-this.gapBottom:0}},mounted:function(){var t=this;c.a.$on("numberKeyboardOpen",this.onNumberKeyboardOpen),this.$nextTick((function(){var e=t.$refs["scroll-warp"]&&t.$refs["scroll-warp"].getBoundingClientRect&&t.$refs["scroll-warp"].getBoundingClientRect();e&&(t.gapBottom=document.documentElement.clientHeight-e.bottom),t.$el&&t.$el.addEventListener("focus",(function(e){var i=e&&e.target,n=i&&i.tagName&&i.tagName.toLowerCase();if("input"===n||"textarea"===n){window.addEventListener("resize",(function e(){var n=i.getBoundingClientRect(),o=t.$el.getBoundingClientRect(),a=n.bottom-o.bottom;a>0&&t.scrollBy(a),window.removeEventListener("resize",e,!1)}),!1)}}),!0)}))},destroyed:function(){c.a.$off("numberKeyboardOpen",this.onNumberKeyboardOpen)},activated:function(){var t=this.keepScrollTop||this.$router.isBack&&this.memoryScrollTop;this.scrollTop&&t&&(this.$refs["scroll-warp"].scrollTop=this.scrollTop)},deactivated:function(){this.memoryScrollTop&&(this.scrollTop=this.$refs["scroll-warp"].scrollTop)},methods:{onScroll:function(t){var e=this,i=this.$refs["scroll-warp"].scrollTop,n=this.$refs["scroll-warp"].scrollHeight;if(i+this.$refs["scroll-warp"].clientHeight>=n-5&&!this.loading&&this.hasNext){this.loading=!0;var o=this.$listeners.loadNext();o&&o.then&&"function"==typeof o.then?o.then((function(){e.loading=!1})):this.loading=!1}this.$emit("scroll",t)},getTouchDiretion:function(t){if(!(h&&t&&t.touches&&t.touches[0]))return"";var e=t.touches[0].clientX,i=t.touches[0].clientY;return Math.abs(i-h.y)>Math.abs(e-h.x)&&Math.abs(i-h.y)>=3?i>h.y?"down":"up":""},onTouchstart:function(t){this.allowPullDown&&t.touches&&1===t.touches.length&&(h={x:t.touches[0].clientX,y:t.touches[0].clientY,scrollTop:this.$refs["scroll-warp"].scrollTop,pullDist:this.pullDist})},onTouchmove:function(t){if(this.allowPullDown&&t.touches&&1===t.touches.length){var e=this.$refs["scroll-warp"].scrollTop,i=t.touches[0].clientY,n=i-h.y,o=this.getTouchDiretion(t);"down"===o?!this.refreshing&&e<=0?(this.pulling=!0,this.pullDist=(n-h.scrollTop)/2,t.preventDefault()):this.pulling=!1:"up"===o?this.pullDist>0&&(this.pullDist=h.pullDist-(h.y-i),t.preventDefault()):this.pullDist=h.pullDist}},onTouchend:function(){var t=this;this.allowPullDown&&(h={},this.pulling=!1,this.pullDist>=70&&this.isSync?this.refreshing?this.makePullTo(70):this.makePullTo(70).then((function(){if(t.refreshing=!0,t.onPullDown){var e=t.onPullDown();e&&e.then&&"function"==typeof e?e.finally((function(){t.refreshing=!1,t.makePullTo(0)})):(t.refreshing=!1,t.makePullTo(0))}else t.dataSync().then((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")})).catch((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")}))})):(this.refreshing=!1,this.makePullTo(0)))},makePullTo:function(t){var e=this,i=this.pullDist,n=t,o=n-i,a=i;return i===n?Promise.resolve():new Promise((function(t){!function l(){window.requestAnimationFrame((function(){a+=o/6,e.pullDist=a,i<n&&a<n||i>n&&a>n?l():(e.pullDist=n,e.refreshing=!1,t())}))}()}))},dataSync:function(){var t,e=a.default.getCurrentModuleCode(),i=a.default.getCurrentRoute(),n=i.meta&&i.meta.isTodo;if(a.default.isModuleNeedBuilding(e)&&!n){if(!this.buildingId)return new Promise((function(t){setTimeout((function(){t()}),500)}));t=this.buildingId}return r.a.addTrack("公共-手动下拉刷新","",""),l.a.beginManualUpdate(),a.default.checkSync(t).then((function(t){return l.a.endManualUpdate(),t})).catch((function(t){$log.error("下拉刷新错误",t),t&&"Error: Network Error"===t.toString()?s.a.alert("当前网络无法同步数据"):s.a.alert(t),l.a.endManualUpdate()}))},getScrollHeight:function(){return this.$refs["scroll-warp"].offsetHeight},getScrollTop:function(){return this.$refs["scroll-warp"].scrollTop},setScrollTop:function(t){this.$refs["scroll-warp"].scrollTop=t},scrollBy:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,o=this.getScrollTop(),a=o+t,l=Math.round(i/16.7),s=t/l,r=o,c=n=+new Date;return o===a?Promise.resolve():new Promise((function(t){!function i(){window.requestAnimationFrame((function(){c===n&&(r+=s,e.$refs["scroll-warp"].scrollTop=r,o<a&&r<a||o>a&&r>a?i():(e.$refs["scroll-warp"].scrollTop=a,t()))}))}()}))},scrollTo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,i=this.getScrollTop(),n=t-i;return this.scrollBy(n,e)},scrollToEle:function(t){var e=t.keyboardHeight||232,i=(t=t.$el?t.$el:t).getBoundingClientRect(),n=this.$refs["scroll-warp"].getBoundingClientRect();if(i&&n){var a=document.documentElement.clientHeight-(o.a.state.global.isNumberInputOpen?e:0),l=n.bottom<a?n.bottom:a,s=n.top-i.top,r=i.bottom-l;s>0?this.scrollBy(-s-10):r>0&&this.scrollBy(r+10)}},isCurrent:function(e,i){var n=this;e.length&&t.each(e,(function(t){t._uid===i?n.isCurrKeyboard=!0:n.isCurrent(t.$children,i)}))},onNumberKeyboardOpen:function(t){this.isCurrKeyboard=!1,this.isCurrent(this.$children,t._uid),this.isCurrKeyboard&&this.scrollToEle(t)}}}}).call(this,i("391c"))},e4e5:function(t,e,i){var n=i("02e7");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,i("85cb").default)("3d0fec12",n,!0,{sourceMap:!1,shadowMode:!1})},ef48:function(t,e,i){var n=i("9d55");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,i("85cb").default)("a1a65c0c",n,!0,{sourceMap:!1,shadowMode:!1})}}]);