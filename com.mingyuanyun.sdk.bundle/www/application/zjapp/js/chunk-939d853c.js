(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-939d853c","chunk-739f37c8"],{"04f2":function(t,e,a){var i=a("90a0");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("067c3858",i,!0,{sourceMap:!1,shadowMode:!1})},"308d":function(t,e,a){"use strict";a("04f2")},"5db1":function(t,e,a){"use strict";a("fb25")},7274:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .custom-material-dialog[data-v-6fc312fe] .van-dialog__content{padding:20px}.zjapp .custom-material-dialog[data-v-6fc312fe] .van-dialog__content span{display:inline-block;color:#333;height:30px;line-height:30px;padding:0 13px;text-align:center;font-size:15px;border:1px solid #dcdcdc;border-radius:4px}.zjapp .custom-material-dialog[data-v-6fc312fe] .van-dialog__content span.checked{position:relative;border-color:#4275e8;color:#4275e8!important}.zjapp .custom-material-dialog[data-v-6fc312fe] .van-dialog__content span.checked:before{position:absolute;content:" ";display:block;border:1px solid #4275e8;border-top:none;border-right:none;width:8px;height:4px;transform:rotate(-45deg);right:3px;bottom:5px}.zjapp .custom-material-dialog[data-v-6fc312fe] .van-dialog__content .untis{margin:0 -3px}.zjapp .custom-material-dialog[data-v-6fc312fe] .van-dialog__content .untis span{padding:0;width:50px;margin:0 3px 5px 3px;font-size:14px;color:#666}.zjapp .custom-material-dialog[data-v-6fc312fe] .van-dialog__content p{padding:14px 0 10px 0;line-height:20px;color:#999;font-size:12px}.zjapp .custom-material-dialog[data-v-6fc312fe] .van-dialog__content p.error{color:#ff3d3d}.zjapp .custom-material-dialog .new-name[data-v-6fc312fe]{margin-top:10px}.zjapp .custom-material-dialog .new-name input[data-v-6fc312fe]{width:100%;height:40px;padding:10px;border-radius:0;font-size:14px;border:none;background-image:linear-gradient(180deg,#dcdcdc,#dcdcdc 66.6667%,transparent 0),linear-gradient(270deg,#dcdcdc,#dcdcdc 66.6667%,transparent 0),linear-gradient(0deg,#dcdcdc,#dcdcdc 66.6667%,transparent 0),linear-gradient(90deg,#dcdcdc,#dcdcdc 66.6667%,transparent 0);background-size:100% 1px,1px 100%,100% 1px,1px 100%;background-repeat:no-repeat;background-position:top,100% 0,bottom,0 0}.zjapp .custom-material-dialog .new-name.error input[data-v-6fc312fe]::-webkit-input-placeholder{color:#ff3d3d}',""])},"774b":function(t,e,a){"use strict";a.r(e);var i=a("d18d").a,s=(a("b225"),a("17cc")),r=Object(s.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"scroll-warp",staticClass:"scroll-warp",class:{"scroll-warp-pulling":t.pulling,"scroll-warp-complete":!t.hasNext&&!t.isEmpty,"scroll-warp-empty":t.isEmpty},style:{"padding-bottom":t.numberKeyboardCoverHeight+"px"},on:{scroll:t.onScroll,touchstart:t.onTouchstart,touchmove:t.onTouchmove,touchend:t.onTouchend}},[t.allowPullDown?a("div",{staticClass:"pull-refresh-warp",style:{height:t.pullDist+"px"}},[a("div",{staticClass:"pull-refresh"},[a("div",{staticClass:"animation-refresher",class:{refreshing:t.refreshing}}),t.updateTime?a("p",{staticClass:"pull-refresh-date"},[t._v("最后成功同步："+t._s(t.updateTime))]):t._e()])]):t._e(),t._t("default"),t.loading?a("div",{staticClass:"page-loading"},[a("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[a("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]):t._e(),t.hasNext||t.isEmpty?t._e():[t.$slots.end?t._t("end"):t._e(),!t.$slots.end&&t.endText?a("div",{staticClass:"end-text"},[t._v("\n      "+t._s(t.endText)+"\n    ")]):t._e()]],2)}),[],!1,null,"2b1a346c",null);e.default=r.exports},"86ac":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .text-area-border{border:1px solid #eee;border-bottom:null}",""])},"873c":function(t,e,a){"use strict";(function(t){a("5ab2"),a("e10e"),a("f548");var i=a("28f8"),s=(a("cc57"),a("6d57"),a("e697"),a("c0c3"),a("6a61"),a("2e91")),r=(a("fd50"),a("3bd5")),n=a("e2a7"),o=a("aab3"),l=a("5ff0"),c=a("0636"),u=a("c745"),p=a("3516"),d=a("6144"),h=a("bc69"),m=a("37d5"),f=a("59f8"),g=a("24de"),k=a("0136"),b=a("7bac"),v=a("a7c3"),w=a("07d2"),D=a("3c64"),y=a("5a71"),x=a("88c7"),_=a("cd05"),C=a("cd66"),T=a("f711"),S=a("f5bd");function O(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function $(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?O(Object(a),!0).forEach((function(e){Object(i.a)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):O(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var j,M,E,N,P,L,z,A,B,R={add:{allowSection:!0,allowMaterial:!0,allowPeople:!0,allowIsConstructerBtn:!0,allowIsNews:!0,allowSupplyOrderTaskVoide:!1},edit:{allowSection:!0,allowMaterial:!1,allowPeople:!0,allowIsConstructerBtn:!0,allowIsNews:!1,allowSupplyOrderTaskVoide:!1},preCreated:{allowSection:!0,allowMaterial:!1,allowPeople:!0,allowIsConstructerBtn:!1,allowIsNews:!0,allowSupplyOrderTaskVoide:!0}};e.a={name:"MaterialTaskForm",components:{Item:w.default,ItemTextarea:D.a,SingleSelect:y.a,UserSelect:_.a,MultiSelect:x.a,MaterialInfoSelect:C.a,MaterialTaskVoidDialog:T.a,MaterialTaskContract:S.a},props:{status:{type:String,default:"add"},model:{type:Object,default:function(){return{}}},saveTask:{type:Function,default:function(){}}},data:function(){return{allowSection:!0,allowMaterial:!0,allowPeople:!0,allowIsConstructerBtn:!0,allowIsNews:!0,allowSupplyOrderTaskVoide:!1,isAreaCheckOn:!1,allowCustomMaterialName:!1,allowCustomMaterialType:!1,UsingMaterialContract:!1,sectionOptions:[],ccList:[],supplierOptions:[],supplierData:{id:"-1",name:""},taskData:{checker:{},constructers:[]},typeList:[],showSupplier:!1}},computed:{statusComputed:function(){var t=this.$route.query.status;return t||(t=this.status),t},statusData:function(){return R[this.statusComputed]||{}},userData:function(){var t=r.a.getUser();return{id:t.user_id,name:t.user_name}},placeRequired:function(){return this.$store.state.global.isPlaceRequired.material},proj_id:function(){return this.$route.query.projId},supply_id:function(){var t=this.$route.query.supply_id;return t},allowSupplyOrder:function(){return Boolean(this.supply_id)||this.model.supplyData&&this.model.supplyData.id}},mounted:function(){this.$refs.materialTaskForm.scrollTop=0,this.initEdit()},activated:function(){this.initAdd(),this.initPreCreated()},methods:{init:(B=Object(s.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.result(),t.next=3,this.search();case 3:case"end":return t.stop()}}),t,this)}))),function(){return B.apply(this,arguments)}),setting:function(){var t=this.statusData,e=t.allowSection,a=t.allowMaterial,i=t.allowPeople,s=t.allowIsConstructerBtn,r=t.allowIsNews,n=t.allowSupplyOrderTaskVoide;console.log("status -----\x3e ",this.statusData),this.allowSection=e,this.allowMaterial=a,this.allowPeople=i,this.allowIsConstructerBtn=s,this.allowIsNews=r,this.allowSupplyOrderTaskVoide=n},result:function(){this.isAreaCheckOn=!1,this.taskData={id:"",material:{},materialType:[],place:"",supplier:{},contractor:{},receiver:{},needCheck:!1,areaCheckers:[],materialList:[],checkerList:[],needConstructer:!1}},search:(A=Object(s.a)(regeneratorRuntime.mark((function t(){var e,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.a.getUserKey(v.a.MATERIAL_NEED_CONSTRUCTER);case 2:return e=t.sent,this.taskData.needConstructer=Boolean(e),t.next=6,f.a.getValue("allow_add_material_via_app");case 6:return a=t.sent,this.allowCustomMaterialName="1"===a||"0"===a?"1"===a:"1"===JSON.parse(a).MATERIAL_NAME,t.next=10,f.a.getValue("allow_add_material_via_app");case 10:i=t.sent,this.allowCustomMaterialType="1"===i||"0"===i?"1"===i:"1"===JSON.parse(i).MATERIAL_TYPE,this.UsingMaterialContract=this.$store.state.global.allGrayRelease.UsingMaterialContract;case 13:case"end":return t.stop()}}),t,this)}))),function(){return A.apply(this,arguments)}),peopleList:(z=Object(s.a)(regeneratorRuntime.mark((function e(){var a,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.default.getCurrentUserProjectRoles();case 3:return a=e.sent,t.find(a,(function(t){if(32===t.role_type)return!0}))&&this.$set(this.taskData,"checker",this.userData),e.next=8,m.default.getProjectUsers(this.proj_id,[31,32,33]).then((function(t){i.taskData.checkerList=t}));case 8:return e.next=10,m.default.getProjectUsers(this.proj_id,[33]).then((function(t){i.taskData.constructerList=t}));case 10:return e.next=12,m.default.getProjectUsers(this.proj_id,[31,32,33]).then((function(t){i.ccList=t}));case 12:return e.next=14,f.a.getValue("allow_task_accept_together").then((function(t){i.taskData.sync=+t}));case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),$log.error("材料验收-新建任务时-获取初始数据-error ",e.t0);case 19:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(){return z.apply(this,arguments)}),supplierList:function(){var t=this,e=this.taskData.section&&this.taskData.section.id;if(e)return l.a.getContractorList(e).then((function(e){t.supplierOptions=e})).then((function(){var e=t.taskData.supplier;-1===e.id&&t.supplierOptions.unshift(e)})).then((function(){var e=t.taskData.contractor_id;e&&t.allowSupplyOrder&&(t.supplierOptions||[]).forEach((function(a){a.id===e&&t.$set(t.taskData,"supplier",{id:a.id,name:a.name})}))}))},loadContractorList:(L=Object(s.a)(regeneratorRuntime.mark((function e(a){var i,s,r,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null,e.next=3,u.a.allowGroupUserByConstructor();case 3:if(!e.sent){e.next=9;break}return s=a||this.taskData.receiver.id||this.userData.id,e.next=8,u.a.getOwnedContractorList(s);case 8:i=e.sent;case 9:if(i&&0!==i.length||!this.taskData.section||!this.taskData.section.id){e.next=13;break}return e.next=12,l.a.getContractorList(this.taskData.section.id);case 12:i=e.sent;case 13:this.$set(this.taskData,"contractorOptions",i||[]),r=t.find(i||[],(function(t){if(t.id===n.taskData.contractor.id)return!0})),i&&!r&&(this.taskData.contractor=t.clone(i[0]));case 16:case"end":return e.stop()}}),e,this)}))),function(t){return L.apply(this,arguments)}),showSupplierDialog:function(t){var e=this;t.stopPropagation?(t.stopPropagation(),this.supplierData=$({},this.taskData.supplier)):this.resetSupplierData(),this.showSupplier=!0,setTimeout((function(){e.$refs["textarea-supplier"].$refs.input.focus()}),50)},supplierSubmit:function(t,e){var a=this;if("confirm"===t){var i=this.supplierData.name=this.supplierData.name.trim();if(i.length<1)return e(!1);this.supplierOptions.some((function(t){if(t.name===i)return a.supplierData.id=t.id,!0})),this.taskData.supplier=$({},this.supplierData),this.$refs.singleSelectDialog.closePopup(),e()}else this.resetSupplierData(),e()},resetSupplierData:function(){this.supplierData={id:"-1",name:""}},onChangeMaterialType:function(e){this.loadAreaCheckers(this.taskData.section.id,t.map(e,"id"))},selectSection:(P=Object(s.a)(regeneratorRuntime.mark((function t(){var e,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.taskData.receiver=this.userData,t.next=3,p.a.getSectionList(this.proj_id);case 3:e=t.sent,this.sectionOptions=e,(a=(a=d.a.getObject(h.a.MATERIAL_DEFAULT_SECTION,d.a.level.user)||{})[this.proj_id])&&this.sectionOptions.forEach((function(t){a.id===t.id&&i.$set(i.taskData,"section",a)}));case 8:case"end":return t.stop()}}),t,this)}))),function(){return P.apply(this,arguments)}),materialTaskContractSelect:function(t){this.$set(this.taskData,"contract",t)},initAdd:(N=Object(s.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.setting(),"add"===this.statusComputed){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.init();case 5:return t.next=7,this.selectSection();case 7:this.taskData&&this.taskData.section&&this.taskData.section.id?this.changeSection():this.loadContractorList(),this.peopleList();case 9:case"end":return t.stop()}}),t,this)}))),function(){return N.apply(this,arguments)}),changeSection:function(){return this.allowIsNews&&(this.allowSupplyOrder||(this.$set(this.taskData,"material",{}),this.materialNameSelect()),this.$set(this.taskData,"supplier",{})),this.supplierList(),this.loadContractorList()},materialNameSelect:function(){var t=this;c.a.getSectionMaterial(this.taskData.section.id).then((function(e){t.taskData.materialList=e}))},materialTypeSelect:function(){var t=this;c.a.getSectionTypeList(this.taskData.section.id,this.taskData.material.id).then((function(e){t.typeList=e,t.taskData.materialType=null}))},loadAreaCheckers:function(t,e){var a=this;return e.length<1?(this.isAreaCheckOn=!1,void(this.taskData.areaCheckers=[])):o.a.getAreaCheckerSetting(t,e).then((function(t){a.isAreaCheckOn=t.isAreaCheckOn,t.isAreaCheckOn?a.taskData.areaCheckers=t.checkers:a.taskData.areaCheckers=[]}))},checkMaterialType:function(){var e=this.taskData.section,a=this.taskData.material;return t.isEmpty(e)?(n.a.alert("请先选择标段"),!1):t.isEmpty(a)?(n.a.alert("请先选择材料名称"),!1):void 0},checkSectionIsAvailable:function(){if(!this.taskData.section||!this.taskData.section.id||t.isEmpty(this.taskData.contractorOptions))return n.a.alert("请先选择标段"),!1},initEdit:(E=Object(s.a)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.setting(),"edit"===this.statusComputed){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.init();case 5:this.taskData=this.model.taskData,this.sectionOptions=this.model.sectionOptions,this.ccList=this.model.ccList,this.taskData.needConstructer=!!this.allowSupplyOrder||this.taskData.needConstructer,e="待申请进场"===this.model.batchData.status,this.allowSection=e,this.allowPeople=e,this.allowIsConstructerBtn=!this.allowSupplyOrder&&e,this.taskData.section&&this.taskData.section.id&&this.supplierList(),this.loadContractorList();case 15:case"end":return t.stop()}}),t,this)}))),function(){return E.apply(this,arguments)}),initPreCreated:(M=Object(s.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.setting(),"preCreated"===this.statusComputed){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,this.init();case 6:return this.taskData.needConstructer=!0,t.next=9,this.selectSection();case 9:return t.next=11,this.getSupplyAddTaskDetail();case 11:this.supplierList(),this.loadContractorList(),this.peopleList(),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),$log.error("材料验收-新建任务-初始化-甲供材：",t.t0);case 19:case"end":return t.stop()}}),t,this,[[0,16]])}))),function(){return M.apply(this,arguments)}),getSupplyAddTaskDetail:(j=Object(s.a)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.a.getSupplyAddTaskDetail(this.supply_id);case 2:e=t.sent,this.$set(this.taskData,"material",e.material),this.$set(this.taskData,"materialType",e.materialType),this.$set(this.taskData,"constructers",e.constructers),this.$set(this.taskData,"shipping_no",e.shipping_no),this.$set(this.taskData,"contractor_id",e.contractor_id),this.taskData.shipping_id=e.shipping_id,console.log("detail",this.taskData,e);case 10:case"end":return t.stop()}}),t,this)}))),function(){return j.apply(this,arguments)}),taskVoid:function(){this.$refs.materialTaskVoidDialog.show=!0},supplyOrderTaskVoid:function(t,e){var a=this;c.a.submitSupplyOrderTaskVoid({cancel_reason:t,id:this.supply_id}).then((function(){e(),a.$router.back()})).catch((function(){e(!1)}))},submit:function(){var e=this,a=t.cloneDeep(this.taskData);if(t.isEmpty(a.section)||!a.section.id)return n.a.alert("请选择所属标段"),!1;if(t.isEmpty(a.material)||!a.material.id)return n.a.alert("请选择材料"),!1;if(!a.supplier||!a.supplier.id)return n.a.alert("请选择材料供应商"),!1;if(this.placeRequired&&!a.place)return n.a.alert("请填写使用部位"),!1;if(t.isEmpty(a.contractor)||!a.contractor.id)return n.a.alert("请选择接收单位"),!1;if(t.isEmpty(a.checker)||!a.checker.id)return n.a.alert("请选择监理"),!1;if(t.isEmpty(a.constructers)&&a.needConstructer)return n.a.alert("请选择建设单位负责人"),!1;/^custom\-[\d]+$/.test(a.material.id)&&(a.material.id=""),a.materialType&&a.materialType.length&&t.each(a.materialType,(function(t){/^custom\-[\d]+$/.test(t.id)&&(t.id="")}));var i=d.a.getUserObject(h.a.MATERIAL_DEFAULT_SECTION)||{};i[this.proj_id]=this.taskData.section,d.a.saveUserObject(h.a.MATERIAL_DEFAULT_SECTION,i);var s=this.allowSupplyOrder?{shipping_id:this.taskData.shipping_id}:{};return g.a.checkHasNetwork(!0).then((function(){return c.a.addTask(e.proj_id,a,s).then((function(t){"preCreated"!==e.statusComputed&&b.a.setUserKey(v.a.MATERIAL_NEED_CONSTRUCTER,a.needConstructer),e.taskData.id=t})).then((function(){if(e.allowSupplyOrder){var t={id:e.supply_id,status:"待申请进场",task_id:e.taskData.id};return c.a.saveSupplyOrderData(t)}})).then((function(){return e.$router.replace("/material-index")})).then((function(){var t=e.taskData;return k.a.saveTodo({biz_id:t.id,module_code:"material",proj_id:t.section.proj_id,type:t.receiver.id===e.userData.id?1:2})})).catch((function(t){n.a.alert(t),$log.log("添加任务失败")}))})).catch((function(e){$log.error(e),t.isObject(e)&&!0===e.noNetwork&&n.a.alert("请在有网络的环境下新建任务")}))}}}}).call(this,a("391c"))},"8c64":function(t,e,a){"use strict";(function(t){var i=a("4c09"),s=(a("e697"),a("cc57"),a("5a71")),r=a("88c7"),n=a("6f9e"),o=a("e2a7"),l=a("a500");e.a={name:"MaterialInfoSelect",components:{SingleSelect:s.a,MultiSelect:r.a},props:{title:{type:String,default:""},value:{type:[Object,Array]},multi:{type:Boolean,default:!1},options:{type:Array,default:function(){return[]}},optionsDisabled:{type:Array,default:function(){return[]}},rightBtn:{type:String,default:""},customType:{type:String,default:"1"},grouping:{type:String,default:""},beforeOpen:{type:Function},standardUnit:{type:String,default:""},editabled:{type:Boolean,default:!0},formCheck:{type:Boolean,default:!1}},data:function(){return{selected:this.multi?[]:{},showCustom:!1,customMaterialCategory:"",customName:"",customMaterialUnit:"",customFormError:!1,materialCategory:[],units:[{id:"包",name:"包"},{id:"卷",name:"卷"},{id:"匹",name:"匹"},{id:"套",name:"套"},{id:"桶",name:"桶"},{id:"支",name:"支"},{id:"只",name:"只"},{id:"组",name:"组"},{id:"根",name:"根"},{id:"箱",name:"箱"},{id:"米",name:"米"},{id:"台",name:"台"},{id:"盏",name:"盏"},{id:"个",name:"个"},{id:"片",name:"片"},{id:"块",name:"块"},{id:"吨",name:"吨"},{id:"樘",name:"樘"},{id:"棵",name:"棵"},{id:"株",name:"株"},{id:"公斤",name:"公斤"},{id:"平方米",name:"平方米"},{id:"立方米",name:"立方米"},{id:"其它",name:"其它"}]}},watch:{value:function(t){this.selected=t},showCustom:function(t){var e=this;t&&this.$nextTick((function(){e.$refs["custom-input"].focus()}))}},mounted:function(){this.value&&(this.selected=this.value)},methods:{onHandleSelect:function(e){t.has(e,"num")&&(e.num=""),this.selected=e,this.$emit("input",e),this.$emit("onSelect",e),n.a.$emit("closeDialog")},showCustomDialog:function(t){this.customMaterialUnit=this.standardUnit,this.materialCategory=t,this.customMaterialCategory=t[0],this.showCustom=!0,l.a.addTrack("材料验收-手工添加材料".concat(this.title),"","")},selectMaterialCategory:function(t){this.customMaterialCategory=t},selectCustomMaterialUnit:function(t){this.customMaterialUnit=t.name},customSubmit:function(e,a){var s,r,n=this;if("confirm"===e){if(!this.customName)return this.customFormError=!0,a(!1);switch(this.customType){case"1":(r=t.find(this.options,(function(t){return t.name===n.customName})))?s=r:(s={id:"custom-"+(new Date).getTime(),name:this.customName,checked:!0},this.options.push(s));break;case"2":if(!this.customMaterialUnit)return this.customFormError=!0,a(!1);(r=t.find(this.options,(function(t){return t.name===n.customName})))?s=r:(s={id:"custom-"+(new Date).getTime(),name:this.customName,checked:!0,quantity_unit:this.customMaterialUnit},this.options.push(s));break;case"3":if(!this.customMaterialUnit)return this.customFormError=!0,a(!1);(r=t.find(this.options,(function(t){return t.name===n.customName&&t.category_name===n.customMaterialCategory})))?s=r:(s={id:"custom-"+(new Date).getTime(),name:this.customName,checked:!0,quantity_unit:this.customMaterialUnit,category_name:this.customMaterialCategory},this.options.push(s))}s.disabled?o.a.alert("“"+this.customName+"”已存在，且不可选"):this.multi?(this.selected=this.$refs.multiSelectDialog.getDialogValue(),this.$refs.multiSelectDialog.setDialogValue([].concat(Object(i.a)(this.selected),[s]))):this.onHandleSelect(s),this.resetData(),a()}else this.resetData(),a()},resetData:function(){this.showCustom=!1,this.customMaterialCategory="",this.customName="",this.customMaterialUnit="",this.customFormError=!1}}}}).call(this,a("391c"))},"8d46":function(t,e,a){"use strict";a.r(e);var i={name:"MaterialTastAdd",components:{TaskForm:a("b6c2").a}},s=a("17cc"),r=Object(s.a)(i,(function(){var t=this.$createElement,e=this._self._c||t;return e("page-content",{attrs:{title:"新建材料验收任务","show-go-root":!0}},[e("task-form")],1)}),[],!1,null,null,null);e.default=r.exports},"90a0":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .delivery-note_item[data-v-f9d9b95a]{margin:10px 0}.zjapp .wrap[data-v-f9d9b95a]{height:100%;padding-bottom:60px;overflow:auto}.zjapp .wrap[data-v-f9d9b95a] .item-label{width:40%}.zjapp .ctrl[data-v-f9d9b95a]{margin-top:15px}.zjapp .custom-material-dialog[data-v-f9d9b95a] .van-dialog__content{padding:20px}.zjapp .custom-material-dialog[data-v-f9d9b95a] .van-dialog__content span{display:inline-block;color:#333;height:30px;line-height:30px;padding:0 13px;text-align:center;font-size:15px;border:1px solid #dcdcdc;border-radius:4px}.zjapp .custom-material-dialog[data-v-f9d9b95a] .van-dialog__content span.checked{position:relative;border-color:#4275e8;color:#4275e8!important}.zjapp .custom-material-dialog[data-v-f9d9b95a] .van-dialog__content span.checked:before{position:absolute;content:" ";display:block;border:1px solid #4275e8;border-top:none;border-right:none;width:8px;height:4px;transform:rotate(-45deg);right:3px;bottom:5px}.zjapp .custom-material-dialog[data-v-f9d9b95a] .van-dialog__content>span{margin:0 5px 5px 0}',""])},"9d55":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .scroll-warp[data-v-2b1a346c]{flex:1;overflow:auto;-webkit-overflow-scrolling:touch}.zjapp .scroll-warp-pulling[data-v-2b1a346c]{overflow:hidden}.zjapp .scroll-warp-complete[data-v-2b1a346c]:after{content:"";display:block;height:100px}.zjapp .scroll-warp-empty[data-v-2b1a346c]{display:flex;flex-direction:column}.zjapp .pull-refresh-warp[data-v-2b1a346c]{position:relative;height:0;overflow:hidden}.zjapp .pull-refresh[data-v-2b1a346c]{position:absolute;left:0;bottom:0;height:70px;width:100%;padding:6px;text-align:center}.zjapp .pull-refresh-date[data-v-2b1a346c]{margin-top:4px;height:16px;line-height:16px;font-size:12px;color:#bcbcbc}.zjapp .page-loading[data-v-2b1a346c]{padding:10px;text-align:center}.zjapp .end-text[data-v-2b1a346c]{color:#c8c8c8;background:#f4f4f4;position:relative;line-height:76px;height:76px;text-align:center}.zjapp .end-text[data-v-2b1a346c]:after,.zjapp .end-text[data-v-2b1a346c]:before{content:"";position:absolute;width:48px;height:1px;background:#e4e4e4;top:50%;margin-top:-1px}.zjapp .end-text[data-v-2b1a346c]:after{left:50%;transform:translateX(-92px)}.zjapp .end-text[data-v-2b1a346c]:before{right:50%;transform:translateX(90px)}.zjapp .end-slot[data-v-2b1a346c]{padding:30px;line-height:18px;text-align:center;color:#c8c8c8}',""])},aa1f:function(t,e,a){var i=a("7274");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("5f53ac0f",i,!0,{sourceMap:!1,shadowMode:!1})},b225:function(t,e,a){"use strict";a("ef48")},b6c2:function(t,e,a){"use strict";var i=a("873c").a,s=(a("308d"),a("5db1"),a("17cc")),r=Object(s.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"materialTaskForm",staticClass:"wrap"},[t.taskData.shipping_no&&t.allowSupplyOrder?a("item",{staticClass:"delivery-note_item",attrs:{"text-style":{"text-align":"right"},text:t.taskData.shipping_no}},[a("div",{staticClass:"item-label",attrs:{slot:"left"},slot:"left"},[t._v("送货单")])]):t._e(),a("single-select",{attrs:{options:t.sectionOptions,editabled:t.allowSection,title:"所属标段"},on:{onSelect:t.changeSection},model:{value:t.taskData.section,callback:function(e){t.$set(t.taskData,"section",e)},expression:"taskData.section"}}),a("material-info-select",{attrs:{options:t.taskData.materialList,"before-open":t.checkSectionIsAvailable,editabled:t.allowMaterial,title:"材料名称",grouping:"category_name","right-btn":t.allowCustomMaterialName?"手工添加":"","custom-type":"3"},on:{onSelect:t.materialTypeSelect},model:{value:t.taskData.material,callback:function(e){t.$set(t.taskData,"material",e)},expression:"taskData.material"}}),t.taskData.material&&t.taskData.material.name?a("material-info-select",{ref:"selectMaterialType",attrs:{options:t.typeList,"before-open":t.checkMaterialType,multi:!0,"standard-unit":t.taskData.material.quantity_unit,editabled:t.allowMaterial,"custom-type":"2",title:"材料类型","right-btn":t.allowCustomMaterialType?"手工添加":"",required:!1},on:{onSelect:t.onChangeMaterialType},model:{value:t.taskData.materialType,callback:function(e){t.$set(t.taskData,"materialType",e)},expression:"taskData.materialType"}}):t._e(),a("single-select",{ref:"singleSelectDialog",attrs:{options:t.supplierOptions,"before-open":t.checkSectionIsAvailable,"right-btn":"手工添加","editor-add-data":!0,title:"材料供应商"},on:{rightBtnEvent:t.showSupplierDialog},model:{value:t.taskData.supplier,callback:function(e){t.$set(t.taskData,"supplier",e)},expression:"taskData.supplier"}}),a("item",{attrs:{label:"使用部位",border:"bottom",mode:"edit"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.taskData.place,expression:"taskData.place"}],staticClass:"input-align-r f16",attrs:{slot:"right",type:"text",placeholder:t.placeRequired?"必填":"选填"},domProps:{value:t.taskData.place},on:{input:function(e){e.target.composing||t.$set(t.taskData,"place",e.target.value)}},slot:"right"})]),t.UsingMaterialContract||t.taskData.contract&&t.taskData.contract.id?a("material-task-contract",{ref:"MaterialTaskContractRef",on:{onSelect:t.materialTaskContractSelect},model:{value:t.taskData.contract,callback:function(e){t.$set(t.taskData,"contract",e)},expression:"taskData.contract"}}):t._e(),a("item-textarea",{attrs:{"default-height":400,placeholder:"补充说明（选填）"},model:{value:t.taskData.remark,callback:function(e){t.$set(t.taskData,"remark",e)},expression:"taskData.remark"}}),a("div",{staticClass:"mt10"},[a("user-select",{attrs:{title:"接收人",options:t.ccList,editabled:t.allowPeople},model:{value:t.taskData.receiver,callback:function(e){t.$set(t.taskData,"receiver",e)},expression:"taskData.receiver"}}),a("single-select",{attrs:{options:t.taskData.contractorOptions,"before-open":t.checkSectionIsAvailable,title:"接收单位"},model:{value:t.taskData.contractor,callback:function(e){t.$set(t.taskData,"contractor",e)},expression:"taskData.contractor"}}),a("user-select",{attrs:{title:"监理",options:t.taskData.checkerList,editabled:t.allowPeople},model:{value:t.taskData.checker,callback:function(e){t.$set(t.taskData,"checker",e)},expression:"taskData.checker"}})],1),a("div",{staticClass:"mt10"},[t.allowIsConstructerBtn?a("item",{attrs:{label:"需建设单位验收",border:"bottom",mode:"edit"}},[a("div",{staticClass:"item-text align-r",attrs:{slot:"right"},slot:"right"},[a("van-switch",{model:{value:t.taskData.needConstructer,callback:function(e){t.$set(t.taskData,"needConstructer",e)},expression:"taskData.needConstructer"}})],1)]):t._e(),t.taskData.needConstructer?a("user-select",{attrs:{title:"建设单位验收人",options:t.taskData.constructerList,multi:!0,memory:!0,max:4,editabled:t.allowPeople},model:{value:t.taskData.constructers,callback:function(e){t.$set(t.taskData,"constructers",e)},expression:"taskData.constructers"}}):t._e(),t.isAreaCheckOn?a("user-select",{attrs:{title:"区域验收人",multi:!0,editabled:!1},model:{value:t.taskData.areaCheckers,callback:function(e){t.$set(t.taskData,"areaCheckers",e)},expression:"taskData.areaCheckers"}}):t._e(),a("user-select",{attrs:{title:"抄送人",options:t.ccList,multi:!0,required:!1,editabled:t.allowPeople},model:{value:t.taskData.cc,callback:function(e){t.$set(t.taskData,"cc",e)},expression:"taskData.cc"}}),t.allowIsNews?t._e():a("user-select",{attrs:{title:"创建人",editabled:!1},model:{value:t.taskData.creater,callback:function(e){t.$set(t.taskData,"creater",e)},expression:"taskData.creater"}})],1),t.taskData.sendback_reason&&t.allowSupplyOrder?a("item",{attrs:{"text-style":{"text-align":"right"},text:t.taskData.sendback_reason}},[a("div",{staticClass:"item-label",attrs:{slot:"left"},slot:"left"},[t._v("退回原因")])]):t._e(),a("app-button-group",{staticClass:"ctrl",attrs:{direction:"column"}},[t.allowIsNews?a("app-button",{on:{click:t.submit}},[t._v("提交")]):a("app-button",{on:{click:t.saveTask}},[t._v("保存")]),t.allowSupplyOrder&&t.allowSupplyOrderTaskVoide?a("app-button",{attrs:{type:"warning",plain:"",rimless:""},on:{click:t.taskVoid}},[t._v("任务作废")]):t._e()],1),a("van-dialog",{attrs:{"show-cancel-button":"","get-container":"body","cancel-button-color":"#666","class-name":"custom-material-dialog","before-close":t.supplierSubmit},model:{value:t.showSupplier,callback:function(e){t.showSupplier=e},expression:"showSupplier"}},[a("div",[a("item-textarea",{ref:"textarea-supplier",staticClass:"text-area-border",attrs:{placeholder:"请输入材料供应商名称",maxlength:20},model:{value:t.supplierData.name,callback:function(e){t.$set(t.supplierData,"name",e)},expression:"supplierData.name"}})],1)]),a("material-task-void-dialog",{ref:"materialTaskVoidDialog",on:{submit:t.supplyOrderTaskVoid}})],1)}),[],!1,null,"f9d9b95a",null);e.a=r.exports},cd66:function(t,e,a){"use strict";var i=a("8c64").a,s=(a("e9d7"),a("17cc")),r=Object(s.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[t.multi?a("multi-select",{ref:"multiSelectDialog",attrs:{options:t.options,title:t.title,"right-btn":t.rightBtn,editabled:t.editabled},on:{onSelect:t.onHandleSelect,rightBtnEvent:t.showCustomDialog},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},[t._t("default")],2):a("single-select",{ref:"singleSelectDialog",attrs:{options:t.options,"options-disabled":t.optionsDisabled,title:t.title,"right-btn":t.rightBtn,grouping:t.grouping,"auto-open":!0,"before-open":t.beforeOpen,"standard-unit":t.standardUnit,editabled:t.editabled,"form-check":t.formCheck},on:{onSelect:t.onHandleSelect,rightBtnEvent:t.showCustomDialog},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),a("van-dialog",{attrs:{"show-cancel-button":"","get-container":"body","class-name":"custom-material-dialog","cancel-button-color":"#666","before-close":t.customSubmit},model:{value:t.showCustom,callback:function(e){t.showCustom=e},expression:"showCustom"}},[a("div",{on:{click:function(){t.$refs["custom-input"].blur()}}},["3"===t.customType?t._l(t.materialCategory,(function(e,i){return a("span",{key:"cate-"+i,staticClass:"mr5 mb5",class:t.customMaterialCategory===e?"checked":"",on:{click:function(a){t.selectMaterialCategory(e)}}},[t._v(t._s(e))])})):t._e(),a("div",{class:{"new-name":!0,error:t.customFormError&&!t.customName}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.customName,expression:"customName"}],ref:"custom-input",attrs:{placeholder:"请输入"+t.title,maxlength:"20"},domProps:{value:t.customName},on:{click:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.customName=e.target.value)}}})]),"2"===t.customType||"3"===t.customType?[a("p",{class:{error:t.customFormError&&!t.customMaterialUnit}},[t._v("请选择数量单位")]),a("div",{staticClass:"untis"},t._l(t.units,(function(e,i){return a("span",{key:"unit-"+i,class:t.customMaterialUnit===e.name?"checked":"",on:{click:function(a){t.selectCustomMaterialUnit(e)}}},[t._v(t._s(e.name))])})))]:t._e()],2)])],1)}),[],!1,null,"6fc312fe",null);e.a=r.exports},d18d:function(t,e,a){"use strict";(function(t){a("2b45");var i,s=a("4360"),r=a("48f4"),n=a("162a"),o=a("e2a7"),l=a("a500"),c=a("6f9e"),u={};e.a={name:"Scroller",props:{buildingId:{type:String,default:""},hasNext:{type:Boolean,default:!1},isEmpty:{type:Boolean,default:!1},isSync:{type:Boolean,default:!0},endText:{type:String,default:""},memoryScrollTop:{type:Boolean,default:!0},keepScrollTop:{type:Boolean},hasPullDown:{type:Boolean,default:!0},onPullDown:{type:Function}},data:function(){return{pullDist:0,refreshing:!1,pulling:!1,loading:!1,scrollTop:0,isCurrKeyboard:!1,gapBottom:0}},computed:{allowPullDown:function(){return this.hasPullDown&&(!!this.$listeners.pullDown||!!this.onPullDown)},updateTime:function(){return s.a.state.global.businessDownloadTime},numberKeyboardCoverHeight:function(){return s.a.state.global.isNumberInputOpen?s.a.state.global.numberKeyboardHeight-this.gapBottom:0}},mounted:function(){var t=this;c.a.$on("numberKeyboardOpen",this.onNumberKeyboardOpen),this.$nextTick((function(){var e=t.$refs["scroll-warp"]&&t.$refs["scroll-warp"].getBoundingClientRect&&t.$refs["scroll-warp"].getBoundingClientRect();e&&(t.gapBottom=document.documentElement.clientHeight-e.bottom),t.$el&&t.$el.addEventListener("focus",(function(e){var a=e&&e.target,i=a&&a.tagName&&a.tagName.toLowerCase();if("input"===i||"textarea"===i){window.addEventListener("resize",(function e(){var i=a.getBoundingClientRect(),s=t.$el.getBoundingClientRect(),r=i.bottom-s.bottom;r>0&&t.scrollBy(r),window.removeEventListener("resize",e,!1)}),!1)}}),!0)}))},destroyed:function(){c.a.$off("numberKeyboardOpen",this.onNumberKeyboardOpen)},activated:function(){var t=this.keepScrollTop||this.$router.isBack&&this.memoryScrollTop;this.scrollTop&&t&&(this.$refs["scroll-warp"].scrollTop=this.scrollTop)},deactivated:function(){this.memoryScrollTop&&(this.scrollTop=this.$refs["scroll-warp"].scrollTop)},methods:{onScroll:function(t){var e=this,a=this.$refs["scroll-warp"].scrollTop,i=this.$refs["scroll-warp"].scrollHeight;if(a+this.$refs["scroll-warp"].clientHeight>=i-5&&!this.loading&&this.hasNext){this.loading=!0;var s=this.$listeners.loadNext();s&&s.then&&"function"==typeof s.then?s.then((function(){e.loading=!1})):this.loading=!1}this.$emit("scroll",t)},getTouchDiretion:function(t){if(!(u&&t&&t.touches&&t.touches[0]))return"";var e=t.touches[0].clientX,a=t.touches[0].clientY;return Math.abs(a-u.y)>Math.abs(e-u.x)&&Math.abs(a-u.y)>=3?a>u.y?"down":"up":""},onTouchstart:function(t){this.allowPullDown&&t.touches&&1===t.touches.length&&(u={x:t.touches[0].clientX,y:t.touches[0].clientY,scrollTop:this.$refs["scroll-warp"].scrollTop,pullDist:this.pullDist})},onTouchmove:function(t){if(this.allowPullDown&&t.touches&&1===t.touches.length){var e=this.$refs["scroll-warp"].scrollTop,a=t.touches[0].clientY,i=a-u.y,s=this.getTouchDiretion(t);"down"===s?!this.refreshing&&e<=0?(this.pulling=!0,this.pullDist=(i-u.scrollTop)/2,t.preventDefault()):this.pulling=!1:"up"===s?this.pullDist>0&&(this.pullDist=u.pullDist-(u.y-a),t.preventDefault()):this.pullDist=u.pullDist}},onTouchend:function(){var t=this;this.allowPullDown&&(u={},this.pulling=!1,this.pullDist>=70&&this.isSync?this.refreshing?this.makePullTo(70):this.makePullTo(70).then((function(){if(t.refreshing=!0,t.onPullDown){var e=t.onPullDown();e&&e.then&&"function"==typeof e?e.finally((function(){t.refreshing=!1,t.makePullTo(0)})):(t.refreshing=!1,t.makePullTo(0))}else t.dataSync().then((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")})).catch((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")}))})):(this.refreshing=!1,this.makePullTo(0)))},makePullTo:function(t){var e=this,a=this.pullDist,i=t,s=i-a,r=a;return a===i?Promise.resolve():new Promise((function(t){!function n(){window.requestAnimationFrame((function(){r+=s/6,e.pullDist=r,a<i&&r<i||a>i&&r>i?n():(e.pullDist=i,e.refreshing=!1,t())}))}()}))},dataSync:function(){var t,e=r.default.getCurrentModuleCode(),a=r.default.getCurrentRoute(),i=a.meta&&a.meta.isTodo;if(r.default.isModuleNeedBuilding(e)&&!i){if(!this.buildingId)return new Promise((function(t){setTimeout((function(){t()}),500)}));t=this.buildingId}return l.a.addTrack("公共-手动下拉刷新","",""),n.a.beginManualUpdate(),r.default.checkSync(t).then((function(t){return n.a.endManualUpdate(),t})).catch((function(t){$log.error("下拉刷新错误",t),t&&"Error: Network Error"===t.toString()?o.a.alert("当前网络无法同步数据"):o.a.alert(t),n.a.endManualUpdate()}))},getScrollHeight:function(){return this.$refs["scroll-warp"].offsetHeight},getScrollTop:function(){return this.$refs["scroll-warp"].scrollTop},setScrollTop:function(t){this.$refs["scroll-warp"].scrollTop=t},scrollBy:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,s=this.getScrollTop(),r=s+t,n=Math.round(a/16.7),o=t/n,l=s,c=i=+new Date;return s===r?Promise.resolve():new Promise((function(t){!function a(){window.requestAnimationFrame((function(){c===i&&(l+=o,e.$refs["scroll-warp"].scrollTop=l,s<r&&l<r||s>r&&l>r?a():(e.$refs["scroll-warp"].scrollTop=r,t()))}))}()}))},scrollTo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=this.getScrollTop(),i=t-a;return this.scrollBy(i,e)},scrollToEle:function(t){var e=t.keyboardHeight||232,a=(t=t.$el?t.$el:t).getBoundingClientRect(),i=this.$refs["scroll-warp"].getBoundingClientRect();if(a&&i){var r=document.documentElement.clientHeight-(s.a.state.global.isNumberInputOpen?e:0),n=i.bottom<r?i.bottom:r,o=i.top-a.top,l=a.bottom-n;o>0?this.scrollBy(-o-10):l>0&&this.scrollBy(l+10)}},isCurrent:function(e,a){var i=this;e.length&&t.each(e,(function(t){t._uid===a?i.isCurrKeyboard=!0:i.isCurrent(t.$children,a)}))},onNumberKeyboardOpen:function(t){this.isCurrKeyboard=!1,this.isCurrent(this.$children,t._uid),this.isCurrKeyboard&&this.scrollToEle(t)}}}}).call(this,a("391c"))},e9d7:function(t,e,a){"use strict";a("aa1f")},ef48:function(t,e,a){var i=a("9d55");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("a1a65c0c",i,!0,{sourceMap:!1,shadowMode:!1})},fb25:function(t,e,a){var i=a("86ac");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("23902f6f",i,!0,{sourceMap:!1,shadowMode:!1})}}]);