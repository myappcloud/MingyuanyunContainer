(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-45f61240"],{"08d4":function(t,e,o){"use strict";o("3880")},"2c4c":function(t,e,o){"use strict";o.r(e);var a=o("7361").a,n=(o("f6c3"),o("17cc")),r=Object(n.a)(a,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{class:{"list-empty":t.isLoading||!t.listData||!t.listData.length}},[!t.isLoading&&t.listData.length?[t._m(0),o("tree-base",{attrs:{data:t.listData,"indent-size":10,"memory-open-set":!0,"default-open-level":1/0},on:{onClickNode:t.onClickNode},scopedSlots:t._u([{key:"left",fn:function(e){return o("div",{staticClass:"tree-text"},[t._v(t._s(e.data.template_name))])}},{key:"right",fn:function(e){return[o("div",{staticClass:"tree-weight"},[t._v(t._s(e.data.weight)+"%")]),o("div",{staticClass:"tree-score"},[t._v("\n          "+t._s(e.data.score||("检查完毕"===t.batchData.status&&"检查中"===e.data.status?"已甩项":""))+"\n        ")]),100===e.data.template_mode?o("icon",{staticClass:"tree-icon-tips",attrs:{name:"yiwen"},on:{click:function(o){o.stopPropagation(),t.formulaTips(e.data)}}}):t._e(),100!==e.data.template_mode?o("icon",{staticClass:"tree-icon-arrow",attrs:{name:"检查完毕"===t.batchData.status&&"检查中"===e.data.status?"":"arrow-right"}}):t._e()]}}])}),"检查完毕"===t.batchData.status?o("div",{staticClass:"p15 color-gray3 align-c"},[t._v("\n      "+t._s(t._f("formatDate")(t.batchData.modified_on))+" "+t._s(t.batchData.created_by_name)+" 提交检查完毕\n    ")]):t._e(),t.isBatchCreator&&"检查完毕"!==t.batchData.status?o("app-button-group",{staticClass:"mt20"},[o("app-button",{on:{click:t.submitBatch}},[t._v("\n        检查完毕并提交\n      ")])],1):t._e()]:t._e(),o("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.listData.length,"empty-text":"暂无数据"}})],2)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tree-header border-bottom"},[e("div",{staticClass:"tree-header-template"},[this._v("评分表")]),e("div",{staticClass:"tree-header-weight"},[this._v("权重")]),e("div",{staticClass:"tree-header-score"},[this._v("得分")])])}],!1,null,"4499ded3",null);e.default=r.exports},3880:function(t,e,o){var a=o("b66d");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,o("85cb").default)("1e2c6191",a,!0,{sourceMap:!1,shadowMode:!1})},"3c77":function(t,e,o){"use strict";o("9dd9"),o("f548");var a=o("28f8"),n=(o("163d"),o("7bac")),r=o("4360");n.a.getUserObject("tree-base-open-set-memory").then((function(t){r.a.commit("components/SET_TREE_BASE_OPEN_SET",t||{})}));var i={name:"TreeBase",props:{data:{type:Array,default:function(){return[]}},keyword:{type:String,default:""},level:{type:Number,default:0},iconPosition:{type:String,default:"left"},indentSize:{type:Number,default:14},memoryOpenSet:{type:Boolean,default:!1},defaultOpenLevel:{type:Number,default:0},hasSlotLeft:{type:Boolean,default:!1},hasSlotRight:{type:Boolean,default:!1},listStyle:{type:Object,default:function(){return{}}},nodeStyle:{type:Object,default:function(){return{}}},textStyle:{type:Object,default:function(){return{}}}},data:function(){return{selfOpenSet:{}}},computed:{openSet:function(){return this.memoryOpenSet?r.a.state.components.treeBaseOpenSet:this.selfOpenSet},showSlotLeft:function(){return this.level?this.hasSlotLeft:!!this.$scopedSlots.left},showSlotRight:function(){return this.level?this.hasSlotRight:!!this.$scopedSlots.right}},methods:{itemClick:function(t){if(t.children&&t.children.length){if(this.memoryOpenSet)!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},r.a.state.components.treeBaseOpenSet,t);r.a.commit("components/SET_TREE_BASE_OPEN_SET",e),n.a.saveUserObject("tree-base-open-set-memory",e)}(Object(a.a)({},t.id,!this.isNodeOpen(t.id)));else this.$set(this.selfOpenSet,t.id,!this.isNodeOpen(t.id));this.$emit("onClickFoldNode",t)}else this.$emit("onClickEndNode",t);this.$emit("onClickNode",t)},isNodeOpen:function(t){return void 0===this.openSet[t]?this.level<this.defaultOpenLevel:this.openSet[t]},onClickNode:function(t){this.$emit("onClickNode",t)},onClickFoldNode:function(t){this.$emit("onClickFoldNode",t)},onClickEndNode:function(t){this.$emit("onClickEndNode",t)},keywordFilter:function(t){return this.keyword?t.replace(new RegExp(this.keyword,"gm"),'<span class="color-blue">'+this.keyword+"</span>"):t}}},c=(o("08d4"),o("17cc")),l=Object(c.a)(i,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"tree-con"},t._l(t.data,(function(e){return o("div",{key:e.id,staticClass:"tree-list",style:Object.assign({},t.listStyle["level-all"],t.listStyle["level-"+t.level])},[o("div",{staticClass:"tree-node border-bottom",class:"tree-node-level-"+t.level,style:Object.assign({},t.nodeStyle["level-all"],t.nodeStyle["level-"+t.level]),on:{click:function(o){t.itemClick(e)}}},[o("div",{staticClass:"tree-indent",style:{width:t.indentSize*t.level+"px"}}),"left"===t.iconPosition?o("div",{staticClass:"tree-icon",class:{"icon-dropdown":e.children&&e.children.length&&(void 0===t.openSet[e.id]?t.level<t.defaultOpenLevel:t.openSet[e.id]),"icon-dropright":e.children&&e.children.length&&!(void 0===t.openSet[e.id]?t.level<t.defaultOpenLevel:t.openSet[e.id])}}):t._e(),o("div",{staticClass:"tree-main"},[t.showSlotLeft?t._t("left",null,{data:e}):o("div",{staticClass:"tree-text",style:Object.assign({},t.textStyle["level-all"],t.textStyle["level-"+t.level]),domProps:{innerHTML:t._s(t.keywordFilter(e.name))}})],2),t.showSlotRight?t._t("right",null,{data:e}):t._e(),"right"===t.iconPosition&&e.children&&e.children.length?o("icon",{staticClass:"icon-right",attrs:{name:(void 0===t.openSet[e.id]?t.level<t.defaultOpenLevel:t.openSet[e.id])?"arrow-up":"arrow-down"}}):t._e()],2),t._t("siblings",null,{data:e}),e.children&&e.children.length&&(void 0===t.openSet[e.id]?t.level<t.defaultOpenLevel:t.openSet[e.id])?[o("tree-base",{key:"children-"+e.id,attrs:{data:e.children,level:t.level+1,keyword:t.keyword,"default-open-level":t.defaultOpenLevel,"memory-open-set":t.memoryOpenSet,"icon-position":t.iconPosition,"has-slot-left":t.showSlotLeft,"has-slot-right":t.showSlotRight,"indent-size":t.indentSize,"list-style":t.listStyle,"node-style":t.nodeStyle,"text-style":t.textStyle},on:{onClickNode:t.onClickNode,onClickFoldNode:t.onClickFoldNode,onClickEndNode:t.onClickEndNode},scopedSlots:t._u([{key:"left",fn:function(e){return[t._t("left",null,{data:e.data})]}},{key:"right",fn:function(e){return[t._t("right",null,{data:e.data})]}},{key:"siblings",fn:function(e){return[t._t("siblings",null,{data:e.data})]}}])})]:t._e()],2)})))}),[],!1,null,"0083fc0a",null);e.a=l.exports},"4aef":function(t,e,o){"use strict";var a=o("dd16").a,n=o("17cc"),r=Object(n.a)(a,(function(){var t=this.$createElement;return(this._self._c||t)("span",{class:this.classSet[this.status]},[this._v(this._s(this.text||this.status))])}),[],!1,null,null,null);e.a=r.exports},"58fc":function(t,e,o){var a=o("fa68");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,o("85cb").default)("8a3ef548",a,!0,{sourceMap:!1,shadowMode:!1})},7361:function(t,e,o){"use strict";(function(t){o("5ab2"),o("e10e");var a=o("28f8"),n=(o("6d57"),o("06a2"),o("07d2")),r=o("3c77"),i=o("4aef"),c=o("6e1b"),l=(o("37d5"),o("3516")),s=o("48f4"),d=o("e2a7"),h=o("3bd5"),p=o("7cb8"),u=o("fc33");function f(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,a)}return o}var g=h.a.getUser();e.a={name:"IndexList",components:{Item:n.default,StatusText:i.a,TreeBase:r.a},props:{batchId:{type:String}},data:function(){return{isLoading:!1,batchData:{},listData:[],routeBatchId:"",isBatchCreator:!1,isBatchChecker:!1,editable:!1}},watch:{batchId:{handler:function(t){t?this.init():(this.batchData={},this.listData=[])},immediate:!0}},created:function(){this.$on("reload",this.init)},activated:function(){this.routeBatchId=this.$route.query.batch_id,this.init()},methods:{init:function(){var t=this;return Promise.all([this.getBatchData(),this.getListData()]).finally((function(){t.isLoading=!1,t.$emit("loaded",t.listData)})).catch((function(e){$log.error(e),t.batchData={},t.listData=[],t.isLoading=!1}))},getBatchData:function(){var e=this;return this.batchId?c.a.getSpecialInspectBatchById(this.batchId).then((function(t){e.batchData=t,e.isBatchCreator=t.created_by===g.user_id})).then((function(){return Promise.resolve().then((function(){var o=e.batchData.root_id||e.batchData.parent_id||e.batchData.id;return l.a.getBatchUsers(o).then((function(o){var a=h.a.getUser().user_id;e.isBatchChecker=t.some(o,{user_id:a}),e.editable="检查完毕"!==e.batchData.status&&e.isBatchChecker}))}))})):Promise.reject("缺少批次id")},getListData:function(){var t=this;return this.batchId?u.a.getBatchTree(this.batchId).then((function(e){t.listData=e})):Promise.reject("缺少批次id")},onClickNode:function(t){100!==t.template_mode&&("检查完毕"===this.batchData.status&&"检查完毕"!==t.status||this.$router.push({path:"/special-inspect-combo-template-detail",query:{batchId:t.id,from:this.routeBatchId?"todo":""}}))},formulaTips:function(t){var e=u.a.getScoreFormula(t.children,t.algorithm);d.a.notify(e,{buttonName:"知道了",className:"broad-dialog"})},submitBatch:function(){var t=this,e=function(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?f(Object(o),!0).forEach((function(e){Object(a.a)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):f(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}({},this.batchData);return delete e.contracts,Promise.resolve().then((function(){if(!t.listData.some((function(t){return Object(p.i)(t.score)})))return Promise.reject("请完成至少一个末级模板再提交")})).then((function(){return d.a.confirm("请确保所有检查人已上传数据，提交后不可修改，确认提交？").then((function(o){if(o)return c.a.finishCheckBatch(e).then((function(){return s.default.setLocalChanged(),t.init()}))}))})).catch((function(t){$log.error(t),t&&500102===t.errcode?d.a.alert("检测到检查结果有冲突，请下拉刷新后再试"):d.a.alert(t)}))}}}}).call(this,o("391c"))},b66d:function(t,e,o){(t.exports=o("690e")(!1)).push([t.i,'.zjapp .tree-node[data-v-0083fc0a]{display:flex;flex-direction:row;align-items:center;justify-content:center;padding:8px 15px}.zjapp .tree-main[data-v-0083fc0a]{flex:1}.zjapp .tree-text[data-v-0083fc0a]{font-size:14px;color:#333;line-height:20px;padding:5px 0;overflow:hidden;text-overflow:ellipsis;-webkit-line-clamp:2}.zjapp .tree-indent[data-v-0083fc0a]{width:14px;height:20px}.zjapp .tree-icon[data-v-0083fc0a]{position:relative;width:20px;height:20px;line-height:20px;color:#c8c8c8;font-size:26px}.zjapp .icon-dropdown[data-v-0083fc0a]:before,.zjapp .icon-dropright[data-v-0083fc0a]:before{content:"";position:absolute;width:0;height:0;border:6px solid #c8c8c8}.zjapp .icon-dropdown[data-v-0083fc0a]:before{top:7px;left:0;border-left-color:transparent}.zjapp .icon-dropdown[data-v-0083fc0a]:before,.zjapp .icon-dropright[data-v-0083fc0a]:before{border-right-color:transparent;border-bottom-color:transparent}.zjapp .icon-dropright[data-v-0083fc0a]:before{top:4px;left:2px;border-top-color:transparent}.zjapp .icon-right[data-v-0083fc0a]{margin-left:10px;color:#c8c8c8;line-height:30px}',""])},dd16:function(t,e,o){"use strict";(function(t){e.a={name:"StatusText",props:{status:{type:String},text:{type:String},extend:{type:Object,default:function(){return{}}}},data:function(){return{classSet:t.extend({"草稿":"color-gray","暂存":"color-gray","检查中":"color-orange","待整改":"color-red","待复验":"color-orange","待验收":"color-red","待报验":"color-red","待申请进场":"color-red","待初验":"color-red","待送检":"color-red","待上传报告":"color-red","待退场":"color-red","待建设单位验收":"color-red","待区域验收":"color-red","供应链退回":"color-red","预创建":"color-status-blue","已提交":"color-green","已整改":"color-green","已验收":"color-green","已通过":"color-green","已退场":"color-gray","已关闭":"color-gray","非正常关闭":"color-gray","已退回":"color-red","已完成":"color-green","已甩项":"color-gray","检查完毕":"color-green","送检合格":"color-green","复验合格":"color-green","验收合格":"color-green","验收不合格":"color-red","未验收":"color-orange","待点评":"color-orange","已点评":"color-green","合格":"color-green","不合格":"color-red","进度正常":"color-green","进度滞后":"color-red","正常":"color-green","滞后":"color-red","施工单位验收合格":"color-green","监理单位验收合格":"color-green","建设单位验收合格":"color-green","施工单位验收不合格":"color-red","监理单位验收不合格":"color-red","建设单位验收不合格":"color-red"},this.extend)}},mounted:function(){}}}).call(this,o("391c"))},f6c3:function(t,e,o){"use strict";o("58fc")},fa68:function(t,e,o){(t.exports=o("690e")(!1)).push([t.i,".zjapp .list-empty[data-v-4499ded3]{display:flex;flex-direction:column;flex:1}.zjapp .app-btn-text[data-v-4499ded3]{font-size:16px}.zjapp .tree-header[data-v-4499ded3]{display:flex;padding:5px 0;line-height:20px;font-size:14px;color:#888}.zjapp .tree-header-template[data-v-4499ded3]{flex:1;padding:0 15px}.zjapp .tree-header-weight[data-v-4499ded3]{width:90px;text-align:center}.zjapp .tree-header-score[data-v-4499ded3]{width:90px;padding-right:40px;text-align:right}[data-v-4499ded3] .tree-node{position:relative;background-color:#fafafa}[data-v-4499ded3] .tree-node-level-0,[data-v-4499ded3] .tree-node-level-1{background-color:#fff}[data-v-4499ded3] .tree-node .tree-text{color:#666}[data-v-4499ded3] .tree-node-level-0 .tree-text{color:#111;font-weight:700}[data-v-4499ded3] .tree-node-level-1 .tree-text{color:#333}.zjapp .tree-weight[data-v-4499ded3]{width:90px;text-align:center;color:#666;font-size:14px}.zjapp .tree-score[data-v-4499ded3]{margin-right:-29px;width:90px;padding-right:40px;text-align:right;color:#666;font-size:14px}.zjapp .tree-icon-tips[data-v-4499ded3]{margin-left:-4px;font-size:18px;color:#c8c8c8}.zjapp .tree-icon-arrow[data-v-4499ded3]{width:14px;font-size:14px;color:#c8c8c8}",""])},fc33:function(t,e,o){"use strict";o("2b45"),o("6d57");var a=o("fc9f"),n=function(t){return a.a.query("select b.*, t.name as template_name, t.mode as template_mode, bc.weight\n      from batch b\n      left join special_inspect_template t on t.id = b.template_id\n      left join special_inspect_template_batch_combo bc on bc.batch_id = b.id and bc.template_id = t.id\n      where b.root_id = ? and ifnull(b.parent_id, '') != ''\n      order by bc.sort",[t])},r=function(t){return a.a.query("select b.*, t.name as template_name, t.mode as template_mode, bc.weight\n      from batch b\n      left join special_inspect_template t on t.id = b.template_id\n      left join special_inspect_template_batch_combo bc on bc.batch_id = b.id and bc.template_id = t.id\n      where b.root_id = ?\n      order by bc.sort",[t])},i=o("7cb8");function c(t){if(!t||!t.length)return[];var e=[],o=[];return t.forEach((function(t){e[t.id]=t})),t.forEach((function(t){t.parent_id&&e[t.parent_id]?(e[t.parent_id].children||(e[t.parent_id].children=[]),e[t.parent_id].children.push(t)):o.push(t)})),o}e.a={getBatchTree:function(t){var e=this;return n(t).then((function(t){(t||[]).forEach((function(t){try{var e=JSON.parse(t.template_extension||{});t.algorithm=parseInt(e.total_score_algorithm)||1}catch(e){t.algorithm=1}}));var o=c(t);return e.setBatchTreeScore(o),o}))},setBatchTreeScore:function(t){var e=this;t&&t.length&&t.forEach((function(t){t.children&&t.children.length&&(e.setBatchTreeScore(t.children),t.score=e.getScore(t.children,t.algorithm))}))},getBatchTotalData:function(t){var e=this;return r(t).then((function(t){(t||[]).forEach((function(t){try{var e=JSON.parse(t.template_extension||{});t.algorithm=parseInt(e.total_score_algorithm)}catch(e){t.algorithm=1}}));var o=c(t);return e.setBatchTreeScore(o),o}))},getScoreWeight:function(t,e){return Object(i.i)(t)?Object(i.i)(e)?(t=parseFloat(t))*(e=parseFloat(e)/100):parseFloat(t):0},getScoreWeightText:function(t,e){return Object(i.i)(t)?Object(i.i)(e)?(t="%"===t.toString().substr(-1)?t:"".concat(t,"%"),e="%"===e.toString().substr(-1)?e:"".concat(e,"%"),"".concat(t,"*").concat(e)):t:""},getScore:function(){var t,e,o=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r="";return 1===n?(a.forEach((function(e){if(Object(i.i)(e.score)){var a=e.score,n=e.weight;t=t||0,t+=o.getScoreWeight(a,n)}})),r=t):2===n&&(a.forEach((function(a){if(Object(i.i)(a.score)){var n=a.score,r=a.weight;t=t||0,e=e||0,t+=o.getScoreWeight(n,r),e+=parseFloat(r)/100}})),r=Object(i.i)(t)?e?t/e:0:""),r=Object(i.i)(r)?(Math.round(100*r)/100).toFixed(2)+"%":""},getScoreFormula:function(){var t,e=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=[];return 1===a?(t="得分=组合评分表1*权重1+组合评分表2*权重2+...+组合评分表n*权重n",o.forEach((function(t){if(Object(i.i)(t.score)){var o=t.score,a=t.weight;n.push(e.getScoreWeightText(o,a))}})),n&&n.length&&(t+="=".concat(n.join("+"),"=").concat(this.getScore(o,a)))):2===a&&(t="得分=（组合评分表1*权重1+组合评分表2*权重2+...+组合评分表n*权重n）/（权重1+权重2+...+权重n）",o.forEach((function(t){if(Object(i.i)(t.score)){var o=t.score,a=t.weight;n.push(e.getScoreWeightText(o,a)),r.push("".concat(a,"%"))}})),n&&n.length&&(t+="=(".concat(n.join("+"),")/(").concat(r.join("+"),")=").concat(this.getScore(o,a)))),t}}}}]);