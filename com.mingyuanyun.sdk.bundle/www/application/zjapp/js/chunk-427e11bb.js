(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-427e11bb"],{"5a61":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .tab-item-wrap[data-v-03144a9b]{display:flex;flex-direction:column;flex:1;height:100%}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] {margin:10px 0 0}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tabs--line .van-tabs__wrap{height:120px;padding-top:10px;background:#fff}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tabs--line .van-tabs__wrap:after{border:none}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tabs__nav{padding-left:15px;padding-right:15px;padding-bottom:0;background-image:none}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tabs__line{display:none}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tabs .van-tab{flex:1 0 auto!important;padding-right:8px!important;padding-left:0!important}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tabs .van-tab:first-child{max-width:58px}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tabs .van-tab:not(:first-child){max-width:93px}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-ellipsis{overflow:visible;white-space:normal}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tab--active .node-name{color:#4275e8}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tab--active .node-avatar-name{color:#fff}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tab--active .node-avatar{background-color:#4275e8;border:1px solid #4275e8}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tab--active .icon-avatar-start{color:#fff}.zjapp .tab-item-wrap .process-accept-v3-nodes[data-v-03144a9b] .van-tab--active .node-line{background:#4275e8}",""])},"6a7f":function(t,e,a){"use strict";a.r(e);var s=a("db66").a,c=(a("df9b"),a("17cc")),n=Object(c.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:0===t.tabIndex,expression:"tabIndex === 0"}],staticClass:"tab-item-wrap"},[!t.isLoading&&t.isHasNetwork?a("scroller",{ref:"scroller"},[t.isLoading?t._e():a("problem-detail-header",{staticClass:"bg-white",attrs:{status:t.currentStatus,"status-text":t.currentStatus}}),!t.isLoading&&t.isHasNetwork?a("detail-header-content",{attrs:{"checkitem-data":t.checkItemData,"place-data":t.placeData,construct:t.computedConstruct,"process-mode":t.processMode,"accept-id":t.acceptId,"batch-name":t.customAcceptBatch.name,"is-batch-operation":t.isBatchOperation,"batch-data":t.batchData}}):t._e(),t.acceptId?t._e():a("single-select",{staticClass:"mt10",attrs:{title:"施工单位",options:t.contractorOptions},model:{value:t.computedConstruct,callback:function(e){t.computedConstruct=e},expression:"computedConstruct"}}),t.processNodes&&t.processNodes.length?a("div",{staticClass:"process-accept-v3-nodes"},[a("van-tabs",{on:{disabled:t.onClickDisabledNode,change:t.onChangeNode},model:{value:t.computedCurrentNodeIndex,callback:function(e){t.computedCurrentNodeIndex=e},expression:"computedCurrentNodeIndex"}},t._l(t.processNodes,(function(e,s){return a("van-tab",{key:s,attrs:{border:!1,ellipsis:!1,disabled:t.getCurrentNodeDisable(e,s)}},[a("template",{slot:"title"},[a("workflow-tab-title",{attrs:{"current-node":e,"current-index":s}})],1),a("process-accept-detail",{attrs:{"detail-data":e,"next-detail-data":t.processNodes[s+1]||null,"user-options":t.userOptions,"process-mode":t.processMode,"accept-id":t.acceptId,"is-edit-status":t.isEditStatus,"dis-edit-force":!t.computedShowBtns},on:{problemValueChange:t.problemValueChange,setDetailStatus:t.setDetailStatus,changeOperator:t.changeOperator,changeCc:t.changeCc,changeAcceptor:t.changeAcceptor}}),t.hasDraft&&t.draftDataId===e.process_id?a("app-button-group",[a("app-button",{attrs:{type:"text",name:"删除此草稿"},on:{click:function(e){t.onClickDelDraft()}}})],1):t._e()],2)})))],1):t._e()],1):t._e(),!t.isLoading&&t.isHasNetwork?[a("overall-result",{attrs:{"detail-data":t.processNodes[t.currentNodeIndex],"no-button":!t.computedShowBtns&&!t.computedShowModifyBtn&&!t.computedShowRecallBtn}}),t.computedShowBtns?a("app-button-group",{attrs:{"fixed-bottom":"",seamless:!t.isEditStatus}},[t.isFormV3List&&!t.isEditStatus?a("app-button",{directives:[{name:"track",rawName:"v-track",value:"工序验收V3-点击暂存",expression:"'工序验收V3-点击暂存'"}],class:{"btn-color-gray":t.isBatchOperation},staticStyle:{width:"50%"},attrs:{plain:""},on:{click:function(e){t.onClickSave()}}},[t._v("\n        暂存\n      ")]):t._e(),a("app-button",{ref:"processButton",on:{click:function(e){t.onClickSubmit("process")}}},[t._v(t._s(t.acceptId&&!t.isEditStatus?"通过":"提交"))])],1):t._e(),a("app-button-group",{directives:[{name:"show",rawName:"v-show",value:t.computedShowModifyBtn||t.computedShowRecallBtn,expression:"computedShowModifyBtn || computedShowRecallBtn"}],attrs:{"fixed-bottom":""}},[t.computedShowModifyBtn?a("app-button",{on:{click:t.onClickEdit}},[t._v("修改")]):t._e(),t.computedShowRecallBtn?a("app-button",{on:{click:t.onClickRecall}},[t._v(" 撤回 ")]):t._e()],1)]:t._e(),a("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.isHasNetwork,"empty-text":"当前无网络连接",type:"error"}})],2)}),[],!1,null,"03144a9b",null);e.default=n.exports},"92b6":function(t,e,a){var s=a("5a61");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,a("85cb").default)("bf537bb4",s,!0,{sourceMap:!1,shadowMode:!1})},db66:function(t,e,a){"use strict";(function(t){a("5ab2"),a("e10e");var s,c,n=a("28f8"),r=(a("6d57"),a("06a2"),a("e697"),a("cc57"),a("6a61"),a("2e91")),i=(a("163d"),a("3bd5")),o=a("e2a7"),d=(a("5ff0"),a("37d5"),a("5dc5")),p=a("5750"),u=(a("b9cd"),a("d474")),l=a("7f8d");function h(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function b(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?h(Object(a),!0).forEach((function(e){Object(n.a)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}e.a={components:{Scroller:function(){return Promise.resolve().then(a.bind(null,"774b"))},OverallResult:function(){return a.e("chunk-4d7a5a3b").then(a.bind(null,"3fd3"))},WorkflowTabTitle:function(){return a.e("chunk-845c4814").then(a.bind(null,"4cae"))},ProblemDetailHeader:function(){return Promise.resolve().then(a.bind(null,"da1c"))},DetailHeaderContent:function(){return a.e("chunk-8f1bb452").then(a.bind(null,"8b99"))},SingleSelect:function(){return Promise.resolve().then(a.bind(null,"5a71"))},ProcessAcceptDetail:function(){return Promise.resolve().then(a.bind(null,"9428"))}},props:{tabIndex:{type:Number},isLoading:{type:Boolean,default:!1},isHasNetwork:{type:Boolean,default:!0},isBatchOperation:{type:Boolean,default:!1},isFormV3List:{type:Boolean,default:!1},hasDraft:{type:Boolean,default:!1},draftDataId:{type:[String,void 0],default:void 0},defaultNodeIndex:{type:Number,default:0},editNodeIndex:{type:Number,default:0},acceptId:{type:String,default:""},uuId:{type:String,default:""},construct:{type:Object,default:function(){}},processMode:{type:Number,default:1},currentStatus:{type:String,default:"待报验"},operationType:{type:String,default:""},customAcceptBatch:{type:Object,default:function(){}},batchData:{type:Array,default:function(){return[]}},currentNodeIndex:{type:Number,default:0},processNodes:{type:Array,default:function(){return[]}},checkItemData:{type:Object,default:function(){}},placeData:{type:Object,default:function(){}},contractorOptions:{type:Array,default:function(){return[]}},userOptions:{type:Array,default:function(){return[]}}},data:function(){return{isEditStatus:!1,next_process_id:"",current_process_id:""}},computed:{computedShowBtns:function(){return console.log("通过/提交",this.currentNodeIndex,this.defaultNodeIndex,this.isEditStatus),this.currentNodeIndex===this.defaultNodeIndex&&!t.isEmpty(this.processNodes)||this.isEditStatus},computedShowModifyBtn:function(){return console.log("修改",this.currentNodeIndex,this.editNodeIndex,this.isEditStatus),this.currentNodeIndex===this.editNodeIndex&&!t.isEmpty(this.processNodes)&&!this.isEditStatus},computedShowRecallBtn:function(){var t=this.processNodes[this.currentNodeIndex]||{},e=this.processNodes[this.currentNodeIndex+1]||{},a=t.status===l.a&&!e.status&&0===this.currentNodeIndex&&this.currentStatus!==l.j,s=this.currentStatus===l.a&&1===this.processNodes.length,c=t.operator===i.a.getUser().user_id;return!this.isEditStatus&&c&&(a||s)},computedIsBatchAcceptance:function(){return this.isBatchOperation&&this.operationType===l.i.ACCEPTANCE},computedConstruct:{get:function(){return this.construct},set:function(t){this.$emit("changeConstruct",t)}},computedCurrentNodeIndex:{get:function(){return this.currentNodeIndex},set:function(t){this.$emit("changeCurrentNodeIndex",t)}}},methods:{init:function(){this.isEditStatus=!1;var t=this.processNodes[this.currentNodeIndex];console.log("验收详情初始化",t),this.next_process_id=t.next_process_id,this.current_process_id=t.process_id},onClickRecall:(c=Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.confirm("确定撤回此工序的验收流程吗?");case 2:if(!t.sent){t.next=16;break}return t.prev=4,t.next=7,Object(p.m)({id:this.acceptId});case 7:return t.next=9,Object(d.b)();case 9:this.onClickSave(!0),this.$router.go(-1),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(4),o.a.alert(t.t0);case 16:case"end":return t.stop()}}),t,this,[[4,13]])}))),function(){return c.apply(this,arguments)}),onClickSave:(s=Object(r.a)(regeneratorRuntime.mark((function e(){var a,s,c,n,r,i,p,u,l,h,b,f,m,_,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=v.length>0&&void 0!==v[0]&&v[0],!this.isBatchOperation){e.next=3;break}return e.abrupt("return",o.a.alert("批量操作模式下不可暂存"));case 3:return s=this.placeData,c=s.section_id,n=s.building_id,r=s.unit,i=s.floor,p=s.room_id,u=this.customAcceptBatch,l=u.id,h=u.name,b=this.processNodes,f=this.currentStatus,m=this.current_process_id,a&&(f="待报验",m=void 0,t.each(b,(function(e){e.status="",e.operator=void 0,e.process_id=void 0,e.accept_id=void 0,t.each(e.process_checkpoint||[],(function(t){t.id=t.checkpoint_id})),t.each(e.process_type||[],(function(t){t.id=t.item_type_id}))}))),_={uuId:this.uuId,processNodes:b,bidsection_id:c,building_id:n,unit:r,floor:i,room_id:p,inspection_lot_id:l,inspection_lot_name:h,process_mode:this.processMode,checkItemId:this.checkItemData.id,current_process_id:m,currentDataStatus:f,placeData:this.placeData,construct:this.computedConstruct},console.log("saveDraft",_),e.next=13,Object(d.j)(_);case 13:this.$emit("setDraftRrocessId",this.current_process_id),a||o.a.alert("暂存成功");case 15:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)}),onClickDelDraft:function(){var t=this;o.a.confirm("确定要删除此草稿吗？",(function(){return Object(d.b)().then((function(){return o.a.alert("删除成功").then((function(){t.$router.go(-1)}))}))}))},onClickSubmit:function(){var e=this,a={};if(this.acceptId){var s=t.find(this.processNodes,["process_id",this.current_process_id])||{};a=s}else a=this.processNodes[0];var c=Object(d.g)(a,this.computedConstruct.id),n=c.errMsg,r=c.confirmTips,i=c.okText,p=c.cancelText;return n?o.a.alert(n):o.a.confirm(r,{okText:i,cancelText:p}).then((function(t){return t?e.handleSubmitData(a):Promise.reject()})).catch((function(t){return o.a.alert(t.errmsg||t)})).finally((function(){e.$refs.processButton&&e.$refs.processButton.setNormal()}))},handleSubmitData:function(e){var a=this,s=[],c=[];return this.$refs.processButton&&this.$refs.processButton.setActive(),t.each(e.process_checkpoint||[],(function(t){c.push(Object(d.l)(t.image_file).then((function(e){s.push({id:t.id,is_fill:t.is_fill,image_file:JSON.stringify(e)})})))})),Promise.all(c).then((function(){var c,n=[];t.each(e.process_type||[],(function(t){n.push({id:t.id,status:t.status,rate:t.rate,problem_values:JSON.stringify(t.problem_values),is_jilt_item:t.is_jilt_item})}));var i={process_type_data:JSON.stringify(n),checkpoint_data:JSON.stringify(s),master_status:e.sum.masterStatus,common_status:e.sum.commonStatus,measure_lowest_rate:e.sum.lowest,remark:e.remark||""};if(a.acceptId)c=b({accept_id:a.acceptId,process_id:a.current_process_id},i);else{var o=[{unit:a.placeData.unit,floor:a.placeData.floor,room_id:a.placeData.room_id}],u=JSON.stringify(t.map(e.acceptor_user||[],"id")),l=JSON.stringify(t.map(e.cc_set||[],"id")),h=a.placeData,f=h.project_id,m=h.section_id,_=h.building_id;c=b({proj_id:f,bidsection_id:m,item_id:a.checkItemData.id,building_id:_,place:JSON.stringify(o),process_mode:a.processMode,next_process_operator:e.next_process_operator.id||"",acceptor_user:u,cc:l,contractor_id:a.computedConstruct.id||""},i)}return 6===a.processMode&&(c.inspection_lot_id=a.customAcceptBatch.id,c.inspection_lot_name=a.customAcceptBatch.name),a.isBatchOperation?(a.$emit("batchAlert",!0),Object(d.a)(c,a.batchData,a.operationType,a.processMode).finally((function(){a.$emit("batchAlert",!1),a.$router.go(-1)}))):Object(p.n)(c).then(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e&&e.accept_id&&(a.isEditStatus=!1,Object(d.b)(),a.$emit("init",e.accept_id));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}))},onClickEdit:function(){this.isEditStatus=!0,this.$set(this.processNodes[this.editNodeIndex],"mode","edit")},onChangeNode:function(t){var e=this.processNodes[t];this.next_process_id=e.next_process_id,this.current_process_id=e.process_id},onClickDisabledNode:function(t){return this.isBatchOperation&&t<this.currentNodeIndex?this.processMode===u.a.USER_DEFINED&&this.currentNodeIndex===t+1?o.a.alert("此节点验收后才可以查看"):o.a.alert("批量验收场景下不支持查看前置节点验收信息"):this.isEditStatus?o.a.alert("当前节点保存后，才可以切换"):o.a.alert("此节点验收后才可以查看")},getCurrentNodeDisable:function(t,e){if(this.isBatchOperation){var a=t.isDisable||this.isEditStatus,s=Number(e)<Number(this.currentNodeIndex);return a||s}return t.isDisable||this.isEditStatus},problemValueChange:function(t){t=Object(d.h)(t),this.$set(this.processNodes,this.currentNodeIndex,t)},setDetailStatus:function(t,e,a){var s;s=t.status===e?"":e,this.$set(t,"status",s),a=Object(d.h)(a),this.$set(this.processNodes,this.currentNodeIndex,a)},changeOperator:function(t,e,a){var s=this,c=a.success,n=a.fail;if(this.acceptId){var r={accept_id:this.acceptId,process_id:Number(e)?this.current_process_id:this.next_process_id,operator:t.id||""};this.computedIsBatchAcceptance?(Object.assign(r,{places:Object(d.e)(e,this.batchData,this.processMode,this.operationType)}),Object(p.q)(r).then((function(){Number(e)&&s.$emit("init"),c&&c()})).catch((function(t){o.a.alert(t.errmsg),n&&n()}))):Object(p.c)(r).then((function(){Number(e)&&s.$emit("init"),c&&c()})).catch((function(t){o.a.alert(t.errmsg),n&&n()}))}else c&&c()},changeCc:function(e){var a={accept_id:this.acceptId,cc:JSON.stringify(t.map(e||[],"id"))};this.computedIsBatchAcceptance?(Object.assign(a,{places:Object(d.e)(null,this.batchData,this.processMode,this.operationType)}),Object(p.p)(a)):Object(p.b)(a)},changeAcceptor:function(e){var a={accept_id:this.acceptId,process_id:this.current_process_id,acceptor_user:JSON.stringify(t.map(e||[],"id"))};this.computedIsBatchAcceptance?(Object.assign(a,{places:Object(d.e)(null,this.batchData,this.processMode,this.operationType)}),Object(p.r)(a)):Object(p.d)(a)}}}}).call(this,a("391c"))},df9b:function(t,e,a){"use strict";a("92b6")}}]);