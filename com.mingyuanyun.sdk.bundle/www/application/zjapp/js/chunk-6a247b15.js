(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-6a247b15"],{"0ea7":function(t,i,e){"use strict";e("93c1")},13908:function(t,i,e){"use strict";var o=e("fb40").a,n=(e("ef2a"),e("17cc")),a=Object(n.a)(o,(function(){var t=this.$createElement,i=this._self._c||t;return i("div",{ref:"scroll-warp",staticClass:"scroll-warp",class:{"scroll-warp-complete":!this.hasNext&&!this.isEmpty},on:{scroll:this.throttle}},[this._t("default"),this.loading?i("div",{staticClass:"loading"},[i("van-loading",{attrs:{color:"#1989fa"}})],1):this._e()],2)}),[],!1,null,"4417bf8f",null);i.a=a.exports},"47e9":function(t,i,e){t.exports=e.p+"img/take-picture.7c198231.png"},"5fc9":function(t,i,e){var o=e("fbfe");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);(0,e("85cb").default)("80fa22c4",o,!0,{sourceMap:!1,shadowMode:!1})},"6e34":function(t,i,e){"use strict";(function(t){e("e204"),e("6a61");var o,n=e("2e91"),a=e("4c09"),l=(e("6d57"),e("13908")),s=e("4ad6"),p=e("3122"),r=e("cc90"),c=e("6cb4"),h=e("6f9e"),u=e("4360");i.a={components:{Scroller:l.a},data:function(){return{title:"",viewSize:$rootScope.viewSize,isLoading:!1,imgList:[],doneLimit:36,allLength:0,queryProjId:"",throttleTakePicture:t.throttle(this.takePicture,2e3,{trailing:!1})}},computed:{showBigImagesPathList:function(){var t=[];return this.imgList.forEach((function(i){var e=i.imgs.map((function(t){return{temp:t.path}}));t.push.apply(t,Object(a.a)(e))})),t},projId:function(){return u.a.state.global.currentProject.id}},created:function(){var t=this;this.resetData(),h.a.$on("listenAppPhoto",(function(){t.resetData()}))},activated:function(){},methods:{resetData:function(){var t=this;this.doneLimit=36,this.isLoading=!0,this.getData(this.doneLimit).then((function(){t.isLoading=!1}))},getData:function(t){var i=this;return this.queryProjId=this.projId,r.a.getData(t).then((function(t){console.log("获取相册数据",t),i.imgList=t,i.allLength=r.a.allLength})).catch((function(t){$log.log("加载app相册失败",t)}))},takePicture:(o=Object(n.a)(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return $log.log("内置相册添加图片"),t.next=3,p.a.takePicture();case 3:if(i=t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,r.a.handelPicture(i.temp);case 8:case"end":return t.stop()}}),t)}))),function(){return o.apply(this,arguments)}),addImage:function(){},delIamge:function(){},showBigImage:function(t){r.a.getLocalImage().then((function(t){var i=[];return t.forEach((function(t){var e=t.imgs.map((function(t){return{temp:t.path}}));i.push.apply(i,Object(a.a)(e))})),i})).then((function(i){var e=i.findIndex((function(i){return i.temp===t})),o=p.a.convertImageList(i);s.a.openImageBrowser(o,e)})).catch((function(t){return $log.log("查看大图失败",t)}))},toSelectImage:function(){c.a.openPopup({bool:!1})},nextPage:function(){this.doneLimit+=28,this.getData(this.doneLimit)}}}}).call(this,e("391c"))},"7c74":function(t,i,e){"use strict";e.r(i);var o=e("6e34").a,n=(e("0ea7"),e("17cc")),a=Object(n.a)(o,(function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("page-content",{staticClass:"bg-white",attrs:{title:"APP相册"}},[t.allLength>0?o("div",{staticClass:"header-btn",attrs:{slot:"header-bar-right"},on:{click:t.toSelectImage},slot:"header-bar-right"},[t._v("\n    选择\n  ")]):t._e(),o("div",{staticClass:"bg-white build-in-photo"},[o("scroller",{style:{height:t.viewSize.contentHeight-96+"px"},attrs:{"has-next":t.doneLimit<t.allLength,"is-empty":!t.isLoading&&0==t.allLength},on:{loadNext:function(i){t.nextPage()}}},[t.imgList.length>0&&!t.isLoading?t._l(t.imgList,(function(i){return o("div",{key:i.id},[(i.imgs&&i.imgs.length)>0?o("div",{staticClass:"photo-box"},[o("h3",{staticClass:"title-title"},[o("div",[t._v("\n                "+t._s(t._f("sliceDate")(i.date))+"\n                "),o("span",[t._v(t._s(i.week))])])]),o("div",{staticClass:"photo-box__list"},t._l(i.imgs,(function(i,e){return o("div",{key:e,staticClass:"thumb-img",on:{click:function(e){t.showBigImage(i.path)}}},[o("van-image",{attrs:{src:t._f("fixImageUrl")(i.thumb||i.path),fit:"cover",width:"100%",height:"100%","lazy-load":!0}},[o("template",{slot:"loading"},[o("i",{staticClass:"iconfont icon-tupianzhanweifu"}),o("br"),t._v("加载中\n                  ")]),o("template",{slot:"error"},[t._v("加载失败")])],2)],1)})))]):t._e()])})):t._e(),t.allLength>0&&!t.isLoading?o("div",{staticClass:"tips"},[o("span",{staticClass:"line-left"}),o("span",{staticClass:"line-center"},[t._v("仅保留最近3个月的照片")]),o("span",{staticClass:"line-right"})]):t._e(),o("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.isLoading&&0==t.allLength,"empty-text":"暂无图片"}})],2),o("div",{directives:[{name:"track",rawName:"v-track",value:"APP相册-点击拍照",expression:"'APP相册-点击拍照'"}],staticClass:"photo-footer index",on:{click:t.throttleTakePicture}},[o("img",{staticClass:"img-take-pic",attrs:{src:e("47e9"),alt:""}})])],1)])}),[],!1,null,null,null);i.default=a.exports},"93c1":function(t,i,e){var o=e("e7c2");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);(0,e("85cb").default)("3a986b6b",o,!0,{sourceMap:!1,shadowMode:!1})},e7c2:function(t,i,e){(t.exports=e("690e")(!1)).push([t.i,".zjapp .build-in-photo{flex:1;display:flex;flex-direction:column;overflow:hidden}.zjapp .build-in-photo .circle-check,.zjapp .build-in-photo .circle-o{display:inline-block;width:18px;height:18px;border-radius:50%}.zjapp .build-in-photo .circle-o{border:1px solid #999}.zjapp .build-in-photo .circle-check{background-color:#4275e8;text-align:center;line-height:16px}.zjapp .build-in-photo .circle-check .icon{position:relative;color:#fff;font-size:10px}.zjapp .build-in-photo .photo-box .title-title{margin:0;padding:20px 15px 0;font-size:16px;font-weight:600;display:flex;justify-content:space-between;align-items:center}.zjapp .build-in-photo .photo-box .title-title .btn-select{margin-left:8px}.zjapp .build-in-photo .photo-box .photo-box__list{display:flex;flex-wrap:wrap}.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img{position:relative;width:calc(25% - 2px);margin-right:2px;margin-bottom:2px;height:89px}.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img:nth-child(4n){width:25%;margin-right:0}.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img .is_select,.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img .no_select{position:absolute;z-index:9;right:0;top:0;padding:4px;text-align:right}.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img .is_select .circle-o,.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img .no_select .circle-o{border-color:#fff;background-color:rgba(0,0,0,.4)}.zjapp .build-in-photo .photo-box .photo-box__list .thumb-img img{width:100%;height:100%;-o-object-fit:cover;object-fit:cover}.zjapp .build-in-photo .tips{margin-top:30px;display:flex;align-items:center;justify-content:center}.zjapp .build-in-photo .tips .line-left,.zjapp .build-in-photo .tips .line-right{width:48px;height:1px;background-color:#e4e4e4}.zjapp .build-in-photo .tips .line-center{color:#c8c8c8;margin:6px}.zjapp .build-in-photo .photo-footer{flex-shrink:0;padding:15px;display:flex;justify-content:space-between;align-items:center;font-size:16px;background:#fff;border-top:1px solid #ececec}.zjapp .build-in-photo .photo-footer.index{justify-content:center;border-top:none}.zjapp .build-in-photo .photo-footer.index .img-take-pic{width:66px;height:66px}.zjapp .build-in-photo .photo-footer .tip-left{color:#666}.zjapp .build-in-photo .photo-footer .tip-right{color:#ff3c46}.zjapp .build-in-photo .photo-footer .tip-right.dis{opacity:.4}.zjapp .build-in-photo .photo-footer .tip-right-sure{width:68px;height:30px;line-height:30px;color:#fff}.zjapp .build-in-photo .photo-footer .tip-right-sure:disabled{opacity:.4}",""])},ef2a:function(t,i,e){"use strict";e("5fc9")},fb40:function(t,i,e){"use strict";(function(t){i.a={name:"Infinite",props:{hasNext:{type:Boolean,default:!1},isEmpty:{type:Boolean,default:!1}},data:function(){return{refreshing:!1,loading:!1,scrollTop:0}},created:function(){this.throttle=t.throttle(this.onScroll.bind(this),300)},methods:{onScroll:function(t){var i=this,e=this.$refs["scroll-warp"].scrollTop;if(this.scrollTop>e)this.scrollTop=e;else{this.scrollTop=e;var o=this.$refs["scroll-warp"].scrollHeight;if(e+this.$refs["scroll-warp"].clientHeight>=o-5&&!this.loading&&this.hasNext){this.loading=!0;var n=this.$listeners.loadNext();n&&n.then&&"function"==typeof n.then?n.then((function(){i.loading=!1})):this.loading=!1}this.$emit("scroll",t)}}}}}).call(this,e("391c"))},fbfe:function(t,i,e){(t.exports=e("690e")(!1)).push([t.i,'.zjapp .scroll-warp[data-v-4417bf8f]{flex:1;overflow:auto}.zjapp .scroll-warp .loading[data-v-4417bf8f]{text-align:center}.zjapp .scroll-warp-complete[data-v-4417bf8f]:after{content:"";display:block;height:100px}.zjapp .page-loading[data-v-4417bf8f]{padding:10px;text-align:center}',""])}}]);