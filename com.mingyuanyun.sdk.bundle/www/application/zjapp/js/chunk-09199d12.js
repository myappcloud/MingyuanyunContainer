(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-09199d12"],{1300:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .detail-traceability2 .item-text_right[data-v-1a37110c] .item-text{text-align:right}.zjapp .detail-traceability2 .form-check-input[data-v-1a37110c]::-webkit-input-placeholder{color:red}.zjapp .detail-traceability2 .form-check-input[data-v-1a37110c]:-moz-placeholder,.zjapp .detail-traceability2 .form-check-input[data-v-1a37110c]::-moz-placeholder{color:red}.zjapp .detail-traceability2 .form-check-input[data-v-1a37110c]:-ms-input-placeholder{color:red}.zjapp .detail-traceability2 .information[data-v-1a37110c]{padding:12px 15px;position:relative;background:#fff;height:46px;font-size:16px;color:#333;border-bottom:1px solid #ececec}.zjapp .detail-traceability2 .information[data-v-1a37110c]:before{content:"";background:#4275e8;width:4px;height:16px;position:absolute;left:0;top:50%;transform:translateY(-50%)}.zjapp .detail-traceability2 .information-remark[data-v-1a37110c]{padding:15px;font-size:14px;color:#999;background:#fff;line-height:20px;word-break:break-word}.zjapp .detail-traceability2 .information-remark div[data-v-1a37110c]{padding:10px;background:#fafafa}.zjapp .detail-traceability2 .information-item-layer[data-v-1a37110c]{background:#fff;margin-bottom:10px}.zjapp .detail-traceability2 .information-item-layer[data-v-1a37110c]:last-child{margin-bottom:0}.zjapp .detail-traceability2 .information-item[data-v-1a37110c]{display:flex}.zjapp .detail-traceability2 .information-item .item[data-v-1a37110c]{padding:8px 15px 8px 0}.zjapp .detail-traceability2 .information-item .item-label[data-v-1a37110c]{width:40%}.zjapp .detail-traceability2 .information-item .information-item_delete[data-v-1a37110c]{width:48px;display:flex;justify-content:center;align-items:center}.zjapp .detail-traceability2 .information-item .information-item_delete i[data-v-1a37110c]{position:relative;width:18px;height:18px;border-radius:50%;background:#ff3c46;display:flex;justify-content:center;align-items:center}.zjapp .detail-traceability2 .information-item .information-item_delete i[data-v-1a37110c]:after{content:"";width:8px;height:1px;background:#fff}.zjapp .detail-traceability2 .information-item .information-item_right[data-v-1a37110c]{flex:1}.zjapp .detail-traceability2 .information-add[data-v-1a37110c]{padding:20px 0;color:#4275e8;font-size:16px;text-align:center;background:#f2f2f2;margin-bottom:20px}',""])},1304:function(t,e,a){"use strict";var i=a("c5a7");e.__esModule=!0,e.SlotsMixin=void 0;var n=i(a("329b")).default.extend({methods:{slots:function(t,e){void 0===t&&(t="default");var a=this.$slots,i=this.$scopedSlots[t];return i?i(e):a[t]}}});e.SlotsMixin=n},"13a0":function(t,e,a){"use strict";a("cc57");var i=a("07d2"),n=a("e68e"),r=a("e2a7"),o=a("4603"),s={name:"DetailTraceability2",components:{Item:i.a,ItemImgList:n.a},props:{data:{type:Object,data:function(){}}},data:function(){return{activeNames:[1,2,3,4],material:"",materialBy:"",remark:"",materialList:[{name:"",remark:"",image_file:[],formCheck:!0}],id:null,maximumLength:!0}},methods:{init:function(){this.material=this.data.material,this.materialBy=this.data.materialBy,this.remark=this.data.remark,this.materialList=this.data.materialList.map((function(t){return t.formCheck=!1,t})),this.id=this.data.id,this.maximumLength=this.data.material&&this.data.material.length<=15},result:function(){this.activeNames=[1,2,3,4],this.material="",this.materialBy="",this.remark="",this.materialList=[],this.id=null},submit:function(){for(var t=this,e=this.materialList,a=0;a<e.length;a++){var i=e[a];if(!i.name||!i.remark)return this.$set(this.materialList,a,Object.assign(i,{formCheck:!0})),r.a.alert("请完善原材信息"),!1}var n={id:this.id,materialList:e.map((function(t){return{name:t.name,remark:t.remark,image_file:t.image_file}}))};return o.a.postSaveRawMaterial(n).then((function(){setTimeout((function(){t.$emit("result")}),500)}))},informationDelete:function(t){var e=this.materialList;1!==e.length?(e.splice(t,1),this.materialList=e,this.maximumLength=!0):r.a.alert("原料信息不可清空")},informationAdd:function(){this.materialList.push({name:"",remark:"",image_file:[]}),this.materialList.length>=15&&(this.maximumLength=!1)}}},l=(a("e5fe"),a("17cc")),c=Object(l.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"detail-traceability2"},[a("item",{staticClass:"item-text_right",attrs:{label:"原材商",text:t.material}}),a("item",{staticClass:"item-text_right",attrs:{label:"原材商经办人",text:t.materialBy}}),a("div",{staticClass:"m10"}),a("div",{staticClass:"information"},[t._v("原材信息")]),t.remark?a("div",{staticClass:"information-remark"},[a("div",[t._v(t._s(t.remark))])]):t._e(),a("div",{staticClass:"m10"}),t._l(t.materialList,(function(e,i){return a("div",{key:i,staticClass:"information-item-layer"},[a("div",{staticClass:"information-item"},[a("div",{staticClass:"information-item_delete",on:{click:function(e){t.informationDelete(i)}}},[a("i")]),a("div",{staticClass:"information-item_right"},[a("item",{attrs:{label:"原材名称",border:"bottom",mode:"edit"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"item.name"}],staticClass:"input-align-r f16",class:{"form-check-input":e.formCheck},attrs:{slot:"right",type:"text",placeholder:"请输入",maxlength:"200"},domProps:{value:e.name},on:{input:[function(a){a.target.composing||t.$set(e,"name",a.target.value)},function(t){e.formCheck=!1}]},slot:"right"})]),a("item",{attrs:{label:"原材说明",border:"bottom",mode:"edit"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"item.remark"}],staticClass:"input-align-r f16",class:{"form-check-input":e.formCheck},attrs:{slot:"right",type:"text",placeholder:"请输入",maxlength:"200"},domProps:{value:e.remark},on:{input:[function(a){a.target.composing||t.$set(e,"remark",a.target.value)},function(t){e.formCheck=!1}]},slot:"right"})])],1)]),a("item",{staticClass:"p15"},[a("item-img-list",{ref:"check-edit-item-img",refInFor:!0,attrs:{maxlength:50,"allow-select-album":!0,"allow-buildin-album":!0,"track-text":"材料溯源"},model:{value:e.image_file,callback:function(a){t.$set(e,"image_file",a)},expression:"item.image_file"}})],1)],1)})),t.maximumLength?a("div",{staticClass:"information-add",on:{click:t.informationAdd}},[t._v("添加原材")]):t._e(),a("app-button-group",[a("app-button",{on:{click:t.submit}},[t._v("提交")])],1)],2)}),[],!1,null,"1a37110c",null);e.a=c.exports},"17f4":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .detail-traceability1 .traceability-collapse[data-v-41a06b36]{margin-bottom:30px}.zjapp .detail-traceability1 .item-text_right[data-v-41a06b36] .item-text{text-align:right}.zjapp .detail-traceability1[data-v-41a06b36] .item-label{word-break:break-word}.zjapp .detail-traceability1 .info-main[data-v-41a06b36]{padding:0 15px 10px;background:#fff}.zjapp .detail-traceability1 .info-title[data-v-41a06b36]{height:46px;line-height:46px;color:#333;font-size:16px}.zjapp .detail-traceability1 .info-list[data-v-41a06b36]{padding:0 10px;background:#fafafa}.zjapp .detail-traceability1 .info-list .item[data-v-41a06b36]{padding:8px 0;background:#fafafa}.zjapp .detail-traceability1 .info-list .item-label[data-v-41a06b36]{color:#999}.zjapp .detail-traceability1 .info-list .item-text[data-v-41a06b36]{color:#333}.zjapp .detail-traceability1 .info-list input[data-v-41a06b36]{background:#fafafa}.zjapp .detail-traceability1 .info-list[data-v-41a06b36] .item-img-list li{margin-left:10px}.zjapp .detail-traceability1 .information-add[data-v-41a06b36]{padding:20px 0;color:#4275e8;font-size:16px;text-align:center}.zjapp .detail-traceability1[data-v-41a06b36] .information-item{display:flex;margin-bottom:10px;background:#fff}.zjapp .detail-traceability1[data-v-41a06b36] .information-item .item{padding:8px 15px 8px 0}.zjapp .detail-traceability1[data-v-41a06b36] .information-item .item-label{width:40%}.zjapp .detail-traceability1[data-v-41a06b36] .information-item .information-item_delete{width:48px;display:flex;justify-content:center;align-items:center}.zjapp .detail-traceability1[data-v-41a06b36] .information-item .information-item_delete i{position:relative;width:18px;height:18px;border-radius:50%;background:#ff3c46;display:flex;justify-content:center;align-items:center}.zjapp .detail-traceability1[data-v-41a06b36] .information-item .information-item_delete i:after{content:"";width:8px;height:1px;background:#fff}.zjapp .detail-traceability1[data-v-41a06b36] .information-item .information-item_right{flex:1}',""])},"19b5":function(t,e,a){"use strict";a("a240")},2064:function(t,e,a){"use strict";e.__esModule=!0,e.addUnit=function(t){if(!(0,i.isDef)(t))return;return t=String(t),(0,n.isNumber)(t)?t+"px":t};var i=a("b7b4"),n=a("f24f")},"237e":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .detail-traceability3 .item-text_right[data-v-61697f5a] .item-text{text-align:right}.zjapp .detail-traceability3[data-v-61697f5a] .item-label{word-break:break-word}.zjapp .detail-traceability3 .info-main[data-v-61697f5a]{padding:0 15px;background:#fff}.zjapp .detail-traceability3 .info-title[data-v-61697f5a]{height:46px;line-height:46px;color:#333;font-size:16px}.zjapp .detail-traceability3 .info-list[data-v-61697f5a]{padding:0 10px;background:#fafafa}.zjapp .detail-traceability3 .info-list .item[data-v-61697f5a]{padding:8px 0;background:#fafafa}.zjapp .detail-traceability3 .info-list .item-label[data-v-61697f5a]{color:#999}.zjapp .detail-traceability3 .info-list .item-text[data-v-61697f5a]{color:#333}.zjapp .detail-traceability3 .founder-created[data-v-61697f5a]{padding:12px 0;display:flex;align-items:center;justify-content:space-between}.zjapp .detail-traceability3 .founder-name[data-v-61697f5a]{font-size:12px;color:#999;overflow:hidden;text-overflow:ellipsis;-webkit-line-clamp:2;-webkit-box-orient:vertical;display:-webkit-box;flex:1}.zjapp .detail-traceability3 .founder-name span[data-v-61697f5a]{margin-right:5px}.zjapp .detail-traceability3 .founder-edit[data-v-61697f5a]{color:#4275e8;font-size:14px;display:inline-block;min-width:50px;text-align:right}.zjapp .detail-traceability3 .material-main[data-v-61697f5a]{padding:15px 15px 0 15px;background:#fff}.zjapp .detail-traceability3 .material-list[data-v-61697f5a]{padding:0 10px;background:#fafafa;margin-bottom:10px}.zjapp .detail-traceability3 .material-list[data-v-61697f5a]:last-child{margin-bottom:0}.zjapp .detail-traceability3 .material-list .item[data-v-61697f5a]{padding:8px 0;background:#fafafa}.zjapp .detail-traceability3 .material-list .item-label[data-v-61697f5a]{color:#999}.zjapp .detail-traceability3 .material-list .item-text[data-v-61697f5a]{color:#333}.zjapp .detail-traceability3 .conditon.disabled[data-v-61697f5a] .van-icon{display:none}.zjapp .detail-traceability3 .title[data-v-61697f5a]{color:#333}.zjapp .detail-traceability3 .title-nodata[data-v-61697f5a]{font-size:12px;color:#999;margin-left:5px}",""])},"27c4":function(t,e,a){var i=a("db6b2");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("42e360af",i,!0,{sourceMap:!1,shadowMode:!1})},"2c76":function(t,e,a){"use strict";a("c070")},3050:function(t,e,a){"use strict";e.__esModule=!0,e.default=void 0;e.default={name:"姓名",tel:"电话",save:"保存",confirm:"确认",cancel:"取消",delete:"删除",complete:"完成",loading:"加载中...",telEmpty:"请填写电话",nameEmpty:"请填写姓名",confirmDelete:"确定要删除么",telInvalid:"请填写正确的电话",vanContactCard:{addText:"添加联系人"},vanContactList:{addText:"新建联系人"},vanPagination:{prev:"上一页",next:"下一页"},vanPullRefresh:{pulling:"下拉即可刷新...",loosing:"释放即可刷新..."},vanSubmitBar:{label:"合计："},vanCoupon:{valid:"有效期",unlimited:"无使用门槛",discount:function(t){return t+"折"},condition:function(t){return"满"+t+"元可用"}},vanCouponCell:{title:"优惠券",tips:"使用优惠",count:function(t){return t+"张可用"}},vanCouponList:{empty:"暂无优惠券",exchange:"兑换",close:"不使用优惠",enable:"可使用优惠券",disabled:"不可使用优惠券",placeholder:"请输入优惠码"},vanAddressEdit:{area:"地区",postal:"邮政编码",areaEmpty:"请选择地区",addressEmpty:"请填写详细地址",postalEmpty:"邮政编码格式不正确",defaultAddress:"设为默认收货地址",telPlaceholder:"收货人手机号",namePlaceholder:"收货人姓名",areaPlaceholder:"选择省 / 市 / 区"},vanAddressEditDetail:{label:"详细地址",placeholder:"街道门牌、楼层房间号等信息"},vanAddressList:{add:"新增地址"}}},"31a3":function(t,e,a){var i=a("c7f0");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("3f5aa847",i,!0,{sourceMap:!1,shadowMode:!1})},"3c64":function(t,e,a){"use strict";a("163d");var i={name:"ItemTextarea",components:{},props:{value:{type:String,default:""},placeholder:{type:String,default:""},maxlength:{type:Number,default:200},borderBottom:{type:Boolean,default:!0}},data:function(){return{textareaHeight:40,isLock:!1,blurTime:null}},computed:{lastLength:function(){var t=this.value&&this.value.length||0,e=this.maxlength-t;return e>0?e:0}},mounted:function(){var t=this;this.$nextTick((function(){t.textareaHeight=t.$refs.rule&&t.$refs.rule.offsetHeight||40}))},methods:{onfocus:function(){var t=(new Date).getTime();this.blurTime&&t-this.blurTime<300&&window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(this.$refs.input.blur(),window.cordova.plugins.Keyboard.close()),this.blurTime=null,this.$emit("focus")},onblur:function(){this.blurTime=(new Date).getTime(),this.$emit("blur")},setStatus:function(t){console.log(t),this.isLock=t},oninput:function(t){var e=this;setTimeout((function(){if(!e.isLock){var a=t.target.value;a.length>e.maxlength&&(a=a.substring(0,e.maxlength),e.$refs.input.value=a),e.$refs.rule.innerText=a,e.textareaHeight=e.$refs.rule&&e.$refs.rule.offsetHeight+20,e.$emit("input",a),e.$emit("change",a)}}),0)}}},n=(a("2c76"),a("17cc")),r=Object(n.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"item-textarea",class:{"border-bottom":t.borderBottom}},[a("div",{staticClass:"item-textarea-content"},[a("textarea",{ref:"input",style:{height:t.textareaHeight+"px"},attrs:{placeholder:t.placeholder},domProps:{value:t.value},on:{focus:t.onfocus,blur:t.onblur,compositionstart:function(e){t.setStatus(!0)},compositionend:function(e){t.setStatus(!1)},input:t.oninput}}),a("div",{ref:"rule",staticClass:"rule"},[t._v("\n      "+t._s(t.value)+"\n    ")]),t.maxlength!==1/0?a("p",{staticClass:"counter"},[t._v("\n      "+t._s(t.lastLength)+"\n    ")]):t._e()])])}),[],!1,null,null,null);e.a=r.exports},"3fcb":function(t,e,a){var i=a("237e");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("37b37ee2",i,!0,{sourceMap:!1,shadowMode:!1})},"427f":function(t,e,a){"use strict";a("6cb0")},"42d6":function(t,e,a){"use strict";var i=a("8969").a,n=(a("7648"),a("17cc")),r=Object(n.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"detail-traceability1"},[a("item",{staticClass:"item-text_right",attrs:{label:"材料供应商",text:t.contractor}}),a("item",{staticClass:"item-text_right",attrs:{label:"供应商经办人",text:t.contractorBy}}),a("div",{staticClass:"m10"}),a("van-collapse",{staticClass:"traceability-collapse",model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[a("van-collapse-item",{staticClass:"conditon",attrs:{name:1}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("材料信息")]),a("div",{staticClass:"info-main"},[t.basic.length?a("div",{staticClass:"info-title"},[t._v("基本信息")]):t._e(),a("div",{staticClass:"info-list"},t._l(t.basic,(function(e,i){return a("item",{key:i,attrs:{label:e.name,border:"bottom",mode:"edit"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"item.value"}],staticClass:"input-align-r f16",attrs:{slot:"right",type:"text",placeholder:"请输入",maxlength:"200"},domProps:{value:e.value},on:{input:function(a){a.target.composing||t.$set(e,"value",a.target.value)}},slot:"right"})])}))),t.composition.length?a("div",{staticClass:"info-title"},[t._v("产品构造")]):t._e(),a("div",{staticClass:"info-list"},t._l(t.composition,(function(e,i){return a("item",{key:i,attrs:{label:e.name,border:"bottom",mode:"edit"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"item.value"}],staticClass:"input-align-r f16",attrs:{slot:"right",type:"text",placeholder:"请输入",maxlength:"200"},domProps:{value:e.value},on:{input:function(a){a.target.composing||t.$set(e,"value",a.target.value)}},slot:"right"})])}))),a("div",{staticClass:"info-title"},[t._v("影视资料")]),a("div",{staticClass:"info-list"},[a("item",[a("item-img-list",{ref:"check-edit-item-img",attrs:{maxlength:50,"allow-select-album":!0,"allow-buildin-album":!0,"track-text":"材料溯源"},model:{value:t.image_file,callback:function(e){t.image_file=e},expression:"image_file"}})],1)],1)]),a("loading-status",{staticClass:"traceability-empty",attrs:{"is-empty":!t.basic.length,"empty-text":"暂无基本信息"}})],1),a("van-collapse-item",{staticClass:"conditon",attrs:{name:2}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("原材信息")]),t._l(t.material_information,(function(e,i){return a("div",{key:i,staticClass:"information-item"},[a("div",{staticClass:"information-item_delete",on:{click:function(a){t.informationDelete(e,i)}}},[Boolean(!1===e.can_change_user)?t._e():a("i")]),a("div",{staticClass:"information-item_right"},[a("single-select",{attrs:{options:t.contractorList,"form-check":e.formCheck,title:"原材商",editabled:e.can_change_user},on:{onSelect:function(e){t.changeContractor(e,i)}},model:{value:e.information,callback:function(a){t.$set(e,"information",a)},expression:"item.information"}}),a("user-select",{attrs:{"form-check":e.formCheck,options:t.contractorUsersList[e.information.id]||[],"linked-data":e.information,"before-open":t.checkContractorIsAvailable,editabled:e.can_change_user,title:"原材商经办人"},model:{value:e.informationBy,callback:function(a){t.$set(e,"informationBy",a)},expression:"item.informationBy"}})],1)])})),t.material_information.length&&t.maximumLength?a("div",{staticClass:"information-add",on:{click:t.informationAdd}},[t._v("\n        添加原材商\n      ")]):t._e(),a("loading-status",{staticClass:"traceability-empty",attrs:{type:"todo","is-empty":!t.material_information.length,"empty-text":""}},[t.maximumLength?a("div",{staticClass:"information-add",attrs:{slot:"empty-content"},on:{click:t.informationAdd},slot:"empty-content"},[t._v("\n          添加原材商\n        ")]):t._e()])],2)],1),a("app-button-group",[a("app-button",{on:{click:t.submit}},[t._v("提交")])],1)],1)}),[],!1,null,"41a06b36",null);e.a=r.exports},4412:function(t,e,a){"use strict";e.__esModule=!0,e.createBEM=function(t){return function(e,a){return e&&"string"!=typeof e&&(a=e,e=""),e=i(t,e,"__"),a?[e,n(e,a)]:e}};function i(t,e,a){return e?t+a+e:t}function n(t,e){if("string"==typeof e)return i(t,e,"--");if(Array.isArray(e))return e.map((function(e){return n(t,e)}));var a={};return e&&Object.keys(e).forEach((function(i){a[t+"--"+i]=e[i]})),a}},4603:function(t,e,a){"use strict";(function(t){a("163d"),a("cc57"),a("6d57"),a("06a2");var i=a("1b7e"),n=a("e2a7"),r=a("6bf2"),o=a.n(r),s=a("3122"),l=a("162a"),c=a("3bd5"),d=a("9094");function u(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm";return t.isEmpty(e)?"":o()(e).format(a)}function m(){return i.a.getHasNetwork().then((function(t){if(!t)return n.a.alert("当前无网络"),Promise.reject("no network")}))}function f(t){try{return t&&"string"==typeof t?JSON.parse(t):t}catch(e){return t}}function p(e){var a=[];return t.each(e,(function(t){!t.url&&t.temp?a.push(s.a.uploadImage(t.temp).then((function(e){t.url=e,delete t.temp}))):delete t.temp,!t.videoUrl&&t.videoTemp?a.push(s.a.uploadImage(t.videoTemp).then((function(e){t.videoUrl=e,delete t.videoTemp}))):delete t.videoTemp})),Promise.all(a).then((function(){return e}))}var h={getSectionList:function(t){return l.a.request("/online/common/get-bidsection-list-of-project",{proj_id:t}).catch((function(t){return $log.error("获取标段列表-error：",t),Promise.reject(t)}))},getMaterialList:function(){return Object(d.c)().catch((function(t){return $log.error("获取标段下材料列表-error：",t),Promise.reject(t)}))},getBrandList:function(t){return l.a.request("/online/common/get-brand-list-of-material",{material_id:t}).catch((function(t){return $log.error("获取材料下品牌列表-error：",t),Promise.reject(t)}))},getContractorList:function(t){return Object(d.b)({proj_id:t}).catch((function(t){return $log.error("获取标段下供应商列表-error：",t),Promise.reject(t)}))},getContractorUsersList:function(t){return l.a.request("/online/common/get-users-of-contractor",{contractor_id:t}).then((function(t){return(t||[]).map((function(t){return t.head_portrait=function(t,e){try{return t?s.a.getThumbnailFromUrl(t):"image"===e?"static/photo-default.png":"static/default_img_simple.png"}catch(t){return"image"===e?"static/photo-default.png":"static/default_img_simple.png"}}(t.headimg_url,"avater"),t}))})).catch((function(t){return $log.error("获取供应商下用户-error：",t),Promise.reject(t)}))},postSubmitTask:function(t){return n.a.loading("正在提交..."),m().then((function(){var e={proj_id:t.proj_id,name:t.name,material_id:t.materialId,brand_id:t.brandId,contractor_id:t.contractorId,agent_user_id:t.contractorUsersId,place:t.place,remark:t.remark};return t.id&&(e.id=t.id),$log.log("材料溯源-提交任务-数据：",e),l.a.post("/online/material-traceability/save-task",null,e).then((function(t){return n.a.hideLoading(),n.a.alert("提交成功"),t})).catch((function(t){return n.a.hideLoading(),n.a.alert(t.errmsg),Promise.reject(t)}))})).catch((function(t){return $log.error("材料溯源-提交任务-error：",t),Promise.reject(t)}))},getIndexList:function(t){return m().then((function(){return l.a.request("/online/material-traceability/task-list",t).then((function(t){return t.items=(t.items||[]).map((function(t){return t.created_on=u(t.created_on,"YYYY-MM-DD"),t})),t}))})).catch((function(t){return $log.error("材料溯源-列表-error：",t),Promise.reject(t)}))},getTaskDetail:function(t){return m().then((function(){return l.a.request("/online/material-traceability/get-task-detail",{id:t})})).then((function(t){return t?{id:t.id,can_change_user:t.can_change_user,created_by_name:t.created_by_name,can_edit:t.can_edit,section:{id:t.bidsection_id,name:t.bidsection_name},material:{id:t.material_id,name:t.material_name},brand:{id:t.brand_id,name:t.brand_name},contractor:{id:t.contractor_id,name:t.contractor_name},contractorUsers:{id:t.agent_user_id,name:t.agent_user_name},place:t.place,remark:t.remark,name:t.name}:Promise.reject(t.errmsg)})).catch((function(t){return $log.error("材料溯源-任务详情-error：",t),Promise.reject(t)}))},getTraceabilityDetail:function(e){return m().then((function(){return l.a.request("/online/material-traceability/get-trace-detail",{id:e}).then((function(e){if(!e)return Promise.reject(e.errmsg);e.task&&(e.task.basic_info=f(e.task.basic_info),e.task.composition=f(e.task.composition)),e.supply&&(e.supply.images=f(e.supply.images),e.supply.basic_info=f(e.supply.basic_info),e.supply.composition=f(e.supply.composition)),e.status=Number(e.status);var a=e.task,i=void 0===a?{}:a,n=e.supply,r=void 0===n?{}:n,o=e.raw_supply,s=void 0===o?{}:o;i=i||{},r=r||{},s=s||[];var l=t.isEmpty(r.basic_info)?(i.basic_info||[]).map((function(t){return{name:t,value:""}})):r.basic_info,d=t.isEmpty(r.composition)?(i.composition||[]).map((function(t){return{name:t,value:""}})):r.composition,m=t.isEmpty(s)?[]:(s||[]).map((function(t){return{id:t.id,can_change_user:t.can_change_user,information:{id:t.contractor_id,name:t.contractor_name,formCheck:!1},informationBy:{id:t.agent_user_id,name:t.agent_user_name,formCheck:!1}}})),p={basic:l,composition:d,image_file:r.images||[],material_information:m,proj_id:i.proj_id,contractor:r.contractor_name,contractorBy:r.agent_user_name},h=s.filter((function(t){return t.agent_user_id===c.a.getUser().user_id}))[0]||{},b=t.isEmpty(h.raw_material_info)?[{name:"",remark:"",image_file:[]}]:f(h.raw_material_info||[{name:"",remark:"",image_file:[]}]);return{traceability1:p,traceability2:{id:h.id,material:h.contractor_name,materialBy:h.agent_user_name,remark:i.guideline,materialList:b},traceability3:{material:{basic:r.basic_info||[],product:r.composition||[],submit_time:u(r.submit_time,"YYYY-MM-DD"),annotate:"".concat(r.agent_user_name," - ").concat(r.contractor_name),image_file:r.images||[],can_edit:r.can_edit},rawMaterial:s.filter((function(t){return 0===Number(t.is_system_created)})).map((function(t){return t.annotate="".concat(t.agent_user_name," - ").concat(t.contractor_name),t.submit_time=u(t.submit_time,"YYYY-MM-DD"),t.raw_material_info=f(t.raw_material_info||"[]"),t}))},status:e.status,title:i.name}}))})).catch((function(t){return $log.error("材料溯源-任务详情-error：",t),Promise.reject(t)}))},postSaveTraceabilitySupplier:function(t){return n.a.loading("正在提交..."),m().then((function(){return p(t.image_file).then((function(e){t.image_file=e})).then((function(){var e={task_id:t.id,basic_info:JSON.stringify(t.basic),composition:JSON.stringify(t.composition),images:JSON.stringify(t.image_file),raw_supply:JSON.stringify(t.material_information),proj_id:t.proj_id};return l.a.post("/online/material-traceability/save-supply-data",null,e).then((function(t){return n.a.hideLoading(),n.a.alert("提交成功"),t})).catch((function(t){return n.a.hideLoading(),n.a.alert(t.errmsg),Promise.reject(t)}))}))})).catch((function(t){return $log.error("材料溯源-供应商数据-error：",t),Promise.reject(t)}))},postSaveRawMaterial:function(e){return n.a.loading("正在提交..."),m().then((function(){var a=[];return t.each(e.materialList,(function(t){var e=p(t.image_file).then((function(e){t.image_file=e}));a.push(e)})),Promise.all(a).then((function(){var t={id:e.id,raw_material_info:JSON.stringify(e.materialList)};return l.a.post("/online/material-traceability/save-raw-supply-data",null,t).then((function(t){return n.a.hideLoading(),n.a.alert("提交成功"),t})).catch((function(t){return n.a.hideLoading(),n.a.alert(t.errmsg),Promise.reject(t)}))}))})).catch((function(t){return $log.error("材料溯源-原材商保存-error：",t),Promise.reject(t)}))},getInfluencesList:function(t,e){return m().then((function(){var a={process:"get-process-list",accept:"get-accept-list",assemble:"get-assemble-list"}[e];return $log.log("材料溯源-加工出厂等列表-参数：",t,a),l.a.request("/online/material-traceability/".concat(a),t).then((function(t){return t&&t.items?(t.items=t.items.map((function(t){return t.created_info=[{id:t.user_id,name:t.user_name}],t.created_on=u(t.created_on),t.images=f(t.images||"[]"),t})),t):Promise.reject(t.errmsg)}))})).catch((function(t){return $log.error("材料溯源-加工出厂等列表-error：",t),Promise.reject(t)}))},postSaveInfluences:function(t,e){return n.a.loading("正在提交..."),m().then((function(){return p(t.images).then((function(e){t.images=e})).then((function(){var a={task_id:t.task_id,proj_id:t.proj_id,images:JSON.stringify(t.images),remark:t.remark};t.id&&(a.id=t.id);var i={process:"save-process-data",accept:"save-accept-data",assemble:"save-assemble-data"}[e];return l.a.post("/online/material-traceability/".concat(i),null,a).then((function(t){return n.a.hideLoading(),n.a.alert("提交成功"),t})).catch((function(t){return n.a.hideLoading(),n.a.alert(t.errmsg),Promise.reject(t)}))}))})).catch((function(t){return $log.error("材料溯源-加工出厂、进场验收、安装的保存-error：",t),Promise.reject(t)}))},postDelelteTask:function(t){return n.a.loading("正在提交..."),m().then((function(){return $log.log("材料溯源-删除任务-参数：",t),l.a.post("/online/material-traceability/delete-task",null,{id:t}).then((function(t){return n.a.hideLoading(),n.a.alert("删除成功"),t})).catch((function(t){return n.a.hideLoading(),n.a.alert(t.errmsg),Promise.reject(t)}))})).catch((function(t){return $log.error("材料溯源-删除任务-error：",t),Promise.reject(t)}))}};e.a=h}).call(this,a("391c"))},"4d1b":function(t,e,a){"use strict";var i=a("c5a7");e.__esModule=!0,e.default=void 0;var n=i(a("329b")),r=a("53a5"),o=i(a("3050")),s=n.default.prototype,l=n.default.util.defineReactive;l(s,"$vantLang","zh-CN"),l(s,"$vantMessages",{"zh-CN":o.default});var c={messages:function(){return s.$vantMessages[s.$vantLang]},use:function(t,e){var a;s.$vantLang=t,this.add(((a={})[t]=e,a))},add:function(t){void 0===t&&(t={}),(0,r.deepAssign)(s.$vantMessages,t)}};e.default=c},"53a5":function(t,e,a){"use strict";e.__esModule=!0,e.deepAssign=r;var i=a("b7b4"),n=Object.prototype.hasOwnProperty;function r(t,e){return Object.keys(e).forEach((function(a){!function(t,e,a){var o=e[a];(0,i.isDef)(o)&&(n.call(t,a)&&(0,i.isObj)(o)&&"function"!=typeof o?t[a]=r(Object(t[a]),e[a]):t[a]=o)}(t,e,a)})),t}},"55fa":function(t,e,a){"use strict";a("31a3")},"574c":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .item-textarea{background-color:#fff;padding:5px 15px}.zjapp .item-textarea-content{position:relative}.zjapp .item-textarea .rule,.zjapp .item-textarea textarea{width:100%;min-height:40px;line-height:20px;font-size:16px;padding:0;border:none}.zjapp .item-textarea .rule{position:absolute;top:0;left:0;visibility:hidden;word-break:break-all}.zjapp .item-textarea .counter{text-align:right;margin:0 0 -5px 0;height:15px;line-height:15px;color:#b2b2b2;font-size:12px}",""])},"5a34":function(t,e,a){"use strict";(function(t){a("6d57"),a("e10e");var i=a("774b"),n=a("42d6"),r=a("13a0"),o=a("941a"),s=a("4603");e.a={name:"DetailTraceability",components:{Scroller:i.a,DetailTraceability1:n.a,DetailTraceability2:r.a,DetailTraceability3:o.a},data:function(){return{isLoading:!1,emptyTips:"暂无数据",mode:2,traceability1:{},traceability2:{},traceability3:{}}},computed:{id:function(){return this.$store.state.materialTraceability.id},noData:function(){var t=this[["traceability1","traceability2","traceability3"][this.mode-1]];return 0===Object.keys(t||{}).length}},methods:{init:function(){var t=this.refsSelect();t&&t.result(),this.getTraceabilityDetail()},refsSelect:function(){var t=this.mode-1;return this.$refs[["traceability1","traceability2","traceability3"][t]]},edit:function(e,a){var i=this;if(this.mode=e,2===e){var n=this.traceability2;this.traceability2={id:a.id,material:a.contractor_name,materialBy:a.agent_user_name,remark:n.remark,materialList:t.isEmpty(a.raw_material_info)?[{name:"",remark:"",image_file:[]}]:a.raw_material_info}}this.$nextTick((function(){var t=i.refsSelect();t&&t.init()}))},getTraceabilityDetail:function(){var t=this;return this.isLoading=!0,s.a.getTraceabilityDetail(this.id).then((function(e){t.traceability1=e.traceability1,t.traceability2=e.traceability2,t.traceability3=e.traceability3,console.log("材料溯源-溯源页面-处理后的数据：",JSON.parse(JSON.stringify(e))),t.mode=e.status,t.$store.commit("materialTraceability/SET_DETAIL_TITLE",e.title),t.$nextTick((function(){t.refsSelect().init()}))})).finally((function(){t.isLoading=!1}))}}}}).call(this,a("391c"))},6147:function(t,e,a){"use strict";e.__esModule=!0,e.createNamespace=function(t){return t="van-"+t,[(0,n.createComponent)(t),(0,i.createBEM)(t),(0,r.createI18N)(t)]};var i=a("4412"),n=a("7e06"),r=a("65af")},"65af":function(t,e,a){"use strict";var i=a("c5a7");e.__esModule=!0,e.createI18N=function(t){var e=(0,r.camelize)(t)+".";return function(t){for(var a=(0,n.get)(o.default.messages(),e+t)||(0,n.get)(o.default.messages(),t),i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return"function"==typeof a?a.apply(void 0,r):a}};var n=a("b7b4"),r=a("a1aa"),o=i(a("4d1b"))},6718:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));a("163d"),a("cc57");var i=a("b7b4"),n={name:"SwipeTab",props:{title:{type:String}},data:function(){return{offset:0,style:{},bem:Object(i.createNamespace)("swipe-item")[1](),parent:{}}},computed:{index:function(){return this.parent.tabs.indexOf(this)}},beforeCreate:function(){this.$parent.swipes.push(this)},created:function(){this.findParent("SwipeTabs")},destroyed:function(){this.$parent.swipes.splice(this.$parent.swipes.indexOf(this),1)},mounted:function(){var t=this,e=this.parent.tabs,a=this.parent.$slots.default.indexOf(this.$vnode);e.splice(-1===a?e.length:a,0,this),this.$nextTick((function(){var e=t.$parent,a=e.vertical,i=e.computedWidth,n=e.computedHeight;t.style={width:i+"px",height:a?i+"px":n+"px",transform:"translate".concat(a?"Y":"X","(").concat(t.offset,"px)")}}))},methods:{findParent:function(t){for(var e=this.$parent;e;){if(e.$options.name===t){this.parent=e;break}e=e.$parent}}}},r=a("17cc"),o=Object(r.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("div",this._g({class:this.bem,style:this.style},this.$listeners),[this._t("default")],2)}),[],!1,null,null,null).exports,s={name:"SwipeTabs",model:{prop:"tabIndex",event:"change"},props:{tabIndex:{type:Number,default:0},markType:{type:String,default:"line"},showTabs:{type:Boolean,default:!0},touchable:{type:Boolean,default:!0}},data:function(){return{curIndex:0,initIndex:0,tabs:[],tabScrollVersion:null}},computed:{tabsPadding:function(){return Math.max(24-4*this.tabs.length,0)},markLeft:function(){var t=(100-2*this.tabsPadding)/this.tabs.length;return this.tabsPadding+(this.curIndex+.5)*t}},watch:{tabIndex:function(t){t!==this.curIndex&&(this.curIndex=t,this.$refs.swipe.swipeTo(t,{immediate:!0}))},curIndex:function(){this.scrollTabsTocurrent()}},created:function(){this.initIndex=this.tabIndex,this.curIndex=this.tabIndex},activated:function(){this.initIndex=this.tabIndex,this.curIndex=this.tabIndex},mounted:function(){this.$nextTick(this.scrollTabsTocurrent)},methods:{changeIndex:function(t){this.$refs.swipe.swipeTo(t)},onChange:function(t){this.curIndex=t,this.$emit("change",t)},scrollTabsTocurrent:function(){var t=this.$refs["tabs-scroll"],e=this.$refs["tab-point"]?this.$refs["tab-point"][this.curIndex]:null;if(t&&e){var a=t.getBoundingClientRect(),i=e.getBoundingClientRect(),n=i.left-a.left,r=a.right-i.right;n<0&&this.tabScrollBy(n),r<0&&this.tabScrollBy(-r)}},tabScrollBy:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,i=this.$refs["tabs-scroll"];if(i){var n=i.scrollLeft,r=n+t,o=Math.round(a/16.7),s=t/o,l=n,c=this.tabScrollVersion=+new Date;return n===r?Promise.resolve():new Promise((function(t){!function a(){window.requestAnimationFrame((function(){c===e.tabScrollVersion&&(l+=s,i.scrollLeft=l,n<r&&l<r||n>r&&l>r?a():(i.scrollTop=r,t()))}))}()}))}}}},l=(a("bcf4"),Object(r.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"swipe-tabs"},[t.showTabs?["line"===t.markType?a("div",{staticClass:"tabs border-bottom",style:{padding:"0 "+Math.max(24-4*t.tabs.length,0)+"%"}},[t._l(t.tabs,(function(e){return a("div",{key:e.index,staticClass:"tab",class:{"tab-current":e.index===t.curIndex},on:{click:function(a){t.changeIndex(e.index)}}},[t._v("\n        "+t._s(e.title)+"\n      ")])})),a("div",{staticClass:"mark-line",style:{left:t.markLeft+"%"}})],2):t._e(),"point"===t.markType?a("div",{staticClass:"tabs-point border-bottom"},[a("div",{ref:"tabs-scroll",staticClass:"tabs-scroll"},t._l(t.tabs,(function(e){return a("div",{key:e.index,ref:"tab-point",refInFor:!0,staticClass:"tab-point",class:{"tab-current":e.index===t.curIndex},on:{click:function(a){t.changeIndex(e.index)}}},[t._v("\n          "+t._s(e.title)+"\n        ")])})))]):t._e()]:t._e(),t._t("fixed"),a("van-swipe",{ref:"swipe",attrs:{"initial-swipe":t.initIndex,"show-indicators":!1,duration:250,loop:!1,touchable:t.touchable},on:{change:t.onChange}},[t._t("default")],2)],2)}),[],!1,null,"025feb99",null));e.b=l.exports},"6cb0":function(t,e,a){var i=a("c5fd");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("12c8d735",i,!0,{sourceMap:!1,shadowMode:!1})},"6dc2":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .detail-influences[data-v-6a228e2e]{height:100%;display:flex;flex-direction:column}.zjapp .detail-influences .influences-edit[data-v-6a228e2e]{color:#4275e8;font-size:14px;margin-left:5px}.zjapp .detail-influences .influences-list[data-v-6a228e2e]{padding:10px 15px;background:#fff}.zjapp .detail-influences .influences-item[data-v-6a228e2e]{padding:8px 10px;margin-bottom:10px;background:#fafafa}.zjapp .detail-influences .influences-item[data-v-6a228e2e]:last-child{margin-bottom:0}.zjapp .detail-influences .influences-item .item[data-v-6a228e2e]{padding:8px 0;background:#fafafa}.zjapp .detail-influences .influences-item .item-label[data-v-6a228e2e]{color:#999}.zjapp .detail-influences .influences-item .item-text[data-v-6a228e2e]{color:#333}",""])},7648:function(t,e,a){"use strict";a("c589")},"7e06":function(t,e,a){"use strict";var i=a("c5a7");e.__esModule=!0,e.unifySlots=s,e.createComponent=function(t){return function(e){var a;return"function"==typeof e&&(e={functional:!0,props:(a=e).props,model:a.model,render:function(t,e){return a(t,e.props,s(e),e)}}),e.functional||(e.mixins=e.mixins||[],e.mixins.push(r.SlotsMixin)),e.name=t,e.install=o,e}},a("4d1b");var n=a("a1aa"),r=a("1304");i(a("329b"));function o(t){var e=this.name;t.component(e,this),t.component((0,n.camelize)("-"+e),this)}function s(t){var e=t.scopedSlots||t.data.scopedSlots||{},a=t.slots();return Object.keys(a).forEach((function(t){e[t]||(e[t]=function(){return a[t]})})),e}},"853c":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .material-traceability-detail .detail-tabs[data-v-28c3ae48] .tab{padding:10px 3px}",""])},"876b":function(t,e,a){var i=a("6dc2");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("5cd32283",i,!0,{sourceMap:!1,shadowMode:!1})},8969:function(t,e,a){"use strict";(function(t){a("ed63"),a("cc57");var i=a("07d2"),n=a("e68e"),r=a("5a71"),o=a("cd05"),s=a("e2a7"),l=a("4603");a("f97c");e.a={name:"DetailTraceability1",components:{Item:i.a,ItemImgList:n.a,SingleSelect:r.a,UserSelect:o.a},props:{data:{type:Object,data:function(){}}},data:function(){return{activeNames:[1,2],contractor:"",contractorBy:"",basic:[],composition:[],material_information:[],image_file:[],contractorList:[],contractorUsersList:{},proj_id:"",maximumLength:!0}},computed:{id:function(){return this.$store.state.materialTraceability.id}},activated:function(){},methods:{init:function(){var t=this.data,e=t.contractor,a=t.contractorBy,i=t.basic,n=t.composition,r=t.material_information,o=t.image_file,s=t.proj_id;this.contractor=e||"",this.contractorBy=a||"",this.basic=i||[],this.composition=n||[],this.material_information=r||[],this.image_file=o||[],this.proj_id=s,this.maximumLength=r&&r.length<=10,this.getContractorList()},result:function(){this.activeNames=[1,2],this.contractor="",this.contractorBy="",this.basic=[],this.composition=[],this.material_information=[],this.image_file=[],this.contractorList=[],this.contractorUsersList={}},submit:function(){var e=this,a=this.basic,i=this.composition,n=this.material_information;for(var r in a){var o=a[r];if(t.isEmpty(o.value))return void s.a.alert("请填写基本信息-".concat(o.name))}for(var c in i){var d=i[c];if(t.isEmpty(d.value))return void s.a.alert("请填写产品构造-".concat(d.name))}for(var u=[],m=0;m<n.length;m++){var f=n[m];if(!f.information.id||!f.informationBy.id)return this.$set(this.material_information,m,Object.assign(f,{formCheck:!0})),s.a.alert("请完善原材商信息"),!1;if(u.includes(f.informationBy.id))return s.a.alert("原材商经办人不能重复"),!1;u.push(f.informationBy.id)}n=n.map((function(t){return{id:t.id,contractor_id:t.information.id,agent_user_id:t.informationBy.id}}));var p={basic:a,composition:i,image_file:this.image_file,material_information:n,id:this.id,proj_id:this.proj_id};return l.a.postSaveTraceabilitySupplier(p).then((function(){setTimeout((function(){e.$emit("result")}),500)}))},getContractorList:function(){var t=this;l.a.getContractorList(this.proj_id).then((function(e){t.contractorList=e}))},checkContractorIsAvailable:function(t){var e=this,a=this.contractorUsersList;return $log.log("材料溯源-溯源-供应商添加数据-点击供应人选择：",t," 已选择原材商：",Boolean(t&&t.id)," 请求供应人列表：",Boolean(t&&t.id&&(!a||!a[t.id]))),t&&t.id?!(!a||!a[t.id])||(s.a.loading("加载中..."),this.getContractorUsersList(t.id).then((function(){return new Promise((function(t){e.$nextTick((function(){s.a.hideLoading(),t(!0)}))}))})).catch((function(t){return s.a.alert(t.errmsg),s.a.hideLoading(),!1}))):(s.a.alert("请先选择原材商"),!1)},changeContractor:function(t,e){this.$set(this.contractorUsersList,t.id,[]),this.material_information=this.material_information.map((function(a,i){return a.information&&a.information.id===t.id&&i===e&&(a.informationBy={}),a})),this.getContractorUsersList(t.id)},getContractorUsersList:function(t){var e=this;return l.a.getContractorUsersList(t).then((function(a){e.$set(e.contractorUsersList,t,a)}))},informationDelete:function(t,e){if(!1===t.can_change_user)return!1;var a=this.material_information;a.splice(e,1),this.material_information=a,this.maximumLength=!0},informationAdd:function(){this.material_information.push({information:{},informationBy:{}}),this.material_information.length>=10&&(this.maximumLength=!1)}}}}).call(this,a("391c"))},9094:function(t,e,a){"use strict";a.d(e,"c",(function(){return o})),a.d(e,"b",(function(){return s})),a.d(e,"a",(function(){return l}));var i=a("5e8d"),n=a("da71"),r=a("162a");function o(){return Object(i.a)().then((function(){var t=n.a.materialList.url;return r.a.request(t)}))}function s(t){return Object(i.a)().then((function(){var e=n.a.contractorListByProject.url;return r.a.request(e,t)}))}function l(t){return Object(i.a)().then((function(){var e=n.a.getContractList.url;return r.a.request(e,t)}))}},"941a":function(t,e,a){"use strict";var i=a("07d2"),n=a("e68e"),r={name:"DetailTraceability3",components:{Item:i.a,ItemImgList:n.a},props:{data:{type:Object,data:function(){}}},data:function(){return{activeNames:[],material:{basic:[],product:[],submit_time:"",annotate:"",image_file:[]},rawMaterial:[]}},computed:{materialNoDate:function(){return!((this.material.basic&&this.material.basic.length||this.material.product&&this.material.product.length)&&this.material.annotate)}},methods:{init:function(){this.material=this.data.material,this.rawMaterial=this.data.rawMaterial,this.isPutAway()},result:function(){this.activeNames=[1,2],this.material=[],this.rawMaterial=[],this.isPutAway()},isPutAway:function(){this.activeNames=[],this.materialNoDate||this.activeNames.push(1),this.rawMaterial.length&&this.activeNames.push(2)},edit:function(t,e){this.$emit("onEdit",t,e)}}},o=(a("ade5"),a("17cc")),s=Object(o.a)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"detail-traceability3"},[a("van-collapse",{staticClass:"traceability-collapse",model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[a("van-collapse-item",{staticClass:"conditon",class:{disabled:t.materialNoDate},attrs:{disabled:t.materialNoDate,name:1}},[a("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v("\n        材料信息"),t.materialNoDate?a("span",{staticClass:"title-nodata"},[t._v("暂无数据")]):t._e()]),t.materialNoDate?t._e():a("div",{staticClass:"info-main"},[a("div",{staticClass:"info-title"},[t._v("基本信息")]),a("div",{staticClass:"info-list"},t._l(t.material.basic,(function(t,e){return a("item",{key:e,staticClass:"item-text_right",attrs:{label:t.name,text:t.value}})}))),t.material.product&&t.material.product?a("div",{staticClass:"info-title"},[t._v("产品构造")]):t._e(),a("div",{staticClass:"info-list"},t._l(t.material.product,(function(t,e){return a("item",{key:e,staticClass:"item-text_right",attrs:{label:t.name,text:t.value}})}))),t.material.image_file&&t.material.image_file.length?a("div",{staticClass:"info-title"},[t._v("\n          影像资料\n        ")]):t._e(),a("item-img-list",{attrs:{editabled:!1},model:{value:t.material.image_file,callback:function(e){t.$set(t.material,"image_file",e)},expression:"material.image_file"}}),a("div",{staticClass:"founder-created"},[a("div",{staticClass:"founder-name"},[a("span",[t._v(t._s(t.material.submit_time))]),t._v(t._s(t.material.annotate)+"\n          ")]),t.material.can_edit?a("span",{staticClass:"founder-edit",on:{click:function(e){t.edit(1)}}},[t._v("修改")]):t._e()])],1),a("loading-status",{staticClass:"traceability-empty",attrs:{"is-empty":t.materialNoDate,"empty-text":"暂无材料信息"}})],1),a("van-collapse-item",{staticClass:"conditon",class:{disabled:!t.rawMaterial.length},attrs:{disabled:!t.rawMaterial.length,name:2}},[a("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v("\n        原材信息"),t.rawMaterial.length?t._e():a("span",{staticClass:"title-nodata"},[t._v("暂无数据")])]),t.rawMaterial.length?a("div",{staticClass:"material-main"},t._l(t.rawMaterial,(function(e,i){return a("div",{key:i,staticClass:"material-content"},[a("div",t._l(e.raw_material_info,(function(e,i){return a("div",{key:i,staticClass:"material-list"},[a("item",{attrs:{label:"原材名称",text:e.name}}),a("item",{attrs:{label:"原材说明",text:e.remark}}),e.image_file&&e.image_file.length?a("item",{attrs:{label:"影像资料"}},[a("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[a("item-img-list",{attrs:{editabled:!1},model:{value:e.image_file,callback:function(a){t.$set(e,"image_file",a)},expression:"x.image_file"}})],1)]):t._e()],1)}))),a("div",{staticClass:"founder-created"},[a("div",{staticClass:"founder-name"},[a("span",[t._v(t._s(e.submit_time))]),t._v(t._s(e.annotate)+"\n            ")]),e.can_edit?a("span",{staticClass:"founder-edit",on:{click:function(a){t.edit(2,e)}}},[t._v("修改")]):t._e()])])}))):t._e(),a("loading-status",{staticClass:"traceability-empty",attrs:{"is-empty":!t.rawMaterial.length,"empty-text":"暂无原材信息"}})],1)],1)],1)}),[],!1,null,"61697f5a",null);e.a=s.exports},a1aa:function(t,e,a){"use strict";e.__esModule=!0,e.camelize=function(t){return t.replace(i,(function(t,e){return e.toUpperCase()}))},e.padZero=function(t,e){void 0===e&&(e=2);var a=t+"";for(;a.length<e;)a="0"+a;return a};var i=/-(\w)/g},a240:function(t,e,a){var i=a("853c");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("03e133a6",i,!0,{sourceMap:!1,shadowMode:!1})},ade5:function(t,e,a){"use strict";a("3fcb")},b0f9:function(t,e,a){"use strict";a("876b")},b7b4:function(t,e,a){"use strict";var i=a("c5a7");e.__esModule=!0,e.noop=function(){},e.isDef=l,e.isObj=function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)},e.get=function(t,e){var a=e.split("."),i=t;return a.forEach((function(t){i=l(i[t])?i[t]:""})),i},e.isServer=e.addUnit=e.createNamespace=void 0;var n=i(a("329b")),r=a("6147");e.createNamespace=r.createNamespace;var o=a("2064");e.addUnit=o.addUnit;var s=n.default.prototype.$isServer;function l(t){return null!=t}e.isServer=s},bcf4:function(t,e,a){"use strict";a("27c4")},c070:function(t,e,a){var i=a("574c");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("35590dcb",i,!0,{sourceMap:!1,shadowMode:!1})},c589:function(t,e,a){var i=a("17f4");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("4b86c129",i,!0,{sourceMap:!1,shadowMode:!1})},c5a7:function(t,e){t.exports=function(t){return t&&t.__esModule?t:{default:t}}},c5fd:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .detail-traceability[data-v-6156a194] .traceability-collapse .van-collapse-item__title{padding:12px 15px;position:relative}.zjapp .detail-traceability[data-v-6156a194] .traceability-collapse .van-collapse-item__title:before{content:"";background:#4275e8;width:4px;height:16px;position:absolute;left:0;top:50%;transform:translateY(-50%)}.zjapp .detail-traceability[data-v-6156a194] .traceability-collapse .van-collapse-item__content{padding:0;background:initial}.zjapp .detail-traceability[data-v-6156a194] .traceability-collapse .van-collapse-item{margin-bottom:10px}.zjapp .detail-traceability[data-v-6156a194] .traceability-empty{min-height:250px}.zjapp .detail-traceability[data-v-6156a194] .traceability-empty .information-add{color:#4275e8;font-size:16px}',""])},c7f0:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".zjapp .influences-image[data-v-649de735]{padding:0 15px 13px;flex-direction:column;border-bottom:1px solid #ececec}.zjapp .influences-image[data-v-649de735] .item-label{line-height:46px;padding:0;color:#333}.zjapp .influences-textarea[data-v-649de735]{margin-bottom:30px}.zjapp .influences-textarea[data-v-649de735] textarea{min-height:88px}",""])},db6b2:function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,'.zjapp .swipe-tabs[data-v-025feb99]{display:flex;flex-direction:column;flex:1;overflow:hidden}.zjapp .tabs[data-v-025feb99]{position:relative;display:flex;background-color:#fff}.zjapp .tab[data-v-025feb99]{flex:1;height:40px;line-height:20px;padding:10px;font-size:14px;text-align:center;box-sizing:border-box}.zjapp .tab-current[data-v-025feb99]{color:#4275e8}.zjapp .mark-line[data-v-025feb99]{position:absolute;bottom:0;left:0;width:20px;height:2px;margin-left:-10px;background-image:linear-gradient(90deg,#5ea2ff,#4f83eb 50%,#4275e8);transition:left .4s cubic-bezier(.1,.7,.1,1)}.zjapp .tabs-point[data-v-025feb99]{position:relative;z-index:1;height:40px;font-size:0;text-align:center;background-color:#fff;overflow:visible}.zjapp .tabs-scroll[data-v-025feb99]{position:relative;padding-bottom:3px;margin-bottom:-3px;white-space:nowrap;overflow-x:auto}.zjapp .tabs-scroll[data-v-025feb99]::-webkit-scrollbar{display:none}.zjapp .tab-point[data-v-025feb99]{display:inline-block;padding:10px 15px;line-height:20px;font-size:16px;color:#333;white-space:nowrap}.zjapp .tab-point.tab-current[data-v-025feb99]{position:relative;z-index:3;color:#4275e8}.zjapp .tab-point.tab-current[data-v-025feb99]:after{content:"";position:absolute;z-index:3;bottom:-3px;left:50%;margin-left:-3px;width:7px;height:7px;border-radius:50%;background-color:#4275e8}',""])},dd74:function(t,e,a){"use strict";a.r(e);a("163d");var i=a("6718"),n=(a("f548"),a("cc57"),a("07d2")),r=a("774b"),o=a("4603"),s=a("e2a7"),l={name:"DetailTask",components:{Item:n.a,Scroller:r.a},data:function(){return{isLoading:!1,emptyTips:"暂无数据",form:{}}},computed:{noData:function(){var t=this.form;return!t||!t.id},id:function(){return this.$store.state.materialTraceability.id}},activated:function(){},methods:{init:function(){this.form={},this.getTaskDetail()},getTaskDetail:function(){var t=this;this.isLoading=!0,o.a.getTaskDetail(this.id).then((function(e){t.form=e})).catch((function(e){t.form={},t.emptyTips="no network"===e?"当前无网络连接":"暂无数据",-2===e.errcode&&(s.a.alert("任务不存在"),t.goIndex())})).finally((function(){t.isLoading=!1}))},deleteTask:function(){var t=this;s.a.confirm({message:"确定删除任务？"}).then((function(e){e&&o.a.postDelelteTask(t.form.id).then((function(){t.goIndex()}))}))},editTask:function(){var t=this.form;this.$router.push({name:"MaterialTraceabilityAddTask",query:{data:{id:t.id,name:t.name,material:t.material,brand:t.brand,contractor:t.contractor,contractorUsers:t.contractorUsers,place:t.place,remark:t.remark,can_change_user:t.can_change_user}}})},goIndex:function(){var t=this;this.$router.replace({name:"MaterialTraceability"}),setTimeout((function(){t.$router.go(-1)}),300)}}},c=a("17cc"),d=Object(c.a)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("scroller",{staticClass:"detail-task"},[t.noData||t.isLoading?t._e():a("div",[a("div",{staticClass:"m10"}),a("item",{attrs:{label:"材料名称",text:t.form.material.name}}),a("item",{attrs:{label:"品牌",text:t.form.brand.name}}),a("item",{attrs:{label:"材料供应商",text:t.form.contractor.name}}),a("item",{attrs:{label:"供应商经办人",text:t.form.contractorUsers.name}}),a("item",{attrs:{label:"创建人",text:t.form.created_by_name}}),t.form.place?a("item",{attrs:{label:"使用部位",text:t.form.place}}):t._e(),t.form.remark?a("item",{attrs:{label:"备注",text:t.form.remark}}):t._e(),a("div",{staticClass:"m10"}),a("div",{staticClass:"m10"}),a("div",{staticClass:"m10"}),t.form.can_edit?a("app-button-group",[a("app-button",{attrs:{type:"warning",plain:"",rimless:""},on:{click:t.deleteTask}},[t._v("\n        删除\n      ")]),a("app-button",{on:{click:t.editTask}},[t._v("\n        修改\n      ")])],1):t._e()],1),a("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":t.noData,"empty-text":t.emptyTips}})],1)}),[],!1,null,"1191cae7",null).exports,u=a("5a34").a,m=(a("427f"),Object(c.a)(u,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("scroller",[t.noData||t.isLoading?t._e():a("div",{staticClass:"detail-traceability"},[a("div",{staticClass:"m10"}),1===t.mode?a("detail-traceability1",{ref:"traceability1",attrs:{data:t.traceability1},on:{result:t.init}}):t._e(),2===t.mode?a("detail-traceability2",{ref:"traceability2",attrs:{data:t.traceability2},on:{result:t.init}}):t._e(),3===t.mode?a("detail-traceability3",{ref:"traceability3",attrs:{data:t.traceability3},on:{onEdit:t.edit}}):t._e()],1),a("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":t.noData,"empty-text":t.emptyTips}})],1)}),[],!1,null,"6156a194",null).exports),f=a("e68e"),p=a("9864"),h=a("329b"),b=a("3c64"),g=a("f97c"),v=a("4360"),_=a("e89f"),x={name:"InfluencesDialog",components:{Item:n.a,ItemTextarea:b.a,Scroller:r.a,ItemImgList:f.a},mixins:[_.a],data:function(){return{show:!1,title:"",images:[],remark:"",id:"",mode:""}},computed:{task_id:function(){return v.a.state.materialTraceability.id},proj_id:function(){return g.a.getDefaultProject().id}},methods:{openDialog:function(t){this.show=!0,this.title=t.title,this.onChange=t.onChange,this.images=t.images||[],this.remark=t.remark||"",this.id=t.id||null,this.mode=t.mode},close:function(){this.show=!1},submit:function(){var t=this;if(0!==this.images.length){var e={task_id:this.task_id,proj_id:this.proj_id,images:this.images,remark:this.remark};return this.id&&(e.id=this.id),o.a.postSaveInfluences(e,this.mode).then((function(){t.onChange(),t.close()}))}s.a.alert("照片不能为空")}}},y=(a("55fa"),Object(c.a)(x,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"slide-right"}},[a("page-content",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],attrs:{title:t.title,mode:"dialog","on-close":t.close}},[a("scroller",[a("item",{staticClass:"influences-image",attrs:{label:"影像资料"}},[a("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[a("item-img-list",{ref:"check-edit-item-img",attrs:{maxlength:50,"allow-select-album":!0,"allow-buildin-album":!0,"track-text":"材料溯源"},model:{value:t.images,callback:function(e){t.images=e},expression:"images"}})],1)]),a("item-textarea",{staticClass:"influences-textarea",attrs:{placeholder:"备注"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}}),a("app-button-group",[a("app-button",{on:{click:t.submit}},[t._v("提交")])],1)],1)],1)],1)}),[],!1,null,"649de735",null).exports),k=!1;k||(k=new(h.default.extend(y))({el:document.createElement("div")}),document.body.appendChild(k.$el));var j=k,w=a("6bf2"),C=a.n(w),z={name:"DetailInfluences",components:{Item:n.a,Scroller:r.a,ItemImgList:f.a,CheckUserContact:p.a},props:{title:{type:String,default:""},mode:{type:String,default:"process"}},data:function(){return{isLoading:!1,influences:[],loading:!1,hasNext:!1,page:1,page_size:15}},computed:{id:function(){return this.$store.state.materialTraceability.id},noData:function(){return!this.influences||!this.influences.length}},methods:{init:function(){this.page=1,this.isLoading=!0,this.influences=[],this.getList()},onRefresh:function(){return this.page=1,this.getList()},onloadUp:function(){return this.page+=1,this.getList()},getList:function(t){var e=this,a={task_id:this.id,page:this.page,page_size:this.page_size};return o.a.getInfluencesList(a,this.mode).then((function(t){e.influences=1===e.page?t.items:e.influences.concat(t.items),e.hasNext=t.has_next_page})).catch((function(){e.hasNext=!1})).finally((function(){e.isLoading=!1}))},addInfluences:function(){var t=this;j.openDialog({title:this.title,mode:this.mode,onChange:function(){t.init()}})},edit:function(t){var e=this;j.openDialog({title:this.title,mode:this.mode,images:t.images,remark:t.remark,id:t.id,onChange:function(){e.init()}})},formatDate:function(t){return C()(t).format("YYYY-MM-DD HH:mm")}}},L=(a("b0f9"),Object(c.a)(z,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"detail-influences"},[a("scroller",{attrs:{"has-next":t.hasNext,"is-empty":!t.influences.length},on:{loadNext:t.onloadUp}},[t.noData||t.isLoading?t._e():a("div",{staticClass:"m10"}),t.noData||t.isLoading?t._e():a("div",{staticClass:"influences-list"},t._l(t.influences,(function(e,i){return a("div",{key:i,staticClass:"influences-item"},[e.images&&e.images.length?a("item",{attrs:{label:"影像资料"}},[a("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[a("item-img-list",{attrs:{editabled:!1},model:{value:e.images,callback:function(a){t.$set(e,"images",a)},expression:"item.images"}})],1)]):t._e(),e.remark?a("item",{attrs:{label:"备注",text:e.remark}}):t._e(),a("item",{attrs:{label:"提交人"}},[a("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[e.created_info?a("check-user-contact",{attrs:{list:e.created_info}}):a("div",[t._v("系统预置")]),a("div",{staticClass:"color-light mt10"},[t._v("\n              "+t._s(t._f("formatDate")(e.created_on))+"\n              "),e.can_edit?a("span",{staticClass:"influences-edit",on:{click:function(a){t.edit(e)}}},[t._v("修改")]):t._e()])],1)])],1)}))),a("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":t.noData,"empty-text":t.title+"暂无数据"}})],1),a("app-button-group",{attrs:{"fixed-bottom":""}},[a("app-button",{on:{click:t.addInfluences}},[t._v("新增记录")])],1)],1)}),[],!1,null,"6a228e2e",null).exports),T={name:"MaterialTraceabilityDetail",components:{SwipeTabs:i.b,SwipeTab:i.a,DetailTask:d,DetailTraceability:m,DetailInfluences:L},data:function(){return{tabIndex:1}},computed:{title:function(){return this.$store.state.materialTraceability.detailTitle||"材料溯源"},tabsWidth:function(){return window.innerWidth/5},refsSelect:function(){return this.$refs[["detailTask","detailTraceability","detailTnfluences1","detailTnfluences2","detailTnfluences3"][this.tabIndex]]}},activated:function(){this.$router.isBack||this.init()},methods:{init:function(){var t=this.$route.query,e=Number(t.tabIndex);this.tabIndex=e||0===e?e:1,t.id&&this.$store.commit("materialTraceability/SET_ID",t.id),console.log("query.title",t.title),t.title&&this.$store.commit("materialTraceability/SET_DETAIL_TITLE",t.title),this.swipeSelect()},swipeSelect:function(){this.refsSelect.init()}}},$=(a("19b5"),Object(c.a)(T,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-content",{staticClass:"material-traceability-detail",attrs:{title:t.title,"show-go-root":!0}},[a("swipe-tabs",{staticClass:"detail-tabs",attrs:{color:"#4275e8","mark-type":"point","title-active-color":"#4275e8","line-width":t.tabsWidth},on:{change:t.swipeSelect},model:{value:t.tabIndex,callback:function(e){t.tabIndex=e},expression:"tabIndex"}},[a("swipe-tab",{attrs:{title:"任务"}},[a("detail-task",{ref:"detailTask"})],1),a("swipe-tab",{attrs:{title:"溯源"}},[a("detail-traceability",{ref:"detailTraceability"})],1),a("swipe-tab",{attrs:{title:"加工出厂"}},[a("detail-influences",{ref:"detailTnfluences1",attrs:{title:"加工出厂",mode:"process"}})],1),a("swipe-tab",{attrs:{title:"进场验收"}},[a("detail-influences",{ref:"detailTnfluences2",attrs:{title:"进场验收",mode:"accept"}})],1),a("swipe-tab",{attrs:{title:"安装"}},[a("detail-influences",{ref:"detailTnfluences3",attrs:{title:"安装",mode:"assemble"}})],1)],1)],1)}),[],!1,null,"28c3ae48",null));e.default=$.exports},de148:function(t,e,a){var i=a("1300");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("85cb").default)("2bcdb042",i,!0,{sourceMap:!1,shadowMode:!1})},e5fe:function(t,e,a){"use strict";a("de148")},f24f:function(t,e,a){"use strict";e.__esModule=!0,e.isNumber=function(t){return/^\d+(\.\d+)?$/.test(t)},e.isNaN=function(t){if(Number.isNaN)return Number.isNaN(t);return t!=t}}}]);