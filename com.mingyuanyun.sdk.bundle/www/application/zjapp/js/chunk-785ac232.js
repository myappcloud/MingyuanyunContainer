(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-785ac232","chunk-2d0d2f53"],{"19a9":function(e,t,i){"use strict";i("7d4e")},"394b":function(e,t,i){var r=i("8d4c");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,i("85cb").default)("a723c790",r,!0,{sourceMap:!1,shadowMode:!1})},4574:function(e,t,i){var r=i("72b4");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,i("85cb").default)("572ae04e",r,!0,{sourceMap:!1,shadowMode:!1})},"4aef":function(e,t,i){"use strict";var r=i("dd16").a,a=i("17cc"),n=Object(a.a)(r,(function(){var e=this.$createElement;return(this._self._c||e)("span",{class:this.classSet[this.status]},[this._v(this._s(this.text||this.status))])}),[],!1,null,null,null);t.a=n.exports},5274:function(e,t,i){"use strict";i("4574")},"5b5e":function(e,t,i){"use strict";(function(e){i("9e76"),i("163d"),i("e697");var r,a=i("fd50"),n=i("3bd5"),o=i("ed08"),c=i("4ad6"),s=i("3122"),d=i("3516"),l=i("37d5"),u=i("f2d3"),m=i("48f4"),h=i("6bf2"),_=i.n(h),f=i("4360"),g=i("4921"),b=i("334f"),y=i("b725"),k=i("6b81"),v=i("2f02"),x=i("7364"),S=i("59f8"),j=i("c745"),P=i("0136"),w=function(t,i){var r=n.a.getUser();return b.a.getProblemCCAllColumn(t).then((function(a){if(e.some(a,(function(e){return e.cc===r.user_id&&e.type===i})))return b.a.updateProblemReadingTime(t);var n={id:r.user_id,name:r.user_name,type:i,reading_time:o.a.getNowDate()};return b.a.appendCC(t,n).then((function(){return b.a.updateProblemReadingTime(t)}))}))},C=function(e){var t=e.status;return"已关闭"===e.status&&(t="非正常关闭"),a.a.resolve({status_text:t})};r={getCheckProblemDraftList:function(e){return g.a.getCheckProblemDraftList(e).catch((function(e){return $log.error(e),a.a.reject(e)}))},getCheckProblemList:function(t){var i=n.a.getUser().user_id;return g.a.getCheckProblemList(t,i).then((function(n){return e.map(n,(function(e){r.getProblemLocalStatus({status:e.status}).then((function(t){e.status_text=t.status_text}))})),g.a.getCheckProblemCount(t,i).then((function(e){return a.a.resolve({data:n,total:e.count})}))})).catch((function(e){return $log.error(e),a.a.reject(e)}))},getCheckProblemInfo:function(t){return t?a.a.all([g.a.getCheckProblem(t),y.a.getRepair(t),k.a.getMutliReinspect(t),b.a.getCC(t),b.a.getProblemCCAllColumn(t),k.a.getReinspectByList(t)]).then((function(t){var i=t[0],r=t[5],n=t[1];n&&(i.repair_set=n,i.has_read=n.has_read);var o=t[2];e.isEmpty(o)?i.reinspect_set=[]:i.reinspect_set=o;var c=t[3];c&&c.length>0&&(i.cc_set_id_array=e.map(c,(function(e){return{id:e.user_id}})),i.cc_set_name_array=e.map(c,(function(e){return{name:e.user_name}})),i.cc_set_array=e.map(c,(function(e){return{id:e.user_id,name:e.user_name,mobile:e.mobile,is_im_user:e.is_im_user}})));var s=t[4];return s&&s.length>0&&(i.cc_set_all_id_array=e.map(s,(function(e){return{id:e.cc}}))),i.regist_by||i.sent_back_by||i.repair_by||i.reinspect_by?l.default.getAllProjectUsers(i.proj_id).then((function(t){if(i.regist_by){var a=e.find(t,(function(e){return e.user_id===i.regist_by}));a&&(i.regist=a)}if(i.sent_back_by){var n=e.find(t,(function(e){return e.user_id===i.sent_back_by}));n&&(i.sent_back={id:n.user_id,name:n.user_name,mobile:n.mobile,is_im_user:n.is_im_user})}if(i.repair_by){var o=e.find(t,(function(e){return e.user_id===i.repair_by}));o&&(i.repair=o)}return e.isEmpty(r)||(i.reinspectBy=e.map(r,(function(i){var r=e.find(t,(function(e){return e.user_id===i.reinspect}));return r?{id:r.user_id,name:r.user_name,mobile:r.mobile,is_im_user:r.is_im_user,reinspect_date:i.reinspect_date,reinspect_remark:i.reinspect_remark,reinspect_image_file:JSON.parse(i.reinspect_image_file||"[]"),reinspectById:i.id}:{id:i.reinspect,name:"该用户已被删除",mobile:"",is_im_user:null,reinspect_date:i.reinspect_date,reinspect_remark:"",reinspect_image_file:[],reinspectById:i.id}})),i.reinspectBy=e.filter(i.reinspectBy,(function(e){return!!e})),i.reinspect=e.filter(i.reinspectBy,(function(e){return!!e.reinspect_date}))),i.regist=i.regist||{},i.sent_back=i.sent_back||{},i.repair=i.repair||{},i.reinspect=i.reinspect||[],i})):(i.regist={},i.sent_back={},i.repair={},i.reinspect=[],a.a.resolve(i))})).catch((function(e){$log.log(e)})):a.a.resolve({})},submit:function(t,i,r){if(!1===r)return function(e,t){var i=n.a.getUser();return e.repair_deadline="",e.regist_by=i.user_id,e.regist_date=o.a.getNowDate(),e.created_by=i.user_id,e.created_on=o.a.getNowDate(),e.image_file=JSON.stringify(e.image_file),e.drawing_file&&(e.drawing_file=JSON.stringify(e.drawing_file)),$log.log("专项巡检--\x3e不通知整改",e),g.a.submit(e).then((function(){return x.a.saveProblemStatusLog(e.proj_id,"",e.batch_id,e.id,"已提交","","",e.image_file)})).then((function(){return w(e.id,"登记人")})).then((function(t){return m.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).then((function(){if("special-inspect-problem"!==t)return P.a.saveTodo({biz_id:e.id,proj_id:e.proj_id,module_code:t||"",type:2})})).catch((function(e){return $log.error(e),a.a.reject(e)}))}(t,i);if("待提交"!==t.status&&"草稿"!==t.status&&"合格草稿"!==t.status&&"不合格草稿"!==t.status)return a.a.reject("问题单状态异常");if(!t.checkItem.id)return a.a.reject("请先选择检查项");if(!t.repair_set||!t.repair_set.id)return a.a.reject("请选择问题的整改人");if(e.isEmpty(t.reinspect_set))return a.a.reject("请选择问题的复验人");var c=n.a.getUser();t.status="待整改";var s=new Date;return s.setDate(s.getDate()+Number(t.deadline)),t.repair_deadline=_()(s).format("YYYY-MM-DD"),"special-inspect-problem"===i&&t.regist_by&&t.regist_date&&t.created_by&&t.created_on||(t.regist_by=c.user_id,t.regist_date=o.a.getNowDate(),t.created_by=c.user_id,t.created_on=o.a.getNowDate()),t.image_file=JSON.stringify(t.image_file),t.drawing_file&&(t.drawing_file=JSON.stringify(t.drawing_file)),$log.log("现场检查--\x3e提交问题",t),g.a.submit(t).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已提交","","",t.image_file)})).then((function(){return w(t.id,"登记人")})).then((function(){if("special-inspect-problem"!==i){var e=t.created_by===t.repair_set.id?1:2;return P.a.insertTodoData(t.created_by,t.id,i,e,0)}})).then((function(){return k.a.getReinspectByList(t.id)})).then((function(i){return m.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_repair",t.id],["checkquality_reinspect",t.id],["checkquality_reinspect_by",e.map(i,"id")],["checkquality_cc",t.id]])})).catch((function(e){return $log.error(e),a.a.reject(e)}))},save:function(e){if("待提交"!==e.status&&"草稿"!==e.status&&"合格草稿"!==e.status&&"不合格草稿"!==e.status)return a.a.reject("问题单状态异常。");if(!/^\+?[0-9]*$/.test(e.deadline))return a.a.reject("整改期限必须是正整数");var t={id:e.id,remark:e.remark,image_file:e.image_file,batch_id:e.batch_id,batch_type:e.batch_type,bidsection_id:e.bidsection_id||"",proj_id:e.proj_id,created_by:e.created_by,created_on:o.a.getNowDate(),status:e.status,room_id:e.room_id||"",building_id:e.building_id||"",unit:e.unit||"",floor:e.floor||"",biz_id:e.biz_id||"",biz_children_id:e.biz_children_id||"",deduction:void 0===e.deduction?"":e.deduction,redline_deduction:4===e.mode||8===e.mode?e.redline_deduction:0,contract_id:e.contract&&e.contract.id?e.contract.id:""};return e.repair_requirements&&(t.repair_requirements=e.repair_requirements||""),e.checkItem&&e.checkItem.id&&(t.item_id=e.checkItem.id),e.place&&e.place.full_name&&(t.place=e.place.full_name),e.contractor&&e.contractor.id&&(t.contractor_id=e.contractor.id),e.description&&e.description.id?t.desc_id=e.description.id:t.desc_id="",t.emergency_degree=e.level,e.deadline&&(t.deadline=e.deadline),e.place_point&&(t.problem_values=JSON.stringify(e.place_point)),t.image_file=JSON.stringify(e.image_file),e.drawing_file&&(t.drawing_file=JSON.stringify(e.drawing_file)),(e.process_mode||null===e.process_mode)&&(t.process_mode=e.process_mode),8===e.mode&&(t.deduction_level=e.deduction_level),e.id?g.a.update(t,e.cc_set,e.repair_set,e.reinspect_set).then((function(){return a.a.resolve(e.id)})).catch((function(e){return $log.error(e),a.a.reject(e)})):(t.id=o.a.uuid(),g.a.insert(t).then((function(){return g.a.update(t,e.cc_set,e.repair_set,e.reinspect_set)})).then((function(){return a.a.resolve(t.id)})).catch((function(e){return $log.error(e),a.a.reject(e)})))},delete:function(e){return g.a.getCheckProblem(e).then((function(t){return"待提交"===t.status||"草稿"===t.status||"合格草稿"===t.status||"不合格草稿"===t.status?g.a.delete(e).catch((function(e){return $log.error(e),a.a.reject(e)})):($log.log("问题单状态异常："+e),a.a.reject("问题单状态异常"))}))},repair:function(t,i){if("待整改"!==t.status)return a.a.reject("问题单状态异常");var r=n.a.getUser();t.status="待复验",t.repair_by=r.user_id,t.repair_date=o.a.getNowDate();var c=JSON.stringify(t.repair_image_file);return g.a.getCheckProblem(t.id).then((function(r){if(!r||"待整改"===r.status)return $log.log("现场检查--\x3e完成整改",t),g.a.repairProblem(t.id,t.status,t.repair_by,t.repair_remark,t.repair_date,c).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已整改","",t.repair_remark,c)})).then((function(){return w(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var r=2;e.filter(t.reinspect_set,{user_id:t.repair_by}).length&&(r=1);var a=P.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return P.a.insertTodoData(t.repair_by,t.id,"check",r,a)}})).then((function(){return m.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_cc",t.id]])}));$log.log("提交整改时数据已变为",r)})).catch((function(e){return $log.error(e),a.a.reject(e)}))},reinspectPass:function(t,i){if("待复验"!==t.status)return a.a.reject("问题单状态异常");t.currentReinspectBy=t.currentReinspectBy||{};var r=n.a.getUser(),c="",s=e.isEmpty(t.currentReinspectBy.reinspect_image_file)?"":JSON.stringify(t.currentReinspectBy.reinspect_image_file);return g.a.getCheckProblem(t.id).then((function(n){if(!n||"待复验"===n.status)return k.a.reinspectPass(t.id,r.user_id,o.a.now(),s,t.currentReinspectBy.reinspect_remark||"").then((function(){return k.a.getReinspectByList(t.id).then((function(i){var n=e.every(i,(function(e){return!!e.reinspect_date})),s=e.find(i,{reinspect:r.user_id});return s?(c=s.id,n?(t.status="已通过",t.respect_by=r.user_id,t.reinspect_completed_date=o.a.getNowDate(),g.a.reinspectProblemPass(t.id,t.status,t.reinspect_completed_date,t.respect_by).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已复验","","","")}))):void 0):a.a.reject("问题单复验人异常")}))})).then((function(){return w(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var e=P.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return P.a.insertTodoData(r.user_id,t.id,i||"check",2,e)}})).then((function(){return m.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_reinspect_by",c],["checkquality_cc",t.id]])}))})).catch((function(e){return $log.error(e),a.a.reject(e)}))},reinspectReject:function(t,i){var r=[["checkquality_problem",t.id],["checkquality_cc",t.id]];if("待复验"!==t.status)return a.a.reject("问题单状态异常");if(!t.sent_back_remark)return a.a.reject("请填写退回原因");var c=n.a.getUser();t.sent_back_times?t.sent_back_times++:t.sent_back_times=1,t.status="待整改",t.sent_back_date=o.a.getNowDate(),t.sent_back_by=c.user_id;var s=JSON.stringify(t.sent_back_image_file);return $log.log("现场检查--\x3e复验退回",t),g.a.reinspectProblemReject(t.id,t.status,t.sent_back_date,t.sent_back_remark,s,t.sent_back_by,t.sent_back_times).then((function(){return x.a.saveProblemStatusLog(t.proj_id,t.bidsection_id,t.batch_id,t.id,"已退回",t.sent_back_remark,"",s)})).then((function(){return k.a.clearReinspectByData(t.id)})).then((function(){return w(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var e=2;t.repair_set.id&&t.repair_set.id===c.user_id&&(e=1);var r=P.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return P.a.insertTodoData(c.user_id,t.id,"check",e,r)}})).then((function(){return k.a.getReinspectByList(t.id).then((function(t){r.push(["checkquality_reinspect_by",e.map(t,"id")])}))})).then((function(){if(1===t.has_read)return y.a.update({has_read:0},{checkquality_problem_id:t.id}).then((function(){r.push(["checkquality_repair",t.id])}))})).then((function(){return m.default.addSyncGroup(r)})).catch((function(e){return $log.error(e),a.a.reject(e)}))},close:function(e,t){if("待整改"!==e.status)return a.a.reject("问题单状态异常");if(!e.close_reason)return a.a.reject("请填写关闭原因");var i=n.a.getUser();return e.close_date=o.a.getNowDate(),e.status="已关闭",$log.log("现场检查--\x3e非正常关闭",e),g.a.closeProblem(e.id,e.status,e.close_date,e.close_reason).then((function(){return x.a.saveProblemStatusLog(e.proj_id,e.bidsection_id,e.batch_id,e.id,"已关闭",e.close_reason,"","")})).then((function(){return w(e.id,"操作人")})).then((function(){if("special-inspect-problem"!==t){var r=P.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"check");return P.a.insertTodoData(i.user_id,e.id,"check",2,r)}})).then((function(){return m.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).catch((function(e){return $log.error(e),a.a.reject(e)}))},changeRepair:function(e,t,i){if(!e.repair_set||!e.repair_set.id)return a.a.reject("请指定一个整改人");var r=n.a.getUser();return $log.log("现场检查--\x3e修改整改人",e),g.a.updateProblemModifiedBy(e.id).then((function(){if(t)return g.a.updateProblemContractor(e.id,e.contractor.id)})).then((function(){if(t){var i=e.contractor&&e.contractor.id||"";return g.a.updateProblemContractor(e.id,i)}})).then((function(){return y.a.changeProblemRepairer(e)})).then((function(){return v.a.saveProblemFpInfo(e.proj_id,e.bidsection_id,e.batch_id,e.id,e.repair_set.id,e.repair_set_old.id,"分配整改人")})).then((function(){return w(e.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var t=2;e.repair_set.id&&e.repair_set.id===r.user_id&&(t=1);var a=P.a.getTodoSort(e.status,e.repair_deadline,e.close_date,e.repair_date,e.sent_back_times,e.emergency_degree,"check");return P.a.insertTodoData(r.user_id,e.id,"check",t,a)}})).then((function(){return m.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_repair",e.id],["checkquality_cc",e.id],["checkquality_problem_fpinfo",e.id]])})).catch((function(e){return $log.error(e),a.a.reject(e)}))},changeReinspect:function(t,i){if(e.isEmpty(t.reinspect_set))return a.a.reject("请指定一个复验人");var r=n.a.getUser();return $log.log("现场检查--\x3e修改复验人",t),g.a.updateProblemModifiedBy(t.id).then((function(){return k.a.changeProblemReinspect(t.id,t.reinspect_set,!0)})).then((function(){var i=e.map(t.reinspect_set,(function(e){return e.id})).join(","),r=e.map(t.reinspect_set_old,(function(e){return e.id})).join(",");return v.a.saveProblemFpInfo(t.proj_id,t.bidsection_id,t.batch_id,t.id,i,r,"分配复验人")})).then((function(){return w(t.id,"操作人")})).then((function(){if("special-inspect-problem"!==i){var a=2;e.filter(t.reinspect_set,{user_id:r.user_id}).length&&"待复验"===t.status&&(a=1);var n=P.a.getTodoSort(t.status,t.repair_deadline,t.close_date,t.repair_date,t.sent_back_times,t.emergency_degree,"check");return P.a.insertTodoData(r.user_id,t.id,"check",a,n)}})).then((function(){return k.a.getReinspectByList(t.id)})).then((function(i){return m.default.addSyncGroup([["checkquality_problem",t.id],["checkquality_reinspect",t.id],["checkquality_reinspect_by",e.map(i,"id")],["checkquality_cc",t.id],["checkquality_problem_fpinfo",t.id]])})).catch((function(e){return $log.error(e),a.a.reject(e)}))},changeCC:function(e){return $log.log("现场检查--\x3e修改抄送人",e),g.a.updateProblemModifiedBy(e.id).then((function(){return b.a.saveProblemCC(e.id,e.cc_set)})).then((function(){return m.default.addSyncGroup([["checkquality_problem",e.id],["checkquality_cc",e.id]])})).catch((function(e){return $log.error(e),a.a.reject(e)}))},changeContractor:function(e){return e.contractor&&e.contractor.id?($log.log("现场检查--\x3e修改责任单位",e),g.a.updateProblemContractor(e.id,e.contractor.id).then((function(){return m.default.addSyncGroup([["checkquality_problem",e.id]])})).catch((function(e){return $log.error(e),a.a.reject(e)}))):a.a.reject("请指定责任单位")},changeRepairDeadline:function(e){if(!/^(\d+)-(\d{1,2})-(\d{1,2})$/.test(e.repair_deadline))return a.a.reject("整改期限需要一个日期格式的值");var t=_()(e.repair_deadline).format("YYYY-MM-DD"),i=_()().format("YYYY-MM-DD");return e.is_timeout=t<i,$log.log("现场检查--\x3e修改整改期限",e),g.a.updateProblemRepairDeadline(e.id,e.repair_deadline).then((function(){return m.default.addSyncGroup([["checkquality_problem",e.id]])})).catch((function(e){return $log.error(e),a.a.reject(e)}))},getProblemLocalStatusById:function(e){return C({status:p.status})},getProblemLocalStatus:C,saveRepairInfo:function(e,t,i){return i=JSON.stringify(i),g.a.saveRepairInfo(e,t,i).then((function(){return g.a.getCheckProblemDraft(e).then((function(t){return u.a.backUpDraft(e,t.proj_id,"checkquality_problem",t)}))}))},problemRead:function(e){return y.a.update({has_read:1},{checkquality_problem_id:e}).then((function(){return m.default.addSyncGroup([["checkquality_problem",e],["checkquality_repair",e]])}))},takePictureAndSave:function(e){return s.a.takePicture().then((function(t){if(t)return d.a.getBatch(e).then((function(e){var i={proj_id:e.proj_id,bidsection_id:e.bidsection_id,batch_id:e.id,deadline:e.repair_deadline,batch_type:e.batch_type,created_by:n.a.getUser().user_id,created_on:o.a.now(),image_file:[t],status:"待提交"};return r.save(i)}))})).catch((function(e){return $log.error(e),a.a.reject(e)}))},saveByPicture:function(e,t){return e?d.a.getBatch(t).then((function(t){var i={proj_id:t.proj_id,bidsection_id:t.bidsection_id,batch_id:t.id,deadline:t.repair_deadline,batch_type:t.batch_type,created_by:n.a.getUser().user_id,created_on:o.a.now(),image_file:[{temp:e}],status:"待提交"};return r.save(i)})).catch((function(e){return $log.error(e),a.a.reject(e)})):a.a.when()},createProblem:function(e,t){return d.a.getBatch(t).then((function(t){var i={proj_id:t.proj_id,bidsection_id:t.bidsection_id,batch_id:t.id,deadline:t.repair_deadline,batch_type:t.batch_type,created_by:n.a.getUser().user_id,created_on:o.a.now(),image_file:[{temp:e}],status:"待提交"};return r.save(i)}))},takePicture:function(){return s.a.takePicture()},allowSelectPicture:function(){return S.a.getValue("upload_from_phone_albums").then((function(e){return"1"===e}))},reinspectByConflict:function(t){return e.isEmpty(t.reinspectBy)?a.a.when():k.a.removeProblemReinspectBy(t.reinspectBy[0].checkquality_problem_id).then((function(){return k.a.insertReinspectByList(t.reinspectBy)})).then((function(){return TodoRepository.removeProblemTodo(t.reinspectBy[0].checkquality_problem_id)})).then((function(){return TodoRepository.insertTodoList(t.todo)}))},copyProblem:function(t){return a.a.all([g.a.getProblemAllColumn(t),y.a.getRepairAllColumn(t),k.a.getReinspectAllColumn(t),k.a.getReinspectByList(t),b.a.getProblemCCAllColumn(t)]).then((function(t){var i=t[0],r=t[1],c=t[2],s=t[3],d=t[4];if(i.id=o.a.uuid(),i.status="待提交",i.regist_by="",i.repair_by="",i.repair_remark="",i.repair_date="",i.repair_image_file="",i.sent_back_by="",i.sent_back_date="",i.sent_back_times=0,i.sent_back_remark="",i.sent_back_image_file="",i.reinspect_by="",i.reinspect_completed_date="",i.close_date="",i.close_reason="",i.created_by=n.a.getUser().user_id,i.created_on=o.a.now(),i.modified_by=n.a.getUser().user_id,i.download_time="",i.update_timestamp="",i.repair_deadline&&!i.deadline&&i.regist_date){for(var l=i.repair_deadline.match(/\d+/g),u=0;u<l.length;u++)l[u]=parseInt(l[u]);for(var p=new Date(l[0],l[1]-1,l[2],l[3]||0,l[4]||0,l[5]||0),m=i.regist_date.match(/\d+/g),h=0;h<m.length;h++)m[h]=parseInt(m[h]);var _=new Date(m[0],m[1]-1,m[2],m[3]||0,m[4]||0,m[5]||0);i.deadline=Math.ceil((p.getTime()-_.getTime())/864e5)}i.regist_date="",i.repair_deadline="",e.each(r,(function(e){e.id=o.a.uuid(),e.checkquality_problem_id=i.id,e.download_time=""})),e.each(c,(function(e){e.id=o.a.uuid(),e.checkquality_problem_id=i.id,e.download_time=""})),e.each(s,(function(e){e.id=o.a.uuid(),e.checkquality_problem_id=i.id,e.reinspect_date="",r.reinspect_remark="",r.reinspect_image_file="",e.download_time=""}));var f=e.filter(d,(function(e){return"默认"===e.type}));return f=e.map(f,(function(e){return{id:e.cc}})),d=e.filter(d,(function(e){return"被抄送"===e.type})),d=e.map(d,(function(e){return{id:e.cc}})),a.a.all([g.a.insert(i),y.a.insert(r),k.a.insertReinspect(c),k.a.insertReinspectByList(s),b.a.saveProblemCC(i.id,d),b.a.saveDefaultCc(i.id,f)])}))},removeLocalInvalidProblem:function(t){var i=a.a.when();return t.problem_repair&&(i=i.then((function(){return y.a.removeInvalidData(t.problem.id,e.map(t.problem_repair,"id"))}))),t.problem_reinspect&&(i=i.then((function(){return k.a.removeInvalidData(t.problem.id,e.map(t.problem_reinspect,"id"))}))),t.problem_cc&&(i=i.then((function(){return b.a.removeInvalidData(t.problem.id,e.map(t.problem_cc,"id"))}))),t.children_Problem&&(i=i.then((function(){return g.a.removeInvalidChildProblem(t.problem.id,t.children_Problem)}))),i},removeLocalInvalidProblem1:function(t,i){var r=i.checkquality_problem;return a.a.when().then((function(){if(i.checkquality_problem)return g.a.deleteProblemById(r.id)})).then((function(){if(i.checkquality_repair)return y.a.removeInvalidData(r.id,e.map(i.checkquality_repair,"id"))})).then((function(){if(i.checkquality_cc)return b.a.removeInvalidData(r.id,e.map(i.checkquality_cc,"id"))}))},removeClosedBatchProblem:function(){return d.a.getClosedBatchIdList().then((function(e){return r.deleteBatchProblems(e)}))},deleteBatchProblems:function(t){return $log.log("删除已关闭批次的问题"),g.a.getProblemsByBatch(t).then((function(t){var i=a.a.when(),r=["image_file","repair_image_file","sent_back_image_file"],n=[];return e.each(t,(function(t){for(var i=0;i<r.length;++i){var a=t[r[i]]=JSON.parse(t[r[i]]||"[]");e.each(a,(function(e){e.local&&n.push(e.local),e.thumbnail&&n.push(e.thumbnail),e.temp&&n.push(e.temp)}))}})),e.each(n,(function(e){i=i.then((function(){return c.a.isFileExists(e)})).then((function(t){if(t)return c.a.deleteFile(e)}))})),i})).then((function(){return g.a.deleteProblemByBatch(t)}))},getLeaderComments:function(t){return g.a.getLeaderComments(t).then((function(t){return e.each(t,(function(e){e.user={id:e.user_id,name:e.user_name,mobile:e.mobile,is_im_user:e.is_im_user},e.image_file&&(e.image_file=JSON.parse(e.image_file))})),t}))},getPhotoRequired:function(e,t){var i=f.a.state.global.allGrayRelease.UsingProjectParameter;return j.a.getProjParameter(e,"is_photo_required",t).then((function(e){return i&&e&&e.length?Number(e[0].value):f.a.state.global.isPhotoRequired[t]})).catch((function(e){console.log("error",e)}))}},t.a=r}).call(this,i("391c"))},"65e9":function(e,t,i){"use strict";(function(e){i("5ab2"),i("6d57"),i("e10e");var r=i("28f8"),a=i("4360"),n=i("48f4"),o=i("162a"),c=i("f2d3"),s=i("6906"),d=i("a18c"),l=i("c745");function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){Object(r.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.a={name:"SynchronizeTipBar",props:{isTodo:{type:Boolean},useDownload:{type:Boolean,default:!0},enterDoCheck:{type:Boolean,default:!0},buildingId:{type:String,default:""},automaticUpdateCallback:{type:Function,default:null}},data:function(){return{currentModuleCode:"",oneUpdateData:!0}},computed:{projId:function(){return a.a.state.global.currentProject.id},waitUploadNum:function(){return a.a.state.global.waitUploadNum},hasTopProgress:function(){return a.a.state.global.hasTopProgress},hasChanged:function(){if(!this.useDownload)return!1;if(this.currentModuleCode){var e,t=n.default.isModuleNeedBuilding(this.currentModuleCode)&&!this.isTodo;return!(t&&!this.buildingId)&&(e=this.isTodo?a.a.state.global.todoChangedStatus||{}:a.a.state.global.businessChangedStatus||{},t?!!e[this.currentModuleCode]&&e[this.currentModuleCode][this.buildingId]:e[this.currentModuleCode])}return!1},show:function(){return(this.hasChanged||this.waitUploadNum)&&!this.hasTopProgress},oneDataSync:function(){return this.$store.state.app.oneDataSync}},watch:{hasChanged:function(e){var t=this;e&&this.$nextTick((function(){setTimeout((function(){var e=t.$refs["synchronize-tip-bar"];if(e&&e.style){e.style.display="none";var i=e.offsetHeight;e.style.display="block",$log.log(i)}}),100)}))},buildingId:function(e){this.currentModuleCode&&n.default.isModuleNeedBuilding(this.currentModuleCode)&&e&&(console.log("楼栋重新加载，是否再次自动加载数据：",this.oneUpdateData),this.oneUpdateData&&this.automaticLogic(),this.checkSync())},show:function(e){e?this.$emit("show"):this.$emit("hide")}},activated:function(){this.init()},methods:{init:function(){this.getCurrentModuleCode(),this.enterDoCheck&&!d.a.isBack&&this.checkSync(),this.automaticLogic()},automaticLogic:function(){var e=this;this.$router.isBack||(this.oneUpdateData=!0,l.a.getAutomaticLoadData().then((function(t){$log.log("是否要自动加载 ===> ",t&&e.oneDataSync&&"function"==typeof e.automaticUpdateCallback),t&&e.oneDataSync&&"function"==typeof e.automaticUpdateCallback&&e.dataSync().then((function(t){console.log("是否需要初始化页面 ====> ",Boolean(t)),t&&e.automaticUpdateCallback()}))})))},getCurrentModuleCode:function(){var e=n.default.getCurrentModuleCode(),t=this.isTodo?"todo":"";this.currentModuleCode=e||t},checkSync:function(){var t=this,i="checkDataUpdate",r=this.currentModuleCode,o=this.buildingId,d=a.a.state.global.isLeader?this.projId:"";return!n.default.isModuleNeedBuilding(r)||o||this.isTodo?(this.isTodo&&(i+="_todo"),r&&(i+="_".concat(r)),o&&(i+="_".concat(o)),s.a.execAfterInterval(120,i).then((function(){return t.isTodo?"todo"===r?c.a.getModuleList().then((function(t){var i=e.map(t,"code");return n.default.hasTodoChangedData("",i)})):n.default.hasTodoChangedData("",[r]):n.default.hasBusinessChangedData(d,[r],o)})).then((function(e){if(t.isTodo){var i=p({},a.a.state.global.todoChangedStatus);i[r]=e,a.a.commit("global/SET_TODO_CHANGED_STATUS",i)}else{var n=p({},a.a.state.global.businessChangedStatus);if(o){var c=n[r]?n[r]:{};c[o]=e,n[r]=c}else n[r]=e;a.a.commit("global/SET_BUSINESS_CHANGED_STATUS",n)}})).catch((function(e){return e&&!0===e.timeNotTo?($log.debug(e.msg),!1):$q.reject(e)}))):Promise.resolve()},dataSync:function(){var e=this.currentModuleCode,t=this.buildingId,i=n.default.isModuleNeedBuilding(e),r=i&&!t;return $log.log("模块名：",e," 楼栋id：",t," 当前模块是否需要楼栋id：",i," 判断是否终止自动更新：",r),r?Promise.resolve():(this.oneUpdateData=!1,o.a.beginManualUpdate(),n.default.checkSync(t).then((function(e){return o.a.endManualUpdate(),e})).catch((function(e){$log.error("自动更新错误",e),o.a.endManualUpdate()})))}}}}).call(this,i("391c"))},"72b4":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .layout-main[data-v-6be20424] .layout-content{display:flex;flex-direction:column}.zjapp .layout-main[data-v-6be20424] .layout-content .van-tabs,.zjapp .layout-main[data-v-6be20424] .layout-content .van-tabs__content{height:100%}",""])},"757d":function(e,t,i){"use strict";(function(e){var r=i("fd50"),a=i("f369"),n=i("774b"),o=i("fa4f"),c=i("3bd5"),s=i("3516"),d=i("6144"),l=i("bc69"),u=i("5b5e"),p=i("3122"),m=i("48f4"),h=i("07d2"),_=i("6bf2"),f=i.n(_),g=i("a500"),b=i("f7ab"),y=i("f647");t.a={name:"CheckIndex",components:{CheckGuide:a.a,Scroller:n.a,ItemList:o.a,Item:h.a,SynchronizeTipBar:b.a},data:function(){return{isLoadingBatch:!0,defaultBatch:{},hasNewBatchRights:!1,isAllList:!1,allowAddProblem:!1,tabIndex:0,draftLimit:10,draftData:[],isDraftLoading:!1,submittedLimit:10,submittedData:[],isSubmitLoading:!1,model:y.a}},activated:function(){this.init()},methods:{init:function(){var e=this,t=this.$route.query,i=t.batchId,r=t.specialInspectId,a=t.rootId,n=t.mode,o=t.checkItemId,c=t.editable;this.batchId=i,this.specialInspectId=r,this.rootId=a,this.mode=this.mode=parseInt(n),this.checkItemId=o,this.editable=+c,this.isAllList=!this.specialInspectId,this.condition=$rootScope.businessChangedStatus&&$rootScope.businessChangedStatus[$rootScope.currentModuleCode]||$rootScope.hasWaitUpload;var d=this.isAllList?40:90,l=this.isAllList?0:50;this.scrollHeight=$rootScope.viewSize.contentHeight-(this.condition?d:l),this.model.init(null,null,null,this.$route.query),this.checkItemId&&s.a.getBatch(i).then((function(t){e.allowAddProblem="检查完毕"!==t.status&&e.editable,e.allowAddProblem||(e.scrollHeight+=50)}))},onRefresh:function(e){this.init().then((function(){"function"==typeof e&&e(!1)}))},fomatDate:function(e){return f()(e).format("YYYY-MM-DD HH:mm")},batchClick:function(){this.isLoadingBatch||(this.defaultBatch&&this.defaultBatch.id?(g.a.addTrack("现场检查-首页-进入批次列表"),this.$router.push("/checkBatchList")):this.hasNewBatchRights&&this.$router.push("/checkBatchAdd"))},problemDetail:function(e){var t;t="草稿"===e.status?"/special-inspect-problem-edit":"/special-inspect-problem-detail",this.$router.push({path:t,query:{specialInspectId:e.biz_id,problem_id:e.id,checkItemId:e.item_id,rootId:this.rootId,mode:this.mode,fromAllproblemList:Boolean(this.checkItemId)}})},contractProblemDetail:function(e){this.$router.push({path:"/special-inspect-contract-problem-detail",query:{problemId:e.id}})},problemAdd:function(e){this.$router.push({path:"/special-inspect-problem-edit",query:{batchId:this.batchId,specialInspectId:this.specialInspectId,checkItemId:this.checkItemId,mode:this.mode,rootId:this.rootId}})},problemEdit:function(e){this.$router.push({name:"CheckEdit",params:{id:e.id}})},getDetaulBatch:function(){var e=this,t=c.a.getUser(),i=d.a.getObject(l.a.HOME_PAGE_DEFAULT_PROJECT,d.a.level.user)||{};return this.isLoadingBatch=!0,s.a.checkUserBatchRights(t.user_id).then((function(t){e.hasNewBatchRights=!!t})).then((function(){return s.a.getDefaultBatch("安全文明",i.id).then((function(t){t?e.defaultBatch=t:(e.defaultBatch={},e.draftData=[],e.submittedData=[])}))})).finally((function(){e.isLoadingBatch=!1}))},getDraftData:function(){var t=this;return this.isDraftLoading=!0,this.defaultBatch.is_closed?(this.draftData=[],this.isDraftLoading=!1,r.a.when()):u.a.getCheckProblemDraftList(this.defaultBatch.id).then((function(i){e.each(i,(function(e){e.thumbnail=p.a.getDefaultThumbnailFromList(e.image_file,"安全文明"),e.regist_date=f()(e.created_on).format("MM-DD HH:mm")})),t.draftData=i,t.isDraftLoading=!1}))},getSubmittedData:function(){var t=this;return this.isSubmitLoading=!0,this.defaultBatch.is_closed?(this.submittedData=[],this.isSubmitLoading=!1,r.a.when()):u.a.getCheckProblemList(this.defaultBatch.id).then((function(i){var r=e.filter(i.data,(function(e){var t=JSON.parse(e.image_file||"[]");return e.thumbnail=p.a.getDefaultThumbnailFromList(t,"安全文明"),e.regist_date=f()(e.regist_date).format("MM-DD HH:mm"),p.a.isNeedThumbnail(t)}));m.default.autoLoadThumbnail(r,"安全文明","image_file","thumbnail","checkquality_problem"),t.submittedData=i.data,t.isSubmitLoading=!1}))},pageDraft:function(){this.draftLimit=this.draftLimit+10},pageSubmit:function(){this.submittedLimit=this.submittedLimit+10}}}}).call(this,i("391c"))},"7d4e":function(e,t,i){var r=i("c59b");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,i("85cb").default)("62c5f5a2",r,!0,{sourceMap:!1,shadowMode:!1})},"8d4c":function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .synchronize-tip-bar[data-v-aaf184a8]{height:30px;padding:5px 15px;line-height:20px;text-align:center;background-color:#ffe6e6;color:#ff6060;font-size:14px}.zjapp .synchronize-tip-bar .icon-caution[data-v-aaf184a8]{line-height:20px;margin-right:5px}@media screen and (-webkit-min-device-pixel-ratio:1){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 100%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:1.5){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 66.6667%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2.625){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 38.0952%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:3){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 33.3333%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:4){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 25%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}",""])},"967a":function(e,t,i){"use strict";var r=i("8d95");t.a={REPAIR_DEADLINE_STATUS:{name:"repair_deadline_status",status:["待整改"],module:[r.a.CHECK]}}},a7b6:function(e,t,i){"use strict";i("394b")},c59b:function(e,t,i){(e.exports=i("690e")(!1)).push([e.i,".zjapp .item-list{position:relative;padding:10px;display:flex;align-items:center;background-color:#fff;min-height:100px}.zjapp .item-list .img{display:block;width:80px;height:80px;background:no-repeat 50%;background-size:cover;background-color:#ddd}.zjapp .item-list .item-list-con{flex:1;padding:0 15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.zjapp .item-list .item-list-con .title{height:30px;line-height:24px;color:#111;font-size:16px;padding-top:6px;margin:0;padding-right:10px;margin-right:-10px;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important;font-weight:400}.zjapp .item-list .item-list-con .title .type-tag{display:inline-block;height:16px;line-height:16px;padding:0 4px;border-radius:2px;border:1px solid #4275e8;color:#4275e8;font-size:12px;zoom:.8;margin:3px 0 0 0;vertical-align:text-top}.zjapp .item-list .item-list-con .text{height:30px;line-height:24px;color:#8c8c8c;padding-bottom:6px;padding-right:11px;margin-right:-10px}.zjapp .item-list .item-list-con .text,.zjapp .item-list .item-list-con .time{font-size:14px;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important}.zjapp .item-list .item-list-con .time{height:20px;line-height:20px;color:#b3b3b3;padding-right:11px!important;margin-right:-10px!important}.zjapp .item-list .item-list-con .time .ion{color:#a6a6a6;font-size:20px;font-weight:700;margin-right:5px;vertical-align:top}.zjapp .item-list .item-list-r{width:60px;line-height:18px;text-align:center}.zjapp .item-list .item-list-status{min-width:4em;line-height:18px;text-align:center;white-space:normal;font-size:14px}.zjapp .item-list .icon-unread{display:inline-block;text-align:center;width:12px;height:12px;border-radius:6px;background-color:red}.zjapp .item-list .icon-return,.zjapp .item-list .icon-timeout,.zjapp .item-list .icon-urgent{display:inline-block;width:16px;height:16px;text-align:center;line-height:16px;font-size:12px;font-style:normal;color:#fff;border-radius:2px;-webkit-border-radius:2px;vertical-align:top;margin-top:4px;margin-right:5px}.zjapp .item-list .icon-timeout{background:#964bfe}.zjapp .item-list .icon-return{background:#fe8b00}.zjapp .item-list .icon-urgent{background:#ff3c3d}.zjapp .item-list .icon-return:last-child,.zjapp .item-list .icon-timeout:last-child,.zjapp .item-list .icon-urgent:last-child{margin-right:0}.zjapp .item-list-tip{height:70px;line-height:60px;color:#b4b4b4;text-align:center}.zjapp .status-new-tag{position:absolute;right:0;top:0;width:50px;height:50px;overflow:hidden;z-index:10}.zjapp .status-new-tag>.tag{position:absolute;right:-32px;bottom:22px;height:20px;line-height:20px;width:100px;color:#fff;font-size:12px;transform:rotate(45deg);text-align:center;border-width:1px;border-style:solid}.zjapp .time-status{font-size:10px;color:#999}",""])},d771:function(e,t,i){"use strict";i.r(t);var r=i("757d").a,a=(i("5274"),i("17cc")),n=Object(a.a)(r,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("page-content",{attrs:{title:"全部问题","show-go-root":!0}},[i("synchronize-tip-bar",{attrs:{"use-download":!1}}),i("scroller",{attrs:{"has-next":e.submittedLimit<e.submittedData.length,"is-empty":!e.submittedData.length},on:{pullDown:e.model.init,loadNext:e.pageSubmit}},[!e.model.isListLoading&&e.model.data.problemList.length&&6!==e.mode?e._l(e.model.data.problemList,(function(t,r){return i("item-list",{key:r,attrs:{"is-unread":t.unread,"is-timeout":t.is_timeout,"is-urgent":"紧急"==t.emergency_degree||"特急"==t.emergency_degree,"is-return":t.sent_back_times>0,img:t.thumbnail,title:t.item_full_name,detail:t.desc||""+t.remark||"",footer:e.fomatDate(t.created_on)+" "+(t.place||""),status:t.status,"status-text":t.status},on:{click:function(i){e.problemDetail(t)}}})})):e._e(),!e.model.isListLoading&&e.model.data.problemList.length&&6===e.mode?e._l(e.model.data.problemList,(function(t,r){return i("item-list",{key:r,attrs:{"is-unread":t.unread,"is-timeout":t.is_timeout,"is-urgent":"紧急"==t.emergency_degree||"特急"==t.emergency_degree,"is-return":t.sent_back_times>0,img:t.thumbnail,title:t.contract_name,detail:t.item_full_name||""+t.desc||""+t.remark||"",footer:e.fomatDate(t.created_on)+" "+(t.place||""),status:t.status,"status-text":t.status_text},on:{click:function(i){e.contractProblemDetail(t)}}})})):e._e(),i("loading-status",{attrs:{"is-loading":e.model.isListLoading,"is-empty":!e.model.isListLoading&&!e.model.data.problemList.length,"empty-text":"这里暂无问题"}})],2),!e.isAllList&&e.allowAddProblem?i("app-button-group",{attrs:{"fixed-bottom":""}},[i("app-button",{on:{click:function(t){e.problemAdd()}}},[i("van-icon",{attrs:{name:"plus"}}),e._v("\n      新增问题\n    ")],1)],1):e._e()],1)}),[],!1,null,"6be20424",null);t.default=n.exports},dd16:function(e,t,i){"use strict";(function(e){t.a={name:"StatusText",props:{status:{type:String},text:{type:String},extend:{type:Object,default:function(){return{}}}},data:function(){return{classSet:e.extend({"草稿":"color-gray","暂存":"color-gray","检查中":"color-orange","待整改":"color-red","待复验":"color-orange","待验收":"color-red","待报验":"color-red","待申请进场":"color-red","待初验":"color-red","待送检":"color-red","待上传报告":"color-red","待退场":"color-red","待建设单位验收":"color-red","待区域验收":"color-red","供应链退回":"color-red","预创建":"color-status-blue","已提交":"color-green","已整改":"color-green","已验收":"color-green","已通过":"color-green","已退场":"color-gray","已关闭":"color-gray","非正常关闭":"color-gray","已退回":"color-red","已完成":"color-green","已甩项":"color-gray","检查完毕":"color-green","送检合格":"color-green","复验合格":"color-green","验收合格":"color-green","验收不合格":"color-red","未验收":"color-orange","待点评":"color-orange","已点评":"color-green","合格":"color-green","不合格":"color-red","进度正常":"color-green","进度滞后":"color-red","施工单位验收合格":"color-green","监理单位验收合格":"color-green","建设单位验收合格":"color-green","施工单位验收不合格":"color-red","监理单位验收不合格":"color-red","建设单位验收不合格":"color-red"},this.extend)}},mounted:function(){}}}).call(this,i("391c"))},e89f:function(e,t,i){"use strict";var r=i("04f3"),a=i("cf09"),n=i("4360"),o=0;t.a={name:"PopupMixin",data:function(){return{backButtonEvent:null}},watch:{show:function(e){var t=this;if(e){if(this.$nextTick((function(){t.$el&&t.$el.style&&(t.$el.style.zIndex=++a.a.zIndex,o++,n.a.commit("app/SET_HAS_POPUP",!!o))})),!this.backButtonEvent){var i=this.close||this.closePopup;this.backButtonEvent=Object(r.a)(i)}}else--o<0&&(o=0),n.a.commit("app/SET_HAS_POPUP",!!o),this.backButtonEvent&&(Object(r.c)(this.backButtonEvent),this.backButtonEvent=null)}},methods:{}}},f647:function(e,t,i){"use strict";(function(e){i("e697"),i("cc57"),i("163d");var r,a=i("fd50"),n=i("6e1b"),o=i("3bd5"),c=i("3122"),s=i("48f4");t.a=r={data:{problemData:{},problemList:[]},batchIdOrSpecialInspectId:"",isListLoading:!0,toParams:null,init:function(e,t,i,a){var n;return r.toParams=a,void 0===a?n=r.lastRequest():a.batchId&&6===Number(a.mode)?(n=r.getContractAllProblemList(a.batchId),r.lastRequest=function(){return r.getContractAllProblemList(a.batchId)}):a.batchId&&9==+a.mode||10==+a.mode&&!a.specialInspectId?(n=r.getAllProblemsIncloudRoot(a.batchId),r.lastRequest=function(){return r.getAllProblemsIncloudRoot(a.batchId)}):a.specialInspectId?(n=r.getCheckItemProblemList(a.specialInspectId),r.lastRequest=function(){return r.getCheckItemProblemList(a.specialInspectId)}):(n=r.getAllProblemList(a.batchId),r.lastRequest=function(){return r.getAllProblemList(a.batchId)}),n.then((function(){r.isListLoading=!1}))},getCheckItemProblemList:function(t){return n.a.getSpecialInspectProblemList(t).then((function(t){r.data.problemList=t;var i=e.filter(t,(function(e){var t=JSON.parse(e.image_file||"[]");return c.a.isNeedThumbnail(t)}));s.default.autoLoadThumbnail(i,"专项巡检","image_file","thumbnail","checkquality_problem")}))},getAllProblemList:function(t){return n.a.getSpecialInspectBatchProblemOfAll(t).then((function(t){r.data.problemList=t;var i=e.filter(t,(function(e){var t=JSON.parse(e.image_file||"[]");return c.a.isNeedThumbnail(t)}));s.default.autoLoadThumbnail(i,"专项巡检","image_file","thumbnail","checkquality_problem")}))},getAllProblemsIncloudRoot:function(t){return n.a.getSpecialInspectBatchProblemsIncloudRoot(t).then((function(t){r.data.problemList=t;var i=e.filter(t,(function(e){var t=JSON.parse(e.image_file||"[]");return c.a.isNeedThumbnail(t)}));s.default.autoLoadThumbnail(i,"专项巡检","image_file","thumbnail","checkquality_problem")}))},getContractAllProblemList:function(t){return n.a.getContractAllProblemList(t).then((function(t){r.data.problemList=t;var i=e.filter(t,(function(e){var t=JSON.parse(e.image_file||"[]");return c.a.isNeedThumbnail(t)}));s.default.autoLoadThumbnail(i,"专项巡检","image_file","thumbnail","checkquality_problem")}))},getCheckProblemInfo:function(t){var i,c=r.data;return t?n.a.getCheckProblemInfo(t).then((function(t){(i=t).regist={id:t.regist.id,name:t.regist.name,mobile:t.regist.mobile,is_im_user:t.regist.is_im_user},t.repair&&t.repair.id?i.repair={id:t.repair.id,name:t.repair.name,mobile:t.repair.mobile,is_im_user:t.repair.is_im_user}:i.repair=e.clone(t.repair_set),i.place={full_name:t.place},i.checkItem={id:t.item_id,name:t.item_name,full_name:t.item_full_name},i.description={id:t.desc_id,name:t.desc},i.image_file=JSON.parse(t.image_file||"[]"),i.level=t.emergency_degree||"一般",i.sent_back={id:t.sent_back.id,name:t.sent_back.name,mobile:t.sent_back.mobile},i.sent_back_image_file=JSON.parse(t.sent_back_image_file||"[]"),i.repair_image_file=JSON.parse(t.repair_image_file||"[]"),i.contractor={id:t.contractor_id,name:t.contractor_name},i.cc_set=t.cc_set_array,i.place_point=JSON.parse(t.problem_values||"[]"),i.drawing_file=JSON.parse(t.drawing_file||"[]"),i.deadline=t.deadline||7,i.currentReinspectBy=e.find(e.clone(i.reinspectBy),(function(e){return e.id===o.a.getUser().user_id}))||{reinspect_image_file:[],reinspect_remark:""}})).then((function(){return n.a.getSpecialInspectCheckItemDetail(i.biz_id).then((function(e){e.checkitem_extension&&"string"==typeof e.checkitem_extension&&(i.checkitem_extension=JSON.parse(e.checkitem_extension)),i.isRedlineDeduction=1===e.is_redline_deduction}))})).then((function(){return c.problemData=i,i})):a.a.reject("问题id为空")},getProjectUsers:function(e){return ProjectService.getAllProjectUsers(e).then((function(e){return r.data.users=e,e}))},createNewData:function(e){var t={status:"",place:{},batch_type:"专项巡检",checkItem:{},description:{},image_file:[],remark:"",level:"一般",deadline:7,repair_set:{},contractor:{},cc_set:[],reinspect_set:[],building_id:"",unit:"",room_id:"",place_point:[],deduction:1,redline_deduction:0,biz_id:e};return n.a.getSpecialInspectCheckItemDetail(e).then((function(e){e.checkitem_extension&&"string"==typeof e.checkitem_extension&&(t.checkitem_extension=JSON.parse(e.checkitem_extension)),t.proj_id=e.proj_id,t.batch_id=e.batch_id,t.checkItem={id:e.item_id,name:e.full_name,full_name:e.full_name},t.isRedlineDeduction=1===e.is_redline_deduction,void 0!==e.deduction&&""!==e.deduction&&null!==e.deduction&&(t.deduction=e.deduction)})).then((function(){return r.data.problemData=t,t}))}}}).call(this,i("391c"))},f7ab:function(e,t,i){"use strict";var r=i("65e9").a,a=(i("a7b6"),i("17cc")),n=Object(a.a)(r,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.show?i("div",{ref:"synchronize-tip-bar",staticClass:"synchronize-tip-bar"},[i("icon",{attrs:{name:"caution"}}),e.waitUploadNum?i("span",[e._v("您有"+e._s(e.waitUploadNum)+"条数据待上传")]):e._e(),!e.waitUploadNum&&e.hasChanged?i("span",[e._v("有新数据")]):e._e(),e._v("\n  ，下拉可"+e._s(e.waitUploadNum?"上传":"刷新")+"\n")],1):e._e()}),[],!1,null,"aaf184a8",null);t.a=n.exports},fa4f:function(e,t,i){"use strict";var r=i("4aef"),a=i("967a"),n={name:"ItemList",components:{StatusText:r.a},props:{img:{type:String,default:""},title:{type:String,default:""},detail:{type:String,default:""},footer:{type:String,default:""},status:{type:String,default:""},isShowNewStatus:{type:Boolean,default:!1},statusText:{type:String,default:""},statusClassSet:{type:Object,default:function(){return{}}},typeTag:{type:String,default:""},isUnread:{type:Boolean,default:!1},isTimeout:{type:Boolean,default:!1},isUrgent:{type:Boolean,default:!1},isReturn:{type:Boolean,default:!1},repairDeadline:{type:String,default:null}},data:function(){return{repairDeadlineStatus:a.a.REPAIR_DEADLINE_STATUS.status}},computed:{bgNewClass:function(){return{"草稿":"bg-gray7 b-color","暂存":"bg-gray b-color","检查中":"bg-orange b-color","待整改":"bg-red2 b-color ","待复验":"bg-purple b-color","待验收":"bg-red b-color","待报验":"bg-red b-color","待申请进场":"bg-red b-color","待初验":"bg-red b-color","待送检":"bg-red b-color","待上传报告":"bg-red b-color","待退场":"bg-red b-color","待建设单位验收":"bg-red b-color","待区域验收":"bg-red b-color","已提交":"bg-green b-color","已整改":"bg-green b-color","已验收":"bg-green b-color","已通过":"bg-green2 b-color","已退场":"bg-gray b-color","已关闭":"bg-gray7 b-color","非正常关闭":"bg-gray b-color","已退回":"bg-red b-color","已完成":"bg-green b-color","已甩项":"bg-gray b-color","检查完毕":"bg-green b-color","送检合格":"bg-green b-color","复验合格":"bg-green b-color","验收合格":"bg-green b-color","验收不合格":"bg-red b-color","未验收":"bg-orange b-color","待点评":"bg-orange b-color","已点评":"bg-green b-color","合格":"bg-green b-color","不合格":"bg-red b-color","进度正常":"bg-green2 b-color","进度滞后":"bg-red2 b-color","施工单位验收合格":"bg-green b-color","监理单位验收合格":"bg-green b-color","建设单位验收合格":"bg-green b-color","施工单位验收不合格":"bg-red b-color","监理单位验收不合格":"bg-red b-color","建设单位验收不合格":"bg-red b-color"}}},activated:function(){}},o=(i("19a9"),i("17cc")),c=Object(o.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._g({staticClass:"item-list border-bottom"},e.$listeners),[e.isShowNewStatus?i("div",{staticClass:"status-new-tag"},[i("div",{staticClass:"tag",class:e.bgNewClass[e.status]},[e._v("\n      "+e._s(e.status)+"\n    ")])]):e._e(),e.img?i("div",{staticClass:"img",style:{"background-image":"url("+e.img+")"}}):e._e(),i("div",{staticClass:"item-list-con"},[i("h2",{staticClass:"title"},[e.isUnread?i("i",{staticClass:"icon-unread"}):e._e(),e.isTimeout?i("i",{staticClass:"icon-timeout"},[e._v("\n        超\n      ")]):e._e(),e.isUrgent?i("i",{staticClass:"icon-urgent"},[e._v("\n        急\n      ")]):e._e(),e.isReturn?i("i",{staticClass:"icon-return"},[e._v("\n        退\n      ")]):e._e(),e.$slots.title?e._t("title"):[e.typeTag?i("span",{staticClass:"type-tag"},[e._v(e._s(e.typeTag))]):e._e(),e._v("\n        "+e._s(e.title||"")+"\n      ")]],2),i("p",{staticClass:"text"},[e._v(e._s(e.detail||""))]),e.$slots.footer?e._t("footer"):i("p",{staticClass:"time",domProps:{innerHTML:e._s(e.footer||"")}})],2),e.status&&!e.isShowNewStatus?i("div",{staticClass:"item-list-status"},[i("status-text",{attrs:{status:e.status,text:e.statusText,extend:e.statusClassSet}}),e.repairDeadline&&e.repairDeadlineStatus.includes(e.status)?i("p",{staticClass:"time-status"},[e._v("\n      "+e._s(e._f("timeStatus")(e.repairDeadline))+"\n    ")]):e._e()],1):e._e()])}),[],!1,null,null,null);t.a=c.exports}}]);