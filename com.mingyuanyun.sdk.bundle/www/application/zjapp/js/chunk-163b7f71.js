(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-163b7f71","chunk-59fa3e5d","chunk-0b5b35be","chunk-b1eec014","chunk-2709989a"],{"00f6":function(t,e,i){"use strict";var a=i("e2dd").a,n=(i("4bf2"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("scroller",{ref:"scroller"},[i("measure-detail-place-checkitem",{attrs:{detail:t.detail},on:{changeItems:t.changeItems,changePlace:t.changePlace}}),t.hasMasterCheckitem&&t.drawingUrl?["edit"===t.detail.mode||t.detail.isRepairMode?t._e():i("problem-detail-header",{staticClass:"bg-white",attrs:{status:t.detail.status}},[t.detail.allowReedit&&"view"===t.detail.mode?i("template",{slot:"operat"},[i("div",{staticClass:"btn-reedit",on:{click:function(e){t.changeMode("reedit")}}},[t._v("\n          修改\n          "),i("icon",{attrs:{name:"edit"}})],1)]):t._e()],2),t.detail.isRepairMode?i("status-total-bar",{attrs:{data:t.totalData}}):t._e(),i("drawing-3",{ref:"drawing",attrs:{detail:t.detail},on:{onChange:t.saveProblem,onClickPoint:t.onClickPoint}}),t.detail.isRepairMode?i("item",{attrs:{border:"top"}},[i("div",{staticClass:"item-text color-gray align-c"},[t._v("点击图纸中点位查看详情")])]):t._e(),"edit"===t.detail.mode||"redo"===t.detail.mode?[i("div",{staticStyle:{padding:"10px 0"}},[i("item",{staticClass:"pt15 pb15"},[i("item-img-list",{attrs:{maxlength:50,"track-text":"实测实量"},on:{callback:t.saveProblem},model:{value:t.detail.img,callback:function(e){t.$set(t.detail,"img",e)},expression:"detail.img"}})],1)],1),i("div",{staticClass:"mb10"},[i("p",{staticClass:"c-label"},[t._v("请选择施工单位")]),t._l(t.detail.problemData,(function(e){return i("single-select",{key:e.checkItem.id,attrs:{title:e.checkItem.name,"page-title":"选择施工单位",placeholder:"请选择施工单位",options:t.model.contractors},on:{onSelect:t.saveProblem},model:{value:e.contractor,callback:function(i){t.$set(e,"contractor",i)},expression:"problem.contractor"}})}))],2),t.detail.problemData[0].realityVal.length?i("item",{attrs:{label:"合格率",mode:"edit"}},[i("div",{staticClass:"item-text color-theme align-r",attrs:{slot:"right"},slot:"right"},[t._l(t.detail.problemData,(function(e,i){return[i?[t._v("; ")]:t._e(),t._v("\n            "+t._s(t._f("percent")(e.passrate,2))+"\n          ")]}))],2)]):t._e(),8!==t.detail.passrate_mode?i("item",{attrs:{label:"合格标准",mode:"edit"}},[i("div",{staticClass:"item-text color-gray align-r",attrs:{slot:"right"},slot:"right"},t._l(t.detail.problemData,(function(e,a){return i("p",{key:a},[5!==e.passrate_mode?i("span",{staticStyle:{display:"inline-block"}},[t._v(t._s(e.checkItem.name))]):t._e(),15===e.passrate_mode||16===e.passrate_mode||17===e.passrate_mode?i("span",{staticClass:"item-text_special",domProps:{innerHTML:t._s(e.standardRange)}}):i("span",{staticClass:"ml5",staticStyle:{"white-space":"nowrap"}},[t._v(t._s(e.standardRange))]),e.isJIcheMode?i("span",{staticClass:"color-gray"},[t._v("极差算法")]):t._e()])})))]):t._e(),t.hasPoint&&t.hasExceed&&"redo"!==t.detail.mode?[i("div",{staticClass:"need-repair",on:{click:t.setNeedRepair}},[i("icon",{attrs:{name:t.detail.needRepair?"checkbox-square-checked":"checkbox-square"}}),t._v("通知整改\n        ")],1),t.detail.needRepair?i("user-select",{attrs:{title:"整改人",options:t.model.repairOptions,memory:!0,"before-select":t.beforeSelectRepair},on:{onSelect:t.onSelectRepair},model:{value:t.detail.repair,callback:function(e){t.$set(t.detail,"repair",e)},expression:"detail.repair"}}):t._e(),t.detail.needRepair&&t.allowMeasureReinspect?i("user-select",{attrs:{title:"复验人",multi:!0,options:t.model.reinspectOptions,memory:!0,"before-confirm":t.beforeConfirmReinspect},model:{value:t.detail.reinspect,callback:function(e){t.$set(t.detail,"reinspect",e)},expression:"detail.reinspect"}}):t._e()]:t._e()]:t._e(),"view"===t.detail.mode||"reedit"===t.detail.mode?[i("item",{attrs:{label:"合格率"}},[i("div",{staticClass:"item-text align-r color-theme",attrs:{slot:"right"},slot:"right"},[t._l(t.detail.problemData,(function(e,i){return[i?[t._v("; ")]:t._e(),t._v("\n            "+t._s(t._f("percent")(e.passrate,2))+"\n          ")]}))],2)]),i("item",{staticClass:"mt10",attrs:{label:"点数"}},[i("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[t._l(t.detail.problemData,(function(e,i){return[i?[t._v("; ")]:t._e(),t._v("\n            "+t._s(e.pointNum)+"\n          ")]}))],2)]),8!==t.detail.passrate_mode?i("item",{attrs:{label:"合格标准"}},[i("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},t._l(t.detail.problemData,(function(e,a){return i("p",{key:a},[5!==e.passrate_mode?i("span",[t._v(t._s(e.checkItem.name))]):t._e(),15===e.passrate_mode||16===e.passrate_mode||17===e.passrate_mode?i("span",{staticClass:"item-text_special",domProps:{innerHTML:t._s(e.standardRange)}}):i("span",{staticClass:"ml5",staticStyle:{"white-space":"nowrap"}},[t._v(t._s(e.standardRange))]),e.isJIcheMode?i("span",{staticClass:"color-gray"},[t._v("极差算法")]):t._e()])})))]):t._e(),"reedit"===t.detail.mode?i("div",{staticClass:"mb10"},[i("p",{staticClass:"c-label"},[t._v("请选择施工单位")]),t._l(t.detail.problemData,(function(e){return i("single-select",{key:e.checkItem.id,attrs:{title:e.checkItem.name,"page-title":"选择施工单位",placeholder:"请选择施工单位",options:t.model.contractors,mode:"view"},model:{value:e.contractor,callback:function(i){t.$set(e,"contractor",i)},expression:"problem.contractor"}})}))],2):t._e()]:t._e(),"view"===t.detail.mode?[t.detail.img.length?i("item",{attrs:{label:"相关照片"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[i("item-img-list",{attrs:{editabled:!1},model:{value:t.detail.img,callback:function(e){t.$set(t.detail,"img",e)},expression:"detail.img"}})],1)]):t._e(),t.hasContractor?i("item",{attrs:{label:"施工单位"}},[i("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},t._l(t.detail.problemData,(function(e){return i("p",{key:e.id},[t._v("\n            "+t._s(e.contractor?e.contractor.name:"")+"\n          ")])})))]):t._e(),i("user-select",{attrs:{title:"检查人",mode:"view",editabled:!1},model:{value:t.detail.regist,callback:function(e){t.$set(t.detail,"regist",e)},expression:"detail.regist"}}),i("item",{attrs:{label:"检查时间",text:t.formatDate(t.detail.regist_date)}}),t.detail.isRepairMode?[t.detail.repair.id?i("user-select",{attrs:{title:"整改人",mode:"view",options:t.model.repairOptions,date:"已整改"===t.detail.status?t.formatDate(t.detail.repair_date):"",editabled:(t.detail.isChecker||t.detail.isRepair||t.detail.isReinspect)&&"待整改"===t.detail.status,"before-select":t.beforeSelectRepair},on:{onSelect:t.onSelectRepair},model:{value:t.detail.repair,callback:function(e){t.$set(t.detail,"repair",e)},expression:"detail.repair"}}):t._e(),t.detail.reinspect.length?i("user-select",{attrs:{title:"复验人",mode:"view",multi:!0,options:t.model.reinspectOptions,editabled:(t.detail.isChecker||t.detail.isReinspect)&&("待整改"===t.detail.status||"待复验"===t.detail.status),"before-confirm":t.beforeConfirmReinspect},on:{onSelect:t.onSelectReinspect},model:{value:t.detail.reinspect,callback:function(e){t.$set(t.detail,"reinspect",e)},expression:"detail.reinspect"}}):t._e()]:[(t.detail.repair_image_file&&t.detail.repair_image_file.length>0||t.detail.repair_remark)&&"待整改"!==t.detail.status?i("item",{attrs:{label:"整改照片"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[t.detail.repair_remark?i("div",{staticClass:"item-font"},[t._v(t._s(t.detail.repair_remark))]):t._e(),i("item-img-list",{attrs:{editabled:!1},model:{value:t.detail.repair_image_file,callback:function(e){t.$set(t.detail,"repair_image_file",e)},expression:"detail.repair_image_file"}})],1)]):t._e(),t.detail.repair.id&&"检查完毕"!==t.detail.status?i("user-select",{attrs:{title:"整改人",mode:"view",options:t.model.repairOptions,date:"已整改"===t.detail.status?t.formatDate(t.detail.repair_date):"",editabled:(t.detail.isChecker||t.detail.isRepair)&&"待整改"===t.detail.status},on:{onSelect:t.onSelectRepair},model:{value:t.detail.repair,callback:function(e){t.$set(t.detail,"repair",e)},expression:"detail.repair"}}):t._e(),t.detail.isRepair&&"待整改"===t.detail.status?i("item",{attrs:{label:"整改照片"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[i("item-img-list",{attrs:{maxlength:50,"track-text":"实测实量"},model:{value:t.detail.repair_image_file,callback:function(e){t.$set(t.detail,"repair_image_file",e)},expression:"detail.repair_image_file"}})],1)]):t._e(),t.detail.isRepair&&"待整改"===t.detail.status?i("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"补充说明"},model:{value:t.detail.repair_remark,callback:function(e){t.$set(t.detail,"repair_remark",e)},expression:"detail.repair_remark"}}):t._e(),"检查完毕"===t.detail.status&&t.hasPoint&&t.hasExceed&&"view"===t.detail.mode&&(!t.allowMeasureReinspect||t.detail.isChecker)?[i("div",{staticClass:"need-repair",on:{click:t.setNeedRepair}},[i("icon",{attrs:{name:t.detail.needRepair?"checkbox-square-checked":"checkbox-square"}}),t._v("通知整改\n          ")],1),t.detail.needRepair?i("user-select",{attrs:{title:"整改人",options:t.model.repairOptions,memory:!0,"before-select":t.beforeSelectRepair},model:{value:t.detail.repair,callback:function(e){t.$set(t.detail,"repair",e)},expression:"detail.repair"}}):t._e(),t.detail.needRepair&&t.allowMeasureReinspect?i("user-select",{attrs:{title:"复验人",multi:!0,options:t.model.reinspectOptions,memory:!0,"before-confirm":t.beforeConfirmReinspect},model:{value:t.detail.reinspect,callback:function(e){t.$set(t.detail,"reinspect",e)},expression:"detail.reinspect"}}):t._e(),t.detail.needRepair?i("app-button-group",{staticClass:"pt10"},[i("app-button",{attrs:{name:"通知整改"},on:{click:t.setRepair}})],1):t._e()]:t._e()]]:t._e(),"检查中"===t.detail.status||"view"!==t.detail.mode||t.allowMeasureReinspect||t.model.currentUserBatchId!==t.detail.batch_id?t._e():i("app-button-group",[i("app-button",{attrs:{type:"operate",name:"再测一次"},on:{click:t.setRedo}})],1)]:t._e(),i("loading-status",{attrs:{"is-loading":!1,"is-empty":!t.hasMasterCheckitem||!t.drawingUrl,"empty-text":t.hasMasterCheckitem?"没有户型图":"请选择检查项"}})],2)}),[],!1,null,"5c6caac0",null);e.a=s.exports},"0159":function(t,e,i){"use strict";var a=i("329b"),n=i("76c6").a,s=(i("fe89"),i("17cc")),o=Object(s.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"slide-right"}},[t.show?i("page-content",{attrs:{mode:"dialog",title:"户型图","on-close":t.closePopup}},["edit"===t.mode?i("div",{staticClass:"header-btn",attrs:{slot:"header-bar-right"},on:{click:t.confirm},slot:"header-bar-right"},[t._v("\n      确定\n    ")]):t._e(),i("scroller",{ref:"scroller"},["edit"===t.mode?i("div",{staticClass:"p15 border-bottom color-gray"},[t._v("\n        点击户型图标记爆点位置，并输入爆点数值\n      ")]):t._e(),i("drawing",{ref:"drawing",style:{height:t.drawingHeight+"px"},attrs:{url:t.url,points:t.points},on:{onclick:t.onclick,click:function(t){t.stopPropagation()}}}),"edit"===t.mode&&t.points.length?i("div",{staticClass:"point-input-list border-tb"},t._l(t.points,(function(e,a){return i("number-input",{key:a,ref:"exceed-point-input",refInFor:!0,staticClass:"mr10 mb10",attrs:{decimal:t.valueDecimal,range:t.valueRange},on:{focus:function(e){t.inputFocus(a)},blur:t.inputBlur},model:{value:e.val,callback:function(i){t.$set(e,"val",i)},expression:"point.val"}},[i("i",{staticClass:"icon-minus",attrs:{slot:"extend"},on:{click:function(i){i.stopPropagation(),t.removeExceedPoint(e)}},slot:"extend"})])}))):t._e(),"view"===t.mode?[t._l(t.layoutPointsData,(function(e,a){return[e.itemName?i("item",{key:a,attrs:{border:"top",label:e.itemName}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[t._l(e.areas,(function(a,n){return[a.points&&a.points.length?[a.areaName?i("p",{key:"name"+n,staticClass:"mb10"},[i("span",{staticClass:"area-name"},[t._v(t._s(a.areaName))])]):t._e(),i("div",{key:"points"+n},t._l(a.points,(function(a,n){return i("span",{key:n,staticClass:"point-ele mr10 mb10",class:{"point-exceed":a.isExceed,"point-cur":a.index===t.lightIndex},on:{click:function(e){t.clickPointEle(a)}}},[t._v("\n                      "+t._s(8===e.passrateMode?1===a.val?"合格":"不合格":a.val)+"\n                    ")])})))]:t._e()]}))],2)]):[t._l(e.areas,(function(a,n){return[a.points&&a.points.length?i("item",{key:n,staticClass:"pt15",attrs:{border:"top"}},[a.areaName?i("div",{staticClass:"item-label"},[t._v("\n                  "+t._s(a.areaName)+"\n                ")]):t._e(),i("div",{staticClass:"item-con"},t._l(a.points,(function(a,n){return i("span",{key:n,staticClass:"point-ele mr10 mb10",class:{"point-exceed":a.isExceed,"point-cur":a.index===t.lightIndex},on:{click:function(e){t.clickPointEle(a)}}},[t._v("\n                    "+t._s(8===e.passrateMode?1===a.val?"合格":"不合格":a.val)+"\n                  ")])})))]):t._e()]}))]]}))]:t._e(),t.scrollPaddingBottom?i("div",{style:{"padding-bottom":t.scrollPaddingBottom+"px"}}):t._e()],2)],1):t._e()],1)}),[],!1,null,"71ce7fec",null).exports,r=!1;r||(r=new(a.default.extend(o))({el:document.createElement("div")}),document.body.appendChild(r.$el));e.a=r},"03da":function(t,e,i){var a=i("393c");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("bca4d1cc",a,!0,{sourceMap:!1,shadowMode:!1})},"0732":function(t,e,i){var a=i("81f2");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("1b5b07de",a,!0,{sourceMap:!1,shadowMode:!1})},"0771":function(t,e,i){"use strict";var a=i("801f").a,n=(i("e3df"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",t._g({staticClass:"drawing-con",style:{width:t.width+"px",height:t.height+"px"}},t.$listeners),[t.isDownloading?[i("p",[i("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[i("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]),i("p",{staticClass:"loading-text"},[t._v("正在下载...")])]:[t.error?t._e():i("canvas",{ref:"drawing-canvas",style:{width:t.width+"px",height:t.height+"px"}}),t.error?i("p",{staticClass:"error-text"},[t._v(t._s(t.error))]):t._e()]],2)}),[],!1,null,"32c61736",null);e.a=s.exports},"0aac":function(t,e,i){"use strict";i("2814")},"0cb6":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .problem-detail-header[data-v-0901aadd]{display:flex;align-items:center;justify-content:center;height:40px;padding:0 15px;line-height:40px;background-color:#f2f2f2}.zjapp .problem-detail-header .status[data-v-0901aadd]{flex:1;height:16px;line-height:16px;border-left:5px solid #ddd;padding-left:5px;color:#111;font-size:16px}.zjapp .problem-detail-header .status-red[data-v-0901aadd]{border-color:#ff3d3d}.zjapp .problem-detail-header .status-blue[data-v-0901aadd]{border-color:#4275e8}.zjapp .problem-detail-header .status-green[data-v-0901aadd]{border-color:#0bc666}.zjapp .problem-detail-header .status-orange[data-v-0901aadd]{border-color:#fc8b01}.zjapp .problem-detail-header .status-black[data-v-0901aadd]{border-color:#333}.zjapp .problem-detail-header .status-gray[data-v-0901aadd]{border-color:#999}.zjapp .problem-detail-header .return[data-v-0901aadd],.zjapp .problem-detail-header .timeout[data-v-0901aadd],.zjapp .problem-detail-header .urgent[data-v-0901aadd]{display:block;padding:0 5px;margin-left:6px;height:16px;line-height:16px;color:#fff;font-size:12px;border-radius:2px;-webkit-border-radius:2px}.zjapp .problem-detail-header .urgent[data-v-0901aadd]{background-color:#ff3d3d}.zjapp .problem-detail-header .timeout[data-v-0901aadd]{background-color:#954cfe}.zjapp .problem-detail-header .return[data-v-0901aadd]{background-color:#fc8b01}.zjapp .problem-detail-header .operat[data-v-0901aadd]{height:40px;line-height:40px;white-space:nowrap;font-size:16px;color:#6b7ba9}",""])},1068:function(t,e,i){"use strict";(function(t){i("9dd9"),i("f548"),i("cc57");var a,n=i("07d2"),s=i("269c"),o=i("6f9e"),r=i("e89f"),l=i("c745"),c=[],d=[3,3,2,2],h=["无标段","无楼栋","无楼层","无房间"],p=["","list bg-gray6","list bg-gray5","list bg-gray4"];e.a={name:"DropDownSelectDialog",components:{Item:n.a,AppButton:s.a},mixins:[r.a],data:function(){return{show:!1,showList:!1,isOpening:!1,isClosing:!1,contentTop:64,listHeight:510,selectItems:[],layoutMap:[],loadingSet:{},optionsSet:{},selectedSet:{},componentUid:"",backButtonEvent:null,target:""}},computed:{isOptionsEmpty:function(){var e=this.selectItems[0];return!(!e||this.loadingSet[e]||!t.isEmpty(this.optionsSet[e]))},allowConfirm:function(){return!t.isEmpty(this.selectedSet)&&!t.isEmpty(this.selectedSet.floor)}},watch:{show:function(t){var e=this;t&&this.$nextTick((function(){e.showList=!0}))},selectedSet:function(e){var i=this;e&&this.$nextTick((function(){i.$refs["list-warp"]&&t.each(i.$refs["list-warp"].querySelectorAll(".selected")||[],(function(t){setTimeout((function(){t.scrollIntoViewIfNeeded(!0)}),400)}))}))}},created:function(){o.a.$on("routerBeforeEach",this.closePopup),o.a.$on("pageContentClick",this.onClickOther)},destroyed:function(){o.a.$off("routerBeforeEach",this.closePopup),o.a.$off("pageContentClick",this.onClickOther)},methods:{openPopup:function(e){var i=this;if(this.show)return e.componentUid===this.componentUid?void this.closePopup():void this.closePopup().then((function(){i.openPopup(e)}));this.componentUid=e.componentUid||"";var n=document.querySelector(".layout-main .layout-header");if(this.contentTop=n.offsetHeight,e.el){var s=e.el.getBoundingClientRect();this.contentTop=s.bottom}this.target=e.el,this.listHeight=t.minBy([window.innerHeight-this.contentTop-50,510]),c=t.clone(e.selected),a=e.callback,this.projId=e.projId,this.selectItems=e.selectItems,this.layoutMap=[];for(var o=0;o<this.selectItems.length;o++)this.layoutMap.push({level:o,key:this.selectItems[o],flex:d[o],bgColor:p[o],emptyText:h[o]});this.init(),this.show=!0,this.$emit("open")},closePopup:function(){var t=this;if(!this.isOpening)return this.showList=!1,this.$emit("close"),new Promise((function(e){t.$on("afterClosePopup",e)}))},afterClose:function(){this.show=!1,this.isClosing=!1,this.$emit("afterClosePopup")},onClickOther:function(t){t&&t.target&&t.target!==this.target&&this.show&&this.closePopup()},getNextItemOptions:function(t){var e={section:this.getSectionOptions,"building-unit":this.getBuildingUnitOptions,floor:this.getFloorOptions,room:this.getRoomOptions},i=this.selectItems.indexOf(t),a=e[this.selectItems[i+1]];return a?a():Promise.resolve()},getSectionOptions:function(){var t=this;return this.$set(this.loadingSet,"section",!0),l.a.getProjectSections(this.projId).then((function(e){t.$set(t.optionsSet,"section",e),t.$set(t.loadingSet,"section",!1)}))},getBuildingUnitOptions:function(){var t=this,e=this.selectedSet.section,i=e&&e.id?e.id:"";return i?(this.$set(this.loadingSet,"building-unit",!0),l.a.getSectionBuildingAndUnit(i).then((function(e){t.$set(t.optionsSet,"building-unit",e),t.$set(t.loadingSet,"building-unit",!1)}))):Promise.resolve()},getFloorOptions:function(){var t=this,e=this.selectedSet.building,i=e&&e.id?e.id:"";return i?(this.$set(this.loadingSet,"floor",!0),l.a.getBuildingFloors(i).then((function(e){t.$set(t.optionsSet,"floor",e),t.$set(t.loadingSet,"floor",!1)}))):Promise.resolve()},getRoomOptions:function(){var t=this,e=this.selectedSet.building,i=e&&e.id?e.id:"",a=this.selectedSet.unit,n=this.selectedSet.floor;return a=a&&a.id?a.id:"",n=n&&n.id?n.id:"",i&&n?(this.$set(this.loadingSet,"room",!0),l.a.getBuildingRooms(i,a,n).then((function(e){t.$set(t.optionsSet,"room",e),t.$set(t.loadingSet,"room",!1)}))):Promise.resolve()},setItem:function(t,e){var i={section:this.setSection,"building-unit":this.setBuildingAndUnit,floor:this.setFloor,room:this.setRoom};return i[e]?i[e](t):Promise.resolve()},setSection:function(t){return this.$set(this.selectedSet,"section",t),this.clearNextAndAll("section"),this.getNextItemOptions("section")},setBuildingAndUnit:function(t){return this.$set(this.selectedSet,"building",t?{id:t.building_id,name:t.building_name}:null),this.$set(this.selectedSet,"unit",t?{id:t.unit_id,name:t.unit_name}:null),this.$set(this.selectedSet,"building-unit",t?{id:t.id,name:t.name}:null),this.clearNextAndAll("building-unit"),this.getNextItemOptions("building-unit")},setFloor:function(t){return this.$set(this.selectedSet,"floor",t),this.clearNextAndAll("floor"),this.getNextItemOptions("floor")},setRoom:function(t){return this.$set(this.selectedSet,"room",t),this.clearNextAndAll("room"),this.getNextItemOptions("room")},clearItemData:function(t){"building-unit"===t?(this.$set(this.selectedSet,"building",null),this.$set(this.selectedSet,"unit",null),this.$set(this.selectedSet,"building-unit",null),this.$set(this.optionsSet,"itemKey",[])):(this.$set(this.selectedSet,t,null),this.$set(this.optionsSet,t,[]))},clearNextAndAll:function(t){for(var e=this.selectItems.indexOf(t)+1;e<this.selectItems.length;e++)this.clearItemData(this.selectItems[e])},init:function(){var e=this;return this.getNextItemOptions().then((function(){var i=Promise.resolve();return c.project&&e.$set(e.selectedSet,"project",c.project),t.each(e.selectItems,(function(t){var a;if("building-unit"===t){var n=c.building,s=c.unit;a=n?{id:n.id+(s.id?"|"+s.id:""),name:n.name+(s.name?"-"+s.name:""),building_id:n.id,building_name:n.name,unit_id:s.id,unit_name:s.name}:null}else a=c[t];a&&i.then((function(){return e.setItem(a,t)}))})),i}))},isItemOptionsEmpty:function(e){var i=this.selectItems.indexOf(e)-1,a=this.selectItems[i];return!(t.isEmpty(this.selectedSet[a])||!t.isEmpty(this.optionsSet[e]))},showName:function(t){var e=t;return e=(e=e.replace(new RegExp("<","gm"),"&lt;")).replace(new RegExp(">","gm"),"&gt;")},select:function(e,i){var a=this,n=i===t.last(this.selectItems);this.setItem(e,i),n&&setTimeout((function(){a.confirm()}),100)},confirm:function(){if(this.allowConfirm){var e=t.extend({},this.selectedSet);a&&a(e),this.closePopup()}}}}}).call(this,i("391c"))},"12f4":function(t,e,i){"use strict";i("6a26")},"141b":function(t,e,i){var a=i("1736");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("64328a9c",a,!0,{sourceMap:!1,shadowMode:!1})},1736:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .content[data-v-1db489ae]{position:fixed;width:100%;bottom:0;background-color:rgba(0,0,0,.4);overflow:hidden}.zjapp .box[data-v-1db489ae]{flex-direction:column}.zjapp .box[data-v-1db489ae],.zjapp .list-wrap[data-v-1db489ae]{display:flex;background-color:#fff}.zjapp .list-wrap[data-v-1db489ae]{flex-direction:row;align-items:flex-start;flex:1;height:465px}.zjapp .list[data-v-1db489ae]{padding:0 10px}.zjapp .list[data-v-1db489ae],.zjapp .list-single[data-v-1db489ae]{flex:1;overflow:auto;height:100%;scroll-behavior:smooth}.zjapp .item-dropdown[data-v-1db489ae]{padding:6px 0;background-color:transparent}.zjapp .item-dropdown[data-v-1db489ae] .item-text{font-size:14px}.zjapp .item-dropdown.selected[data-v-1db489ae]{color:#4275e8;padding-bottom:5px;border-bottom:1px solid #4275e8}.zjapp .item-dropdown.selected[data-v-1db489ae] .item-text{color:#4275e8}.zjapp .empty-tips[data-v-1db489ae],.zjapp .loading-tips[data-v-1db489ae]{padding:13px 0;line-height:20px;color:#b2b2b2;font-size:14px}.zjapp .select-note[data-v-1db489ae]{line-height:16px;font-size:12px;color:#8c8c8c}.zjapp .btn-confirm[data-v-1db489ae]{background-color:#ebf1ff;background-image:none;color:#4275e8;border-radius:0}.zjapp .btn-confirm.btn-disabled[data-v-1db489ae]{background-color:#f4f4f4;color:#b2b2b2}",""])},1985:function(t,e,i){"use strict";(function(t){i("cc57");var a=i("30df");e.a={name:"DropDownSelect",props:{value:{type:Object,default:function(){}},selectItems:{type:Array,default:function(){return["section","building-unit","floor","room"]}},isLoading:{type:Boolean,default:!1},editabled:{type:Boolean,default:!0},showUnit:{type:Boolean,default:!0}},data:function(){return{isOpen:!1}},computed:{hdText:function(){return t.isEmpty(this.value)||t.isEmpty(this.value.section)?this.editabled?"请选择":"无":this.value.section.name},bdText:function(){var e="";return t.isEmpty(this.value)||t.isEmpty(this.value.building)?e=this.editabled?"请选择":"无":(e=e+this.value.building.name||"",!t.isEmpty(this.value.unit)&&this.showUnit&&(e=e+this.value.unit.name||""),t.isEmpty(this.value.room)||t.isEmpty(this.value.room.id)?t.isEmpty(this.value.floor)||(e=e+this.value.floor.name||""):e=e+this.value.room.name||""),e}},created:function(){var t=this;a.a.$on("afterClosePopup",(function(){t.isOpen=!1}))},methods:{openDialog:function(){var t=this;if(this.editabled&&!this.isLoading){var e=this.value&&this.value.project&&this.value.project.id;e||(e=this.$store.state.global.currentProject.id),a.a.openPopup({projId:e,selected:this.value,selectItems:this.selectItems,el:this.$refs["select-con"],componentUid:this._uid,callback:function(e){t.$emit("input",e),t.$emit("onSelect",e)}}),this.isOpen=!0}}}}}).call(this,i("391c"))},"1bcd":function(t,e,i){"use strict";i.r(e);var a=i("a492").a,n=(i("a876"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("page-content",{attrs:{title:"实测实量","show-go-root":!0}},[i("template",{slot:"header-bar-center"},[t.tabs.length>1&&!t.readonly?i("div",{staticClass:"header-tabs"},t._l(t.tabs,(function(e,a){return i("div",{key:a,staticClass:"header-tab",class:{on:e.key===t.currentTab},on:{click:function(i){t.changeTab(e)}}},[t._v("\n        "+t._s(e.name)+"\n      ")])}))):i("div",{staticClass:"header-bar-title"},[t._v("\n      "+t._s(t.model.placeFullname)+"\n    ")])]),t.isLoading?t._e():i("check-guide",{attrs:{slot:"header-bar-right",module:"measure","item-ids":t.checkItemGuideIds,mode:"drop"},slot:"header-bar-right"}),t.isLoading?t._e():[t.detail&&t.detail.problemData&&t.detail.problemData.length?[1===t.detail.entry_requirements?i("measure-detail-template-1",{ref:"template-1",attrs:{detail:t.detail},on:{changeItems:t.changeItems,changePlace:t.changePlace}}):t._e(),2===t.detail.entry_requirements?i("measure-detail-template-2",{ref:"template-2",attrs:{detail:t.detail},on:{changeItems:t.changeItems,changePlace:t.changePlace}}):t._e(),3===t.detail.entry_requirements?i("measure-detail-template-3",{ref:"template-3",attrs:{detail:t.detail},on:{changeItems:t.changeItems,changePlace:t.changePlace}}):t._e()]:t._e(),i("loading-status",{attrs:{"is-empty":!t.detail.problemData.length,"empty-text":"暂无实测记录"}})],i("loading-status",{attrs:{"is-loading":t.isLoading}}),t.isLoading||3===t.detail.entry_requirements&&!t.drawingUrl?t._e():["edit"===t.detail.mode||"reedit"===t.detail.mode||"redo"===t.detail.mode||"待整改"===t.detail.status&&t.detail.isRepair&&!t.detail.isRepairMode?i("app-button-group",{attrs:{"fixed-bottom":"",seamless:"edit"===t.detail.mode||"redo"===t.detail.mode}},["edit"===t.detail.mode||"redo"===t.detail.mode?i("app-button",{staticStyle:{width:"50%"},attrs:{name:"暂存",plain:"",disabled:"redo"===t.detail.mode},on:{click:t.saveProblemAndTip,disabledClick:t.disabledSaveTip}}):t._e(),"edit"===t.detail.mode?i("app-button",{attrs:{name:"提交检查记录"},on:{click:t.submitCheck}}):t._e(),"redo"===t.detail.mode?i("app-button",{attrs:{name:"提交"},on:{click:t.submitRedo}}):t._e(),"reedit"===t.detail.mode?i("app-button",{attrs:{name:"提交检查记录"},on:{click:t.resubmitCheck}}):t._e(),"待整改"===t.detail.status&&t.detail.isRepair&&"view"===t.detail.mode&&!t.detail.isRepairMode?i("app-button",{attrs:{name:"完成整改"},on:{click:t.submitRepair}}):t._e()],1):t._e()]],2)}),[],!1,null,"73f776ea",null);e.default=s.exports},"1c2a":function(t,e,i){var a=i("8eeb");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("025a093f",a,!0,{sourceMap:!1,shadowMode:!1})},"1f63":function(t,e,i){"use strict";i("7434")},2814:function(t,e,i){var a=i("5033");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("9db19832",a,!0,{sourceMap:!1,shadowMode:!1})},2939:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .page-scroll[data-v-74102c05]{flex:1;overflow:auto;padding-bottom:100px;transform:translateZ(0)}.zjapp .sublist[data-v-74102c05]{padding-left:25px;padding-top:1px;background-color:#fff}.zjapp .sublist>.sublist[data-v-74102c05]{padding-left:10px;padding-top:0}",""])},"29be":function(t,e,i){"use strict";(function(t){i("5ab2"),i("6d57"),i("e10e");var a=i("28f8"),n=(i("cc57"),i("163d"),i("07d2")),s=i("a5c6"),o=i("6144");function r(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?r(Object(i),!0).forEach((function(e){Object(a.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}e.a={name:"SingleSelect",components:{Item:n.a},props:{title:{type:String,default:""},pageTitle:{type:String,default:""},placeholder:{type:String,default:""},value:{type:Object,default:function(){return{}}},options:{type:Array,default:function(){return[]}},optionsDisabled:{type:Array,default:function(){return[]}},required:{type:Boolean,default:!0},mode:{type:String,default:"edit"},editabled:{type:Boolean,default:!0},memory:{type:Boolean,default:!1},autoSelect:{type:Boolean,default:!1},beforeOpen:{type:Function,default:function(){}},searchBar:{type:Boolean,default:!0},grouping:{type:String,default:""},autoOpen:{type:Boolean,default:!1},rightBtn:{type:String,default:""},rightBtnEvent:{type:Function,default:function(){return 0}},ifToggle:{type:Boolean,default:!1},formCheck:{type:Boolean,default:!1},editorAddData:{type:Boolean,default:!1},lineLimit:{type:[Number,String],default:1}},data:function(){return{memoryKey:this.$route.name+encodeURI(this.title)}},watch:{options:function(){this.setSelected()}},mounted:function(){this.setSelected()},methods:{openSelect:function(){var e=this;if(this.editabled){var i=this.beforeOpen();i&&i.then&&t.isFunction(i.then)?i.then((function(t){!1!==t&&e.openPopup()})):!1!==i&&this.openPopup()}},openPopup:function(){var e=this;if(this.optionsDisabled&&this.optionsDisabled.length){var i={};t.each(this.optionsDisabled,(function(t){t.id&&(i[t.id]=t)})),t.each(this.options,(function(t,a){i[t.id]?e.options[a].disabled=!0:e.options[a].disabled=!1}))}s.a.openPopup({title:this.pageTitle||"选择"+this.title,selected:this.value,options:this.options,required:this.required,searchBar:this.searchBar,grouping:this.grouping,autoOpen:this.autoOpen,rightBtn:this.rightBtn,ifToggle:this.ifToggle,lineLimit:this.lineLimit,editorAddData:this.editorAddData,onSelect:function(i){var a=t.cloneDeep(e.value);i=t.isArray(i)?t.map(i,(function(t){return l({},t)})):l({},i),e.$emit("input",i,a),e.$emit("onSelect",i,a)},rightBtnEvent:function(i){var a=t.cloneDeep(e.value);e.$emit("rightBtnEvent",i,a)}})},closePopup:function(){s.a.closePopup()},onSelect:function(t){o.a.saveObject(this.memoryKey,t,o.a.level.user),this.$emit("input",t[0]),this.$emit("onSelect",t[0])},setSelected:function(){var e=o.a.getObject(this.memoryKey,o.a.level.user);!1===this.editabled||t.isEmpty(this.options)||(t.isEmpty(this.value)?this.memory&&!t.isEmpty(e)&&t.some(this.options,{id:e.id})&&(this.$emit("input",e),this.autoSelect&&this.$emit("onSelect",e)):this.autoSelect&&this.$emit("onSelect",this.value))}}}}).call(this,i("391c"))},"2c76":function(t,e,i){"use strict";i("c070")},"2c79":function(t,e,i){var a=i("a43f");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("770b4153",a,!0,{sourceMap:!1,shadowMode:!1})},"2dd6":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .single-item[data-v-6920dde7]{min-height:44px}.zjapp .single-item>div[data-v-6920dde7]{display:flex}.zjapp .single-item>div>span[data-v-6920dde7]{flex:1;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical}.zjapp .single-item>div>span[data-v-6920dde7] label{color:#4174e9}.zjapp .single-item i[data-v-6920dde7]{line-height:24px;font-size:24px;color:#4275e8}.zjapp .single-item .disabled-item[data-v-6920dde7]{color:#aaa}",""])},"2ddb":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .supplier-editor[data-v-e465319c]{margin-bottom:10px;padding:8px;display:flex;justify-content:space-between;align-items:center;height:52px;color:#4275e8;background-color:#fff}.zjapp .supplier-editor .icon[data-v-e465319c]{border-left:1px solid #c8c8c8;padding-left:12px}.zjapp .supplier-editor .icon-edit[data-v-e465319c]{color:#c8c8c8;font-size:18px}.zjapp .supplier-editor .icon-qualified[data-v-e465319c]{color:#4275e8}.zjapp .supplier-editor .margin-r[data-v-e465319c]{margin-right:10px}.zjapp .list-title[data-v-e465319c]{position:relative;top:0;color:#888;font-size:14px;line-height:30px;min-height:40px;margin-bottom:0;margin-top:0;padding:8px 16px 2px}.zjapp .search-item>div[data-v-e465319c]{padding-right:35px}.zjapp .search-item i[data-v-e465319c]{position:absolute;color:#ccc;font-size:26px;right:0;top:50%;transform:translateY(-50%)}.zjapp .van-popup--right[data-v-e465319c]{width:100%;height:100%}[data-v-e465319c] .van-cell__title{color:#4174e9;font-weight:700}[data-v-e465319c] .van-collapse-item__content{transform:translateZ(0);padding:0 0 0 25px}[data-v-e465319c] .van-collapse-item__content .van-cell{padding-left:0}",""])},"30df":function(t,e,i){"use strict";var a=i("329b"),n=i("1068").a,s=(i("f669"),i("17cc")),o=Object(s.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{staticClass:"content",style:{top:t.contentTop+"px"},on:{click:function(e){return e.target!==e.currentTarget?null:t.closePopup(e)}}},[i("transition",{attrs:{name:"slide-down"},on:{enter:function(e){t.isOpening=!0},"after-enter":function(e){t.isOpening=!1},leave:function(e){t.isClosing=!0},"after-leave":t.afterClose}},[t.showList?i("div",{staticClass:"box",style:{height:t.listHeight+"px"}},[t.isOptionsEmpty?t._e():i("div",{ref:"list-warp",staticClass:"list-wrap"},t._l(t.layoutMap,(function(e,a){var n;return i("div",{key:"map"+a,staticClass:"list",class:(n={},n[e.bgColor]=!0,n),style:{flex:e.flex}},[t.loadingSet[e.key]?i("div",{staticClass:"loading-tips"},[t._v("\n            ...\n          ")]):[t._l(t.optionsSet[e.key],(function(a,n){return i("item",{key:n,staticClass:"item-dropdown",class:{selected:t.selectedSet[e.key]&&t.selectedSet[e.key].id===a.id},on:{click:function(i){t.select(a,e.key)}}},[i("div",{staticClass:"item-text"},[i("p",{domProps:{innerHTML:t._s(t.showName(a.nameShow||a.name))}}),i("p",{staticClass:"select-note"},[t._v(t._s(a.note))])])])})),t.optionsSet[e.key]&&t.optionsSet[e.key].length?t._e():i("div",{staticClass:"empty-tips"},[t._v("\n              "+t._s(t.isItemOptionsEmpty(e.key)?e.emptyText:"请选择")+"\n            ")])]],2)}))),i("app-button",{staticClass:"btn-confirm",class:{"btn-disabled":!t.allowConfirm},attrs:{name:"确定"},on:{click:t.confirm}}),i("loading-status",{attrs:{"is-empty":t.isOptionsEmpty,"empty-text":"没有数据"}})],1):t._e()])],1):t._e()}),[],!1,null,"1db489ae",null).exports,r=!1;r||(r=new(a.default.extend(o))({el:document.createElement("div")}),document.body.appendChild(r.$el));e.a=r},"3156b":function(t,e,i){"use strict";i("163d");var a={name:"SingleSelectItem",props:{item:{type:Object,default:function(){return{id:"",name:""}}},checked:{type:Boolean,default:!1},renderField:{type:String,default:"name"},lineLimit:{type:[Number,String],default:1}},methods:{selectItem:function(t){t.disabled||this.$emit("click",t)}}},n=(i("9788"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-cell",{staticClass:"single-item",attrs:{clickable:!0},on:{click:function(e){t.selectItem(t.item)}}},[i("span",{class:{"disabled-item":t.item.disabled},style:{"-webkit-line-clamp":"unlimited"===t.lineLimit?"initial":t.lineLimit},domProps:{innerHTML:t._s(t.item[t.renderField])}}),t.checked?i("van-icon",{attrs:{name:"success"}}):t._e()],1)}),[],!1,null,"6920dde7",null);e.a=s.exports},"316a":function(t,e,i){"use strict";(function(t){i("cc57"),i("163d");var a=i("afd5");e.a={name:"DropDownSelect",props:{value:{type:Array,default:function(){return[]}},masterCheckitem:{type:Array,default:function(){return[]}},options:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:!1},editabled:{type:Boolean,default:!0},place:{type:Object,default:function(){}},batchId:{type:String,default:""},processMode:{type:[Number,String],default:""},mode:{type:String,default:"edit"},multi:{type:Boolean,default:!1},openStatus:{type:Array,default:function(){return[]}}},data:function(){return{isOpen:!1}},computed:{hdText:function(){return t.isEmpty(this.masterCheckitem)||t.isEmpty(this.masterCheckitem[0])?this.editabled?"请选择":"无":this.masterCheckitem[0].name},bdText:function(){return t.isEmpty(this.masterCheckitem)?this.editabled?"请选择":"无":t.isEmpty(this.value)?this.editabled?"请选择":"无":1===this.value.length?this.value[0].name:this.value.length+"项"}},created:function(){var t=this;a.a.$on("afterClosePopup",(function(){t.isOpen=!1}))},methods:{openDialog:function(){var t=this;this.editabled&&!this.isLoading&&(a.a.openPopup({options:this.options,selected:this.value,place:this.place,batchId:this.batchId,processMode:this.processMode,mode:this.mode,multi:this.multi,openStatus:this.openStatus,el:this.$refs["select-con"],componentUid:this._uid,callback:function(e){t.$emit("input",e),t.$emit("onSelect",e)}}),this.isOpen=!0)}}}}).call(this,i("391c"))},"32a1":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .drawing[data-v-71ce7fec]{display:block}.zjapp .point-input-list[data-v-71ce7fec]{padding:15px 0 5px 15px;background-color:#fff}.zjapp .area-name[data-v-71ce7fec]{background-color:#f0f0f0;color:#8c8c8c;padding:2px}.zjapp .point-ele[data-v-71ce7fec]{display:inline-block;width:56px;height:30px;line-height:28px;border:1px solid #dcdcdc;border-radius:3px;background-color:#fff;white-space:nowrap;overflow:hidden;color:#333;text-align:center}.zjapp .point-exceed[data-v-71ce7fec]{color:#ff4644}.zjapp .point-cur[data-v-71ce7fec]{background-color:#4275e8;border-color:#4275e8;color:#fff}",""])},"339b":function(t,e,i){"use strict";i("03da")},"393c":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .select-con[data-v-43c15cbc]{position:relative;padding:7px 40px 7px 15px;height:50px;overflow:hidden}.zjapp .select-con>*[data-v-43c15cbc]{pointer-events:none}.zjapp .select-hd[data-v-43c15cbc]{line-height:14px;font-size:10px}.zjapp .select-bd[data-v-43c15cbc],.zjapp .select-hd[data-v-43c15cbc]{color:#333;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.zjapp .select-bd[data-v-43c15cbc]{margin-top:2px;line-height:20px;font-size:14px}.zjapp .select-arrow[data-v-43c15cbc]{position:absolute;top:5px;right:0;width:40px;height:40px;line-height:40px;font-size:16px;color:#c8c8c8;text-align:center}.zjapp .select-disabled[data-v-43c15cbc]{background-color:#f5f7fb}.zjapp .select-disabled .select-bd[data-v-43c15cbc],.zjapp .select-disabled .select-hd[data-v-43c15cbc]{color:#666}.zjapp .select-disabled .select-arrow[data-v-43c15cbc]{display:none}",""])},"3c64":function(t,e,i){"use strict";i("163d");var a={name:"ItemTextarea",components:{},props:{value:{type:String,default:""},placeholder:{type:String,default:""},maxlength:{type:Number,default:200},borderBottom:{type:Boolean,default:!0}},data:function(){return{textareaHeight:40,isLock:!1,blurTime:null}},computed:{lastLength:function(){var t=this.value&&this.value.length||0,e=this.maxlength-t;return e>0?e:0}},mounted:function(){var t=this;this.$nextTick((function(){t.textareaHeight=t.$refs.rule&&t.$refs.rule.offsetHeight||40}))},methods:{onfocus:function(){var t=(new Date).getTime();this.blurTime&&t-this.blurTime<300&&window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(this.$refs.input.blur(),window.cordova.plugins.Keyboard.close()),this.blurTime=null,this.$emit("focus")},onblur:function(){this.blurTime=(new Date).getTime(),this.$emit("blur")},setStatus:function(t){console.log(t),this.isLock=t},oninput:function(t){var e=this;setTimeout((function(){if(!e.isLock){var i=t.target.value;i.length>e.maxlength&&(i=i.substring(0,e.maxlength),e.$refs.input.value=i),e.$refs.rule.innerText=i,e.textareaHeight=e.$refs.rule&&e.$refs.rule.offsetHeight+20,e.$emit("input",i),e.$emit("change",i)}}),0)}}},n=(i("2c76"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-textarea",class:{"border-bottom":t.borderBottom}},[i("div",{staticClass:"item-textarea-content"},[i("textarea",{ref:"input",style:{height:t.textareaHeight+"px"},attrs:{placeholder:t.placeholder},domProps:{value:t.value},on:{focus:t.onfocus,blur:t.onblur,compositionstart:function(e){t.setStatus(!0)},compositionend:function(e){t.setStatus(!1)},input:t.oninput}}),i("div",{ref:"rule",staticClass:"rule"},[t._v("\n      "+t._s(t.value)+"\n    ")]),t.maxlength!==1/0?i("p",{staticClass:"counter"},[t._v("\n      "+t._s(t.lastLength)+"\n    ")]):t._e()])])}),[],!1,null,null,null);e.a=s.exports},"3cd8":function(t,e,i){var a=i("5c19");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("67c16200",a,!0,{sourceMap:!1,shadowMode:!1})},"3f7a":function(t,e,i){"use strict";(function(t){i("cc57"),i("6f84"),i("6d57"),i("e697"),i("ed63"),i("8cf2"),i("2b45"),i("163d"),i("9d30");var a=i("3122"),n=i("4ad6"),o=i("3bd5"),r=i("1b7e"),l=i("e900"),c={},d=["1","2","3","删除","4","5","6","-","7","8","9",".","上一项","0","下一项","关闭"];function h(t){return""!==t&&null!=t&&!Number.isNaN(t)}e.a={name:"MeasureDrawing3",components:{},props:{url:{type:String},data:{type:Array},pointStatus:{type:Array},points:{type:Array},mode:{type:String,default:"edit"},width:{type:Number,default:document.documentElement.clientWidth},height:{type:Number,default:document.documentElement.clientWidth},folder:{type:String,default:"house-image"},pointRadius:{type:Number,default:8},pointRatio:{type:Number,default:2},clickDelay:{type:Number,default:500},hasBouncing:{type:Boolean,default:!0},inputRange:{type:Array,default:function(){return[-9999999.99999,9999999.99999]}}},data:function(){return{drawing:null,isDownloading:!1,error:"",canvas:null,ctx:null,img:null,src:"",x:0,y:0,scale:1,defaultScale:1,pixelRatio:1,markPosition:null,markPositionImageData:[],markCoordinates:[],pinchRatio:0,xRange:null,yRange:null,scaleMin:1,scaleMax:1,isPinch:!1,clickPoints:[],touchStart:{x:0,y:0,cx:0,cy:0,time:0},isMoving:!1,moveTimer:null,moveDest:{x:null,y:null},pinchCenter:{},lightRipple:0,lightRippleTimer:null,lightRippleTimes:0,lightRippleTimesMax:2,hasWarning:!1,warningRipple:0,warningRippleTimer:null,drawPointIndex:null,lightInputIndex:null,keyboradActionData:{},isInputShow:!1,isKeyboardShow:!1,inputLength:0,hasOperaBtn:!1,hasPrevInput:!1,hasNextInput:!1}},computed:{sizeStyle:function(){return{width:"".concat(this.width,"px"),height:"".concat(this.height,"px")}},passrateMode:function(){return this.data&&this.data[0]&&this.data[0].passrateMode},comboLength:function(){return this.data&&this.data.length},drawingPoints:function(){return console.log("this.getDrawPoints(this.data) ========",this.getDrawPoints(this.data)),this.getDrawPoints(this.data)},measureItem:function(){return 5===passrateMode?["高","宽"]:5===passrateMode?["开间","进深"]:[]}},watch:{url:function(t){t&&this.$nextTick(this.getImage)},data:{handler:function(t){console.log("data cccccccccc ----------",t,this),this.draw()},deep:!0}},mounted:function(){this.getImage()},beforeDestroy:function(){this.drawing.destroy()},methods:{getImage:function(){var e=this;if(!this.isDownloading){if(console.log("getImage -----------",this.url),this.isDownloading=!0,this.url){var i=o.a.getUser().user_id,l=s.replaceAll(this.url,"\\?x-oss-process=image\\/resize,","@"),c=s.strRightBack(l,"/");if(!c)return this.error="户型图地址错误",void(this.isDownloading=!1);this.error="";var d=[n.a.appImagePath()+i+"/house-image/"+c,n.a.appImagePath()+i+"/drawing/"+c,n.a.appImagePath()+i+"/images/"+c,n.a.appDataPath()+i+"/house-image/"+c,n.a.appDataPath()+i+"/drawing/"+c,n.a.appDataPath()+i+"/images/"+c],h=Promise.resolve();return"dev"===APP_ENV?h=h.then((function(){return e.url})):t.each(d,(function(t){h=h.then((function(e){return e||n.a.isFileExists(t).then((function(e){if(e)return a.a._fixPath(t)}))}))})),h.then((function(t){if(console.log("获取图片 src =========",t),!t)return r.a.getHasNetwork().then((function(t){return t?a.a.download(e.url,!0,e.folder).then((function(t){e.src=t})):Promise.reject("当前无网络")}));e.src=t})).then((function(){console.log("this.src ======",e.src),e.src?(e.img=new Image,e.img.onload=function(){e.img.complete?(console.log("图片加载成功 ---------"),e.isDownloading=!1,e.$nextTick(e.init)):(console.log("11111"),e.error="加载图片失败",e.isDownloading=!1)},e.img.onerror=function(){console.log("22222"),e.error="加载图片失败",e.isDownloading=!1},e.img.src=e.src):(e.error="下载户型图失败",e.isDownloading=!1)})).catch((function(i){e.error=t.isString(i)?i:"下载户型图失败",e.isDownloading=!1}))}this.error="户型图地址错误",this.isDownloading=!1}},init:function(){if(!this.isDownloading&&this.$refs["drawing-canvas"]){var t=this.$refs.content;this.canvas=this.$refs["drawing-canvas"],this.ctx=this.canvas.getContext("2d"),this.width=t.offsetWidth,this.height=t.offsetHeight,this.pixelRatio=this.getPixelRatio(this.ctx),this.canvas.style.height=this.height+"px",this.canvas.style.width=this.width+"px",this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,!this.ctx.extended&&Object(l.a)(this.ctx),this.bindTouchEvent(),this.calc(),this.draw()}},getPixelRatio:function(t){var e=t.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},winToCanvas:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:t-i.left*(this.canvas.width/(i.width*this.pixelRatio)),y:e-i.top*(this.canvas.height/(i.height*this.pixelRatio))}},bindTouchEvent:function(){this.canvas.addEventListener("touchstart",this.onTouchstart),this.canvas.addEventListener("touchmove",this.onTouchmove),this.canvas.addEventListener("touchend",this.onTouchend)},unbindTouchEvent:function(){this.canvas.removeEventListener("touchstart",this.onTouchstart),this.canvas.removeEventListener("touchmove",this.onTouchmove),this.canvas.removeEventListener("touchend",this.onTouchend)},isPinching:function(t){var e=t.changedTouches.length,i=t.touches.length;return 1===e||2===e||2===i},isDragging:function(t){return 1===t.touches.length},onTouchstart:function(t){if(this.isPinch=!1,this.isDragging(t))this.touchStartHandler(t);else if(this.isPinching(t)){var e,i=t.touches[0],a=t.touches[1],n=this.winToCanvas(i.clientX,i.clientY),s=this.winToCanvas(a.clientX,a.clientY);e=Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2)),this.pinchRatio=this.scale/e}},onTouchmove:function(t){if("img"!==this.mode){var e,i=t.touches[0];if(this.isDragging(t)){if(this.touchStart||this.touchStartHandler(t),("b"===(e=this.getDraggingDirection(this.touchStart,i))&&this.isBoundary("b")||"t"===e&&this.isBoundary("t")||"r"===e&&this.isBoundary("r")||"l"===e&&this.isBoundary("l"))&&!this.hasBouncing)return;t.preventDefault(),t.stopPropagation(),(Math.abs(i.clientX-this.touchStart.cx)>3||Math.abs(i.clientY-this.touchStart.cy)>3)&&this.touchMoveHandler(t)}else this.isPinching(t)&&this.touchPinchHandler(t)}},onTouchend:function(t){this.touchEndHandler(t)},touchStartHandler:function(t){var e=t.touches[0],i=this.winToCanvas(e.clientX,e.clientY);this.touchStart={x:i.x,y:i.y,cx:e.clientX,cy:e.clientY,time:Date.now()}},touchMoveHandler:function(t){var e=t.touches[0],i=this.winToCanvas(e.clientX,e.clientY),a=(i.x-this.touchStart.x)*this.pixelRatio,n=(i.y-this.touchStart.y)*this.pixelRatio,s=this.getMoveOverflow(),o=this.x+a,r=this.y+n;this.isPinch||(this.touchStart.x=i.x,this.touchStart.y=i.y,o<=this.xRange[0]||o>=this.xRange[1]?!1===this.hasBouncing?o<=this.xRange[0]?this.x=this.xRange[0]:this.x=this.xRange[1]:this.x+=a*Math.abs(this.canvas.width/2-s.x)/this.canvas.width/2:this.x+=a,r<=this.yRange[0]||r>=this.yRange[1]?!1===this.hasBouncing?r<=this.yRange[0]?this.y=this.yRange[0]:this.y=this.yRange[1]:this.y+=n*Math.abs(this.canvas.height/2-s.y)/this.canvas.height/2:this.y+=n,this.draw())},touchPinchHandler:function(t){var e,i,a,n,s,o=t.touches[0],r=t.touches[1],l=this.winToCanvas(o.clientX,o.clientY),c=this.winToCanvas(r.clientX,r.clientY),d=Math.sqrt(Math.pow(c.x-l.x,2)+Math.pow(c.y-l.y,2));this.isPinch=!0,e=this.pinchRatio*d,a=this.getScaleOverflow(e),n=this.scaleMin/2,s=(Math.abs(a)>n?1:Math.abs(a)/n)/2,e-=this.hasBouncing?a?a*s:0:a,this.pinchCenter=i={x:(l.x+c.x)/2*this.pixelRatio,y:(l.y+c.y)/2*this.pixelRatio},this.x=i.x-e/this.scale*(i.x-this.x),this.y=i.y-e/this.scale*(i.y-this.y),e!==this.scale&&(this.scale=e,this.setMoveRange(),this.draw())},touchEndHandler:function(t){var e=t.changedTouches[0];this.touchStart&&Date.now()-this.touchStart.time<this.clickDelay&&Math.abs(e.clientX-this.touchStart.cx)<6&&Math.abs(e.clientY-this.touchStart.cy)<6&&this.clickHandler(t),this.straighten(t)},clickHandler:function(e){var i,a,n,s,o=this,r=e.changedTouches[0],l=this.winToCanvas(r.clientX,r.clientY),c={x:((l.x-this.x/this.pixelRatio)/this.scale*this.pixelRatio).toFixed(1),y:((l.y-this.y/this.pixelRatio)/this.scale*this.pixelRatio).toFixed(1)},d=this.getClickPoint(c),p=this.isInputShow?this.getInputPopupSize():null,u=this.isInputShow?this.getInputPopupPos():null,f=this.isInputShow?{x:l.x-u.x,y:l.y-u.y}:null,m=240,g=180,v=this.isKeyboardShow?this.getKeyboradPos():null,b=this.isKeyboardShow?{x:l.x-v.x,y:l.y-v.y}:null;p&&f.x>5&&f.x<p.w-5&&f.y>0&&f.y<p.h?s="input":f&&f.x>-52&&f.x<0&&f.y>(p.h-32-10)/2&&f.y<(p.h+32+10)/2?s="remove":f&&f.x>p.w&&f.x<p.w+20+32&&f.y>(p.h-32-10)/2&&f.y<(p.h+32+10)/2?s="save":b&&b.x>0&&b.x<m&&b.y>0&&b.y<g?s="keyborad":d?s="point":c.x>=0&&c.x<=this.img.width&&c.y>=0&&c.y<=this.img.height&&(s="img"),console.log("clickType ======",s),"edit"===this.mode?("input"===s&&(1===this.passrateMode?i=Math.floor((f.x-5)/80):2===this.passrateMode?i=(i=(Math.floor(f.x/69)+3*Math.floor(f.y/33))%2?"":(Math.floor(f.x/69)+3*Math.floor(f.y/33))/2)<0||i>4?"":i:3===this.passrateMode?i=Math.floor((f.x-5)/69):3===this.passrateMode||(5===this.passrateMode||6===this.passrateMode?f.x>50&&(i=Math.floor((f.x-50)/69)+3*Math.floor(f.y/44)):7===this.passrateMode?i=Math.floor((f.x-5)/69):8===this.passrateMode?(i=Math.floor((f.x-5)/75)?0:1,this.data[0].points[this.drawPointIndex].val=i,setTimeout((function(){o.inputBlur(o.lightInputIndex),o.pointBlur(),o.draw()}),200)):12!==this.passrateMode&&13!==this.passrateMode||(i=Math.floor((f.x-5)/69))),h(i)&&this.inputFocus(i)),"remove"===s&&(this.inputBlur(this.lightInputIndex,!0),this.delPoint(this.drawPointIndex),this.pointBlur()),"save"===s&&(this.inputBlur(this.lightInputIndex),this.pointBlur()),"keyborad"===s&&(a=Math.floor(b.x/60)+4*Math.floor(b.y/45),this.setPointVal(a),this.setKeyboradAction(a)),"point"===s&&(this.inputBlur(this.lightInputIndex),n=this.getTargetPoints(this.drawPointIndex),!t.some(n,(function(t){return h(t.val)||h(t.setVal)}))&&h(this.drawPointIndex)&&(this.delPoint(this.drawPointIndex),d=this.getClickPoint(c)),this.pointFocus(d.index)),"img"===s&&(this.inputBlur(this.lightInputIndex),n=this.getTargetPoints(this.drawPointIndex),!t.some(n,(function(t){return h(t.val)||h(t.setVal)}))&&h(this.drawPointIndex)&&this.delPoint(this.drawPointIndex),this.addPoint({x:c.x,y:c.y}),this.pointFocus(this.drawingPoints.length-1,!0))):("point"===s&&((d=this.getClickPoint(c)).pointId?this.$emit("onClickPoint",d):this.pointFocus(d.index)),"img"===s&&this.pointBlur());var x={type:d?"point":"",pos:l,x:c.x,y:c.y,point:d,btn:""};this.$emit("onClick",x),this.draw()},getDraggingDirection:function(t,e){var i=t.cx-e.pageX,a=t.cy-e.pageY;return Math.abs(i)>Math.abs(a)?i>0?"r":i<0?"l":"":a>0?"b":a<0?"t":""},isBoundary:function(t){switch(t){case"t":if(this.y>=this.yRange[1])return!0;break;case"r":if(this.x<=this.xRange[0])return!0;break;case"b":if(this.y<=this.yRange[0])return!0;break;case"l":if(this.x>=this.xRange[1])return!0}return!1},pointFocus:function(e,i){var a,n,s,o,r,l=this.hasOperaBtn?42:0;this.drawPointIndex=e,this.lightRippleTimes=0,r=this.getMarkPoints(this.drawPointIndex),t.each(r,(function(t){delete t.isWarning})),this.hasWarning=t.some(this.drawingPoints,{isWarning:!0}),s=this.getInputPopupPos(),o=this.getInputPopupSize(),s.x-l<0?a=(s.x-l)*this.pixelRatio:s.x+o.w+l>this.width&&(a=(s.x+o.w+l-this.width)*this.pixelRatio),s.y<0&&(n=s.y*this.pixelRatio),1===this.passrateMode?this.inputLength=this.data.length:2===this.passrateMode?this.inputLength=5:3===this.passrateMode?this.inputLength=2:4===this.passrateMode?this.inputLength=0:5===this.passrateMode||6===this.passrateMode?this.inputLength=6:7===this.passrateMode||12===this.passrateMode?this.inputLength=3:13===this.passrateMode&&(this.inputLength=2),this.isInputShow=!0,this.moveTo(this.x-(a||0),this.y-(n||0)),"edit"===this.mode&&i&&8!==this.passrateMode&&this.inputFocus(this.lightInputIndex||0),this.setMoveRange()},pointBlur:function(){this.drawPointIndex=null,this.isInputShow=!1,this.isKeyboardShow=!1,"edit"===this.mode&&this.$emit("onChange",this.data)},inputFocus:function(t){var e,i,a=this.getKeyboradPos(),n=240,s=180;a.x<0?e=a.x*this.pixelRatio:a.x+n>this.width&&(e=(a.x+n-this.width)*this.pixelRatio),a.y+s>this.height&&(i=(a.y+s-this.height)*this.pixelRatio),this.lightInputIndex=t,this.hasPrevInput=t>0,this.hasNextInput=t<this.inputLength-1,"edit"===this.mode&&8!==this.passrateMode&&(this.isKeyboardShow=!0,this.moveTo(this.x-(e||0),this.y-(i||0))),this.autoInputSetVal(),this.setMoveRange()},inputBlur:function(e,i){var a=this.getTargetPoint(this.drawPointIndex,e),n=h(this.inputRange[0])?this.inputRange[0]:-1/0,s=h(this.inputRange[1])?this.inputRange[1]:1/0;a&&a.points&&t.each(a.points,(function(t){if(a.isSetVal){if(t.setVal=isNaN(t.setVal)?"":h(t.setVal)?Math.floor(1e5*parseFloat(t.setVal))/1e5:"",""===t.setVal)return;t.setVal<n?t.setVal=n:t.setVal>s&&(t.setVal=s)}else{if(t.val=isNaN(t.val)?"":h(t.val)?Math.floor(1e5*parseFloat(t.val))/1e5:"",""===t.val)return;t.val<n?t.val=n:t.val>s&&(t.val=s)}})),this.lightInputIndex=null,this.isKeyboardShow=!1,!i&&this.$emit("onChange",this.data)},setPointVal:function(e){var i=this,a=this.lightInputIndex;if(h(this.drawPointIndex)&&h(this.lightInputIndex)){var n=this.getTargetPoint(this.drawPointIndex,this.lightInputIndex),s=d[e];n&&n.points&&(t.each(n.points,(function(t){isNaN(s)?"删除"===s?n.isSetVal?t.setVal=t.setVal.toString().substr(0,t.setVal.toString().length-1):t.val=t.val.toString().substr(0,t.val.toString().length-1):"-"===s?n.isSetVal?h(t.setVal)||(t.setVal="-"):h(t.val)||(t.val="-"):"."===s?n.isSetVal?h(t.setVal)&&parseFloat(t.setVal)===parseInt(t.setVal)&&(t.setVal=t.setVal+s):h(t.val)&&parseFloat(t.val)===parseInt(t.val)&&(t.val=t.val+s):"上一项"===s?i.hasPrevInput&&(i.inputBlur(i.lightInputIndex),i.inputFocus(a-1)):"下一项"===s?i.hasNextInput&&(i.inputBlur(i.lightInputIndex),i.inputFocus(a+1)):"关闭"===s&&(i.inputBlur(i.lightInputIndex),i.isKeyboardShow=!1,i.lightInputIndex=null):n.isSetVal?t.setVal=(h(t.setVal)?t.setVal:"")+s:t.val=t.val+s})),n.isSetVal&&n.points&&n.points.length&&this.saveInputSetVal())}},setKeyboradAction:function(t){var e=this;this.keyboradActionData[t]&&clearTimeout(this.keyboradActionData[t]),this.keyboradActionData[t]=setTimeout((function(){delete e.keyboradActionData[t],e.draw()}),300),this.draw()},saveInputSetVal:function(){var e=this.getTargetPoints(this.drawPointIndex),i=this.data[0].checkitem.id;t.includes([3,4],this.passrateMode)?c[i]={val:e[0].setVal}:t.includes([5,6],this.passrateMode)&&(c[i]={},t.each(this.measureItem,(function(a){var n=t.find(e,{label:a}).setVal;c[i]["val-"+a]=n})))},autoInputSetVal:function(){var e=this.data[0].checkitem.id,i=this.getTargetPoints(this.drawPointIndex),a=c[e],n=t.includes([3,4,5,6],this.passrateMode),s=t.some(i,(function(t){return!h(t.setVal)}));n&&s&&a&&!t.isEmpty(a)&&(t.includes([3,4],this.passrateMode)?h(a.val)&&t.each(i,(function(t){t.setVal=a.val})):t.each(i,(function(t){var e=a["val-"+t.label];h(e)&&(t.setVal=e)})))},getMarkPoints:function(e){var i,a=[];return h(e)?(i=this.drawingPoints[e].area,1===this.passrateMode?t.each(this.data,(function(t){a.push(t.points[e])})):2===this.passrateMode?a=t.filter(this.data[0].points,(function(t){return t.area===i})):3===this.passrateMode?a=this.data[0].points[e]:4===this.passrateMode||(5===this.passrateMode||6===this.passrateMode||7===this.passrateMode?a=t.filter(this.data[0].points,(function(t){return t.area===i})):8===this.passrateMode?a=this.data[0].points[e]:12!==this.passrateMode&&13!==this.passrateMode||(a=t.filter(this.data[0].points,(function(t){return t.area===i})))),a&&!t.isArray(a)&&(a=[a]),a):null},getTargetPoint:function(e,i){var a,n,s,o,r=!1;return h(e)&&h(i)?(1===this.passrateMode?n=this.data[i].points[e]:2===this.passrateMode?(s=this.drawingPoints[e].area,n=(a=t.filter(this.data[0].points,(function(t){return t.area===s})))[i]):3===this.passrateMode?(n=this.data[0].points[e],r=1===i):4===this.passrateMode||(5===this.passrateMode||6===this.passrateMode?(5===this.passrateMode?o=["高","宽"]:6===this.passrateMode&&(o=["开间","进深"]),s=this.drawingPoints[e].area,a=t.filter(this.data[0].points,(function(t){return t.area===s})),n=t.filter(a,(function(t,e){return t.label===(0===Math.floor(i/3)?o[0]:o[1])&&(2===i||5===i||i%3%2==e%2)})),2!==i&&5!==i||(r=!0)):7===this.passrateMode?(s=this.drawingPoints[e].area,n=(a=t.filter(this.data[0].points,(function(t){return t.area===s})))[i]):8===this.passrateMode?n=this.data[0].points[e]:12!==this.passrateMode&&13!==this.passrateMode||(s=this.drawingPoints[e].area,n=(a=t.filter(this.data[0].points,(function(t){return t.area===s})))[i])),n&&!t.isArray(n)&&(n=[n]),{points:n,isSetVal:r}):null},getTargetPoints:function(e){var i,a=[];return e=h(e)?e:this.drawPointIndex,h(e)?(1===this.passrateMode?t.each(this.data,(function(i){t.each(i.points,(function(t,i){e===i&&a.push(t)}))})):2===this.passrateMode?(i=this.drawingPoints[e].area,a=t.filter(this.data[0].points,(function(t){return t.area===i}))):3===this.passrateMode?a=t.filter(this.data[0].points,(function(t,i){return e===i})):4===this.passrateMode||(5===this.passrateMode||6===this.passrateMode||7===this.passrateMode?(i=this.drawingPoints[e].area,a=t.filter(this.data[0].points,(function(t){return t.area===i}))):8===this.passrateMode?a=t.filter(this.data[0].points,(function(t,i){return e===i})):12!==this.passrateMode&&13!==this.passrateMode||(i=this.drawingPoints[e].area,a=t.filter(this.data[0].points,(function(t){return t.area===i})))),a):a},moveTo:function(t,e){var i=this;null===this.moveDest.x&&null===this.moveDest.y?this.moveDest={x:t,y:e}:(this.moveDest.x===t&&this.moveDest.y===e||(this.moveDest.x<t?this.moveDest.x=t<=this.x?this.moveDest.x:t:this.moveDest.x=t>=this.x?this.moveDest.x:t,this.moveDest.y<e?this.moveDest.y=e<=this.y?this.moveDest.y:e:this.moveDest.y=e>=this.y?this.moveDest.y:e),t=this.moveDest.x,e=this.moveDest.y),t===this.x&&e===this.y||(this.isMoving=!0,clearTimeout(this.moveTimer),this.moveTimer=setTimeout((function(){var a=!1;Math.abs(t-i.x)<1?i.x=t:(i.x+=.5*(t-i.x),a=!0),Math.abs(e-i.y)<1?i.y=e:(i.y+=.5*(e-i.y),a=!0),a?(i.moveTo(t,e),i.draw()):(i.isMoving=!1,i.moveDest={x:null,y:null})}),20))},getClickPoint:function(t){var e,i=this,a=this.pointRadius*this.pointRatio+1;return this.drawingPoints.forEach((function(n){var s=Math.sqrt(Math.pow(Math.abs(t.x-n.x),2)+Math.pow(Math.abs(t.y-n.y),2)),o=s*i.scale/i.pixelRatio;o<=i.pointRadius*i.pointRatio&&o<a&&(e=n,a=s)})),e},setMoveRange:function(){var t=this.getMoveRange(this.scale);this.xRange=t.x,this.yRange=t.y},getMoveRange:function(t){var e,i,a,n,s,o,r,l,c,d,h=this.getInputPopupPos(),p=this.getInputPopupSize(),u=this.getKeyboradPos(),f=240,m=180,g=this.hasOperaBtn?42:0;return t=t||this.scale,i=(e=this.width*this.pixelRatio-this.img.width*t)>0?e/=2:0,n=(a=this.height*this.pixelRatio-this.img.height*t)>0?a/=2:0,this.isInputShow&&(n+=s=(s=this.y-h.y*this.pixelRatio)>0&&s>n?s-n:0),(this.isInputShow||this.isKeyboardShow)&&(c=this.isInputShow?(h.x+p.w+g)*this.pixelRatio:0,d=this.isKeyboardShow?(u.x+f)*this.pixelRatio:0,e+=o=(o=this.x+this.img.width*this.scale-Math.max(c,d))<0&&o<-i?o+i:0),this.isKeyboardShow&&(a+=r=(r=this.y+this.img.height*this.scale-(u.y+m)*this.pixelRatio)<0&&r<-n?r+n:0),(this.isInputShow||this.isKeyboardShow)&&(c=this.isInputShow?(h.x-g)*this.pixelRatio:1/0,d=this.isKeyboardShow?u.x*this.pixelRatio:1/0,i+=l=(l=this.x-Math.min(c,d))>0&&l>i?l-i:0),{x:[e,i],y:[a,n]}},straighten:function(t,e){var i=this;if(!(t&&"touchend"===t.type&&0!==t.touches.length||this.isMoving)){var a=e||(this.scale<this.scaleMin?this.scaleMin:this.scale>this.scaleMax?this.scaleMax:this.scale),n=this.getMoveRange(a),s=n.x,o=n.y;(this.x<s[0]||this.x>s[1]||this.y<o[0]||this.y>o[1]||this.scale<this.scaleMin||this.scale>this.scaleMax)&&setTimeout((function(){var t=i.pinchCenter.x?i.pinchCenter.x-a*(i.pinchCenter.x-i.x)/i.scale:i.x,n=i.pinchCenter.y?i.pinchCenter.y-a*(i.pinchCenter.y-i.y)/i.scale:i.y,r=!1;t=t<s[0]?s[0]:t>s[1]?s[1]:t,n=n<o[0]?o[0]:n>o[1]?o[1]:n,Math.abs(t-i.x)<1?i.x=t:(i.x+=.5*(t-i.x),r=!0),Math.abs(n-i.y)<1?i.y=n:(i.y+=.5*(n-i.y),r=!0),Math.abs(a-i.scale)*i.img.width*i.img.height<5?i.scale=a:(i.scale+=.5*(a-i.scale),r=!0),r&&(i.straighten("",e),i.draw())}),20)}},getMoveOverflow:function(){return{x:this.x<this.xRange[0]?this.x-this.xRange[0]:this.x>this.xRange[1]?this.x-this.xRange[1]:0,y:this.y<this.yRange[0]?this.y-this.yRange[0]:this.y>this.yRange[1]?this.y-this.yRange[1]:0}},getScaleOverflow:function(t){return(t=t||this.scale)<this.scaleMin?t-this.scaleMin:t>this.scaleMax?t-this.scaleMax:0},calc:function(){var t,e;this.width/this.img.width<this.height/this.img.height?(t=this.width/this.img.width,this.x=0,this.y=(this.height-this.img.height*t)/2*this.pixelRatio):(t=this.height/this.img.height,this.x=(this.width-this.img.width*t)/2*this.pixelRatio,this.y=0),this.scale=t*this.pixelRatio,e=this.scale<.25?2:8*this.scale,this.scaleMin=this.scale,this.scaleMax=e,this.xRange=[this.x,this.x],this.yRange=[this.y,this.y]},draw:function(){var t=this;this.ctx&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawImage(),this.drawPoints(),this.drawInputPopup(),this.drawKeyborad(),null!==this.drawPointIndex&&this.lightRippleTimes<this.lightRippleTimesMax&&(clearTimeout(this.lightRippleTimer),this.lightRippleTimer=setTimeout((function(){t.lightRipple=t.lightRipple+.07,t.lightRipple>=1&&(t.lightRipple=0,t.lightRippleTimes=t.lightRippleTimes+1),t.lightRippleTimes>=t.lightRippleTimesMax?t.lightRipple=0:t.lightRipple=parseFloat(t.lightRipple.toFixed(2)),t.draw()}),40)),this.hasWarning&&(clearTimeout(this.warningRippleTimer),this.warningRippleTimer=setTimeout((function(){t.warningRipple=t.warningRipple+.07,t.warningRipple>=1&&(t.warningRipple=0),t.warningRipple=parseFloat(t.warningRipple.toFixed(2)),t.draw()}),40)))},drawImage:function(){this.ctx.drawImage(this.img,0,0,this.img.width,this.img.height,this.x,this.y,this.img.width*this.scale,this.img.height*this.scale)},drawPoints:function(t){var e=this;this.drawingPoints.forEach((function(i,a){e.drawPoint(i.x*e.scale/e.pixelRatio+e.x/e.pixelRatio,i.y*e.scale/e.pixelRatio+e.y/e.pixelRatio,e.pointRadius,a,t,e.drawPointIndex===a?"#4275e8":i.color||(i.isQualified?"#0bc666":"#ff3c46"),i),i.index=a}))},drawPoint:function(t,e,i,a,n,s,o){this.ctx.save(),null!==this.drawPointIndex&&this.drawPointIndex===a&&(this.ctx.beginPath(),this.ctx.fillStyle="rgba(66, 117, 232, "+(.6*(1-this.lightRipple)+.1)+")",this.ctx.arc(t,e,i*(1+this.lightRipple),0,2*Math.PI,!1),this.ctx.fill()),o.isWarning&&this.drawPointIndex!==a&&(this.ctx.beginPath(),this.ctx.fillStyle="rgba(252, 139, 1, "+(.6*(1-this.warningRipple)+.1)+")",this.ctx.arc(t,e,i*(1+this.warningRipple),0,2*Math.PI,!1),this.ctx.fill()),this.ctx.beginPath(),o.isWarning&&this.drawPointIndex!==a?this.ctx.fillStyle="#ff7439":s&&(this.ctx.fillStyle=s),this.ctx.arc(t,e,i,0,2*Math.PI,!1),this.ctx.globalAlpha=.6,this.ctx.fill(),this.ctx.globalAlpha=1,s&&(this.ctx.strokeStyle=s),this.ctx.lineWidth=1,this.ctx.stroke()},getLightPoint:function(){return(null===this.drawPointIndex?null:this.drawingPoints[this.drawPointIndex])||null},drawInputPopup:function(){var t=this.getLightPoint(),e=this.getInputPopupSize(),i=e.w,a=e.h,n=this.getInputPopupPos(),s=n.x,o=n.y;t&&this.isInputShow&&(this.ctx.fillStyle="rgba(0,0,0,0.8)",this.ctx.beginPath(),this.ctx.arc(s+5,o+5,5,Math.PI,1.5*Math.PI),this.ctx.lineTo(i+s-5,o),this.ctx.arc(s+i-5,o+5,5,1.5*Math.PI,0),this.ctx.lineTo(s+i,o+a-5),this.ctx.arc(s+i-5,o+a-5,5,0,.5*Math.PI),this.ctx.lineTo(s+i/2+5,o+a),this.ctx.lineTo(s+i/2,o+a+5),this.ctx.lineTo(s+i/2-5,o+a),this.ctx.lineTo(s+5,o+a),this.ctx.arc(s+5,o+a-5,5,.5*Math.PI,Math.PI),this.ctx.lineTo(s,o+5),this.ctx.closePath(),this.ctx.fill(),"edit"===this.mode&&(this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.arc(s-26,o+a/2,16,0,2*Math.PI),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.strokeStyle="#ff3d3d",this.ctx.lineWidth=2,this.ctx.moveTo(s-34,o+a/2),this.ctx.lineTo(s-18,o+a/2),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(s+i+26,o+a/2,16,0,2*Math.PI),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.strokeStyle="#0bc666",this.ctx.lineWidth=2,this.ctx.moveTo(s+i+18,o+a/2-1),this.ctx.lineTo(s+i+24,o+a/2+5),this.ctx.lineTo(s+i+35,o+a/2-6),this.ctx.stroke(),this.ctx.lineCap="butt",this.ctx.lineJoin="miter"),this.drawInputs(s,o))},drawInputs:function(e,i){var a,n,s,o,r,l=this,c="edit"===this.mode?"#ffffff":"#b5b5b5",d=[];e=e+5+.5,i=i+5+.5,this.ctx.lineWidth=1,this.ctx.textAlign="center",this.ctx.font='16px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',1===this.passrateMode?t.each(this.data,(function(t,a){l.drawInput({x:e+79*a,y:i,borderColor:l.lightInputIndex===a?c:"#b5b5b5",label:l.data.length>1?t.checkitem.name:"实测值",val:h(t.points[l.drawPointIndex].val)?t.points[l.drawPointIndex].val:"edit"===l.mode?"":"未填",valColor:h(t.points[l.drawPointIndex].val)?t.points[l.drawPointIndex].isExceed?"#ff4545":"#ffffff":"#b5b5b5"}),a&&(l.ctx.beginPath(),l.ctx.strokeStyle="#b5b5b5",l.ctx.moveTo(e+79*a-9.5,i+16.5),l.ctx.lineTo(e+79*a-.5,i+16.5),l.ctx.stroke())})):2===this.passrateMode?(a=this.drawingPoints[this.drawPointIndex],d=t.filter(this.data[0].points,(function(t){return t.area===a.area})),t.each(d,(function(t,a){var n=Math.floor(2*a/3),s=2*a%3;l.drawInput({x:e+69*s,y:i+33*n,borderColor:l.lightInputIndex===a?c:"#b5b5b5",label:"实测值",val:t.val,valColor:t.isExceed?"#ff4545":"#ffffff",borderRadius:"n"})}))):3===this.passrateMode?(this.drawInput({x:e,y:i,borderColor:0===this.lightInputIndex?c:"#b5b5b5",label:"实测值",val:this.data[0].points[this.drawPointIndex].val,valColor:this.data[0].points[this.drawPointIndex].isExceed?"#ff4545":"#ffffff",borderRadius:"l"}),this.drawInput({x:e+69,y:i,borderColor:1===this.lightInputIndex?c:"#b5b5b5",label:"设计值",val:this.data[0].points[this.drawPointIndex].setVal,valColor:"#ffffff",borderRadius:"r"}),null!==this.lightInputIndex&&(this.ctx.beginPath(),this.ctx.strokeStyle="#ffffff",this.ctx.moveTo(e+69,i-.5),this.ctx.lineTo(e+69,i+33+.5),this.ctx.stroke())):4===this.passrateMode||(5===this.passrateMode||6===this.passrateMode?(e+=45,a=this.drawingPoints[this.drawPointIndex],d=t.filter(this.data[0].points,(function(t){return t.area===a.area})),s=t.groupBy(d,"label"),t.each(s,(function(a,n){var s=n,o="高"===n||"开间"===n?0:1;"高"===n&&(s="高度"),"宽"===n&&(s="宽度"),l.ctx.fillStyle="#ffffff",l.ctx.font='16px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',l.ctx.fillText(s,e-25,i+44*o+16.5+6),t.each(a,(function(t,a){l.drawInput({x:e+69*a,y:i+44*o,borderColor:l.lightInputIndex===3*o+a?c:"#b5b5b5",label:"实测值",val:t.val,valColor:t.isExceed?"#ff4545":"#ffffff",borderRadius:0===a?"l":"n"})})),l.drawInput({x:e+138,y:i+44*o,borderColor:l.lightInputIndex===3*o+2?c:"#b5b5b5",label:"设计值",val:a[0].setVal,valColor:"#ffffff",borderRadius:"r"})})),null!==this.lightInputIndex&&(o=Math.floor(this.lightInputIndex/3),2!==(r=this.lightInputIndex%3)&&(this.ctx.beginPath(),this.ctx.strokeStyle="#ffffff",this.ctx.moveTo(e+69*(r+1),i+44*o-.5),this.ctx.lineTo(e+69*(r+1),i+44*o+33+.5),this.ctx.stroke()))):7===this.passrateMode||12===this.passrateMode||13===this.passrateMode?(a=this.drawingPoints[this.drawPointIndex],d=t.filter(this.data[0].points,(function(t){return t.area===a.area})),t.each(d,(function(t,a){l.drawInput({x:e+69*a,y:i,borderColor:l.lightInputIndex===a?c:"#b5b5b5",label:"实测值",val:t.val,valColor:t.isExceed?"#ff4545":"#ffffff",borderRadius:0===a?"l":2===a?"r":"n"})})),0!==this.lightInputIndex&&1!==this.lightInputIndex||(this.ctx.beginPath(),this.ctx.strokeStyle="#ffffff",this.ctx.moveTo(e+69*(this.lightInputIndex+1),i-.5),this.ctx.lineTo(e+69*(this.lightInputIndex+1),i+33+.5),this.ctx.stroke())):8===this.passrateMode&&(n=this.data[0].points[this.drawPointIndex],"edit"===this.mode?(this.drawInput({x:e,y:i,borderColor:1===n.val?"#4275e8":"#ffffff",bgColor:1===n.val?"#4275e8":"",val:"合格",valColor:"#ffffff"}),this.drawInput({x:e+69+10,y:i,borderColor:0===n.val?"#4275e8":"#ffffff",bgColor:0===n.val?"#4275e8":"",val:"不合格",valColor:"#ffffff"})):this.drawInput({x:e,y:i,borderColor:"#ffffff",bgColor:"",val:1===n.val?"合格":"不合格",valColor:"#ffffff"})))},drawInput:function(t){var e=t.x,i=t.y,a=t.w||69,n=t.h||33,s=t.borderColor,o=t.bgColor,r=t.label?t.label.substr(0,4):"",l=t.labelColor,c=h(t.val)?t.val.toString().substr(-(t.val.toString().indexOf(".")<0?7:8)):"",d=t.valColor,p=t.borderRadius||"a";this.ctx.strokeStyle=s,this.ctx.beginPath(),"a"===p||"l"===p?this.ctx.arc(e+2,i+2,2,Math.PI,1.5*Math.PI):this.ctx.moveTo(e,i),h(r)&&h(c)&&(this.ctx.lineTo(e+(a-8*r.length)/2-2,i),this.ctx.moveTo(e+(a+8*r.length)/2+2,i)),"a"===p||"r"===p?(this.ctx.lineTo(e+a-2,i),this.ctx.arc(e+a-2,i+2,2,1.5*Math.PI,0),this.ctx.lineTo(e+a,i+n-2),this.ctx.arc(e+a-2,i+n-2,2,0,.5*Math.PI)):(this.ctx.lineTo(e+a,i),this.ctx.lineTo(e+a,i+n)),"a"===p||"l"===p?(this.ctx.lineTo(e+2,i+n),this.ctx.arc(e+2,i+n-2,2,.5*Math.PI,Math.PI),this.ctx.lineTo(e,i+2)):(this.ctx.lineTo(e,i+n),this.ctx.lineTo(e,i-.5)),this.ctx.stroke(),h(o)&&(this.ctx.fillStyle=o,this.ctx.fill()),h(r)&&(this.ctx.textAlign="center",h(c)?(this.ctx.fillStyle=l||s,this.ctx.font='8px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',this.ctx.fillText(r,e+a/2,i+3)):(this.ctx.fillStyle=l||"#808080",this.ctx.font='16px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',this.ctx.fillText(r,e+a/2,i+n/2+6))),h(c)&&(this.ctx.textAlign="center",this.ctx.fillStyle=d,this.ctx.font='16px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',this.ctx.fillText(c,e+a/2,i+n/2+6))},drawKeyborad:function(){var t,e=this,i=this.getLightPoint(),a=240,n=180,s=this.getKeyboradPos(),o=s.x,r=s.y;if(i&&this.isKeyboardShow&&null!==this.lightInputIndex){for(t in this.ctx.shadowBlur=5,this.ctx.shadowColor="#999",this.ctx.fillStyle="#ffffff",this.ctx.beginPath(),this.ctx.arc(o+6,r+6,6,Math.PI,1.5*Math.PI),this.ctx.lineTo(a+o-6,r),this.ctx.arc(o+a-6,r+6,6,1.5*Math.PI,0),this.ctx.lineTo(o+a,r+n-6),this.ctx.arc(o+a-6,r+n-6,6,0,.5*Math.PI),this.ctx.lineTo(o+6,r+n),this.ctx.arc(o+6,r+n-6,6,.5*Math.PI,Math.PI),this.ctx.lineTo(o,r+6),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.shadowColor="transparent",this.keyboradActionData)t=parseInt(t),this.ctx.fillStyle="#f2f2f2",this.ctx.beginPath(),0===t?this.ctx.arc(o+t%4*60+6,r+45*Math.floor(t/4)+6,6,Math.PI,1.5*Math.PI):this.ctx.moveTo(o+t%4*60,r+45*Math.floor(t/4)),3===t?(this.ctx.lineTo(o+60*(t%4+1)-6,r+45*Math.floor(t/4)),this.ctx.arc(o+60*(t%4+1)-6,r+45*Math.floor(t/4)+6,6,1.5*Math.PI,0)):this.ctx.lineTo(o+60*(t%4+1),r+45*Math.floor(t/4)),15===t?(this.ctx.lineTo(o+60*(t%4+1),r+(Math.floor(t/4)+1)-6),this.ctx.arc(o+60*(t%4+1)-6,r+45*(Math.floor(t/4)+1)-6,6,0,.5*Math.PI)):this.ctx.lineTo(o+60*(t%4+1),r+45*(Math.floor(t/4)+1)),12===t?(this.ctx.lineTo(o+t%4*60+6,r+45*(Math.floor(t/4)+1)),this.ctx.arc(o+t%4*60+6,r+45*(Math.floor(t/4)+1)-6,6,.5*Math.PI,Math.PI)):this.ctx.lineTo(o+t%4*60,r+45*(Math.floor(t/4)+1)),this.ctx.closePath(),this.ctx.fill();this.ctx.strokeStyle="#d9d9d9",this.ctx.lineWidth=.5,this.ctx.beginPath(),this.ctx.moveTo(o,r+45.25),this.ctx.lineTo(o+a,r+45.25),this.ctx.moveTo(o,r+90.25),this.ctx.lineTo(o+a,r+90.25),this.ctx.moveTo(o,r+135.25),this.ctx.lineTo(o+a,r+135.25),this.ctx.moveTo(o+60.25,r),this.ctx.lineTo(o+60.25,r+n),this.ctx.moveTo(o+120.25,r),this.ctx.lineTo(o+120.25,r+n),this.ctx.moveTo(o+180.25,r),this.ctx.lineTo(o+180.25,r+n),this.ctx.closePath(),this.ctx.stroke(),this.ctx.textAlign="center",d.forEach((function(t,i){var a=Math.floor(i/4),n=i%4;3===i?(e.ctx.fillStyle="#999999",e.ctx.beginPath(),e.ctx.moveTo(o+60*n+18,r+45*a+22.5),e.ctx.lineTo(o+60*n+25,r+45*a+14.5),e.ctx.lineTo(o+60*n+40,r+45*a+14.5),e.ctx.arc(o+60*n+40,r+45*a+16.5,2,1.5*Math.PI,0),e.ctx.lineTo(o+60*n+42,r+45*a+28.5),e.ctx.arc(o+60*n+40,r+45*a+28.5,2,0,.5*Math.PI),e.ctx.lineTo(o+60*n+25,r+45*a+30.5),e.ctx.closePath(),e.ctx.fill(),e.ctx.beginPath(),e.ctx.strokeStyle="#ffffff",e.ctx.lineWidth=2,e.ctx.moveTo(o+60*n+28,r+45*a+18),e.ctx.lineTo(o+60*n+37,r+45*a+27),e.ctx.moveTo(o+60*n+37,r+45*a+18),e.ctx.lineTo(o+60*n+28,r+45*a+27),e.ctx.stroke()):(e.ctx.fillStyle="#111111",e.ctx.font=3===i||12===i||14===i||15===i?'14px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif':'18px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',15===i&&(e.ctx.fillStyle="#4275e8"),(12===i&&!e.hasPrevInput||14===i&&!e.hasNextInput)&&(e.ctx.fillStyle="#b2b2b2"),e.ctx.fillText(t,o+60*n+30,r+45*a+29))}))}},getInputPopupSize:function(){var t,e;return 1===this.passrateMode?(t=80*this.comboLength,e=44):2===this.passrateMode?(t=218,e=110):3===this.passrateMode?(t=149,e=44):4===this.passrateMode||(5===this.passrateMode||6===this.passrateMode?(t=263,e=88):7===this.passrateMode?(t=218,e=44):8===this.passrateMode?"edit"===this.mode?(t=160,e=44):(t=80,e=44):12===this.passrateMode?(t=218,e=44):13===this.passrateMode&&(t=149,e=44)),{w:t,h:e}},getInputPopupPos:function(){var t=this.getLightPoint(),e=this.getInputPopupSize();return t?{x:t.x*this.scale/this.pixelRatio+this.x/this.pixelRatio-e.w/2,y:t.y*this.scale/this.pixelRatio+this.y/this.pixelRatio-e.h-this.pointRadius-10}:{x:null,y:null}},getKeyboradPos:function(){var t=this.getLightPoint();return t?{x:Math.round(t.x*this.scale/this.pixelRatio+this.x/this.pixelRatio-120),y:Math.round(t.y*this.scale/this.pixelRatio+this.y/this.pixelRatio+this.pointRadius+10)}:{x:null,y:null}},getAreaData:function(e){var i=[];return t.each(e,(function(a){if(!t.some(i,(function(t){return t.name===a.area}))){var n=t.filter(e,{area:a.area}).length;i.push({name:a.area,setVal:h(a.setVal)?a.setVal:"",pointNum:n})}})),i},getDrawPoints:function(e){if(t.isEmpty(e))return[];var i=[],a=[],n=t.clone(e);if(1===this.passrateMode?(i=n[0].points,t.each(n,(function(e){t.each(e.points,(function(t,e){i[e]&&(i[e].isQualified=!0)}))})),t.each(n,(function(e){t.each(e.points,(function(t,e){t.isExceed&&i[e]&&(i[e].isQualified=!1),t.isWarning&&i[e]&&(i[e].isWarning=!0)}))}))):2===this.passrateMode?(a=this.getAreaDataFromPoints(n[0].points),i=t.map(a,(function(e){var i=t.filter(n[0].points,{area:e.name}),a=t.some(i,(function(t){return t.isExceed})),s=t.some(i,(function(t){return t.isWarning}));return{x:i[0].x,y:i[0].y,area:e.name,isQualified:!a,isWarning:s,pointId:i[0].pointId}}))):3===this.passrateMode?i=n[0].points:4===this.passrateMode||(5===this.passrateMode||6===this.passrateMode?(a=this.getAreaDataFromPoints(n[0].points),i=t.map(a,(function(e){var i=t.filter(n[0].points,{area:e.name}),a=t.some(i,(function(t){return t.isExceed})),s=t.some(i,(function(t){return t.isWarning}));return{x:i[0].x,y:i[0].y,area:e.name,isQualified:!a,isWarning:s,pointId:i[0].pointId}}))):7===this.passrateMode?(a=this.getAreaDataFromPoints(n[0].points),i=t.map(a,(function(e){var i=t.filter(n[0].points,{area:e.name}),a=t.some(i,(function(t){return t.isExceed})),s=t.some(i,(function(t){return t.isWarning}));return{x:i[0].x,y:i[0].y,area:e.name,isQualified:!a,isWarning:s,pointId:i[0].pointId}}))):8===this.passrateMode?i=n[0].points:12===this.passrateMode||13===this.passrateMode?(a=this.getAreaDataFromPoints(n[0].points),i=t.map(a,(function(e){var i=t.filter(n[0].points,{area:e.name}),a=t.some(i,(function(t){return t.isExceed})),s=t.some(i,(function(t){return t.isWarning}));return{x:i[0].x,y:i[0].y,area:e.name,isQualified:!a,isWarning:s,pointId:i[0].pointId}}))):console.error("算法错误 --\x3e",this.passrateMode)),t.each(i,(function(t,e){t.isQualified?t.color="#0bc666":t.color="#ff4545",t.index=e})),!t.isEmpty(this.pointStatus)){var s={};t.each(this.pointStatus,(function(t){s[t.id]=t.status})),t.each(i,(function(t){var e=t.pointId?s[t.pointId]:"";e&&(t.color={"待整改":"#FF3C46","待复验":"#FF8E24","已通过":"#0BC666","非正常关闭":"#666666"}[e])}))}return i},addPoint:function(e){var i,a=this;1===this.passrateMode?(i={val:"",x:e.x,y:e.y,area:"测区1"},t.each(this.data,(function(e){e.points.push(t.clone(i))}))):2===this.passrateMode?t.each(this.data,(function(i){var n=a.getAreaData(i.points),s=t.map(n,(function(t){return/^测区\d+$/.test(t.name)?parseInt(t.name.substr(2)):0})),o=t.maxBy(s);o=o===-1/0?0:o;for(var r={val:"",x:e.x,y:e.y,area:"测区"+(o+1)},l=0;l<5;l++)i.points.push(t.clone(r))})):3===this.passrateMode?(i={val:"",x:e.x,y:e.y,area:"测区1",setVal:""},t.each(this.data,(function(t){t.points.push(i)}))):4===this.passrateMode||(5===this.passrateMode?t.each(this.data,(function(i){var n=a.getAreaData(i.points),s=t.map(n,(function(t){return/^测区\d+$/.test(t.name)?parseInt(t.name.substr(2)):0})),o=t.maxBy(s);o=o===-1/0?0:o;for(var r={val:"",x:e.x,y:e.y,area:"测区"+(o+1)},l=0;l<2;l++)r.label="高",i.points.push(t.clone(r));for(var c=0;c<2;c++)r.label="宽",i.points.push(t.clone(r))})):6===this.passrateMode?t.each(this.data,(function(i){var n=a.getAreaData(i.points),s=t.map(n,(function(t){return/^测区\d+$/.test(t.name)?parseInt(t.name.substr(2)):0})),o=t.maxBy(s);o=o===-1/0?0:o;for(var r={val:"",x:e.x,y:e.y,area:"测区"+(o+1)},l=0;l<2;l++)r.label="开间",i.points.push(t.clone(r));for(var c=0;c<2;c++)r.label="进深",i.points.push(t.clone(r))})):7===this.passrateMode?t.each(item.data,(function(i){var n=a.getAreaData(i.points),s=t.map(n,(function(t){return/^测区\d+$/.test(t.name)?parseInt(t.name.substr(2)):0})),o=t.maxBy(s);o=o===-1/0?0:o;for(var r={val:"",x:e.x,y:e.y,area:"测区"+(o+1)},l=0;l<3;l++)i.points.push(t.clone(r))})):8===this.passrateMode?(i={val:"",x:e.x,y:e.y,area:"测区1"},t.each(this.data,(function(e){e.points.push(t.clone(i))}))):12===this.passrateMode?t.each(this.data,(function(i){var n=a.getAreaData(i.points),s=t.map(n,(function(t){return/^测区\d+$/.test(t.name)?parseInt(t.name.substr(2)):0})),o=t.maxBy(s);o=o===-1/0?0:o;for(var r={val:"",x:e.x,y:e.y,area:"测区"+(o+1)},l=0;l<3;l++)i.points.push(t.clone(r))})):13===this.passrateMode?t.each(this.data,(function(i){var n=a.getAreaData(i.points),s=t.map(n,(function(t){return/^测区\d+$/.test(t.name)?parseInt(t.name.substr(2)):0})),o=t.maxBy(s);o=o===-1/0?0:o;for(var r={val:"",x:e.x,y:e.y,area:"测区"+(o+1)},l=0;l<2;l++)i.points.push(t.clone(r))})):console.error("算法不存在 --\x3e",this.passrateMode))},delPoint:function(e){1===this.passrateMode?t.each(this.data,(function(t){t.points.splice(e,1)})):2===this.passrateMode?t.each(this.data,(function(t){t.points.splice(5*e,5)})):3===this.passrateMode?t.each(this.data,(function(t){t.points.splice(e,1)})):4===this.passrateMode||(5===this.passrateMode?t.each(this.data,(function(i){var a={count:0},n=i.points,s={x:"",y:""};t.find(n,(function(t){var i=t.x+"-"+t.y;if(void 0===a[i]&&(a[i]=0,a.count++,a.count>e))return s.x=t.x,s.y=t.y,!0;a[i]++}));for(var o=n.length-1;o>-1;o--)n[o].x===s.x&&n[o].y===s.y&&n.splice(o,1)})):6===this.passrateMode?t.each(this.data,(function(t){t.points.splice(4*e,4)})):7===this.passrateMode?t.each(this.data,(function(t){t.points.splice(3*e,3)})):8===this.passrateMode?t.each(this.data,(function(t){t.points.splice(e,1)})):12===this.passrateMode?t.each(this.data,(function(t){t.points.splice(3*e,3)})):13===this.passrateMode?t.each(this.data,(function(t){t.points.splice(2*e,2)})):console.error("算法不存在"))}}}}).call(this,i("391c"))},4381:function(t,e,i){"use strict";i("1c2a")},"4bf2":function(t,e,i){"use strict";i("5945")},"4ce9":function(t,e,i){"use strict";var a=i("3f7a").a,n=(i("94f0"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",t._g({ref:"content",staticClass:"drawing-con",style:t.sizeStyle},t.$listeners),[t.isDownloading?[i("p",[i("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[i("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]),i("p",{staticClass:"loading-text"},[t._v("正在下载...")])]:[t.error?i("p",{staticClass:"error-text"},[t._v(t._s(t.error))]):i("canvas",{ref:"drawing-canvas",style:t.sizeStyle})]],2)}),[],!1,null,"196e7a7d",null);e.a=s.exports},"4e83":function(t,e,i){"use strict";(function(t){i("e697");var a=i("4c09"),n=i("774b"),s=i("07d2"),o=i("a805"),r=i("e68e"),l=i("6948"),c=i("cd05"),d=i("3c64"),h=i("5a71"),p=i("da1c"),u=i("e2a7"),f=i("a37e"),m=i("7798"),g=i("0159"),v=i("6bf2"),b=i.n(v),x=i("bcc7"),y=i("a500"),w=i("a18c"),k=i("f7e2");e.a={name:"MeasureDetailTemplate1",components:{Scroller:n.a,Item:s.a,MeasureDetailPlaceCheckitem:o.a,ItemImgList:r.a,NumberInput:l.a,UserSelect:c.a,ItemTextarea:d.a,ProblemDetailHeader:p.a,SingleSelect:h.a},mixins:[k.a],props:{detail:{type:Object,default:function(){}}},data:function(){return{model:f.a}},computed:{masterCheckitem:function(){return this.$store.state.measure.detailMasterCheckitem},hasMasterCheckitem:function(){return this.masterCheckitem&&this.masterCheckitem.length}},methods:{formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm";return b()(t).format(e)},pointNumChange:function(t){t.pointNum<t.realityVal.length&&t.realityVal.splice(t.pointNum,t.realityVal.length-1),f.a.pointsHandle(t),f.a.problemHandle(t),this.saveProblem()},addExceedVal:function(t){var e=this;t.realityVal.length>=t.pointNum?u.a.alert("爆点个数不能大于实测点数"):(t.realityVal.push({val:""}),this.$nextTick((function(){console.log("exceed-point-input =====",e.$refs["exceed-point-input"]);var t=e.$refs["exceed-point-input"],i=t&&t[t.length-1];i&&i.openKeyboard()})))},removeExceedVal:function(t){t.realityVal.pop(),f.a.pointsHandle(t),f.a.problemHandle(t),this.saveProblem()},updatedExceedVal:function(t){f.a.pointsHandle(t),f.a.problemHandle(t),this.saveProblem()},markExceedVal:function(e){var i=this;g.a.openPopup({mode:"edit",url:this.drawingUrl,points:e.realityVal||[],maxMarks:e.pointNum,callback:function(n){if(console.log("markExceedVal res =====",n),n){var s;t.each(n,(function(t){t.isExceed=!0,t.isQualified=!1}));var o=e.realityVal.length;(s=e.realityVal).splice.apply(s,[0,o].concat(Object(a.a)(n))),f.a.problemHandle(e),i.saveProblem()}}})},viewHuxing:function(){var e=[];this.drawingUrl?(t.each(this.detail.problemData,(function(i){e=t.clone(i.realityVal)})),g.a.openPopup({mode:"view",url:this.drawingUrl,points:e})):u.a.alert("PC端未设置户型图")},setNeedRepair:function(){var e=this,i=this.detail,a=this.model.place,n=this.masterCheckitem[0],s=Promise.resolve();if(i.needRepair=!i.needRepair,!t.isObject(i.repair.__ob__)){var o=t.clone(i.repair);delete i.repair,this.$set(this.detail,"repair",o)}(i.needRepair&&t.isEmpty(i.repair)||!i.repair.id)&&(s=x.a.getBidSectionCheckItemInfo(i.proj_id,a.section.id,n.id,"实测实量").then((function(t){var e=t.repair[0]||{};Object.assign(i.repair,e)})).then((function(){y.a.addTrack("实测实量-通知整改")}))),s.then((function(){e.$forceUpdate()})).then((function(){e.beforeSelectRepair()}))},isProblemExists:function(){var t=this.detail;return m.a.isProblemExists(t.id).then((function(t){if(!t)return u.a.alert("数据有更新"),w.a.go(-1),Promise.reject({mgs:"问题不存在",code:-1})}))},beforeSelectRepair:function(){var t=this.detail,e=Promise.resolve(!0);return"view"===t.mode&&(e=this.isProblemExists()),e},onSelectRepair:function(){var t=this;if("reedit"!==this.detail.mode&&"待整改"===this.detail.status)return m.a.changeRepair(this.detail).then((function(){return t.reloadDetail()})).then((function(){t.$forceUpdate()}))},changeMode:function(t){var e=this;this.isProblemExists().then((function(){u.a.confirm("今天24:00前可修改，是否现在修改？",{okText:"修改"}).then((function(i){i&&(e.detail.mode=t,e.detail.needRepair=!1,e.$refs.scroller.scrollTop=0)}))}))},checkSubmitData:function(){var e=this.detail;return t.some(e.problemData,(function(t){return""===t.pointNum||null===t.pointNum||void 0===t.pointNum}))?(u.a.alert("请填写实测点数"),!1):!e.needRepair&&"待整改"!==e.status||!t.isEmpty(e.repair)&&e.repair.id?!t.find(e.problemData,(function(e){return t.isEmpty(e.contractor)}))||(u.a.alert("请选择施工单位"),!1):(u.a.alert("请选择整改人"),!1)},setRepair:function(){var e=this,i=t.clone(this.detail);if(!t.isEmpty(i.repair)&&i.repair.id)return m.a.setRepair(i).then((function(){e.reloadDetail()}));u.a.alert("请选择整改人")},reloadDetail:function(){var t=this;Promise.resolve().then((function(){return t.$route.query.problemId?f.a.loadDetailById(t.$route.query.problemId):f.a.loadDetailByIdentity(f.a.tabsIdentity)}))}}}}).call(this,i("391c"))},5033:function(t,e,i){var a=i("5454");(t.exports=i("690e")(!1)).push([t.i,".zjapp .drawing-con[data-v-fba5990a]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;font-size:0;line-height:0}.zjapp .drawing-con canvas[data-v-fba5990a]{display:block;height:100%;width:100%;background:url("+a(i("eb66"))+") #fff;background-size:4px 4px}.zjapp .loading-text[data-v-fba5990a]{margin-top:15px;color:#aaa}.zjapp .error-text[data-v-fba5990a],.zjapp .loading-text[data-v-fba5990a]{padding:0 15px;line-height:20px;text-align:center;font-size:16px}.zjapp .error-text[data-v-fba5990a]{color:#ff3d3d}",""])},"515e":function(t,e,i){"use strict";var a=i("329b"),n=i("f1e4").a,s=(i("fe9e"),i("17cc")),o=Object(s.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"slide-right"}},[t.show?i("page-content",{class:{"content-not-empty":t.content.length},attrs:{mode:"dialog",title:"检查指引","on-close":t.closePopup}},[t.isLoading?t._e():i("div",{staticClass:"check-guide-detail-hd border-bottom"},[i("h2",{staticClass:"check-guide-detail-title pb10"},[t._v(t._s(t.title))])]),!t.isLoading&&t.content.length?i("div",{staticClass:"check-guide-detail-content"},t._l(t.content,(function(e,a){return i("p",{key:a},[e.isImg&&e.src?i("img",{class:{"img-not-ready":!e.ready,error:"rejected"===e.status},attrs:{src:t.getThumbnail(e)},on:{error:function(i){t.imgError(e,a)},click:function(i){t.imgClick(e)}}}):t._e(),e.isImg?t._e():i("span",[t._v("\n          "+t._s(e.val)+"\n        ")])])}))):t._e(),i("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.content.length,"empty-text":"PC端未设置检查指引"}})],1):t._e()],1)}),[],!1,null,"43042f0d",null).exports,r=!1;r||(r=new(a.default.extend(o))({el:document.createElement("div")}),document.body.appendChild(r.$el));e.a=r},5290:function(t,e,i){var a=i("32a1");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("1be8c876",a,!0,{sourceMap:!1,shadowMode:!1})},"574c":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .item-textarea{background-color:#fff;padding:5px 15px}.zjapp .item-textarea-content{position:relative}.zjapp .item-textarea .rule,.zjapp .item-textarea textarea{width:100%;min-height:40px;line-height:20px;font-size:16px;padding:0;border:none}.zjapp .item-textarea .rule{position:absolute;top:0;left:0;visibility:hidden;word-break:break-all}.zjapp .item-textarea .counter{text-align:right;margin:0 0 -5px 0;height:15px;line-height:15px;color:#b2b2b2;font-size:12px}",""])},5945:function(t,e,i){var a=i("e94b");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("4a616f84",a,!0,{sourceMap:!1,shadowMode:!1})},"5a71":function(t,e,i){"use strict";var a=i("29be").a,n=i("17cc"),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("item",{class:t.required,attrs:{label:t.title,text:t.value&&t.value.id?t.value.name:"view"===t.mode?"无":"",mode:t.mode,editabled:t.editabled,placeholder:t.required?t.placeholder||"请选择":"选填","form-check":t.formCheck},on:{click:t.openSelect}})}),[],!1,null,null,null);e.a=s.exports},"5afd":function(t,e,i){"use strict";i("88e9")},"5b85":function(t,e,i){var a=i("e2a8");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("45a0f20c",a,!0,{sourceMap:!1,shadowMode:!1})},"5c19":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .content-not-empty[data-v-43042f0d] .layout-content{display:auto;overflow:auto;padding-bottom:100px}.zjapp .check-guide-detail-hd[data-v-43042f0d]{margin-left:30px;padding:25px 30px 5px 0}.zjapp .check-guide-detail-title[data-v-43042f0d]{margin:0;line-height:20px;font-size:18px;color:#111;font-weight:700;word-break:break-all}.zjapp .check-guide-detail-info[data-v-43042f0d]{line-height:20px;font-size:14px;color:#8c8c8c}.zjapp .check-guide-detail-content[data-v-43042f0d]{padding:30px;line-height:30px;color:#333;font-size:16px}.zjapp .check-guide-detail-content p[data-v-43042f0d]{margin-bottom:30px;min-height:1em}.zjapp .check-guide-detail-content img[data-v-43042f0d]{max-width:100%}.zjapp .check-guide-detail-content .img-not-ready[data-v-43042f0d]{width:80px;height:auto}.zjapp .error[data-v-43042f0d]{max-width:50%}",""])},6272:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,'.zjapp .number-input[data-v-74068386]{position:relative;display:inline-block;vertical-align:top;width:61px;height:30px;border:1px solid #e5e5e5;border-radius:3px;text-align:center;font-size:14px;color:#333}@media screen and (min-width:320px){.zjapp .number-input[data-v-74068386]{width:50px}}@media screen and (min-width:360px){.zjapp .number-input[data-v-74068386]{width:58px}}@media screen and (min-width:375px){.zjapp .number-input[data-v-74068386]{width:61px}}.zjapp .text[data-v-74068386]{position:relative;display:inline-block;vertical-align:top;width:100%;height:100%;line-height:28px;overflow:hidden}.zjapp .text.disabled[data-v-74068386]{background:#f5f5f5;color:#666}.zjapp .value[data-v-74068386]{position:absolute;top:50%;right:0;margin-top:-14px;min-width:100%;height:28px;color:inherit}.zjapp .placeholder[data-v-74068386],.zjapp .value[data-v-74068386]{line-height:28px;pointer-events:none}.zjapp .placeholder[data-v-74068386]{display:inline-block;vertical-align:top;width:100%;height:100%;color:#b2b2b2}.zjapp .icon-minus[data-v-74068386]{position:absolute;top:-9px;right:-9px;width:18px;height:18px;border-radius:9px;background-color:#ff4546}.zjapp .icon-minus[data-v-74068386]:before{content:"";position:absolute;left:4px;top:8px;width:10px;height:2px;background-color:#fff}.zjapp .icon-minus[data-v-74068386]:after{content:"";position:absolute;left:-5px;top:-5px;width:28px;height:28px;border-radius:9px}.zjapp .number-input-select-all .value-handle[data-v-74068386]{background-color:#cbdaf9}.zjapp .number-input.unqualified[data-v-74068386]{border:1px solid #ffe8e8;background-color:#fff3f3;color:#ff5050}.zjapp .number-input.qualified .text[data-v-74068386]{color:#333}.zjapp .number-input.number-input-focus[data-v-74068386]{border-color:#4275e8;box-shadow:0 0 8px 0 rgba(66,117,232,.37)}.zjapp .number-input.number-input-empty[data-v-74068386]{border-color:#ff3d3d;box-shadow:0 0 8px 0 rgba(255,59,48,.37)}',""])},"63dd":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .header-tabs[data-v-73f776ea]{font-size:0;white-space:nowrap;text-align:center}.zjapp .header-tab[data-v-73f776ea]{display:inline-block;vertical-align:top;padding:10px;height:44px;line-height:24px;font-size:18px;opacity:.65}.zjapp .header-tab[data-v-73f776ea]:first-child{padding-left:0}.zjapp .header-tab[data-v-73f776ea]:last-child{padding-right:0}.zjapp .header-tab.on[data-v-73f776ea]{opacity:1}",""])},6948:function(t,e,i){"use strict";i("2b45"),i("163d");var a=i("329b"),n=i("8c3d").a,s=(i("b55a"),i("17cc")),o=Object(s.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"slide-up"},on:{leave:t.startClose,afterLeave:t.onClose}},[t.show?i("div",{staticClass:"number-keyboard-con",class:{"ios-bezel-less":t.isIOSBezelLess},style:{"z-index":t.zIndex},on:{touchstart:t.keyTouchstart,touchend:t.keyTouchend}},["true-or-false"===t.type?[i("div",{staticClass:"keyboard-row"},[i("div",{staticClass:"row-span-3 keys-row"},[i("div",{staticClass:"keys col color-green",attrs:{direct:"setTure"}},[i("icon",{attrs:{name:"qualified"}}),t._v("\n            合格\n          ")],1),i("div",{staticClass:"keys col color-red",attrs:{direct:"setFalse"}},[i("icon",{attrs:{name:"unqualified"}}),t._v("\n            不合格\n          ")],1)]),i("div",{staticClass:"row-span-1"},[i("div",{staticClass:"keys-row"},[i("div",{staticClass:"keys keys-ok",attrs:{direct:"closeKeyboard"}},[i("icon",{attrs:{name:"keyboard-close"}})],1)]),i("div",{staticClass:"keys-row"},[i("div",{staticClass:"keys keys-delete",attrs:{direct:"delete"}},[i("icon",{attrs:{name:"keyboard-delete"}})],1)])])]),i("div",{staticClass:"keyboard-row"},[i("div",{staticClass:"keys keys-prev",class:{disabled:!t.hasPrev},attrs:{direct:"prev"}},[t._v("\n          上一项\n        ")]),i("div",{staticClass:"keys keys-next",class:{disabled:!t.hasNext},attrs:{direct:"next"}},[t._v("\n          下一项\n        ")])])]:[i("div",{staticClass:"keyboard-row"},[i("div",{staticClass:"keys",attrs:{direct:"1"}},[t._v("1")]),i("div",{staticClass:"keys",attrs:{direct:"2"}},[t._v("2")]),i("div",{staticClass:"keys",attrs:{direct:"3"}},[t._v("3")]),i("div",{staticClass:"keys keys-ok",attrs:{direct:"closeKeyboard"}},[i("icon",{attrs:{name:"keyboard-close"}})],1)]),i("div",{staticClass:"keyboard-row"},[i("div",{staticClass:"keys",attrs:{direct:"4"}},[t._v("4")]),i("div",{staticClass:"keys",attrs:{direct:"5"}},[t._v("5")]),i("div",{staticClass:"keys",attrs:{direct:"6"}},[t._v("6")]),i("div",{staticClass:"keys keys-delete",attrs:{direct:"delete"}},[i("icon",{attrs:{name:"keyboard-delete"}})],1)]),i("div",{staticClass:"keyboard-row"},[i("div",{staticClass:"keys",attrs:{direct:"7"}},[t._v("7")]),i("div",{staticClass:"keys",attrs:{direct:"8"}},[t._v("8")]),i("div",{staticClass:"keys",attrs:{direct:"9"}},[t._v("9")]),i("div",{staticClass:"keys keys-prev",class:{disabled:!t.hasPrev},attrs:{direct:"prev"}},[t._v("\n          上一项\n        ")])]),i("div",{staticClass:"keyboard-row"},[i("div",{staticClass:"keys",class:{disabled:t.isDisabledMinus},attrs:{direct:"-"}},[t._v("-")]),i("div",{staticClass:"keys",attrs:{direct:"0"}},[t._v("0")]),i("div",{staticClass:"keys",class:{disabled:t.isDisabledPoint},attrs:{direct:"."}},[t._v(".")]),i("div",{staticClass:"keys keys-next",class:{disabled:!t.hasNext},attrs:{direct:"next"}},[t._v("\n          下一项\n        ")])])]],2):t._e()])}),[],!1,null,"6337f428",null).exports,r=!1;r||(r=new(a.default.extend(o))({el:document.createElement("div")}),document.body.appendChild(r.$el));var l=r,c=i("6f9e"),d=i("4360"),h={name:"NumberInput",props:{value:{type:[String,Number]},type:{type:String,default:"all"},decimal:{type:Number,default:2},placeholder:{type:String,default:""},nextEvent:{type:Function},range:{type:Array,default:function(){return[]}},overflowAutoRecover:{type:Boolean,default:!1},required:{type:Boolean},emptyAutoRecover:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},isSetEmptyTip:{type:Boolean,default:!1}},data:function(){return{rawValue:"",isFocusing:!1,isSelectAll:!1,keyboardHeight:d.a.state.app.isIOSBezelLess?266:"true-or-false"===this.type?176:232}},computed:{min:function(){return isNaN(this.range[0])?-1/0:parseFloat(this.range[0])},max:function(){return isNaN(this.range[1])?1/0:parseFloat(this.range[1])}},created:function(){c.a.$on("numberInputBlur",this.setBlur),c.a.$on("numberKeyboardClose",this.setBlur)},beforeDestroy:function(){this.isFocusing&&l.closeKeyboard()},destroyed:function(){c.a.$off("numberInputBlur",this.setBlur),c.a.$off("numberKeyboardClose",this.setBlur)},methods:{hasVal:function(t){return null!=t&&""!==t},openKeyboard:function(){this.disabled||(this.isFocusing?this.isSelectAll=!1:(c.a.$emit("numberInputBlur"),this.setFocus(),l.openKeyboard({inputComponent:this})))},setFocus:function(){this.isFocusing=!0,"true-or-false"!==this.type&&(this.isSelectAll=!0),this.rawValue=this.value,l.$on("keyboardInput",this.input),l.$on("keyboardAssign",this.assign),l.$on("keyboardDelete",this.deleteValue),l.$on("keyboardClear",this.clear),this.$emit("focus")},setBlur:function(){if(this.isFocusing){var t=this.checkValue();this.isFocusing=!1,this.isSelectAll=!1,l.$off("keyboardInput",this.input),l.$off("keyboardAssign",this.assign),l.$off("keyboardDelete",this.deleteValue),l.$off("keyboardClear",this.clear),this.$emit("input",t),this.$emit("blur",t),this.$nextTick((function(){l.calcTab()}))}},input:function(t){var e=this.hasVal(this.value)?this.value.toString():"",i="";this.isSelectAll?(i=t,this.isSelectAll=!1):i=e+t,console.log("newValue =====",i),this.$emit("input",i),l.setKeysStatus(i,this.type)},assign:function(t){this.isSelectAll=!1,this.$emit("input",t),l.setKeysStatus(t,this.type)},deleteValue:function(){var t=this.hasVal(this.value)?this.value.toString():"",e="";this.hasVal(t)&&(e=this.isSelectAll?"":t.substr(0,t.length-1)),this.$emit("input",e),l.setKeysStatus(e,this.type)},clear:function(){this.$emit("input",""),l.setKeysStatus("",this.type)},checkValue:function(){var t=this.hasVal(this.value)?this.value.toString():"";"-"===t&&(t=""),"."===t.substr(-1)&&(t=t.substr(0,t.length-1));var e=t.indexOf(".");return e>0&&(t=parseFloat(t.substring(0,e+this.decimal+1))),t=parseFloat(t),isNaN(t)?this.required&&this.emptyAutoRecover?(t=this.rawValue,this.$emit("onEmpty")):t="":(t<this.min&&(t=this.overflowAutoRecover?this.rawValue:this.min,this.$emit("overflowRange")),t>this.max&&(t=this.overflowAutoRecover?this.rawValue:this.max,this.$emit("overflowRange"))),t}}},p=(i("6abe"),Object(s.a)(h,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"number-input component-number-input",class:{"number-input-focus":t.isFocusing,"number-input-empty":t.isSetEmptyTip&&!t.value&&!t.isFocusing,"number-input-select-all":t.isSelectAll,qualified:"true-or-false"===t.type&&1===t.value,unqualified:"true-or-false"===t.type&&0===t.value}},[i("div",{staticClass:"text",class:{disabled:t.disabled},on:{click:function(e){return e.stopPropagation(),t.openKeyboard(e)}}},[t.hasVal(t.value)?i("span",{staticClass:"value"},[i("span",{staticClass:"value-handle"},[t._v(t._s("true-or-false"===t.type?1===t.value?"合格":"不合格":t.value))])]):i("span",{staticClass:"placeholder"},[t._v("\n      "+t._s(t.placeholder)+"\n    ")])]),t._t("extend")],2)}),[],!1,null,"74068386",null));e.a=p.exports},"6a26":function(t,e,i){var a=i("7cbc");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("2a19b04e",a,!0,{sourceMap:!1,shadowMode:!1})},"6abe":function(t,e,i){"use strict";i("bebe")},"6db4":function(t,e,i){"use strict";var a=i("8fd9").a,n=(i("9a3c"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("scroller",{ref:"scroller"},[i("measure-detail-place-checkitem",{attrs:{detail:t.detail},on:{changeItems:t.changeItems,changePlace:t.changePlace}}),t.hasMasterCheckitem?["edit"===t.detail.mode||"reedit"===t.detail.mode||"redo"===t.detail.mode?i("div",{staticClass:"bg-white"},[i("item",{attrs:{border:"bottom"}},[9!==t.detail.problemData[0].passrate_mode?i("div",{staticClass:"item-font color-theme f14",on:{click:t.viewHuxing}},[t._v("\n          户型图\n          "),i("icon",{staticClass:"ml5",staticStyle:{"font-size":"12px"},attrs:{name:"arrow-right"}})],1):t._e(),9===t.detail.problemData[0].passrate_mode?i("div",{staticClass:"value-input"},[i("span",{staticClass:"value-input-label"},[t._v("强度设计值")]),i("number-input",{staticStyle:{width:"40px"},attrs:{decimal:2,range:[1,99.99]},model:{value:t.detail.problemData[0].intensitySetVal,callback:function(e){t.$set(t.detail.problemData[0],"intensitySetVal",e)},expression:"detail.problemData[0].intensitySetVal"}})],1):t._e(),i("div",{staticClass:"item-con value-input align-r"},[i("span",{staticClass:"value-input-label"},[t._v("测区数")]),i("number-input",{staticStyle:{width:"40px"},attrs:{type:"int positive",range:[1,99]},on:{blur:function(e){t.areaNumChange(t.detail)}},model:{value:t.detail.areaNum,callback:function(e){t.$set(t.detail,"areaNum",e)},expression:"detail.areaNum"}})],1)]),t._l(t.detail.areaData,(function(e,a){return i("div",{key:a,staticClass:"pt15 pl15 pr15"},[i("div",{staticClass:"area-name"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isEditing,expression:"!area.isEditing"}],staticClass:"area-name-text",on:{click:function(i){t.areaNameEdit(e,i)}}},[t._v("\n            "+t._s(e.name)+"\n          ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isEditing,expression:"area.isEditing"}],staticClass:"area-name-input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.nameTemp,expression:"area.nameTemp"}],attrs:{type:"text",maxlength:"5"},domProps:{value:e.nameTemp},on:{blur:function(i){t.areaNameUpdate(e,t.detail)},input:function(i){i.target.composing||t.$set(e,"nameTemp",i.target.value)}}})])]),t._l(t.detail.problemData,(function(n,s){return i("div",{key:s},[i("div",{staticClass:"area-info"},[i("div",{staticClass:"checkitem-info"},[5!==n.passrate_mode?i("span",{staticClass:"checkitem-name"},[t._v(t._s(n.checkItem.name))]):t._e(),15===n.passrate_mode||16===n.passrate_mode?i("div",{staticClass:"checkitem-standard checkitem-standard_special",domProps:{innerHTML:t._s(n.standardRange)}}):17===n.passrate_mode||18===n.passrate_mode?i("div",{staticClass:"checkitem-standard checkitem-standard_special"},[t._v("\n                合格标准 "),i("span",{domProps:{innerHTML:t._s(n.standardRange)}})]):i("span",{staticClass:"checkitem-standard"},[t._v(t._s(n.standardRange))])]),t.contains([3,4,10,11,16,17,18],n.passrate_mode)?i("div",{staticClass:"value-input pl10"},[i("span",{staticClass:"value-input-label"},[t._v("设计值")]),i("number-input",{attrs:{decimal:t.$store.state.measure.valueDecimal,range:t.$store.state.measure.valueRange},on:{blur:function(e){t.setValUpdate(n)},focus:function(e){t.autoInputSetVal(n,n.areaData[a])},input:function(e){t.saveInputSetVal(n,n.areaData[a])}},model:{value:n.areaData[a].setVal,callback:function(e){t.$set(n.areaData[a],"setVal",e)},expression:"problem.areaData[areaIndex].setVal"}})],1):t._e(),t.contains([1,2,3,4,8,10,11,12,16,18],n.passrate_mode)?i("div",{staticClass:"value-input pl10"},[i("span",{staticClass:"value-input-label"},[t._v("点数")]),i("number-input",{staticStyle:{width:"40px"},attrs:{type:"int positive",range:[0,99]},on:{blur:function(e){t.areaPointNumChange(t.detail,n,n.areaData[a])}},model:{value:n.areaData[a].pointNum,callback:function(e){t.$set(n.areaData[a],"pointNum",e)},expression:"problem.areaData[areaIndex].pointNum"}})],1):t._e(),t.contains([9],n.passrate_mode)?i("div",{staticClass:"value-input pl10"},[i("span",{staticClass:"value-input-label"},[t._v("碳化深度")]),i("div",{staticClass:"value-carbon",on:{click:function(e){t.carbonOpen(n,n.areaData[a])}}},[t._v("\n                "+t._s(n.areaData[a].carbon||0===n.areaData[a].carbon?n.areaData[a].carbon.toFixed(1):"")+"\n              ")])]):t._e()]),t.contains([1,2,3,4,7,8,10,11,12,13,16,18],n.passrate_mode)?i("div",{staticClass:"number-input-group"},t._l(t.pointFilter(n.realityVal,{area:e.name}),(function(e,s){return i("number-input",{key:s,class:{"color-red":e.isExceed},attrs:{type:8===n.passrate_mode?"true-or-false":"all",decimal:t.$store.state.measure.valueDecimal,range:t.$store.state.measure.valueRange},on:{blur:function(e){t.realityValUpdate(n)},focus:function(e){t.autoInputSetVal(n,n.areaData[a])}},model:{value:e.val,callback:function(i){t.$set(e,"val",i)},expression:"point.val"}},[e.showMark?[e.hasMark?i("div",{staticClass:"huxing-view",attrs:{slot:"extend"},on:{click:function(i){t.markHuxing(t.detail,e)}},slot:"extend"},[t._v("\n                  图\n                ")]):i("div",{staticClass:"huxing-mark",attrs:{slot:"extend"},on:{click:function(i){i.stopPropagation(),t.markHuxing(t.detail,e)}},slot:"extend"},[i("i",{staticClass:"arrow"}),t._v("标点位\n                ")])]:t._e()],2)}))):t._e(),t.contains([5,6,14,15],n.passrate_mode)?i("div",{staticClass:"pt15 pb10"},t._l(n.measure_item,(function(s,o){return i("div",{key:o,staticClass:"item-input-group",class:{mt10:o}},[i("div",{staticClass:"label-input-group"},[t._v(t._s(s))]),t._l(t.pointFilter(n.realityVal,{area:e.name,label:s}),(function(e,s){return i("number-input",{key:s,class:{"color-red":e.isExceed,ml10:s},attrs:{decimal:t.$store.state.measure.valueDecimal,range:t.$store.state.measure.valueRange},on:{blur:function(e){t.realityValUpdate(n)},focus:function(e){t.autoInputSetVal(n,n.areaData[a])}},model:{value:e.val,callback:function(i){t.$set(e,"val",i)},expression:"point.val"}},[e.showMark?[e.hasMark?i("div",{staticClass:"huxing-view",attrs:{slot:"extend"},on:{click:function(i){t.markHuxing(t.detail,e)}},slot:"extend"},[t._v("\n                    图\n                  ")]):i("div",{staticClass:"huxing-mark",attrs:{slot:"extend"},on:{click:function(i){i.stopPropagation(),t.markHuxing(t.detail,e)}},slot:"extend"},[i("i",{staticClass:"arrow"}),t._v("标点位\n                  ")])]:t._e()],2)})),i("div",{staticClass:"label-input-group label-input-group-flex"},[t._v("设计值")]),t._l(t.pointFilter(n.realityVal,{area:e.name,label:s}),(function(e,s){return[0===s?i("number-input",{key:o+"-"+s,attrs:{decimal:t.$store.state.measure.valueDecimal,range:t.$store.state.measure.valueRange},on:{blur:function(e){t.setValUpdate(n)},focus:function(e){t.autoInputSetVal(n,n.areaData[a])}},model:{value:e.setVal,callback:function(i){t.$set(e,"setVal",i)},expression:"setValItem.setVal"}}):t._e()]}))],2)}))):t._e(),t.contains([17],n.passrate_mode)?i("div",{staticClass:"number-input-group passrate-slope"},[i("div",[i("span",{staticClass:"label-input-group"},[t._v("高度")]),t._l(t.pointFilter(n.realityVal,{area:e.name}).slice(0,2),(function(e,s){return i("number-input",{key:s,class:{"color-red":e.isExceed},attrs:{type:8===n.passrate_mode?"true-or-false":"all",decimal:t.$store.state.measure.valueDecimal,range:t.$store.state.measure.valueRange},on:{blur:function(e){t.realityValUpdate(n)},focus:function(e){t.autoInputSetVal(n,n.areaData[a])}},model:{value:e.val,callback:function(i){t.$set(e,"val",i)},expression:"point.val"}},[e.showMark?[e.hasMark?i("div",{staticClass:"huxing-view",attrs:{slot:"extend"},on:{click:function(i){t.markHuxing(t.detail,e)}},slot:"extend"},[t._v("\n                    图\n                  ")]):i("div",{staticClass:"huxing-mark",attrs:{slot:"extend"},on:{click:function(i){i.stopPropagation(),t.markHuxing(t.detail,e)}},slot:"extend"},[i("i",{staticClass:"arrow"}),t._v("标点位\n                  ")])]:t._e()],2)}))],2),i("div",[i("span",{staticClass:"label-input-group"},[t._v("水平距离")]),t._l(t.pointFilter(n.realityVal,{area:e.name}).slice(2,3),(function(e,s){return i("number-input",{key:s,class:{"color-red":e.isExceed},attrs:{type:8===n.passrate_mode?"true-or-false":"all",decimal:t.$store.state.measure.valueDecimal,range:t.$store.state.measure.valueRange},on:{blur:function(e){t.realityValUpdate(n)},focus:function(e){t.autoInputSetVal(n,n.areaData[a])}},model:{value:e.val,callback:function(i){t.$set(e,"val",i)},expression:"point.val"}},[e.showMark?[e.hasMark?i("div",{staticClass:"huxing-view",attrs:{slot:"extend"},on:{click:function(i){t.markHuxing(t.detail,e)}},slot:"extend"},[t._v("\n                    图\n                  ")]):i("div",{staticClass:"huxing-mark",attrs:{slot:"extend"},on:{click:function(i){i.stopPropagation(),t.markHuxing(t.detail,e)}},slot:"extend"},[i("i",{staticClass:"arrow"}),t._v("标点位\n                  ")])]:t._e()],2)}))],2)]):t._e(),t.contains([9],n.passrate_mode)?i("div",{staticClass:"number-input-group"},t._l(t.pointFilter(n.realityVal,{area:e.name}),(function(e,a){return i("number-input",{key:a,attrs:{decimal:t.$store.state.measure.valueDecimal,range:t.$store.state.measure.valueRange},on:{blur:function(e){t.realityValUpdate(n)}},model:{value:e.val,callback:function(i){t.$set(e,"val",i)},expression:"point.val"}})}))):t._e()])}))],2)}))],2):t._e(),"edit"===t.detail.mode||"redo"===t.detail.mode?i("div",{staticClass:"mt10"},[i("item",{staticClass:"p15"},[i("item-img-list",{attrs:{maxlength:50,"track-text":"实测实量"},on:{callback:t.saveProblem,remove:t.saveProblem},model:{value:t.detail.img,callback:function(e){t.$set(t.detail,"img",e)},expression:"detail.img"}})],1),i("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"补充说明"},on:{blur:t.saveProblem},model:{value:t.detail.remark,callback:function(e){t.$set(t.detail,"remark",e)},expression:"detail.remark"}}),i("div",{staticClass:"mb10"},[i("p",{staticClass:"c-label"},[t._v("请选择施工单位")]),t._l(t.detail.problemData,(function(e){return i("single-select",{key:e.checkItem.id,attrs:{title:e.checkItem.name,"page-title":"选择施工单位",placeholder:"请选择施工单位",options:t.model.contractors},on:{onSelect:t.saveProblem},model:{value:e.contractor,callback:function(i){t.$set(e,"contractor",i)},expression:"problem.contractor"}})}))],2),i("user-select",{attrs:{title:"抄送人",multi:!0,options:t.model.ccOptions,required:!0,memory:!0},on:{onSelect:t.changeCC},model:{value:t.detail.cc,callback:function(e){t.$set(t.detail,"cc",e)},expression:"detail.cc"}})],1):t._e(),"view"===t.detail.mode?[i("problem-detail-header",{staticClass:"bg-white pr0",attrs:{status:t.detail.status}},[i("template",{slot:"operat"},[t.detail.allowReedit&&"view"===t.detail.mode?i("div",{staticClass:"btn-reedit",on:{click:function(e){t.changeMode("reedit")}}},[t._v("\n            修改\n            "),i("icon",{attrs:{name:"edit"}})],1):t._e(),9!==t.detail.problemData[0].passrate_mode?i("div",{staticClass:"btn-drawing",on:{click:function(e){t.viewHuxing(t.detail)}}},[t._v("\n            户型图\n            "),i("icon",{attrs:{name:"arrow-right"}})],1):t._e()])],2),i("div",{staticClass:"detail-list-hd border-bottom"},[t.detail.problemData.length>1?i("div",{staticClass:"list-hd-toggle",on:{click:function(e){t.toggleProblemDataAll(t.detail)}}},[t._v("\n          "+t._s(t.hasProblemDataClose?"全展开":"全收起")+"\n        ")]):t._e(),1===t.detail.problemData.length?i("div",{staticClass:"list-hd-title"},[t._v("\n          检查项\n        ")]):t._e(),i("div",{staticClass:"list-hd-num"},[t._v("计算点数")]),9!==t.detail.problemData[0].passrate_mode?i("div",{staticClass:"list-hd-passrate"},[t._v("\n          合格率\n        ")]):t._e(),9===t.detail.problemData[0].passrate_mode?i("div",{staticClass:"list-hd-passrate align-c ws-nowrap",staticStyle:{width:"72px"}},[t._v("\n          强度值\n        ")]):t._e(),9===t.detail.problemData[0].passrate_mode?i("div",{staticClass:"list-hd-passrate ws-nowrap",staticStyle:{width:"100px"}},[t._v("\n          强度百分比\n        ")]):t._e()]),i("div",{staticClass:"detail-list"},t._l(t.detail.problemData,(function(e,a){return i("div",{key:a,staticClass:"border-bottom"},[i("div",{staticClass:"detail-item-hd",on:{click:function(i){t.toggleProblemData(e)}}},[t.detail.problemData.length>1?i("i",{staticClass:"detail-item-arrow",class:{"item-arrow-right":!e.isOpen,"item-arrow-down":e.isOpen}}):t._e(),i("div",{staticClass:"detail-item-name",class:{pl15:1===t.detail.problemData.length}},[t._v("\n              "+t._s(e.checkItem.name)+"\n            ")]),i("div",{staticClass:"detail-item-num"},[t._v(t._s(e.pointNum))]),9===t.detail.problemData[0].passrate_mode?i("div",{staticClass:"detail-item-passrate align-c",staticStyle:{width:"72px"}},[t._v("\n              "+t._s(e.intensityVal)+"\n            ")]):t._e(),i("div",{staticClass:"detail-item-passrate",class:{"color-red":e.passrate<.9}},[t._v("\n              "+t._s(t._f("percent")(e.passrate,2))+"\n            ")])]),e.isOpen?i("div",{staticClass:"detail-item-bd"},[9===e.passrate_mode?i("div",{staticClass:"detail-line"},[i("div",{staticClass:"detail-line-label",class:{"detail-line-label-single":1===t.detail.problemData.length},staticStyle:{width:"115px"}},[t._v("\n                强度设计值\n              ")]),i("div",{staticClass:"detail-line-con"},[t._v(t._s(e.intensitySetVal))])]):i("div",{staticClass:"detail-line"},[i("div",{staticClass:"detail-line-label",class:{"detail-line-label-single":1===t.detail.problemData.length}},[t._v("\n                合格标准\n              ")]),15===e.passrate_mode||16===e.passrate_mode||17===e.passrate_mode||18===e.passrate_mode?i("div",{staticClass:"detail-line-con",domProps:{innerHTML:t._s(e.standardRange)}}):i("div",{staticClass:"detail-line-con"},[t._v(t._s(e.standardRange))])]),i("div",{staticClass:"detail-line"},[i("div",{staticClass:"detail-line-label",class:{"detail-line-label-single":1===t.detail.problemData.length}},[t._v("\n                实测值\n              ")]),5===e.passrate_mode||6===e.passrate_mode||14===e.passrate_mode||15===e.passrate_mode?i("div",{staticClass:"detail-line-con"},t._l(e.areaData,(function(a,n){return i("div",{key:n,style:{"margin-top":(n?8:0)+"px"}},[i("p",[i("span",{staticClass:"detail-line-area"},[t._v(t._s(a.name))])]),t._l(e.measure_item,(function(n,s){return[t.hasPoints(e.realityVal,{area:a.name,label:n}).length?i("div",{key:s,staticClass:"view-points-line",style:{"margin-top":"4px"}},[i("div",{staticClass:"view-points-left"},[i("span",[t._v(t._s(n)+":")]),t._l(t.pointFilter(e.realityVal,{area:a.name,label:n}),(function(e,a){return[a?[t._v(" , ")]:t._e(),i("span",{key:a,class:{"color-red":e.isExceed}},[t._v(t._s(e.val))])]}))],2),i("div",{staticClass:"view-points-right"},[t._v("\n                        设计值\n                        "+t._s(t.pointFilter(e.realityVal,{area:a.name,label:n})[0].setVal)+"\n                      ")])]):t._e()]}))],2)}))):17===e.passrate_mode?i("div",{staticClass:"detail-line-con"},t._l(t.getAreaData(e.realityVal),(function(a,n){return i("div",{key:n,style:{"margin-top":(n?8:0)+"px"}},[i("p",[i("span",{staticClass:"detail-line-area",style:{"margin-right":"10px"}},[t._v(t._s(a.name))]),i("span",{staticClass:"detail-line-setval"},[t._v("设计值\n                      "+t._s(t.pointFilter(e.realityVal,{area:a.name})[0].setVal))])]),i("div",{staticClass:"view-points-line",style:{"margin-top":"4px"}},[i("div",{staticClass:"view-points-left"},[i("span",{staticClass:"color-text f12",style:{"margin-right":"30px"}},[t._v("高度\n                      ")]),t._l(t.pointFilter(e.realityVal,{area:a.name}).slice(0,2),(function(e,a){return[a?[t._v(" , ")]:t._e(),i("span",{key:a,class:{"color-red":e.isExceed}},[t._v(t._s(e.val))])]}))],2)]),i("div",{staticClass:"view-points-line",style:{"margin-top":"4px"}},[i("div",{staticClass:"view-points-left"},[i("span",{staticClass:"color-text f12",style:{"margin-right":"10px"}},[t._v("水平距离")]),t._l(t.pointFilter(e.realityVal,{area:a.name}).slice(2,3),(function(e,a){return[a?[t._v(" , ")]:t._e(),i("span",{key:a,class:{"color-red":e.isExceed}},[t._v(t._s(e.val))])]}))],2)])])}))):i("div",{staticClass:"detail-line-con"},t._l(t.getAreaData(e.realityVal),(function(a,n){return i("div",{key:n,style:{"margin-top":(n?8:0)+"px"}},[i("p",[i("span",{staticClass:"detail-line-area"},[t._v(t._s(a.name))]),3===e.passrate_mode||4===e.passrate_mode||10===e.passrate_mode||11===e.passrate_mode||16===e.passrate_mode||18===e.passrate_mode?i("span",{staticClass:"detail-line-setval"},[t._v("设计值\n                      "+t._s(t.pointFilter(e.realityVal,{area:a.name})[0].setVal))]):t._e(),t.contains([9],e.passrate_mode)?i("span",{staticClass:"detail-line-setval"},[t._v("碳化深度\n                      "),t._v("\n                      "+t._s((t.pointFilter(e.realityVal,{area:a.name})[0].carbon||0).toFixed(1)))]):t._e()]),i("p",{staticStyle:{"margin-top":"4px"}},[t._l(t.pointFilter(e.realityVal,{area:a.name}),(function(a,n){return[n?[t._v(" , ")]:t._e(),i("span",{key:n,class:{"color-red":a.isExceed}},[t._v("\n                        "+t._s(8===e.passrate_mode?1===a.val?"合格":"不合格":a.val)+"\n                      ")])]})),t.pointFilter(e.realityVal,{area:a.name}).length?t._e():i("span",[t._v("无")])],2),t.contains([9],e.passrate_mode)?i("div",{staticClass:"detail-line-carbon-value"},[i("span",[t._v("平均值\n                      "+t._s(t.pointFilter(e.realityVal,{area:a.name})[0].avg))]),i("span",[t._v("强度值\n                      "+t._s(t.pointFilter(e.realityVal,{area:a.name})[0].fck))])]):t._e()])})))])]):t._e()])}))),i("div",{staticClass:"mt10"},[t.detail.remark||t.detail.img.length?i("item",{attrs:{label:"补充说明"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[t.detail.remark?i("div",{staticClass:"item-font"},[t._v(t._s(t.detail.remark))]):t._e(),i("item-img-list",{attrs:{editabled:!1},model:{value:t.detail.img,callback:function(e){t.$set(t.detail,"img",e)},expression:"detail.img"}})],1)]):t._e(),t.hasContractor?i("item",{attrs:{label:"施工单位"}},[i("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},t._l(t.detail.problemData,(function(e){return i("p",{key:e.id},[t._v("\n              "+t._s(e.contractor?e.contractor.name:"")+"\n            ")])})))]):t._e(),i("user-select",{attrs:{title:"检查人",mode:"view",editabled:!1},model:{value:t.detail.regist,callback:function(e){t.$set(t.detail,"regist",e)},expression:"detail.regist"}}),i("item",{attrs:{label:"检查时间",text:t.formatDate(t.detail.regist_date)}}),(t.detail.repair_remark||t.detail.repair_image_file&&t.detail.repair_image_file.length)&&"待整改"!==t.detail.status?i("item",{attrs:{label:"整改照片"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[t.detail.repair_remark?i("div",{staticClass:"item-font"},[t._v(t._s(t.detail.repair_remark))]):t._e(),i("item-img-list",{attrs:{editabled:!1},model:{value:t.detail.repair_image_file,callback:function(e){t.$set(t.detail,"repair_image_file",e)},expression:"detail.repair_image_file"}})],1)]):t._e(),!t.detail.repair.id||"待整改"!==t.detail.status&&"已整改"!==t.detail.status?t._e():i("user-select",{attrs:{title:"整改人",mode:"view",options:t.model.repairOptions,date:"已整改"===t.detail.status?t.formatDate(t.detail.repair_date):"",editabled:(t.detail.isChecker||t.detail.isRepair)&&"待整改"===t.detail.status,"before-select":t.beforeSelectRepair},on:{onSelect:t.onSelectRepair},model:{value:t.detail.repair,callback:function(e){t.$set(t.detail,"repair",e)},expression:"detail.repair"}}),t.detail.isRepair&&"待整改"===t.detail.status?i("item",{attrs:{label:"整改照片"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[i("item-img-list",{attrs:{maxlength:50,"track-text":"实测实量"},model:{value:t.detail.repair_image_file,callback:function(e){t.$set(t.detail,"repair_image_file",e)},expression:"detail.repair_image_file"}})],1)]):t._e(),t.detail.isRepair&&"待整改"===t.detail.status?i("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"补充说明"},model:{value:t.detail.repair_remark,callback:function(e){t.$set(t.detail,"repair_remark",e)},expression:"detail.repair_remark"}}):t._e(),i("user-select",{attrs:{title:"抄送人",mode:"view",multi:!0,options:t.model.ccOptions,editabled:"已整改"!==t.detail.status},on:{onSelect:t.changeCC},model:{value:t.detail.cc,callback:function(e){t.$set(t.detail,"cc",e)},expression:"detail.cc"}})],1)]:t._e(),"reedit"===t.detail.mode?[t.detail.remark||t.detail.img.length?i("item",{staticClass:"mt10",attrs:{label:"补充说明"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[t.detail.remark?i("div",{staticClass:"item-font"},[t._v(t._s(t.detail.remark))]):t._e(),i("item-img-list",{attrs:{editabled:!1,"track-text":"实测实量"},model:{value:t.detail.img,callback:function(e){t.$set(t.detail,"img",e)},expression:"detail.img"}})],1)]):t._e(),i("div",{staticClass:"mb10"},[i("p",{staticClass:"c-label"},[t._v("请选择施工单位")]),t._l(t.detail.problemData,(function(e){return i("single-select",{key:e.checkItem.id,attrs:{title:e.checkItem.name,"page-title":"选择施工单位",placeholder:"请选择施工单位",options:t.model.contractors,mode:"view"},model:{value:e.contractor,callback:function(i){t.$set(e,"contractor",i)},expression:"problem.contractor"}})}))],2)]:t._e(),"检查完毕"===t.detail.status&&"reedit"!==t.detail.mode&&"redo"!==t.detail.mode?[i("div",{staticClass:"need-repair",on:{click:t.setNeedRepair}},[i("icon",{attrs:{name:t.detail.needRepair?"checkbox-square-checked":"checkbox-square"}}),t._v("通知整改\n      ")],1),t.detail.needRepair?i("user-select",{attrs:{title:"整改人",options:t.model.repairOptions,memory:!0},model:{value:t.detail.repair,callback:function(e){t.$set(t.detail,"repair",e)},expression:"detail.repair"}}):t._e(),t.detail.needRepair?i("app-button-group",{staticClass:"pt10"},[i("app-button",{attrs:{name:"通知整改"},on:{click:t.setRepair}})],1):t._e()]:t._e(),t.detail.id&&"检查中"===t.detail.status?i("app-button-group",[i("app-button",{attrs:{type:"text",name:"删除此草稿"},on:{click:t.delProblem}})],1):t._e(),"检查中"===t.detail.status||"view"!==t.detail.mode||t.allowMeasureReinspect||t.model.currentUserBatchId!==t.detail.batch_id?t._e():i("app-button-group",[i("app-button",{attrs:{type:"operate",name:"再测一次"},on:{click:t.setRedo}})],1)]:t._e(),i("loading-status",{attrs:{"is-loading":!1,"is-empty":!t.hasMasterCheckitem,"empty-text":"请选择检查项"}}),t.hasCarbonDialog?i("measure-carbon-dialog",{attrs:{value:t.carbonData,show:t.carbonShow},on:{close:t.carbonClose,select:t.carbonSelect}}):t._e()],2)}),[],!1,null,"ffcbe3f2",null);e.a=s.exports},7434:function(t,e,i){var a=i("0cb6");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("f6a1180a",a,!0,{sourceMap:!1,shadowMode:!1})},"76c6":function(t,e,i){"use strict";(function(t){i("5ab2"),i("6d57"),i("e10e"),i("cc57");var a,n=i("28f8"),s=i("774b"),o=i("07d2"),r=i("6948"),l=i("e223"),c=i("e89f"),d=i("e2a7"),h=i("4360");function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function u(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}e.a={name:"DrawingWithPoint",components:{Scroller:s.a,Item:o.a,NumberInput:r.a,Drawing:l.a},mixins:[c.a],data:function(){return{show:!1,isLoading:!0,points:[],maxMarks:1/0,layoutPointsData:[],checkitemData:[],areaData:[],mode:"view",scrollPaddingBottom:0,lightIndex:""}},computed:{isNumberInputOpen:function(){return h.a.state.global.isNumberInputOpen},drawingHeight:function(){return document.documentElement.clientWidth},valueDecimal:function(){return h.a.state.measure.valueDecimal},valueRange:function(){return h.a.state.measure.valueRange}},watch:{isNumberInputOpen:function(t){this.scrollPaddingBottom=t?232:0}},methods:{openPopup:function(e){var i=this;if(this.show=!0,this.mode=e.mode,this.url=e.url,this.points=t.map(e.points,(function(t,e){return u(u({},t),{},{index:e})})),this.maxMarks=isNaN(e.maxMarks)?1/0:e.maxMarks,a=e.callback,this.pointLight(),this.layoutPointsData=[],t.isEmpty(e.itemData)||1===e.itemData.length){var n={itemName:"",areas:[],passrateMode:e.itemData&&e.itemData[0]&&e.itemData[0].passrate_mode||""};if(t.isEmpty(e.areaData)){var s=t.clone(this.points);n.areas.push({areaName:"",points:s})}else t.each(e.areaData,(function(e){var a=t.filter(i.points,{area:e.name});n.areas.push({areaName:e.name,points:a})}));this.layoutPointsData.push(n)}else t.each(e.itemData,(function(a){var n=a.item_name?a.item_name:a.name,s={itemName:n,areas:[],passrateMode:a.passrate_mode||""};if(t.isEmpty(e.areaData)){var o=t.filter(i.points,{itemName:n});s.areas.push({areaName:"",points:o})}else t.each(e.areaData,(function(e){var a=t.filter(i.points,{itemName:n,area:e.name});s.areas.push({areaName:e.name,points:a})}));i.layoutPointsData.push(s)}));return this.$emit("open"),this},closePopup:function(){this.show=!1,this.$emit("close")},pointLight:function(e){this.lightIndex=e,this.points=t.map(this.points,(function(t,i){var a=u({},t);return e===i?a.color="#4275e8":a.isQualified?a.color="#14ff56":a.color="#ff4546",a}))},clickPointEle:function(t){this.pointLight(t.index)},removeExceedPoint:function(t){var e=this.points.indexOf(t);this.points.splice(e,1)},inputFocus:function(t){var e=this;this.$nextTick((function(){var i=e.$refs["exceed-point-input"][t];e.pointLight(t),e.$refs.scroller.scrollToEle(i)}))},inputBlur:function(){this.pointLight()},onclick:function(t){var e=this;if("view"===this.mode){if(t.clickPoint&&"points"===t.clickPoint.tag){var i=t.clickPoint.index;this.pointLight(i)}}else{if(this.points.length>=this.maxMarks)return void d.a.alert("爆点个数不能大于实测点数");this.points.push({x:t.x,y:t.y}),this.$nextTick((function(){var t=e.$refs["exceed-point-input"],i=t&&t[t.length-1];i&&i.openKeyboard()}))}},confirm:function(){var e=[];t.each(this.points,(function(t){""!==t.val&&null!==t.val&&void 0!==t.val&&(delete t.color,e.push(t))})),a&&a(e),this.closePopup()}}}}).call(this,i("391c"))},"7c79":function(t,e,i){"use strict";var a=i("316a").a,n=(i("339b"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"select-con",staticClass:"select-con",class:{"select-disabled":!t.editabled||t.isLoading},on:{click:t.openDialog}},[i("div",{staticClass:"select-hd"},[t._v(t._s(t.isLoading?"...":t.hdText))]),i("div",{staticClass:"select-bd"},[t._v(t._s(t.isLoading?"...":t.bdText))]),t.editabled?i("icon",{staticClass:"select-arrow",attrs:{name:t.isOpen?"arrow-up":"arrow-down"}}):t._e()],1)}),[],!1,null,"43c15cbc",null);e.a=s.exports},"7cbc":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,'.zjapp .icon-plus[data-v-78eb219e]{position:relative;display:inline-block;width:30px;height:30px;border:1.5px solid #4275e8;border-radius:15px}.zjapp .icon-plus[data-v-78eb219e]:before{left:4px;top:12.75px;width:20px;height:1.5px}.zjapp .icon-plus[data-v-78eb219e]:after,.zjapp .icon-plus[data-v-78eb219e]:before{content:"";position:absolute;background-color:#4275e8}.zjapp .icon-plus[data-v-78eb219e]:after{left:12.75px;top:4px;width:1.5px;height:20px}.zjapp .btn-modify[data-v-78eb219e]{display:inline-block;vertical-align:top;height:25px;line-height:25px;padding:0 8px;border:1px solid #c8d2f6;background-color:#ebf1ff;color:#7a95d1;font-size:14px;white-space:nowrap;border-radius:2px}.zjapp .btn-modify .icon-arrow-right[data-v-78eb219e]{font-size:12px}.zjapp .need-repair[data-v-78eb219e]{height:34px;line-height:18px;padding:8px 0;font-size:16px;color:#333}.zjapp .need-repair .icon[data-v-78eb219e]{display:inline-block;vertical-align:top;margin-right:7px}.zjapp .need-repair-bottom[data-v-78eb219e]{height:46px;line-height:18px;padding:14px 15px;margin-top:10px;font-size:16px;color:#666}.zjapp .need-repair-bottom .icon[data-v-78eb219e]{display:inline-block;vertical-align:top;margin-right:7px}.zjapp .c-label[data-v-78eb219e]{color:#999;font-size:12px;line-height:17px;padding:14px 15px 8px;background-color:#f4f4f4}',""])},8004:function(t,e,i){"use strict";(function(t){var a=i("4c09"),n=i("86e8"),s=i("7c79"),o=i("a37e"),r=i("7798");e.a={name:"MeasureDetailPlaceCheckitem",components:{DropSelectPlace:n.a,DropSelectCheckitem:s.a},props:{detail:{type:Object,default:function(){}}},data:function(){return{model:o.a,checkitemSelectLoading:!1}},computed:{projId:function(){return o.a.place.project.id||""},batchId:function(){return this.detail&&this.detail.batch_id},place:function(){return this.$store.state.measure.detailPlace},checkitems:function(){return this.detail&&this.detail.checkItems||[]},masterCheckitem:function(){return this.$store.state.measure.detailMasterCheckitem},checkitemOptions:function(){return o.a.measureCheckItems},processMode:function(){var e=t.isEmpty(this.masterCheckitem)?"":this.masterCheckitem[1];return e&&e.process_mode?e.process_mode:""},mode:function(){return this.detail&&"检查中"===this.detail.status?"edit":"view"},multi:function(){return 2===this.$store.state.measure.entryRequirements&&(2===this.detail.entry_requirements||"检查中"!==this.detail.status)},editabled:function(){return this.detail&&this.model.currentUserBatchId===this.detail.batch_id&&!this.model.problemId&&!this.model.readonly&&"redo"!==this.detail.mode}},methods:{onChangePlace:function(t){var e=this,i=t.section?t.section.id:"",n=t.building?t.building.id:"",s=t.unit?t.unit.id:"",l=t.floor?t.floor.id:"",c=t.room?t.room.id:"",d=(o.a.firstCheckitem[1]||{}).id||"",h=i!==this.$store.state.measure.detailPlace.section.id,p=n!==this.$store.state.measure.detailPlace.building.id;this.$store.dispatch("measure/setIndexPlace",[t.section,t.building,t.unit]),this.$store.dispatch("measure/setDetailPlace",t),this.$emit("changePlace",t),Promise.resolve().then((function(){return d?r.a.getMeasureCheckitemRealProcessMode(n,d):""})).then((function(t){if(!t||c&&1!==t||!c&&1===t)return e.$store.dispatch("measure/setDetailMasterCheckitem",[]),e.detail.checkItems=[],e.checkitemSelectLoading=!0,Promise.resolve().then((function(){if(p)return r.a.getAllMeasureBuildingCheckItems(i,n).then((function(t){var e,i=o.a.measureCheckItems.length;(e=o.a.measureCheckItems).splice.apply(e,[0,i].concat(Object(a.a)(t)))}))})).then((function(){if(h)return r.a.getBatchByIdentity(e.projId,i,o.a.tabsIdentity).then((function(t){e.detail.batch_id=t.id}))})).then((function(){e.checkitemSelectLoading=!1,e.$nextTick((function(){e.$refs["drop-select-checkitem"].openDialog()}))}));o.a.init(c,n,s,l,d).catch((function(t){Popup.alert(t,2e3),e.$router.go(-1)}))}))},onChangeCheckitem:function(e){var i=t.map(e,(function(t){return t.id})),a="检查中"===this.detail.status&&2===this.detail.entry_requirements&&!t.isEmpty(t.intersection(t.map(this.detail.checkItems,"id"),i)),n=[],s=e[0];t.each(o.a.measureCheckItems,(function(e){t.each(e.children,(function(t){t.id===s.id&&(n.push(e),n.push(t))}))})),this.$store.dispatch("measure/setIndexCheckitem",n),this.$emit("changeItems",n,i),this.$route.params.problemId?o.a.loadDetailById(this.$route.params.problemId):o.a.loadDetailByIdentity(o.a.tabsIdentity,i,a)}}}}).call(this,i("391c"))},"801f":function(t,e,i){"use strict";(function(t){i("163d");var a=i("fdef"),n=i("3122"),o=i("4ad6"),r=i("3bd5"),l=i("1b7e");e.a={name:"MeasureDrawing3",components:{},props:{detail:{type:Object,default:function(){}},width:{type:Number,default:document.documentElement.clientWidth},height:{type:Number,default:document.documentElement.clientWidth}},data:function(){return{drawing:null,isDownloading:!1,error:"",img:null,src:"",folder:"house-image"}},watch:{detail:function(t){t&&this.$nextTick(this.getImage)}},mounted:function(){this.getImage()},beforeDestroy:function(){this.drawing&&this.drawing.destroy&&this.drawing.destroy()},methods:{getImage:function(){var e=this,i=this.detail.drawing_file&&this.detail.drawing_file[0]?this.detail.drawing_file[0].url:"";if(!this.isDownloading){if(console.log("getImage -----------",i),this.isDownloading=!0,i){var a=r.a.getUser().user_id,c=s.strRightBack(s.replaceAll(i,"\\?x-oss-process=image\\/resize,","@"),"/");if(!c)return this.error="户型图地址错误",void(this.isDownloading=!1);this.error="";var d=[o.a.appImagePath()+a+"/house-image/"+c,o.a.appImagePath()+a+"/drawing/"+c,o.a.appImagePath()+a+"/images/"+c,o.a.appDataPath()+a+"/house-image/"+c,o.a.appDataPath()+a+"/drawing/"+c,o.a.appDataPath()+a+"/images/"+c],h=Promise.resolve();return"dev"===APP_ENV?h=h.then((function(){return i})):t.each(d,(function(t){h=h.then((function(e){return e||o.a.isFileExists(t).then((function(e){if(e)return n.a._fixPath(t)}))}))})),h.then((function(t){if(console.log("获取图片 src =========",t),!t)return l.a.getHasNetwork().then((function(t){return t?n.a.download(i,!0,e.folder).then((function(t){e.src=t})):Promise.reject("当前无网络")}));e.src=t})).then((function(){console.log("this.src ======",e.src),e.src?(e.img=new Image,e.img.onload=function(){e.img.complete?(console.log("图片加载成功 ---------"),e.isDownloading=!1,e.$nextTick(e.init)):(e.error="加载图片失败",e.isDownloading=!1)},e.img.onerror=function(){e.error="加载图片失败",e.isDownloading=!1},e.img.src=e.src):(e.error="下载户型图失败",e.isDownloading=!1)})).catch((function(i){e.error=t.isString(i)?i:"下载户型图失败",e.isDownloading=!1}))}this.error="户型图地址错误",this.isDownloading=!1}},init:function(){var t=this;this.isDownloading||(this.drawing&&this.drawing.reset(),this.drawing=a.a.init({canvas:this.$refs["drawing-canvas"],img:this.img,data:this.detail,height:this.height,onChange:function(){"edit"===t.detail.mode&&t.$emit("onChange")},onClickPoint:function(e){t.$emit("onClickPoint",e)}}))},update:function(t){this.drawing&&this.drawing.setDetailData(t)},inputBlur:function(){this.drawing&&this.drawing.inputBlur()}}}}).call(this,i("391c"))},"81f2":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,'.zjapp .main[data-v-2cac8864]{position:fixed;width:100%;bottom:0}.zjapp .arrow[data-v-2cac8864]{position:absolute;top:-7px;right:18px;width:0;height:0;border-bottom:7px solid #fff;border-right:7px solid transparent;border-left:7px solid transparent}.zjapp .content[data-v-2cac8864]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.4);overflow:hidden}.zjapp .box[data-v-2cac8864]{display:flex;flex-direction:column;background-color:#fff;overflow:auto}.zjapp .box-single[data-v-2cac8864]{display:flex;flex-direction:column;flex:1}.zjapp .detail-hd[data-v-2cac8864]{display:flex;padding:6px 15px}.zjapp .detail-arrow-right[data-v-2cac8864]{width:13px;height:34px;overflow:hidden}.zjapp .detail-arrow-right[data-v-2cac8864]:before{display:block;content:"";width:0;height:0;margin-top:12px;border:5px solid transparent;border-left:5px solid #c8c8c8}.zjapp .detail-arrow-down[data-v-2cac8864]{width:13px;height:34px;overflow:hidden}.zjapp .detail-arrow-down[data-v-2cac8864]:before{display:block;content:"";width:0;height:0;margin-top:15px;border:5px solid transparent;border-top:5px solid #c8c8c8}.zjapp .detail-title[data-v-2cac8864]{flex:1;line-height:34px;color:#111;font-size:16px}.zjapp .detail-bd[data-v-2cac8864]{padding:8px 15px 8px 35px;background-color:#fafafa}.zjapp .text-line[data-v-2cac8864]{font-size:14px;color:#666;line-height:30px;margin-bottom:30px}.zjapp .detail-hd-single[data-v-2cac8864]{padding:6px 0;margin:0 15px}.zjapp .detail-bd-single[data-v-2cac8864]{display:flex;flex-direction:column;flex:1;padding:8px 15px;background-color:#fff}',""])},"83d9":function(t,e,i){"use strict";i("af92")},"86e8":function(t,e,i){"use strict";var a=i("1985").a,n=(i("5afd"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"select-con",staticClass:"select-con",class:{"select-disabled":!t.editabled||t.isLoading},on:{click:t.openDialog}},[i("div",{staticClass:"select-hd"},[t._v(t._s(t.isLoading?"...":t.hdText))]),i("div",{staticClass:"select-bd"},[t._v(t._s(t.isLoading?"...":t.bdText))]),t.editabled?i("icon",{staticClass:"select-arrow",attrs:{name:t.isOpen?"arrow-up":"arrow-down"}}):t._e()],1)}),[],!1,null,"dbd87ef2",null);e.a=s.exports},"88e9":function(t,e,i){var a=i("d871");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("3530e114",a,!0,{sourceMap:!1,shadowMode:!1})},8968:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .value-input[data-v-ffcbe3f2]{font-size:0;line-height:0;white-space:nowrap}.zjapp .value-input-label[data-v-ffcbe3f2]{line-height:30px;font-size:14px;color:#999;margin-right:8px}.zjapp .area-name-text[data-v-ffcbe3f2]{display:inline-block;padding:4px 0;line-height:22px;font-size:16px;color:#4275e8;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.zjapp .area-name-input[data-v-ffcbe3f2]{position:relative;display:inline-block;vertical-align:top;width:61px;height:34px;border:1px solid #4275e8;border-radius:3px;text-align:center;font-size:14px;color:#333;box-shadow:0 0 8px 0 rgba(66,117,232,.37)}.zjapp .area-name-input input[data-v-ffcbe3f2]{border:none;width:100%;height:100%;padding:5px;text-align:center;background-color:transparent}.zjapp .area-info[data-v-ffcbe3f2]{display:flex;font-size:14px}.zjapp .checkitem-info[data-v-ffcbe3f2]{flex:1;padding-top:7px;min-height:34px}.zjapp .checkitem-name[data-v-ffcbe3f2]{color:#333}.zjapp .checkitem-standard[data-v-ffcbe3f2]{color:#999}.zjapp .checkitem-standard_special[data-v-ffcbe3f2]{line-height:22px;display:block;margin-top:1px}.zjapp .huxing-view[data-v-ffcbe3f2]{position:absolute;top:-10px;right:-8px;width:20px;height:20px;line-height:20px;text-align:center;background-color:#4275e8;color:#fff;font-size:12px;border-radius:10px}.zjapp .huxing-mark[data-v-ffcbe3f2]{position:absolute;top:-20px;left:50%;width:44px;height:22px;line-height:22px;margin-left:-22px;background-color:#fdebbd;text-align:center;color:#111;font-size:10px;border-radius:2px}.zjapp .huxing-mark .arrow[data-v-ffcbe3f2]{position:absolute;left:19px;bottom:-6px;width:0;height:0;border:3px solid #fdebbd;border-color:#fdebbd transparent transparent}.zjapp .item-input-group[data-v-ffcbe3f2]{display:flex}.zjapp .label-input-group[data-v-ffcbe3f2]{height:30px;line-height:30px;padding-right:8px;color:#999;text-align:right;font-size:14px}.zjapp .label-input-group-flex[data-v-ffcbe3f2]{flex:1}.zjapp .view-points-line[data-v-ffcbe3f2]{display:flex}.zjapp .view-points-left[data-v-ffcbe3f2]{min-width:140px;padding-left:2.6em;text-indent:-2.6em}.zjapp .view-points-right[data-v-ffcbe3f2]{flex:1;padding-left:10px;color:#b3b3b3;white-space:nowrap}.zjapp .number-input-group[data-v-ffcbe3f2]{padding-top:15px;margin-left:-10px}.zjapp .number-input-group .number-input[data-v-ffcbe3f2]{margin:0 0 10px 10px}.zjapp .passrate-slope[data-v-ffcbe3f2]{display:flex;align-items:center;justify-content:space-between;width:100%;margin-left:inherit}.zjapp .btn-reedit[data-v-ffcbe3f2]{width:80px;padding:12px 0;line-height:22px;font-size:14px;text-align:center;color:#4275e8}.zjapp .btn-reedit .icon[data-v-ffcbe3f2]{margin-top:5px;font-size:12px;vertical-align:top}.zjapp .btn-drawing[data-v-ffcbe3f2]{width:100px;padding:12px 15px;line-height:22px;font-size:14px;text-align:right;color:#4275e8}.zjapp .btn-drawing .icon[data-v-ffcbe3f2]{font-size:13px}.zjapp .detail-list-hd[data-v-ffcbe3f2]{display:flex;height:30px;background-color:#fafafa}.zjapp .detail-list-hd .list-hd-toggle[data-v-ffcbe3f2]{flex:1;padding-left:15px;line-height:30px;color:#4275e8}.zjapp .detail-list-hd .list-hd-title[data-v-ffcbe3f2]{flex:1;padding-left:15px;line-height:30px;font-size:14px;color:#888}.zjapp .detail-list-hd .list-hd-num[data-v-ffcbe3f2]{width:80px;line-height:30px;font-size:14px;text-align:center;color:#888}.zjapp .detail-list-hd .list-hd-passrate[data-v-ffcbe3f2]{width:100px;padding:0 15px;line-height:30px;font-size:14px;text-align:right;color:#888}.zjapp .detail-list[data-v-ffcbe3f2]{background-color:#fff}.zjapp .detail-item-hd[data-v-ffcbe3f2]{display:flex;align-items:flex-start;min-height:46px}.zjapp .detail-item-arrow[data-v-ffcbe3f2]{border:5px solid #c8c8c8;width:0;height:0}.zjapp .detail-item-arrow.item-arrow-right[data-v-ffcbe3f2]{margin:18px 13px 0 17px;border-top-color:transparent;border-right-width:0;border-bottom-color:transparent}.zjapp .detail-item-arrow.item-arrow-down[data-v-ffcbe3f2]{margin:20px 10px 0 15px;border-left-color:transparent;border-right-color:transparent;border-bottom-width:0}.zjapp .detail-item-name[data-v-ffcbe3f2]{flex:1;padding:13px 0;line-height:20px;font-size:14px;color:#111}.zjapp .detail-item-num[data-v-ffcbe3f2]{width:80px;padding:13px 0;line-height:20px;font-size:14px;text-align:center;color:#888}.zjapp .detail-item-passrate[data-v-ffcbe3f2]{width:100px;padding:13px 15px;line-height:20px;font-size:14px;text-align:right;color:#888}.zjapp .detail-line[data-v-ffcbe3f2]{display:flex}.zjapp .detail-line-label[data-v-ffcbe3f2]{padding:8px 0 8px 35px;width:105px;line-height:20px;font-size:14px;color:#666}.zjapp .detail-line-label-single[data-v-ffcbe3f2]{padding:8px 0 8px 15px;width:85px;line-height:20px;font-size:14px;color:#666}.zjapp .detail-line-con[data-v-ffcbe3f2]{flex:1;padding:8px 15px 8px 0;line-height:20px;font-size:14px;color:#333}.zjapp .detail-line-area[data-v-ffcbe3f2]{background-color:#f0f0f0;color:#8c8c8c;padding:2px}.zjapp .detail-line-setval[data-v-ffcbe3f2]{margin-left:8px;color:#999}.zjapp .need-repair[data-v-ffcbe3f2]{height:46px;line-height:18px;padding:14px 15px;margin-top:10px;font-size:16px;color:#666}.zjapp .need-repair .icon[data-v-ffcbe3f2]{display:inline-block;vertical-align:top;margin-right:7px}.zjapp .c-label[data-v-ffcbe3f2]{color:#999;font-size:12px;line-height:17px;padding:14px 15px 8px;background-color:#f4f4f4}.zjapp .value-carbon[data-v-ffcbe3f2]{display:inline-block;height:28px;width:38px;border:1px solid #e5e5e5;vertical-align:top;border-radius:3px;text-align:center;font-size:14px;line-height:28px;color:#333}.zjapp .detail-line-carbon-value[data-v-ffcbe3f2]{display:flex;justify-content:space-between;margin:4px 0 10px 0;color:#999}",""])},"8bcc":function(t,e,i){var a=i("63dd");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("fc5468b8",a,!0,{sourceMap:!1,shadowMode:!1})},"8c3d":function(t,e,i){"use strict";(function(t){i("ed63"),i("163d"),i("2b45"),i("e204"),i("cc57");var a,n,s=i("07d2"),o=i("cf09"),r=i("6f9e"),l=i("4360"),c=[],d=[0,1,2,3,4,5,6,7,8,9,".","-"];function h(t){return null!=t&&""!==t}e.a={name:"NumberKeyboard",components:{Item:s.a},data:function(){return{show:!1,isClosing:!1,zIndex:0,willOpenParams:null,inputComponent:"",type:"",hasPrev:!1,hasNext:!1,isDisabledMinus:!1,isDisabledPoint:!1}},computed:{isIOSBezelLess:function(){return l.a.state.app.isIOSBezelLess}},watch:{isClosing:function(t){var e=this;this.$nextTick((function(){!t&&e.willOpenParams&&e.openKeyboard(e.willOpenParams)}))}},created:function(){r.a.$on("routerBeforeEach",this.closeKeyboard),r.a.$on("pageContentClick",this.closeKeyboard)},destroyed:function(){r.a.$off("routerBeforeEach",this.closeKeyboard),r.a.$off("pageContentClick",this.closeKeyboard)},methods:{openKeyboard:function(t){this.isClosing?this.willOpenParams=t:(this.willOpenParams=null,this.show=!0,this.inputComponent=t.inputComponent,this.zIndex=o.a?++o.a.zIndex:1,l.a.commit("global/SET_IS_NUMBER_INPUT_OPEN",!0),l.a.commit("global/SET_NUMBER_KEYBOARD_HEIGHT",l.a.state.app.isIOSBezelLess?266:"true-or-false"===this.inputComponent.type?176:232),this.calcTab(),this.type=this.inputComponent.type,this.setKeysStatus(this.inputComponent.value,this.inputComponent.type),r.a.$emit("numberKeyboardOpen",this.inputComponent))},closeKeyboard:function(){this.show=!1,r.a.$emit("numberKeyboardClose")},startClose:function(){this.isClosing=!0},onClose:function(){this.isClosing=!1,l.a.commit("global/SET_IS_NUMBER_INPUT_OPEN",!1),r.a.$emit("afterNumberKeyboardClose")},input:function(t){"-"===t&&this.isDisabledMinus||"."===t&&this.isDisabledPoint||this.$emit("keyboardInput",t)},delete:function(t){var e=this;this.$emit("keyboardDelete"),a=setTimeout((function(){e.$emit("keyboardClear")}),500)},calcTab:function(){var e=function t(e){return e&&e.$parent?"Scroller"===e.$parent.$options.name?e.$parent:t(e.$parent):null}(this.inputComponent),i=e&&e.$el.querySelectorAll(".component-number-input");if(c=[],i&&t.each(i,(function(t){c.push(t.__vue__)})),t.isEmpty(c))this.hasPrev=!1,this.hasNext=!1;else{var a=t.findIndex(c,this.inputComponent);this.hasPrev=a>0,this.hasNext=a<c.length-1}this.inputComponent&&this.inputComponent.nextEvent&&(this.hasNext=!0)},prev:function(){var e=t.findIndex(c,this.inputComponent),i=c[e-1];i&&(r.a.$emit("numberInputBlur"),i.setFocus(),this.openKeyboard({inputComponent:i}))},next:function(){var e=t.findIndex(c,this.inputComponent),i=c[e+1];i?(r.a.$emit("numberInputBlur"),i.setFocus(),this.openKeyboard({inputComponent:i})):this.inputComponent&&this.inputComponent.nextEvent&&this.inputComponent.nextEvent()},setTure:function(){this.$emit("keyboardAssign",1)},setFalse:function(){this.$emit("keyboardAssign",0)},setKeysStatus:function(t,e){t=h(t)?t.toString():"",h(t)||e.indexOf("positive")>=0?this.isDisabledMinus=!0:this.isDisabledMinus=!1,!/\d/.test(t)||t.indexOf(".")>=0||e.indexOf("int")>=0?this.isDisabledPoint=!0:this.isDisabledPoint=!1},setKeyActiving:function(t,e){t&&t.classList.contains("keys")&&!t.classList.contains("disabled")&&(e?t.classList.add("activing"):t.classList.remove("activing"))},keyTouchstart:function(t){var e=t&&t.target;if(e){+new Date,n=e,this.setKeyActiving(e,!0);var i=e.getAttribute("direct");"closeKeyboard"!==i&&this.clickHandler(i)}},keyTouchend:function(t){var e=t&&t.target;if(e){this.setKeyActiving(e,!1),this.setKeyActiving(n,!1);var i=e.getAttribute("direct");"delete"===i?clearTimeout(a):"closeKeyboard"===i&&this.clickHandler(i)}},clickHandler:function(t){t&&(isNaN(t)||(t=Number(t)),"function"==typeof this[t]?this[t]():d.includes(t)&&this.input(t))}}}}).call(this,i("391c"))},"8eeb":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .drop-down-group[data-v-17dcf4d4]{display:flex;flex-direction:row}.zjapp .drop-down-group .select-con[data-v-17dcf4d4]{flex:1;border:none;background-image:linear-gradient(0deg,#d7e0f7,#d7e0f7 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}.zjapp .drop-down-group .select-con[data-v-17dcf4d4]:not(:last-child){border:none;background-image:linear-gradient(270deg,#d7e0f7,#d7e0f7 50%,transparent 0),linear-gradient(0deg,#d7e0f7,#d7e0f7 50%,transparent 0);background-size:1px 100%,100% 1px;background-repeat:no-repeat;background-position:100% 0,bottom}",""])},"8fd9":function(t,e,i){"use strict";(function(t){i("5ab2"),i("e10e"),i("6d57");var a=i("28f8"),n=(i("cc57"),i("ed63"),i("8cf2"),i("e697"),i("774b")),s=i("07d2"),o=i("a805"),r=i("6948"),l=i("e68e"),c=i("cd05"),d=i("3c64"),h=i("da1c"),p=i("e2a7"),u=i("a37e"),f=i("b6da"),m=i("7798"),g=i("0159"),v=i("6bf2"),b=i.n(v),x=i("5a71"),y=i("bcc7"),w=i("a500"),k=i("a18c"),_=i("f7e2"),C=i("94e5");function P(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}e.a={name:"MeasureDetailTemplate2",components:{Scroller:n.a,item:s.a,MeasureDetailPlaceCheckitem:o.a,NumberInput:r.a,ItemImgList:l.a,UserSelect:c.a,ItemTextarea:d.a,ProblemDetailHeader:h.a,SingleSelect:x.a,MeasureCarbonDialog:C.a},mixins:[_.a],props:{detail:{type:Object,default:function(){}}},data:function(){return console.log(this.detail,"detaildetail"),{model:u.a,carbonShow:!1,carbonData:0,carbonSelectData:{}}},computed:{hasProblemDataClose:function(){return t.some(this.detail.problemData,(function(t){return!t.isOpen}))},masterCheckitem:function(){return this.$store.state.measure.detailMasterCheckitem},hasMasterCheckitem:function(){return this.masterCheckitem&&this.masterCheckitem.length},hasCarbonDialog:function(){return this.detail.problemData.filter((function(t){return 9===t.passrate_mode})).length}},beforeMount:function(){},methods:{getAreaData:function(e){var i=[];return t.each(e,(function(e){t.find(i,{name:e.area})||i.push({name:e.area})})),i},formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm";return b()(t).format(e)},contains:function(e,i){return t.includes(e,i)},pointFilter:function(e,i){return t.filter(e,i)},hasPoints:function(e,i){var a=this.model.hasVal,n=this.pointFilter(e,i);return t.filter(n,(function(t){return a(t.val)}))},areaNameEdit:function(t,e){this.$set(t,"isEditing",!0),this.$set(t,"nameTemp",t.name);var i=e.target.nextSibling.querySelector("input");return this.$forceUpdate(),setTimeout((function(){document.body.contains(i)&&i.focus()}),100),!1},areaNameUpdate:function(e,i){var a=!1;if(e&&i){var n=e.name.trim(),s=e.nameTemp.trim();if(s===n)return this.$set(e,"isEditing",!1),void this.$forceUpdate();var o=t.some(i.areaData,(function(t){return t.name===s}));""===s||null==s?(this.$set(e,"isEditing",!1),a=!0):o&&(p.a.alert(s+"已存在"),a=!0),a?e.name=n:(e.name=s,t.each(i.problemData,(function(e){var i=t.find(e.areaData,{name:n}),a=t.filter(e.realityVal,{area:n});i&&(i.name=s),t.each(a,(function(t){t.area=s}))})),this.$set(e,"isEditing",!1),this.saveProblem(i))}},areaNumChange:function(e){u.a.setAreaDataByNum(e),u.a.setDetailPointsByArea(e),t.each(e.problemData,(function(t){u.a.pointsHandle(t),u.a.problemHandle(t)})),this.saveProblem(e),this.$forceUpdate()},areaPointNumChange:function(e,i,a){var n=t.map(e.problemData,(function(e){return t.find(e.areaData,(function(t){return t.name===a.name}))}));return t.some(n,(function(t){return 0!==t.pointNum}))?12===i.passrate_mode&&(a.pointNum>6||a.pointNum<2)?p.a.alert("标高差算法每个测区实测值个数为 2~6"):16===i.passrate_mode&&(a.pointNum>99||1===a.pointNum)?(a.pointNum=t.filter(i.realityVal,{area:a.name}).length,p.a.alert("每个测区点数应该是 2~99 的整数")):(u.a.setProblemPointsByArea(i),u.a.pointsHandle(i),u.a.problemHandle(i),void this.saveProblem()):(a.pointNum=t.filter(i.realityVal,{area:a.name}).length,void p.a.alert("一个测区不能所有检查项的点数为0"))},realityValUpdate:function(t){this.update(t),this.saveProblem()},setValUpdate:function(t){this.update(t),this.saveProblem()},saveInputSetVal:function(e,i){t.includes([5,6,14],e.passrate_mode)?(u.a.prevSetVal[e.checkItem.id]={},t.each(e.measure_item,(function(a){var n=t.find(e.realityVal,{area:i.name,label:a}).setVal;u.a.prevSetVal[e.checkItem.id]["val-"+a]=n}))):u.a.prevSetVal[e.checkItem.id]={val:i.setVal}},autoInputSetVal:function(e,i){var a=this,n=u.a.prevSetVal[e.checkItem.id],s=t.includes([3,4,5,6,10,11,14,15,17,18],e.passrate_mode),o=t.some(e.realityVal,(function(t){return t.area===i.name&&!a.model.hasVal(t.setVal)}));s&&o&&n&&!t.isEmpty(n)&&(t.includes([5,6,14,15],e.passrate_mode)?t.each(e.measure_item,(function(s){var o=n["val-"+s],r=t.find(e.realityVal,{area:i.name,label:s});a.model.hasVal(o)&&(r.setVal=o)})):this.model.hasVal(n.val)&&(i.setVal=n.val))},update:function(t){u.a.setValSpread(t),u.a.pointsHandle(t),u.a.problemHandle(t),this.$forceUpdate()},changeMode:function(t){var e=this;this.isProblemExists().then((function(){p.a.confirm("今天24:00前可修改，是否现在修改？",{okText:"修改"}).then((function(i){i&&(e.detail.mode=t,e.detail.needRepair=!1,e.$refs.scroller.scrollTop=0)}))}))},markHuxing:function(e,i){var a=this,n=[];i&&""!==i.x&&void 0!==i.x&&null!==i.x&&(n=[i]),f.a.openPopup({mode:"mark",url:e.drawing_file[0]?e.drawing_file[0].url:"",points:n,onmark:function(n){i.x=n.x,i.y=n.y,t.each(e.problemData,(function(t){u.a.pointsHandle(t)})),a.saveProblem(e),a.$forceUpdate()}})},viewHuxing:function(){var e=this,i=[],n=[];if(t.isEmpty(this.detail.drawing_file))p.a.alert("PC端未设置户型图");else{t.each(this.detail.problemData,(function(a){i=i.concat(t.filter(t.clone(a.realityVal),(function(t){if(e.model.hasVal(t.x)&&e.model.hasVal(t.y))return e.detail.problemData.length>1&&(t.itemName=a.checkItem.item_name?a.checkItem.item_name:a.checkItem.name),!0})))})),t.isEmpty(this.detail.areaData)||t.each(this.detail.areaData,(function(e){var a=t.filter(t.clone(i),{area:e.name});n=n.concat(a)}));var s=[];t.each(this.detail.problemData,(function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?P(Object(i),!0).forEach((function(e){Object(a.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):P(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},t.checkItem);e.passrate_mode=t.passrate_mode,s.push(e)})),g.a.openPopup({mode:"view",url:this.detail.drawing_file[0]?this.detail.drawing_file[0].url:"",points:n,areaData:this.detail.areaData||[],itemData:s})}},toggleProblemData:function(t){this.detail.problemData.length>1&&this.$set(t,"isOpen",!t.isOpen)},toggleProblemDataAll:function(){var e=this,i=this.hasProblemDataClose;t.each(this.detail.problemData,(function(t){e.$set(t,"isOpen",!!i)}))},isProblemExists:function(){var t=this.detail;return m.a.isProblemExists(t.id).then((function(t){if(!t)return p.a.alert("数据有更新"),k.a.go(-1),Promise.reject({mgs:"问题不存在",code:-1})}))},beforeSelectRepair:function(){var t=this.detail,e=Promise.resolve(!0);return"view"===t.mode&&(e=this.isProblemExists()),e},onSelectRepair:function(){var t=this;if("reedit"!==this.detail.mode&&"待整改"===this.detail.status)return m.a.changeRepair(this.detail).then((function(){return t.reloadDetail()})).then((function(){t.$forceUpdate()}))},setNeedRepair:function(){var e=this,i=this.detail,a=this.model.place,n=this.masterCheckitem[0],s=Promise.resolve();if(i.needRepair=!i.needRepair,!t.isObject(i.repair.__ob__)){var o=t.clone(i.repair);delete i.repair,this.$set(this.detail,"repair",o)}(i.needRepair&&t.isEmpty(i.repair)||!i.repair.id)&&(s=y.a.getBidSectionCheckItemInfo(i.proj_id,a.section.id,n.id,"实测实量").then((function(t){var e=t.repair[0]||{};Object.assign(i.repair,e)})).then((function(){w.a.addTrack("实测实量-通知整改")}))),s.then((function(){e.$forceUpdate()})).then((function(){e.beforeSelectRepair()}))},checkSubmitData:function(){var e=this,i=this.detail,a=t.some(i.problemData,(function(a){var n,s=!1,o="";if(12!==a.passrate_mode&&5!==a.passrate_mode)s=t.some(a.realityVal,(function(t){return!t.isFict&&!e.model.hasVal(t.val)}));else if(12===a.passrate_mode){var r=t.groupBy(a.realityVal||[],"area");o=t.some(r,(function(i){return t.filter(i,(function(t){return e.model.hasVal(t.val)})).length<2}))?"每个测区至少填两个值":""}else if(5===a.passrate_mode){var l=e.model.completeInput(a.realityVal),c=l.hasEmptyArea;if(s=l.incompleted,n=l.emptySetVal,c)return p.a.alert("宽度、高度至少需完整录入其中一个"),!0;if(s||n)return p.a.alert("请录全所有实测值和设计值"),!0}var d=t.some(a.areaData,(function(e){var i=t.filter(a.realityVal,{area:e.name,isExceed:!0}),n=t.filter(a.realityVal,{area:e.name,isExceed:!0,hasMark:!0});return!!i.length&&!n.length}));n=t.includes([3,4,6,10,11,14,15,16,17,18],a.passrate_mode)&&t.some(a.realityVal,(function(t){return!e.model.hasVal(t.setVal)}));var h,u,f="";if(t.isEmpty(a.realityVal))return p.a.alert("每个检查项至少一个测点"),!0;if(s)return p.a.alert("请填写全部实测值"),!0;if(n)return p.a.alert("请填写全部设计值"),!0;if(o)return p.a.alert(a.checkItem.name+o),!0;if(!t.isEmpty(i.drawing_file)&&d&&!i.optionalJicha)return p.a.alert("每个测区每个检查项至少1个爆点标点位"),!0;if(9===a.passrate_mode){if(h=t.filter(a.intensityOutcome,{intensity:"low"}),u=t.filter(a.intensityOutcome,{intensity:"high"}),!e.model.hasVal(a.intensitySetVal))return p.a.alert("请输入强度设计值"),!0;if(h.length||u.length)return f=h.reduce((function(t,e){return t+"".concat(e.area,"的平均值小于").concat(e.referenceMin,"，")}),"")+u.reduce((function(t,e){return t+"".concat(e.area,"的平均值大于").concat(e.referenceMax,"，")}),""),f+="无法计算",p.a.alert(f),!0}})),n=t.find(i.problemData,(function(e){return t.isEmpty(e.contractor)}));return!a&&n?(p.a.alert("请选择施工单位"),!1):!a},setRepair:function(){var e=this,i=t.clone(this.detail);if(!t.isEmpty(i.repair)&&i.repair.id)return m.a.setRepair(i).then((function(){e.reloadDetail()})).finally((function(){e.$forceUpdate()}));p.a.alert("请选择整改人")},reloadDetail:function(){var t=this;Promise.resolve().then((function(){return t.$route.query.problemId?u.a.loadDetailById(t.$route.query.problemId):u.a.loadDetailByIdentity(u.a.tabsIdentity)}))},carbonOpen:function(t,e){this.carbonShow=!0,this.carbonData=e.carbon,this.carbonSelectData={id:t.id,areaName:e.name}},carbonSelect:function(e){var i=this,a=this.carbonSelectData,n=a.id,s=a.areaName;this.detail.problemData.forEach((function(a){a.id===n&&(a.realityVal.forEach((function(t){t.area===s&&(t.carbon=e)})),a.areaData.forEach((function(t){t.name===s&&(t.carbon=e)})),i.realityValUpdate(a),console.log("碳化深度：",e,t.cloneDeep(a)))}))},carbonClose:function(){this.carbonShow=!1}}}}).call(this,i("391c"))},9120:function(t,e,i){var a=i("2ddb");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("cb55f532",a,!0,{sourceMap:!1,shadowMode:!1})},"91c1":function(t,e,i){"use strict";(function(t){i("5ab2"),i("6d57"),i("e10e"),i("9a33");var a=i("28f8"),n=i("e68e"),s=i("6f9e"),o=i("bcc7"),r=i("e89f");function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){Object(a.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}e.a={name:"CheckGuideDetailDrop",components:{ItemImgList:n.a},mixins:[r.a],data:function(){return{show:!1,showList:!1,isLoading:!1,isOpening:!1,isClosing:!1,contentTop:64,listHeight:510,module:"",itemIds:[],data:[],target:""}},watch:{show:function(t){var e=this;t&&this.$nextTick((function(){e.showList=!0}))}},created:function(){s.a.$on("routerBeforeEach",this.closePopup),s.a.$on("pageContentClick",this.onClickOther)},destroyed:function(){s.a.$off("routerBeforeEach",this.closePopup),s.a.$off("pageContentClick",this.onClickOther)},methods:{openPopup:function(e){this.show=!0,this.$emit("open"),this.module=e.module,this.itemIds=e.itemIds,this.options=e.options;var i=document.querySelector(".layout-main .layout-header");if(this.contentTop=i.offsetHeight,e.el){var a=e.el.getBoundingClientRect();this.contentTop=a.bottom}this.target=e.el,this.listHeight=t.minBy([window.innerHeight-this.contentTop-50,510]),this.getData()},closePopup:function(){var t=this;if(!this.isOpening)return this.showList=!1,this.$emit("close"),new Promise((function(e){t.$on("afterClosePopup",e)}))},afterClose:function(){this.show=!1,this.isClosing=!1,this.$emit("afterClosePopup")},onClickOther:function(t){t&&t.target&&t.target!==this.target&&this.show&&this.closePopup()},getData:function(){var e=this;return this.options&&this.options.length?(this.data=t.map(this.options,(function(t){return c(c({},t),{},{isOpen:!1})})),Promise.resolve()):o.a.getMeasureCheckItem(this.itemIds).then((function(i){e.data=t.map(i,(function(e){var i=e.content?e.content.trim():"",a=i?i.split("\n"):[],n=e.content_image?JSON.parse(e.content_image):[],s=t.filter(a,(function(t){return!/<img([\s\S]*)>/gm.test(t)}));return t.each(n,(function(t){t.url=t.url.split("@")[0]})),{id:e.id,name:e.full_name,textArr:s,contentImage:n,isOpen:!1}}))})).catch((function(t){console.error(t)}))},toggleItem:function(t){this.data.length>1&&this.$set(t,"isOpen",!t.isOpen)}}}}).call(this,i("391c"))},9446:function(t,e,i){var a=i("2dd6");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("2192cd00",a,!0,{sourceMap:!1,shadowMode:!1})},"94e5":function(t,e,i){"use strict";i("163d");var a=i("f51f"),n=i("04f3"),s={name:"MeasureCarbonDialog",props:{value:{type:Number,default:0},show:{type:Boolean,default:!1}},data:function(){return{carbonShow:this.show,carbonList:a.a.carbonConfig.list,backButtonEvent:null}},watch:{show:function(t){this.carbonShow=t,this.init()}},activated:function(){this.carbonShow=this.show},methods:{init:function(){this.backButtonEvent||(this.backButtonEvent=Object(n.a)(this.close))},select:function(t){this.$emit("select",t),this.close()},close:function(){this.$emit("close"),this.carbonShow=!1,this.backButtonEvent&&(Object(n.c)(this.backButtonEvent),this.backButtonEvent=null)}}},o=(i("dc33"),i("17cc")),r=Object(o.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-action-sheet",{staticClass:"measure-c-d",attrs:{title:"碳化深度(mm)选择","get-container":"body"},on:{close:t.close},model:{value:t.carbonShow,callback:function(e){t.carbonShow=e},expression:"carbonShow"}},[i("div",{staticClass:"mcd-content"},t._l(t.carbonList,(function(e,a){return i("div",{key:a,staticClass:"mcd-list",class:{active:e===t.value},on:{click:function(i){t.select(e)}}},[t._v("\n      "+t._s(e.toFixed(1))+"\n    ")])})))])}),[],!1,null,"d8f61210",null);e.a=r.exports},"94f0":function(t,e,i){"use strict";i("2c79")},9788:function(t,e,i){"use strict";i("9446")},"9a11":function(t,e,i){"use strict";(function(t){i("e204"),i("9dd9"),i("f548"),i("e697");var a,n,s=i("fd50"),o=i("07d2"),r=i("269c"),l=i("6f9e"),c=i("0c67"),d=i("6144"),h=i("e2a7"),p=i("e89f");e.a={name:"DropSelectCheckitemDialog",components:{Item:o.a,AppButton:r.a},mixins:[p.a],data:function(){return{show:!1,showList:!1,isOpening:!1,isClosing:!1,contentTop:64,listHeight:510,mode:"",options:[],selectedSet:[],currentSet:[],openSet:{},passrateData:{},componentUid:"",multi:!1,target:""}},computed:{allowConfirm:function(){return!t.isEmpty(this.selectedSet)}},watch:{show:function(t){var e=this;t&&this.$nextTick((function(){e.showList=!0}))},showList:function(t){var e=this;t&&this.$nextTick((function(){setTimeout((function(){if(e.$refs["list-wrap"]){var t=e.$refs["list-wrap"].querySelector(".checkitem-selected");t&&t.scrollIntoViewIfNeeded(!0)}}),400)}))}},created:function(){l.a.$on("routerBeforeEach",this.closePopup),l.a.$on("pageContentClick",this.onClickOther)},destroyed:function(){l.a.$off("routerBeforeEach",this.closePopup),l.a.$off("pageContentClick",this.onClickOther)},methods:{openPopup:function(e){var i=this;if(this.show)return e.componentUid===this.componentUid?void this.closePopup():void this.closePopup().then((function(){i.openPopup(e)}));this.componentUid=e.componentUid||"";var s=document.querySelector(".layout-main .layout-header");if(this.contentTop=s.offsetHeight,e.el){var o=e.el.getBoundingClientRect();this.contentTop=o.bottom}if(this.target=e.el,this.listHeight=t.minBy([window.innerHeight-this.contentTop-50,510]),this.options=e.options,this.processMode=e.processMode,this.mode=e.mode,this.multi=e.multi,a=e.place,n=e.callback,t.isEmpty(e.openStatus)){var r=d.a.getObject("measureReportRoomMemory")||{};this.openSet=r}else this.openSet=e.openStatus;var l=t.find(e.options,(function(i){return t.some(i.children,(function(i){return t.some(e.selected,{id:i.id})}))}));l&&this.$set(this.openSet,l.id,!0),this.getPassrateData(e.place,e.batchId,e.processMode),this.initSelectedSet(e.options,e.selected),this.show=!0,this.$emit("open")},closePopup:function(){var t=this;if(!this.isOpening)return this.showList=!1,this.$emit("close"),new Promise((function(e){t.$on("afterClosePopup",e)}))},afterClose:function(){this.show=!1,this.isClosing=!1,this.$emit("afterClosePopup")},onClickOther:function(t){t&&t.target&&t.target!==this.target&&this.show&&this.closePopup()},getPassrateData:function(e,i,a){var n=this,o=e.building?e.building.id:"",r=e.unit?e.unit.id:"",l=e.floor?e.floor.id:"",d=e.room?e.room.id:"";(1===a?c.a.getRoomAllProblems(i,d):2===a||5===a?c.a.getFloorAllProblems(i,o,r,l,a):d?c.a.getRoomAllProblems(i,d):l?c.a.getFloorAllProblems(i,o,r,l):s.a.when([])).then((function(e){var i={},a={};t.each(e,(function(t){"检查中"===t.status?i[t.item_id]="暂存":9===t.passrate_mode?i[t.item_id]=t.standard_intensity_value?(t.intensity_value/t.standard_intensity_value*100).toFixed(2)+"%":"":i[t.item_id]=t.measurement_points?((t.measurement_points-t.problem_points)/t.measurement_points*100).toFixed(2)+"%":"",t.parent_item_id&&(a[t.parent_item_id]||(a[t.parent_item_id]={pointNum:0,exceedNum:0}),a[t.parent_item_id].pointNum+=t.measurement_points||0,a[t.parent_item_id].exceedNum+=t.problem_points||0)})),t.each(a,(function(t,e){i[e]=t.pointNum?(100*(t.pointNum-t.exceedNum)/t.pointNum).toFixed(2)+"%":""})),n.passrateData=i}))},getItemInfo:function(t){var e=this.passrateData[t.id];return e||(t.process_mode===this.processMode?"":["","分户","不分单元整层","","","分单元整层"][t.process_mode])},getItemType:function(e){var i=t.some(this.currentSet,{id:e.id}),n=t.some(this.selectedSet,{id:e.id}),s="edit"===this.mode,o=!!this.passrateData[e.id],r=1===e.process_mode?"room":"floor",l=a&&a.room&&a.room.id?"room":"floor";return this.multi?!s&&i?"current":n?"selected":r===l&&(!o||o&&i)?"checkbox":!o||i||n?"blank":"arrow":i?"current":o?"arrow":"single"},initSelectedSet:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.selectedSet=[],this.currentSet=[],t.each(a,(function(a){var n;t.some(i,(function(e){return n=t.find(e.children||[],{id:a.id})}))&&(e.currentSet.push(t.clone(n)),"edit"===e.mode&&e.selectedSet.push(t.clone(n)))}))},showName:function(t){var e=t;return e=(e=e.replace(new RegExp("<","gm"),"&lt;")).replace(new RegExp(">","gm"),"&gt;")},toggleItem:function(t){var e=this.openSet[t.id];this.$set(this.openSet,t.id,!e),d.a.saveObject("measureReportRoomMemory",this.openSet)},clickItem:function(e){var i=this,n=this.getItemType(e),s=a.room&&a.room.id||"";if(s&&1!==e.process_mode||!s&&1===e.process_mode)h.a.alert(["","此项按户测量，与当前部位不符","此项按不分单元整层测量，与当前部位不符","","","此项按分单元整层测量，与当前部位不符"][e.process_mode]);else if(1===e.entry_requirements||8===e.passrate_mode||null!==e.standard_max&&""!==e.standard_max)if(this.multi){if("current"===n||"blank"===n)return;if("arrow"===n)return void this.select(e);var o=t.findIndex(this.selectedSet,{id:e.id});if(o>=0)this.selectedSet.splice(o,1);else{var r=!this.selectedSet.length||t.some(this.options,(function(a){var n=t.some(a.children,(function(t){return t.id===i.selectedSet[0].id})),s=t.some(a.children,(function(t){return t.id===e.id}));return n&&s})),l=t.isEmpty(this.selectedSet)||this.selectedSet[0].process_mode===e.process_mode,c=t.some(this.selectedSet,(function(t){return 9===t.passrate_mode}))||this.selectedSet.length&&9===e.passrate_mode;if(!r)return void h.a.alert("只能在相同的一级检查项下多选");if(!l)return void h.a.alert("只能在相同的部位划分检查项里多选");if(c)return void h.a.alert("混凝土强度不可多选检查项");this.selectedSet.push(e)}}else{if("current"===n)return;setTimeout((function(){i.select(e)}),100)}else h.a.alert("请先在PC端设置此检查项的合格标准值。")},select:function(e){t.isArray(e)||(e=[e]);var i=t.extend([],e);n&&n(i),this.closePopup()},confirm:function(){this.allowConfirm&&this.select(this.selectedSet)}}}}).call(this,i("391c"))},"9a3c":function(t,e,i){"use strict";i("ad134")},"9b25":function(t,e,i){"use strict";i("b09a")},"9c76":function(t,e,i){var a=i("9c7d");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("8dddf8da",a,!0,{sourceMap:!1,shadowMode:!1})},"9c7d":function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .measure-c-d .van-action-sheet__header[data-v-d8f61210]{color:#333}.zjapp .measure-c-d .mcd-content[data-v-d8f61210]{padding:15px;display:flex;flex-wrap:wrap;justify-content:space-between}.zjapp .measure-c-d .mcd-list[data-v-d8f61210]{width:80px;height:30px;line-height:30px;font-size:14px;border:1px solid #e5e5e5;border-radius:3px;color:#333;margin:0 0 10px 0;text-align:center;float:left}.zjapp .measure-c-d .mcd-list.active[data-v-d8f61210]{color:#4275e8;border-color:#4275e8}",""])},a093:function(t,e,i){"use strict";(function(t){i("5ab2"),i("6d57"),i("e10e"),i("f548");var a=i("28f8"),n=(i("9dd9"),i("cc57"),i("e204"),i("9eea")),s=i("3156b"),o=i("774b"),r=i("e89f"),l=i("6f9e");function c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function d(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(Object(i),!0).forEach((function(e){Object(a.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}e.a={name:"AppSingleSelect",components:{appSearchBar:n.a,item:s.a,Scroller:o.a},mixins:[r.a],props:{},data:function(){return{activeTab:[],storageKey:encodeURI(this.title||"singleSelectMark"),storageVal:[],keyword:"",searchStatus:!1,checkedItem:{},show:!1,searchData:[],options:[],optionsLimit:20,pagingOptions:!1,searchBar:!0,category:[],ifToggle:!1,editorAddData:!1,lineLimit:1}},computed:{optionsShow:function(){return this.options&&this.options.length?this.grouping?this.getGroupData():this.options.slice(0,this.optionsLimit):[]}},watch:{keyword:function(t){var e=this;this.$nextTick((function(){e.filterList(t)}))}},methods:{openPopup:function(e){if(console.log(e),this.value=!0,this.show=!0,this.category=[],l.a.$on("closeDialog",this.closePopup),this.title=e.title,this.selected=e.selected,this.checkedItem=e.selected,this.options=e.options,this.onSelect=e.onSelect,this.searchBar=e.searchBar,this.grouping=e.grouping,this.rightBtn=e.rightBtn,this.rightBtnEvent=e.rightBtnEvent,this.ifToggle=e.ifToggle,this.lineLimit=e.lineLimit,this.editorAddData=e.editorAddData,e.grouping&&e.autoOpen){var i=t.uniqBy(t.map(this.options,e.grouping));this.activeTab=t.map(i,(function(t,e){return e}))}this.storageKey=encodeURI(this.title||"singleSelectMark"),this.$emit("open")},closePopup:function(){this.value=!1,this.show=!1,this.$emit("close")},closeEvent:function(){l.a.$off("closeDialog",this.closePopup),this.value=!1,this.show=!1,this.keyword="",this.searchStatus=!1,this.$refs["app-search-bar"]&&this.$refs["app-search-bar"].cancelSearch()},customAddSupplier:function(t){return this.options.findIndex((function(e){return e.name===t}))},selectItem:function(t){var e=this;this.ifToggle&&this.checkedItem.id===t.id?this.checkedItem={}:this.checkedItem=t,this.onSelect(this.checkedItem),this.$refs["app-search-bar"]&&this.$refs["app-search-bar"].saveHistory(),window.setTimeout((function(){e.closeEvent()}),300)},onSearchTypeChange:function(t){this.searchStatus=t},filterList:function(t){var e,i,a=this,n=new RegExp("("+t+")","gmi");if(this.category=[],this.keyword=t,this.searchData=[],!t)return!1;this.options.map((function(t){return n.test(t.name)&&(i=d(d({},t),{},{rename:t.name.replace(n,"<label>$1</label>")}),a.grouping?-1===(e=a.category.indexOf(i[a.grouping]))?(a.category.push(i[a.grouping]),a.searchData.push({name:i[a.grouping],children:[i]})):a.searchData[e].children.push(i):a.searchData.push(i)),t}))},pageOptions:function(){this.optionsLimit=this.optionsLimit+20,this.pagingOptions=!1},getGroupData:function(){var t,e=this,i=[];return this.category=[],this.options.map((function(a){return-1===(t=e.category.indexOf(a[e.grouping]))?(e.category.push(a[e.grouping]),i.push({name:a[e.grouping],children:[a]})):i[t].children.push(a),a})),i}}}}).call(this,i("391c"))},a300:function(t,e,i){"use strict";(function(t){i("5ab2"),i("6d57"),i("e10e");var a=i("28f8"),n=i("e89f"),s=i("e2a7"),o=i("4360"),r=i("e223");function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}e.a={name:"DrawingDialog",store:o.a,components:{Drawing:r.a},mixins:[n.a],data:function(){return{show:!1,mode:"",url:"",points:[],folder:"",maxMarks:1/0,onmark:function(){}}},methods:{openPopup:function(t){return this.mode=t.mode,this.url=t.url,this.points=t.points,this.folder=t.folder,this.maxMarks=isNaN(t.maxMarks)?1/0:t.maxMarks,this.onmark=t.onmark,this.show=!0,this.$emit("open"),this},closePopup:function(){this.show=!1,this.$emit("close")},undo:function(){this.points.pop()},sure:function(){this.points.length?(this.closePopup(),this.onmark&&this.onmark(this.points)):s.a.alert("请先在户型图标记位置")},pointLight:function(e){this.points=t.map(this.points,(function(t,i){var n=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){Object(a.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},t);return e===i?n.color="#4275e8":n.found?n.color="#14ff56":n.color="#ff4546",n}))},onclick:function(t){var e=this;if("view"===this.mode){if(t.clickPoint&&"points"===t.clickPoint.tag){var i=t.clickPoint.index;this.pointLight(i)}}else if("mark-val-group"===this.mode){if(this.points.length>=maxMarks)return void s.a.alert("爆点个数不能大于实测点数");this.points.push({x:t.x,y:t.y})}else if("multiple-remark"===this.mode)this.points.push({x:t.x,y:t.y});else{var a={x:t.x,y:t.y};this.points=[a],setTimeout((function(){e.closePopup(),e.onmark&&e.onmark(a)}),200)}}}}}).call(this,i("391c"))},a43f:function(t,e,i){var a=i("5454");(t.exports=i("690e")(!1)).push([t.i,".zjapp .drawing-con[data-v-196e7a7d]{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:0;line-height:0}.zjapp .drawing-con canvas[data-v-196e7a7d]{background:url("+a(i("eb66"))+") #fff;background-size:4px 4px}.zjapp .loading-text[data-v-196e7a7d]{margin-top:15px;color:#aaa}.zjapp .error-text[data-v-196e7a7d],.zjapp .loading-text[data-v-196e7a7d]{padding:0 15px;line-height:20px;text-align:center;font-size:16px}.zjapp .error-text[data-v-196e7a7d]{color:#ff3d3d}",""])},a492:function(t,e,i){"use strict";(function(t){i("6d57"),i("e697"),i("cc57");var a=i("4c09"),n=i("f369"),s=i("a646"),o=i("6db4"),r=i("00f6"),l=i("a37e"),c=i("6144"),d=i("bc69"),h=i("e2a7"),p=i("7798");e.a={name:"MeasureDetail",components:{CheckGuide:n.a,MeasureDetailTemplate1:s.a,MeasureDetailTemplate2:o.a,MeasureDetailTemplate3:r.a},data:function(){return{isLoading:!0,tabs:[],currentTab:"",buildingId:"",unit:"",floor:"",roomId:"",checkitemId:"",problemId:"",place:{},identity:"",processMode:"",masterCheckitem:[],model:l.a,checkItemGuideIds:[],repairData:{},supervisionData:{},constructData:{}}},computed:{projId:function(){return t.isEmpty(l.a.place)||t.isEmpty(l.a.place.project)?"":l.a.place.project.id},detail:function(){var t;return"repair"===this.currentTab?t=this.$store.state.measure.repairData:"supervision"===this.currentTab?t=this.$store.state.measure.supervisionData:"construct"===this.currentTab&&(t=this.$store.state.measure.constructData),t},drawingUrl:function(){return this.detail&&this.detail.drawing_file&&this.detail.drawing_file[0]&&this.detail.drawing_file[0].url||""}},activated:function(){this.$router.isBack?this.reloadDetail():(this.buildingId=this.$route.query.buildingId,this.unit=this.$route.query.unit,this.floor=this.$route.query.floor,this.roomId=this.$route.query.roomId,this.checkitemId=this.$route.query.checkitemId,this.problemId=this.$route.query.problemId,this.viewIdentity=this.$route.query.viewIdentity,this.readonly=this.$route.query.readonly,this.init())},methods:{init:function(){var e=this,i=this.roomId,n=this.buildingId,s=this.unit,o=this.floor,r=this.checkitemId,c=this.problemId,d=this.viewIdentity,h=this.readonly;return this.isLoading=!0,l.a.init(i,n,s,o,r,c,d,h).then((function(i){var n;console.log("detailData =====",i),e.repairData=i.repair,e.supervisionData=i.supervision,e.constructData=i.construct,e.masterCheckitem=l.a.firstCheckitem,e.tabs=l.a.tabs,e.currentTab=e.tabs[e.tabs.length-1].key;var s=t.map(e.detail?e.detail.checkItems:[],"id"),o=e.checkItemGuideIds.length;(n=e.checkItemGuideIds).splice.apply(n,[0,o].concat(Object(a.a)(s))),e.isLoading=!1})).catch((function(t){console.error(t)}))},changeTab:function(e){var i=this,a=t.isEmpty(this.masterCheckitem)?this.checkitemId:this.masterCheckitem[1].id;this.currentTab=e.key,l.a.tabsIdentity=e.identity,l.a.loadDetailByIdentity(e.identity,[a]).then((function(t){console.log("detailData =====",t),i.repairData=t.repair,i.supervisionData=t.supervision,i.constructData=t.construct}))},changeItems:function(t,e){var i,n;(i=this.masterCheckitem).splice.apply(i,[0,2].concat(Object(a.a)(t))),this.checkitemId=t[1].id;var s=this.checkItemGuideIds.length;(n=this.checkItemGuideIds).splice.apply(n,[0,s].concat(Object(a.a)(e)))},changePlace:function(t){if(t){l.a.place=t,l.a.project=t.project;var e=t.building&&t.building.name||"",i=t.unit&&t.unit.name||"",a=t.floor&&t.floor.name||"",n=e+i+(t.room&&t.room.name||""||a);l.a.placeFullname=n}},valueChange:function(t,e){},reloadDetail:function(){var t=this;if(this.isLoading=!0,this.$route.query.problemId)return l.a.loadDetailById(this.problemId).then((function(e){console.log("detailData =====",e),t.isLoading=!1}));var e=l.a.tabsIdentity;return l.a.loadDetailByIdentity(e).then((function(e){console.log("detailData =====",e),t.isLoading=!1}))},getBaseData:function(){var e=this;return p.a.getPlaceData(this.buildingId,this.unit,this.floor,this.roomId).then((function(t){e.place=t})).then((function(){return p.a.getMeasureUserIdentity().then((function(t){e.identity=t}))})).then((function(){return p.a.getIdentityAndTabs(e.place.section.id,e.identity).then((function(i){console.log("tabs =====",i),e.viewIdentity?e.currentTab=t.find(i,{identity:e.identity}):e.currentTab=i[i.length-1],e.batchId=e.currentTab.batch.id}))})).then((function(){return p.a.getMeasureCheckitemRealProcessMode(e.buildingId,e.checkitemId).then((function(t){e.processMode=t}))}))},getDetailData:function(){var t=this;return(this.problemId?p.a.getProblemById(this.problemId):this.checkitemId?this.getBaseData().then((function(){return t.getDetailDataByBatch(t.batchId,t.checkitemId)})):Promise.reject("参数错误")).then((function(t){console.log("detailData ======",t)})).catch((function(t){console.error(t)}))},getDetailDataByBatch:function(e,i,a){var n,s=this;return e?i?(i=t.isArray(i)?i:[i],1===this.processMode?n=p.a.getRoomProblem(this.place.room.id,i,e,a):2===this.processMode?n=p.a.getFloorProblem(this.place.building.id,"",this.place.floor.id,i,e,2,a):5===this.processMode&&(n=p.a.getFloorProblem(this.place.building.id,this.place.unit.id,this.place.floor.id,i,e,5,a)),n.then((function(e){return t.isEmpty(e)?s.identity!==s.currentTab.identity||s.readonly?{status:"",mode:"",problemData:[]}:p.a.createNewDetail(i,s.currentTab.batch,s.place):e})).then((function(t){return t=p.a.fillProblemData(t,i,s.place)}))):Promise.reject("缺少参数，检查项 id"):Promise.reject("缺少参数，批次 id")},saveProblem:function(){var t=this,e=this.detail;return"reedit"===e.mode||"redo"===e.mode?Promise.resolve():p.a.save(e).then((function(e){e&&t.$set(t.detail,"id",e)})).catch((function(t){h.a.alert(t)}))},saveProblemAndTip:function(){this.saveProblem().then((function(){h.a.alert("保存成功")}))},disabledSaveTip:function(){h.a.alert("“再测一遍”功能暂不支持暂存")},saveAreaHistory:function(){var e=c.a.getObject(d.a.MEASURE_V3_CHECK_ITEMS_INIT_DATA,c.a.level.user)||{};t.each(this.detail.problemData,(function(t){e[t.checkItem.id]={areaNum:t.areaNum,areaData:t.areaData,passrate_mode:t.passrate_mode,pointNum:t.pointNum}})),c.a.saveObject(d.a.MEASURE_V3_CHECK_ITEMS_INIT_DATA,e,c.a.level.user)},checkSubmitData:function(){var t;return 1===this.detail.entry_requirements?t=this.$refs["template-1"]:2===this.detail.entry_requirements?t=this.$refs["template-2"]:3===this.detail.entry_requirements&&(t=this.$refs["template-3"]),t&&t.checkSubmitData()},submitCheck:function(){var t=this;if(this.checkSubmitData(this.detail))return 3===this.detail.entry_requirements&&(this.detail.problemData||[]).forEach((function(t){l.a.pointsHandle(t),l.a.problemHandle(t)})),p.a.submit(this.detail).then((function(){2===t.detail.entry_requirements&&t.saveAreaHistory(),t.saveSectionContractor(),t.reloadDetail()}))},resubmitCheck:function(){var t=this;if(this.checkSubmitData(this.detail))return 3===this.detail.entry_requirements&&(this.detail.problemData||[]).forEach((function(t){l.a.pointsHandle(t),l.a.problemHandle(t)})),p.a.resubmitCheck(this.detail).then((function(){2===t.detail.entry_requirements&&t.saveAreaHistory(),t.saveSectionContractor(),t.reloadDetail()}))},submitRepair:function(){var t=this;return p.a.submitRepair(this.detail).then((function(){t.reloadDetail()}))},submitRedo:function(){var t=this;if(this.checkSubmitData(this.detail))return 3===this.detail.entry_requirements&&(this.detail.problemData||[]).forEach((function(t){l.a.pointsHandle(t),l.a.problemHandle(t)})),p.a.submitRedo(this.detail).then((function(){2===t.detail.entry_requirements&&t.saveAreaHistory(),t.saveSectionContractor(),t.reloadDetail()})).catch((function(t){console.error(t)}))},saveSectionContractor:function(){var e=this.detail.place.section.id,i=c.a.getUserObject(d.a.MEASURE_SECTION_CONTRACTOR)||{},a=this.detail.problemData&&this.detail.problemData[0]&&this.detail.problemData[0].contractor;t.isEmpty(a)||(i[e]=a.id,c.a.saveUserObject(d.a.MEASURE_SECTION_CONTRACTOR,i))}}}}).call(this,i("391c"))},a5c6:function(t,e,i){"use strict";var a=i("329b"),n=i("a093").a,s=(i("f3d7"),i("17cc")),o=Object(s.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"slide-right"}},[t.show?i("page-content",{attrs:{title:t.title,mode:"dialog","on-close":t.closeEvent}},[t.rightBtn&&!t.editorAddData||t.rightBtn&&t.editorAddData&&(!t.selected.name||t.customAddSupplier(t.selected.name)>-1)?i("div",{staticClass:"header-btn",attrs:{slot:"header-bar-right"},on:{click:function(e){t.rightBtnEvent(t.category)}},slot:"header-bar-right"},[t._v("\n      "+t._s(t.rightBtn)+"\n    ")]):t._e(),i("scroller",{attrs:{"has-next":!t.searchStatus&&!t.grouping&&t.optionsLimit<t.options.length,"end-text":"","is-empty":0===t.optionsShow.length},on:{loadNext:t.pageOptions}},[t.searchBar?i("app-search-bar",{ref:"app-search-bar",attrs:{placeholder:"搜索","history-key":t.storageKey},on:{changeSearchStatus:t.onSearchTypeChange},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}):t._e(),t.searchStatus?[t.keyword?[t.grouping?i("van-collapse",{model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},t._l(t.searchData,(function(e,a){return i("van-collapse-item",{key:a,attrs:{title:e.name,name:a}},t._l(e.children,(function(e,a){return i("item",{key:a,attrs:{checked:t.checkedItem.id===e.id,item:e,"line-limit":t.lineLimit,"render-field":"rename"},on:{click:t.selectItem}})})))}))):t._e(),t.grouping&&!t.searchData.length?i("loading-status",{attrs:{"is-empty":!0,"empty-text":"没有内容","show-style":"search"}}):t._e(),t.grouping?t._e():[t._l(t.searchData,(function(e,a){return i("item",{key:a,attrs:{checked:t.checkedItem.id===e.id,item:e,"line-limit":t.lineLimit,"render-field":"rename"},on:{click:t.selectItem}})})),t.searchData.length?t._e():i("loading-status",{attrs:{"is-empty":!0,"empty-text":"没有内容","show-style":"search"}})]]:t._e()]:["-1"===t.selected.id&&t.customAddSupplier(t.selected.name)<0&&t.editorAddData?i("div",{staticClass:"supplier-editor",on:{click:t.closePopup}},[i("span",{staticClass:"title"},[t._v(t._s(t.selected.name))]),i("span",{staticClass:"icon"},[i("i",{staticClass:"iconfont icon-edit margin-r",on:{click:t.rightBtnEvent}}),i("i",{staticClass:"iconfont icon-qualified"})])]):t._e(),t.grouping?i("van-collapse",{model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},t._l(t.optionsShow,(function(e,a){return i("van-collapse-item",{key:a,attrs:{title:e.name,name:a}},t._l(e.children,(function(e,a){return i("item",{key:a,attrs:{checked:t.checkedItem.id===e.id,item:e,"line-limit":t.lineLimit},on:{click:t.selectItem}})})))}))):t._l(t.optionsShow,(function(e,a){return i("item",{key:a,attrs:{checked:t.checkedItem.id===e.id,item:e,"line-limit":t.lineLimit},on:{click:t.selectItem}})})),t.optionsShow.length?t._e():i("loading-status",{attrs:{"is-empty":!0,"empty-text":"暂无数据","show-style":"search"}})]],2)],1):t._e()],1)}),[],!1,null,"e465319c",null).exports,r=!1;r||(r=new(a.default.extend(o))({el:document.createElement("div")}),document.body.appendChild(r.$el));e.a=r},a646:function(t,e,i){"use strict";var a=i("4e83").a,n=(i("12f4"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("scroller",{ref:"scroller"},[i("measure-detail-place-checkitem",{attrs:{detail:t.detail},on:{changeItems:t.changeItems,changePlace:t.changePlace}}),t.hasMasterCheckitem?["edit"===t.detail.mode||"reedit"===t.detail.mode||"redo"===t.detail.mode?[t._l(t.detail.problemData,(function(e,a){return i("div",{key:a,staticClass:"pt10 bg-white"},[i("item",{attrs:{label:"实测点数",mode:"edit",border:"none"}},[i("template",{slot:"right"},[i("number-input",{attrs:{type:"int positive",range:[1,999]},on:{blur:function(i){t.pointNumChange(e)}},model:{value:e.pointNum,callback:function(i){t.$set(e,"pointNum",i)},expression:"problem.pointNum"}}),i("div",{staticClass:"item-text pl5"},[t._v("个")])],1)],2),i("item",{attrs:{label:"爆点数值",mode:"edit",border:"none"}},[t.drawingUrl?i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[e.realityVal.length?i("div",{staticClass:"item-font"},[t._l(e.realityVal,(function(e,i){return[i?[t._v(",")]:t._e(),t._v(t._s(e.val)+"\n              ")]}))],2):t._e(),i("div",{staticClass:"item-font color-blue",on:{click:function(i){t.markExceedVal(e)}}},[t._v("\n              在户型图标记\n            ")])]):i("div",{staticClass:"item-con",staticStyle:{"margin-right":"-10px"},attrs:{slot:"right"},slot:"right"},[t._l(e.realityVal,(function(a,n){return i("number-input",{key:n,ref:"exceed-point-input",refInFor:!0,staticClass:"mr10 mb10",attrs:{decimal:t.$store.state.measure.valueDecimal,range:t.$store.state.measure.valueRange,"next-event":function(){return t.addExceedVal(e)}},on:{blur:function(i){t.updatedExceedVal(e)}},model:{value:a.val,callback:function(e){t.$set(a,"val",e)},expression:"point.val"}},[n===e.realityVal.length-1?i("i",{staticClass:"icon-minus",attrs:{slot:"extend"},on:{click:function(i){i.stopPropagation(),t.removeExceedVal(e)}},slot:"extend"}):t._e()])})),e.realityVal.length<e.pointNum?i("i",{staticClass:"icon-plus",on:{click:function(i){i.stopPropagation(),t.addExceedVal(e)}}}):t._e()],2)])],1)})),t.inputComplete?i("item",[i("div",{staticClass:"item-font"},[t._v("合格率")]),i("div",{staticClass:"item-text color-theme pl5"},[t._l(t.detail.problemData,(function(e,i){return[i?[t._v(",")]:t._e(),t._v(t._s(t._f("percent")(e.passrate,2))+"\n          ")]}))],2),"edit"===t.detail.mode?i("div",{staticClass:"item-con align-r"},[i("div",{staticClass:"need-repair",on:{click:t.setNeedRepair}},[i("icon",{attrs:{name:t.detail.needRepair?"checkbox-square-checked":"checkbox-square"}}),t._v("通知整改\n          ")],1)]):t._e()]):t._e(),t.inputComplete&&t.detail.needRepair?i("user-select",{attrs:{title:"整改人",border:"top",options:t.model.repairOptions,memory:!0},on:{onSelect:t.onSelectRepair},model:{value:t.detail.repair,callback:function(e){t.$set(t.detail,"repair",e)},expression:"detail.repair"}}):t._e()]:t._e(),"edit"===t.detail.mode||"redo"===t.detail.mode?[i("item",{staticClass:"p15 mt10"},[i("item-img-list",{attrs:{"track-text":"实测实量",maxlength:50},on:{callback:t.saveProblem},model:{value:t.detail.img,callback:function(e){t.$set(t.detail,"img",e)},expression:"detail.img"}})],1),i("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"补充说明"},on:{blur:t.saveProblem},model:{value:t.detail.remark,callback:function(e){t.$set(t.detail,"remark",e)},expression:"detail.remark"}})]:t._e(),"edit"===t.detail.mode||"redo"===t.detail.mode||"reedit"===t.detail.mode?[i("p",{staticClass:"c-label mb10"},[t._v("请选择施工单位")]),t._l(t.detail.problemData,(function(e){return i("single-select",{key:e.checkItem.id,attrs:{title:e.checkItem.name,"page-title":"选择施工单位",placeholder:"请选择施工单位",options:t.model.contractors,mode:"edit"===t.detail.mode||"redo"===t.detail.mode?"edit":"view"},on:{onSelect:t.saveProblem},model:{value:e.contractor,callback:function(i){t.$set(e,"contractor",i)},expression:"problem.contractor"}})}))]:t._e(),"edit"===t.detail.mode||"redo"===t.detail.mode?i("user-select",{attrs:{title:"抄送人",multi:!0,options:t.model.ccOptions,required:!1,memory:!0},on:{onSelect:t.changeCC},model:{value:t.detail.cc,callback:function(e){t.$set(t.detail,"cc",e)},expression:"detail.cc"}}):t._e(),"view"===t.detail.mode?[i("problem-detail-header",{staticClass:"bg-white pr0",attrs:{status:t.detail.status}}),i("item",{attrs:{label:"标段",text:t.detail.place.section.name+"（"+t.detail.place.project.name+"）"}}),t._l(t.detail.problemData,(function(e,a){return i("div",{key:a},[i("item",{attrs:{label:"实测点",text:e.pointNum}}),i("item",{attrs:{label:"合格率"}},[i("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[t._v("\n            "+t._s(t._f("percent")(e.passrate,2))+"\n            "),t.drawingUrl?i("span",{staticClass:"color-theme ml15",on:{click:t.viewHuxing}},[t._v("\n              "+t._s(e.roomtype_type||"户型图")+"\n            ")]):t._e()])]),e.realityVal.length?i("item",{attrs:{label:"爆点数值"}},[i("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[t._l(e.realityVal,(function(e,i){return[i?[t._v(",")]:t._e(),t._v(t._s(e.val)+"\n            ")]}))],2)]):t._e()],1)})),t.detail.allowReedit&&"view"===t.detail.mode||t.drawingUrl&&t.detail.problemData.length>1?i("item",{staticClass:"pt0 pb0",attrs:{label:""}},[i("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},[t.detail.allowReedit&&"view"===t.detail.mode?i("span",{staticClass:"btn-modify",on:{click:function(e){t.changeMode("reedit")}}},[t._v("\n            修改数值\n            "),i("icon",{attrs:{name:"arrow-right"}})],1):t._e(),t.drawingUrl&&t.detail.problemData.length>1?i("span",{staticClass:"btn-modify",on:{click:t.viewHuxing}},[t._v("\n            "+t._s(t.detail.roomtype_type)+"\n            "),i("icon",{attrs:{name:"arrow-right"}})],1):t._e()])]):t._e(),t.detail.remark||t.detail.img.length?i("item",{attrs:{label:"补充说明"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[t.detail.remark?i("div",{staticClass:"item-font"},[t._v("\n            "+t._s(t.detail.remark)+"\n          ")]):t._e(),i("item-img-list",{attrs:{editabled:!1},model:{value:t.detail.img,callback:function(e){t.$set(t.detail,"img",e)},expression:"detail.img"}})],1)]):t._e(),i("user-select",{attrs:{title:"检查人",mode:"view",date:t.formatDate(t.detail.regist_date),editabled:!1},model:{value:t.detail.regist,callback:function(e){t.$set(t.detail,"regist",e)},expression:"detail.regist"}}),(t.detail.repair_remark||t.detail.repair_image_file&&t.detail.repair_image_file.length)&&"待整改"!==t.detail.status?i("item",{attrs:{label:"整改照片"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[t.detail.repair_remark?i("div",{staticClass:"item-font"},[t._v(t._s(t.detail.repair_remark))]):t._e(),i("item-img-list",{attrs:{editabled:!1,"track-text":"实测实量"},model:{value:t.detail.repair_image_file,callback:function(e){t.$set(t.detail,"repair_image_file",e)},expression:"detail.repair_image_file"}})],1)]):t._e(),!t.detail.repair.id||"待整改"!==t.detail.status&&"已整改"!==t.detail.status?t._e():i("user-select",{attrs:{title:"整改人",mode:"view",options:t.model.repairOptions,date:"已整改"===t.detail.status?t.formatDate(t.detail.repair_date):"",editabled:(t.detail.isChecker||t.detail.isRepair)&&"待整改"===t.detail.status,"before-select":t.beforeSelectRepair},on:{onSelect:t.onSelectRepair},model:{value:t.detail.repair,callback:function(e){t.$set(t.detail,"repair",e)},expression:"detail.repair"}}),t.detail.isRepair&&"待整改"===t.detail.status?i("item",{attrs:{label:"整改照片"}},[i("div",{staticClass:"item-con",attrs:{slot:"right"},slot:"right"},[i("item-img-list",{attrs:{maxlength:50,"track-text":"实测实量"},model:{value:t.detail.repair_image_file,callback:function(e){t.$set(t.detail,"repair_image_file",e)},expression:"detail.repair_image_file"}})],1)]):t._e(),t.detail.isRepair&&"待整改"===t.detail.status?i("item-textarea",{staticClass:"border-tb",attrs:{placeholder:"补充说明"},model:{value:t.detail.repair_remark,callback:function(e){t.$set(t.detail,"repair_remark",e)},expression:"detail.repair_remark"}}):t._e(),t.hasContractor?i("item",{attrs:{label:"施工单位"}},[i("div",{staticClass:"item-text",attrs:{slot:"right"},slot:"right"},t._l(t.detail.problemData,(function(e){return i("p",{key:e.id},[t._v("\n            "+t._s(e.contractor?e.contractor.name:"")+"\n          ")])})))]):t._e(),i("user-select",{attrs:{title:"抄送人",mode:"view",multi:!0,options:t.model.ccOptions,editabled:"已整改"!==t.detail.status},on:{onSelect:t.changeCC},model:{value:t.detail.cc,callback:function(e){t.$set(t.detail,"cc",e)},expression:"detail.cc"}})]:t._e(),"检查完毕"===t.detail.status&&"view"===t.detail.mode?[i("div",{staticClass:"need-repair-bottom",on:{click:t.setNeedRepair}},[i("icon",{attrs:{name:t.detail.needRepair?"checkbox-square-checked":"checkbox-square"}}),t._v("通知整改\n      ")],1),t.detail.needRepair?i("user-select",{attrs:{title:"整改人",options:t.model.repairOptions,memory:!0},model:{value:t.detail.repair,callback:function(e){t.$set(t.detail,"repair",e)},expression:"detail.repair"}}):t._e(),t.detail.needRepair?i("app-button-group",{staticClass:"pt10"},[i("app-button",{attrs:{name:"通知整改"},on:{click:t.setRepair}})],1):t._e()]:t._e(),t.detail.id&&"检查中"===t.detail.status?i("app-button-group",[i("app-button",{attrs:{type:"text",name:"删除此草稿"},on:{click:t.delProblem}})],1):t._e(),"检查中"===t.detail.status||"view"!==t.detail.mode||t.allowMeasureReinspect||t.model.currentUserBatchId!==t.detail.batch_id?t._e():i("app-button-group",[i("app-button",{attrs:{type:"operate",name:"再测一次"},on:{click:t.setRedo}})],1)]:t._e(),i("loading-status",{attrs:{"is-loading":!1,"is-empty":!t.hasMasterCheckitem,"empty-text":"请选择检查项"}})],2)}),[],!1,null,"78eb219e",null);e.a=s.exports},a805:function(t,e,i){"use strict";var a=i("8004").a,n=(i("4381"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"drop-down-group bg-sub-theme border-bottom"},[i("drop-select-place",{attrs:{value:t.place,editabled:t.editabled},on:{onSelect:t.onChangePlace}}),i("drop-select-checkitem",{ref:"drop-select-checkitem",attrs:{value:t.checkitems,"master-checkitem":t.masterCheckitem,options:t.checkitemOptions,place:t.place,"batch-id":t.batchId,"process-mode":t.processMode,mode:t.mode,multi:t.multi,editabled:t.editabled,"is-loading":t.checkitemSelectLoading},on:{onSelect:t.onChangeCheckitem}})],1)}),[],!1,null,"17dcf4d4",null);e.a=s.exports},a876:function(t,e,i){"use strict";i("8bcc")},ad134:function(t,e,i){var a=i("8968");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("9e97926a",a,!0,{sourceMap:!1,shadowMode:!1})},af92:function(t,e,i){var a=i("d0c4");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("495ea63a",a,!0,{sourceMap:!1,shadowMode:!1})},afd5:function(t,e,i){"use strict";var a=i("329b"),n=i("9a11").a,s=(i("83d9"),i("17cc")),o=Object(s.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{staticClass:"content",style:{top:t.contentTop+"px"},on:{click:function(e){return e.target!==e.currentTarget?null:t.closePopup(e)}}},[i("transition",{attrs:{name:"slide-down"},on:{enter:function(e){t.isOpening=!0},"after-enter":function(e){t.isOpening=!1},leave:function(e){t.isClosing=!0},"after-leave":t.afterClose}},[t.showList?i("div",{staticClass:"box",style:{height:t.listHeight+"px"}},[i("item",{staticClass:"item-hd"},[i("div",{staticClass:"item-text name-parent"}),i("div",{staticClass:"item-info"},[t._v("合格率")]),i("i",{staticClass:"icon-empty"})]),t.options.length?i("div",{ref:"list-wrap",staticClass:"list-wrap"},[t._l(t.options,(function(e,a){return[i("item",{key:a,attrs:{border:"bottom"},on:{click:function(i){t.toggleItem(e)}}},[i("i",{staticClass:"item-triangle",class:{"triangle-right":!t.openSet[e.id],"triangle-down":t.openSet[e.id]}}),i("div",{staticClass:"item-text name-parent"},[t._v(t._s(e.name))]),i("div",{staticClass:"item-info"},[t._v(t._s(t.passrateData[e.id]))]),i("i",{staticClass:"icon-empty"})]),e.children&&e.children.length&&t.openSet[e.id]?t._l(e.children,(function(e,n){return i("item",{key:"sub -"+a+"-"+n,class:{"checkitem-selected":"selected"===t.getItemType(e)||"current"===t.getItemType(e)},attrs:{border:"bottom"},on:{click:function(i){t.clickItem(e)}}},[i("div",{staticClass:"item-text name-child"},[t._v(t._s(e.name))]),i("div",{staticClass:"item-info",class:{"color-orange":"暂存"===t.getItemInfo(e)}},[t._v("\n                "+t._s(t.getItemInfo(e))+"\n              ")]),i("div",{staticClass:"item-icon"},["blank"===t.getItemType(e)||"single"===t.getItemType(e)?i("icon",{attrs:{name:""}}):t._e(),"arrow"===t.getItemType(e)?i("icon",{attrs:{name:"arrow-right"}}):t._e(),"current"===t.getItemType(e)?i("icon",{attrs:{name:"qualified"}}):t._e(),"checkbox"===t.getItemType(e)?i("icon",{attrs:{name:"checkbox"}}):t._e(),"selected"===t.getItemType(e)?i("icon",{attrs:{name:"checkbox-checked"}}):t._e()],1)])})):t._e()]}))],2):t._e(),i("app-button",{directives:[{name:"show",rawName:"v-show",value:t.multi,expression:"multi"}],staticClass:"btn-confirm",class:{"btn-disabled":!t.allowConfirm},attrs:{name:"确定"},on:{click:t.confirm}}),t.options.length?t._e():i("loading-status",{attrs:{"is-empty":!0,type:"search","empty-text":"未搜索到相关内容"}})],1):t._e()])],1):t._e()}),[],!1,null,"4d9aa552",null).exports,r=!1;r||(r=new(a.default.extend(o))({el:document.createElement("div")}),document.body.appendChild(r.$el));e.a=r},b09a:function(t,e,i){var a=i("2939");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("65170d73",a,!0,{sourceMap:!1,shadowMode:!1})},b55a:function(t,e,i){"use strict";i("c001")},b6da:function(t,e,i){"use strict";var a=i("329b"),n=i("a300").a,s=i("17cc"),o=Object(s.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"slide-right"}},[t.show?i("page-content",{attrs:{mode:"dialog",title:"户型图","on-close":t.closePopup}},[i("drawing",{staticStyle:{flex:"1"},attrs:{url:t.url,points:t.points,folder:t.folder},on:{onclick:t.onclick}}),"multiple-remark"===t.mode?i("app-button-group",{attrs:{"fixed-bottom":"",seamless:""}},[i("app-button",{staticStyle:{width:"50%"},attrs:{type:t.points.length?"warning":"normal",plain:""},on:{click:t.undo}},[t._v("\n        撤销\n      ")]),i("app-button",{on:{click:t.sure}},[t._v(" 确定 ")])],1):t._e()],1):t._e()],1)}),[],!1,null,null,null).exports,r=!1;r||(r=new(a.default.extend(o))({el:document.createElement("div")}),document.body.appendChild(r.$el));e.a=r},bebe:function(t,e,i){var a=i("6272");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("53478790",a,!0,{sourceMap:!1,shadowMode:!1})},c001:function(t,e,i){var a=i("f53a");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("bd5eb062",a,!0,{sourceMap:!1,shadowMode:!1})},c070:function(t,e,i){var a=i("574c");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("35590dcb",a,!0,{sourceMap:!1,shadowMode:!1})},c36f:function(t,e,i){var a=i("5454");(t.exports=i("690e")(!1)).push([t.i,".zjapp .drawing-con[data-v-32c61736]{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:0;line-height:0}.zjapp .drawing-con canvas[data-v-32c61736]{background:url("+a(i("eb66"))+") #fff;background-size:4px 4px}.zjapp .loading-text[data-v-32c61736]{margin-top:15px;color:#aaa}.zjapp .error-text[data-v-32c61736],.zjapp .loading-text[data-v-32c61736]{padding:0 15px;line-height:20px;text-align:center;font-size:16px}.zjapp .error-text[data-v-32c61736]{color:#ff3d3d}",""])},c40a:function(t,e,i){"use strict";(function(t){i("cc57"),i("6d57"),i("6f84"),i("163d");var a=i("a32d"),n=i.n(a),s=i("e900"),o=i("3122"),r=i("4ad6"),l=i("3bd5"),c=i("1b7e");function d(t){var e=t.changedTouches.length,i=t.touches.length;return 1===e||2===e||2===i}function h(t){return 1===t.touches.length}e.a={name:"Drawing",props:{url:{type:String},points:{type:Array,default:function(){return[]}},regions:{type:Array,default:function(){return[]}},pointColor:{type:String,default:"#ff4546"},pointRadius:{type:Number,default:7},scaleMax:{type:Number,default:4},clickDelay:{type:Number,default:500},folder:{type:String,default:"house-image"},onlineMode:{type:Boolean,default:!1},contentScroll:{type:Boolean,default:!0}},data:function(){return{isDownloading:!1,error:"",canvas:null,ctx:null,img:null,src:"",width:0,height:0,x:0,y:0,scale:1,defaultScale:1,pixelRatio:1,markPosition:null,markPositionImageData:[],markCoordinates:[],pinchRatio:0,scaleBetween:[],isPinch:!1,clickPoints:[],touchStart:{x:0,y:0,cx:0,cy:0,time:0}}},watch:{url:function(){this.getImage()},points:function(t){this.ctx&&this.draw()},regions:function(t){this.ctx&&this.draw()}},mounted:function(){this.getImage()},destroyed:function(){this.canvas&&(this.canvas.width=0,this.canvas.height=0)},methods:{getImage:function(){var e=this;if(this.isDownloading=!0,this.url){var i=l.a.getUser().user_id,a=n.a.replaceAll(this.url,"\\?x-oss-process=image\\/resize,","@"),s=n.a.strRightBack(a,"/");if(!s)return this.error="户型图地址错误",void(this.isDownloading=!1);this.error="";var d=[r.a.appImagePath()+i+"/"+this.folder+"/"+s,r.a.appImagePath()+i+"/house-image/"+s,r.a.appImagePath()+i+"/drawing/"+s,r.a.appImagePath()+i+"/location-image/"+s,r.a.appImagePath()+i+"/images/"+s,r.a.appDataPath()+i+"/"+this.folder+"/"+s,r.a.appDataPath()+i+"/house-image/"+s,r.a.appDataPath()+i+"/drawing/"+s,r.a.appDataPath()+i+"/location-image/"+s,r.a.appDataPath()+i+"/images/"+s],h=Promise.resolve();return"dev"===APP_ENV||this.onlineMode?h=h.then((function(){return e.url})):t.each(d,(function(t){h=h.then((function(e){return e||r.a.isFileExists(t).then((function(e){if(e)return o.a._fixPath(t)}))}))})),h.then((function(t){if(!t)return c.a.getHasNetwork().then((function(t){return t?o.a.download(e.url,!0,e.folder).then((function(t){e.src=t})):Promise.reject("当前无网络")}));e.src=t})).then((function(){e.src?(e.img=new Image,e.img.onload=function(){e.img.complete?(e.isDownloading=!1,e.$nextTick(e.init)):(e.error="加载图片失败",e.isDownloading=!1)},e.img.onerror=function(){e.error="加载图片失败",e.isDownloading=!1},e.img.src=e.src):(e.error="下载户型图失败",e.isDownloading=!1)})).catch((function(i){e.error=t.isString(i)?i:"下载户型图失败",e.isDownloading=!1}))}this.error="户型图地址错误",this.isDownloading=!1},init:function(){if(this.$refs["drawing-canvas"]){var t=this.$refs.content;this.canvas=this.$refs["drawing-canvas"],this.ctx=this.canvas.getContext("2d"),this.width=t.offsetWidth,this.height=t.offsetHeight,this.pixelRatio=this.getPixelRatio(this.ctx),this.canvas.style.height=this.height+"px",this.canvas.style.width=this.width+"px",this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,!this.ctx.extended&&Object(s.a)(this.ctx),this.bindTouchEvent(),this.calc(),this.draw()}},getPixelRatio:function(t){var e=t.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},calc:function(t){var e=this.width/this.img.width,i=this.img.height*e,a=this.height||i;i>this.height&&(e*=a/i),this.scale=e*this.pixelRatio,this.defaultScale=this.scale,this.scaleBetween=[this.scale,this.scale*this.scaleMax]},winToCanvas:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:t-i.left*(this.canvas.width/(i.width*this.pixelRatio)),y:e-i.top*(this.canvas.height/(i.height*this.pixelRatio))}},isBoundary:function(t){switch(t){case"t":if(0===this.y)return!0;break;case"r":if(this.x<=this.canvas.width-this.img.width*this.scale)return!0;break;case"b":if(this.y<=this.img.height*this.scaleBetween[0]-this.img.height*this.scale)return!0;break;case"l":if(0===this.x)return!0}return!1},bindTouchEvent:function(){this.canvas.addEventListener("touchstart",this.onTouchstart),this.canvas.addEventListener("touchmove",this.onTouchmove),this.canvas.addEventListener("touchend",this.touchMoveAndEndHandler)},unbindTouchEvent:function(){this.canvas.removeEventListener("touchstart",this.onTouchstart),this.canvas.removeEventListener("touchmove",this.onTouchmove),this.canvas.removeEventListener("touchend",this.touchMoveAndEndHandler)},onTouchstart:function(t){if(this.isPinch=!1,h(t)){var e=t.touches[0],i=this.winToCanvas(e.clientX,e.clientY);this.touchStart={x:i.x,y:i.y,cx:e.clientX,cy:e.clientY,time:Date.now()}}else if(d(t)){var a,n=t.touches[0],s=t.touches[1],o=this.winToCanvas(n.clientX,n.clientY),r=this.winToCanvas(s.clientX,s.clientY);a=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)),this.pinchRatio=this.scale/a}},onTouchmove:function(t){if(!1===this.contentScroll&&(t.preventDefault(),t.stopPropagation()),h(t))this.touchStart.cy>t.pageY&&this.isBoundary("b")||this.touchStart.cy<t.pageY&&this.isBoundary("t")||this.touchStart.cx>t.pageX&&this.isBoundary("r")||this.touchStart.cx<t.pageX&&this.isBoundary("l")||t.stopPropagation(),this.touchMoveAndEndHandler(t);else if(d(t)){t.stopPropagation();var e,i,a,n,s,o=t.touches[0],r=t.touches[1],l=this.winToCanvas(o.clientX,o.clientY),c=this.winToCanvas(r.clientX,r.clientY);i=Math.sqrt(Math.pow(c.x-l.x,2)+Math.pow(c.y-l.y,2)),this.isPinch=!0,(e=this.pinchRatio*i)>this.scaleBetween[0]&&e<this.scaleBetween[1]&&(n={x:((a={x:(l.x+c.x)/2*this.pixelRatio,y:(l.y+c.y)/2*this.pixelRatio}).x-this.x)/(this.img.width*this.scale),y:(a.y-this.y)/(this.img.height*this.scale)},a.newX=this.x+this.img.width*e*n.x,a.newY=this.y+this.img.height*e*n.y,s={x:a.newX-a.x,y:a.newY-a.y},e<this.scale&&this.setRange(this.x-s.x,this.y-s.y,e),e>this.scale&&(this.x=this.x-s.x,this.y=this.y-s.y),e!==this.scale&&(this.scale=e,this.draw()))}},touchMoveAndEndHandler:function(t){var e,i,a=t.type,n={touchmove:t.touches[0],touchend:t.changedTouches[0]}[a],s=this.winToCanvas(n.clientX,n.clientY);e=(s.x-this.touchStart.x)*this.pixelRatio,i=(s.y-this.touchStart.y)*this.pixelRatio,"touchend"===a&&Date.now()-this.touchStart.time<this.clickDelay&&Math.abs(n.clientX-this.touchStart.cx)<6&&Math.abs(n.clientY-this.touchStart.cy)<6?this.clickHandler(t):"touchmove"!==a||this.isPinch||(this.touchStart.x=s.x,this.touchStart.y=s.y,this.setRange(this.x+e,this.y+i,this.scale),this.draw())},isCanClick:function(t){for(var e=!1,i=0;i<this.markPosition.length;i++)if(parseFloat(t.x)>parseFloat(this.markPosition[i].x)&&parseFloat(t.x)<parseFloat(this.markPosition[i].x)+parseFloat(this.markPosition[i].w)&&parseFloat(t.y)>parseFloat(this.markPosition[i].y)&&parseFloat(t.y)<parseFloat(this.markPosition[i].y)+parseFloat(this.markPosition[i].h)){e=!0;break}return e},clickHandler:function(t){var e=t.changedTouches[0];if(this.mark){var i=this.winToCanvas(e.clientX,e.clientY),a={x:(i.x-this.x/this.pixelRatio)/(this.img.width*this.scale/this.pixelRatio),y:(i.y-this.y/this.pixelRatio)/(this.img.height*this.scale/this.pixelRatio)};if(i={x:a.x*this.img.width,y:a.y*this.img.height},this.isCanClick(i)){this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i.x*this.scale/this.pixelRatio+this.x/this.pixelRatio,i.y*this.scale/this.pixelRatio+this.y/this.pixelRatio,this.scale===this.defaultScale?this.pointRadius:this.pointRadius*(1+(this.scale-this.defaultScale)/this.pixelRatio),0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore();var n={x:i.x,y:i.y};this.markCoordinates.push(n),this.points.push(n)}return!1}this.redraw(t,this.winToCanvas(e.clientX,e.clientY))},setRange:function(t,e,i){var a=this.img.width*i,n=this.img.height*i,s=this.canvas.width,o=this.canvas.height,r=this.img.height*this.scaleBetween[0];t=a<s?(s-a)/2:(t=t+a<s?s-a:t)>0?0:t,e=n<o?(o-n)/2:(e=e+n<r?r-n:e)>0?0:e,this.x=t,this.y=e},draw:function(){this.setRange(this.x,this.y,this.scale),this.drawImage(),this.drawPoints(),this.drawRegions()},redraw:function(t,e){this.clickPoints=[],this.drawImage(),this.drawPoints(e),this.drawRegions(e),this.clickCallback(t,this.clickPoints)},clickCallback:function(t,e){var i;e.some((function(t,e){return"points"===t.tag?(i=t,!0):(i=t,!1)}));var a=t.changedTouches[0],n=this.winToCanvas(a.clientX,a.clientY),s=(n.x-this.x/this.pixelRatio)/(this.img.width*this.scale/this.pixelRatio),o=(n.y-this.y/this.pixelRatio)/(this.img.height*this.scale/this.pixelRatio);(n={x:parseFloat((s*this.img.width).toFixed(2)),y:parseFloat((o*this.img.height).toFixed(2))}).y>=0&&n.x>=0&&n.y<=this.img.height&&n.x<=this.img.width&&this.$emit("onclick",{type:i?"point":"",points:this.points,point:i,clickPoint:i,x:n.x,y:n.y,scale:this.scale/this.pixelRatio})},drawImage:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,0,0,this.img.width,this.img.height,this.x,this.y,this.img.width*this.scale,this.img.height*this.scale)},drawPoints:function(t){var e=this;this.points.forEach((function(i,a){e.drawPoint(i.x*e.scale/e.pixelRatio+e.x/e.pixelRatio,i.y*e.scale/e.pixelRatio+e.y/e.pixelRatio,e.pointRadius,a,t,i.color)}))},drawPoint:function(t,e,i,a,n,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.shadowBlur=i/2,this.ctx.shadowColor="black",this.ctx.fillStyle=s||this.pointColor,this.ctx.arc(t,e,i,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.shadowColor="transparent",this.ctx.restore(),i*=2,this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="transparent",this.ctx.fillStyle="transparent",this.ctx.rect(t-i,e-i,2*i,2*i),this.ctx.stroke(),this.ctx.restore(),n&&this.ctx.isPointInPath(n.x*this.pixelRatio,n.y*this.pixelRatio)&&this.clickPoints.push({tag:"points",pos:n,index:a})},drawRegions:function(t){var e=this;this.regions&&this.regions.length&&this.regions.forEach((function(i,a){var n,s,o,r;e.ctx.beginPath(),i.area.forEach((function(t,i){var a=t[0]*e.scale/e.pixelRatio+e.x/e.pixelRatio,l=t[1]*e.scale/e.pixelRatio+e.y/e.pixelRatio;i?e.ctx.lineTo(a,l):e.ctx.moveTo(a,l),n=void 0===n?a:n<a?n:a,s=void 0===s?a:s>a?s:a,o=void 0===o?l:o<l?o:l,r=void 0===r?l:r>l?r:l})),e.ctx.closePath(),e.ctx.fillStyle="rgba(255, 144, 0, 0.4)",e.ctx.fill(),e.ctx.lineWidth=3,e.ctx.strokeStyle="#feda8e",e.ctx.stroke(),e.ctx.lineWidth=2,e.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",e.ctx.stroke(),t&&e.ctx.isPointInPath(t.x*e.pixelRatio,t.y*e.pixelRatio)&&e.clickPoints.push({tag:"region",pos:t,index:a,regionData:i}),e.ctx.font='18px bold -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',e.ctx.textAlign="center",e.ctx.lineWidth=4,e.ctx.strokeStyle="#ffffff",e.ctx.strokeText(i.name,(s+n)/2,(r+o)/2+10),e.ctx.fillStyle="#111111",e.ctx.fillText(i.name,(s+n)/2,(r+o)/2+10)}))}}}}).call(this,i("391c"))},d0c4:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .content[data-v-4d9aa552]{position:fixed;width:100%;bottom:0;background-color:rgba(0,0,0,.4);overflow:hidden}.zjapp .box[data-v-4d9aa552]{display:flex;flex-direction:column;background-color:#fff}.zjapp .list-wrap[data-v-4d9aa552]{flex:1;background-color:#fff;height:465px;overflow:auto;scroll-behavior:smooth}.zjapp .item[data-v-4d9aa552]{padding:3px 15px 3px 28px;align-items:center}.zjapp .item-info[data-v-4d9aa552]{width:80px;text-align:center;font-size:10px;color:#999}.zjapp .item .item-icon[data-v-4d9aa552]{width:44px;height:34px;line-height:34px;text-align:right;font-size:14px}.zjapp .item .icon-arrow-right[data-v-4d9aa552]{color:#c8c8c8}.zjapp .item .icon-checkbox[data-v-4d9aa552],.zjapp .item .icon-checkbox-checked[data-v-4d9aa552]{vertical-align:top;margin-top:7.5px}.zjapp .item .icon-qualified[data-v-4d9aa552]{color:#4275e8}.zjapp .icon-empty[data-v-4d9aa552]{width:44px}.zjapp .item-hd[data-v-4d9aa552]{padding:8px 15px 0 15px}.zjapp .item-hd .item-info[data-v-4d9aa552]{width:48px;margin:0 16px;height:16px;line-height:16px;color:#999;border-radius:8px;background-image:#f4f4f4}.zjapp .name-parent[data-v-4d9aa552]{font-size:16px;font-weight:700;color:#111}.zjapp .name-child[data-v-4d9aa552]{font-size:14px;color:#333}.zjapp .item-triangle[data-v-4d9aa552]{position:absolute;width:0;height:0;border:5px solid #c8c8c8}.zjapp .triangle-right[data-v-4d9aa552]{border-color:transparent transparent transparent #c8c8c8;left:10px;top:15px}.zjapp .triangle-down[data-v-4d9aa552]{border-color:#c8c8c8 transparent transparent transparent;left:10px;top:17.5px}.zjapp .btn-confirm[data-v-4d9aa552]{background-color:#ebf1ff;background-image:none;color:#4275e8;border-radius:0}.zjapp .btn-confirm.btn-disabled[data-v-4d9aa552]{background-color:#f4f4f4;color:#b2b2b2}",""])},d0fb:function(t,e,i){"use strict";(function(t){var a=i("fd50"),n=i("bcc7"),s=i("515e"),o=i("e89f"),r=i("07d2"),l=i("7bac"),c=i("a7c3"),d=i("4360");e.a={name:"CheckGuideList",components:{Item:r.a},mixins:[o.a],store:d.a,props:{data:{type:String,default:""}},data:function(){return{show:!1,isLoading:!0,listData:[],module:"",itemId:"",batchId:"",sectionId:"",options:""}},computed:{moduleAttribute:function(){return this.$store.state.global.moduleAttribute}},mounted:function(){this.data=[]},methods:{openPopup:function(e){var i,n=this;for(var s in this.value=!0,this.show=!0,this.module=e.module,this.itemId=e.itemId,this.batchId=e.batchId,this.sectionId=e.sectionId,this.options=e.options,this.$emit("open"),e)this[s]=e[s];this.checkType={check:31,"check-safety":36,"check-quality":37,"measure-v3":41,process:32,"fly-inspect":101}[this.module];var o=!1;t.isEmpty(this.itemId)?!t.isEmpty(this.checkType)&&t.isEmpty(this.sectionId)?i=this.initByType():t.isEmpty(this.batchId)?t.isEmpty(this.options)?t.isEmpty(this.sectionId)?i=a.a.when():(o=!0,i=this.initByBidsection()):i=this.initByOptions():i=this.initByBatch():i=this.initById(),this.isLoading=!0,i.then((function(e){var i=n.moduleAttribute[n.module]||{};!t.isEmpty(i)&&i.setUsualItems&&o?l.a.getUserKey(n.mmkvCode()).then((function(t){t=null===t?e:n.mergeArray(n.deepClone(e),t),n.listData=t||[],n.isLoading=!1})):(n.listData=e||[],n.isLoading=!1)}))},mmkvCode:function(){var t=this.moduleAttribute[this.module]||{};return c.a[t.mmkv_item]+"_"+this.sectionId},mergeArray:function(e,i){var a=this;return t.filter(e,(function(e){var n=i[e.id];return t.isEmpty(e.subitem)||(e.subitem=a.mergeArray(e.subitem,i)),!t.isEmpty(n)||"desc"===e.type}))},closePopup:function(){this.value=!1,this.show=!1,this.$emit("close")},clickItem:function(t){t.subitem&&t.subitem.length?this.$set(t,"isOpen",!t.isOpen):"special-inspect"===this.module?s.a.openPopup({itemId:t.id,module:this.module}):s.a.openPopup({itemId:t.item_id,module:this.module})},initById:function(){var t=this;if("special-inspect"!==this.module)return n.a.getCheckItem(this.itemId,this.checkType).then((function(e){return e?t.sectionId?n.a.getBidSectionCheckItemListByCode(t.sectionId,e.code):n.a.getCheckItemTreeByCode(e.code):a.a.when()}))},initByType:function(){return n.a.getCheckItemGuidelineList(this.checkType)},initByBatch:function(){return a.a.when()},initByBidsection:function(){return n.a.getBidSectionCheckItemTreeByType(this.sectionId,this.checkType)},initByOptions:function(){return a.a.resolve(this.options)},deepClone:function(t){return JSON.parse(JSON.stringify(t))}}}}).call(this,i("391c"))},d871:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .select-con[data-v-dbd87ef2]{position:relative;padding:7px 40px 7px 15px;height:50px;overflow:hidden}.zjapp .select-con[data-v-dbd87ef2]:not(:first-child){border:none;background-image:linear-gradient(90deg,#d7e0f7,#d7e0f7 50%,transparent 0);background-size:1px 100%;background-repeat:no-repeat;background-position:0 0}.zjapp .select-con>*[data-v-dbd87ef2]{pointer-events:none}.zjapp .select-hd[data-v-dbd87ef2]{line-height:14px;font-size:10px}.zjapp .select-bd[data-v-dbd87ef2],.zjapp .select-hd[data-v-dbd87ef2]{color:#333;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.zjapp .select-bd[data-v-dbd87ef2]{margin-top:2px;line-height:20px;font-size:14px}.zjapp .select-arrow[data-v-dbd87ef2]{position:absolute;top:5px;right:0;width:40px;height:40px;line-height:40px;font-size:16px;color:#c8c8c8;text-align:center}.zjapp .select-disabled[data-v-dbd87ef2]{background-color:#f5f7fb}.zjapp .select-disabled .select-bd[data-v-dbd87ef2],.zjapp .select-disabled .select-hd[data-v-dbd87ef2]{color:#666}.zjapp .select-disabled .select-arrow[data-v-dbd87ef2]{display:none}",""])},da1c:function(t,e,i){"use strict";i("163d");var a=i("65a8"),n={name:"ProblemHeader",props:{status:{type:String,default:""},statusText:{type:String,default:""},level:{type:String,default:""},isTimeout:{type:Boolean,default:!1},sentBackTimes:{type:[Number,String],default:0}},data:function(){return{edOptions:{}}},created:function(){var t=this;a.a.getOptions("紧急程度").then((function(e){t.edOptions=e}))}},s=(i("1f63"),i("17cc")),o=Object(s.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",t._g({staticClass:"problem-detail-header border-bottom"},t.$listeners),[i("div",{staticClass:"status",class:{"待整改":"status-red","不合格":"status-red","已退回":"status-red","待复验":"status-orange","已放水待验收":"status-orange","检查中":"status-orange","待验收":"status-orange","已通过":"status-green","已整改":"status-green","已提交":"status-green","合格":"status-green","检查完毕":"status-green","已验收":"status-green","已关闭":"status-black","进度正常":"status-green","进度滞后":"status-red","验收中":"status-orange","已抽验":"status-green"}[t.status]},[t._v(t._s(t.statusText||t.status))]),"紧急"===t.level||"特急"===t.level?i("span",{staticClass:"urgent"},[t._v(t._s(t.edOptions[t.level]))]):t._e(),t.isTimeout?i("span",{staticClass:"timeout"},[t._v("超时")]):t._e(),t.sentBackTimes>0?i("span",{staticClass:"return"},[t._v("退回"+t._s(t.sentBackTimes)+"次")]):t._e(),t._t("operat")],2)}),[],!1,null,"0901aadd",null);e.a=o.exports},dc33:function(t,e,i){"use strict";i("9c76")},dc98:function(t,e,i){"use strict";i("0732")},e223:function(t,e,i){"use strict";var a=i("c40a").a,n=(i("0aac"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",t._g({ref:"content",staticClass:"drawing-con"},t.$listeners),[t.isDownloading?[i("p",[i("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[i("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]),i("p",{staticClass:"loading-text"},[t._v("正在下载...")])]:[t.error?t._e():i("canvas",{ref:"drawing-canvas"}),t.error?i("p",{staticClass:"error-text"},[t._v(t._s(t.error))]):t._e()]],2)}),[],!1,null,"fba5990a",null);e.a=s.exports},e2a8:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,'.zjapp .status-total-bar[data-v-be07cd9c]{display:flex;flex-direction:row;text-align:center}.zjapp .total-item[data-v-be07cd9c]{flex:1;line-height:20px;padding:10px 5px 0;color:#111;font-size:12px}.zjapp .total-status[data-v-be07cd9c]{white-space:nowrap}.zjapp .total-status[data-v-be07cd9c]:before{content:"";width:10px;height:10px;display:inline-block;vertical-align:top;margin:5px 5px 0 0;background-color:#ddd;border-radius:50%}.zjapp .total-status-orange[data-v-be07cd9c]:before{background-color:#fc8b01}.zjapp .total-status-orange2[data-v-be07cd9c]:before{background-color:#ff8e24}.zjapp .total-status-white2[data-v-be07cd9c]:before{background-color:#fff;border:1px solid #dcdcdc}.zjapp .total-status-red[data-v-be07cd9c]:before{background-color:#ff3d3d}.zjapp .total-status-green[data-v-be07cd9c]:before{background-color:#0bc666}.zjapp .total-status-white[data-v-be07cd9c]:before{background-color:#fff}.zjapp .total-status-white-border[data-v-be07cd9c]:before{background-color:#fff;border:1px solid #dcdcdc}.zjapp .total-status-blue[data-v-be07cd9c]:before{background-color:#4174e9}.zjapp .total-status-purple-border[data-v-be07cd9c]:before{background-color:#fff;border:1px solid #796bfb}.zjapp .total-status-green-border[data-v-be07cd9c]:before{background-color:#fff;border:1px solid #0bc666}.zjapp .status-total-bar.-abs-top-right[data-v-be07cd9c]{position:absolute;top:0;right:13px}.zjapp .status-total-bar.-abs-top-right .total-item[data-v-be07cd9c]{padding-left:3px;padding-right:3px}.zjapp .status-total-bar.-abs-top-right .total-status[data-v-be07cd9c]:before{margin-right:2px}',""])},e2dd:function(t,e,i){"use strict";(function(t){i("e697");var a=i("774b"),n=i("07d2"),s=i("a805"),o=i("da1c"),r=i("f546"),l=i("0771"),c=i("e68e"),d=i("3c64"),h=i("cd05"),p=i("4ce9"),u=i("e2a7"),f=i("a37e"),m=i("7798"),g=i("6bf2"),v=i.n(g),b=i("5a71"),x=i("bcc7"),y=i("a500"),w=i("a18c"),k=i("f7e2");e.a={name:"MeasureDetailTemplate3",components:{Scroller:a.a,item:n.a,MeasureDetailPlaceCheckitem:s.a,ProblemDetailHeader:o.a,StatusTotalBar:r.a,Drawing3:l.a,ItemImgList:c.a,ItemTextarea:d.a,UserSelect:h.a,SingleSelect:b.a,drawingMeasure:p.a},mixins:[k.a],props:{detail:{type:Object,default:function(){}}},data:function(){return{model:f.a}},computed:{masterCheckitem:function(){return this.$store.state.measure.detailMasterCheckitem},hasMasterCheckitem:function(){return this.masterCheckitem&&this.masterCheckitem.length},totalData:function(){var t=this.detail.pointsTotal||{};return[{status:"待整改",color:"red",total:t.repair},{status:"待复验",color:"orange",total:t.reinspect},{status:"已通过",color:"green",total:t.pass},{status:"非正常关闭",color:"gray",total:t.close}]},drawingData:function(){var e=[];return t.each(this.detail.problemData,(function(t){e.push({checkitem:t.checkItem,passrateMode:t.passrate_mode,points:t.realityVal})})),console.log("drawingData =========",e),e}},methods:{formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm";return v()(t).format(e)},changeMode:function(e){var i=this;this.isProblemExists().then((function(){u.a.confirm("今天24:00前可修改，是否现在修改？",{okText:"修改"}).then((function(a){a&&(i.detail.mode=e,i.detail.needRepair=!1,window.setTimeout((function(){i.detail.id===i.$store.state.measure.repairData.id?i.$store.commit("measure/SET_REPAIR_DATA",t.clone(i.detail)):i.detail.id===i.$store.state.measure.supervisionData.id?i.$store.commit("measure/SET_SUPERVISION_DATA",t.clone(i.detail)):i.detail.id===i.$store.state.measure.constructData.id&&i.$store.commit("measure/SET_CONSTRUCT_DATA",t.clone(i.detail)),i.$refs.scroller.scrollTop=0}),30))}))}))},setNeedRepair:function(){var e=this,i=this.detail,a=this.model.place,n=this.masterCheckitem[0],s=Promise.resolve();this.$set(this.detail,"needRepair",!this.detail.needRepair),i.needRepair&&((i.needRepair&&t.isEmpty(i.repair)||!i.repair.id)&&(s=x.a.getBidSectionCheckItemInfo(i.proj_id,a.section.id,n.id,"实测实量").then((function(t){var i=t.repair[0]||{};e.$set(e.detail,"repair",i)})).then((function(){y.a.addTrack("实测实量-通知整改")}))),s.then((function(){e.beforeSelectRepair()})))},isProblemExists:function(){var t=this.detail;return m.a.isProblemExists(t.id).then((function(t){if(!t)return u.a.alert("数据有更新"),w.a.go(-1),Promise.reject({mgs:"问题不存在",code:-1})}))},beforeSelectRepair:function(e){var i=this,a=this.detail,n=Promise.resolve(!0);return e=e||this.detail.repair,"view"===a.mode&&(n=this.isProblemExists()),n.then((function(){if((a.isRepairMode||i.allowMeasureReinspect)&&t.some(a.reinspect,{id:e.id}))return u.a.alert("整改人与复验人不能相同"),Promise.reject("整改人与复验人不能相同")})).catch((function(t){$log.error(t)})),n},onSelectRepair:function(){var t=this,e=this.detail;if("reedit"!==e.mode&&"待整改"===e.status)return m.a.changeRepair(e).then((function(){return t.reloadDetail()})).then((function(){t.$forceUpdate()}))},beforeConfirmReinspect:function(e){if(!t.isEmpty(this.detail.repair)&&t.some(e,{id:this.detail.repair.id}))return u.a.alert("复验人与整改人不能相同"),!1},onSelectReinspect:function(){return m.a.changeReinspect(this.detail).then((function(){}))},onClickPoint:function(t){this.$router.push({name:"MeasurePointDetail",params:{id:t.pointId}})},checkSubmitData:function(){var e=this;this.$refs.drawing.inputBlur();var i=this,a=i.detail,n=i.model.hasVal,s=a.problemData.length>1,o=t.unzip(t.map(a.problemData,(function(e){return t.map(e.realityVal,(function(t){return t.val}))}))),r=t.some(a.problemData,(function(i){return!t.some(i.realityVal,(function(t){return e.model.hasVal(t.val)}))})),l=[],c=[],d=[],h=[],p=t.some(a.problemData,(function(t){return!t.realityVal||!t.realityVal.length})),f=!1,m=!1,g=!0;if(t.each(a.problemData,(function(e){if(!1===g)return!1;var i;if(5===e.passrate_mode){if(t.each(e.realityVal,(function(e,a,s){var o=t.find(s,(function(t){return e!==t&&t.area===e.area&&t.label===e.label}));!n(e.val)&&n(o.val)||n(e.val)&&!n(o.val)?(l.push(e),m=!0):(i=t.filter(s,(function(t){return t.area===e.area})),t.find(i,(function(t){return n(t.val)}))||(l.push(e),f=!0));!n(e.setVal)&&n(e.val)&&n(o.val)&&(c.push(e),m=!0),h[a]||(h[a]=[]),h[a].push(e)})),5===e.passrate_mode){if(f)return u.a.alert("宽度、高度至少需完整录入其中一个"),g=!1,!1;if(m)return u.a.alert("请录全实测值和设计值"),g=!1,!1}}else t.each(e.realityVal,(function(t,i){n(t.val)||l.push(t),3!==e.passrate_mode&&6!==e.passrate_mode&&14!==e.passrate_mode&&15!==e.passrate_mode&&16!==e.passrate_mode&&17!==e.passrate_mode||n(t.setVal)||c.push(t),h[i]||(h[i]=[]),h[i].push(t)}))})),!1===g)return g;if(t.each(h,(function(e){!t.some(e,(function(t){return i.model.hasVal(t.val)}))&&(d=d.concat(e))})),!s&&l.length)return t.each(l,(function(t){t.isWarning=!0})),i.$refs.drawing.update(a),u.a.alert("请填写所有的实测值"),!1;if(!s&&c.length)return t.each(c,(function(t){t.isWarning=!0})),i.$refs.drawing.update(a),u.a.alert("请填写所有的设计值"),!1;if(s&&r&&o.length)return u.a.alert("每个检查项至少录一个点"),!1;if(p)return u.a.alert("请点击户型图录入测量数据"),!1;s&&d.length&&(t.each(d,(function(t){t.isWarning=!0})),this.$refs.drawing.update(a));var v=t.isEmpty(a.repair)||!a.repair.id;if((a.needRepair||"待整改"===a.status)&&v)return u.a.alert("请选择整改人"),!1;if((a.needRepair||"待整改"===a.status&&a.isRepairMode)&&this.allowMeasureReinspect){if(t.isEmpty(a.reinspect))return u.a.alert("请选择复验人"),!1;if(t.some(a.reinspect,{id:a.repair.id}))return u.a.alert("整改人与复验人不能相同"),!1}return!t.find(a.problemData,(function(e){return t.isEmpty(e.contractor)}))||(u.a.alert("请选择施工单位"),!1)},setRepair:function(){var e=this,i=t.clone(this.detail);if(!t.isEmpty(i.repair)&&i.repair.id){if(this.allowMeasureReinspect){if(t.isEmpty(i.reinspect))return void u.a.alert("请选择复验人");if(t.some(i.reinspect,{id:i.repair.id}))return void u.a.alert("整改人与复验人不能相同")}return m.a.setRepair(i).then((function(){e.reloadDetail()}))}u.a.alert("请选择整改人")},reloadDetail:function(){var t=this;Promise.resolve().then((function(){return t.$route.query.problemId?f.a.loadDetailById(t.$route.query.problemId):f.a.loadDetailByIdentity(f.a.tabsIdentity)}))},onDrawingChange:function(t){console.log("onDrawingChange ---------",t)}}}}).call(this,i("391c"))},e3df:function(t,e,i){"use strict";i("f5e2")},e900:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return n}));i("f548");function a(t){var e,i,a,n=(i=(e=t).backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,(window.devicePixelRatio||1)/i);1!==n&&(!function(t,e){for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)}({fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all"},(function(e,i){var a;t[i]=(a=t[i],function(){var t,i,s=Array.prototype.slice.call(arguments);if("all"===e)s=s.map((function(t){return t*n}));else if(Array.isArray(e))for(t=0,i=e.length;t<i;t++)s[e[t]]*=n;return a.apply(this,s)})})),t.stroke=(a=t.stroke,function(){this.lineWidth*=n,a.apply(this,arguments),this.lineWidth/=n}),t.fillText=function(t){return function(){var e=Array.prototype.slice.call(arguments);e[1]*=n,e[2]*=n,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,e,i){return e*n+i})),t.apply(this,e),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,e,i){return e/n+i}))}}(t.fillText),t.strokeText=function(t){return function(){var e=Array.prototype.slice.call(arguments);e[1]*=n,e[2]*=n,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,e,i){return e*n+i})),t.apply(this,e),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,e,i){return e/n+i}))}}(t.strokeText),t.extended=!0)}var n=function(t){var e,i;(e=t).getContext=(i=e.getContext,function(t){var e,n,s=i.call(this,t);return"2d"===t&&(e=s.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1,(n=(window.devicePixelRatio||1)/e)>1&&(this.style.height=this.height+"px",this.style.width=this.width+"px",this.width*=n,this.height*=n)),a(s),s})}},e94b:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .need-repair[data-v-5c6caac0]{height:46px;line-height:18px;padding:14px 15px;margin-top:10px;font-size:16px;color:#666}.zjapp .need-repair .icon[data-v-5c6caac0]{display:inline-block;vertical-align:top;margin-right:7px}.zjapp .c-label[data-v-5c6caac0]{color:#999;font-size:12px;line-height:17px;padding:14px 15px 8px;background-color:#f4f4f4}.zjapp .btn-reedit[data-v-5c6caac0]{width:80px;padding:12px 0;line-height:22px;font-size:14px;text-align:center;color:#4275e8}.zjapp .btn-reedit .icon[data-v-5c6caac0]{margin-top:5px;font-size:12px;vertical-align:top}.zjapp .item-text_special[data-v-5c6caac0]{line-height:23px;display:inherit}",""])},f1e4:function(t,e,i){"use strict";(function(t){i("5ab2"),i("e10e");var a=i("28f8"),n=(i("9e76"),i("6d57"),i("9a33"),i("f548"),i("cc57"),i("4ad6")),s=i("e89f"),o=i("bcc7"),r=i("3122"),l=i("6e1b"),c=i("c130"),d=i("0636");function h(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(Object(i),!0).forEach((function(e){Object(a.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}e.a={name:"CheckGuideDetail",components:{},mixins:[s.a],data:function(){return{show:!1,isLoading:!0,isImageDownloading:!1,title:"",content:[],module:"",itemId:""}},methods:{openPopup:function(e){var i=this;for(var a in this.value=!0,this.show=!0,this.module=e.module,this.itemId=e.itemId,this.$emit("open"),e)this[a]=e[a];this.checkType={check:31,"check-safety":36,"check-quality":37,"measure-v3":41,process:32,"fly-inspect":101}[this.module],this.isLoading=!0,("special-inspect"===this.module?l.a.getSpecialInspectCheckItemDetail(this.itemId):"templet-plan"===this.module?c.a.getTempletDetail(this.itemId):"material"===this.module?d.a.getMaterialDetail(this.itemId):o.a.getCheckItem(this.itemId,this.checkType)).then((function(e){console.log("checkitemData",e),i.checkitemData=e,i.title=e.full_name||e.name,"special-inspect"!==i.module&&"inspect"!==i.module&&"fly-inspect"!==i.module&&"material"!==i.module||(e.content=e.guideline||e.content);var a=e.content?e.content.trim():"";if(a=(a=(a=(a=(a=a.replace(/<\/p><p>/gm,"\n")).replace(/<p>/gm,"")).replace(/<\/p>/gm,"")).replace(/<br>/gm,"")).replace(/<br \/>/gm,""),/(<img[^\>]*>)/gm.test(a)){var n=a.split(/(<img[^\>]*>)/gm);(n=n.filter((function(t){return!!t}))).forEach((function(t,e){t&&!/^\s*\n/.test(t)&&e&&!/\n\s*$/.test(n[e-1])&&(n[e]="\n"+t)})),a=n.join("")}var s=a?a.split("\n"):[];i.content=t.map(s,(function(t,e){var i;if(/<img([\s\S]*)>/gm.test(t)){var a=t.split(/\ssrc="([^"]*)"/gm)[1],n=a?a.match(/[\w|-]{36}/gm)[0]:(new Date).getTime()+"-"+e;i={isImg:!0,src:"",url:a,status:"pending",id:n,ready:!0}}else i={isImg:!1,val:t};return i})),i.downloadImage(),i.isLoading=!1})).catch((function(t){$log.log(t)}))},closePopup:function(){this.value=!1,this.show=!1,this.$emit("close")},getThumbnail:function(t){return"pending"===t.status?r.a.IMAGE_LOADING:"rejected"===t.status?r.a.IMAGE_RELOAD:"dev"===APP_ENV?t.url:"fulfilled"===t.status?t.src:($log.log("检查指引-显示图片：",t),r.a.IMAGE_PLACEHOLD)},imgError:function(t,e){$log.error("检查指引-加载图片出现错误：",t);var i=p({},t);i.status="rejected",this.$set(this.content,e,i)},downloadImage:function(e){var i=this;e=e?[e]:this.imageList(),t.each(e,(function(e){var a=p({},e),n=t.map(i.content,(function(t){return t.id})).indexOf(e.id);r.a.isNeedDownload(e.url).then((function(t){t?r.a.download(e.url).then((function(t){a.status="fulfilled",a.src=r.a.fixUrl(t),i.$set(i.content,n,a)})).catch((function(t){$log.error("检查指引-下载图片：",t)})):(a.status="fulfilled",a.src=r.a.fixUrl(r.a.getPathFromUrl(e.url)),i.$set(i.content,n,a))}))}))},imageList:function(){return t.filter(this.content,(function(t){return t.isImg}))},imgClick:function(e){var i=this;if("pending"===e.status)return!1;if("rejected"===e.status)return this.downloadImage(e),$log.log("检查指引-点击重新加载-重新下载图片：",e),!1;var a=this.imageList(),s=t.map(a,(function(t){return t.id})).indexOf(e.id);a=t.map(a,(function(t){return i.getThumbnail(t)})),n.a.openImageBrowser(a,s)}}}}).call(this,i("391c"))},f369:function(t,e,i){"use strict";var a=i("fd50"),n=i("bcc7"),s=i("329b"),o=i("d0fb").a,r=(i("9b25"),i("17cc")),l=Object(r.a)(o,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"slide-right"}},[t.show?i("page-content",{attrs:{mode:"dialog",title:"检查指引","on-close":t.closePopup}},[!t.isLoading&&t.listData.length?i("div",{staticClass:"page-scroll"},t._l(t.listData,(function(e,a){return i("div",{key:a},[i("item",{attrs:{border:"bottom","icon-right":e.subitem&&e.subitem.length?e.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){t.clickItem(e)}}},[i("div",{staticClass:"item-text fw-b color-blue one-line"},[t._v(t._s(e.item_name))])]),e.isOpen?t._l(e.subitem,(function(e,a){return i("div",{key:a,staticClass:"sublist"},[i("item",{staticClass:"pl0",attrs:{border:"bottom","icon-right":e.subitem&&e.subitem.length?e.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){t.clickItem(e)}}},[i("div",{staticClass:"item-text checkitem-list-name"},[t._v(t._s(e.item_name))])]),e.isOpen?t._l(e.subitem,(function(e,a){return i("div",{key:a,staticClass:"sublist"},[i("item",{staticClass:"pl0",attrs:{border:"bottom","icon-right":e.subitem&&e.subitem.length?e.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){t.clickItem(e)}}},[i("div",{staticClass:"item-text checkitem-list-name"},[t._v(t._s(e.item_name))])]),e.isOpen?t._l(e.subitem,(function(e,a){return i("div",{key:a,staticClass:"sublist"},[i("item",{staticClass:"pl0",attrs:{border:"bottom","icon-right":e.subitem&&e.subitem.length?e.isOpen?"arrow-up":"arrow-down":"arrow-right"},on:{click:function(i){t.clickItem(e)}}},[i("div",{staticClass:"item-text checkitem-list-name"},[t._v(t._s(e.item_name))])])],1)})):t._e()],2)})):t._e()],2)})):t._e()],2)}))):t._e(),i("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.listData.length,"empty-text":"没有检查项"}})],1):t._e()],1)}),[],!1,null,"74102c05",null).exports,c=!1;c||(c=new(s.default.extend(l))({el:document.createElement("div")}),document.body.appendChild(c.$el));var d=c,h=i("515e"),p=i("91c1").a,u=(i("dc98"),Object(r.a)(p,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{staticClass:"main",style:{top:t.contentTop+"px"}},[i("i",{staticClass:"arrow"}),i("div",{staticClass:"content",on:{click:function(e){return e.target!==e.currentTarget?null:t.closePopup(e)}}},[i("transition",{attrs:{name:"slide-down"},on:{enter:function(e){t.isOpening=!0},"after-enter":function(e){t.isOpening=!1},leave:function(e){t.isClosing=!0},"after-leave":t.afterClose}},[t.showList?i("div",{staticClass:"box",style:{height:t.listHeight+"px"}},t._l(t.data,(function(e,a){return i("div",{key:a,class:{"border-bottom":t.data.length>1,"box-single":1===t.data.length}},[i("div",{staticClass:"detail-hd",class:{"border-bottom":t.data.length<=1,"detail-hd-single":t.data.length<=1},on:{click:function(i){t.toggleItem(e)}}},[t.data.length>1?i("i",{class:{"detail-arrow-right":!e.isOpen,"detail-arrow-down":e.isOpen}}):t._e(),i("div",{staticClass:"detail-title"},[t._v(t._s(e.name))])]),t.data.length<=1||e.isOpen?i("div",{staticClass:"detail-bd",class:{"detail-bd-single":t.data.length<=1}},[t._l(e.textArr,(function(e,a){return i("p",{key:a,staticClass:"text-line"},[t._v("\n              "+t._s(e)+"\n            ")])})),i("item-img-list",{attrs:{editabled:!1},model:{value:e.contentImage,callback:function(i){t.$set(e,"contentImage",i)},expression:"item.contentImage"}}),i("loading-status",{attrs:{"is-empty":!e.textArr.length&&!e.contentImage.length,"empty-text":"PC端未设置检查指引"}})],2):t._e()])}))):t._e()])],1)]):t._e()}),[],!1,null,"2cac8864",null).exports),f=!1;f||(f=new(s.default.extend(u))({el:document.createElement("div")}),document.body.appendChild(f.$el));var m=f,g={name:"CheckGuide",components:{},props:{module:{type:String,default:""},mode:{type:String,default:"page"},itemId:{type:String,default:""},itemIds:{type:Array,default:function(){return[]}},batchId:{type:String,default:""},sectionId:{type:String,default:""},options:{type:Array,default:function(){return[]}},optionsPromise:{type:Function,default:function(){}},beforeOpen:{type:Function,default:function(){}}},data:function(){return{isLoading:!1}},methods:{openCheckGuide:function(){var t=this,e=this.beforeOpen&&this.beforeOpen();e instanceof Promise||(e=Promise.resolve(e)),e.then((function(e){!1!==e&&("drop"===t.mode?m.openPopup({itemIds:t.itemIds,el:t.$refs["check-guide-btn"],options:t.options}):("templet-plan"===t.module?a.a.when(!1):t.itemId&&t.sectionId?n.a.hasChildSectionCheckItem(t.itemId,t.sectionId):t.itemId?n.a.hasChildCheckItem(t.itemId):a.a.when(!0)).then((function(e){e?d.openPopup({module:t.module,itemId:t.itemId,batchId:t.batchId,sectionId:t.sectionId,options:t.options}):h.a.openPopup({itemId:t.itemId,module:t.module})})))}))}}},v=Object(r.a)(g,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"check-guide-btn",staticClass:"header-btn",on:{click:function(e){t.openCheckGuide()}}},[i("icon",{attrs:{name:"nav-info"}})],1)}),[],!1,null,null,null);e.a=v.exports},f3d7:function(t,e,i){"use strict";i("9120")},f53a:function(t,e,i){(t.exports=i("690e")(!1)).push([t.i,".zjapp .number-keyboard-con[data-v-6337f428]{position:absolute;left:0;bottom:0;width:100%;padding:4px 0;background-color:#fafafa;box-shadow:0 -4px 8px 0 rgba(0,0,0,.08);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.zjapp .ios-bezel-less[data-v-6337f428]{padding-bottom:34px}.zjapp .keyboard-row[data-v-6337f428],.zjapp .keys-row[data-v-6337f428]{display:flex}.zjapp .row-span-1[data-v-6337f428]{flex:1}.zjapp .row-span-2[data-v-6337f428]{flex:2}.zjapp .row-span-3[data-v-6337f428]{flex:3}.zjapp .keys[data-v-6337f428]{flex:1;height:48px;line-height:48px;text-align:center;font-size:18px;margin:4px;border:1px solid rgba(5,5,5,.07);border-radius:8px;background-color:#fff;padding:0}.zjapp .keys-next[data-v-6337f428],.zjapp .keys-prev[data-v-6337f428]{font-size:14px;color:#4275e8}.zjapp .keys-ok[data-v-6337f428]{font-size:14px;color:#999}.zjapp .keys-delete[data-v-6337f428]{color:#999}.zjapp .icon[data-v-6337f428]{pointer-events:none}.zjapp .icon-keyboard-close[data-v-6337f428]{font-size:20px;color:#999}.zjapp .icon-keyboard-delete[data-v-6337f428]{vertical-align:top;margin-top:13px;font-size:14px;color:#333}.zjapp .activing[data-v-6337f428]{background-color:#ececec}.zjapp .disabled[data-v-6337f428]{color:#999}.zjapp .col[data-v-6337f428]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:104px;line-height:36px}",""])},f546:function(t,e,i){"use strict";var a={name:"StatusTotalBar",props:{data:{type:Array,default:function(){return[]}},status:{type:String,default:"default"}},data:function(){return{}}},n=(i("f6de"),i("17cc")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"status-total-bar"},t._l(t.data,(function(e,a){return i("div",{key:a,staticClass:"total-item"},["default"===t.status?[i("p",[i("span",{staticClass:"total-status",class:"total-status-"+e.color},[t._v("\n          "+t._s(e.status)+"\n        ")])]),i("p",[t._v("\n        "+t._s(e.total)+"\n      ")])]:t._e(),"laser-scanning"===t.status?[i("p",[i("span",{staticClass:"total-status",class:"total-status-"+e.color},[t._v("\n          "+t._s(e.status)+"\n        ")]),t._v("\n        ("+t._s(e.total)+")\n      ")])]:t._e()],2)})))}),[],!1,null,"be07cd9c",null);e.a=s.exports},f5e2:function(t,e,i){var a=i("c36f");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i("85cb").default)("22118b9b",a,!0,{sourceMap:!1,shadowMode:!1})},f669:function(t,e,i){"use strict";i("141b")},f6de:function(t,e,i){"use strict";i("5b85")},f7e2:function(t,e,i){"use strict";(function(t){i("e697");var a=i("4c09"),n=i("e2a7"),s=i("7798"),o=i("6144"),r=i("bc69");e.a={name:"MeasureDetailTemplateMixin",data:function(){return{isSaving:!1,hasPoint:!1,hasExceed:!1}},computed:{allowMeasureReinspect:function(){return this.$store.state.measure.allowMeasureReinspect},drawingUrl:function(){return this.detail&&this.detail.drawing_file&&this.detail.drawing_file[0]&&this.detail.drawing_file[0].url||""},inputComplete:function(){var e=this;return!t.some(this.detail.problemData||[],(function(i){return t.some(i.realityVal,(function(t){return!t.isFict&&!e.hasVal(t.val)}))}))},hasContractor:function(){return this.detail&&this.detail.problemData&&t.some(this.detail.problemData||[],(function(e){return!t.isEmpty(e.contractor)}))}},watch:{hasExceed:function(t){t||3===this.detail.entry_requirements&&(this.detail.needRepair=!1)},"detail.problemData":{handler:function(e){var i=this;t.isEmpty(e)&&(this.hasPoint=!1,this.hasExceed=!1),this.hasPoint=t.some(e,(function(e){return t.some(e.realityVal,(function(t){return!t.isFict&&i.hasVal(t.val)}))})),this.hasExceed=t.some(e,(function(e){return t.some(e.realityVal,(function(t){return!t.isFict&&t.isExceed}))}))},deep:!0,immediate:!0}},methods:{hasVal:function(t){return""!==t&&null!=t},changeItems:function(t,e){this.$emit("changeItems",t,e)},changePlace:function(t){this.$emit("changePlace",t)},saveProblem:function(){var e=this,i=this.detail;return"reedit"===i.mode||"redo"===i.mode?Promise.resolve():(t.each(i.problemData,(function(t){t.realityVal=Object(a.a)(t.realityVal)})),s.a.save(i).then((function(t){t&&e.$set(e.detail,"id",t)})).catch((function(t){n.a.alert(t)})))},saveProblemAndTip:function(){this.saveProblem().then((function(){n.a.alert("保存成功")}))},delProblem:function(){var t=this;return s.a.deleteDraftProblem(this.detail).then((function(){t.$router.go(-1)})).catch((function(t){t&&n.a.alert(t,200)}))},changeCC:function(){var t=this,e=this.detail;"edit"===e.mode?this.saveProblem(e):"view"===e.mode&&s.a.changeCC(e,!0).then((function(){t.$forceUpdate()}))},setRedo:function(){var e=(o.a.getUserObject(r.a.MEASURE_SECTION_CONTRACTOR)||{})[this.model.place.section.id],i=e&&t.find(this.model.contractors,{id:e});this.detail.mode="redo",this.detail.img=[],this.detail.remark="",this.detail.cc=[],t.each(this.detail.problemData,(function(e){2===e.entry_requirements?e.realityVal=t.map(e.realityVal,(function(t){var e={val:"",setVal:"",area:t.area};return t.label&&(e.label=t.label),e})):(e.realityVal=[],e.pointNum="",e.passrate=0),e.contractor=i||{}})),this.detail.id===this.$store.state.measure.repairData.id?this.$store.commit("measure/SET_REPAIR_DATA",t.clone(this.detail)):this.detail.id===this.$store.state.measure.supervisionData.id?this.$store.commit("measure/SET_SUPERVISION_DATA",t.clone(this.detail)):this.detail.id===this.$store.state.measure.constructData.id&&this.$store.commit("measure/SET_CONSTRUCT_DATA",t.clone(this.detail)),this.$refs.scroller.scrollTop=0}}}}).call(this,i("391c"))},fdef:function(t,e,i){"use strict";(function(t){i("f548"),i("e697"),i("2b45"),i("cc57"),i("6f84"),i("6d57");var a,n=i("a37e"),s=i("a1c4"),o=i("7fb2"),r=i("17fb"),l={};function c(){var e,i,a,c,d,h,p,u,f,m,g,v,b,x,y,w,k,_,C,P=0,I=0,S=1,D=[],M={},R={x:null,y:null},j=0,T=0,$=0,z=null,O=null,E=!1,B=!1,V=0,N=!1,A=["1","2","3","删除","4","5","6","-","7","8","9",".","上一项","0","下一项","关闭"],L=null,H=null,F={},U=this,q={data:[],width:document.documentElement.clientWidth,height:0,src:"",clickCallback:function(){},pointRadius:8,pointRatio:2,clickDelay:500};function K(t,i){var a=e.getBoundingClientRect();return{x:t-a.left*(e.width/(a.width*c)),y:i-a.top*(e.height/(a.height*c))}}function W(){i.clearRect(0,0,e.width,e.height),i.drawImage(a,0,0,a.width,a.height,P,I,a.width*S,a.height*S),q.points.forEach((function(t,e){!function(t,e,a,n,s,o,r){i.save(),null!==L&&L===n&&(i.beginPath(),i.fillStyle="rgba(66, 117, 232, "+(.6*(1-j)+.1)+")",i.arc(t,e,a*(1+j),0,2*Math.PI,!1),i.fill()),r.isWarning&&L!==n&&(i.beginPath(),i.fillStyle="rgba(252, 139, 1, "+(.6*(1-$)+.1)+")",i.arc(t,e,a*(1+$),0,2*Math.PI,!1),i.fill()),i.beginPath(),r.isWarning&&L!==n?i.fillStyle="#ff7439":o&&(i.fillStyle=o),i.arc(t,e,a,0,2*Math.PI,!1),i.globalAlpha=.6,i.fill(),i.globalAlpha=1,o&&(i.strokeStyle=o),i.lineWidth=1,i.stroke()}(t.x*S/c+P/c,t.y*S/c+I/c,q.pointRadius,e,0,L===e?"#4275e8":t.color||(t.isQualified?"#0bc666":"#ff3c46"),t),t.index=e})),function(){var t=Y(),e=X(),a=e.w,n=e.h,s=G(),o=s.x,r=s.y;if(!t||!E)return;i.fillStyle="rgba(0,0,0,0.8)",i.beginPath(),i.arc(o+5,r+5,5,Math.PI,1.5*Math.PI),i.lineTo(a+o-5,r),i.arc(o+a-5,r+5,5,1.5*Math.PI,0),i.lineTo(o+a,r+n-5),i.arc(o+a-5,r+n-5,5,0,.5*Math.PI),i.lineTo(o+a/2+5,r+n),i.lineTo(o+a/2,r+n+5),i.lineTo(o+a/2-5,r+n),i.lineTo(o+5,r+n),i.arc(o+5,r+n-5,5,.5*Math.PI,Math.PI),i.lineTo(o,r+5),i.closePath(),i.fill(),O&&(i.lineCap="round",i.lineJoin="round",i.beginPath(),i.arc(o-26,r+n/2,16,0,2*Math.PI),i.closePath(),i.fill(),i.beginPath(),i.strokeStyle="#ff3d3d",i.lineWidth=2,i.moveTo(o-34,r+n/2),i.lineTo(o-18,r+n/2),i.stroke(),i.beginPath(),i.arc(o+a+26,r+n/2,16,0,2*Math.PI),i.closePath(),i.fill(),i.beginPath(),i.strokeStyle="#0bc666",i.lineWidth=2,i.moveTo(o+a+18,r+n/2-1),i.lineTo(o+a+24,r+n/2+5),i.lineTo(o+a+35,r+n/2-6),i.stroke(),i.lineCap="butt",i.lineJoin="miter");!function(t,e){C._drawInputs(t,e,L,H)}(o,r)}(),function(){var t,e=Y(),a=240,n=180,s=J(),o=s.x,r=s.y;if(e&&B&&null!==H){for(t in i.shadowBlur=5,i.shadowColor="#999",i.fillStyle="#ffffff",i.beginPath(),i.arc(o+6,r+6,6,Math.PI,1.5*Math.PI),i.lineTo(a+o-6,r),i.arc(o+a-6,r+6,6,1.5*Math.PI,0),i.lineTo(o+a,r+n-6),i.arc(o+a-6,r+n-6,6,0,.5*Math.PI),i.lineTo(o+6,r+n),i.arc(o+6,r+n-6,6,.5*Math.PI,Math.PI),i.lineTo(o,r+6),i.closePath(),i.fill(),i.shadowBlur=0,i.shadowColor="transparent",F)t=parseInt(t),i.fillStyle="#f2f2f2",i.beginPath(),0===t?i.arc(o+t%4*60+6,r+45*Math.floor(t/4)+6,6,Math.PI,1.5*Math.PI):i.moveTo(o+t%4*60,r+45*Math.floor(t/4)),3===t?(i.lineTo(o+60*(t%4+1)-6,r+45*Math.floor(t/4)),i.arc(o+60*(t%4+1)-6,r+45*Math.floor(t/4)+6,6,1.5*Math.PI,0)):i.lineTo(o+60*(t%4+1),r+45*Math.floor(t/4)),15===t?(i.lineTo(o+60*(t%4+1),r+(Math.floor(t/4)+1)-6),i.arc(o+60*(t%4+1)-6,r+45*(Math.floor(t/4)+1)-6,6,0,.5*Math.PI)):i.lineTo(o+60*(t%4+1),r+45*(Math.floor(t/4)+1)),12===t?(i.lineTo(o+t%4*60+6,r+45*(Math.floor(t/4)+1)),i.arc(o+t%4*60+6,r+45*(Math.floor(t/4)+1)-6,6,.5*Math.PI,Math.PI)):i.lineTo(o+t%4*60,r+45*(Math.floor(t/4)+1)),i.closePath(),i.fill();i.strokeStyle="#d9d9d9",i.lineWidth=.5,i.beginPath(),i.moveTo(o,r+45.25),i.lineTo(o+a,r+45.25),i.moveTo(o,r+90.25),i.lineTo(o+a,r+90.25),i.moveTo(o,r+135.25),i.lineTo(o+a,r+135.25),i.moveTo(o+60.25,r),i.lineTo(o+60.25,r+n),i.moveTo(o+120.25,r),i.lineTo(o+120.25,r+n),i.moveTo(o+180.25,r),i.lineTo(o+180.25,r+n),i.closePath(),i.stroke(),i.textAlign="center",A.forEach((function(t,e){var a=Math.floor(e/4),n=e%4;3===e?(i.fillStyle="#999999",i.beginPath(),i.moveTo(o+60*n+18,r+45*a+22.5),i.lineTo(o+60*n+25,r+45*a+14.5),i.lineTo(o+60*n+40,r+45*a+14.5),i.arc(o+60*n+40,r+45*a+16.5,2,1.5*Math.PI,0),i.lineTo(o+60*n+42,r+45*a+28.5),i.arc(o+60*n+40,r+45*a+28.5,2,0,.5*Math.PI),i.lineTo(o+60*n+25,r+45*a+30.5),i.closePath(),i.fill(),i.beginPath(),i.strokeStyle="#ffffff",i.lineWidth=2,i.moveTo(o+60*n+28,r+45*a+18),i.lineTo(o+60*n+37,r+45*a+27),i.moveTo(o+60*n+37,r+45*a+18),i.lineTo(o+60*n+28,r+45*a+27),i.stroke()):(i.fillStyle="#111111",i.font=3===e||12===e||14===e||15===e?'14px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif':'18px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',15===e&&(i.fillStyle="#4275e8"),(12===e&&!y||14===e&&!w)&&(i.fillStyle="#b2b2b2"),i.fillText(t,o+60*n+30,r+45*a+29))}))}}(),null!==L&&T<2&&(clearTimeout(v),v=setTimeout((function(){(j+=.07)>=1&&(j=0,T+=1),j=T>=2?0:parseFloat(j.toFixed(2)),W()}),40)),b&&(clearTimeout(x),x=setTimeout((function(){($+=.07)>=1&&($=0),$=parseFloat($.toFixed(2)),W()}),40))}function Y(){return(null===L?null:q.points[L])||null}function X(){return C._getInputPopupSize(_)}function G(){var t=Y(),e=X();return t?{x:t.x*S/c+P/c-e.w/2,y:t.y*S/c+I/c-e.h-q.pointRadius-10}:{x:null,y:null}}function J(){var t=Y();return t?{x:Math.round(t.x*S/c+P/c-120),y:Math.round(t.y*S/c+I/c+q.pointRadius+10)}:{x:null,y:null}}function Q(t){var e=t.changedTouches.length,i=t.touches.length;return 1===e||2===e||2===i}function Z(t){return 1===t.touches.length}function tt(t){switch(t){case"t":if(I>=h[1])return!0;break;case"r":if(P<=d[0])return!0;break;case"b":if(I<=h[0])return!0;break;case"l":if(P>=d[1])return!0}return!1}function et(t){if(U.drawMode,u=!1,Z(t))nt(t);else if(Q(t)){var e,i=t.touches[0],a=t.touches[1],n=K(i.clientX,i.clientY),s=K(a.clientX,a.clientY);e=Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2)),p=S/e}}function it(t){if("img"!==U.drawMode){var i,a,n,s,o,r=t.touches[0];if(Z(t)){if(f||nt(t),n=r,s=(a=f).cx-n.pageX,o=a.cy-n.pageY,("b"===(i=Math.abs(s)>Math.abs(o)?s>0?"r":s<0?"l":"":o>0?"b":o<0?"t":"")&&tt("b")||"t"===i&&tt("t")||"r"===i&&tt("r")||"l"===i&&tt("l"))&&!q.hasBouncing)return;t.preventDefault(),t.stopPropagation(),(Math.abs(r.clientX-f.cx)>3||Math.abs(r.clientY-f.cy)>3)&&function(t){var i=t.touches[0],a=K(i.clientX,i.clientY),n=(a.x-f.x)*c,s=(a.y-f.y)*c,o={x:P<d[0]?P-d[0]:P>d[1]?P-d[1]:0,y:I<h[0]?I-h[0]:I>h[1]?I-h[1]:0},r=P+n,l=I+s;u||(f.x=a.x,f.y=a.y,r<=d[0]||r>=d[1]?!1===q.hasBouncing?P=r<=d[0]?d[0]:d[1]:P+=n*Math.abs(e.width/2-o.x)/e.width/2:P+=n,l<=h[0]||l>=h[1]?!1===q.hasBouncing?I=l<=h[0]?h[0]:h[1]:I+=s*Math.abs(e.height/2-o.y)/e.height/2:I+=s,W())}(t)}else Q(t)&&function(t){var e,i,a,n,s,o=t.touches[0],r=t.touches[1],l=K(o.clientX,o.clientY),d=K(r.clientX,r.clientY),h=Math.sqrt(Math.pow(d.x-l.x,2)+Math.pow(d.y-l.y,2));u=!0,a=function(t){return(t=t||S)<D[0]?t-D[0]:t>D[1]?t-D[1]:0}(e=p*h),n=D[0]/2,s=(Math.abs(a)>n?1:Math.abs(a)/n)/2,e-=q.hasBouncing?a?a*s:0:a,M=i={x:(l.x+d.x)/2*c,y:(l.y+d.y)/2*c},P=i.x-e/S*(i.x-P),I=i.y-e/S*(i.y-I),e!==S&&(S=e,ut(),W())}(t)}}function at(e){!function(e){var i=e.changedTouches[0];f&&Date.now()-f.time<q.clickDelay&&Math.abs(i.clientX-f.cx)<6&&Math.abs(i.clientY-f.cy)<6&&function(e){var i,s,o,r,d,h=e.changedTouches[0],p=K(h.clientX,h.clientY),u={x:((p.x-P/c)/S*c).toFixed(1),y:((p.y-I/c)/S*c).toFixed(1)},f=pt(u),m=E?X():null,g=E?G():null,v=E?{x:p.x-g.x,y:p.y-g.y}:null,b={w:240,h:180},x=B?J():null,k=B?{x:p.x-x.x,y:p.y-x.y}:null;m&&v.x>5&&v.x<m.w-5&&v.y>0&&v.y<m.h?r="input":v&&v.x>-52&&v.x<0&&v.y>(m.h-32-10)/2&&v.y<(m.h+32+10)/2?r="remove":v&&v.x>m.w&&v.x<m.w+20+32&&v.y>(m.h-32-10)/2&&v.y<(m.h+32+10)/2?r="save":k&&k.x>0&&k.x<b.w&&k.y>0&&k.y<b.h?r="keyborad":t.isEmpty(f)?u.x>=0&&u.x<=a.width&&u.y>=0&&u.y<=a.height&&(r="img"):r="point";"img"!==U.drawMode&&(O?("input"===r&&gt(i=C._clickHandler_getInputIndex(L,v))&&rt(i),"remove"===r&&(lt(H,!0),q.data=n.a.delPoint(q.data,L),ot()),"save"===r&&(lt(H),ot()),"keyborad"===r&&(function(e){var i=H;if(!gt(L)||!gt(H))return;var a=ct(L,H),n=A[e];a&&a.points&&(t.each(a.points,(function(t){isNaN(n)?"删除"===n?a.isSetVal?t.setVal=t.setVal.toString().substr(0,t.setVal.toString().length-1):t.val=t.val.toString().substr(0,t.val.toString().length-1):"-"===n?a.isSetVal?gt(t.setVal)||(t.setVal="-"):gt(t.val)||(t.val="-"):"."===n?a.isSetVal?gt(t.setVal)&&parseFloat(t.setVal)===parseInt(t.setVal)&&(t.setVal=t.setVal+n):gt(t.val)&&parseFloat(t.val)===parseInt(t.val)&&(t.val=t.val+n):"上一项"===n?(console.log(y,"hasPrevInput"),console.log(i-1,"curIndex - 1curIndex - 1curIndex - 1"),y&&(lt(H),rt(i-1))):"下一项"===n?w&&(lt(H),rt(i+1)):"关闭"===n&&(lt(H),B=!1,H=null):a.isSetVal?t.setVal=(gt(t.setVal)?t.setVal:"")+n:t.val=t.val+n})),a.isSetVal&&a.points&&a.points.length&&C.saveInputSetVal(L,l))}(s=Math.floor(k.x/60)+4*Math.floor(k.y/45)),function(t){F[t]&&clearTimeout(F[t]);F[t]=setTimeout((function(){delete F[t],W()}),300),W()}(s)),"point"===r&&(lt(H),o=dt(L),!t.some(o,(function(t){return gt(t.val)||gt(t.setVal)}))&&gt(L)&&(q.data=n.a.delPoint(q.data,L),q.points=vt(q.data),f=pt(u)),st(f.index)),"img"===r&&(lt(H),o=dt(L),!t.some(o,(function(t){return gt(t.val)||gt(t.setVal)}))&&gt(L)&&(q.data=n.a.delPoint(q.data,L)),q.data=n.a.addPoint(q.data,{x:u.x,y:u.y}),q.points=vt(q.data),st(q.points.length-1,!0))):("point"===r&&((f=pt(u)).pointId?q.onClickPoint&&q.onClickPoint(f):st(f.index)),"img"===r&&ot()));d={type:t.isEmpty(f)?"":"point",pos:p,x:u.x,y:u.y,point:f,btn:""},q.clickCallback&&q.clickCallback(d),W()}(e);mt(e)}(e)}function nt(t){var e=t.touches[0],i=K(e.clientX,e.clientY);f={x:i.x,y:i.y,cx:e.clientX,cy:e.clientY,time:Date.now()}}function st(e,i){var a,n,s,o,r,l,d=N?42:0;T=0,l=L=e,r=C.getMarkPoints(l),t.each(r,(function(t){delete t.isWarning})),b=t.some(q.points,{isWarning:!0}),s=G(),o=X(),s.x-d<0?a=(s.x-d)*c:s.x+o.w+d>q.width&&(a=(s.x+o.w+d-q.width)*c),s.y<0&&(n=s.y*c),V=C.getInputLength(q.data.problemData),E=!0,ht(P-(a||0),I-(n||0)),O&&i&&8!==k&&rt(H||0),ut()}function ot(){L=null,E=!1,B=!1,"view"!==q.data.mode&&t.each(q.data.problemData,(function(t){n.a.problemHandle(t)})),q.points=vt(q.data),q.onChange&&q.onChange()}function rt(t){var e,i,a=J(),n=240,s=180;a.x<0?e=a.x*c:a.x+n>q.width&&(e=(a.x+n-q.width)*c),a.y+s>q.height&&(i=(a.y+s-q.height)*c),H=t,y=t>0,w=t<V-1,O&&8!==k&&(B=!0,ht(P-(e||0),I-(i||0))),C.autoInputSetVal(L,l),ut()}function lt(e,i){var a=ct(L,e=void 0===e?H:e),s=[-9999999.99999,9999999.99999];C.inputBlur(),a&&a.points&&t.each(a.points,(function(t){if(a.isSetVal){if(t.setVal=isNaN(t.setVal)?"":gt(t.setVal)?Object(r.a)(t.setVal):"",""===t.setVal)return;t.setVal<s[0]?t.setVal=s[0]:t.setVal>s[1]&&(t.setVal=s[1])}else{if(t.val=isNaN(t.val)?"":gt(t.val)?Object(r.a)(t.val):"",""===t.val)return;t.val<s[0]?t.val=s[0]:t.val>s[1]&&(t.val=s[1])}})),t.each(q.data.problemData,(function(t){n.a.pointsHandle(t),n.a.problemHandle(t)})),H=null,B=!1,!i&&q.onChange&&q.onChange()}function ct(t,e){return C.getTargetPoint(t,e)}function dt(t){return C.getTargetPoints(t)}function ht(t,e){null===R.x&&null===R.y?R={x:t,y:e}:(R.x===t&&R.y===e||(R.x<t?R.x=t<=P?R.x:t:R.x=t>=P?R.x:t,R.y<e?R.y=e<=I?R.y:e:R.y=e>=I?R.y:e),t=R.x,e=R.y),t===P&&e===I||(m=!0,clearTimeout(g),g=setTimeout((function(){var i=!1;Math.abs(t-P)<1?P=t:(P+=.5*(t-P),i=!0),Math.abs(e-I)<1?I=e:(I+=.5*(e-I),i=!0),i?(ht(t,e),W()):(m=!1,R={x:null,y:null})}),20))}function pt(t){var e={},i=q.pointRadius*q.pointRatio+1;return q.points.forEach((function(a){var n=Math.sqrt(Math.pow(Math.abs(t.x-a.x),2)+Math.pow(Math.abs(t.y-a.y),2)),s=n*S/c;s<=q.pointRadius*q.pointRatio&&s<i&&(e=a,i=n)})),e}function ut(){var t=ft(S);d=t.x,h=t.y}function ft(t){var e,i,n,s,o,r,l,d,h,p,u=G(),f=X(),m=J(),g=240,v=180,b=N?42:0;return t=t||S,i=(e=q.width*c-a.width*t)>0?e/=2:0,s=(n=q.height*c-a.height*t)>0?n/=2:0,E&&(s+=o=(o=I-u.y*c)>0&&o>s?o-s:0),(E||B)&&(h=E?(u.x+f.w+b)*c:0,p=B?(m.x+g)*c:0,e+=r=(r=P+a.width*S-Math.max(h,p))<0&&r<-i?r+i:0),B&&(n+=l=(l=I+a.height*S-(m.y+v)*c)<0&&l<-s?l+s:0),(E||B)&&(h=E?(u.x-b)*c:1/0,p=B?m.x*c:1/0,i+=d=(d=P-Math.min(h,p))>0&&d>i?d-i:0),{x:[e,i],y:[n,s]}}function mt(t,e){if(!(t&&"touchend"===t.type&&0!==t.touches.length||m)){var i=e||(S<D[0]?D[0]:S>D[1]?D[1]:S),n=ft(i),s=n.x,o=n.y;(P<s[0]||P>s[1]||I<o[0]||I>o[1]||S<D[0]||S>D[1])&&setTimeout((function(){var t=M.x?M.x-i*(M.x-P)/S:P,n=M.y?M.y-i*(M.y-I)/S:I,r=!1;t=t<s[0]?s[0]:t>s[1]?s[1]:t,n=n<o[0]?o[0]:n>o[1]?o[1]:n,Math.abs(t-P)<1?P=t:(P+=.5*(t-P),r=!0),Math.abs(n-I)<1?I=n:(I+=.5*(n-I),r=!0),Math.abs(i-S)*a.width*a.height<5?S=i:(S+=.5*(i-S),r=!0),r&&(mt("",e),W())}),20)}}function gt(t){return""!==t&&null!=t}function vt(e){var i,a={};return i=s.a.getDrawPoints(e),t.isEmpty(e.pointStatus)||(t.each(e.pointStatus,(function(t){a[t.id]=t.status})),t.each(i,(function(t){var e=t.pointId?a[t.pointId]:"";e&&(t.color={"待整改":"#FF3C46","待复验":"#FF8E24","已通过":"#0BC666","非正常关闭":"#666666"}[e])}))),i}function bt(e,a){q.data=e,q.points=vt(q.data),z=q.data.mode,O="edit"===z||"reedit"===z||"redo"===z,E=!1,B=!1,V=0,k=q.data.problemData[0].passrate_mode,_=q.data.problemData.length,N=O,L=null,H=null,b=t.some(q.points,{isWarning:!0});var n=Object(o.b)(k);C=new n(i,{_defaults:q,isEditMode:O,hasOperaBtn:N,passrateMode:k}),!1!==a&&W()}this.init=function(t){for(var n in t)t.hasOwnProperty(n)&&(q[n]=t[n]);var s,o,r;if(U.drawMode=t.drawMode||"edit",e=q.canvas)return e.className=e.className+" canvas-diagram",e.width=q.width,e.height=q.height,(i=e.getContext("2d")).strokeStyle="transparent",i.fillStyle="transparent",o=(s=i).backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1,(c=(window.devicePixelRatio||1)/o)>1&&(e.style.height=e.height+"px",e.style.width=e.width+"px",e.width*=c,e.height*=c),!i.extended&&function(t){var e=function(t){var e=t.backingStorePixelRatio||CanvasRenderingContext2D.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e}(t);if(1===e)return;(function(t,e){for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)})({fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all"},(function(i,a){var n;t[a]=(n=t[a],function(){var t,a,s=Array.prototype.slice.call(arguments);if("all"===i)s=s.map((function(t){return t*e}));else if(Array.isArray(i))for(t=0,a=i.length;t<a;t++)s[i[t]]*=e;return n.apply(this,s)})})),t.stroke=(i=t.stroke,function(){this.lineWidth*=e,i.apply(this,arguments),this.lineWidth/=e}),t.fillText=function(t){return function(){var i=Array.prototype.slice.call(arguments);i[1]*=e,i[2]*=e,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,i,a){return i*e+a})),t.apply(this,i),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,i,a){return i/e+a}))}}(t.fillText),t.strokeText=function(t){return function(){var i=Array.prototype.slice.call(arguments);i[1]*=e,i[2]*=e,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,i,a){return i*e+a})),t.apply(this,i),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,(function(t,i,a){return i/e+a}))}}(t.strokeText),t.extended=!0;var i}(i),i.clearRect(0,0,e.width,e.height),i.fillStyle="#999",i.font='18px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',i.fillText("加载中...",(q.width-70)/2,(q.height+18)/2),bt(q.data,!1),e.addEventListener("touchstart",et),e.addEventListener("touchmove",it),e.addEventListener("touchend",at),a=q.img,q.width/a.width<q.height/a.height?(r=q.width/a.width,P=0,I=(q.height-a.height*r)/2*c):(r=q.height/a.height,P=(q.width-a.width*r)/2*c,I=0),D=[S=r*c,S<.25?2:8*S],d=[P,P],h=[I,I],W(),this},this.reset=function(){return P=0,I=0,S=D[0],e&&(e.removeEventListener("touchstart",et),e.removeEventListener("touchmove",it),e.removeEventListener("touchend",at)),this},this.destroy=function(){q=null,e.width=0,e.height=0,e=null,i=null},this.showLoading=function(){i.clearRect(0,0,e.width,e.height),i.fillStyle="#999",i.font='18px -apple-system, "Helvetica Neue", Roboto, "Segoe UI", sans-serif',i.fillText("加载中...",(q.width-70)/2,(q.height+18)/2)},this.setPointData=function(t){return q.points=t,W(),this},this.setDetailData=bt,this.getDetailData=function(){var e=H;return gt(e)&&(lt(e),rt(e)),t.each(q.data.problemData,(function(t){n.a.pointsHandle(t),n.a.problemHandle(t)})),W(),q.data},this.startWarning=function(){b=!0},this.endWarning=function(){b=!1},this.setMode=function(t){U.drawMode=t,"img"===t&&mt("",D[0]),q.onSetMode&&q.onSetMode(t)},this.inputBlur=lt,this.pointBlur=ot}a={init:function(t){var e=new c;return e.init(t),e}},e.a=a}).call(this,i("391c"))},fe89:function(t,e,i){"use strict";i("5290")},fe9e:function(t,e,i){"use strict";i("3cd8")}}]);