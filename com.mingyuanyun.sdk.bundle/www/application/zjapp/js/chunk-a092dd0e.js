(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-a092dd0e","chunk-739f37c8"],{"6a6b":function(t,e,n){(t.exports=n("690e")(!1)).push([t.i,".zjapp .inventory-history[data-v-ab8816fa]{height:100%;background:#fff}.zjapp .inventory-history .inventory_history-layar[data-v-ab8816fa]{height:calc(100vh - 94px);overflow:auto;text-align:center}.zjapp .inventory-history .nav[data-v-ab8816fa]{color:#888;font-size:14px;padding:0 34px 0 15px;height:50px;background:#fafafa}.zjapp .inventory-history .nav-special[data-v-ab8816fa]{text-align:center;padding:0 10px}.zjapp .inventory-history .inventory_history-list[data-v-ab8816fa]{color:#333;font-size:16px}.zjapp .inventory-history .time[data-v-ab8816fa]{color:#666;text-align:center}.zjapp .inventory-history .time-month[data-v-ab8816fa]{line-height:22px}.zjapp .inventory-history .time-year[data-v-ab8816fa]{font-size:9px;line-height:13px}.zjapp .inventory-history .txt-clamp-2[data-v-ab8816fa]{padding:0 5px;text-align:center;word-break:break-all}",""])},"774b":function(t,e,n){"use strict";n.r(e);var i=n("d18d").a,a=(n("b225"),n("17cc")),o=Object(a.a)(i,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"scroll-warp",staticClass:"scroll-warp",class:{"scroll-warp-pulling":t.pulling,"scroll-warp-complete":!t.hasNext&&!t.isEmpty,"scroll-warp-empty":t.isEmpty},style:{"padding-bottom":t.numberKeyboardCoverHeight+"px"},on:{scroll:t.onScroll,touchstart:t.onTouchstart,touchmove:t.onTouchmove,touchend:t.onTouchend}},[t.allowPullDown?n("div",{staticClass:"pull-refresh-warp",style:{height:t.pullDist+"px"}},[n("div",{staticClass:"pull-refresh"},[n("div",{staticClass:"animation-refresher",class:{refreshing:t.refreshing}}),t.updateTime?n("p",{staticClass:"pull-refresh-date"},[t._v("最后成功同步："+t._s(t.updateTime))]):t._e()])]):t._e(),t._t("default"),t.loading?n("div",{staticClass:"page-loading"},[n("svg",{staticClass:"svg-loading",attrs:{viewBox:"0 0 80 80"}},[n("circle",{attrs:{cx:"40",cy:"40",r:"36"}})])]):t._e(),t.hasNext||t.isEmpty?t._e():[t.$slots.end?t._t("end"):t._e(),!t.$slots.end&&t.endText?n("div",{staticClass:"end-text"},[t._v("\n      "+t._s(t.endText)+"\n    ")]):t._e()]],2)}),[],!1,null,"2b1a346c",null);e.default=o.exports},"9d55":function(t,e,n){(t.exports=n("690e")(!1)).push([t.i,'.zjapp .scroll-warp[data-v-2b1a346c]{flex:1;overflow:auto;-webkit-overflow-scrolling:touch}.zjapp .scroll-warp-pulling[data-v-2b1a346c]{overflow:hidden}.zjapp .scroll-warp-complete[data-v-2b1a346c]:after{content:"";display:block;height:100px}.zjapp .scroll-warp-empty[data-v-2b1a346c]{display:flex;flex-direction:column}.zjapp .pull-refresh-warp[data-v-2b1a346c]{position:relative;height:0;overflow:hidden}.zjapp .pull-refresh[data-v-2b1a346c]{position:absolute;left:0;bottom:0;height:70px;width:100%;padding:6px;text-align:center}.zjapp .pull-refresh-date[data-v-2b1a346c]{margin-top:4px;height:16px;line-height:16px;font-size:12px;color:#bcbcbc}.zjapp .page-loading[data-v-2b1a346c]{padding:10px;text-align:center}.zjapp .end-text[data-v-2b1a346c]{color:#c8c8c8;background:#f4f4f4;position:relative;line-height:76px;height:76px;text-align:center}.zjapp .end-text[data-v-2b1a346c]:after,.zjapp .end-text[data-v-2b1a346c]:before{content:"";position:absolute;width:48px;height:1px;background:#e4e4e4;top:50%;margin-top:-1px}.zjapp .end-text[data-v-2b1a346c]:after{left:50%;transform:translateX(-92px)}.zjapp .end-text[data-v-2b1a346c]:before{right:50%;transform:translateX(90px)}.zjapp .end-slot[data-v-2b1a346c]{padding:30px;line-height:18px;text-align:center;color:#c8c8c8}',""])},aa42:function(t,e,n){"use strict";n("e4d8")},b225:function(t,e,n){"use strict";n("ef48")},ba04:function(t,e,n){"use strict";n.r(e);n("9a33");var i=n("774b"),a=n("f97c"),o=n("1b7e"),r=n("f3a3"),s=n("4360"),l={name:"InventoryHistory",components:{Scroller:i.default},data:function(){return{list:[],stauts:{"已关闭":"color-999","暂无进场记录":"color-999"},isLoading:!1,loading:!1,finished:!1,isDraftLoading:!1,id:null}},computed:{title:function(){var t=s.a.state.inventory.historyTitle;return t?t+"-历史":"历史"}},activated:function(){var t=this.$route.query;this.list=[],this.id=t.id,this.proj_id=a.a.getDefaultProject().id,this.isDraftLoading=!0,this.page=1,this.getHasNetwork(1)},methods:{onRefresh:function(t){this.page=1,this.getList(2).then((function(){"function"==typeof t&&t(!1)})).catch((function(){"function"==typeof t&&t(!1)}))},onloadUp:function(){this.page+=1,this.getList(3)},getList:function(t){var e=this,n={id:this.id,proj_id:this.proj_id};return n.id?Object(r.b)(n).then((function(n){switch(t){case 1:e.list=n||[],e.isDraftLoading=!1;break;case 2:e.list=n||[],e.isLoading=!1}e.finished=!0})).catch((function(t){e.isDraftLoading=!1,$log.error("材料盘点历史列表error：",t)})):(this.isDraftLoading=!1,!1)},cellClick:function(t){this.$router.push({name:"InventoryDetail",query:{id:t.id}})},timeCutting:function(t,e){if(!t.end_date)return"";var n=t.end_date.split("-");switch(e){case 1:return n[0];case 2:return n[1]+"-"+n[2]}},getHasNetwork:function(t){var e=this;o.a.getHasNetwork().then((function(n){n?e.getList(t):(e.$toast("当前无网络！"),e.isDraftLoading=!1)}))}}},c=(n("aa42"),n("17cc")),u=Object(c.a)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("page-content",{attrs:{"show-go-root":!0,title:t.title}},[n("scroller",{staticClass:"inventory-history",on:{pullDown:t.onRefresh}},[n("van-row",{directives:[{name:"show",rawName:"v-show",value:t.list.length,expression:"list.length"}],staticClass:"nav",attrs:{type:"flex"}},[n("van-col",{staticClass:"ly-centered",attrs:{span:"5"}},[t._v("\n        日期\n      ")]),n("van-col",{staticClass:"ly-centered",attrs:{span:"6"}},[t._v("\n        进场\n      ")]),n("van-col",{staticClass:"ly-centered nav-special",attrs:{span:"7"}},[t._v("\n        已施工"),n("br"),t._v("设计用量\n      ")]),n("van-col",{staticClass:"ly-centered",attrs:{span:"6"}},[t._v("\n        现场剩余\n      ")])],1),t.list.length?n("van-list",{staticClass:"inventory_history-layar",attrs:{finished:t.finished,"finished-text":""},on:{load:t.onloadUp},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(e,i){return n("van-cell",{key:i,staticClass:"ly-centered",attrs:{"is-link":""},on:{click:function(n){t.cellClick(e)}}},[n("van-row",{ref:"historyList",refInFor:!0,staticClass:"inventory_history-list ly-centered"},[n("van-col",{attrs:{span:"5"}},[n("div",{staticClass:"time"},[n("p",{staticClass:"time-month"},[t._v(t._s(t.timeCutting(e,2)))]),n("p",{staticClass:"time-year"},[t._v(t._s(t.timeCutting(e,1)))])])]),n("van-col",{staticClass:"ly-centered",attrs:{span:"6"}},[n("span",{staticClass:"txt-clamp-2"},[t._v(t._s(e.occurrence_quantity+e.unit))])]),n("van-col",{staticClass:"ly-centered",attrs:{span:"7"}},[n("span",{staticClass:"txt-clamp-2"},[t._v(t._s(e.used_quantity+e.unit))])]),n("van-col",{staticClass:"ly-centered",attrs:{span:"6"}},[n("span",{staticClass:"txt-clamp-2"},[t._v(t._s(e.remainder_quantity+e.unit))])])],1)],1)}))):t._e(),n("loading-status",{attrs:{"is-loading":t.isDraftLoading,"is-empty":!t.list.length,"empty-text":"暂无历史"}})],1)],1)}),[],!1,null,"ab8816fa",null);e.default=u.exports},d18d:function(t,e,n){"use strict";(function(t){n("2b45");var i,a=n("4360"),o=n("48f4"),r=n("162a"),s=n("e2a7"),l=n("a500"),c=n("6f9e"),u={};e.a={name:"Scroller",props:{buildingId:{type:String,default:""},hasNext:{type:Boolean,default:!1},isEmpty:{type:Boolean,default:!1},isSync:{type:Boolean,default:!0},endText:{type:String,default:""},memoryScrollTop:{type:Boolean,default:!0},keepScrollTop:{type:Boolean},hasPullDown:{type:Boolean,default:!0},onPullDown:{type:Function}},data:function(){return{pullDist:0,refreshing:!1,pulling:!1,loading:!1,scrollTop:0,isCurrKeyboard:!1,gapBottom:0}},computed:{allowPullDown:function(){return this.hasPullDown&&(!!this.$listeners.pullDown||!!this.onPullDown)},updateTime:function(){return a.a.state.global.businessDownloadTime},numberKeyboardCoverHeight:function(){return a.a.state.global.isNumberInputOpen?a.a.state.global.numberKeyboardHeight-this.gapBottom:0}},mounted:function(){var t=this;c.a.$on("numberKeyboardOpen",this.onNumberKeyboardOpen),this.$nextTick((function(){var e=t.$refs["scroll-warp"]&&t.$refs["scroll-warp"].getBoundingClientRect&&t.$refs["scroll-warp"].getBoundingClientRect();e&&(t.gapBottom=document.documentElement.clientHeight-e.bottom),t.$el&&t.$el.addEventListener("focus",(function(e){var n=e&&e.target,i=n&&n.tagName&&n.tagName.toLowerCase();if("input"===i||"textarea"===i){window.addEventListener("resize",(function e(){var i=n.getBoundingClientRect(),a=t.$el.getBoundingClientRect(),o=i.bottom-a.bottom;o>0&&t.scrollBy(o),window.removeEventListener("resize",e,!1)}),!1)}}),!0)}))},destroyed:function(){c.a.$off("numberKeyboardOpen",this.onNumberKeyboardOpen)},activated:function(){var t=this.keepScrollTop||this.$router.isBack&&this.memoryScrollTop;this.scrollTop&&t&&(this.$refs["scroll-warp"].scrollTop=this.scrollTop)},deactivated:function(){this.memoryScrollTop&&(this.scrollTop=this.$refs["scroll-warp"].scrollTop)},methods:{onScroll:function(t){var e=this,n=this.$refs["scroll-warp"].scrollTop,i=this.$refs["scroll-warp"].scrollHeight;if(n+this.$refs["scroll-warp"].clientHeight>=i-5&&!this.loading&&this.hasNext){this.loading=!0;var a=this.$listeners.loadNext();a&&a.then&&"function"==typeof a.then?a.then((function(){e.loading=!1})):this.loading=!1}this.$emit("scroll",t)},getTouchDiretion:function(t){if(!(u&&t&&t.touches&&t.touches[0]))return"";var e=t.touches[0].clientX,n=t.touches[0].clientY;return Math.abs(n-u.y)>Math.abs(e-u.x)&&Math.abs(n-u.y)>=3?n>u.y?"down":"up":""},onTouchstart:function(t){this.allowPullDown&&t.touches&&1===t.touches.length&&(u={x:t.touches[0].clientX,y:t.touches[0].clientY,scrollTop:this.$refs["scroll-warp"].scrollTop,pullDist:this.pullDist})},onTouchmove:function(t){if(this.allowPullDown&&t.touches&&1===t.touches.length){var e=this.$refs["scroll-warp"].scrollTop,n=t.touches[0].clientY,i=n-u.y,a=this.getTouchDiretion(t);"down"===a?!this.refreshing&&e<=0?(this.pulling=!0,this.pullDist=(i-u.scrollTop)/2,t.preventDefault()):this.pulling=!1:"up"===a?this.pullDist>0&&(this.pullDist=u.pullDist-(u.y-n),t.preventDefault()):this.pullDist=u.pullDist}},onTouchend:function(){var t=this;this.allowPullDown&&(u={},this.pulling=!1,this.pullDist>=70&&this.isSync?this.refreshing?this.makePullTo(70):this.makePullTo(70).then((function(){if(t.refreshing=!0,t.onPullDown){var e=t.onPullDown();e&&e.then&&"function"==typeof e?e.finally((function(){t.refreshing=!1,t.makePullTo(0)})):(t.refreshing=!1,t.makePullTo(0))}else t.dataSync().then((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")})).catch((function(){t.refreshing=!1,t.makePullTo(0),t.$emit("pullDown")}))})):(this.refreshing=!1,this.makePullTo(0)))},makePullTo:function(t){var e=this,n=this.pullDist,i=t,a=i-n,o=n;return n===i?Promise.resolve():new Promise((function(t){!function r(){window.requestAnimationFrame((function(){o+=a/6,e.pullDist=o,n<i&&o<i||n>i&&o>i?r():(e.pullDist=i,e.refreshing=!1,t())}))}()}))},dataSync:function(){var t,e=o.default.getCurrentModuleCode(),n=o.default.getCurrentRoute(),i=n.meta&&n.meta.isTodo;if(o.default.isModuleNeedBuilding(e)&&!i){if(!this.buildingId)return new Promise((function(t){setTimeout((function(){t()}),500)}));t=this.buildingId}return l.a.addTrack("公共-手动下拉刷新","",""),r.a.beginManualUpdate(),o.default.checkSync(t).then((function(t){return r.a.endManualUpdate(),t})).catch((function(t){$log.error("下拉刷新错误",t),t&&"Error: Network Error"===t.toString()?s.a.alert("当前网络无法同步数据"):s.a.alert(t),r.a.endManualUpdate()}))},getScrollHeight:function(){return this.$refs["scroll-warp"].offsetHeight},getScrollTop:function(){return this.$refs["scroll-warp"].scrollTop},setScrollTop:function(t){this.$refs["scroll-warp"].scrollTop=t},scrollBy:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=this.getScrollTop(),o=a+t,r=Math.round(n/16.7),s=t/r,l=a,c=i=+new Date;return a===o?Promise.resolve():new Promise((function(t){!function n(){window.requestAnimationFrame((function(){c===i&&(l+=s,e.$refs["scroll-warp"].scrollTop=l,a<o&&l<o||a>o&&l>o?n():(e.$refs["scroll-warp"].scrollTop=o,t()))}))}()}))},scrollTo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=this.getScrollTop(),i=t-n;return this.scrollBy(i,e)},scrollToEle:function(t){var e=t.keyboardHeight||232,n=(t=t.$el?t.$el:t).getBoundingClientRect(),i=this.$refs["scroll-warp"].getBoundingClientRect();if(n&&i){var o=document.documentElement.clientHeight-(a.a.state.global.isNumberInputOpen?e:0),r=i.bottom<o?i.bottom:o,s=i.top-n.top,l=n.bottom-r;s>0?this.scrollBy(-s-10):l>0&&this.scrollBy(l+10)}},isCurrent:function(e,n){var i=this;e.length&&t.each(e,(function(t){t._uid===n?i.isCurrKeyboard=!0:i.isCurrent(t.$children,n)}))},onNumberKeyboardOpen:function(t){this.isCurrKeyboard=!1,this.isCurrent(this.$children,t._uid),this.isCurrKeyboard&&this.scrollToEle(t)}}}}).call(this,n("391c"))},e4d8:function(t,e,n){var i=n("6a6b");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,n("85cb").default)("7fde065a",i,!0,{sourceMap:!1,shadowMode:!1})},ef48:function(t,e,n){var i=n("9d55");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,n("85cb").default)("a1a65c0c",i,!0,{sourceMap:!1,shadowMode:!1})},f3a3:function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"e",(function(){return o})),n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return s})),n.d(e,"d",(function(){return l}));var i=n("162a");function a(t){return i.a.request("/online/material-inventory/list",t)}function o(t){return i.a.post("/online/material-inventory/save-data",null,t)}function r(t){return i.a.request("/online/material-inventory/history",t)}function s(t){return i.a.request("/online/material-inventory/detail",t)}function l(t){return i.a.post("/online/material-inventory/change-status",null,t)}}}]);