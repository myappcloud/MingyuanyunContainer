(window.webpackJsonp_module_entry_zjapp_=window.webpackJsonp_module_entry_zjapp_||[]).push([["chunk-6914d4d9"],{"21e0":function(t,e,o){(t.exports=o("690e")(!1)).push([t.i,".zjapp .todo-sort-corver[data-v-205f8364]{position:fixed;top:44px;bottom:0;left:0;width:100%;overflow:hidden;background-color:rgba(0,0,0,.4)}.zjapp .ios.todo-sort-corver[data-v-205f8364]{top:64px}.zjapp .ios-bezel-less.todo-sort-corver[data-v-205f8364]{top:88px}.zjapp .todo-sort[data-v-205f8364]{max-height:425px;overflow:auto;background-color:#fff}.zjapp .item[data-v-205f8364] .icon{color:#4275e8}",""])},3175:function(t,e,o){"use strict";o("c371")},"394b":function(t,e,o){var i=o("8d4c");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,o("85cb").default)("a723c790",i,!0,{sourceMap:!1,shadowMode:!1})},"407a":function(t,e,o){"use strict";(function(t){o("163d"),o("9e76"),o("6a61");var i,n,a=o("2e91"),s=(o("c904"),o("e697"),o("f548"),o("cc57"),o("ed63"),o("8cf2"),o("1b7e")),r=o("a078"),c=o("f7ab"),d=o("48f4"),l=o("774b"),u=o("d004"),h=o("f2d3"),p=o("4636"),f=o("5694"),g=o("6e6b"),m=o("6144"),b=o("bc69"),v=o("ed08"),L=o("de61"),_=o("6f9e"),y=o("6718"),C=(o("a18c"),o("a500")),w=o("cf33"),k=o("c3df");e.a={name:"TodoList",components:{Scroller:l.a,SynchronizeTipBar:c.a,TodoItem:u.a,SwipeTabs:y.b,SwipeTab:y.a},mixins:[k.a],data:function(){return{isInited:!1,isLoading:!1,isLeader:this.$store.state.user.isLeader,tabIndex:0,curModule:{},curModuleCode:"",curProjId:"",filterItems:null,hasFilterRule:!1,sort:null,hasSortRule:!1,showSearch:!1,searchKeyword:"",searchTimer:null,searchPlaceholder:{"templet-plan-v2":"请输入样板名称","templet-plan":"请输入样板名称"},todoList:[],doneList:[],ccList:[],cloneTodoList:[],cloneDoneList:[],cloneCcList:[],todoLimit:10,doneLimit:10,ccLimit:10,errorType:"",emptyTips:"",isOnline:!1}},computed:{isPageLoadModule:function(){return w.a.includes(this.curModuleCode)},todoNumber:function(){return w.a.includes(this.curModuleCode)?this.todoTotalCount:this.todoList.length},doneNumber:function(){return w.a.includes(this.curModuleCode)?this.doneTotalCount:this.doneList.length},ccNumber:function(){return w.a.includes(this.curModuleCode)?this.ccTotalCount:this.ccList.length},todoListShow:function(){return this.todoList&&this.todoList.length?w.a.includes(this.curModuleCode)?this.todoList:this.todoList.slice(0,this.todoLimit):[]},doneListShow:function(){return this.doneList&&this.doneList.length?w.a.includes(this.curModuleCode)?this.doneList:this.doneList.slice(0,this.doneLimit):[]},ccListShow:function(){return this.ccList&&this.ccList.length?w.a.includes(this.curModuleCode)?this.ccList:this.ccList.slice(0,this.ccLimit):[]},todoHasNext:function(){return w.a.includes(this.curModuleCode)?this.todoList.length<this.todoTotalCount:this.todoLimit<this.todoList.length},doneHasNext:function(){return w.a.includes(this.curModuleCode)?this.doneList.length<this.doneTotalCount:this.doneLimit<this.doneList.length},ccHasNext:function(){return w.a.includes(this.curModuleCode)?this.ccList.length<this.ccTotalCount:this.ccLimit<this.ccList.length}},watch:{showSearch:function(t){var e=this;t&&this.$nextTick((function(){e.$refs["todo-list-search"]&&e.$refs["todo-list-search"].focus()}))},searchKeyword:function(t){var e=this;this.isInited&&(clearTimeout(this.searchTimer),this.searchTimer=setTimeout((function(){if(e.curModule.todo.online){if("templet-plan-v2"===e.curModule.code)return e.getList();e.filterList()}else e.isLoading=!0,i=null,e.getList()}),300))}},activated:function(){this.errorType="",this.emptyTips="",this.$router.isBack||(this.tabIndex={todo:0,done:1,cc:2}[this.$route.params.tab||"todo"]),this.init(),Object(_.e)(this.init)},deactivated:function(){g.a.closePopup()},beforeRouteUpdate:function(t,e,o){"TodoList"===t.name&&t.name===e.name&&t.params.module!==e.params.module&&this.init(t.params.module),o()},methods:{init:function(e){var o=this;e=e||this.$route.params.module;var n=!1;t.each(r.a.moduleList,(function(t){if(t.code===e)return n=t.todo&&t.todo.online,!1})),void 0!==this.$route.query.online?"string"==typeof this.$route.query.online?this.isOnline="true"===this.$route.query.online:this.isOnline=this.$route.query.online:this.isOnline=n;var a=m.a.getObject(b.a.HOME_PAGE_DEFAULT_PROJECT,m.a.level.user)||{};this.isInited=!1,(this.curProjId!==a.id||this.curModuleCode!==e||this.isPageLoadModule)&&(this.isLoading=!0,this.todoList=[],this.doneList=[],this.ccList=[],this.cloneTodoList=[],this.cloneDoneList=[],this.cloneCclist=[],this.todoLimit=10,this.doneLimit=10,this.ccLimit=10,this.toggleSearch(!1),i=null,d.default.setLocalChanged()),this.curProjId=a.id,this.curModuleCode=e,this.$store.commit("global/SET_TODO_LIST_HAS_UNREAD",!1),this.$store.commit("global/SET_CC_LIST_HAS_UNREAD",!1),this.getList().then((function(){o.isInited=!0})).then((function(){o.addTrack()}))},addTrack:function(){var t=this;return s.a.getHasNetwork().then((function(e){var o="";o="process-accept"===t.curModuleCode?"工序验收v1":"process-accept-v2"===t.curModuleCode?"工序验收v2":"process-accept-v3"===t.curModuleCode?"工序验收v3":t.curModule.name||"";var i="待办-".concat(o,"-").concat(e?"有网络":"无网络");C.a.addTrack(i),e||(t.errorType="error",t.emptyTips="当前无网络连接")}))},backEvent:function(){window.__YL_SUPER_APP__?__YL__.router.todo():this.$router.replace("/layout/todo",!0)},getCurModule:function(){var e=this,o=this.curModuleCode;return this.curModule&&this.curModule.code===o?Promise.resolve(this.curModule):h.a.getModuleList().then((function(i){var n=o&&t.find(i,{code:o});return n?(e.curModule=n,e.curModule):!n&&i.length?(e.curModule=i[0],e.curModule):(e.curModule={},e.$router.go(-1),Promise.reject("获取模块错误"))}))},getList:function(e){var o=this;if(this.isPageLoadModule)return this.getPageLoadingList(e);var n,a,s=this.curModuleCode,r=this.curProjId,c=this.searchKeyword;return d.default.hasLocalChanged(i)||this.curModule.todo.online?(f.a.clearFilterItems(),this.hasFilterRule=!1,this.getCurModule().then((function(){return f.a.getFilterItems(s,r).then((function(t){n=t,o.filterItems=t,o.hasFilterRule=f.a.hasFilterRule()}))})).then((function(){return g.a.getSort(s,r).then((function(t){a=t,o.sort=t,o.hasSortRule=g.a.hasSortRule()}))})).then((function(){var e=o.curModule.todo.service,d=L.a[e];return h.a.queryAll(d,n,c,a,o.curModule).then((function(e){if(s===o.curModuleCode&&r===o.curProjId&&n===o.filterItems&&c===o.searchKeyword&&a===o.sort){o.todoList=e[0],o.doneList=e[1],o.ccList=e[2],o.cloneTodoList=t.clone(o.todoList),o.cloneDoneList=t.clone(o.doneList),o.cloneCclist=t.clone(o.ccList),o.isLoading=!1;var d=t.some(o.todoList,(function(t){return!!t.unread})),l=t.some(o.ccList,(function(t){return!!t.unread}));o.$store.commit("global/SET_TODO_LIST_HAS_UNREAD",d),o.$store.commit("global/SET_CC_LIST_HAS_UNREAD",l),o.curModule.todo.online||(i=v.a.now())}}))})).then((function(){o.errorType="",o.emptyTips="",h.a.setHotPoint()})).catch((function(t){console.log("error",t),o.isLoading=!1,o.errorType="error",o.emptyTips=t.errmsg,o.todoList=[],o.doneList=[],o.ccList=[]}))):Promise.resolve()},openFilter:function(){var t=this;p.a.openPopup({moduleCode:this.curModuleCode,projId:this.curProjId,callback:function(e){t.isLoading=!0,i=null,console.log("res",e),t.getList()}}),g.a.closePopup()},filterList:function(){var e=this;this.todoList=t.filter(this.cloneTodoList,(function(t){return t.item_name&&t.item_name.includes(e.searchKeyword)})),this.doneList=t.filter(this.cloneDoneList,(function(t){return t.item_name&&t.item_name.includes(e.searchKeyword)})),this.ccList=t.filter(this.cloneCcList,(function(t){return t.item_name&&t.item_name.includes(e.searchKeyword)}))},openSort:function(){var t=this;g.a.show?g.a.closePopup():g.a.openPopup({moduleCode:this.curModuleCode,projId:this.curProjId,callback:function(e){t.isLoading=!0,i=null,t.getList()}})},toggleSearch:function(e){t.isBoolean(e)?this.showSearch=e:this.showSearch=!this.showSearch,this.showSearch||(this.searchKeyword="")},clearKeyword:function(){this.searchKeyword=""},listAddPage:(n=Object(a.a)(regeneratorRuntime.mark((function t(e){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=this.curModuleCode,w.a.includes(o)&&!this["".concat(e,"PageLoading")]?(this["".concat(e,"Page")]++,this.getList(e)):"todo"===e?this.todoLimit=this.todoLimit+10:"done"===e?this.doneLimit=this.doneLimit+10:"cc"===e&&(this.ccLimit=this.ccLimit+10);case 2:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)}),gotoDetail:function(e){if(t.isEmpty(this.curModule))$log.error("待办，获取模块信息出错");else{var o=null,i={},n={},a={};this.curModule.todo.getView&&(o=this.curModule.todo.getView(e)),o||(o=t.find(this.curModule.todo.views,(function(o){return t.matches(o.match)(e)}))),o||$log.error("未找到匹配的路由"),t.each(o.params||{},(function(t,o){i[o]=e[t]})),t.each(o.query||{},(function(t,o){"process_accept"===e.type&&90===Number(e.process_mode)?n[o]="building_id"===t?e.location_parent_id:"unit"===t?e.location_id:e[t]:n[o]=e[t]})),t.each(o.primaryKeys||{},(function(t,o){e[t]&&(a[o]=e[t])})),t.isEmpty(a)||(n.primaryKeys=JSON.stringify(a)),h.a.updateReadingTime(e);var s=t.some(this.todoList,(function(t){return!!t.unread})),r=t.some(this.ccList,(function(t){return!!t.unread}));this.$store.commit("global/SET_TODO_LIST_HAS_UNREAD",s),this.$store.commit("global/SET_CC_LIST_HAS_UNREAD",r),this.$router.push({name:o.name,params:i,query:n})}}},beforeRouteLeave:function(t,e,o){this.toggleSearch(!1),o()}}}).call(this,o("391c"))},4939:function(t,e,o){"use strict";o.r(e);var i=o("407a").a,n=(o("3175"),o("17cc")),a=Object(n.a)(i,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("page-content",{attrs:{title:t.curModule&&t.curModule.name?"待办-"+t.curModule.name:"...","on-close":t.backEvent}},[t.showSearch?t._e():o("template",{slot:"header-bar-right"},["templet-plan"!==t.curModule.code&&"templet-plan-v2"!==t.curModule.code&&"process-accept-v3"!==t.curModule.code&&"closed-water-test"!==t.curModule.code?o("div",{staticClass:"header-btn",on:{click:t.openFilter}},[o("icon",{attrs:{name:"nav-filter"}}),t.hasFilterRule?o("i",{staticClass:"badge"}):t._e()],1):t._e(),"check"===t.curModule.code||"check-safety"===t.curModule.code||"check-quality"===t.curModule.code?o("div",{directives:[{name:"track",rawName:"v-track",value:"待办-现场检查-排序",expression:"'待办-现场检查-排序'"}],staticClass:"header-btn",on:{click:t.openSort}},[o("icon",{attrs:{name:"nav-sort"}}),t.hasSortRule?o("i",{staticClass:"badge"}):t._e()],1):t._e(),"check"!==t.curModule.code&&"check-safety"!==t.curModule.code&&"check-quality"!==t.curModule.code&&"process-accept-v3"!==t.curModule.code&&"closed-water-test"!==t.curModule.code&&"schedule-plan"!==t.curModule.code?o("div",{staticClass:"header-btn",on:{click:t.toggleSearch}},[o("icon",{attrs:{name:"nav-search"}})],1):t._e()]),t.showSearch?o("div",{staticClass:"search-bar",attrs:{slot:"header-bar"},slot:"header-bar"},[o("div",{staticClass:"search-bar-con"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.searchKeyword,expression:"searchKeyword"}],ref:"todo-list-search",staticClass:"search-bar-input",attrs:{id:"todo-list-search",type:"text",placeholder:t.searchPlaceholder[t.curModuleCode]?t.searchPlaceholder[t.curModuleCode]:"检查项/问题描述/处理人"},domProps:{value:t.searchKeyword},on:{input:function(e){e.target.composing||(t.searchKeyword=e.target.value)}}}),t.searchKeyword?o("label",{staticClass:"search-bar-clear",attrs:{for:"todo-list-search"},on:{click:t.clearKeyword}}):t._e()]),o("div",{staticClass:"search-bar-btn",on:{click:t.toggleSearch}},[t._v("取消")])]):t._e(),o("swipe-tabs",{model:{value:t.tabIndex,callback:function(e){t.tabIndex=e},expression:"tabIndex"}},[t.isOnline?t._e():o("synchronize-tip-bar",{attrs:{slot:"fixed","is-todo":""},slot:"fixed"}),o("swipe-tab",{attrs:{title:"待办("+t.todoNumber+")"}},[o("scroller",{attrs:{"has-next":t.todoHasNext,"is-empty":!t.todoListShow.length,"is-sync":!t.isOnline,"has-pull-down":!t.isOnline},on:{pullDown:t.getList,loadNext:function(e){t.listAddPage("todo")}}},[t.isLoading?t._e():[t._l(t.todoListShow,(function(e,i){return o("todo-item",{key:i,attrs:{item:e},on:{click:function(o){t.gotoDetail(e)}}})})),t.todoList.length&&t.isPageLoadModule?o("div",{staticClass:"page-loading"},[t.todoPageLoading?o("van-loading",{attrs:{type:"spinner",size:"24px"}},[t._v("加载中...")]):t._e(),!t.todoPageLoading&&t.todoFinished?o("p",[t._v("没有更多了")]):t._e()],1):t._e()],o("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.todoList.length,"empty-text":t.emptyTips||"这里暂无问题",type:t.errorType||(t.showSearch?"search":"todo")}})],2)],1),o("swipe-tab",{attrs:{title:"已办("+t.doneNumber+")"}},[o("scroller",{attrs:{"has-next":t.doneHasNext,"is-empty":!t.doneListShow.length,"is-sync":!t.isOnline,"has-pull-down":!t.isOnline},on:{pullDown:t.getList,loadNext:function(e){t.listAddPage("done")}}},[t.isLoading?t._e():[t._l(t.doneListShow,(function(e,i){return o("todo-item",{key:i,attrs:{item:e},on:{click:function(o){t.gotoDetail(e)}}})})),t.doneList.length&&t.isPageLoadModule?o("div",{staticClass:"page-loading"},[t.donePageLoading?o("van-loading",{attrs:{type:"spinner",size:"24px"}},[t._v("加载中...")]):t._e(),!t.donePageLoading&&t.doneFinished?o("p",[t._v("没有更多了")]):t._e()],1):t._e(),t.isPageLoadModule?[t.doneList.length&&t.doneFinished?o("div",{staticClass:"item-list-tip"},[t._v("\n              "+t._s("templet-plan"===t.curModule.code?"已处理完毕超过3天的问题可在工作台查看":"已处理完毕超过3天的问题请在PC端报表查看")+"\n            ")]):t._e()]:[t.doneList.length?o("div",{staticClass:"item-list-tip"},[t._v("\n              "+t._s("templet-plan"===t.curModule.code?"已处理完毕超过3天的问题可在工作台查看":"已处理完毕超过3天的问题请在PC端报表查看")+"\n            ")]):t._e()]],o("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.doneList.length,"empty-text":t.emptyTips||"这里暂无问题",type:t.errorType||(t.showSearch?"search":"todo")}})],2)],1),o("swipe-tab",{attrs:{title:"抄送("+t.ccNumber+")"}},[o("scroller",{attrs:{"has-next":t.ccHasNext,"is-empty":!t.ccListShow.length,"is-sync":!t.isOnline,"has-pull-down":!t.isOnline},on:{pullDown:t.getList,loadNext:function(e){t.listAddPage("cc")}}},[t.isLoading?t._e():[t._l(t.ccListShow,(function(e,i){return o("todo-item",{key:i,attrs:{item:e},on:{click:function(o){t.gotoDetail(e)}}})})),t.ccList.length&&t.isPageLoadModule?o("div",{staticClass:"page-loading"},[t.ccPageLoading?o("van-loading",{attrs:{type:"spinner",size:"24px"}},[t._v("加载中...")]):t._e(),!t.ccPageLoading&&t.ccFinished?o("p",[t._v("没有更多了")]):t._e()],1):t._e(),t.isPageLoadModule?[t.ccList.length&&t.ccFinished?o("div",{staticClass:"item-list-tip"},[t._v("\n              "+t._s("templet-plan"===t.curModule.code?"已处理完毕超过3天的问题可在工作台查看":"已处理完毕超过3天的问题请在PC端报表查看")+"\n            ")]):t._e()]:[t.ccList.length?o("div",{staticClass:"item-list-tip"},[t._v("\n              "+t._s("templet-plan"===t.curModule.code?"已处理完毕超过3天的问题可在工作台查看":"已处理完毕超过3天的问题请在PC端报表查看")+"\n            ")]):t._e()]],o("loading-status",{attrs:{"is-loading":t.isLoading,"is-empty":!t.ccList.length,"empty-text":t.emptyTips||"这里暂无问题",type:t.errorType||(t.showSearch?"search":"todo")}})],2)],1)],1)],2)}),[],!1,null,"b064f224",null);e.default=a.exports},"4fd3":function(t,e,o){"use strict";(function(t){var i=o("915f"),n=o("04f3"),a=o("07d2"),s=o("4360"),r={check:[{id:1,name:"默认",field:"order_weight",direct:"desc"},{id:2,name:"按楼栋楼层",field:"order_building",direct:"desc"},{id:3,name:"按登记时间正序",field:"regist_date",direct:"asc"},{id:4,name:"按登记时间倒序",field:"regist_date",direct:"desc"}],"check-safety":[{id:1,name:"默认",field:"order_weight",direct:"desc"},{id:2,name:"按楼栋楼层",field:"order_building",direct:"desc"},{id:3,name:"按登记时间正序",field:"regist_date",direct:"asc"},{id:4,name:"按登记时间倒序",field:"regist_date",direct:"desc"}],"check-quality":[{id:1,name:"默认",field:"order_weight",direct:"desc"},{id:2,name:"按楼栋楼层",field:"order_building",direct:"desc"},{id:3,name:"按登记时间正序",field:"regist_date",direct:"asc"},{id:4,name:"按登记时间倒序",field:"regist_date",direct:"desc"}]};e.a={name:"TodoFilter",components:{Item:a.a},mixins:[i.a],store:s.a,data:function(){return{show:!1,showList:!1,isLoading:!0,selected:{},sortList:[],moduleCode:"",projId:"",callback:null,backButtonEvent:null}},computed:{isAndroid:function(){return this.$store.state.app.isAndroid},isIOS:function(){return this.$store.state.app.isIOS},isIOSBezelLess:function(){return this.$store.state.app.isIOSBezelLess}},watch:{show:function(t){var e=this;t&&this.$nextTick((function(){e.showList=!0}))}},mounted:function(){this.data=[]},methods:{openPopup:function(e){this.value=!0,this.show=!0,this.callback=e.callback;var o=r[e.moduleCode];o?((t.isEmpty(this.selected)||this.moduleCode!==e.moduleCode||this.projId!==e.projId)&&(this.selected=o[0]),this.moduleCode=e.moduleCode,this.projId=e.projId,this.sortList=o,this.backButtonEvent||(this.backButtonEvent=Object(n.a)(this.closePopup))):this.sortList=[]},closePopup:function(){this.value=!1,this.showList=!1,this.backButtonEvent&&(Object(n.c)(this.backButtonEvent),this.backButtonEvent=null)},onClose:function(){this.show=!1},select:function(t){var e=this;this.selected=t,setTimeout((function(){e.callback&&e.callback(t),e.closePopup()}),100)},getSort:function(e,o){var i=r[e];return i?t.isEmpty(this.selected)||this.moduleCode!==e||this.projId!==o?Promise.resolve(i[0]):Promise.resolve(this.selected):Promise.resolve("")},hasSortRule:function(){return!t.isEmpty(this.selected)&&!t.isEmpty(this.sortList)&&this.selected.id!==this.sortList[0].id}}}}).call(this,o("391c"))},"65e9":function(t,e,o){"use strict";(function(t){o("5ab2"),o("6d57"),o("e10e");var i=o("28f8"),n=o("4360"),a=o("48f4"),s=o("162a"),r=o("f2d3"),c=o("6906"),d=o("a18c"),l=o("c745");function u(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,i)}return o}function h(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?u(Object(o),!0).forEach((function(e){Object(i.a)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}e.a={name:"SynchronizeTipBar",props:{isTodo:{type:Boolean},useDownload:{type:Boolean,default:!0},enterDoCheck:{type:Boolean,default:!0},buildingId:{type:String,default:""},automaticUpdateCallback:{type:Function,default:null}},data:function(){return{currentModuleCode:"",oneUpdateData:!0}},computed:{projId:function(){return n.a.state.global.currentProject.id},waitUploadNum:function(){return n.a.state.global.waitUploadNum},hasTopProgress:function(){return n.a.state.global.hasTopProgress},hasChanged:function(){if(!this.useDownload)return!1;if(this.currentModuleCode){var t,e=a.default.isModuleNeedBuilding(this.currentModuleCode)&&!this.isTodo;return!(e&&!this.buildingId)&&(t=this.isTodo?n.a.state.global.todoChangedStatus||{}:n.a.state.global.businessChangedStatus||{},e?!!t[this.currentModuleCode]&&t[this.currentModuleCode][this.buildingId]:t[this.currentModuleCode])}return!1},show:function(){return(this.hasChanged||this.waitUploadNum)&&!this.hasTopProgress},oneDataSync:function(){return this.$store.state.app.oneDataSync}},watch:{hasChanged:function(t){var e=this;t&&this.$nextTick((function(){setTimeout((function(){var t=e.$refs["synchronize-tip-bar"];if(t&&t.style){t.style.display="none";var o=t.offsetHeight;t.style.display="block",$log.log(o)}}),100)}))},buildingId:function(t){this.currentModuleCode&&a.default.isModuleNeedBuilding(this.currentModuleCode)&&t&&(console.log("楼栋重新加载，是否再次自动加载数据：",this.oneUpdateData),this.oneUpdateData&&this.automaticLogic(),this.checkSync())},show:function(t){t?this.$emit("show"):this.$emit("hide")}},activated:function(){this.init()},methods:{init:function(){this.getCurrentModuleCode(),this.enterDoCheck&&!d.a.isBack&&this.checkSync(),this.automaticLogic()},automaticLogic:function(){var t=this;this.$router.isBack||(this.oneUpdateData=!0,l.a.getAutomaticLoadData().then((function(e){$log.log("是否要自动加载 ===> ",e&&t.oneDataSync&&"function"==typeof t.automaticUpdateCallback),e&&t.oneDataSync&&"function"==typeof t.automaticUpdateCallback&&t.dataSync().then((function(e){console.log("是否需要初始化页面 ====> ",Boolean(e)),e&&t.automaticUpdateCallback()}))})))},getCurrentModuleCode:function(){var t=a.default.getCurrentModuleCode(),e=this.isTodo?"todo":"";this.currentModuleCode=t||e},checkSync:function(){var e=this,o="checkDataUpdate",i=this.currentModuleCode,s=this.buildingId,d=n.a.state.global.isLeader?this.projId:"";return!a.default.isModuleNeedBuilding(i)||s||this.isTodo?(this.isTodo&&(o+="_todo"),i&&(o+="_".concat(i)),s&&(o+="_".concat(s)),c.a.execAfterInterval(120,o).then((function(){return e.isTodo?"todo"===i?r.a.getModuleList().then((function(e){var o=t.map(e,"code");return a.default.hasTodoChangedData("",o)})):a.default.hasTodoChangedData("",[i]):a.default.hasBusinessChangedData(d,[i],s)})).then((function(t){if(e.isTodo){var o=h({},n.a.state.global.todoChangedStatus);o[i]=t,n.a.commit("global/SET_TODO_CHANGED_STATUS",o)}else{var a=h({},n.a.state.global.businessChangedStatus);if(s){var r=a[i]?a[i]:{};r[s]=t,a[i]=r}else a[i]=t;n.a.commit("global/SET_BUSINESS_CHANGED_STATUS",a)}})).catch((function(t){return t&&!0===t.timeNotTo?($log.debug(t.msg),!1):$q.reject(t)}))):Promise.resolve()},dataSync:function(){var t=this.currentModuleCode,e=this.buildingId,o=a.default.isModuleNeedBuilding(t),i=o&&!e;return $log.log("模块名：",t," 楼栋id：",e," 当前模块是否需要楼栋id：",o," 判断是否终止自动更新：",i),i?Promise.resolve():(this.oneUpdateData=!1,s.a.beginManualUpdate(),a.default.checkSync(e).then((function(t){return s.a.endManualUpdate(),t})).catch((function(t){$log.error("自动更新错误",t),s.a.endManualUpdate()})))}}}}).call(this,o("391c"))},"6e6b":function(t,e,o){"use strict";var i=o("329b"),n=o("4fd3").a,a=(o("eabe"),o("17cc")),s=Object(a.a)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.show?o("div",{staticClass:"todo-sort-corver",class:{ios:t.isIOS,"ios-bezel-less":t.isIOSBezelLess},on:{click:function(e){return e.target!==e.currentTarget?null:t.closePopup(e)}}},[o("transition",{attrs:{name:"slide-down"},on:{afterLeave:t.onClose}},[t.showList?o("div",{staticClass:"todo-sort"},t._l(t.sortList,(function(e,i){return o("item",{key:i,attrs:{text:e.name,border:"bottom","icon-right":e.id===t.selected.id?"qualified":""},on:{click:function(o){t.select(e)}}})}))):t._e()])],1):t._e()}),[],!1,null,"205f8364",null).exports,r=!1;r||(r=new(i.default.extend(s))({el:document.createElement("div")}),document.body.appendChild(r.$el));e.a=r},"8d4c":function(t,e,o){(t.exports=o("690e")(!1)).push([t.i,".zjapp .synchronize-tip-bar[data-v-aaf184a8]{height:30px;padding:5px 15px;line-height:20px;text-align:center;background-color:#ffe6e6;color:#ff6060;font-size:14px}.zjapp .synchronize-tip-bar .icon-caution[data-v-aaf184a8]{line-height:20px;margin-right:5px}@media screen and (-webkit-min-device-pixel-ratio:1){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 100%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:1.5){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 66.6667%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 50%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:2.625){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 38.0952%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:3){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 33.3333%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}@media screen and (-webkit-min-device-pixel-ratio:4){.zjapp .synchronize-tip-bar[data-v-aaf184a8]{border:none;background-image:linear-gradient(0deg,#ffd3d3,#ffd3d3 25%,transparent 0);background-size:100% 1px;background-repeat:no-repeat;background-position:bottom}}",""])},9747:function(t,e,o){var i=o("5454");(t.exports=o("690e")(!1)).push([t.i,"[data-v-b064f224] .search-bar{display:flex;align-items:center;align-content:center;padding-left:15px}[data-v-b064f224] .search-bar .search-bar-con{position:relative;flex:1}.zjapp .search-bar-input[data-v-b064f224]{display:block;width:100%;height:30px;line-height:30px;padding:0 32px;font-size:14px;border-radius:3px;border:none;color:#333;background:url("+i(o("793a"))+") no-repeat 6px 6.25px #fff;background-size:18px 17.5px;background-color:#f4f5f7}.zjapp .search-bar-clear[data-v-b064f224]{position:absolute;top:0;right:0;width:30px;height:30px;background:url("+i(o("7b08"))+") 50% no-repeat;background-size:20px 20px}[data-v-b064f224] .search-bar-btn{height:44px;line-height:44px;padding:0 10px;font-size:16px;white-space:nowrap}.zjapp .item-list-tip[data-v-b064f224]{height:70px;line-height:60px;color:#b4b4b4;text-align:center}.zjapp .scroll-warp[data-v-b064f224],.zjapp .van-tab__pane[data-v-b064f224],.zjapp .van-tabs[data-v-b064f224],.zjapp .van-tabs__track[data-v-b064f224],[data-v-b064f224] .van-tabs__content{height:100%}.zjapp .page-loading p[data-v-b064f224]{color:#b3b3b3;margin:8px 0;font-size:14px}",""])},a7b6:function(t,e,o){"use strict";o("394b")},aa7a:function(t,e,o){var i=o("21e0");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,o("85cb").default)("5326bf83",i,!0,{sourceMap:!1,shadowMode:!1})},c371:function(t,e,o){var i=o("9747");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,o("85cb").default)("1a6ff910",i,!0,{sourceMap:!1,shadowMode:!1})},c3df:function(t,e,o){"use strict";(function(t){o("e697");var i=o("4c09"),n=o("5694"),a=o("de61"),s=o("f2d3"),r=o("6e6b");e.a={data:function(){return{todoPageLoading:!1,donePageLoading:!1,ccPageLoading:!1,todoFinished:!1,doneFinished:!1,ccFinished:!1,todoPage:1,donePage:1,ccPage:1,todoTotalCount:0,doneTotalCount:0,ccTotalCount:0}},methods:{getPageLoadingList:function(e){var o,c,d=this,l=this.curModuleCode,u=this.curProjId,h=this.searchKeyword;return n.a.clearFilterItems(),this.hasFilterRule=!1,this.getCurModule().then((function(){return n.a.getFilterItems(l,u).then((function(t){o=t,d.filterItems=t,d.hasFilterRule=n.a.hasFilterRule()}))})).then((function(){return r.a.getSort(l,u).then((function(t){c=t,d.sort=t,d.hasSortRule=r.a.hasSortRule()}))})).then((function(){var n=d.curModule.todo.service,r=a.a[n],l=e?{type:e,page:d["".concat(e,"Page")]}:{};return e?(d["".concat(e,"Finished")]=!1,d["".concat(e,"PageLoading")]=!0):(d.todoTotalCount=0,d.doneTotalCount=0,d.ccTotalCount=0),s.a.queryAll(r,o,h,c,d.curModule,l).then((function(o){if(console.log("在线分页加载待办列表查询结果 ==== ",o),e){var n=d["".concat(e,"List")];d["".concat(e,"List")]=[].concat(Object(i.a)(n),Object(i.a)(o.items)),d["".concat(e,"Page")]=o.pagination.page,d["".concat(e,"PageLoading")]=!1,d["".concat(e,"Finished")]=o.pagination.total_count===d["".concat(e,"List")].length,console.log(o.pagination.total_count,d["".concat(e,"List")].length)}else{var a=t.find(o,(function(t){return 1===t.type}))||{},s=t.find(o,(function(t){return 2===t.type}))||{},r=t.find(o,(function(t){return 3===t.type}))||{};d.todoList=a.items||[],d.doneList=s.items||[],d.ccList=r.items||[],d.todoPage=t.get(a,"pagination.page"),d.donePage=t.get(s,"pagination.page"),d.ccPage=t.get(r,"pagination.page"),d.todoTotalCount=t.get(a,"pagination.total_count"),d.doneTotalCount=t.get(s,"pagination.total_count"),d.ccTotalCount=t.get(r,"pagination.total_count")}d.isLoading=!1;var c=t.some(d.todoList,(function(t){return!!t.unread})),l=t.some(d.ccList,(function(t){return!!t.unread}));d.$store.commit("global/SET_TODO_LIST_HAS_UNREAD",c),d.$store.commit("global/SET_CC_LIST_HAS_UNREAD",l)}))})).then((function(){d.errorType="",d.emptyTips="",s.a.setHotPoint()})).catch((function(t){console.log("error",t),d.isLoading=!1,d.errorType="error",d.emptyTips=t.errmsg,d.todoList=[],d.doneList=[],d.ccList=[]}))}}}}).call(this,o("391c"))},e89f:function(t,e,o){"use strict";var i=o("04f3"),n=o("cf09"),a=o("4360"),s=0;e.a={name:"PopupMixin",data:function(){return{backButtonEvent:null}},watch:{show:function(t){var e=this;if(t){if(this.$nextTick((function(){e.$el&&e.$el.style&&(e.$el.style.zIndex=++n.a.zIndex,s++,a.a.commit("app/SET_HAS_POPUP",!!s))})),!this.backButtonEvent){var o=this.close||this.closePopup;this.backButtonEvent=Object(i.a)(o)}}else--s<0&&(s=0),a.a.commit("app/SET_HAS_POPUP",!!s),this.backButtonEvent&&(Object(i.c)(this.backButtonEvent),this.backButtonEvent=null)}},methods:{}}},eabe:function(t,e,o){"use strict";o("aa7a")},f7ab:function(t,e,o){"use strict";var i=o("65e9").a,n=(o("a7b6"),o("17cc")),a=Object(n.a)(i,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.show?o("div",{ref:"synchronize-tip-bar",staticClass:"synchronize-tip-bar"},[o("icon",{attrs:{name:"caution"}}),t.waitUploadNum?o("span",[t._v("您有"+t._s(t.waitUploadNum)+"条数据待上传")]):t._e(),!t.waitUploadNum&&t.hasChanged?o("span",[t._v("有新数据")]):t._e(),t._v("\n  ，下拉可"+t._s(t.waitUploadNum?"上传":"刷新")+"\n")],1):t._e()}),[],!1,null,"aaf184a8",null);e.a=a.exports}}]);