(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-58b6ba22"],{"0a37":function(e,t,n){var i=n("1c4e");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var r=n("85cb").default;r("76d9ba51",i,!0,{})},1390:function(e,t,n){"use strict";n("9dd9"),n("6d57"),n("cc57"),n("e697"),n("f548");var i=n("fd50"),r=n("a14a"),o=n.n(r),c=n("07a4"),a=n("3fa2"),s=n("0cd9"),l=n("5c1b"),d=n("8fee"),m=n("85cd"),h="[model]/problem-check-item-model.js：",u=a["a"].room,f=[],p=null,I={},_={},g=function(e){if(!o.a.isEmpty(y.model.endCheckItems)){var t=[],n=o.a.isEmpty(f),i=e.toLowerCase(),r=e.toUpperCase();o.a.each(y.model.endCheckItems,(function(o){(o.item_full_name.indexOf(i)>-1||o.item_full_name.indexOf(r)>-1)&&t.push({id:o.item_id,name:o.item_name,full_name:o.item_full_name,name_color:o.item_full_name.replace(p,'<span class="color-blue">'+e+"</span>")}),n&&f.push(o.item_id)})),console.log("个数",y.model.endCheckItems.length,f.length),n&&(f='"'+f.join('","')+'"'),I.checkItem.data=t}return console.log(h,"搜索检查项",[I.checkItem.data,f]),k(e)},k=function(e){return d["a"].searchDesc(e,f).then((function(t){return t=o.a.filter(t,(function(e){return o.a.find(y.model.endCheckItems,{item_id:e.item_id})})),o.a.each(t,(function(t){var n=o.a.find(y.model.endCheckItems,{item_id:t.item_id});t.item_name=n.item_name,t.item_full_name=n.item_full_name,t.name_color=t.item_full_name+"-"+t.name.replace(p,'<span class="color-blue">'+e+"</span>")})),I.desc.data=I.desc.data.concat(t),console.log(h,"搜索问题描述",[I.desc.data]),b(e)}))},b=function(e){return m["a"].searchByItems(e,f).then((function(t){o.a.each(t,(function(t){t.name_color=t.item_full_name+"-"+t.desc_name+"；"+t.name.replace(p,'<span class="color-blue">'+e+"</span>")})),I.remark.data=I.remark.data.concat(t),console.log(h,"搜索补充说明",[I.remark.data])}))},v=function(){y.model.searchResult.checkItem.data=[],y.model.searchResult.desc.data=[],y.model.searchResult.remark.data=[],I.checkItem.data=[],I.desc.data=[],I.remark.data=[]},y={model:{},initSearch:function(){I={checkItem:{title:"检查项",data:[]},desc:{title:"问题描述",data:[]},remark:{title:"补充说明",data:[]}},y.model.endCheckItems=[],f=[],y.model.searchResult=o.a.cloneDeep(I),"毛坯"===u.fitmentStandard?_.is_for_rough=1:"精装"===u.fitmentStandard&&(_.is_for_decorated=1)},initCheckItem:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return f=[],y.model.positionId=e,y.model.checkItems=[],y.initSearch(),l["a"].getCheckItemList(u.batchRoomId,e,t,u.fitmentStandard,u.isVirtual).then((function(t){return y.model.checkItems=t,u.projectId=u.projectId||c["a"].state.projectList.currentItem.id,s["a"].getPositionEndItemForSearch(u.projectId,e,u.fitmentStandard,u.isVirtual)})).then((function(e){y.model.endCheckItems=e}))},initSpecialCheckItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return f=[],y.model.positionId=e,y.model.checkItems=[],l["a"].getBatchCheckItem(u.batchId||"","毛坯"===u.fitmentStandard,e).then((function(e){e.forEach((function(e){e.item_name=e.item_full_name,e.child_count=0,e.level=1})),y.model.checkItems=e}))},search:function(e){return v(),e?(p=new RegExp(e,"ig"),g(e).then((function(){y.model.searchResult=o.a.cloneDeep(I);var e=0;return o.a.each(y.model.searchResult,(function(t){e+=t.data.length})),e}))):i["a"].resolve(0)},reset:v};t["a"]=y},"1c4e":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .tip[data-v-829243a6] {\n  width: 250px;\n  text-align: center;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n.zhkf .tip img[data-v-829243a6] {\n    width: 200px;\n}\n.zhkf .tip p[data-v-829243a6] {\n    color: #a0a0a0;\n    line-height: 20px;\n    font-size: 14px;\n    margin: 0 auto;\n    text-align: center;\n    margin-top: 3px;\n}\n",""])},"26eb":function(e,t,n){e.exports=n.p+"img/search.37f508c9.png"},"3f2a":function(e,t,n){var i=n("b591");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var r=n("85cb").default;r("4dfc94dc",i,!0,{})},"5c1b":function(e,t,n){"use strict";n("f0e6");var i=n("bbed"),r=n("fa1b"),o=n("07a4"),c=n("fd50");function a(){var e=function(e){e&&e.fitment_standard&&("毛坯"===e.fitment_standard?e.is_for_rough=1:"精装"===e.fitment_standard&&(e.is_for_decorated=1),delete e.fitment_standard)},t=function(e,t,n,r,o){return i["a"].getCheckItemLeaf(e,t,r,o).then((function(e){if(_.isEmpty(e))return[];var t=[];return _.each(e,(function(e){t.push(e.id)})),i["a"].getCheckItemAll(t.join("','"),n,r,o)}))};return{getCheckItemList:function(e,n,r,a,s){var l="毛坯"==a,d=c["a"].when(),m=["全部"];return m.push(1==s?"公区":"房间"),m="('"+m.join("','")+"')",d=o["a"].state.app.global.isUseProjectItem?i["a"].getProjectCheckItemList(e,n,r,l,m):t(e,n,r,l,m),d.then((function(e){return e}))},hasProjectCheckitem:function(e){return i["a"].hasProjectCheckitem(e)},searchCheckItemWithProject:function(t,n,r,o){return e(r),o?i["a"].searchProjectCheckItem(o,t,n,r):i["a"].searchCheckItem(t,n,r)},searchCheckItem:function(t,n,r,o){return console.log("searchCheckItem: ",t,n,r),console.time("searchCheckItem"),e(r),i["a"].hasProjectCheckitem(o).then((function(e){return e?i["a"].searchProjectCheckItem(o,t,n,r):i["a"].searchCheckItem(t,n,r).finally((function(){console.timeEnd("searchCheckItem")}))}))},getHigherLevelTreeListByCheckItemId:function(t,n,r){return console.log("getHigherLevelTree: ",t,n,r),console.time("getHigherLevelTree"),e(r),i["a"].getHigherLevelTreeListByCheckItemId(t,n,r).finally((function(){console.timeEnd("getHigherLevelTree")}))},getCheckItemLevel:function(e,t){return i["a"].getCheckItemLevel(e,t)},getPositionItemByRoom:function(e,t,n){var r=c["a"].when(),a=["全部"];return a.push(1==n?"公区":"房间"),a="('"+a.join("','")+"')",r=o["a"].state.app.global.isUseProjectItem?i["a"].getProjectPositionItemByRoom(e,t,a):i["a"].getPositionItemByRoom(e,a),r.then((function(e){return e}))},setIsUseProjectItemOfBatchUnit:function(e){return i["a"].getProjectItemOfBatchUnit(e).then((function(e){var t=!1;e&&(t=!0),o["a"].commit("app/APP",{isUseProjectItem:t})}))},getBatchCheckItem:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return r["a"].getCheckItemList(e,t,n,o["a"].state.app.global.isUseProjectItem).then((function(e){return console.log("BatchCheckItem",e),c["a"].resolve(e)}))}}}t["a"]=a()},"5cf9":function(e,t,n){"use strict";var i={props:{isShow:{type:Boolean,default:!0},imgUrl:{type:String,required:!0},tipCont:{type:String,default:"系统繁忙请稍后重试"}}},r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticClass:"tip"},[n("img",{attrs:{src:e.imgUrl,alt:"tip"}}),e._v(" "),e.tipCont?n("p",{domProps:{innerHTML:e._s(e.tipCont)}}):e._e()])},o=[],c=n("d082");function a(e){n("0a37")}var s=!1,l=a,d="data-v-829243a6",m=null,h=Object(c["a"])(i,r,o,s,l,d,m);t["a"]=h.exports},6338:function(e,t,n){"use strict";n.r(t);n("5ab2"),n("e44b"),n("e10e"),n("cc57"),n("6d57"),n("c0c3");var i,r=n("28f8"),o=n("1390"),c=n("e810"),a=n("5cf9"),s=n("a14a"),l=n.n(s),d=n("882e"),m=n("f2de");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=!1,p="",I={name:"BatchSelectCheckitem",components:{tip:a["a"]},data:function(){return{model:{},title:"",loading:!1,items:[],parentItem:null,keyword:"",checkItemModel:{endCheckItems:[],searchResult:[]},parentItemId:"",fromType:"simulate",fromPage:"批量登记问题",showSearch:!1,currItemId:"",searchMode:!1,isBgWhite:!1,searchWord:"",searchNodata:!1,tipCont:"输入关键字进行搜索",searchHistory:[],searchLoading:!1,searchResult:[]}},computed:u({},Object(m["e"])({currentBatchType:function(e){return e.app.global.currentBatchType},currentMenuType:function(e){return e.app.global.currentMenuType},isIOSX:function(e){return e.app.global.isIOSX},isIOS:function(e){return e.app.global.isIOS}})),watch:{keyword:function(e){this.doSearch()}},created:function(){this.init()},methods:{init:function(){this.parentItemId=this.$route.query.parentItemId,this.model=d["a"].model,o["a"].initSearch(),this.checkItemModel=o["a"].model;var e=this.model.problem.selectedItem;console.log("model",this.model),console.log("checkItemModel",this.checkItemModel),this.loading=!0,this.model.checkItemTree||d["a"].createCheckItemTree(),this.parentItemId&&(this.parentItem=this.model.checkItemMap[this.parentItemId]),this.title=this.parentItem?this.parentItem.item_name:"选择检查项",this.currItemId=e&&e.item_id,this.items=this.parentItem?this.parentItem.children:this.model.checkItemTree,this.loading=!1,this.showSearch=1!==this.model.isSpecial,console.log(this.items)},select:function(e){var t=this.$route.query,n=t.level||2;if(e.children)return this.parentItem=e,this.title=e.item_name,this.items=e.children,this.$router.push({path:"/checkroom/".concat(this.currentMenuType||this.currentBatchType,"-batch-select-checkitem/").concat((new Date).getTime()),query:{parentItemId:this.parentItem.item_id,level:++n}}),!1;d["a"].updateCheckItem(e),this.$router.push({path:"/checkroom/".concat(this.currentMenuType||this.currentBatchType,"-batch-select-desc"),query:{fromType:this.fromType,fromPage:this.fromPage,level:this.$route.query.level||2}})},getUpdateParams:function(e){var t={};return i.checkItemId&&i.checkItemId!==e&&(t={descIds:"",descNames:"",contractors:"",contractorIds:"",responsibilityUnitIds:"",responsibilityUnits:""}),t},changeToSearchMode:function(){this.searchMode=!0,this.searchHistory.length||(this.searchHistory=c["a"].list),console.log("searchHistory",this.searchHistory);var e=this.$el.querySelectorAll('input[type="search"]');console.log(e),setTimeout((function(){e[1].focus()}),300)},changeToListMode:function(){this.searchMode=!1,this.clearInput()},clearSearchHistory:function(){c["a"].clear()},removeSearchHistory:function(e){c["a"].remove(e)},clearInput:function(){f=!1,this.keyword="",p="",this.searchNodata=!1,o["a"].reset(),this.searchResult=[],this.tipCont="输入关键字进行搜索"},doSearch:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(t&&(this.keyword=t),l.a.isEmpty(this.checkItemModel.endCheckItems)&&(console.log(this.model.checkItemTree),this.createSearchList(this.model.checkItemTree)),""===l.a.trim(this.keyword))return this.clearInput(),void(this.tipCont="输入关键字进行搜索");console.log("searchStatus ------- ",f),f||(this.searchNodata=!1,this.keyword!=p&&(this.searchLoading=!0,this.$toast.loading({mask:!0,message:"搜索中...",duration:0}),this.searchResult=[],p=this.keyword,f=!0,o["a"].search(this.keyword).then((function(t){console.log("dataLen",t),f=!1,e.$toast.clear(),e.searchLoading=!1,""!==e.keyword?0===t?(e.searchWord=e.keyword,e.searchNodata=!0,e.tipCont='没有找到与“<span style="color:#0099FF;">'+e.searchWord+"</span>”相关的结果"):(e.searchNodata=!1,e.searchResult=l.a.cloneDeep(e.checkItemModel.searchResult),console.log("===== searchResult =====",!e.searchLoading,e.searchNodata,!e.keyword),console.log("===== searchResult =====",e.checkItemModel.searchResult),console.log("===== searchResult =====",e.checkItemModel)):p=""})).catch((function(t){console.error(t),f=!1,e.$toast.clear(),e.searchLoading=!1}))))},createSearchList:function(e){var t=this;e.forEach((function(e){if(e.children)return t.createSearchList(e.children);t.checkItemModel.endCheckItems.push({item_id:e.item_id,item_name:e.item_name,item_full_name:e.item_full_name})})),console.log("创建搜索列表",this.checkItemModel)},clickSearchItem:function(e){c["a"].add(this.keyword);var t=null,n=null,i="",r=!1;e.item_id&&e.desc_id?(t=this.model.checkItemMap[e.item_id],n=[{id:e.desc_id,name:e.desc_name,selected:!0}],i=e.name||""):e.item_id?(t=this.model.checkItemMap[e.item_id],n=[{id:e.id,name:e.name,selected:!0}]):(r=!0,t=this.model.checkItemMap[e.id]),t&&d["a"].updateCheckItem(t),n&&d["a"].updateDesc(n),i&&d["a"].updateRemark(i),r?this.$router.push({path:"/checkroom/".concat(this.currentMenuType||this.currentBatchType,"-batch-select-desc"),query:{fromType:this.fromType,fromPage:this.fromPage,level:this.$route.query.level||2}}):this.$router.go(-1),this.clearInput()}}},_=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"box"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.searchMode,expression:"!searchMode"}],staticClass:"check-item-select"},[i("cus-nav-bar",{attrs:{title:e.title,"left-arrow":"",border:!1}}),e._v(" "),e.parentItemId?e._e():i("div",{on:{click:e.changeToSearchMode}},[i("van-search",{attrs:{placeholder:"搜索检查项/问题描述/补充说明",disabled:"true"}},[i("i",{staticClass:"iconfont icon-chazhao",attrs:{slot:"left-icon"},slot:"left-icon"})])],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&e.items.length,expression:"!loading && items.length"}],staticClass:"item-list"},e._l(e.items,(function(t,n){return i("van-cell",{key:n,class:{active:!t.children&&t.item_id===e.currItemId},attrs:{title:t.item_name,"is-link":t.children&&t.children.length>0},on:{click:function(n){return e.select(t)}}},[t.children||t.item_id!==e.currItemId?e._e():i("template",{slot:"right-icon"},[i("i",{staticClass:"iconfont icon-gou"})])],2)})),1),e._v(" "),e.loading||e.items.length?e._e():i("div",{staticClass:"tipBox"},[i("tip",{attrs:{"img-url":n("26eb"),"tip-cont":"当前部位尚未设置检查项"}})],1)],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.searchMode,expression:"searchMode"}],staticClass:"search",class:{"bg-white":e.isBgWhite}},[i("form",{staticClass:"search-form",class:{isIos:e.isIOS},attrs:{action:"/"}},[i("van-search",{attrs:{placeholder:"搜索检查项/问题描述/补充说明","show-action":"",background:"linear-gradient(90deg,rgba(28,176,253,1) 0%,rgba(0,153,255,1) 100%)"},on:{cancel:e.changeToListMode,search:e.doSearch,clear:e.clearInput},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[i("i",{staticClass:"iconfont icon-chazhao",attrs:{slot:"left-icon"},slot:"left-icon"})])],1),e._v(" "),i("section",{directives:[{name:"show",rawName:"v-show",value:!e.keyword&&e.searchHistory.length,expression:"!keyword && searchHistory.length"}],staticClass:"history"},[e._l(e.searchHistory,(function(t,n){return i("van-cell",{key:n,attrs:{"is-link":"",title:t},on:{click:function(n){return e.doSearch(t)}}},[i("template",{slot:"right-icon"},[i("i",{staticClass:"iconfont icon-CombinedShapeCopy",on:{click:function(n){return n.stopPropagation(),e.removeSearchHistory(t)}}})])],2)})),e._v(" "),i("div",{staticClass:"clear-history",on:{click:e.clearSearchHistory}},[e._v("清除全部搜索记录")])],2),e._v(" "),i("section",{staticClass:"result"},e._l(e.searchResult,(function(t,n){return t.data.length?i("section",{key:n,staticClass:"result-block"},[i("h2",[e._v(e._s(t.title))]),e._v(" "),i("van-cell-group",e._l(t.data,(function(t,n){return i("van-cell",{key:n,on:{click:function(n){return e.clickSearchItem(t)}}},[i("template",{slot:"title"},[i("span",{domProps:{innerHTML:e._s(t.name_color)}})])],2)})),1)],1):e._e()})),0),e._v(" "),e.searchLoading||!e.searchNodata&&(e.keyword||e.searchHistory.length)?e._e():i("div",{staticClass:"tipBox"},[i("tip",{attrs:{"img-url":n("26eb"),"tip-cont":e.tipCont}})],1)])])},g=[],k=n("d082");function b(e){n("3f2a")}var v=!1,y=b,C="data-v-4ed53bfe",w=null,x=Object(k["a"])(I,_,g,v,y,C,w);t["default"]=x.exports},"85cd":function(e,t,n){"use strict";var i=n("1834"),r=n("0938"),o="checkitem_remark_history",c={createCondition:function(e,t){if(_.isEmpty(e))return"";t=t?"crh.":"";var n=[];return _.each(e,(function(e,i){n.push(t+i+"="+e)})),n=n.join(" and "),n},insertHistory:function(e){e.id=r["a"].uuid(),e.used_time=e.used_time||1,e.last_used_time=e.last_used_time||r["a"].getNowDate();var t=[],n=[];return _.each(e,(function(e,i){t.push(i),n.push(e)})),i["a"].insert(o,t,n).then((function(){return e.id}))},updateHistory:function(e,t){return i["a"].update(o,e,t)},getOneHistory:function(e,t,n){var r="select * from "+o+" where item_id=? and desc_id=? and remark=?";return i["a"].queryOne(r,[e,t,n])},updateUserdTime:function(e,t){if(!t)return $q.error("次数不能为0");var n={last_used_time:r["a"].getNowDate(),used_time:t};return i["a"].update(o,n,{id:e})},getListByItemIdOrderDate:function(e,t){var n="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ?  order by crh.last_used_time desc limit "+t;return i["a"].query(n,[e])},getListByItemIdOrderUsedTime:function(e,t,n){var r=n.length?'and crh.id not in ("'+n.join('","')+'")':"",o="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ? "+r+" order by crh.used_time desc limit "+t;return i["a"].query(o,[e])},deleteItemById:function(e){var t="delete from checkitem_remark_history where id=?";return i["a"].query(t,[e])},searchByItems:function(e,t){var n="select crh.id,crh.remark as name,crh.item_id,ci.name as item_name,ci.full_name as item_full_name,crh.desc_id,cid.name as desc_name from checkitem_remark_history crh inner join check_item ci on ci.id = crh.item_id inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id in ("+t+') and (lower(crh.remark) like "%" || ? || "%" or upper(crh.remark) like "%" || ? || "%") order by crh.remark';return i["a"].query(n,[e,e])}},a=c,s={getList:function(e){if(!e)return $q.reject("itemId为空");var t=[];return a.getListByItemIdOrderDate(e,3).then((function(n){if(n){var i=[];return _.each(n,(function(e){i.push(e.id),t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),a.getListByItemIdOrderUsedTime(e,17,i).then((function(e){return e&&_.each(e,(function(e){t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),t}))}return $q.reject(t)}))},deleteItem:function(e){return a.deleteItemById(e)},upsertHistory:function(e,t,n){return a.getOneHistory(e,t,n).then((function(i){return i?a.updateUserdTime(i.id,i.used_time+1):a.insertHistory({item_id:e,desc_id:t,remark:n})}))},searchByItems:function(e,t){return a.searchByItems(e,t)}};t["a"]=s},8704:function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"882e":function(e,t,n){"use strict";n("cc57"),n("6d57");var i=n("fd50"),r=n("07a4"),o=n("bad1"),c=n("5c1b"),a=n("dd0a"),s=n("b643"),l=n("964e"),d=n("0938"),m=n("3fa2"),h=n("a593"),u=n("a14a"),f=n.n(u),p=n("bbed");function I(){var e={problem:{}},t=null,n="";function u(){if(t=null,e.positionItems={},e.cacheIntersectItems=[],e.diagramUrl="",e.allPositions=[],e.problemReasons=[],e.fitmentStandard=m["a"].room.fitmentStandard||"毛坯",e.points=[],e.checkItems=[],e.checkItemTree=null,e.checkItemMap=null,e.problem={},e.problem.batchRoomId="",e.problem.positions=[],e.problem.selectedItem=null,e.problem.selectedDesc=null,e.problem.problemImages=[],e.problem.remark="",e.problem.isPassedWhenAdd=0,e.problem.emergencyDegree="一般",e.problem.contractor=null,e.problem.responsibleCompany=null,e.problem.topItemId="",r["a"].state.app.global.enableProblemReason)return s["a"].getReasonConfig().then((function(t){e.problemReasons=e.problemReasons.concat(t)}))}function I(e,t){var n=[];return e.forEach((function(e){for(var i=t.length,r=0;r<i;r++)if(e.item_id===t[r].item_id){n.push(e);break}})),n}return{model:e,setRoomPosition:function(t){var i=h["default"].prototype.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"户型图加载中"});u(),e.roomTitle=t.roomTitle,e.diagramUrl=t.diagramUrl,e.allPositions=t.position,e.problem.batchUnitId=t.unitId,e.problem.batchRoomId=n=t.roomId,this.getPositionItem().then((function(){setTimeout((function(){i.clear(),console.log("关闭---------------")}),200)})).catch((function(e){return console.log(e)}))},getPositionItem:function(){return c["a"].getPositionItemByRoom(n,m["a"].room.projectId,m["a"].room.isVirtual).then((function(t){t.forEach((function(t){e.positionItems[t.position_id]||(e.positionItems[t.position_id]=[]),d["a"].getObjectFromArrayByProperty(e.positionItems[t.position_id],"item_id",t.item_id,!1)||e.positionItems[t.position_id].push({item_id:t.item_id,item_name:t.item_name,parent_item_id:t.parent_item_id,level:t.level})}))}))},checkPositionItem:function(t){if(!t)return null;e.problem.selectedItem=null;var n=e.positionItems[t];if(!n||!n.length)return!1;if(!e.cacheIntersectItems.length)return e.cacheIntersectItems.push(n),e.checkItems=n,e.checkItemTree=null,!0;var i=I(n,e.checkItems);return!(!i.length||!this.hasEndItem(i,t))&&(e.cacheIntersectItems.push(i),e.checkItems=i,e.checkItemTree=null,!0)},hasEndItem:function(t,n){for(var i=0;i<t.length;i++){for(var r=e.positionItems&&e.positionItems[n],o=r&&r.length,c=!0,a=0;a<o;a++)if(r[a].parent_item_id===t[i].item_id){c=!1;break}if(!0===c)return!0}return!1},getIntersectCheckItem:function(t,n,i){var r=[];if(t)for(var o=0;o<e.checkItems.length;o++)e.checkItems[o].parent_item_id===t&&r.push(e.checkItems[o]);else for(var c=0;c<e.checkItems.length;c++)1===e.checkItems[c].level&&r.push(e.checkItems[c]);return r.slice(n*i,(n+1)*i)},cancelPoint:function(){var t=e.cacheIntersectItems.length;t&&(e.cacheIntersectItems.pop(),e.checkItems=e.cacheIntersectItems[t-2]||[],e.problem.selectedItem=null,e.checkItemTree=null)},createRoomPosition:function(){var t={},n=[],i=e.allPositions,r=[];return e.points.forEach((function(e){var o=e.positionId,c={x:e.coordinate.x,y:e.coordinate.y,diagramId:e.diagramId},a=i.length,s=0;if(t[o])return t[o].points.push(c);for(;s<a;s++)if(o===i[s].id)return t[o]={positionId:o,positionName:"",points:[c]},r.push(o),n.push(t[o])})),e.problem.positions=n,this.setPositionName(r)},setPositionName:function(t){return t&&t.length?o["a"].getPositionByIds("'"+t.join("','")+"'").then((function(t){t&&t.length&&e.problem.positions.forEach((function(e){for(var n=t.length,i=0;i<n;i++)if(t[i].id===e.positionId){e.positionName=t[i].name;break}}))})):i["a"].resolve()},createCheckItemTree:function(){var t,n=[],i={};e.checkItems.forEach((function(e){var t,r=e.item_id,o=e.level>1?e.parent_item_id:"",c=f.a.assign({},e);return r in i?c=f.a.assign(i[r],c):i[r]=c,o?o in i?(t=i[o],void(t.children?t.children.push(c):t.children=[c])):(i[o]={item_id:o,children:[c]},i[o]):n.push(c)})),function e(n,i){n.forEach((function(t){t.item_full_name=i?i+"-"+t.item_name:t.item_name,t.children&&e(t.children,t.item_full_name)})),null!==t&&(t=1===n.length?n[0]:null)}(n),e.checkItemTree=n,e.checkItemMap=i,e.selectedItem=t},update:function(t){f.a.assign(e,t)},save:function(){t={points:e.points.slice(0),positions:e.problem.positions.slice(0),checkItems:e.checkItems.slice(0),cacheIntersectItems:e.cacheIntersectItems.slice(0)}},restore:function(){t&&(e.points=t.points,e.problem.positions=t.positions,e.checkItems=t.checkItems,e.cacheIntersectItems=t.cacheIntersectItems,t=null)},clearStore:function(){t=null},clear:function(){return u()},updateRemark:function(t){e.problem.remark=t},updateCheckItem:function(t){e.problem.selectedItem=t,e.problem.selectedDesc=null,e.problem.contractor=null,e.problem.responsibleCompany=null,e.problem.topItemId=function t(n){return n.parent_item_id&&n.level>1?t(e.checkItemMap[n.parent_item_id]):n.item_id}(t)},updateDesc:function(t){h["default"].prototype.$set(e.problem,"selectedDesc",t),e.problem.contractor=null,a["a"].getContractor(n,e.problem.selectedItem.item_id,e.problem.selectedDesc.map((function(e){return e.id})).join(";")).then((function(t){"length"in t||(t=[t]),e.problem.contractor=t,e.problem.responsibleCompany=t,h["default"].prototype.$eventBus.$emit("app.batchAddProblem:updateContractor")}))},submit:function(){var t=[],r=e.problem.problemImages.map((function(e){return{img_localpath:e.img_local_path}})),o=e.problem.selectedDesc.map((function(e){return e.id})).join(";"),c=e.problem.contractor.map((function(e){return e.contractor_id})).join(";"),a=e.problem.responsibleCompany.map((function(e){return e.contractor_id})).join(";"),s=0,d=[];e.problemReasons.forEach((function(e){e.selected&&d.push(e.id)}));for(var u=0;u<e.problem.positions.length;u++)for(var f=e.problem.positions[u],I=0;I<f.points.length;I++){var _=l["a"].batchAddProblem({problem_images:r,batch_room_id:n,position_id:f.positionId,item_id:e.problem.selectedItem.item_id,top_item_id:e.problem.topItemId,desc_id:o,contractor_id:c,responsible_company_id:a,roomtype_diagram_id:f.points[I].diagramId,coordinate:[{x:f.points[I].x,y:f.points[I].y}],emergency_degree:e.problem.emergencyDegree,remark:e.problem.remark,is_passed_when_add:e.problem.isPassedWhenAdd?1:0},!1,"",d);t.push(_),s++}return i["a"].all(t).then((function(){return p["a"].updateCheckItemUseTimes(e.problem.selectedItem.item_id,s)})).then((function(){return p["a"].updateItemDescUseTimes(o,s)})).then((function(){m["a"].room.hasProblem=!0,h["default"].prototype.$eventBus.$emit("app.roomdetail:statusChange")}))}}}t["a"]=I()},"8fee":function(e,t,n){"use strict";var i=n("760e"),r=n("a14a"),o=n.n(r);t["a"]={getCheckItemDescList:function(e,t,n){return i["a"].getCheckItemDescList(e,t,n).then((function(e){return e}))},getRoomCheckListDescList:function(e,t){return i["a"].getRoomCheckListDescList(e,t).then((function(e){if(!o.a.isEmpty(e))for(var t=0;t<e.length&&t<3;t++)e[t].isImportant=!0;return e}))},searchDesc:function(e,t){return i["a"].searchDesc(e,t)}}},b591:function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .box[data-v-4ed53bfe] {\n  height: 100%;\n}\n.zhkf .isIos[data-v-4ed53bfe] {\n  padding-top: 20px;\n}\n.zhkf .search-form[data-v-4ed53bfe] {\n  background: -webkit-gradient(linear, left top, right top, from(#1cb0fd), to(#0099ff));\n  background: linear-gradient(90deg, #1cb0fd 0%, #0099ff 100%);\n}\n.zhkf .icon-chazhao[data-v-4ed53bfe] {\n  color: #bbbbbb;\n  font-size: 14px;\n}\n.zhkf .active[data-v-4ed53bfe] {\n  color: #0085ff;\n}\n.zhkf .check-item-select[data-v-4ed53bfe] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .item-list[data-v-4ed53bfe] {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  overflow: scroll;\n}\n.zhkf .search-form[data-v-4ed53bfe] {\n  z-index: 99;\n}\n.zhkf .tipBox[data-v-4ed53bfe] {\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  width: 100%;\n  height: 100%;\n  background: #fff;\n}\n.zhkf .search[data-v-4ed53bfe] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .search .van-cell[data-v-4ed53bfe]:not(:last-child)::after {\n    left: 15px;\n}\n.zhkf .search .van-search[data-v-4ed53bfe] {\n    background: none !important;\n}\n.zhkf .search .van-search__action[data-v-4ed53bfe]:active {\n    background: none !important;\n}\n.zhkf .isBgWhite[data-v-4ed53bfe] {\n  background: #fff;\n}\n.zhkf .icon-chazhao[data-v-4ed53bfe] {\n  color: #bbbbbb;\n  font-size: 14px;\n}\n.zhkf .icon-CombinedShapeCopy[data-v-4ed53bfe] {\n  color: #bbbbbb;\n  font-size: 14px;\n}\n.zhkf .clear-history[data-v-4ed53bfe] {\n  text-align: center;\n  font-size: 14px;\n  color: #a0a0a0;\n  padding: 15px 0;\n}\n.zhkf .result[data-v-4ed53bfe],\n.zhkf .history[data-v-4ed53bfe] {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  overflow: scroll;\n}\n.zhkf .result-block[data-v-4ed53bfe] {\n  margin-bottom: 10px;\n}\n.zhkf .result-block h2[data-v-4ed53bfe] {\n    color: #a0a0a0;\n    font-size: 14px;\n    line-height: 36px;\n    padding-left: 15px;\n    font-weight: 400;\n    margin: 0;\n    background: #fff;\n}\n",""])},b643:function(e,t,n){"use strict";var i=n("7ee1");t["a"]={getReasonConfig:function(){return i["a"].getList()},getProblemReason:function(e){return i["a"].getProblemReason(e)}}},bad1:function(e,t,n){"use strict";var i=n("97ba");t["a"]={getPositionList:function(e){return console.log("batchRoomId",e),i["a"].getPositionList(e).then((function(e){return e}))},getPositionByIds:function(e){return i["a"].getPositionByIds(e)},getPositionNameById:function(e){return i["a"].getPositionNameById(e)}}},c0c3:function(e,t,n){"use strict";var i=n("69b3"),r=n("8704"),o=n("7108");n("0aed")("search",1,(function(e,t,n,c){return[function(n){var i=e(this),r=void 0==n?void 0:n[t];return void 0!==r?r.call(n,i):new RegExp(n)[t](String(i))},function(e){var t=c(n,e,this);if(t.done)return t.value;var a=i(e),s=String(this),l=a.lastIndex;r(l,0)||(a.lastIndex=0);var d=o(a,s);return r(a.lastIndex,l)||(a.lastIndex=l),null===d?-1:d.index}]}))},e810:function(e,t,n){"use strict";var i=n("cb6b"),r="CHECKITEM_SEARCH_HISTORY",o={};function c(){i["a"].set(r,JSON.stringify(o.list))}i["a"].preserve(r),o.list=function(){var e=i["a"].getString(r);return e?JSON.parse(e):[]}(),o.add=function(e){var t=o.list.indexOf(e);return-1!==t&&o.list.splice(t,1),o.list.unshift(e),o.list.splice(8),c(),o},o.remove=function(e){var t=o.list.indexOf(e);-1!==t&&(o.list.splice(t,1),c())},o.clear=function(){o.list.splice(0),c()},t["a"]=o},fa1b:function(e,t,n){"use strict";var i=n("1834");t["a"]={getCheckItemList:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=[e],c="select bc.item_id, ci.full_name as item_full_name  from batch_checkitem bc  inner join check_item ci on ci.id = bc.item_id  where bc.batch_id = ? ";if(c+=t?" and ci.is_for_rough = 1 ":" and ci.is_for_decorated = 1 ",n){var a=r?"project_position_checkitem":"position_checkitem";c+=" and bc.item_id in                     (select item_id from "+a+" where position_id = ? )",o.push(n)}return c+=" order by ci.sort ",i["a"].query(c,o)}}}}]);