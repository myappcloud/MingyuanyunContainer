(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-62f1b21a"],{"0970":function(e,t,o){"use strict";o("6d57"),o("cc57");var i=o("1834"),n=function(){var e="select ci.id,ci.name,ci.parent_id,ci.sort,ci.ifEnd,cig.remark from check_item ci left join check_item_guide cig on ci.id=cig.item_id";return i["a"].query(e)},r=function(e){var t="select remark from check_item_guide where item_id = ?",o=[e];return i["a"].queryOne(t,o).then((function(e){return e&&e.remark}))},a=function(e){var t="select item.full_name,guide.remark as guide           from check_item_guide guide               inner join check_item item on guide.item_id=item.id           where guide.item_id=?";return i["a"].queryOne(t,[e])},c=function(){var e="select item.id,item.name,item.parent_id,guide.id is not null as has_guide       from check_item item           left join check_item_guide guide on item.id=guide.item_id              and ifnull(guide.remark,'') <> ''       order by sort";return i["a"].query(e)},s={getCheckItemWithGuide:n,getGuideByCheckItemId:r,getCheckItemList:c,getGuideAndItemByItemId:a},l=o("a14a"),d=o.n(l),m=function(){var e={};return{getItem:function(t,o){if(void 0===t||null===t)throw new TypeError("key参数为空");return o?e[t]:d.a.cloneDeep(e[t])},setItem:function(t,o){if(void 0===t||null===t)throw new TypeError("key参数为空");if(arguments.length<2)throw new TypeError("value参数未设置");e[t]=o},clear:function(){e={}}}},u=m(),h={IS_NEED_DOWNLOAD_BASE_DATA:"is_need_download_base_data",LAST_EXEC_TIME_DATA:"last_exec_time_data",LAST_GUIDE_SORT_MAP:"last_guide_sort_map"},f=function(){var e=function e(t,o){t.remark&&""!=t.remark&&(t.has_guide=!0),t.children=[];for(var i=0;i<o.length;i++)o[i].parent_id==t.id&&t.children.push(o[i]);if(t.children&&t.children.length>0)for(var n=0;n<t.children.length;n++)t.children[n]=e(t.children[n],o);return t};return{getCheckItemGuideByItemId:function(e){return s.getGuideByCheckItemId(e)},getCheckItemTree:function(){var t={id:""};return s.getCheckItemWithGuide().then((function(o){t=e(t,o);for(var i=0;i<t.children.length;i++)if("所有检查项"==t.children[i].name)return t.children[i].children;return t.children}))},getCheckItemTreeAndGuideSortMap:function(){return console.time("getData"),s.getCheckItemList().then((function(e){console.timeEnd("getData"),console.time("processData");var t={},o=[],i=0,n=[];function r(e,t){e.forEach((function(e){e.depth=t,e.tree?r(e.tree,t+1):e.has_guide&&(e.guide_sort=i,o[i]=e.id,i++)}))}return e.forEach((function(e){t[e.id]=e})),e.forEach((function(e){e.parent_id&&t[e.parent_id]?(t[e.parent_id].tree=t[e.parent_id].tree||[],t[e.parent_id].tree.push(e)):n.push(e)})),r(n,1),u.setItem(h.LAST_GUIDE_SORT_MAP,o),console.timeEnd("processData"),{tree:n,guideSortMap:o}}))},getGuideSortMapFromCatch:function(){return u.getItem(h.LAST_GUIDE_SORT_MAP,!0)},getGuideAndItemByItemId:s.getGuideAndItemByItemId}};t["a"]=f()},"0a37":function(e,t,o){var i=o("1c4e");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=o("85cb").default;n("76d9ba51",i,!0,{})},"1c4e":function(e,t,o){t=e.exports=o("690e")(!1),t.push([e.i,"\n.zhkf .tip[data-v-829243a6] {\n  width: 250px;\n  text-align: center;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n.zhkf .tip img[data-v-829243a6] {\n    width: 200px;\n}\n.zhkf .tip p[data-v-829243a6] {\n    color: #a0a0a0;\n    line-height: 20px;\n    font-size: 14px;\n    margin: 0 auto;\n    text-align: center;\n    margin-top: 3px;\n}\n",""])},"26eb":function(e,t,o){e.exports=o.p+"img/search.37f508c9.png"},2985:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAADIklEQVRYR82ZTUhUURTHf3fKUqKkD0r7wEVQEUVCH7oSggiskMASF0EQlBW2DHQRDLQw2irZuAiKIFIXFVhIC4kKgmqlVBYuAnO0JkSMcpj0xvXN0+eb92beffMm3lsNc+/5nx/3cM85916Bny8qI5RzEDiMYD+SnUA5sDotNw3EEQwjeQ8MEOctUTGn605oGdyVW5ihGTgDbNWyhVHgPsV0cFZ882rrDbBDrqeI68A5YKVXcZd5SeAOKa7RLH7m0soN2CUbkbQDG3KJaY4niNDMefEwm507YFQuZzPtSC5qOtabLrjNGFeIir9Ohs6A3bKESXqA43refM/uYy2naRB/7AqZgGrlynn0H+FMpj7inLSvZCZgl+wseFjdFlqF+4K4ZB1eCmhsiAe+AxWEYYRG68ZZBDRSyacC7FZd7AQpdpkpaBEwJm8BS5ZXVznA+Z00ictKzwA0KsRIAEnYE+OaIrhZBXvXQewj3PuSYZakmO2q4hiAMdkGtHhSz3NS6QroPwZVGw2hWQm7u+HzVIbwDZpEq8Ao/F991FZtVDucKVDzBF6OZ8iNEqdCEJNVwBttb5oGbnADY3CkD+ako2C1AlShVSEu2OcG92ocap/Br5Sr61YF2AvUu03Ztgq+z0By1h9/HnBqC/cqwEFgj919RMDjo3CiAiZ+Q/1zeD2hB5kXnOFqSAH+cErONWXwom4RaDoFtU+9QwYAp5wnFOCMU/7bUQofGmCZpRh6hQwITgEmXQHV6NV9RkK1frkgA4RbAHQMsQnVUglth7xBBgy3EGLHTWJF8gJZADiFMCjokj1ITuXan9kghyaXli9Ty0Oey+42nWY8J2o3yJEpqLQdqfKGM9DnE7VWqXOCtC9DQHBKttpXs5ANMkC4dLOgOH20W06QAcIpqnS7pX76bFhVnlQpSCVz1ZXU9Wct/Ln2oXXc1rAaq+ir5VcVZ1OJUQJdWiYdMHOureVXf4f+0KQgQ33sNBc31Ad3BRn6qw8FGerLIzPUob5+syaG0F5gWiFDfQVsBQ3tJbq9FlifIeAAzD9DlNmeIdRdwTDwLp9niH+Lfm97gO/iCQAAAABJRU5ErkJggg=="},"302c":function(e,t,o){"use strict";o.r(t);o("5ab2"),o("e44b"),o("e10e"),o("6d57"),o("f548"),o("9dd9"),o("ed63"),o("8cf2"),o("9a33");var i,n=o("28f8"),r=o("f2de"),a=o("dd0a"),c=o("db5f"),s=o("3fa2"),l=o("5cf9"),d=o("a14a"),m=o.n(d);function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){Object(n["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var f=!1,p={name:"DescSelect",components:{tip:l["a"]},data:function(){return{rightText:"多选",list:[],loading:!1,isMulti:!1,tipCont:"输入关键字进行搜索",searchMode:!1,searchLoading:!1,contractors:[],searchResult:[],searchNodata:!1,keyword:""}},computed:h({},Object(r["e"])({isIOS:function(e){return e.app.global.isIOS}})),watch:{keyword:function(e){this.doSearch()}},created:function(){this.init()},methods:{init:function(){var e=this;if(this.list=[],this.loading=!0,i=c["a"].model.problem,i.responsibilityUnitIds.length){var t=i.responsibilityUnitIds.split(";");!m.a.isEmpty(t)&&t.length>1?(this.isMulti=!0,this.rightText="取消多选"):(this.isMulti=!1,this.rightText="多选")}else this.isMulti=!1,this.rightText="多选";a["a"].getContractorList(s["a"].room.batchRoomId||c["a"].model.problem.batchRoomId).then((function(t){if(i.responsibilityUnitIds.length)for(var o=0;o<t.length;o++)m.a.includes(i.responsibilityUnitIds,t[o].contractor_id)&&(t[o].selected=!0);console.log("reponsible list",t),e.list=t,e.loading=!1}))},changeToSearchMode:function(){this.searchMode=!0;var e=this.$refs.searchInput.querySelector('input[type="search"]');console.log(e),setTimeout((function(){e.focus()}),300)},clearInput:function(){this.keyword="",f=!1,this.searchNodata=!1,this.searchLoading=!1,this.searchResult=[],this.tipCont="输入关键字进行搜索!"},doSearch:function(){var e=this;if(""===m.a.trim(this.keyword))return this.clearInput(),void(this.tipCont="输入关键字进行搜索");f||(f=!0,this.searchLoading=!0,this.searchResult=[],a["a"].getContractorList(s["a"].room.batchRoomId).then((function(t){if(f=!1,e.searchLoading=!1,console.log("责任单位查询=======",t),""!==e.keyword)if(t.length){e.searchNodata=!1,e.searchResult=[];for(var o=0;o<t.length;o++)if(i.responsibilityUnitIds.length&&m.a.includes(i.responsibilityUnitIds,t[o].contractor_id)&&(t[o].selected=!0),t[o].contractor_name.toLowerCase().includes(e.keyword.toLowerCase())){var n=new RegExp(e.keyword,"ig");t[o].color_name=t[o].contractor_name.replace(n,(function(){return'<span class="color-blue">'+arguments[0]+"</span>"})),console.log("责任单位666=======",t[o]),e.searchResult.push(t[o])}console.log("责任单位搜索结果=======",e.searchResult),e.searchResult.length||(e.searchWord=e.keyword,e.searchNodata=!0,e.searchResult=[],e.tipCont='抱歉没有找到与“<span style="color:#0099FF;">'+e.searchWord+"</span>”相关的结果")}else e.searchWord=e.keyword,e.searchNodata=!0,e.searchResult=[],e.tipCont="没有可以选择的责任单位"})).catch((function(){console.error(err),f=!1,e.searchLoading=!1})))},select:function(e,t){if(this.isMulti){var o=this.searchMode?this.searchResult:this.list;this.$set(o,t,h(h({},e),{},{selected:!e.selected}))}else this.selectCallback(e.contractor_id,e.contractor_name)},multiSelect:function(){this.isMulti?(this.list.forEach((function(e){e.selected=!1})),this.isMulti=!1,this.rightText="多选"):(this.isMulti=!0,this.rightText="取消多选")},selectMulti:function(){var e=[],t=[],o=this.searchMode?this.searchResult:this.list;o.forEach((function(o){o.selected&&(e.push(o.contractor_id),t.push(o.contractor_name))})),this.selectCallback(e.join(";"),t.join("；"))},selectCallback:function(e,t){c["a"].updateProblem({responsibilityUnitIds:e,responsibilityUnits:t}),this.$router.go(-1)}}},b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"reponsible-select",class:{isBgWhite:!e.loading&&!e.list.length}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.searchMode,expression:"!searchMode"}],staticClass:"select-content"},[i("cus-nav-bar",{attrs:{title:"选择责任单位","left-arrow":"",border:!1,"right-text":e.loading||e.list.length?e.rightText:""},on:{"click-right":e.multiSelect}}),e._v(" "),i("div",{on:{click:e.changeToSearchMode}},[i("van-search",{attrs:{placeholder:"搜索责任单位",disabled:"true"}},[i("i",{staticClass:"iconfont icon-chazhao",attrs:{slot:"left-icon"},slot:"left-icon"})])],1),e._v(" "),i("section",{staticClass:"item-list"},e._l(e.list,(function(t,n){return i("van-cell",{key:t.contractor_id,class:{active:t.selected},attrs:{"is-link":"",title:t.contractor_name},on:{click:function(o){return e.select(t,n)}}},[i("template",{slot:"right-icon"},[i("i",{directives:[{name:"show",rawName:"v-show",value:!e.isMulti&&t.selected,expression:"!isMulti && item.selected"}],staticClass:"iconfont icon-gou"}),e._v(" "),i("img",{directives:[{name:"show",rawName:"v-show",value:e.isMulti&&t.selected,expression:"isMulti && item.selected"}],attrs:{src:o("2985"),alt:"selected",width:"20",height:"20"}}),e._v(" "),i("img",{directives:[{name:"show",rawName:"v-show",value:e.isMulti&&!t.selected,expression:"isMulti && !item.selected"}],attrs:{src:o("f97d"),alt:"select",width:"20",height:"20"}})])],2)})),1),e._v(" "),e.loading||e.list.length?e._e():i("tip",{attrs:{"img-url":o("26eb"),"tip-cont":"没有可以选择的责任单位"}})],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.searchMode,expression:"searchMode"}],staticClass:"search"},[i("form",{staticClass:"search-form",class:{isIos:e.isIOS},attrs:{action:"/"}},[i("van-search",{ref:"searchInput",attrs:{placeholder:"搜索责任单位","show-action":"",background:"linear-gradient(90deg,rgba(28,176,253,1) 0%,rgba(0,153,255,1) 100%)"},on:{cancel:function(t){e.searchMode=!1},search:e.doSearch,clear:e.clearInput},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[i("i",{staticClass:"iconfont icon-chazhao",attrs:{slot:"left-icon"},slot:"left-icon"})])],1),e._v(" "),i("section",{staticClass:"result"},[i("van-cell-group",e._l(e.searchResult,(function(t,n){return i("van-cell",{key:t.contractor_id,class:{active:t.selected},attrs:{"is-link":"",title:t.contractor_name},on:{click:function(o){return e.select(t,n)}}},[i("template",{slot:"title"},[t.color_name?i("span",{domProps:{innerHTML:e._s(t.color_name)}}):i("span",{domProps:{innerHTML:e._s(t.contractor_name)}})]),e._v(" "),i("template",{slot:"right-icon"},[i("i",{directives:[{name:"show",rawName:"v-show",value:!e.isMulti&&t.selected,expression:"!isMulti && item.selected"}],staticClass:"iconfont icon-gou"}),e._v(" "),i("img",{directives:[{name:"show",rawName:"v-show",value:e.isMulti&&t.selected,expression:"isMulti && item.selected"}],attrs:{src:o("2985"),alt:"selected",width:"20",height:"20"}}),e._v(" "),i("img",{directives:[{name:"show",rawName:"v-show",value:e.isMulti&&!t.selected,expression:"isMulti && !item.selected"}],attrs:{src:o("f97d"),alt:"select",width:"20",height:"20"}})])],2)})),1)],1),e._v(" "),e.searchLoading||!e.searchNodata&&e.keyword?e._e():i("div",{staticClass:"tipBox"},[i("tip",{attrs:{"img-url":o("26eb"),"tip-cont":e.tipCont}})],1)]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isMulti,expression:"isMulti"}],staticClass:"btn",on:{click:e.selectMulti}},[e._v("确认")])])},g=[],_=o("d082");function I(e){o("a2e4")}var k=!1,v=I,y="data-v-7312ff06",w=null,P=Object(_["a"])(p,b,g,k,v,y,w);t["default"]=P.exports},"33bf":function(e,t,o){t=e.exports=o("690e")(!1),t.push([e.i,"\n.zhkf .reponsible-select[data-v-7312ff06] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .item-list[data-v-7312ff06],\n.zhkf .result[data-v-7312ff06] {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  overflow: scroll;\n}\n.zhkf .icon-chazhao[data-v-7312ff06] {\n  color: #bbbbbb;\n  font-size: 14px;\n}\n.zhkf .select-content[data-v-7312ff06] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .select-content .van-search[data-v-7312ff06] {\n    background-color: #f4f4f4 !important;\n}\n.zhkf .select-content .van-search .van-search__content[data-v-7312ff06] {\n      background-color: #ffffff;\n      border-radius: 4px;\n}\n.zhkf .isIos[data-v-7312ff06] {\n  padding-top: 20px;\n}\n.zhkf .ios .search .van-search[data-v-7312ff06] {\n  padding-top: 25px;\n}\n.zhkf .search-form[data-v-7312ff06] {\n  z-index: 33;\n  background: -webkit-gradient(linear, left top, right top, from(#1cb0fd), to(#0099ff));\n  background: linear-gradient(90deg, #1cb0fd 0%, #0099ff 100%);\n}\n.zhkf .search-form[data-v-7312ff06] .van-field__control {\n    color: #202020 !important;\n}\n.zhkf .search[data-v-7312ff06] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .search .van-cell[data-v-7312ff06]:not(:last-child)::after {\n    left: 15px;\n}\n.zhkf .search .van-search[data-v-7312ff06] {\n    background: none !important;\n}\n.zhkf .search .van-search__action[data-v-7312ff06]:active {\n    background: none !important;\n}\n.zhkf .tipBox[data-v-7312ff06] {\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  width: 100%;\n  height: 100%;\n  background: #fff;\n}\n.zhkf .active[data-v-7312ff06] {\n  color: #0085ff;\n}\n.zhkf .isBgWhite[data-v-7312ff06] {\n  background: #fff;\n}\n.zhkf .icon-xuanzhong[data-v-7312ff06] {\n  color: #0085ff;\n  font-size: 20px;\n}\n.zhkf .icon-duoxuan-weixuanzhuangtai[data-v-7312ff06] {\n  color: #c7c8c7;\n  font-size: 20px;\n}\n.zhkf .icon-gou[data-v-7312ff06] {\n  font-size: 15px;\n}\n.zhkf .btn[data-v-7312ff06] {\n  height: 45px;\n  line-height: 45px;\n  color: #fff;\n  text-align: center;\n  font-size: 15px;\n  background: #0085ff;\n}\n",""])},4438:function(e,t,o){"use strict";var i=o("cb6b"),n=o("0e1c");t["a"]={getLocalBusinessToggle:function(){var e=i["a"].getObject(n["a"].BUSINESS_TOGGLE,i["a"].level.user);return e||{enable_opening_tab:0,enable_pass_when_add:0,enable_pass_when_to_repair:0,sign_when_receive_delivery:1,special_project_switch:0,take_photo_when_review:0,take_photo_when_regist:0,hide_owner_phone:0,enable_problem_reason:0}}}},"5c1b":function(e,t,o){"use strict";o("f0e6");var i=o("bbed"),n=o("fa1b"),r=o("07a4"),a=o("fd50");function c(){var e=function(e){e&&e.fitment_standard&&("毛坯"===e.fitment_standard?e.is_for_rough=1:"精装"===e.fitment_standard&&(e.is_for_decorated=1),delete e.fitment_standard)},t=function(e,t,o,n,r){return i["a"].getCheckItemLeaf(e,t,n,r).then((function(e){if(_.isEmpty(e))return[];var t=[];return _.each(e,(function(e){t.push(e.id)})),i["a"].getCheckItemAll(t.join("','"),o,n,r)}))};return{getCheckItemList:function(e,o,n,c,s){var l="毛坯"==c,d=a["a"].when(),m=["全部"];return m.push(1==s?"公区":"房间"),m="('"+m.join("','")+"')",d=r["a"].state.app.global.isUseProjectItem?i["a"].getProjectCheckItemList(e,o,n,l,m):t(e,o,n,l,m),d.then((function(e){return e}))},hasProjectCheckitem:function(e){return i["a"].hasProjectCheckitem(e)},searchCheckItemWithProject:function(t,o,n,r){return e(n),r?i["a"].searchProjectCheckItem(r,t,o,n):i["a"].searchCheckItem(t,o,n)},searchCheckItem:function(t,o,n,r){return console.log("searchCheckItem: ",t,o,n),console.time("searchCheckItem"),e(n),i["a"].hasProjectCheckitem(r).then((function(e){return e?i["a"].searchProjectCheckItem(r,t,o,n):i["a"].searchCheckItem(t,o,n).finally((function(){console.timeEnd("searchCheckItem")}))}))},getHigherLevelTreeListByCheckItemId:function(t,o,n){return console.log("getHigherLevelTree: ",t,o,n),console.time("getHigherLevelTree"),e(n),i["a"].getHigherLevelTreeListByCheckItemId(t,o,n).finally((function(){console.timeEnd("getHigherLevelTree")}))},getCheckItemLevel:function(e,t){return i["a"].getCheckItemLevel(e,t)},getPositionItemByRoom:function(e,t,o){var n=a["a"].when(),c=["全部"];return c.push(1==o?"公区":"房间"),c="('"+c.join("','")+"')",n=r["a"].state.app.global.isUseProjectItem?i["a"].getProjectPositionItemByRoom(e,t,c):i["a"].getPositionItemByRoom(e,c),n.then((function(e){return e}))},setIsUseProjectItemOfBatchUnit:function(e){return i["a"].getProjectItemOfBatchUnit(e).then((function(e){var t=!1;e&&(t=!0),r["a"].commit("app/APP",{isUseProjectItem:t})}))},getBatchCheckItem:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return n["a"].getCheckItemList(e,t,o,r["a"].state.app.global.isUseProjectItem).then((function(e){return console.log("BatchCheckItem",e),a["a"].resolve(e)}))}}}t["a"]=c()},"5cf9":function(e,t,o){"use strict";var i={props:{isShow:{type:Boolean,default:!0},imgUrl:{type:String,required:!0},tipCont:{type:String,default:"系统繁忙请稍后重试"}}},n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticClass:"tip"},[o("img",{attrs:{src:e.imgUrl,alt:"tip"}}),e._v(" "),e.tipCont?o("p",{domProps:{innerHTML:e._s(e.tipCont)}}):e._e()])},r=[],a=o("d082");function c(e){o("0a37")}var s=!1,l=c,d="data-v-829243a6",m=null,u=Object(a["a"])(i,n,r,s,l,d,m);t["a"]=u.exports},"77a8":function(e,t,o){"use strict";o("6d57");function i(){var e={list:[]};return{model:e,init:function(){e.list=[{key:"status",value:"常用状态",name:"常用状态",displayName:"所有状态",list:[{name:"常用状态",value:"常用状态"},{name:"所有状态",value:""}]},{key:"position",value:"",name:"全部",displayName:"部位",list:[]},{key:"checkItem",value:"",name:"全部",displayName:"检查项",list:[]}]},update:function(t){e.list.forEach((function(e){t[e.key]&&(e.list=t[e.key])}))},getCondition:function(){var t={};return e.list.forEach((function(e){t[e.key]=e.value})),t},resetCheckItemValue:function(){e.list.forEach((function(e){"checkItem"===e.key&&(e.value="",e.name="全部")}))}}}t["a"]=i()},"85cd":function(e,t,o){"use strict";var i=o("1834"),n=o("0938"),r="checkitem_remark_history",a={createCondition:function(e,t){if(_.isEmpty(e))return"";t=t?"crh.":"";var o=[];return _.each(e,(function(e,i){o.push(t+i+"="+e)})),o=o.join(" and "),o},insertHistory:function(e){e.id=n["a"].uuid(),e.used_time=e.used_time||1,e.last_used_time=e.last_used_time||n["a"].getNowDate();var t=[],o=[];return _.each(e,(function(e,i){t.push(i),o.push(e)})),i["a"].insert(r,t,o).then((function(){return e.id}))},updateHistory:function(e,t){return i["a"].update(r,e,t)},getOneHistory:function(e,t,o){var n="select * from "+r+" where item_id=? and desc_id=? and remark=?";return i["a"].queryOne(n,[e,t,o])},updateUserdTime:function(e,t){if(!t)return $q.error("次数不能为0");var o={last_used_time:n["a"].getNowDate(),used_time:t};return i["a"].update(r,o,{id:e})},getListByItemIdOrderDate:function(e,t){var o="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ?  order by crh.last_used_time desc limit "+t;return i["a"].query(o,[e])},getListByItemIdOrderUsedTime:function(e,t,o){var n=o.length?'and crh.id not in ("'+o.join('","')+'")':"",r="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ? "+n+" order by crh.used_time desc limit "+t;return i["a"].query(r,[e])},deleteItemById:function(e){var t="delete from checkitem_remark_history where id=?";return i["a"].query(t,[e])},searchByItems:function(e,t){var o="select crh.id,crh.remark as name,crh.item_id,ci.name as item_name,ci.full_name as item_full_name,crh.desc_id,cid.name as desc_name from checkitem_remark_history crh inner join check_item ci on ci.id = crh.item_id inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id in ("+t+') and (lower(crh.remark) like "%" || ? || "%" or upper(crh.remark) like "%" || ? || "%") order by crh.remark';return i["a"].query(o,[e,e])}},c=a,s={getList:function(e){if(!e)return $q.reject("itemId为空");var t=[];return c.getListByItemIdOrderDate(e,3).then((function(o){if(o){var i=[];return _.each(o,(function(e){i.push(e.id),t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),c.getListByItemIdOrderUsedTime(e,17,i).then((function(e){return e&&_.each(e,(function(e){t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),t}))}return $q.reject(t)}))},deleteItem:function(e){return c.deleteItemById(e)},upsertHistory:function(e,t,o){return c.getOneHistory(e,t,o).then((function(i){return i?c.updateUserdTime(i.id,i.used_time+1):c.insertHistory({item_id:e,desc_id:t,remark:o})}))},searchByItems:function(e,t){return c.searchByItems(e,t)}};t["a"]=s},"98a4":function(e,t,o){"use strict";o("e697");var i=o("85cd"),n=o("fd50"),r=o("a593"),a={model:{},init:function(){a.model.historyList={},a.model.currItemId="",a.model.currList=[]},loadList:function(e,t){return e?(_.isEmpty(a.model)&&a.init(),t=t||!1,a.model.currItemId=e,_.isEmpty(a.model.historyList[e])||t?(console.log("=== itemId ===",e),i["a"].getList(e).then((function(t){console.log(t),a.model.historyList[e]=t,a.model.currList=t})).catch((function(){a.model.historyList[e]=[],a.model.currList=[]}))):(a.model.currList=a.model.historyList[e],n["a"].resolve())):n["a"].reject()},upsertHistory:function(e,t,o){return i["a"].upsertHistory(e,t,o).then((function(){a.loadList(e,!0)}))},delHistory:function(e){return i["a"].deleteItem(e).then((function(){var t=_.find(a.model.currList,{id:e});if(t){var o=a.model.currList.indexOf(t);o>-1&&a.model.currList.splice(o,1)}})).catch((function(e){console.error(e),r["default"].prototype.$toast("删除历史失败！")}))}};t["a"]=a},a2e4:function(e,t,o){var i=o("33bf");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=o("85cb").default;n("63603f3e",i,!0,{})},a9ec:function(e,t,o){"use strict";o("6d57");var i=o("a593"),n=o("3fa2"),r=o("d485"),a=o("9af1"),c=o("77a8");function s(){var e={},t={problemList:[],buttons:[]},o={},s="tab-icon1",l={"待派单":"tab-icon5","待整改":"tab-icon2","已整改":"tab-icon3","已通过":"tab-icon4","已作废":"tab-icon6","非正常关闭":"tab-icon7"},d=n["a"].room;return o.iniStatusStyle=function(){t.problemList.forEach((function(e){l[e.status]?e.status_style=l[e.status]:e.status_style=s}))},o.initFilter=function(){return r["a"].getPositionList(d.batchRoomId).then((function(e){t.filterList.position.list=e}))},o.getCondition=function(){var e={};_.each(t.filterList,(function(t,o){e[o]=t.value}))},o.getProblemPoints=function(){i["default"].prototype.$eventBus.$emit("app.roomdetail:updateProblemPoints",t.problemList)},e={model:t,init:function(){return r["a"].getProblemList(d.batchRoomId,0,1,!0).then((function(e){t.problemList=e,o.iniStatusStyle()})).then((function(){return console.log("fromType------",d.fromType),a["a"].getDefaultFilterList(t.problemList,d.batchRoomId,d.fromType).then((function(e){c["a"].update(e),console.log("filters---------",e),o.getProblemPoints()}))})).then((function(){if(!_.isEmpty(c["a"].model.list))return e.updateProblemList()}))},updateProblemList:function(e){var i=c["a"].getCondition();a["a"].hideProblemByFilter(t.problemList,c["a"].model.list,i,e),o.getProblemPoints()}},e}t["a"]=s()},b643:function(e,t,o){"use strict";var i=o("7ee1");t["a"]={getReasonConfig:function(){return i["a"].getList()},getProblemReason:function(e){return i["a"].getProblemReason(e)}}},bad1:function(e,t,o){"use strict";var i=o("97ba");t["a"]={getPositionList:function(e){return console.log("batchRoomId",e),i["a"].getPositionList(e).then((function(e){return e}))},getPositionByIds:function(e){return i["a"].getPositionByIds(e)},getPositionNameById:function(e){return i["a"].getPositionNameById(e)}}},db5f:function(e,t,o){"use strict";o("5ab2"),o("e44b"),o("e10e"),o("f0e6");var i=o("28f8"),n=(o("5f54"),o("6d57"),o("fd50")),r=o("c2c1"),a=o("0938"),c=o("8ae6"),s=o("a14a"),l=o.n(s),d=o("07a4"),m=o("a593"),u=o("98a4"),h=o("3fa2"),f=o("a9ec"),p=o("db99"),b=o("bad1"),g=o("964e"),_=o("0970"),I=o("5c1b"),k=o("dd0a"),v=o("4438"),y=o("b643"),w=o("bbed");function P(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function C(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?P(Object(o),!0).forEach((function(t){Object(i["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):P(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var A=h["a"].room,L="",x="";function O(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];o.length>0?console.log("[model]/problem-model.js：",e,o):console.log("[model]/problem-model.js：",e)}function j(){if(!E.model.problem.contractorIds&&E.model.problem.checkItemId)return k["a"].getContractor(A.batchRoomId||E.model.problem.batchRoomId,E.model.problem.checkItemId,E.model.problem.descIds).then((function(e){var t=[],o=[];E.model.contractorDisabled=!1,l.a.isEmpty(e)||(l.a.each(e,(function(e){t.push(e.contractor_id),o.push(e.contractor_name)})),t.length>1&&(E.model.contractorDisabled=!0),t=t.join(";"),o=o.join("；"),E.model.problem.contractors=o,E.model.problem.contractorIds=t,E.model.problem.responsibilityUnitIds=t,E.model.problem.responsibilityUnits=o)}))}function R(){var e=E.model.problem.id?"editProblem":"addProblem";!E.model.selectes&&(E.model.selectes={position:{},checkItem:{},desc:{},contractor:{},responsibleCompany:{}}),E.model.positionDisabled||(E.model.selectes.position={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-position-select"),query:{fromPage:e}}),E.model.problem.positionId?(E.model.selectes.checkItem={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-checkitem-select/").concat((new Date).getTime()),query:{type:A.fromType,fitment_standard:A.fitmentStandard,fromPage:e,isSpecial:+A.isSpecial}},E.model.problem.checkItemId?(A.isSpecial||I["a"].getHigherLevelTreeListByCheckItemId(E.model.problem.checkItemId,E.model.problem.positionId,{fitment_standard:A.fitmentStandard}).then((function(t){E.model.selectes.checkItem.query=l.a.extend(E.model.selectes.checkItem.query,{history:JSON.stringify(t),level:0,fromPage:e})})),E.model.selectes.desc={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-desc-select"),query:{fromPage:e,fitment_standard:A.fitmentStandard,level:0}},E.model.selectes.contractor={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-contractor-select"),query:{fromPage:e}},E.model.selectes.responsibleCompany={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-responsible-select"),query:{fromPage:e}}):E.model.selectes.checkItem.query=l.a.extend(E.model.selectes.checkItem.query,{batchId:A.batchId})):E.model.selectes.checkItem={}}function S(e){var t=e.coordinate?[JSON.parse(e.coordinate)]:[];return E.model.problem={projectId:e.projectId,problemStamp:e.problemStamp,positionId:e.positionId||"",diagramId:e.diagramId,positionName:"",checkItemId:e.checkItemId||"",checkItemName:e.checkItemName||"",topCheckItemId:e.checkItemId||"",checkItemGuide:!1,descIds:e.descIds||"",descNames:e.descNames||"",remark:e.remark||"",imageList:e.imageList||[],emergencyDegree:"一般",coordinates:t,contractors:"",contractorIds:"",responsibilityUnitIds:"",responsibilityUnits:"",isPassedWhenAdd:!1,isRemarkRequired:"",feedbackId:e.feedbackId,batchRoomId:e.batch_room_id},"roomDesignChange"!==e.problemType&&"feedbackRemainReply"!==e.problemType||(A={batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id}),E.model.positionId=null,E.setProblem(),n["a"].resolve()}function D(e){return g["a"].getProblem(e.problemId).then((function(t){var o=n["a"].when();return A&&!l.a.isEmpty(A)||(A={fromType:e.type,batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id,isSpecial:e.isSpecial,fitmentStandard:e.fitment_standard,batchId:t.batch_id}),o.then((function(){return t.problem_reason_ids=[],d["a"].state.app.global.enableProblemReason?y["a"].getProblemReason(e.problemId).then((function(e){return t.problem_reason_ids=e,n["a"].resolve(t)})):n["a"].resolve(t)}))})).then((function(t){E.model.problem={id:t.id,projectId:t.proj_id,positionId:t.position_id||"",positionName:t.position_name||"",diagramId:t.roomtype_diagram_id,checkItemId:t.item_id||"",checkItemName:t.item_name||"",topCheckItemId:t.top_item_id||"",checkItemGuide:!1,descIds:t.desc_id||"",descNames:t.desc||"",remark:t.remark,imageList:[],emergencyDegree:t.emergency_degree,coordinates:t.coordinates,contractors:t.contractor_name,contractorIds:t.contractor_id,responsibilityUnitIds:t.responsible_company_id,responsibilityUnits:t.responsible_company_name,isPassedWhenAdd:t.is_passed_when_add||!1,isRemarkRequired:t.isRemarkRequired,reasonIds:t.problem_reason_ids,batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id},t.problem_images.forEach((function(e){var t=c["a"].getImageRealPath(e.img_localpath);E.model.problem.imageList.push({localPath:e.img_localpath,fullPath:t,viewPath:c["a"].getImageWebViewPath(t)})})),console.log("==== _self.model.problem  ====",E.model.problem),L=t.remark,x=t.is_passed_when_add,E.model.positionId=t.position_id}))}var E={initUpdate:!0,model:{isLoaded:!1,positionId:"",problem:{imageList:[]},ProblemReasons:[],remarkChangeStatus:1},setProblem:function(e){var t={};E.model.positionDisabled=!1,E.model.checkItemDisabled=!1,E.model.descDisabled=!1,E.model.contractorDisabled=!1,"roomDesignChange"===E.model.problemType?(!l.a.isEmpty(e)&&(t={checkItemId:e.itemId,topCheckItemId:e.itemId,checkItemName:e.itemName,descIds:e.descId,descNames:e.descName,emergencyDegree:e.emergency_degree,remark:e.remark}),E.model.checkItemDisabled=!0,E.model.descDisabled=!0):"feedbackRemainReply"===E.model.problemType?(E.model.positionDisabled=!0,E.model.checkItemDisabled=!0):"fitmentStyle"===E.model.problemType?(!l.a.isEmpty(e)&&(t={checkItemId:e.checkItemId,topCheckItemId:e.checkItemId,checkItemName:e.checkItemName,emergencyDegree:"前置配置"===e.configType?"紧急":"一般",positionId:e.positionId||""}),E.model.positionDisabled=!0,E.model.checkItemDisabled=!0):"checkList"===E.model.problemType&&(!l.a.isEmpty(e)&&(E.model.problem=l.a.extend(E.model.problem||{},e)),R(),j(),E.initUpdate=!1),E.model.problem=l.a.extend(E.model.problem||{},t)},showGuide:function(){return E.model.problem.checkItemId?_["a"].getCheckItemGuideByItemId(E.model.problem.checkItemId).then((function(e){E.model.guideText=e,E.model.showGuide=!!e})):(E.model.guideText="",E.model.showGuide=!1,n["a"].resolve())},init:function(e){E.model.isLoaded=!1,E.model.title=e.problemId?"编辑问题":"feedbackRemainReply"!==e.problemType?"登记问题":e.title,E.model.problemType=e.problemType||"default";var t,o=d["a"].state.app.global.currentBatchType||"simulate";return E.model.enablePassWhenAdd=1==v["a"].getLocalBusinessToggle().enable_pass_when_add&&(m["default"].prototype.$checkRight("reinspect_problem",o)||m["default"].prototype.$checkRight("pass_problem",o)),E.model.ProblemReasons=[],console.log("=====",E.model),t=e.problemId?D(e):S(e),t.then((function(){return E.showGuide().then((function(){if(E.model.problem.positionId)return b["a"].getPositionNameById(E.model.problem.positionId).then((function(e){E.model.problem.positionName=e}))})).then((function(){E.initUpdate&&R()})).then((function(){if(d["a"].state.app.global.enableProblemReason)return y["a"].getReasonConfig().then((function(t){console.log("=== reasons ===",t),e.problemId&&t.forEach((function(e){m["default"].prototype.$set(e,"selected",E.model.problem.reasonIds.indexOf(e.id)>-1)})),E.model.ProblemReasons=t}))})).then((function(){E.model.isLoaded=!0})).catch((function(e){console.error(e),m["default"].prototype.$toast("获取相关数据失败，请返回或稍后重试")}))}))},updateProblem:function(e,t){return t=t||!1,E.model.problem=Object.assign({},E.model.problem,e),E.showGuide().then((function(){return R(),e.remark&&E.model.remarkChangeStatus++,O("updateProblem - 更新问题的字段：","updateProblem=".concat(t),e),t?j():n["a"].resolve()}))},takePhoto:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=c["a"].getNewProblemImagePath({folder:A.batchUnitId+"/"+A.batchRoomId,imageId:Object(a["j"])()});return console.log("take photo",t),r["a"].takePhoto(t.full_path,C({withGraffiti:!0,text:g["a"].getWatermarkText()},e)).then((function(){E.model.problem.imageList.push({localPath:t.save_path,fullPath:t.full_path,viewPath:t.view_path?t.view_path:c["a"].getImageWebViewPath(t.full_path)})}))},addProblem:function(e){e=e||"";var t=[];l.a.each(E.model.problem.imageList,(function(e){t.push({img_localpath:e.localPath})}));var o={problem_images:t,batch_room_id:A.batchRoomId||E.model.problem.batchRoomId,position_id:E.model.problem.positionId,item_id:E.model.problem.checkItemId,top_item_id:A.isSpecial?"":E.model.problem.topCheckItemId,desc_id:E.model.problem.descIds,contractor_id:E.model.problem.contractorIds,responsible_company_id:E.model.problem.responsibilityUnitIds,roomtype_diagram_id:E.model.problem.diagramId,coordinate:E.model.problem.coordinates,emergency_degree:E.model.problem.emergencyDegree,remark:E.model.problem.remark,is_passed_when_add:E.model.problem.isPassedWhenAdd?1:0,problemType:E.model.problemType,feedbackId:E.model.problem.feedbackId},i=[];return E.model.ProblemReasons.forEach((function(e){e.selected&&i.push(e.id)})),g["a"].batchAddProblem(o,A.isSpecial,e,i).then((function(){return w["a"].updateCheckItemUseTimes(E.model.problem.checkItemId).catch((function(e){window.$log("添加问题 updateCheckItemUseTimes catch & 参数",{error:e,curr_param:{checkItemId:E.model.problem.checkItemId}}),console.log("添加问题 updateCheckItemUseTimes catch & 参数",{error:e,curr_param:{checkItemId:E.model.problem.checkItemId}})}))})).then((function(){return w["a"].updateItemDescUseTimes(E.model.problem.descIds).catch((function(e){window.$log("添加问题 updateItemDescUseTimes catch & 参数",{error:e,curr_param:{descIds:E.model.problem.descIds}}),console.log("添加问题 updateItemDescUseTimes catch & 参数",{error:e,curr_param:{descIds:E.model.problem.descIds}})}))})).then((function(){return f["a"].init().catch((function(e){window.$log("添加问题 刷新房间问题model catch",e),console.error("添加问题 刷新房间问题model catch",e)})),A.mode})).catch((function(e){window.$log("添加问题 刷新房间问题model这一步的外部 catch",e),console.error("添加问题 刷新房间问题model这一步的外部 catch",e)})).finally((function(){console.log("添加问题 finally88"),E.model.problem.remark&&E.model.problem.descIds.indexOf(";")<0&&u["a"].upsertHistory(E.model.problem.checkItemId,E.model.problem.descIds,E.model.problem.remark).catch((function(e){window.$log("添加问题 finally catch",e),console.log("添加问题 finally catch",e)}))}))},editProblem:function(){var e=[],t=[];return l.a.each(E.model.problem.imageList,(function(e){t.push({img_localpath:e.localPath})})),E.model.ProblemReasons.forEach((function(t){t.selected&&e.push(t.id)})),g["a"].processEditProblem({id:E.model.problem.id,problem_images:t,batch_room_id:A.batchRoomId,position_id:E.model.problem.positionId,item_id:E.model.problem.checkItemId,top_item_id:A.isSpecial?"":E.model.problem.topCheckItemId,desc_id:E.model.problem.descIds,contractor_id:E.model.problem.contractorIds,responsible_company_id:E.model.problem.responsibilityUnitIds,emergency_degree:E.model.problem.emergencyDegree,remark:E.model.problem.remark,roomtype_diagram_id:E.model.problem.diagramId,coordinate:E.model.problem.coordinates,is_passed_when_add:E.model.problem.isPassedWhenAdd?1:0,is_passed_when_add_old:x},A.isSpecial,e).then((function(){p["a"].updateProblem(E.model.problem.id),f["a"].init()})).catch((function(e){return n["a"].reject(e)})).finally((function(){E.model.problem.remark&&E.model.problem.descIds.indexOf(";")<0&&L!=E.model.problem.remark&&u["a"].upsertHistory(E.model.problem.checkItemId,E.model.problem.descIds,E.model.problem.remark)}))}};t["a"]=E},db99:function(e,t,o){"use strict";o("6d57"),o("e697");var i=o("fd50"),n=(o("cc57"),o("9a33"),o("a324")),r=o("760e"),a=function(){var e=20,t={},o={},a={};return t={batch_unit_id:"cp.batch_unit_id",status:"cp.status",floor:"br.floor",item:"ci.id",user:"u.id"},o.formatData=function(e,t){var o=[],i=[];return _.each(e,(function(e){var n={};e.desc_id=e.desc_id.split(";"),_.each(e.desc_id,(function(e){o.indexOf(e)<0&&o.push(e)})),-1==e.floor.indexOf("层")&&-1==e.floor.indexOf("楼")&&-1==e.floor.indexOf("公共区域")&&(e.floor=e.floor+"楼"),n.id=e.id,n.code=e.code,n.batchRoomId=e.batch_room_id,n.batchUnitId=e.batch_unit_id,n.registerUserName=e.regist_user_name,n.roomtypeDiagramId=e.roomtype_diagram_id,n.status=e.status,n.roomName=t+"-"+e.floor+"-"+e.room_no,n.dealTime=e.deal_time&&"00-00-00 00:00:00"!==e.deal_time?e.deal_time:"",n.emergence=e.emergency_degree&&e.emergency_degree.indexOf("急")>-1?e.emergency_degree:"",n.sendBackTimes=e.sent_back_time||0,n.positionName=e.position,n.itemName=e.item,n.contractor=e.contractor||"",n.desc=e.desc_id,i.push(n)})),r["a"].getDescByIds(o).then((function(e){return _.each(i,(function(t){_.each(t.desc,(function(o,i){var n=_.find(e,{id:o});t.desc[i]=n?n.name:"无描述"})),t.desc=t.desc.join("、")})),i}))},o.getFilter=function(e,t){var o={status:n["a"].getCountOfProblemStatus,floor:n["a"].getCountOfFloor,item:n["a"].getCountOfCheckItem,user:n["a"].getCountOfRegister};return o[e](t)},a.createCondition=function(e,o){if(_.isEmpty(e))return"";"batch_unit_id"==o&&(o="");var i=[];return _.each(e,(function(e,n){t[n]&&n!==o&&i.push(t[n]+'="'+e+'"')})),i.join(" and ")},a.initFilter=function(){var e=[{type:"status",title:"问题状态",name:"",value:"",options:[]},{type:"floor",title:"楼层",name:"",value:"",options:[]},{type:"item",title:"检查项",name:"",value:"",options:[]},{type:"user",title:"登记人",name:"",value:"",options:[]}];return e},a.getProblems=function(t,r,c){var s=a.createCondition(r);return n["a"].getAllProblemListByPage(s,t,e).then((function(e){return!e||_.isEmpty(e)?[]:o.formatData(e,c)})).catch((function(e){return i["a"].reject(e)}))},a.getFilterCount=function(e){e=e||{};var n,r="",c={},s=[];return _.each(t,(function(t,i){"batch_unit_id"!==i&&(r=a.createCondition(e,i),n=o.getFilter(i,r).then((function(e){return{type:i,res:e}})),s.push(n))})),i["a"].all(s).then((function(e){return _.each(e,(function(e){if(e){var t=[],o=0;_.each(e.res,(function(e){t.push({count:e.count,name:e.name||e.title,value:e.value}),o+=e.count})),t.unshift({value:"",name:"全部",count:o}),c[e.type]=t}})),c}))},a.getSelectedProblems=function(e){var t=a.createCondition(e);return n["a"].getSelectedProblems(t)},a.passProblems=function(e){var t=[];return e.forEach((function(e){t.push(n["a"].passProblem(e.id,e.batchRoomId))})),i["a"].all(t)},a.getListInfoById=function(e,t){return n["a"].getListInfoById(e).then((function(e){return o.formatData([e],t).then((function(e){return e.shift()}))})).catch((function(e){return i["a"].reject(e)}))},a},c=a(),s=o("9072"),l=o("a14a"),d=o.n(l),m=function(){var e={},t=20,o={};function n(){d.a.isEmpty(e.filter)&&(e.filter=c.initFilter());var o=r(),i=[],n="";return c.getFilterCount(o).then((function(o){d.a.each(e.filter,(function(t,r){if(n=e.filter[r].value||"",t&&o[t.type]){var a=d.a.find(o[t.type],{value:n});a&&i.push(a.count),e.filter[r].options=o[t.type]}}));var r=Math.min.apply(null,i);e.totalPage=Math.ceil(r/t)}))}function r(){var t={batch_unit_id:e.batchUnitId};return d.a.each(e.filter,(function(e){e.value&&(t[e.type]=e.value)})),t}function a(){var t=i["a"].defer();if(e.isAllSelected){var o=r();c.getSelectedProblems(o).then((function(e){t.resolve(e)})).catch((function(e){t.reject(e)}))}else t.reject();return t.promise}function l(t){e.isAllSelected?e.problemList=[]:d.a.each(t,(function(t){var o=d.a.find(e.problemList,{id:t.id});if(o){var i=-1;e.problemList&&(i=e.problemList.indexOf(o)),i>-1&&e.problemList.splice(i,1)}}))}return e.filter=c.initFilter(),e.currPage=0,e.totalPage=0,e.problemList=[],e.isAllSelected=!1,o={model:e,init:function(t,n){var r=i["a"].when();return e.currPage=0,e.problemList=[],e.batchUnitId=t,e.unitName=n,e.currConditon={},1==window.isNeedClearAllData&&(e.filter=c.initFilter(),window.isNeedClearAllData=!1),null==window.take_photo_when_review&&r.then((function(){return s["a"].getReviewPhotoSetting()})),r.then((function(){return o.load(0)}))},load:function(t){if(t&&t==e.currPage)return i["a"].resolve();var o=r();return n(),c.getProblems(t,o,e.unitName).then((function(t){return e.isAllSelected&&t.forEach((function(e){e.checked=!0})),i["a"].resolve(t)})).then((function(o){return e.problemList=t?e.problemList.concat(o):o,e.currPage=t,i["a"].resolve(!0)}))},passProblems:function(e){var t=i["a"].defer(),o=function(e){c.passProblems(e).then((function(){l(e),t.resolve()})).catch((function(e){t.reject(e)}))};return e?o(e):a().then(o),t.promise},updateProblem:function(t){var o=d.a.find(e.problemList,{id:t});return o?c.getListInfoById(t,e.unitName).then((function(t){if(!d.a.isEmpty(t)){if(""!=e.filter[0].value&&o.status!=t.status){var i=e.problemList.indexOf(o);i>-1&&e.problemList.splice(i,1)}else o=d.a.extend(o,t);n(),$rootScope.$$phase||$rootScope.$digest()}})):i["a"].resolve()}}};t["a"]=m()},f97d:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAADa0lEQVRYR9WZO2hUQRSG/zN7MYRgkRhEURRMoYKNGtGsEkj2TlLYCGrwVVn4IoplLIQFCy1FxaiFlQ+MKWwsNnNvAqIbwVehoCkUFEXRmBQh+GB3jhy9G9Y1utnNRscptpmdM989Z85jzhDKGMlkUjU1Na3xPK+FmVcz81Iims/Ms0UcEY0x81siGiKiB5lMZmBwcPBeMpm0pW5HpSwIw3CBtbaTmXcR0cJS1jLzayK6pJQ6k0gk3kx17ZQAgyCYw8zHAOwGUBUJfwEgBeA2gKdE9GpkZGRM5urq6mYz8yIAywFsANAOYEm07guAi0R01Pf9j8VAiwIGQbCNmU8DqAeQBdATaSFdTHj+fBiGcdE+gA4AMQDDRNTp+/61P8n5LeDAwICXyWQEbF90rkw2mz3U3t7+rBSwwv+mUqllsVjsFDPraO6c53kHW1paMpPJnRQwnU5Xj4+PXwewkYg+ATjs+/6F6YAVrg2CYA+Ak8xcDeBmTU3N1ng8Lnv9NH4BjDR3Q+AAvGfmjW1tbfcrCZeT1dfX10hENwHMFUjP8zYVavIXQGNMd2TW97FYrLm1tXVoJuByMvv7+5dms9lbEeQ5rfX+/P1+Aowc4qqY1VrbPFOaK/xg0aRS6paYm4i25TvOBGAUSsQB6olob6XPXDEryJlk5vORdy/LhaAJQGPMWQD7icj4vt9WTOBMzAdB0Bd5d7fW+sD36CE/UYZ4DsCz1q6YbigpF15CkFLqCYCMUqpBMs53QGPMcQBdAK5qrXeUu0El1hljrgDYDuCE1voISeKPx+MvJbcqpdYnEomSMkQloCbJOHckd6fT6cWUSqXWKqXuAnihtW6o9IblyDPGyHFbYq1dR2EYdllrxcQTB7McoZVck3NYpdQRMsb0AtgMYKfWWuz/z4cxRvzgMhH1CuBjACsArNJaP/rndD+cdiWAhwCeUBAEH5hZgnP9VOqzv/EBUdKQcmxYNPhZitDR0dGqjo6Or38DoNgePT09s2pra6Ww/eI+4P9gYped5LE4yXVm3uJsmHE+UDuf6pwvFpwvt/6LgjXSorslvwA6f2mKIKUP4+a1M5fAnb64C6TzrQ+BdLp5lDO10+23/ILS2QZmAaS7LeCCS7WbTfTCO0T+M4S1thGAPEPMK3iGeAdgSCl1fzrPEN8Ajn19wtuO19cAAAAASUVORK5CYII="},fa1b:function(e,t,o){"use strict";var i=o("1834");t["a"]={getCheckItemList:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=[e],a="select bc.item_id, ci.full_name as item_full_name  from batch_checkitem bc  inner join check_item ci on ci.id = bc.item_id  where bc.batch_id = ? ";if(a+=t?" and ci.is_for_rough = 1 ":" and ci.is_for_decorated = 1 ",o){var c=n?"project_position_checkitem":"position_checkitem";a+=" and bc.item_id in                     (select item_id from "+c+" where position_id = ? )",r.push(o)}return a+=" order by ci.sort ",i["a"].query(a,r)}}}}]);