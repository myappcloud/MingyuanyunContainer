(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-4006cbe2"],{"0221":function(e,t,n){var i=n("f09f");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("ee665376",i,!0,{})},"0970":function(e,t,n){"use strict";n("6d57"),n("cc57");var i=n("1834"),o=function(){var e="select ci.id,ci.name,ci.parent_id,ci.sort,ci.ifEnd,cig.remark from check_item ci left join check_item_guide cig on ci.id=cig.item_id";return i["a"].query(e)},r=function(e){var t="select remark from check_item_guide where item_id = ?",n=[e];return i["a"].queryOne(t,n).then((function(e){return e&&e.remark}))},a=function(e){var t="select item.full_name,guide.remark as guide           from check_item_guide guide               inner join check_item item on guide.item_id=item.id           where guide.item_id=?";return i["a"].queryOne(t,[e])},c=function(){var e="select item.id,item.name,item.parent_id,guide.id is not null as has_guide       from check_item item           left join check_item_guide guide on item.id=guide.item_id              and ifnull(guide.remark,'') <> ''       order by sort";return i["a"].query(e)},s={getCheckItemWithGuide:o,getGuideByCheckItemId:r,getCheckItemList:c,getGuideAndItemByItemId:a},l=n("a14a"),d=n.n(l),m=function(){var e={};return{getItem:function(t,n){if(void 0===t||null===t)throw new TypeError("key参数为空");return n?e[t]:d.a.cloneDeep(e[t])},setItem:function(t,n){if(void 0===t||null===t)throw new TypeError("key参数为空");if(arguments.length<2)throw new TypeError("value参数未设置");e[t]=n},clear:function(){e={}}}},u=m(),f={IS_NEED_DOWNLOAD_BASE_DATA:"is_need_download_base_data",LAST_EXEC_TIME_DATA:"last_exec_time_data",LAST_GUIDE_SORT_MAP:"last_guide_sort_map"},h=function(){var e=function e(t,n){t.remark&&""!=t.remark&&(t.has_guide=!0),t.children=[];for(var i=0;i<n.length;i++)n[i].parent_id==t.id&&t.children.push(n[i]);if(t.children&&t.children.length>0)for(var o=0;o<t.children.length;o++)t.children[o]=e(t.children[o],n);return t};return{getCheckItemGuideByItemId:function(e){return s.getGuideByCheckItemId(e)},getCheckItemTree:function(){var t={id:""};return s.getCheckItemWithGuide().then((function(n){t=e(t,n);for(var i=0;i<t.children.length;i++)if("所有检查项"==t.children[i].name)return t.children[i].children;return t.children}))},getCheckItemTreeAndGuideSortMap:function(){return console.time("getData"),s.getCheckItemList().then((function(e){console.timeEnd("getData"),console.time("processData");var t={},n=[],i=0,o=[];function r(e,t){e.forEach((function(e){e.depth=t,e.tree?r(e.tree,t+1):e.has_guide&&(e.guide_sort=i,n[i]=e.id,i++)}))}return e.forEach((function(e){t[e.id]=e})),e.forEach((function(e){e.parent_id&&t[e.parent_id]?(t[e.parent_id].tree=t[e.parent_id].tree||[],t[e.parent_id].tree.push(e)):o.push(e)})),r(o,1),u.setItem(f.LAST_GUIDE_SORT_MAP,n),console.timeEnd("processData"),{tree:o,guideSortMap:n}}))},getGuideSortMapFromCatch:function(){return u.getItem(f.LAST_GUIDE_SORT_MAP,!0)},getGuideAndItemByItemId:s.getGuideAndItemByItemId}};t["a"]=h()},"0977":function(e,t,n){var i=n("4fa8");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("fdfda128",i,!0,{})},"0a1d":function(e,t,n){"use strict";n("6d57");var i=n("16ca"),o=n("fd50"),r=n("c6e3"),a=n("a324"),c=n("0523"),s=function(){var e=function(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=!1,r=0,a=!0;if("已交付"!=i.delivery_status){for(var c=0;c<t.length;c++){var s=t[c];s.batch_room_id.toLowerCase()==i.id.toLowerCase()&&(o=!0,["待派单","待指派","待整改"].indexOf(s.status)>-1&&(i.room_status="待整改",a=!1),"已整改"===s.status&&(a=!1,r=1),"已通过"!==s.status&&(a=!1))}a||i.room_status?"待整改"===i.room_status&&(i.has_repaired=r):i.room_status="已整改","交付中"!=i.delivery_status||"暂不收楼"===i.delivery_situation||o&&!a?("待交付"!=i.delivery_status||o&&!a)&&("交付中"!=i.delivery_status||"暂不收楼"!=i.delivery_situation||o&&!a)||(i.room_status="待交付"):i.room_status="已交付"}else i.room_status="已交付"}return e},t=function(t){var n=[r["a"].getUnitFloors(t),r["a"].getUnitRooms(t),a["a"].getProblemListByBatchUnitId(t)];return o["a"].all(n).then((function(n){var i=n[0],o=n[1],r=n[2];return e(o,r),c["a"].buildRoomListData(t,i,o)}))};return{getRoomListByBatchUnit:t}},l=s(),d=function(){var e=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n],o=!1,r=0,a=!0,c=0;c<t.length;c++){var s=t[c];s.batch_room_id.toLowerCase()==i.id.toLowerCase()&&(o=!0,["待派单","待指派","待整改"].indexOf(s.status)>-1&&(i.room_status="待整改",a=!1),"已整改"===s.status&&(a=!1,r=1),"已通过"!==s.status&&(a=!1))}if(a||i.room_status?"待整改"===i.room_status&&(i.has_repaired=r):i.room_status="已整改",o?a&&("已接待"===i.opening_status?i.room_status="已接待":i.room_status="待接待"):"已接待"===i.opening_status?i.room_status="已接待":i.room_status="待接待",!i.room_status)throw new Error("room_status 赋值为空."+i.id)}return e},t=function(t){var n=[r["a"].getUnitFloors(t),r["a"].getUnitRooms(t),a["a"].getProblemListByBatchUnitId(t)];return o["a"].all(n).then((function(n){var i=n[0],o=n[1],r=n[2];return o=e(o,r),c["a"].buildRoomListData(t,i,o)}))};return{getRoomListByBatchUnit:t}},m=d(),u=function(){var e={simulate:[{name:"全部",key:"all",dot:"",less:0},{name:"待检查",key:"待检查",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已通过",key:"已通过",dot:"green",less:0}],delivery:[{name:"全部",key:"all",dot:"",less:0},{name:"待交付",key:"待交付",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已交付",key:"已交付",dot:"green",less:0}],online_delivery:[{name:"全部",key:"all",dot:"",less:0},{name:"待交付",key:"待交付",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已交付",key:"已交付",dot:"green",less:0}],opening:[{name:"全部",key:"all",dot:"",less:0},{name:"待接待",key:"待接待",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已接待",key:"已接待",dot:"green",less:0}]},t={simulate:i["a"],delivery:l,opening:m,online_delivery:l},n={tabs:[],items:{},lastView:{},status_sel:"全部",status_counter:0,display_rooms:[]};return{model:n,init:function(e,t){return this.model.batchType=e,this.model.unitId=t,this.model.tabs=this.getTabs(e),this.getRoomList(e,t)},updateRoomList:function(){var e=this.model,t=e.batchType,n=e.unitId;this.init(t,n)},getTabs:function(t){return e[t]},tabsInit:function(){var e=this.model.items.unit_list[0].status_counter;this.model.tabs.forEach((function(t){t.less=e[t.key]||0}))},getRoomList:function(e,n){var i=this;return"special_checkitem"===e&&(e="simulate"),t[e]&&t[e].getRoomListByBatchUnit?t[e].getRoomListByBatchUnit(n).then((function(e){i.model.items=e,i.iniRoomData(),i.tabsInit()})):Promise.resolve()},iniRoomData:function(){this.model.items["unit_sel"]=this.model.items.unit_list[0].unit,this.roomStatusClass(),this.model.status_sel=this.model.lastView&&this.model.lastView.status||"全部",this.filterRoomList(),this.model.status_counter=this.model.items.unit_list[0].status_counter},filterRoomList:function(){for(var e=this.model.items.unit_list[0].floor_list,t=[],n=0;n<e.length;n++){for(var i=e[n].room_list,o=[],r=!1,a=0;a<i.length;a++)"全部"!=this.model.status_sel&&i[a].room_status!=this.model.status_sel||(o.push(i[a]),r=!0);r&&t.push({floor:e[n].floor,room_list:o})}this.model.display_rooms=t,console.log(this.model.display_rooms,"------------楼栋数据------------")},roomStatusClass:function(){for(var e=n.items.unit_list,t=0;t<e.length;t++)for(var i=e[t].floor_list,o=0;o<i.length;o++){var r=i[o].room_list;i[o]["floor_show"]=!0;for(var a=0;a<r.length;a++){switch(r[a]["room_show"]=!0,r[a].room_status){case"待检查":r[a]["room_status_class"]="white";break;case"待整改":r[a]["room_status_class"]="red",r[a].has_repaired&&(r[a]["room_status_class"]+=" problem-repaired");break;case"已整改":r[a]["room_status_class"]="blue";break;case"已通过":case"已接待":case"已交付":r[a]["room_status_class"]="green";break;default:r[a]["room_status_class"]="white";break}r[a]["room_info"]=JSON.stringify({building_name:r[a].building_name,unit:r[a].unit,floor:r[a].floor,room_no:r[a].room_no})}}}}};t["a"]=u()},"0a37":function(e,t,n){var i=n("1c4e");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("76d9ba51",i,!0,{})},1054:function(e,t,n){"use strict";n("5ab2"),n("6d57"),n("e44b"),n("e10e");var i=n("28f8"),o=n("3fa2"),r=n("273c"),a=n("cb6b"),c=n("0e1c"),s=n("86d9"),l=n("f2de"),d=n("9229");function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f="[views]/problem-list.vue",h={name:"ProblemList",props:{problemList:{type:Array,require:!0},isSpecial:{type:Boolean,require:!1}},data:function(){return{btns:[],canBatchAddProblem:!0,room:{},is_reviewed:"",batchRoomId:"",deliveryQualification:"",forbiddenDeliveryWhenUnqualified:!1,deliveredForbidRegistProblem:!1}},computed:u(u({},Object(l["e"])({currentBatchType:function(e){return e.app.global.currentBatchType},currentMenuType:function(e){return e.app.global.currentMenuType},todoBatchType:function(e){return e.app.global.todoBatchType},contentHeight:function(e){return e.app.global.contentHeight}})),{},{forbiddenDelivery:function(){return"不符合"===this.deliveryQualification&&this.forbiddenDeliveryWhenUnqualified},addProblemDisabled:function(){if("delivery"===this.currentBatchType||"online_delivery"===this.currentBatchType){if(this.room.hasDeliveryInfo&&this.deliveredForbidRegistProblem)return!0;if(this.room.isReviewed||this.is_reviewed.length>0)return!0}return!1}}),activated:function(){this.btns=o["a"].getButtonsByFromType(),this.is_reviewed=a["a"].getString(c["a"].IS_REVIEWED),o["a"].checkReviewed(),console.log(f,"activated() - btns",this.btns,"is_reviewed=".concat(this.is_reviewed))},created:function(){var e=this;this.btns=o["a"].getButtonsByFromType(),this.btns.length>1&&(this.btns[0].className="btn-white"),o["a"].checkReviewed(),a["a"].set(c["a"].IS_REVIEWED,""),console.log(f,"created() - btns",this.btns,"is_reviewed=".concat(this.is_reviewed)),this.batchRoomId=o["a"].room.batchRoomId,this.room=o["a"].room,console.log(f,"房间信息",this.room),console.log(f,"this.currentBatchType=".concat(this.currentBatchType)),console.log(f,"权限","add_problem=".concat(this.$checkRight("add_problem",this.currentBatchType))),console.log(f,"problemList",this.problemList),this.$eventBus.$on("app.roomdetail:statusChange",(function(){e.btns=o["a"].getButtonsByFromType()})),r["a"].getDeliveryQualification().then((function(t){e.deliveryQualification=t})),d["a"].getForbiddenToDeliveryRoomWhenUnqualified().then((function(t){e.forbiddenDeliveryWhenUnqualified=t})),d["a"].getDeliveredForbidRegistProblem().then((function(t){e.deliveredForbidRegistProblem=t}))},methods:{clickHandle:function(e,t){var n=this;switch(e){case"goDeliveryReview":return void("btn-theme"==t?this.$dialog.confirm({title:"温馨提示",message:"办理复查确认后，房间将不再允许登记新问题",confirmButtonText:"继续",cancelButtonText:"取消"}).then((function(){return n.$router.push({path:"/checkroom/delivery-review",query:{batchRoomId:n.batchRoomId,batch_unit_id:n.room.batchUnitId}})})).catch((function(){return!1})):this.$toast("所有问题整改通过后，才能办理复查确认",2e3));case"goAddDeliveryInfo":return void this.preHandleDelivery(e);default:if(e in r["a"])return r["a"][e]()}},canAddProblem:function(){return!this.addProblemDisabled||(this.room.hasDeliveryInfo&&this.deliveredForbidRegistProblem?(this.$toast("系统已设置收楼后不能登记新问题"),!1):(this.$toast("房间已复查通过，不允许登记问题！"),!1))},addBatchProblem:function(){this.canAddProblem()&&r["a"].goBatchAddProblem({positionList:s["a"].getAllPosition()})},addProblem:function(){this.canAddProblem()&&(this.isSpecial?this.room.hasDiagramImage?this.$emit("changeMode"):r["a"].goAddProblem():this.room.hasDiagramImage?r["a"].goMarkPosition():r["a"].goAddProblem())},editProblem:function(e){1===e.is_local?r["a"].goEditProblem(e):r["a"].goProblemView(e)},preHandleDelivery:function(e){this.forbiddenDelivery?this.$dialog.alert({title:"温馨提示",message:"该房间不符合交付资格",confirmButtonText:"我知道了"}).catch((function(){return!1})):r["a"][e]()}}},p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"problem-list"},[e.$checkRight("add_problem",e.currentBatchType)?n("div",{staticClass:"btns"},[e.$checkRight("add_problem",e.currentBatchType)&&"simulate"===e.currentBatchType&&e.room.canBatchAddProblem&&!e.isSpecial?n("div",{staticClass:"btn btn-batch",class:{"btn-disabled":e.addProblemDisabled},attrs:{"data-event":"用户点击","data-log":"批量登记问题"},on:{click:e.addBatchProblem}},[e._v("批量登记问题")]):e._e(),e._v(" "),n("div",{staticClass:"btn btn-single",class:{"btn-disabled":e.addProblemDisabled},attrs:{"data-event":"用户点击","data-log":"登记问题"},on:{click:e.addProblem}},[e._v("登记问题")])]):e._e(),e._v(" "),n("div",{staticClass:"list-box"},[n("div",{directives:[{name:"scroll",rawName:"v-scroll"}],ref:"list",staticClass:"list"},e._l(e.problemList,(function(t,i){return n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"item.isShow"}],key:i,staticClass:"item van-hairline--bottom",on:{click:function(n){return e.editProblem(t)}}},[t.code?n("div",{staticClass:"item-top"},[n("span",[e._v("编号："+e._s(t.code))])]):e._e(),e._v(" "),n("div",{staticClass:"item-bottom"},[n("p",{staticClass:"van-ellipsis",staticStyle:{width:"97%"}},[e._v(e._s(t.position_name)+" "+e._s(t.item_name))]),e._v(" "),n("span",{staticClass:"van-ellipsis",staticStyle:{display:"inline-block",width:"97%"}},[e._v(e._s(t.desc))])]),e._v(" "),n("div",{class:["circle",t.status_style]})])})),0)]),e._v(" "),e.btns.length&&!e.isSpecial?n("div",{staticClass:"footer-btns"},e._l(e.btns,(function(t,i){return n("div",{key:i,staticClass:"btn",class:[t.className,e.btns.length>=2&&"btn-theme"!=e.btns[e.btns.length-1].className?"disable-recheck":"",e.btns.length>1?e.btns[0].className="btn-white":"","goAddDeliveryInfo"===t.type&&e.forbiddenDelivery?"btn-disabled":""],attrs:{"data-event":"用户点击","data-log":t.label},on:{click:function(n){return e.clickHandle(t.type,t.className)}}},[e._v(e._s(t.label))])})),0):e._e()])},b=[],g=n("d082");function v(e){n("a948")}var _=!1,y=v,k="data-v-4c18cc1f",I=null,x=Object(g["a"])(h,p,b,_,y,k,I);t["a"]=x.exports},"16ca":function(e,t,n){"use strict";var i=n("fd50"),o=n("c6e3"),r=n("a324"),a=n("0523"),c=n("07a4"),s=n("af4c"),l=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(i.batch_room_id.toLowerCase()==e.toLowerCase())return!1}return!0},d=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(0!=i.has_problem||0!=i.is_checked)if(l(i.id,t))e[n].room_status="已通过";else{for(var o=!0,r=0,a=0;a<t.length;a++){var c=t[a];if(i.id.toLowerCase()==c.batch_room_id.toLowerCase()){var s=["待派单","待指派","待整改"];s.indexOf(c.status)>-1&&(i.room_status="待整改",o=!1),"已整改"===c.status&&(o=!1,r=1)}}o?i.room_status="已通过":i.room_status?"待整改"===i.room_status&&(i.has_repaired=r):i.room_status="已整改"}else e[n].room_status="待检查"}return e},m=function(e){var t=[o["a"].getUnitFloors(e),o["a"].getUnitRooms(e),r["a"].getProblemListByBatchUnitId(e)];return i["a"].all(t).then((function(t){var n=t[0],i=t[1],o=t[2];return d(i,o),a["a"].buildRoomListData(e,n,i)}))};t["a"]={getRoomListByBatchUnit:m,updateCheckStatus:function(e){return o["a"].getRoomCheckStatus(e).then((function(e){e=e||{};var t=!e["is_checked"]||!e["check_date"]||!e["check_engineer"];return o["a"].updateCheckStatus(e,t)})).then((function(){"todo"===c["a"].state.app.global.currentMenuType&&s["a"].updateRoomList(!0)}))}}},"1bfb":function(e,t,n){var i=n("2655");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("0faa23fa",i,!0,{})},"1c4e":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .tip[data-v-829243a6] {\n  width: 250px;\n  text-align: center;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n.zhkf .tip img[data-v-829243a6] {\n    width: 200px;\n}\n.zhkf .tip p[data-v-829243a6] {\n    color: #a0a0a0;\n    line-height: 20px;\n    font-size: 14px;\n    margin: 0 auto;\n    text-align: center;\n    margin-top: 3px;\n}\n",""])},2655:function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .check-list[data-v-192fc0b9] .van-collapse-item__content {\n  padding: 0;\n}\n.zhkf .check-list[data-v-192fc0b9] .van-cell {\n  font-size: 14px;\n}\n.zhkf .check-list[data-v-192fc0b9] .van-collapse-item__title {\n  font-weight: 500;\n}\n.zhkf .check-list[data-v-192fc0b9] {\n  overflow: scroll;\n}\n.zhkf .check-list .van-collapse .van-collapse-item__content .van-cell[data-v-192fc0b9] {\n    padding-left: 40px;\n}\n.zhkf .check-list .van-collapse .van-cell[data-v-192fc0b9]:not(:last-child)::after {\n    left: 40px;\n}\n.zhkf .check-list .van-tag[data-v-192fc0b9] {\n    position: absolute;\n    left: 5px;\n    top: 50%;\n    -webkit-transform: translateY(-50%);\n            transform: translateY(-50%);\n}\n.zhkf .check-list .loading[data-v-192fc0b9] {\n    margin: 0 auto;\n}\n.zhkf .check-list .readed[data-v-192fc0b9] {\n    color: #a0a0a0;\n}\n",""])},"273c":function(e,t,n){"use strict";n("5ab2"),n("6d57"),n("e44b"),n("e10e");var i=n("28f8"),o=(n("f548"),n("3fa2")),r=n("a18c"),a=n("16ca"),c=n("882e"),s=n("db5f"),l=n("0a1d"),d=n("af4c"),m=n("07a4"),u=n("6013"),f=n("c42d");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=o["a"].room,g="[model]/room-operate-model.js：";t["a"]={goCheckPassRoom:function(){return a["a"].updateCheckStatus(b.batchRoomId).then((function(){console.log(g,"goCheckPassRoom() - model:",l["a"].model),"todo"==m["a"].state.app.global.currentMenuType?d["a"].updateRoomList():l["a"].updateRoomList(),r["a"].go(-1)})).catch((function(e){return console.error(g,e)}))},goBatchAddProblem:function(e){console.log(g,"goBatchAddProblem() - data:",e),c["a"].setRoomPosition({unitId:b.batchUnitId,roomId:b.batchRoomId,roomTitle:b.title,position:e.positionList||[],diagramUrl:e.src||""}),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-batch-select-position")})},goMarkPosition:function(e){console.log(g,"goMarkPosition() - data:",e),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-mark-position"),query:{params:JSON.stringify(e)}})},goAddProblem:function(e,t){console.log(g,"goAddProblem() - data:",e),e=e||{};var n={title:b.title,building_id:b.buildingId,batch_unit_id:b.batchUnitId,batch_room_id:b.batchRoomId,positionId:e.positionId||e.id,positionName:e.positionName||"",diagramId:e.diagramId,problemStamp:(new Date).getTime(),layout_img_mode:b.mode,type:b.fromType,fitment_standard:b.fitmentStandard,problemType:e.problemType||"",projectId:b.projectId,checkItemId:e.checkItemId||"",itemName:e.checkItemName||"",descIds:e.descIds||"",descNames:e.descNames||"",isSpecial:b.isSpecial};e.x&&e.y&&(n["coordinate"]=JSON.stringify({x:e.x,y:e.y})),console.log(g,"goAddProblem() - ProblemModel:",n),s["a"].init(n),t?r["a"].replace({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-add-problem"),query:p({},n)}):r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-add-problem"),query:p({},n)})},goEditProblem:function(e){console.log(g,"goEditProblem() - data:",e);var t={title:b.title,batch_room_id:b.batchRoomId,batch_unit_id:b.batchUnitId,problemId:e.id||"",building_id:b.buildingId,diagramId:e.diagramId,problemStamp:(new Date).getTime(),type:b.fromType,fitment_standard:b.fitmentStandard,isSpecial:b.isSpecial};s["a"].init(t),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-edit-problem"),query:p({},t)})},goProblemView:function(e){console.log(g,"goProblemView() - data:",e);var t={title:b.title,batch_room_id:b.batchRoomId,batch_unit_id:b.batchUnitId,question_id:e.id||"",building_id:b.buildingId,type:b.fromType};r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-problem-detail"),query:p({},t)})},goCheckListDesc:function(e){console.log(g,"goCheckListDesc() - data:",e),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-check-list-detail"),query:{data:JSON.stringify(e)}})},goAddDeliveryInfo:function(){console.log(g,"goAddDeliveryInfo()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-config"),query:{fromPage:"problem_list",title:b.title,batchRoomId:b.batchRoomId}})},goRefuseDelivery:function(){console.log(g,"goRefuseDelivery()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-refuse"),query:{batchRoomId:b.batchRoomId}})},goCustomerEvaluationView:function(){console.log(g,"goCustomerEvaluationView()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-customer-tag")})},goDeliveryView:function(){console.log(g,"goDeliveryView()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-view"),query:{fromPage:"problem_list",title:b.title,batchRoomId:b.batchRoomId}})},goReceiveView:function(){console.log(g,"goReceiveView()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-receive-view"),query:{batchRoomId:b.batchRoomId}})},goAddReceiveInfo:function(){console.log(g,"goAddReceiveInfo()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-receive-record"),query:{fromPage:"problem_list",title:b.title,batchRoomId:b.batchRoomId}})},getDeliveryQualification:function(){return console.log(g,"getDeliveryQualification()"),f["a"].getHasNetwork().then((function(e){return e?u["a"].getTodoDeliveryDetail({batchId:b.batchId,roomId:b.id}).then((function(e){return e&&e.delivery_qualification||""})):""}))}}},"2c3f":function(e,t,n){e.exports=n.p+"img/error.c547f24e.png"},3141:function(e,t,n){var i=n("c2ad");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("1173c9fe",i,!0,{})},3956:function(e,t,n){var i=n("afd3");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("1b803e6a",i,!0,{})},"3d3a":function(e,t,n){"use strict";n("e697");var i=n("fd50"),o=n("0cd9"),r=n("8fee"),a=n("3fa2"),c=n("a14a"),s=n.n(c);function l(){var e,t,n={},c=a["a"].room;return e={model:n,init:function(){return n.currentPosition={},n.currentItem={},t=["全部"],t.push(1==c.isVirtual?"公区":"房间"),t="('"+t.join("','")+"')",o["a"].getRoomFitmentStandard(c.batchRoomId).then((function(e){return n.fitmentStandard=e.fitment_standard,o["a"].getPositionList(c.projectId,c.batchRoomId)})).then((function(e){return n.positionList=e,o["a"].getFirstPositionItemNotDone(c.projectId,c.batchRoomId,n.fitmentStandard,t)})).then((function(t){return t&&t.position_id?n.defaultPositionId=t.position_id:n.defaultPositionId=n.positionList&&n.positionList[0]&&n.positionList[0].position_id,e.getPositionItem(n.defaultPositionId,!0)}))},getPositionItem:function(e,r){if(e){var a=s.a.find(n.positionList,{position_id:e});return a&&a.checkItem?i["a"].when(a.checkItem):a?o["a"].getPositionEndItem(c.projectId,c.batchRoomId,e,n.fitmentStandard,t).then((function(e){return a.checkItem=e,r&&(a.open=!0),a.checkItem})):i["a"].when([])}},setPositionItemDone:function(e,t){if(e&&t){var i=s.a.find(n.positionList,{position_id:e}),r=s.a.find(i.checkItem,{item_id:t});r.done=!0}else e=n.currentPosition.position_id,t=n.currentItem.item_id,!n.currentItem.done&&(n.currentItem.done=!0);return o["a"].addDoneItemRecord(c.batchRoomId,e,t)},getItemDesc:function(e){return r["a"].getRoomCheckListDescList(e,n.fitmentStandard)},setCurrent:function(e,t){n.currentPosition.position_id!=e&&(n.currentPosition=s.a.find(n.positionList,{position_id:e})),n.currentItem.item_id!=t&&(n.currentItem=s.a.find(n.currentPosition.checkItem,{item_id:t}))},getCurrentItemPosition:function(){if(!n.currentPosition.position_id||!n.currentItem.item_id)return!1;var e=s.a.indexOf(n.currentPosition.checkItem,n.currentItem),t=s.a.indexOf(n.positionList,n.currentPosition),i=n.currentPosition.checkItem.length-1,o=n.positionList.length-1,r=!0,a=!0;return e==i&&t==o?a=!1:0==e&&0==t?r=!1:(e<0||t<0)&&(r=!1,a=!1),{hasPrev:r,hasNext:a}},getPreviousItem:function(){var t,o=s.a.indexOf(n.currentPosition.checkItem,n.currentItem);if(0!==o)return t=n.currentPosition.checkItem[o-1],i["a"].when(t);var r=s.a.indexOf(n.positionList,n.currentPosition);if(0!==r){var a=n.positionList[r-1];return n.currentPosition=a,a.checkItem?(t=a.checkItem[a.checkItem.length-1],i["a"].when(t)):e.getPositionItem(a.position_id).then((function(e){return i["a"].when(e&&e[e.length-1])}))}return i["a"].reject()},getNextItem:function(){var t,o=s.a.indexOf(n.currentPosition.checkItem,n.currentItem);if(o!==n.currentPosition.checkItem.length-1)return t=n.currentPosition.checkItem[o+1],i["a"].when(t);var r=s.a.indexOf(n.positionList,n.currentPosition);if(r!==n.positionList.length-1){var a=n.positionList[r+1];return n.currentPosition=a,a.checkItem?(t=a.checkItem[0],i["a"].when(t)):e.getPositionItem(a.position_id).then((function(e){return i["a"].when(e&&e[0])}))}return i["a"].reject()}},e}t["a"]=l()},"423b":function(e,t,n){"use strict";n("6d57");var i=n("8ae6"),o=n("3fa2"),r=n("9443");function a(){var e={},t=o["a"].room;return{model:e,room:t,init:function(){return e.currItem={},r["a"].getRoomFitmentStyleName(t.id).then((function(t){e.fitmentStyleName=t})).then((function(){return r["a"].getRoomFitmentStyles(t.id).then((function(t){var n=[],o=Object(i["e"])(),r=0;e.defaultList=t.defaultList,e.individualList=t.individualList,t.individualList.forEach((function(e){e&&e.id&&n.push(r),e.ans=r++,e.image=e.image?o+e.image:"",e.isIndividual=!0})),t.defaultList.forEach((function(e){e&&e.id&&n.push(r),e.ans=r++,e.image=e.image?o+e.image:"",e.isIndividual=!1})),e.fitmentStyleIds=n}))}))},getCurrentIndex:function(){if(e.fitmentStyleIds&&e.currItem){var t=e.fitmentStyleIds.indexOf(e.currItem.ans);return{currentIndex:t+1,allCount:e.fitmentStyleIds.length}}return{currentIndex:0,allCount:0}},goToPrevious:function(){if(e.fitmentStyleIds&&e.currItem){var t=e.fitmentStyleIds.indexOf(e.currItem.ans);t<=e.individualList.length&&t>0?e.currItem=e.individualList[t-1]:t>e.individualList.length&&t<e.fitmentStyleIds.length&&(e.currItem=e.defaultList[t-e.individualList.length-1])}},goToNext:function(){if(e.fitmentStyleIds&&e.currItem){var t=e.fitmentStyleIds.indexOf(e.currItem.ans);t<e.individualList.length-1?e.currItem=e.individualList[t+1]:t>=e.individualList.length-1&&t<e.fitmentStyleIds.length-1&&(e.currItem=e.defaultList[t-e.individualList.length+1])}}}}t["a"]=a()},4352:function(e,t,n){"use strict";n("cc57"),n("163d");var i=n("8366"),o=n.n(i),r=n("a593");r["default"].use(o.a);var a={name:"HouseType",props:{views:{type:Array,require:!0},currTab:{type:Number,require:!0},mark:{type:Boolean,default:!1}},data:function(){return{title:"",curr:1,total:0,options:{curr:0,onTap:this.onTap,onChange:this.onChange,mark:this.mark,views:this.views}}},watch:{views:{handler:function(e,t){this.renderHouseType(!0)},immediate:!1,deep:!0},currTab:{handler:function(e,t){this.currTab||this.renderHouseType()}}},mounted:function(){this.renderHouseType()},activated:function(){this.renderHouseType()},methods:{renderHouseType:function(e){var t=this.$refs["house-type-img"];e&&(this.options.views=this.views),paper.render(t,this.options)},onTap:function(e){var t,n,i,o=this.views[this.options.curr]||{};if("point"===e.type)for(t=o.problemList||[],i=0,n=t.length;i<n;i++)if(t[i].id===e.id){e.is_local=t[i].is_local||0;break}e.diagramId=o.id,this.$emit("onTap",e)},onChange:function(e){this.curr=e+1,this.options.curr=e,this.title=this.options.views[e].name,this.total=this.options.views&&this.options.views.length,this.$emit("onChange",e)}}},c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"house-type"},[n("div",{directives:[{name:"tap",rawName:"v-tap"}],ref:"house-type-img",staticClass:"house-type-img"}),e._v(" "),e.title&&e.total>1?n("span",{staticClass:"house-type-title"},[e._v(e._s(e.title))]):e._e(),e._v(" "),e.total&&e.total>1?n("span",{staticClass:"house-type-number"},[e._v(e._s(e.curr)+"/"+e._s(e.total))]):e._e()])},s=[],l=n("d082");function d(e){n("3956")}var m=!1,u=d,f="data-v-6d2fd172",h=null,p=Object(l["a"])(a,c,s,m,u,f,h);t["a"]=p.exports},4438:function(e,t,n){"use strict";var i=n("cb6b"),o=n("0e1c");t["a"]={getLocalBusinessToggle:function(){var e=i["a"].getObject(o["a"].BUSINESS_TOGGLE,i["a"].level.user);return e||{enable_opening_tab:0,enable_pass_when_add:0,enable_pass_when_to_repair:0,sign_when_receive_delivery:1,special_project_switch:0,take_photo_when_review:0,take_photo_when_regist:0,hide_owner_phone:0,enable_problem_reason:0}}}},"4fa8":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .bg-white[data-v-38ded916] {\n  background: #fff;\n}\n.zhkf .fitment-style[data-v-38ded916] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n}\n.zhkf .list-wrapper[data-v-38ded916] {\n  overflow: scroll;\n}\n.zhkf .title[data-v-38ded916] {\n  height: 40px;\n  min-height: 40px;\n  line-height: 40px;\n  padding-left: 15px;\n  background: #eff9ff;\n  color: #606060;\n  font-size: 15px;\n}\n.zhkf .van-cell[data-v-38ded916] {\n  padding: 10px 15px;\n}\n.zhkf .van-cell[data-v-38ded916]:not(:last-child)::after {\n  left: 15px;\n}\n.zhkf .van-cell__title[data-v-38ded916] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  width: 100%;\n}\n.zhkf .van-cell__title img[data-v-38ded916],\n  .zhkf .van-cell__title span[data-v-38ded916] {\n    vertical-align: middle;\n}\n.zhkf .van-cell__title img[data-v-38ded916] {\n    margin-right: 20px;\n    width: 60px;\n    height: 60px;\n}\n.zhkf .fitment-name[data-v-38ded916] {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  width: 70%;\n  line-height: 60px;\n}\n.zhkf .fitment-style[data-v-38ded916] .van-cell__right-icon {\n  position: absolute;\n  top: 50%;\n  right: 15px;\n  -webkit-transform: translateY(-50%);\n          transform: translateY(-50%);\n}\n.zhkf .fitment-style[data-v-38ded916] .van-tag {\n  position: absolute;\n  top: 50%;\n  right: 40px;\n  -webkit-transform: translateY(-50%);\n  transform: translateY(-50%);\n}\n.zhkf .individualList[data-v-38ded916] {\n  margin-bottom: 10px;\n}\n.zhkf .individualList .fitment-name[data-v-38ded916] {\n    width: calc(100% - 140px);\n}\n",""])},5119:function(e,t,n){"use strict";n.r(t);n("5ab2"),n("6d57"),n("e44b"),n("e10e");var i=n("28f8"),o=n("9a9a"),r=(n("f0e6"),n("163d"),n("4352")),a=n("86d9"),c=n("273c"),s=n("a9ec"),l=n("0938"),d=n("0e1c"),m=n("cb6b"),u=n("9229"),f={name:"HouseImg",components:{houseType:r["a"]},props:{currTab:{type:Number,require:!0}},data:function(){return{model:{},batchRoomId:"",batch_unit_id:"",is_reviewed:"",buttons:[],deliveryQualification:"",forbiddenDeliveryWhenUnqualified:!1,deliveredForbidRegistProblem:!1,debugLog:!0}},computed:{forbiddenDelivery:function(){return"不符合"===this.deliveryQualification&&this.forbiddenDeliveryWhenUnqualified}},watch:{currTab:{handler:function(e,t){this.toggleToHuXingPage()}}},created:function(){this.onTap=Object(l["i"])(this.onTap,300),a["a"].room.hasDiagramImage&&(this.initData(),m["a"].set(d["a"].IS_REVIEWED,""))},activated:function(){this.buttons=a["a"].getButtonsByFromType(!0),this.is_reviewed=m["a"].getString(d["a"].IS_REVIEWED)},methods:{initData:function(){var e=this;c["a"].getDeliveryQualification().then((function(t){e.deliveryQualification=t})),u["a"].getForbiddenToDeliveryRoomWhenUnqualified().then((function(t){e.forbiddenDeliveryWhenUnqualified=t})),u["a"].getDeliveredForbidRegistProblem().then((function(t){e.deliveredForbidRegistProblem=t})),this.batchRoomId=this.$route.query.batchRoomId,a["a"].init().then((function(){})).finally((function(){a["a"].updateProblemPoints(s["a"].model.problemList),e.model=a["a"].model,e.buttons=a["a"].getButtonsByFromType(!0),e.batch_unit_id=a["a"].room.batchUnitId})).catch((function(e){return console.error(e)})),this.$eventBus.$on("app.roomdetail:updateProblemPoints",(function(e){console.log("更新户型图问题点"),a["a"].updateProblemPoints(e)}))},btnClick:function(e,t){var n=this;switch(this._log("点击按钮 - btnClick",e),e){case"goBatchAddProblem":return c["a"].goBatchAddProblem({positionList:a["a"].getAllPosition()});case"goDeliveryReview":return void("btn-theme"==t?this.$dialog.confirm({title:"温馨提示",message:"办理复查确认后，房间将不再允许登记新问题",confirmButtonText:"继续",cancelButtonText:"取消"}).then((function(){return n.$router.push({path:"/checkroom/delivery-review",query:{batchRoomId:n.batchRoomId,batch_unit_id:n.batch_unit_id}})})).catch((function(){return!1})):this.$toast("所有问题整改通过后，才能办理复查确认",2e3));case"goAddDeliveryInfo":return void this.preHandleDelivery(e);default:if(e in c["a"])return c["a"][e]()}},preHandleDelivery:function(e){this.forbiddenDelivery?this.$dialog.alert({title:"温馨提示",message:"该房间不符合交付资格",confirmButtonText:"我知道了"}).catch((function(){return!1})):c["a"][e]()},onTap:function(e){var t=a["a"].room;return"point"===e.type?1===e.is_local?c["a"].goEditProblem(e):c["a"].goProblemView(e):this.$checkRight("add_problem",t.fromType)?("delivery"===t.fromType||"online_delivery"===t.fromType)&&t.hasDeliveryInfo&&this.deliveredForbidRegistProblem?this.$toast("系统已设置收楼后不能登记新问题"):"delivery"!==t.fromType&&"online_delivery"!==t.fromType&&"opening"!==t.fromType||!this.is_reviewed.length&&!a["a"].room.isReviewed?(this._log("点击户型图 - onTap","添加问题",e),void c["a"].goAddProblem(e)):(this._log("点击户型图 - onTap","房间已复查通过，不允许登记问题！"),this.$toast("房间已复查通过，不允许登记问题！")):(this._log("点击户型图 - onTap","您没有登记问题的权限！"),this.$toast("您没有登记问题的权限！"))},onChange:function(e){this._log("切换户型图 - onChange",e)},toggleToHuXingPage:function(){this.model=a["a"].model},_log:function(){if(this.debugLog){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log("[views]/house-img",t)}}}},h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"houseImg"},[e.model.options&&e.model.options.length?n("house-type",{staticClass:"house-type",attrs:{views:e.model.options,mark:!1,"curr-tab":e.currTab},on:{onTap:e.onTap,onChange:e.onChange}}):e._e(),e._v(" "),n("div",{staticClass:"footer"},[n("div",{staticClass:"tip"},[e._v("提示：点击户型图可登记问题")]),e._v(" "),e.buttons.length?n("div",{staticClass:"btns"},e._l(e.buttons,(function(t,i){return n("div",{key:i,staticClass:"btn",class:[t.className,"btn-gray"===t.className?"van-hairline--right":"",e.buttons.length>=2&&"btn-theme"!=e.buttons[e.buttons.length-1].className?"disable-recheck":"",e.buttons.length>1?e.buttons[0].className="btn-white":"","goAddDeliveryInfo"===t.type&&e.forbiddenDelivery?"btn-disabled":""],attrs:{"data-event":"用户点击","data-log":t.label},on:{click:function(n){return e.btnClick(t.type,t.className)}}},[e._v(e._s(t.label))])})),0):e._e()])],1)},p=[],b=n("d082");function g(e){n("3141")}var v=!1,_=g,y="data-v-6b818beb",k=null,I=Object(b["a"])(f,h,p,v,_,y,k),x=I.exports,w=n("3d3a"),P=n("f2de");function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var T="[views]/check-list.vue：",D={name:"CheckList",data:function(){return{activeNames:"",model:{},itemLoaded:!0}},computed:C({},Object(P["e"])({contentHeight:function(e){return e.app.global.contentHeight}})),created:function(){var e=this;w["a"].init().then((function(){e.model=w["a"].model,e.model.positionList.forEach((function(t,n){t.open&&(e.activeNames=n)}))})).catch((function(e){return console.error(T,e)}))},activated:function(){},methods:{clickHandle:function(e){var t=this;console.log(T,"clickHandle() - index:",e);var n=this.model.positionList[e];n.checkItem?this.itemLoaded=!0:(this.itemLoaded=!1,w["a"].getPositionItem(n.position_id).then((function(e){t.$set(n,"checkitem",e),t.$nextTick((function(){t.itemLoaded=!0}))})))},openDesc:function(e,t){w["a"].setPositionItemDone(e.position_id,t.item_id),w["a"].setCurrent(e.position_id,t.item_id),c["a"].goCheckListDesc({position_id:e.position_id,position_name:e.position_name,checkitem_id:t.item_id,checkitem_name:t.full_name})},onChange:function(e){console.log(T,"onChange()",e)}}},O=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"scroll",rawName:"v-scroll"}],ref:"list",staticClass:"check-list",style:{height:e.contentHeight-50+"px"}},[e.model.positionList&&e.model.positionList.length?n("van-collapse",{attrs:{accordion:""},on:{change:e.onChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.model.positionList,(function(t,i){return n("van-collapse-item",{key:i,attrs:{name:i},nativeOn:{click:function(t){return e.clickHandle(i)}}},[n("div",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.position_name))]),e._v(" "),e.itemLoaded?n("div",{staticClass:"item-list"},e._l(t.checkItem,(function(i,o){return n("van-cell",{key:o,class:{readed:i.done},attrs:{"is-link":""},on:{click:function(n){return e.openDesc(t,i)}}},[n("template",{slot:"title"},[n("span",{staticClass:"custom-text"},[e._v(e._s(i.full_name))]),e._v(" "),i.isImportant?n("van-tag",{attrs:{color:i.done?"#f8c396":"#ff8100"}},[e._v("\n              重点\n            ")]):e._e()],1)],2)})),1):n("van-loading",{staticClass:"loading"})],1)})),1):e._e()],1)},j=[];function R(e){n("1bfb")}var A=!1,B=R,z="data-v-192fc0b9",S=null,E=Object(b["a"])(D,O,j,A,B,z,S),N=E.exports,F=n("98c5"),U=n("3fa2");function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q={name:"DesiginChange",data:function(){return{model:{},deliveredForbidRegistProblem:!1}},computed:W(W({},Object(P["e"])({currentBatchType:function(e){return e.app.global.currentBatchType},contentHeight:function(e){return e.app.global.contentHeight}})),{},{addProblemDisabled:function(){if("delivery"===this.currentBatchType||"online_delivery"===this.currentBatchType){if(U["a"].room.hasDeliveryInfo&&this.deliveredForbidRegistProblem)return!0;if(U["a"].room.isReviewed)return!0}return!1}}),created:function(){var e=this;F["a"].init(),this.model=F["a"].model,U["a"].checkReviewed(),u["a"].getDeliveredForbidRegistProblem().then((function(t){e.deliveredForbidRegistProblem=t}))},methods:{addProblem:function(e){if(this.addProblemDisabled){if(U["a"].room.hasDeliveryInfo&&this.deliveredForbidRegistProblem)return void this.$toast("系统已设置收楼后不能登记新问题");if(U["a"].room.isReviewed)return void this.$toast("房间已复查通过，不允许登记问题！")}F["a"].addProblem(e)}}},H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.model.designChangeList&&e.model.designChangeList.length?n("div",{staticClass:"design-change",style:{height:e.contentHeight-50+"px"}},e._l(e.model.designChangeList,(function(t,i){return n("div",{key:i,staticClass:"item"},[n("div",{staticClass:"item-header"},[n("div",{staticClass:"header-position"},[e._v("变更位置: "+e._s(t.location))]),e._v(" "),n("div",{staticClass:"header-content"},[e._v("变更内容："+e._s(t.content||"无"))]),e._v(" "),n("div",{staticClass:"header-introduction"},[e._v("补充说明："+e._s(t.show_remark||"无"))])]),e._v(" "),e.$checkRight("add_problem",e.currentBatchType)?n("div",{staticClass:"item-btn van-hairline--top",class:{disabled:e.addProblemDisabled},on:{click:function(n){return e.addProblem(t)}}},[e._v("检查不通过")]):e._e()])})),0):e._e()},Y=[];function G(e){n("620d")}var Q=!1,V=G,$="data-v-c1f063be",Z=null,X=Object(b["a"])(q,H,Y,Q,V,$,Z),J=X.exports,K=n("5cf9"),ee=n("423b");function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ie={name:"FitmentStyle",components:{tip:K["a"]},data:function(){return{model:{individualList:[],defaultList:[]}}},computed:ne({},Object(P["e"])({currentBatchType:function(e){return e.app.global.currentBatchType},currentMenuType:function(e){return e.app.global.currentMenuType},contentHeight:function(e){return e.app.global.contentHeight}})),created:function(){var e=this;ee["a"].init().then((function(){e.model=ee["a"].model,console.log(e.model)}))},methods:{handleClick:function(e){console.log(e),ee["a"].model.currItem=e,this.$router.push({path:"/checkroom/".concat(this.currentMenuType||this.currentBatchType,"-fitment-style-detail"),query:{params:JSON.stringify(e)}})}}},oe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"fitment-style",class:{"bg-white":!e.model.individualList.length&&!e.model.defaultList.length}},[i("div",{staticClass:"title"},[e._v("装修风格： "+e._s(e.model.fitmentStyleName))]),e._v(" "),e.model.individualList.length||e.model.defaultList.length?i("div",{staticClass:"list-wrapper",style:{height:e.contentHeight-90+"px"}},[e.model.individualList&&e.model.individualList.length?i("div",{staticClass:"individualList"},e._l(e.model.individualList,(function(t,o){return i("van-cell",{key:o,attrs:{"is-link":""},on:{click:function(n){return e.handleClick(t)}}},[i("template",{slot:"title"},[i("img",{attrs:{src:t.image||n("c433"),alt:"fitment"}}),e._v(" "),i("span",{staticClass:"fitment-name"},[e._v(e._s(t.positionName+"："+t.checkItemName))]),e._v(" "),i("van-tag",{attrs:{color:"#ff8100"}},[e._v("选配")])],1)],2)})),1):e._e(),e._v(" "),e.model.defaultList&&e.model.defaultList.length?i("div",{staticClass:"defaultList"},e._l(e.model.defaultList,(function(t,o){return i("van-cell",{key:o,attrs:{"is-link":""},on:{click:function(n){return e.handleClick(t)}}},[i("template",{slot:"title"},[i("img",{attrs:{src:t.image||n("c433"),alt:"fitment"}}),e._v(" "),i("span",{staticClass:"fitment-name"},[e._v(e._s(t.positionName+"："+t.checkItemName))])])],2)})),1):e._e()]):i("tip",{attrs:{"img-url":n("2c3f"),"tip-cont":"精装选配项，尚未初始化"}})],1)},re=[];function ae(e){n("0977")}var ce=!1,se=ae,le="data-v-38ded916",de=null,me=Object(b["a"])(ie,oe,re,ce,se,le,de),ue=me.exports,fe=n("1054"),he=n("77a8"),pe=n("438a"),be=n("0a1d"),ge=n("ba1a");function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ye={name:"RoomDetail",components:{roomFilter:o["a"],houseImg:x,checkList:N,designChange:J,fitmentStyle:ue,problemList:fe["a"],emptyPage:pe["a"]},data:function(){return{currTab:0,model:{},problemListModel:{},problemListFilterModel:{},params:null,pageLoading:!1}},computed:_e({},Object(P["e"])({currentMenuType:function(e){return e.app.global.currentMenuType},currentBatchType:function(e){return e.app.global.currentBatchType}})),created:function(){console.log("RoomListModel.model",be["a"].model),this.initData()},methods:{initData:function(){var e=this,t=ge["a"].getDecodeQuery(this.$route.query);if(U["a"].model.room&&U["a"].model.room.batchRoomId===t.batchRoomId)return this.model=U["a"].model,this.problemListModel=s["a"].model,this.problemListFilterModel=he["a"].model,this.pageLoading=!1,this.currTab=0,!1;this.pageLoading=!0,U["a"].init(t).then((function(){return he["a"].init()})).then((function(){return s["a"].init()})).then((function(){e.model=U["a"].model,e.problemListModel=s["a"].model,e.problemListFilterModel=he["a"].model,e.pageLoading=!1,e.currTab=0})).catch((function(e){return console.log(e)}))},chooseItem:function(e,t){s["a"].updateProblemList(t),console.log(he["a"])},back:function(){var e=this;if("todo"!==this.currentMenuType&&["opening","delivery","online_delivery"].indexOf(this.currentBatchType))return this.$router.go(-1);console.log(U["a"].room.canCheckPassRoom);var t=m["a"].getString("not_show_check_room_tip",m["a"].level.user);U["a"].room.canCheckPassRoom&&!t?this.$dialog.confirm({title:"温馨提醒",confirmButtonText:"稍后继续检查",cancelButtonText:"检查完毕",message:"亲，房间检查完了，记得点击“检查完毕“"}).then((function(){e.$router.go(-1)})).catch((function(){c["a"].goCheckPassRoom().then((function(){e.$router.go(-1)}))})):this.$router.go(-1)},tabChange:function(e,t){this.model.currTab=t}}},ke=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"roomdetail"},[n("cus-nav-bar",{attrs:{title:e.model.roomTitle,"left-arrow":"",border:!1,"use-click-left":""},on:{"click-left":e.back}}),e._v(" "),n("empty-page",{attrs:{"show-empty":e.pageLoading,"loading-page":!0,"empty-msg":"正在加载中，请耐心等待"}}),e._v(" "),!e.pageLoading&&e.model.tabs&&e.model.tabs.length?n("van-tabs",{attrs:{border:!0,"swipe-threshold":5,"line-width":24},on:{change:e.tabChange},model:{value:e.currTab,callback:function(t){e.currTab=t},expression:"currTab"}},e._l(e.model.tabs,(function(t,i){return n("van-tab",{key:i,attrs:{title:t}},["户型图"===t||"列表"===t?n("room-filter",{attrs:{"filter-list":e.problemListFilterModel.list},on:{chooseItem:e.chooseItem}}):e._e(),e._v(" "),"户型图"===t?n("house-img",{attrs:{"curr-tab":e.currTab}}):e._e(),e._v(" "),"检查清单"===t?n("check-list"):e._e(),e._v(" "),"设计变更"===t?n("design-change"):e._e(),e._v(" "),"装修风格"===t?n("fitment-style"):e._e(),e._v(" "),"列表"===t?n("problem-list",{attrs:{"problem-list":e.problemListModel.problemList}}):e._e()],1)})),1):e._e()],1)},Ie=[];function xe(e){n("0221")}var we=!1,Pe=xe,Le="data-v-156a7b78",Ce=null,Te=Object(b["a"])(ye,ke,Ie,we,Pe,Le,Ce);t["default"]=Te.exports},"5c1b":function(e,t,n){"use strict";n("f0e6");var i=n("bbed"),o=n("fa1b"),r=n("07a4"),a=n("fd50");function c(){var e=function(e){e&&e.fitment_standard&&("毛坯"===e.fitment_standard?e.is_for_rough=1:"精装"===e.fitment_standard&&(e.is_for_decorated=1),delete e.fitment_standard)},t=function(e,t,n,o,r){return i["a"].getCheckItemLeaf(e,t,o,r).then((function(e){if(_.isEmpty(e))return[];var t=[];return _.each(e,(function(e){t.push(e.id)})),i["a"].getCheckItemAll(t.join("','"),n,o,r)}))};return{getCheckItemList:function(e,n,o,c,s){var l="毛坯"==c,d=a["a"].when(),m=["全部"];return m.push(1==s?"公区":"房间"),m="('"+m.join("','")+"')",d=r["a"].state.app.global.isUseProjectItem?i["a"].getProjectCheckItemList(e,n,o,l,m):t(e,n,o,l,m),d.then((function(e){return e}))},hasProjectCheckitem:function(e){return i["a"].hasProjectCheckitem(e)},searchCheckItemWithProject:function(t,n,o,r){return e(o),r?i["a"].searchProjectCheckItem(r,t,n,o):i["a"].searchCheckItem(t,n,o)},searchCheckItem:function(t,n,o,r){return console.log("searchCheckItem: ",t,n,o),console.time("searchCheckItem"),e(o),i["a"].hasProjectCheckitem(r).then((function(e){return e?i["a"].searchProjectCheckItem(r,t,n,o):i["a"].searchCheckItem(t,n,o).finally((function(){console.timeEnd("searchCheckItem")}))}))},getHigherLevelTreeListByCheckItemId:function(t,n,o){return console.log("getHigherLevelTree: ",t,n,o),console.time("getHigherLevelTree"),e(o),i["a"].getHigherLevelTreeListByCheckItemId(t,n,o).finally((function(){console.timeEnd("getHigherLevelTree")}))},getCheckItemLevel:function(e,t){return i["a"].getCheckItemLevel(e,t)},getPositionItemByRoom:function(e,t,n){var o=a["a"].when(),c=["全部"];return c.push(1==n?"公区":"房间"),c="('"+c.join("','")+"')",o=r["a"].state.app.global.isUseProjectItem?i["a"].getProjectPositionItemByRoom(e,t,c):i["a"].getPositionItemByRoom(e,c),o.then((function(e){return e}))},setIsUseProjectItemOfBatchUnit:function(e){return i["a"].getProjectItemOfBatchUnit(e).then((function(e){var t=!1;e&&(t=!0),r["a"].commit("app/APP",{isUseProjectItem:t})}))},getBatchCheckItem:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return o["a"].getCheckItemList(e,t,n,r["a"].state.app.global.isUseProjectItem).then((function(e){return console.log("BatchCheckItem",e),a["a"].resolve(e)}))}}}t["a"]=c()},"5cf9":function(e,t,n){"use strict";var i={props:{isShow:{type:Boolean,default:!0},imgUrl:{type:String,required:!0},tipCont:{type:String,default:"系统繁忙请稍后重试"}}},o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticClass:"tip"},[n("img",{attrs:{src:e.imgUrl,alt:"tip"}}),e._v(" "),e.tipCont?n("p",{domProps:{innerHTML:e._s(e.tipCont)}}):e._e()])},r=[],a=n("d082");function c(e){n("0a37")}var s=!1,l=c,d="data-v-829243a6",m=null,u=Object(a["a"])(i,o,r,s,l,d,m);t["a"]=u.exports},6013:function(e,t,n){"use strict";var i=n("07a4"),o=n("dfb1"),r=n("81ad"),a=n("c6e3"),c=n("9430"),s=n("a14a"),l=n.n(s),d={getDeliveryNodeList:function(){return o["a"].getDeliveryNodeList(i["a"].state.projectList.currentItem.id)},getTodoDeliveryDetail:function(e){return o["a"].getTodoDeliveryDetail(e)},uploadDeliveryConfirmInfo:function(e,t,n){return r["a"].uploadFiles(e,"deliveryProcess",t.room_id).then((function(e){console.log(e),e=l.a.uniq(e);var i={child_process:[{id:n,status:1,imgs:e}],reason:"",remark:""};return i=l.a.extend(i,t),o["a"].uploadProcessData(i)}))},uploadProcessData:function(e){return o["a"].uploadProcessData(e)},getProcessOperateLog:function(e){return o["a"].getProcessOperateLog(e)},getDeliveryConfirmInfo:function(e,t,n){return o["a"].getDeliveryConfirmInfo(e,t,n)},getRoomData:function(e,t){return a["a"].getBatchRoom(e,t)},assistSignIn:function(e){return o["a"].assistSignIn(e)},hasUploadData:function(e){return c["a"].existsBatchRoomUploadData(e)}};t["a"]=d},"620d":function(e,t,n){var i=n("ca12");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("10645e1c",i,!0,{})},"77a8":function(e,t,n){"use strict";n("6d57");function i(){var e={list:[]};return{model:e,init:function(){e.list=[{key:"status",value:"常用状态",name:"常用状态",displayName:"所有状态",list:[{name:"常用状态",value:"常用状态"},{name:"所有状态",value:""}]},{key:"position",value:"",name:"全部",displayName:"部位",list:[]},{key:"checkItem",value:"",name:"全部",displayName:"检查项",list:[]}]},update:function(t){e.list.forEach((function(e){t[e.key]&&(e.list=t[e.key])}))},getCondition:function(){var t={};return e.list.forEach((function(e){t[e.key]=e.value})),t},resetCheckItemValue:function(){e.list.forEach((function(e){"checkItem"===e.key&&(e.value="",e.name="全部")}))}}}t["a"]=i()},8366:function(e,t,n){(function(){var t={},n=!1;function i(){for(var e=navigator.userAgent,t=["Android","iPhone","Windows Phone","iPad","iPod"],n=!0,i=0;i<t.length;i++)if(e.indexOf(t[i])>0){n=!1;break}return n}function o(e){if(n?e.disabled:e.el.disabled)return!1;var t=e.tapObj;return e.time<300&&Math.abs(t.distanceX)<10&&Math.abs(t.distanceY)<10}function r(e,t){var n=e.touches[0],i=t.tapObj;i.pageX=n.pageX,i.pageY=n.pageY,i.clientX=n.clientX,i.clientY=n.clientY,t.time=+new Date}function a(e,t){var n=e.changedTouches[0],i=t.tapObj;t.time=+new Date-t.time,i.distanceX=i.pageX-n.pageX,i.distanceY=i.pageY-n.pageY,o(t)&&t.handler(e)}var c={isFn:!0,acceptStatement:!0,update:function(e){var t=this;if(t.tapObj={},"function"!==typeof e&&"a"!==t.el.tagName.toLocaleLowerCase())return console.error('The param of directive "v-tap" must be a function!');t.handler=function(n){if(n.tapObj=t.tapObj,t.el.href&&!t.modifiers.prevent)return window.location=t.el.href;var i=n.target.tagName.toLocaleLowerCase();if("input"===i||"textarea"===i)return n.target.focus();e.call(t,n)},i()?t.el.addEventListener("click",(function(e){if(t.el.href&&!t.modifiers.prevent)return window.location=t.el.href;t.handler.call(t,e)}),!1):(t.el.addEventListener("touchstart",(function(e){t.modifiers.stop&&e.stopPropagation(),t.modifiers.prevent&&e.preventDefault(),r(e,t)}),!1),t.el.addEventListener("touchend",(function(e){try{Object.defineProperty(e,"currentTarget",{value:t.el,writable:!0,enumerable:!0,configurable:!0})}catch(e){console.error(e.message),e.currentTarget=t.el}return e.preventDefault(),a(e,t)}),!1))}},s={bind:function(e,t){e.tapObj={},e.handler=function(n,i){var o=t.value;if(!o&&e.href&&!t.modifiers.prevent)return window.location=e.href;o.event=n;var r=o.event.target.tagName.toLocaleLowerCase();if(!i&&(o.tapObj=e.tapObj),"input"===r||"textarea"===r)return o.event.target.focus();o.methods.call(this,o)},i()?e.addEventListener("click",(function(n){t.modifiers.stop&&n.stopPropagation(),t.modifiers.prevent&&n.preventDefault(),e.handler(n,!0)}),!1):(e.addEventListener("touchstart",(function(n){t.modifiers.stop&&n.stopPropagation(),t.modifiers.prevent&&n.preventDefault(),r(n,e)}),!1),e.addEventListener("touchend",(function(t){try{Object.defineProperty(t,"currentTarget",{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(t){console.error(t.message),t.currentTarget=e}return t.preventDefault(),a(t,e)}),!1))},componentUpdated:function(e,t){e.tapObj={},e.handler=function(n,i){var o=t.value;if(!o&&e.href&&!t.modifiers.prevent)return window.location=e.href;o.event=n,!i&&(o.tapObj=e.tapObj),o.methods.call(this,o)}},unbind:function(e){e.handler=function(){}}};t.install=function(e){e.version.substr(0,1)>1&&(n=!0),e.directive("tap",n?s:c)},t.version="3.0.3",e.exports=t})()},"85cd":function(e,t,n){"use strict";var i=n("1834"),o=n("0938"),r="checkitem_remark_history",a={createCondition:function(e,t){if(_.isEmpty(e))return"";t=t?"crh.":"";var n=[];return _.each(e,(function(e,i){n.push(t+i+"="+e)})),n=n.join(" and "),n},insertHistory:function(e){e.id=o["a"].uuid(),e.used_time=e.used_time||1,e.last_used_time=e.last_used_time||o["a"].getNowDate();var t=[],n=[];return _.each(e,(function(e,i){t.push(i),n.push(e)})),i["a"].insert(r,t,n).then((function(){return e.id}))},updateHistory:function(e,t){return i["a"].update(r,e,t)},getOneHistory:function(e,t,n){var o="select * from "+r+" where item_id=? and desc_id=? and remark=?";return i["a"].queryOne(o,[e,t,n])},updateUserdTime:function(e,t){if(!t)return $q.error("次数不能为0");var n={last_used_time:o["a"].getNowDate(),used_time:t};return i["a"].update(r,n,{id:e})},getListByItemIdOrderDate:function(e,t){var n="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ?  order by crh.last_used_time desc limit "+t;return i["a"].query(n,[e])},getListByItemIdOrderUsedTime:function(e,t,n){var o=n.length?'and crh.id not in ("'+n.join('","')+'")':"",r="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ? "+o+" order by crh.used_time desc limit "+t;return i["a"].query(r,[e])},deleteItemById:function(e){var t="delete from checkitem_remark_history where id=?";return i["a"].query(t,[e])},searchByItems:function(e,t){var n="select crh.id,crh.remark as name,crh.item_id,ci.name as item_name,ci.full_name as item_full_name,crh.desc_id,cid.name as desc_name from checkitem_remark_history crh inner join check_item ci on ci.id = crh.item_id inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id in ("+t+') and (lower(crh.remark) like "%" || ? || "%" or upper(crh.remark) like "%" || ? || "%") order by crh.remark';return i["a"].query(n,[e,e])}},c=a,s={getList:function(e){if(!e)return $q.reject("itemId为空");var t=[];return c.getListByItemIdOrderDate(e,3).then((function(n){if(n){var i=[];return _.each(n,(function(e){i.push(e.id),t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),c.getListByItemIdOrderUsedTime(e,17,i).then((function(e){return e&&_.each(e,(function(e){t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),t}))}return $q.reject(t)}))},deleteItem:function(e){return c.deleteItemById(e)},upsertHistory:function(e,t,n){return c.getOneHistory(e,t,n).then((function(i){return i?c.updateUserdTime(i.id,i.used_time+1):c.insertHistory({item_id:e,desc_id:t,remark:n})}))},searchByItems:function(e,t){return c.searchByItems(e,t)}};t["a"]=s},"86d9":function(e,t,n){"use strict";n("6d57");var i=n("fd50"),o=n("e073"),r=n("3fa2");function a(){var e=null,t={};function n(){var n=r["a"].room;return n.batchRoomId===e?i["a"].resolve():o["a"].getDiagramData(n.batchRoomId,!0).then((function(e){console.log("data",e),t.key=n.batchRoomId,t.options=e}))}function a(e){return t.options=o["a"].refreshDiagramData(t.options,e),t.options}function c(){var e=[],n={};return t.options&&t.options.length&&t.options.forEach((function(t){(t.positionList||[]).forEach((function(t){n[t.id]=!n[t.id]&&e.push(t)}))})),e}return{model:t,room:r["a"].room,init:n,updateProblemPoints:a,getButtonsByFromType:r["a"].getButtonsByFromType,getAllPosition:c}}t["a"]=a()},"882e":function(e,t,n){"use strict";n("cc57"),n("6d57");var i=n("fd50"),o=n("07a4"),r=n("bad1"),a=n("5c1b"),c=n("dd0a"),s=n("b643"),l=n("964e"),d=n("0938"),m=n("3fa2"),u=n("a593"),f=n("a14a"),h=n.n(f),p=n("bbed");function b(){var e={problem:{}},t=null,n="";function f(){if(t=null,e.positionItems={},e.cacheIntersectItems=[],e.diagramUrl="",e.allPositions=[],e.problemReasons=[],e.fitmentStandard=m["a"].room.fitmentStandard||"毛坯",e.points=[],e.checkItems=[],e.checkItemTree=null,e.checkItemMap=null,e.problem={},e.problem.batchRoomId="",e.problem.positions=[],e.problem.selectedItem=null,e.problem.selectedDesc=null,e.problem.problemImages=[],e.problem.remark="",e.problem.isPassedWhenAdd=0,e.problem.emergencyDegree="一般",e.problem.contractor=null,e.problem.responsibleCompany=null,e.problem.topItemId="",o["a"].state.app.global.enableProblemReason)return s["a"].getReasonConfig().then((function(t){e.problemReasons=e.problemReasons.concat(t)}))}function b(e,t){var n=[];return e.forEach((function(e){for(var i=t.length,o=0;o<i;o++)if(e.item_id===t[o].item_id){n.push(e);break}})),n}return{model:e,setRoomPosition:function(t){var i=u["default"].prototype.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"户型图加载中"});f(),e.roomTitle=t.roomTitle,e.diagramUrl=t.diagramUrl,e.allPositions=t.position,e.problem.batchUnitId=t.unitId,e.problem.batchRoomId=n=t.roomId,this.getPositionItem().then((function(){setTimeout((function(){i.clear(),console.log("关闭---------------")}),200)})).catch((function(e){return console.log(e)}))},getPositionItem:function(){return a["a"].getPositionItemByRoom(n,m["a"].room.projectId,m["a"].room.isVirtual).then((function(t){t.forEach((function(t){e.positionItems[t.position_id]||(e.positionItems[t.position_id]=[]),d["a"].getObjectFromArrayByProperty(e.positionItems[t.position_id],"item_id",t.item_id,!1)||e.positionItems[t.position_id].push({item_id:t.item_id,item_name:t.item_name,parent_item_id:t.parent_item_id,level:t.level})}))}))},checkPositionItem:function(t){if(!t)return null;e.problem.selectedItem=null;var n=e.positionItems[t];if(!n||!n.length)return!1;if(!e.cacheIntersectItems.length)return e.cacheIntersectItems.push(n),e.checkItems=n,e.checkItemTree=null,!0;var i=b(n,e.checkItems);return!(!i.length||!this.hasEndItem(i,t))&&(e.cacheIntersectItems.push(i),e.checkItems=i,e.checkItemTree=null,!0)},hasEndItem:function(t,n){for(var i=0;i<t.length;i++){for(var o=e.positionItems&&e.positionItems[n],r=o&&o.length,a=!0,c=0;c<r;c++)if(o[c].parent_item_id===t[i].item_id){a=!1;break}if(!0===a)return!0}return!1},getIntersectCheckItem:function(t,n,i){var o=[];if(t)for(var r=0;r<e.checkItems.length;r++)e.checkItems[r].parent_item_id===t&&o.push(e.checkItems[r]);else for(var a=0;a<e.checkItems.length;a++)1===e.checkItems[a].level&&o.push(e.checkItems[a]);return o.slice(n*i,(n+1)*i)},cancelPoint:function(){var t=e.cacheIntersectItems.length;t&&(e.cacheIntersectItems.pop(),e.checkItems=e.cacheIntersectItems[t-2]||[],e.problem.selectedItem=null,e.checkItemTree=null)},createRoomPosition:function(){var t={},n=[],i=e.allPositions,o=[];return e.points.forEach((function(e){var r=e.positionId,a={x:e.coordinate.x,y:e.coordinate.y,diagramId:e.diagramId},c=i.length,s=0;if(t[r])return t[r].points.push(a);for(;s<c;s++)if(r===i[s].id)return t[r]={positionId:r,positionName:"",points:[a]},o.push(r),n.push(t[r])})),e.problem.positions=n,this.setPositionName(o)},setPositionName:function(t){return t&&t.length?r["a"].getPositionByIds("'"+t.join("','")+"'").then((function(t){t&&t.length&&e.problem.positions.forEach((function(e){for(var n=t.length,i=0;i<n;i++)if(t[i].id===e.positionId){e.positionName=t[i].name;break}}))})):i["a"].resolve()},createCheckItemTree:function(){var t,n=[],i={};e.checkItems.forEach((function(e){var t,o=e.item_id,r=e.level>1?e.parent_item_id:"",a=h.a.assign({},e);return o in i?a=h.a.assign(i[o],a):i[o]=a,r?r in i?(t=i[r],void(t.children?t.children.push(a):t.children=[a])):(i[r]={item_id:r,children:[a]},i[r]):n.push(a)})),function e(n,i){n.forEach((function(t){t.item_full_name=i?i+"-"+t.item_name:t.item_name,t.children&&e(t.children,t.item_full_name)})),null!==t&&(t=1===n.length?n[0]:null)}(n),e.checkItemTree=n,e.checkItemMap=i,e.selectedItem=t},update:function(t){h.a.assign(e,t)},save:function(){t={points:e.points.slice(0),positions:e.problem.positions.slice(0),checkItems:e.checkItems.slice(0),cacheIntersectItems:e.cacheIntersectItems.slice(0)}},restore:function(){t&&(e.points=t.points,e.problem.positions=t.positions,e.checkItems=t.checkItems,e.cacheIntersectItems=t.cacheIntersectItems,t=null)},clearStore:function(){t=null},clear:function(){return f()},updateRemark:function(t){e.problem.remark=t},updateCheckItem:function(t){e.problem.selectedItem=t,e.problem.selectedDesc=null,e.problem.contractor=null,e.problem.responsibleCompany=null,e.problem.topItemId=function t(n){return n.parent_item_id&&n.level>1?t(e.checkItemMap[n.parent_item_id]):n.item_id}(t)},updateDesc:function(t){u["default"].prototype.$set(e.problem,"selectedDesc",t),e.problem.contractor=null,c["a"].getContractor(n,e.problem.selectedItem.item_id,e.problem.selectedDesc.map((function(e){return e.id})).join(";")).then((function(t){"length"in t||(t=[t]),e.problem.contractor=t,e.problem.responsibleCompany=t,u["default"].prototype.$eventBus.$emit("app.batchAddProblem:updateContractor")}))},submit:function(){var t=[],o=e.problem.problemImages.map((function(e){return{img_localpath:e.img_local_path}})),r=e.problem.selectedDesc.map((function(e){return e.id})).join(";"),a=e.problem.contractor.map((function(e){return e.contractor_id})).join(";"),c=e.problem.responsibleCompany.map((function(e){return e.contractor_id})).join(";"),s=0,d=[];e.problemReasons.forEach((function(e){e.selected&&d.push(e.id)}));for(var f=0;f<e.problem.positions.length;f++)for(var h=e.problem.positions[f],b=0;b<h.points.length;b++){var g=l["a"].batchAddProblem({problem_images:o,batch_room_id:n,position_id:h.positionId,item_id:e.problem.selectedItem.item_id,top_item_id:e.problem.topItemId,desc_id:r,contractor_id:a,responsible_company_id:c,roomtype_diagram_id:h.points[b].diagramId,coordinate:[{x:h.points[b].x,y:h.points[b].y}],emergency_degree:e.problem.emergencyDegree,remark:e.problem.remark,is_passed_when_add:e.problem.isPassedWhenAdd?1:0},!1,"",d);t.push(g),s++}return i["a"].all(t).then((function(){return p["a"].updateCheckItemUseTimes(e.problem.selectedItem.item_id,s)})).then((function(){return p["a"].updateItemDescUseTimes(r,s)})).then((function(){m["a"].room.hasProblem=!0,u["default"].prototype.$eventBus.$emit("app.roomdetail:statusChange")}))}}}t["a"]=b()},"8fee":function(e,t,n){"use strict";var i=n("760e"),o=n("a14a"),r=n.n(o);t["a"]={getCheckItemDescList:function(e,t,n){return i["a"].getCheckItemDescList(e,t,n).then((function(e){return e}))},getRoomCheckListDescList:function(e,t){return i["a"].getRoomCheckListDescList(e,t).then((function(e){if(!r.a.isEmpty(e))for(var t=0;t<e.length&&t<3;t++)e[t].isImportant=!0;return e}))},searchDesc:function(e,t){return i["a"].searchDesc(e,t)}}},"985c":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .filter[data-v-edcfc9ec] {\n  background: #fff;\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n}\n.zhkf .clearfix[data-v-edcfc9ec]:before,\n.zhkf .clearfix[data-v-edcfc9ec]:after {\n  content: ' ';\n  display: table;\n}\n.zhkf .clearfix[data-v-edcfc9ec]:after {\n  clear: both;\n}\n.zhkf .filter-header[data-v-edcfc9ec] {\n  height: 40px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n  -ms-flex-wrap: nowrap;\n      flex-wrap: nowrap;\n  -webkit-box-flex: 0;\n      -ms-flex: 0 0 auto;\n          flex: 0 0 auto;\n}\n.zhkf .filter-header .filter-item[data-v-edcfc9ec] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1 1 auto;\n            flex: 1 1 auto;\n    text-align: center;\n    padding: 10px 0;\n    width: 20%;\n    line-height: 22px;\n    color: #606060;\n}\n.zhkf .filter-header .filter-item .filter-desc[data-v-edcfc9ec] {\n      height: 100%;\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n      -webkit-box-pack: center;\n          -ms-flex-pack: center;\n              justify-content: center;\n      padding-left: 5px;\n      padding-right: 5px;\n      font-size: 14px;\n}\n.zhkf .filter-header .filter-item .filter-desc .filter-title[data-v-edcfc9ec] {\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n}\n.zhkf .filter-header .filter-item .filter-desc .icon-hebingxingzhuang1[data-v-edcfc9ec],\n      .zhkf .filter-header .filter-item .filter-desc .icon-hebingxingzhuang[data-v-edcfc9ec] {\n        -ms-flex-negative: 0;\n            flex-shrink: 0;\n        font-size: 10px;\n        color: #d2d2d7;\n        vertical-align: middle;\n}\n.zhkf .filter-header .filter-item .filter-desc img[data-v-edcfc9ec] {\n        width: 10px;\n        height: 10px;\n}\n.zhkf .filter-header .filter-item:first-child .filter-desc[data-v-edcfc9ec] {\n      border-left: 0;\n}\n.zhkf .filter-header .filter-item__active[data-v-edcfc9ec] {\n    color: #0085ff;\n}\n.zhkf .filter-header .filter-item__active .filter-desc .icon-hebingxingzhuang1[data-v-edcfc9ec],\n    .zhkf .filter-header .filter-item__active .filter-desc .icon-hebingxingzhuang[data-v-edcfc9ec] {\n      color: #0085ff;\n}\n.zhkf .filter-content[data-v-edcfc9ec] {\n  width: 100%;\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.2);\n  z-index: 9999;\n}\n.zhkf .filter-content .filter-list[data-v-edcfc9ec] {\n    background: #fff;\n    max-height: 320px;\n    overflow: scroll;\n}\n.zhkf .filter-content .filter-list .filter-cell[data-v-edcfc9ec] {\n      height: 40px;\n      line-height: 40px;\n      padding: 0 15px;\n      font-size: 14px;\n      color: #606060;\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n}\n.zhkf .filter-content .filter-list .filter-cell .pull-left[data-v-edcfc9ec] {\n        -webkit-box-flex: 1;\n            -ms-flex: 1;\n                flex: 1;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n}\n.zhkf .filter-content .filter-list .filter-cell .pull-right[data-v-edcfc9ec] {\n        -ms-flex-negative: 0;\n            flex-shrink: 0;\n}\n.zhkf .filter-content .filter-list .filter-cell[data-v-edcfc9ec]:last-child {\n        border-bottom: 0;\n}\n.zhkf .filter-content .filter-list .filter-cell__active[data-v-edcfc9ec] {\n      color: #0085ff;\n}\n",""])},"98a4":function(e,t,n){"use strict";n("e697");var i=n("85cd"),o=n("fd50"),r=n("a593"),a={model:{},init:function(){a.model.historyList={},a.model.currItemId="",a.model.currList=[]},loadList:function(e,t){return e?(_.isEmpty(a.model)&&a.init(),t=t||!1,a.model.currItemId=e,_.isEmpty(a.model.historyList[e])||t?(console.log("=== itemId ===",e),i["a"].getList(e).then((function(t){console.log(t),a.model.historyList[e]=t,a.model.currList=t})).catch((function(){a.model.historyList[e]=[],a.model.currList=[]}))):(a.model.currList=a.model.historyList[e],o["a"].resolve())):o["a"].reject()},upsertHistory:function(e,t,n){return i["a"].upsertHistory(e,t,n).then((function(){a.loadList(e,!0)}))},delHistory:function(e){return i["a"].deleteItem(e).then((function(){var t=_.find(a.model.currList,{id:e});if(t){var n=a.model.currList.indexOf(t);n>-1&&a.model.currList.splice(n,1)}})).catch((function(e){console.error(e),r["default"].prototype.$toast("删除历史失败！")}))}};t["a"]=a},"98c5":function(e,t,n){"use strict";n("6d57");var i=n("0523"),o=n("3fa2"),r=n("273c");function a(){var e={itemId:"eec99576-92a9-11e7-b3fa-005056a65fd7",itemName:"设计变更",descId:"f454b483-92a9-11e7-b3fa-005056a65fd7",descName:"与变更结果不一致",emergency_degree:"紧急"};return{model:e,init:function(){e.designChangeList=[],e.currDesignChange=null,o["a"].room.batchRoomId&&i["a"].getRoomDesignChange(o["a"].room.batchRoomId).then((function(t){t&&t.forEach((function(e){e.show_remark=e.remark||"无"})),e.designChangeList=t}))},addProblem:function(t){e.currDesignChange=t,e.currDesignChange&&(e.remark=t.content+"\r\n"+t.remark,o["a"].room.hasDiagramImage?r["a"].goMarkPosition({problemType:"roomDesignChange"}):r["a"].goAddProblem({problemType:"roomDesignChange"}))}}}t["a"]=a()},"9a9a":function(e,t,n){"use strict";n("cc57");var i={props:{filterList:{type:Array,default:function(){return[{key:"status",displayName:"问题状态",value:"",name:"",list:[{name:"问题状态1问题状态1问题状态1问题状态1",count:2019,value:"1"},{name:"问题状态2",count:2019,value:"2"},{name:"问题状态3",count:2019,value:"3"}]},{key:"floor",displayName:"楼层",value:"",name:"",list:[{name:"楼层1",count:2019,value:"1"},{name:"楼层2",count:2019,value:"2"},{name:"楼层3",count:2019,value:"3"}]},{key:"item",displayName:"检查项",value:"",name:"",list:[{name:"检查项1",count:2019,value:"1"},{name:"检查项2",count:2019,value:"2"},{name:"检查项3",count:2019,value:"3"}]},{key:"user",displayName:"登记人",value:"",name:"",list:[{name:"登记人1登记人1登记人1登记人1",count:2019,value:"1"},{name:"登记人2",count:2019,value:"2"},{name:"登记人3",count:2019,value:"3"}]}]}}},data:function(){return{top:0,showFilterContent:!1,currFilter:{},currIndex:""}},mounted:function(){this.initPosition()},updated:function(){this.initPosition()},methods:{initPosition:function(){var e=this.$refs.filterHeader;this.top=e.offsetTop+e.offsetHeight},changeFilter:function(e){if(e===this.currIndex)return this.maskClickHandler(),this.currIndex="",!1;this.currFilter=this.filterList[e],this.currIndex=e,this.showFilterContent=!0,this.$emit("changeFilter",e)},maskClickHandler:function(){this.showFilterContent=!1,this.currFilter={},this.currIndex=""},chooseItem:function(e,t){this.currFilter.name=this.currFilter.list[e].name,this.currFilter.value=this.currFilter.list[e].value,this.currFilter={},this.$emit("chooseItem",e,t)}}},o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"filter"},[n("ul",{ref:"filterHeader",staticClass:"filter-header van-hairline--bottom"},e._l(e.filterList,(function(t,i){return n("li",{key:i,staticClass:"filter-item",class:{"filter-item__active":e.currFilter.key===t.key||t.value},on:{click:function(t){return e.changeFilter(i)}}},[n("div",{staticClass:"filter-desc van-hairline--left"},[n("span",{staticClass:"filter-title"},[e._v(e._s(t.value?t.name:t.displayName))]),e._v(" "),n("i",{staticClass:"iconfont",class:e.currIndex===i&&e.showFilterContent?"icon-hebingxingzhuang":"icon-hebingxingzhuang1"})])])})),0),e._v(" "),e.showFilterContent?n("div",{staticClass:"filter-content",style:{top:e.top+"px"},on:{click:e.maskClickHandler}},[n("ul",{staticClass:"filter-list"},e._l(e.currFilter.list,(function(t,i){return n("li",{key:i,staticClass:"filter-cell van-hairline--bottom",class:{"filter-cell__active":e.currFilter.value===t.value},on:{click:function(t){return e.chooseItem(i,e.currFilter.key)}}},[n("span",{staticClass:"pull-left"},[e._v(e._s(t.name))]),e._v(" "),n("span",{staticClass:"pull-right"},[e._v(e._s(t.count))])])})),0)]):e._e()])},r=[],a=n("d082");function c(e){n("e4b8")}var s=!1,l=c,d="data-v-edcfc9ec",m=null,u=Object(a["a"])(i,o,r,s,l,d,m);t["a"]=u.exports},"9e22":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .problem-list[data-v-4c18cc1f] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n}\n.zhkf .btns[data-v-4c18cc1f] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: justify;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 10px 16px;\n  background: #fff;\n}\n.zhkf .btns .btn[data-v-4c18cc1f] {\n    text-align: center;\n    font-size: 16px;\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    padding: 12px 0;\n    border-radius: 23px;\n}\n.zhkf .btns .btn-batch[data-v-4c18cc1f] {\n    background: #fff;\n    border: 1px solid #0085ff;\n    color: #0085ff;\n    margin-right: 20px;\n}\n.zhkf .btns .btn-single[data-v-4c18cc1f] {\n    background: -webkit-gradient(linear, left top, right top, from(#1cb0fd), to(#0099ff));\n    background: linear-gradient(90deg, #1cb0fd 0%, #0099ff 100%);\n    -webkit-box-shadow: 0px 2px 4px 0px rgba(0, 153, 255, 0.27);\n            box-shadow: 0px 2px 4px 0px rgba(0, 153, 255, 0.27);\n    color: #fff;\n}\n.zhkf .btns .btn-disabled[data-v-4c18cc1f] {\n    background: -webkit-gradient(linear, right top, left top, from(#0085ff), to(#02b8ff));\n    background: linear-gradient(270deg, #0085ff 0%, #02b8ff 100%);\n    opacity: 0.5;\n    color: white;\n}\n.zhkf .list-box[data-v-4c18cc1f] {\n  position: relative;\n  display: block;\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n}\n.zhkf .list-box .list[data-v-4c18cc1f] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 100%;\n    padding-bottom: 45px;\n    overflow: hidden;\n    overflow-y: auto;\n}\n.zhkf .item[data-v-4c18cc1f] {\n  padding: 12px 0 15px 40px;\n  position: relative;\n  background: #fff;\n}\n.zhkf .item .item-top[data-v-4c18cc1f] {\n    font-size: 12px;\n    color: #a0a0a0;\n    padding-bottom: 10px;\n    border-bottom: 1px dashed #ebebeb;\n}\n.zhkf .item .item-bottom p[data-v-4c18cc1f] {\n    font-size: 15px;\n    margin: 14px 0 10px;\n}\n.zhkf .item .item-bottom span[data-v-4c18cc1f] {\n    font-size: 13px;\n    color: #606060;\n}\n.zhkf .item .circle[data-v-4c18cc1f] {\n    position: absolute;\n    left: 20px;\n    top: 50%;\n    -webkit-transform: translate(-50%, -50%);\n            transform: translate(-50%, -50%);\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n}\n.zhkf .item .tab-icon1[data-v-4c18cc1f] {\n    border: 2px solid #b3b3b3;\n    background-color: #fff;\n}\n.zhkf .item .tab-icon2[data-v-4c18cc1f] {\n    border: 2px solid #ff4545;\n    background-color: #ff4545;\n}\n.zhkf .item .tab-icon3[data-v-4c18cc1f] {\n    border: 2px solid #0099ff;\n    background-color: #0099ff;\n}\n.zhkf .item .tab-icon4[data-v-4c18cc1f] {\n    border: 2px solid #0bc666;\n    background-color: #0bc666;\n}\n.zhkf .item .tab-icon5[data-v-4c18cc1f] {\n    border: 2px solid #bb33ee;\n    background-color: #bb33ee;\n}\n.zhkf .item .tab-icon6[data-v-4c18cc1f] {\n    border: 2px solid #7d7d7d;\n    background-color: #7d7d7d;\n}\n.zhkf .item .tab-icon7[data-v-4c18cc1f] {\n    border: 2px solid #333333;\n    background-color: #333333;\n}\n.zhkf .footer-btns[data-v-4c18cc1f] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  text-align: center;\n  font-size: 16px;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 7px 11px;\n  background: #fff;\n}\n.zhkf .footer-btns .btn[data-v-4c18cc1f] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    border-radius: 23px;\n    text-align: center;\n    padding: 12px 0;\n}\n.zhkf .footer-btns .btn + .btn[data-v-4c18cc1f] {\n    margin-left: 1px;\n}\n.zhkf .footer-btns .btn-gray[data-v-4c18cc1f] {\n    width: 24%;\n    color: #bbb;\n    background: #fff;\n    -webkit-box-flex: initial;\n        -ms-flex: initial;\n            flex: initial;\n}\n.zhkf .footer-btns .btn-white[data-v-4c18cc1f] {\n    border: 1px solid #0085ff;\n    color: #0085ff;\n}\n.zhkf .footer-btns .disable-recheck[data-v-4c18cc1f]:last-child {\n    background-color: #1cb0fd;\n    opacity: 0.5;\n    color: white;\n}\n.zhkf .footer-btns .btn-theme[data-v-4c18cc1f] {\n    background: #0085ff;\n    color: #fff;\n}\n.zhkf .footer-btns .btn[data-v-4c18cc1f]:not(:first-child) {\n    margin-left: 10px;\n}\n.zhkf .footer-btns .btn-disabled[data-v-4c18cc1f] {\n    background: -webkit-gradient(linear, right top, left top, from(#0085ff), to(#02b8ff));\n    background: linear-gradient(270deg, #0085ff 0%, #02b8ff 100%);\n    opacity: 0.5;\n    color: white;\n}\n",""])},a948:function(e,t,n){var i=n("9e22");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("24e93e05",i,!0,{})},a9ec:function(e,t,n){"use strict";n("6d57");var i=n("a593"),o=n("3fa2"),r=n("d485"),a=n("9af1"),c=n("77a8");function s(){var e={},t={problemList:[],buttons:[]},n={},s="tab-icon1",l={"待派单":"tab-icon5","待整改":"tab-icon2","已整改":"tab-icon3","已通过":"tab-icon4","已作废":"tab-icon6","非正常关闭":"tab-icon7"},d=o["a"].room;return n.iniStatusStyle=function(){t.problemList.forEach((function(e){l[e.status]?e.status_style=l[e.status]:e.status_style=s}))},n.initFilter=function(){return r["a"].getPositionList(d.batchRoomId).then((function(e){t.filterList.position.list=e}))},n.getCondition=function(){var e={};_.each(t.filterList,(function(t,n){e[n]=t.value}))},n.getProblemPoints=function(){i["default"].prototype.$eventBus.$emit("app.roomdetail:updateProblemPoints",t.problemList)},e={model:t,init:function(){return r["a"].getProblemList(d.batchRoomId,0,1,!0).then((function(e){t.problemList=e,n.iniStatusStyle()})).then((function(){return console.log("fromType------",d.fromType),a["a"].getDefaultFilterList(t.problemList,d.batchRoomId,d.fromType).then((function(e){c["a"].update(e),console.log("filters---------",e),n.getProblemPoints()}))})).then((function(){if(!_.isEmpty(c["a"].model.list))return e.updateProblemList()}))},updateProblemList:function(e){var i=c["a"].getCondition();a["a"].hideProblemByFilter(t.problemList,c["a"].model.list,i,e),n.getProblemPoints()}},e}t["a"]=s()},afd3:function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .house-type[data-v-6d2fd172] {\n  position: relative;\n  font-size: 15px;\n  overflow: hidden;\n}\n.zhkf .house-type .house-type-img[data-v-6d2fd172] {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    right: 0px;\n    bottom: 0px;\n    height: 100%;\n    width: 100%;\n}\n.zhkf .house-type .house-type-title[data-v-6d2fd172] {\n    position: absolute;\n    top: 10px;\n    left: 50%;\n    display: inline-block;\n    height: 20px;\n    padding: 0 15px;\n    border-radius: 3px;\n    color: #fff;\n    line-height: 20px;\n    background: rgba(0, 0, 0, 0.7);\n    -webkit-transform: translate(-50%, 0);\n            transform: translate(-50%, 0);\n    white-space: nowrap;\n    font-size: 12px;\n}\n.zhkf .house-type .house-type-number[data-v-6d2fd172] {\n    position: absolute;\n    top: 10px;\n    right: 20px;\n    display: inline-block;\n    height: 20px;\n    padding: 0 10px;\n    border-radius: 12px;\n    color: white;\n    line-height: 20px;\n    font-size: 12px;\n    background: rgba(0, 0, 0, 0.7);\n}\n",""])},b643:function(e,t,n){"use strict";var i=n("7ee1");t["a"]={getReasonConfig:function(){return i["a"].getList()},getProblemReason:function(e){return i["a"].getProblemReason(e)}}},bad1:function(e,t,n){"use strict";var i=n("97ba");t["a"]={getPositionList:function(e){return console.log("batchRoomId",e),i["a"].getPositionList(e).then((function(e){return e}))},getPositionByIds:function(e){return i["a"].getPositionByIds(e)},getPositionNameById:function(e){return i["a"].getPositionNameById(e)}}},c2ad:function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .houseImg[data-v-6b818beb] {\n  position: relative;\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .houseImg .house-type[data-v-6b818beb] {\n    height: 100%;\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n}\n.zhkf .houseImg .footer .tip[data-v-6b818beb] {\n    text-align: center;\n    font-size: 12px;\n    color: #a0a0a0;\n    margin-bottom: 9px;\n}\n.zhkf .houseImg .footer .btns[data-v-6b818beb] {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    font-size: 16px;\n    background: #fff;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    padding: 7px 11px;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n}\n.zhkf .houseImg .footer .btns .btn[data-v-6b818beb] {\n      -webkit-box-flex: 1;\n          -ms-flex: 1;\n              flex: 1;\n      text-align: center;\n      padding: 12px 0;\n      border-radius: 23px;\n}\n.zhkf .houseImg .footer .btns .btn[data-v-6b818beb]:not(:first-child) {\n        margin-left: 10px;\n}\n.zhkf .houseImg .footer .btns .btn-gray[data-v-6b818beb] {\n      width: 24%;\n      color: #bbb;\n      background: #fff;\n      -webkit-box-flex: initial;\n          -ms-flex: initial;\n              flex: initial;\n}\n.zhkf .houseImg .footer .btns .btn-white[data-v-6b818beb] {\n      border: 1px solid #0085ff;\n      color: #0085ff;\n}\n.zhkf .houseImg .footer .btns .disable-recheck[data-v-6b818beb]:last-child {\n      background-color: #1cb0fd;\n      opacity: 0.5;\n      color: white;\n}\n.zhkf .houseImg .footer .btns .btn-theme[data-v-6b818beb] {\n      background: #0085ff;\n      color: #fff;\n}\n.zhkf .houseImg .footer .btns .btn-disabled[data-v-6b818beb] {\n      background: -webkit-gradient(linear, right top, left top, from(#0085ff), to(#02b8ff));\n      background: linear-gradient(270deg, #0085ff 0%, #02b8ff 100%);\n      opacity: 0.5;\n      color: white;\n}\n",""])},c433:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAIAAAAiOjnJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUYwNzIzN0Q5MURCMTFFN0JBMjFBQTFCOEY2NzRBQzAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUYwNzIzN0U5MURCMTFFN0JBMjFBQTFCOEY2NzRBQzAiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5RjA3MjM3QjkxREIxMUU3QkEyMUFBMUI4RjY3NEFDMCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjA3MjM3QzkxREIxMUU3QkEyMUFBMUI4RjY3NEFDMCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqSB41EAAAdmSURBVHja7JxXT+tKFEZzThCI3ntHFMH//xs8gZAQiJbQIUAgRCCQzqfM1VzLdpLBpDj2Wg/IBIc4nuU9e/aM/adQKGQAGs1fTgEgFiAWIBYAYgFiAWIBIBYgFiAWAGIBYgFiASAWIBYgFgBiAWIBYgEgFiAWIBYAYgFiAWIBIBYgFiAWAGIBYgFiASAWIBYgFgBiAWIBYgEgFiAWIBYAYgFiAWIBIBYgFiAWAGIBYgFiASAWIBYgFgBiAWIBYgEgFiAWIBYAYgFiAWIBIBYgFiAWAGIBYgFiASAWIBYgFgBiAWIBYgEgFiAWIBYAYgFiAWIBGLo4BZ1OoVB4fHzURm9v78LCAmKBn93dXbOxtbU1MDDg+K7Pz89isUjEigXlcjmfz7vsubGx4Wv1COzs7Cic0BW2gqOjo2Z/RI2u4fv7u5VXedqsaqdYMYzetRkaGgo9ft/rlq+vr/f3d5L3lCItbGcXmu4E+0TfDqFvF29vb4eHh4jVapSfuudDFxcXZntpacm9W8lmswwIUieW+6jH96445CuKRmajp6en7s4u+ySPDiuQxiQLNnUj0dfXh1hJECsOaET59PRktkdGRmrsluaz1AFi2X4nJpyfnxtplMONjY3VjWrd3d3kWLHGpd9pgVU2XGkkYSLT/f29b7fX11dbjxgcHESsOPLx8fHfsXZ1td2qh4cHW6cw4UpxSy/agwxeDDWiWjVyuZz7l7UfXSqV6padqxVH0ijW5+dn8zJ3tcrNzY1LyePs7MwWPKXL2tqa155QsSSfdzd3olVWWzyd0PFi6UJsXsSSEJeXl3WTPG+pUxptbm56i2RK4W2qLvvNcQ4PD6dwJqdjxFK4sm0WrfT1e/S5o6OjJrXSxvLysq/0OlahgZ/4ozowYv1gTYHl6+srWubhmFso/CwuLgZf983GSCb5PTU1pTjUghMlq9p1FXWkWL9MApoxpytTXZpQIUpqRls5U206MtlQIIXOj1iK8O5zzybCHR8fm+3p6Wn9akb71fqvljE/P+8yLLC1CcRqLupQfpQ6vLy82O3x8XH7q2P/1TxmZmbq7qOxZJrFinVX+Pz8bDZ6enrSPHQnYjU407eTJ2mbFdF3jzxD2l0BsWr1g7aCpXF+4mUql8t222aW0fI/l546vV3h1dWV2VCqnoZ+MGHLbGIase7v7+3sm8aDaej+7JRopvoNGjUolUqxUrMrnteunb9T2t7Y2RIfxWIxQtnT5d4175yBC94Z7ggFVR1SrG58iqNYdiWdaG+9qoaOzcux2r46KJliFQoFOxhUj/DLubn9/X2NKGdnZ30DpWw2G6G7ifCWjPNqn4QtDIyXWLpqT09PbdsvLy//5r9pxP5R4eHhwfc0BDV2hO6meVN+3lJwMkYqf2NllXdNwdLSUgvqMd4WbWzcPTk5cd/floIz7VsdlMyIZayyqZVGgo3N2UNbS1YdHx9rfDAyMuJ7yoOi3fX1tUJmqNwawemvSre3t7eDIw8pZfq1fD7v8lwhOwdqMvdk3Gcbi4hllmhaq0ZHRxvynKe6xeu7u7tMZbbYN1DX6EHHIzlkT6gHBwcHUkFiBZc1ZyuY7dvbW5cCuvdejMTUVtovlk6r1ypdsr9MrYKE3t6jJrf58vj4uPdP9lfZEzRD3tjStsQKVo+8S0wVEWuXlxT8rJ16V2sWEiZcLNNr2OcyZMKWk4diV8G7V4aCf7XRSGM9X0epX+0AMDRoTU5OmvubQ+/90vGvrq7a76j4V+Mg1V1a8+RrYp430TaxlN/s7e3ZyoKYmJhQylLjzNrhUt3WMoHQ/vPgTe76dBuuZmdng2+3L2q30KA1Nzdnti8vL71Fc4MCjzp0s63DqDZE8NZW9D/layYptCF5NyvffTVGl6lTBRKdfXN9q5NSk/T391cLad4OKNi/5HK5auHKG7TMQSpoBQsNGltcXV2ZeSeT5gc7RL3dHIY+zhx8tdqKOQNJejxOSyOWrmxFGmW+Xqt0NtfX110m5LWnd+mmWUEfitcqBUJfZUg5jZ2IDA1XvkxL/zAYk4QNWrI8uIP3aPVxvi7VV1uRxEkKV60WK7ioUid0Z2fHPWPV2Vf64vj8FtO0vljiTZarhSsbk+wHqc+qsYPcrXa0JlfTT9/4wFvF0HFGu6+VrvD/llC7mglm0+oRLlNzE5+u+LqT+aHS6F3KfozfdYefGvw/Pz8rqlXzb2VlpfbCuoWFBR1qsCanr7+1tWWCljaS94y4P6HXYlM5OjpSS+iMt/Fsym+1d9vH9uUKDSkFqx1NdzxQIY1iQRrgvkJALEAsQCwAxALEAsQCQCxALEAsAMQCxALEAkAsQCxALADEAsQCxAJALEAsQCwAxALEAsQCQCxALEAsAMQCxALEAkAsQCxALADEAsQCxAJALEAsQCwAxALEAsQCQCxALEAsAMQCxALEAkAsQCxALADEAsQCxAJALEAsQCwAxALEAsQCQCxALEAsAMQCxALEAkAsQCxALADEAsQCxAJALEAsQCwAxALEgk7knwADAPuJOctJpEvxAAAAAElFTkSuQmCC"},ca12:function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .design-change[data-v-c1f063be] {\n  overflow: scroll;\n}\n.zhkf .item[data-v-c1f063be] {\n  margin-top: 10px;\n  background: #fff;\n}\n.zhkf .item .item-header[data-v-c1f063be] {\n    padding: 10px;\n    line-height: 24px;\n}\n.zhkf .item .item-header .header-position[data-v-c1f063be] {\n      font-size: 15px;\n}\n.zhkf .item .item-header .header-content[data-v-c1f063be],\n    .zhkf .item .item-header .header-introduction[data-v-c1f063be] {\n      font-size: 13px;\n      color: #606060;\n}\n.zhkf .item .item-btn[data-v-c1f063be] {\n    height: 45px;\n    line-height: 45px;\n    text-align: center;\n    color: #0085ff;\n    font-size: 16px;\n}\n.zhkf .item .item-btn.disabled[data-v-c1f063be] {\n      color: #999999;\n}\n",""])},db5f:function(e,t,n){"use strict";n("5ab2"),n("e44b"),n("e10e"),n("f0e6");var i=n("28f8"),o=(n("5f54"),n("6d57"),n("fd50")),r=n("c2c1"),a=n("0938"),c=n("8ae6"),s=n("a14a"),l=n.n(s),d=n("07a4"),m=n("a593"),u=n("98a4"),f=n("3fa2"),h=n("a9ec"),p=n("db99"),b=n("bad1"),g=n("964e"),v=n("0970"),_=n("5c1b"),y=n("dd0a"),k=n("4438"),I=n("b643"),x=n("bbed");function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var L=f["a"].room,C="",T="";function D(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];n.length>0?console.log("[model]/problem-model.js：",e,n):console.log("[model]/problem-model.js：",e)}function O(){if(!B.model.problem.contractorIds&&B.model.problem.checkItemId)return y["a"].getContractor(L.batchRoomId||B.model.problem.batchRoomId,B.model.problem.checkItemId,B.model.problem.descIds).then((function(e){var t=[],n=[];B.model.contractorDisabled=!1,l.a.isEmpty(e)||(l.a.each(e,(function(e){t.push(e.contractor_id),n.push(e.contractor_name)})),t.length>1&&(B.model.contractorDisabled=!0),t=t.join(";"),n=n.join("；"),B.model.problem.contractors=n,B.model.problem.contractorIds=t,B.model.problem.responsibilityUnitIds=t,B.model.problem.responsibilityUnits=n)}))}function j(){var e=B.model.problem.id?"editProblem":"addProblem";!B.model.selectes&&(B.model.selectes={position:{},checkItem:{},desc:{},contractor:{},responsibleCompany:{}}),B.model.positionDisabled||(B.model.selectes.position={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-position-select"),query:{fromPage:e}}),B.model.problem.positionId?(B.model.selectes.checkItem={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-checkitem-select/").concat((new Date).getTime()),query:{type:L.fromType,fitment_standard:L.fitmentStandard,fromPage:e,isSpecial:+L.isSpecial}},B.model.problem.checkItemId?(L.isSpecial||_["a"].getHigherLevelTreeListByCheckItemId(B.model.problem.checkItemId,B.model.problem.positionId,{fitment_standard:L.fitmentStandard}).then((function(t){B.model.selectes.checkItem.query=l.a.extend(B.model.selectes.checkItem.query,{history:JSON.stringify(t),level:0,fromPage:e})})),B.model.selectes.desc={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-desc-select"),query:{fromPage:e,fitment_standard:L.fitmentStandard,level:0}},B.model.selectes.contractor={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-contractor-select"),query:{fromPage:e}},B.model.selectes.responsibleCompany={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-responsible-select"),query:{fromPage:e}}):B.model.selectes.checkItem.query=l.a.extend(B.model.selectes.checkItem.query,{batchId:L.batchId})):B.model.selectes.checkItem={}}function R(e){var t=e.coordinate?[JSON.parse(e.coordinate)]:[];return B.model.problem={projectId:e.projectId,problemStamp:e.problemStamp,positionId:e.positionId||"",diagramId:e.diagramId,positionName:"",checkItemId:e.checkItemId||"",checkItemName:e.checkItemName||"",topCheckItemId:e.checkItemId||"",checkItemGuide:!1,descIds:e.descIds||"",descNames:e.descNames||"",remark:e.remark||"",imageList:e.imageList||[],emergencyDegree:"一般",coordinates:t,contractors:"",contractorIds:"",responsibilityUnitIds:"",responsibilityUnits:"",isPassedWhenAdd:!1,isRemarkRequired:"",feedbackId:e.feedbackId,batchRoomId:e.batch_room_id},"roomDesignChange"!==e.problemType&&"feedbackRemainReply"!==e.problemType||(L={batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id}),B.model.positionId=null,B.setProblem(),o["a"].resolve()}function A(e){return g["a"].getProblem(e.problemId).then((function(t){var n=o["a"].when();return L&&!l.a.isEmpty(L)||(L={fromType:e.type,batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id,isSpecial:e.isSpecial,fitmentStandard:e.fitment_standard,batchId:t.batch_id}),n.then((function(){return t.problem_reason_ids=[],d["a"].state.app.global.enableProblemReason?I["a"].getProblemReason(e.problemId).then((function(e){return t.problem_reason_ids=e,o["a"].resolve(t)})):o["a"].resolve(t)}))})).then((function(t){B.model.problem={id:t.id,projectId:t.proj_id,positionId:t.position_id||"",positionName:t.position_name||"",diagramId:t.roomtype_diagram_id,checkItemId:t.item_id||"",checkItemName:t.item_name||"",topCheckItemId:t.top_item_id||"",checkItemGuide:!1,descIds:t.desc_id||"",descNames:t.desc||"",remark:t.remark,imageList:[],emergencyDegree:t.emergency_degree,coordinates:t.coordinates,contractors:t.contractor_name,contractorIds:t.contractor_id,responsibilityUnitIds:t.responsible_company_id,responsibilityUnits:t.responsible_company_name,isPassedWhenAdd:t.is_passed_when_add||!1,isRemarkRequired:t.isRemarkRequired,reasonIds:t.problem_reason_ids,batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id},t.problem_images.forEach((function(e){var t=c["a"].getImageRealPath(e.img_localpath);B.model.problem.imageList.push({localPath:e.img_localpath,fullPath:t,viewPath:c["a"].getImageWebViewPath(t)})})),console.log("==== _self.model.problem  ====",B.model.problem),C=t.remark,T=t.is_passed_when_add,B.model.positionId=t.position_id}))}var B={initUpdate:!0,model:{isLoaded:!1,positionId:"",problem:{imageList:[]},ProblemReasons:[],remarkChangeStatus:1},setProblem:function(e){var t={};B.model.positionDisabled=!1,B.model.checkItemDisabled=!1,B.model.descDisabled=!1,B.model.contractorDisabled=!1,"roomDesignChange"===B.model.problemType?(!l.a.isEmpty(e)&&(t={checkItemId:e.itemId,topCheckItemId:e.itemId,checkItemName:e.itemName,descIds:e.descId,descNames:e.descName,emergencyDegree:e.emergency_degree,remark:e.remark}),B.model.checkItemDisabled=!0,B.model.descDisabled=!0):"feedbackRemainReply"===B.model.problemType?(B.model.positionDisabled=!0,B.model.checkItemDisabled=!0):"fitmentStyle"===B.model.problemType?(!l.a.isEmpty(e)&&(t={checkItemId:e.checkItemId,topCheckItemId:e.checkItemId,checkItemName:e.checkItemName,emergencyDegree:"前置配置"===e.configType?"紧急":"一般",positionId:e.positionId||""}),B.model.positionDisabled=!0,B.model.checkItemDisabled=!0):"checkList"===B.model.problemType&&(!l.a.isEmpty(e)&&(B.model.problem=l.a.extend(B.model.problem||{},e)),j(),O(),B.initUpdate=!1),B.model.problem=l.a.extend(B.model.problem||{},t)},showGuide:function(){return B.model.problem.checkItemId?v["a"].getCheckItemGuideByItemId(B.model.problem.checkItemId).then((function(e){B.model.guideText=e,B.model.showGuide=!!e})):(B.model.guideText="",B.model.showGuide=!1,o["a"].resolve())},init:function(e){B.model.isLoaded=!1,B.model.title=e.problemId?"编辑问题":"feedbackRemainReply"!==e.problemType?"登记问题":e.title,B.model.problemType=e.problemType||"default";var t,n=d["a"].state.app.global.currentBatchType||"simulate";return B.model.enablePassWhenAdd=1==k["a"].getLocalBusinessToggle().enable_pass_when_add&&(m["default"].prototype.$checkRight("reinspect_problem",n)||m["default"].prototype.$checkRight("pass_problem",n)),B.model.ProblemReasons=[],console.log("=====",B.model),t=e.problemId?A(e):R(e),t.then((function(){return B.showGuide().then((function(){if(B.model.problem.positionId)return b["a"].getPositionNameById(B.model.problem.positionId).then((function(e){B.model.problem.positionName=e}))})).then((function(){B.initUpdate&&j()})).then((function(){if(d["a"].state.app.global.enableProblemReason)return I["a"].getReasonConfig().then((function(t){console.log("=== reasons ===",t),e.problemId&&t.forEach((function(e){m["default"].prototype.$set(e,"selected",B.model.problem.reasonIds.indexOf(e.id)>-1)})),B.model.ProblemReasons=t}))})).then((function(){B.model.isLoaded=!0})).catch((function(e){console.error(e),m["default"].prototype.$toast("获取相关数据失败，请返回或稍后重试")}))}))},updateProblem:function(e,t){return t=t||!1,B.model.problem=Object.assign({},B.model.problem,e),B.showGuide().then((function(){return j(),e.remark&&B.model.remarkChangeStatus++,D("updateProblem - 更新问题的字段：","updateProblem=".concat(t),e),t?O():o["a"].resolve()}))},takePhoto:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=c["a"].getNewProblemImagePath({folder:L.batchUnitId+"/"+L.batchRoomId,imageId:Object(a["j"])()});return console.log("take photo",t),r["a"].takePhoto(t.full_path,P({withGraffiti:!0,text:g["a"].getWatermarkText()},e)).then((function(){B.model.problem.imageList.push({localPath:t.save_path,fullPath:t.full_path,viewPath:t.view_path?t.view_path:c["a"].getImageWebViewPath(t.full_path)})}))},addProblem:function(e){e=e||"";var t=[];l.a.each(B.model.problem.imageList,(function(e){t.push({img_localpath:e.localPath})}));var n={problem_images:t,batch_room_id:L.batchRoomId||B.model.problem.batchRoomId,position_id:B.model.problem.positionId,item_id:B.model.problem.checkItemId,top_item_id:L.isSpecial?"":B.model.problem.topCheckItemId,desc_id:B.model.problem.descIds,contractor_id:B.model.problem.contractorIds,responsible_company_id:B.model.problem.responsibilityUnitIds,roomtype_diagram_id:B.model.problem.diagramId,coordinate:B.model.problem.coordinates,emergency_degree:B.model.problem.emergencyDegree,remark:B.model.problem.remark,is_passed_when_add:B.model.problem.isPassedWhenAdd?1:0,problemType:B.model.problemType,feedbackId:B.model.problem.feedbackId},i=[];return B.model.ProblemReasons.forEach((function(e){e.selected&&i.push(e.id)})),g["a"].batchAddProblem(n,L.isSpecial,e,i).then((function(){return x["a"].updateCheckItemUseTimes(B.model.problem.checkItemId).catch((function(e){window.$log("添加问题 updateCheckItemUseTimes catch & 参数",{error:e,curr_param:{checkItemId:B.model.problem.checkItemId}}),console.log("添加问题 updateCheckItemUseTimes catch & 参数",{error:e,curr_param:{checkItemId:B.model.problem.checkItemId}})}))})).then((function(){return x["a"].updateItemDescUseTimes(B.model.problem.descIds).catch((function(e){window.$log("添加问题 updateItemDescUseTimes catch & 参数",{error:e,curr_param:{descIds:B.model.problem.descIds}}),console.log("添加问题 updateItemDescUseTimes catch & 参数",{error:e,curr_param:{descIds:B.model.problem.descIds}})}))})).then((function(){return h["a"].init().catch((function(e){window.$log("添加问题 刷新房间问题model catch",e),console.error("添加问题 刷新房间问题model catch",e)})),L.mode})).catch((function(e){window.$log("添加问题 刷新房间问题model这一步的外部 catch",e),console.error("添加问题 刷新房间问题model这一步的外部 catch",e)})).finally((function(){console.log("添加问题 finally88"),B.model.problem.remark&&B.model.problem.descIds.indexOf(";")<0&&u["a"].upsertHistory(B.model.problem.checkItemId,B.model.problem.descIds,B.model.problem.remark).catch((function(e){window.$log("添加问题 finally catch",e),console.log("添加问题 finally catch",e)}))}))},editProblem:function(){var e=[],t=[];return l.a.each(B.model.problem.imageList,(function(e){t.push({img_localpath:e.localPath})})),B.model.ProblemReasons.forEach((function(t){t.selected&&e.push(t.id)})),g["a"].processEditProblem({id:B.model.problem.id,problem_images:t,batch_room_id:L.batchRoomId,position_id:B.model.problem.positionId,item_id:B.model.problem.checkItemId,top_item_id:L.isSpecial?"":B.model.problem.topCheckItemId,desc_id:B.model.problem.descIds,contractor_id:B.model.problem.contractorIds,responsible_company_id:B.model.problem.responsibilityUnitIds,emergency_degree:B.model.problem.emergencyDegree,remark:B.model.problem.remark,roomtype_diagram_id:B.model.problem.diagramId,coordinate:B.model.problem.coordinates,is_passed_when_add:B.model.problem.isPassedWhenAdd?1:0,is_passed_when_add_old:T},L.isSpecial,e).then((function(){p["a"].updateProblem(B.model.problem.id),h["a"].init()})).catch((function(e){return o["a"].reject(e)})).finally((function(){B.model.problem.remark&&B.model.problem.descIds.indexOf(";")<0&&C!=B.model.problem.remark&&u["a"].upsertHistory(B.model.problem.checkItemId,B.model.problem.descIds,B.model.problem.remark)}))}};t["a"]=B},db99:function(e,t,n){"use strict";n("6d57"),n("e697");var i=n("fd50"),o=(n("cc57"),n("9a33"),n("a324")),r=n("760e"),a=function(){var e=20,t={},n={},a={};return t={batch_unit_id:"cp.batch_unit_id",status:"cp.status",floor:"br.floor",item:"ci.id",user:"u.id"},n.formatData=function(e,t){var n=[],i=[];return _.each(e,(function(e){var o={};e.desc_id=e.desc_id.split(";"),_.each(e.desc_id,(function(e){n.indexOf(e)<0&&n.push(e)})),-1==e.floor.indexOf("层")&&-1==e.floor.indexOf("楼")&&-1==e.floor.indexOf("公共区域")&&(e.floor=e.floor+"楼"),o.id=e.id,o.code=e.code,o.batchRoomId=e.batch_room_id,o.batchUnitId=e.batch_unit_id,o.registerUserName=e.regist_user_name,o.roomtypeDiagramId=e.roomtype_diagram_id,o.status=e.status,o.roomName=t+"-"+e.floor+"-"+e.room_no,o.dealTime=e.deal_time&&"00-00-00 00:00:00"!==e.deal_time?e.deal_time:"",o.emergence=e.emergency_degree&&e.emergency_degree.indexOf("急")>-1?e.emergency_degree:"",o.sendBackTimes=e.sent_back_time||0,o.positionName=e.position,o.itemName=e.item,o.contractor=e.contractor||"",o.desc=e.desc_id,i.push(o)})),r["a"].getDescByIds(n).then((function(e){return _.each(i,(function(t){_.each(t.desc,(function(n,i){var o=_.find(e,{id:n});t.desc[i]=o?o.name:"无描述"})),t.desc=t.desc.join("、")})),i}))},n.getFilter=function(e,t){var n={status:o["a"].getCountOfProblemStatus,floor:o["a"].getCountOfFloor,item:o["a"].getCountOfCheckItem,user:o["a"].getCountOfRegister};return n[e](t)},a.createCondition=function(e,n){if(_.isEmpty(e))return"";"batch_unit_id"==n&&(n="");var i=[];return _.each(e,(function(e,o){t[o]&&o!==n&&i.push(t[o]+'="'+e+'"')})),i.join(" and ")},a.initFilter=function(){var e=[{type:"status",title:"问题状态",name:"",value:"",options:[]},{type:"floor",title:"楼层",name:"",value:"",options:[]},{type:"item",title:"检查项",name:"",value:"",options:[]},{type:"user",title:"登记人",name:"",value:"",options:[]}];return e},a.getProblems=function(t,r,c){var s=a.createCondition(r);return o["a"].getAllProblemListByPage(s,t,e).then((function(e){return!e||_.isEmpty(e)?[]:n.formatData(e,c)})).catch((function(e){return i["a"].reject(e)}))},a.getFilterCount=function(e){e=e||{};var o,r="",c={},s=[];return _.each(t,(function(t,i){"batch_unit_id"!==i&&(r=a.createCondition(e,i),o=n.getFilter(i,r).then((function(e){return{type:i,res:e}})),s.push(o))})),i["a"].all(s).then((function(e){return _.each(e,(function(e){if(e){var t=[],n=0;_.each(e.res,(function(e){t.push({count:e.count,name:e.name||e.title,value:e.value}),n+=e.count})),t.unshift({value:"",name:"全部",count:n}),c[e.type]=t}})),c}))},a.getSelectedProblems=function(e){var t=a.createCondition(e);return o["a"].getSelectedProblems(t)},a.passProblems=function(e){var t=[];return e.forEach((function(e){t.push(o["a"].passProblem(e.id,e.batchRoomId))})),i["a"].all(t)},a.getListInfoById=function(e,t){return o["a"].getListInfoById(e).then((function(e){return n.formatData([e],t).then((function(e){return e.shift()}))})).catch((function(e){return i["a"].reject(e)}))},a},c=a(),s=n("9072"),l=n("a14a"),d=n.n(l),m=function(){var e={},t=20,n={};function o(){d.a.isEmpty(e.filter)&&(e.filter=c.initFilter());var n=r(),i=[],o="";return c.getFilterCount(n).then((function(n){d.a.each(e.filter,(function(t,r){if(o=e.filter[r].value||"",t&&n[t.type]){var a=d.a.find(n[t.type],{value:o});a&&i.push(a.count),e.filter[r].options=n[t.type]}}));var r=Math.min.apply(null,i);e.totalPage=Math.ceil(r/t)}))}function r(){var t={batch_unit_id:e.batchUnitId};return d.a.each(e.filter,(function(e){e.value&&(t[e.type]=e.value)})),t}function a(){var t=i["a"].defer();if(e.isAllSelected){var n=r();c.getSelectedProblems(n).then((function(e){t.resolve(e)})).catch((function(e){t.reject(e)}))}else t.reject();return t.promise}function l(t){e.isAllSelected?e.problemList=[]:d.a.each(t,(function(t){var n=d.a.find(e.problemList,{id:t.id});if(n){var i=-1;e.problemList&&(i=e.problemList.indexOf(n)),i>-1&&e.problemList.splice(i,1)}}))}return e.filter=c.initFilter(),e.currPage=0,e.totalPage=0,e.problemList=[],e.isAllSelected=!1,n={model:e,init:function(t,o){var r=i["a"].when();return e.currPage=0,e.problemList=[],e.batchUnitId=t,e.unitName=o,e.currConditon={},1==window.isNeedClearAllData&&(e.filter=c.initFilter(),window.isNeedClearAllData=!1),null==window.take_photo_when_review&&r.then((function(){return s["a"].getReviewPhotoSetting()})),r.then((function(){return n.load(0)}))},load:function(t){if(t&&t==e.currPage)return i["a"].resolve();var n=r();return o(),c.getProblems(t,n,e.unitName).then((function(t){return e.isAllSelected&&t.forEach((function(e){e.checked=!0})),i["a"].resolve(t)})).then((function(n){return e.problemList=t?e.problemList.concat(n):n,e.currPage=t,i["a"].resolve(!0)}))},passProblems:function(e){var t=i["a"].defer(),n=function(e){c.passProblems(e).then((function(){l(e),t.resolve()})).catch((function(e){t.reject(e)}))};return e?n(e):a().then(n),t.promise},updateProblem:function(t){var n=d.a.find(e.problemList,{id:t});return n?c.getListInfoById(t,e.unitName).then((function(t){if(!d.a.isEmpty(t)){if(""!=e.filter[0].value&&n.status!=t.status){var i=e.problemList.indexOf(n);i>-1&&e.problemList.splice(i,1)}else n=d.a.extend(n,t);o(),$rootScope.$$phase||$rootScope.$digest()}})):i["a"].resolve()}}};t["a"]=m()},e073:function(e,t,n){"use strict";n("cc57");var i=n("fd50"),o=n("af93"),r=n("a324"),a=n("8ae6"),c=n("c6e3"),s=function(e,t){if(e&&t){for(var n=e.map((function(e){return{id:e.id,name:e.name,path:e.path,positionList:e.positionList,problemList:[]}})),i=0;i<n.length;i++)if(n[i])for(var o=0;o<t.length;o++)t[o]&&n[i].id===t[o].roomtype_diagram_id&&t[o].isShow&&n[i].problemList.push(d(t[o]));return n}return e},l=function(e,t){var n=[c["a"].getRoomTypeDiagram(e),o["a"].getRoomTypeDiagramList(e)];return t&&n.push(r["a"].getProblemList(e,0,!0)),i["a"].all(n).then((function(e){console.log("resultSet",e);var t=e[0],n=e[1],i=e[2]||[];if(t)for(var o=0;o<t.length;o++){if(t[o]&&t[o].path&&(t[o].path="dev"==window.ZHKF_GLOBAL_ENV.VUE_APP_ENV?"img/huxing.jpg":a["a"].getImagePrefixPath()+t[o].path),t[o]&&n){t[o].positionList=[];for(var r=0;r<n.length;r++)n[r]&&t[o].id===n[r].diagram_id&&(n[r].coordinate=JSON.parse(n[r].coordinate),n[r].id=n[r].position_id,t[o].positionList.push(n[r]))}if(t[o]&&i){t[o].problemList=[];for(var c=0;c<i.length;c++)i[c]&&t[o].id===i[c].roomtype_diagram_id&&t[o].problemList.push(d(i[c]))}}return t}))},d=function(e){if(e.color)return e;var t=e;t.coordinate=e.coordinate?JSON.parse(e.coordinate):{};var n="";switch(e.status){case"待派单":n="#bb33ee";break;case"待整改":n="#ff4545";break;case"已整改":n="#0099ff";break;case"已通过":n="#0bc666";break;case"已作废":n="#888888";break;case"非正常关闭":n="#000000";break}return t.color=n,t};t["a"]={getDiagramData:l,refreshDiagramData:s}},e4b8:function(e,t,n){var i=n("985c");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("38581ba7",i,!0,{})},f09f:function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .roomdetail[data-v-156a7b78] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .roomdetail .van-tabs[data-v-156a7b78] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-orient: vertical;\n    -webkit-box-direction: normal;\n        -ms-flex-direction: column;\n            flex-direction: column;\n}\n.zhkf .roomdetail[data-v-156a7b78] .van-tabs__wrap {\n    top: 0;\n    left: 0;\n    right: 0;\n    z-index: 99;\n    overflow: hidden;\n    position: absolute;\n}\n.zhkf .roomdetail[data-v-156a7b78] .van-tabs__content {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .roomdetail[data-v-156a7b78] .van-tabs__content .van-tab__pane {\n    height: 100%;\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-orient: vertical;\n    -webkit-box-direction: normal;\n        -ms-flex-direction: column;\n            flex-direction: column;\n}\n",""])},fa1b:function(e,t,n){"use strict";var i=n("1834");t["a"]={getCheckItemList:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=[e],a="select bc.item_id, ci.full_name as item_full_name  from batch_checkitem bc  inner join check_item ci on ci.id = bc.item_id  where bc.batch_id = ? ";if(a+=t?" and ci.is_for_rough = 1 ":" and ci.is_for_decorated = 1 ",n){var c=o?"project_position_checkitem":"position_checkitem";a+=" and bc.item_id in                     (select item_id from "+c+" where position_id = ? )",r.push(n)}return a+=" order by ci.sort ",i["a"].query(a,r)}}}}]);