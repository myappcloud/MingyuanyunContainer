(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-07bba316"],{"0a1d":function(e,t,o){"use strict";o("6d57");var n=o("16ca"),i=o("fd50"),r=o("c6e3"),a=o("a324"),s=o("0523"),c=function(){var e=function(e,t){for(var o=0;o<e.length;o++){var n=e[o],i=!1,r=0,a=!0;if("已交付"!=n.delivery_status){for(var s=0;s<t.length;s++){var c=t[s];c.batch_room_id.toLowerCase()==n.id.toLowerCase()&&(i=!0,["待派单","待指派","待整改"].indexOf(c.status)>-1&&(n.room_status="待整改",a=!1),"已整改"===c.status&&(a=!1,r=1),"已通过"!==c.status&&(a=!1))}a||n.room_status?"待整改"===n.room_status&&(n.has_repaired=r):n.room_status="已整改","交付中"!=n.delivery_status||"暂不收楼"===n.delivery_situation||i&&!a?("待交付"!=n.delivery_status||i&&!a)&&("交付中"!=n.delivery_status||"暂不收楼"!=n.delivery_situation||i&&!a)||(n.room_status="待交付"):n.room_status="已交付"}else n.room_status="已交付"}return e},t=function(t){var o=[r["a"].getUnitFloors(t),r["a"].getUnitRooms(t),a["a"].getProblemListByBatchUnitId(t)];return i["a"].all(o).then((function(o){var n=o[0],i=o[1],r=o[2];return e(i,r),s["a"].buildRoomListData(t,n,i)}))};return{getRoomListByBatchUnit:t}},l=c(),d=function(){var e=function(e,t){for(var o=0;o<e.length;o++){for(var n=e[o],i=!1,r=0,a=!0,s=0;s<t.length;s++){var c=t[s];c.batch_room_id.toLowerCase()==n.id.toLowerCase()&&(i=!0,["待派单","待指派","待整改"].indexOf(c.status)>-1&&(n.room_status="待整改",a=!1),"已整改"===c.status&&(a=!1,r=1),"已通过"!==c.status&&(a=!1))}if(a||n.room_status?"待整改"===n.room_status&&(n.has_repaired=r):n.room_status="已整改",i?a&&("已接待"===n.opening_status?n.room_status="已接待":n.room_status="待接待"):"已接待"===n.opening_status?n.room_status="已接待":n.room_status="待接待",!n.room_status)throw new Error("room_status 赋值为空."+n.id)}return e},t=function(t){var o=[r["a"].getUnitFloors(t),r["a"].getUnitRooms(t),a["a"].getProblemListByBatchUnitId(t)];return i["a"].all(o).then((function(o){var n=o[0],i=o[1],r=o[2];return i=e(i,r),s["a"].buildRoomListData(t,n,i)}))};return{getRoomListByBatchUnit:t}},u=d(),m=function(){var e={simulate:[{name:"全部",key:"all",dot:"",less:0},{name:"待检查",key:"待检查",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已通过",key:"已通过",dot:"green",less:0}],delivery:[{name:"全部",key:"all",dot:"",less:0},{name:"待交付",key:"待交付",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已交付",key:"已交付",dot:"green",less:0}],online_delivery:[{name:"全部",key:"all",dot:"",less:0},{name:"待交付",key:"待交付",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已交付",key:"已交付",dot:"green",less:0}],opening:[{name:"全部",key:"all",dot:"",less:0},{name:"待接待",key:"待接待",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已接待",key:"已接待",dot:"green",less:0}]},t={simulate:n["a"],delivery:l,opening:u,online_delivery:l},o={tabs:[],items:{},lastView:{},status_sel:"全部",status_counter:0,display_rooms:[]};return{model:o,init:function(e,t){return this.model.batchType=e,this.model.unitId=t,this.model.tabs=this.getTabs(e),this.getRoomList(e,t)},updateRoomList:function(){var e=this.model,t=e.batchType,o=e.unitId;this.init(t,o)},getTabs:function(t){return e[t]},tabsInit:function(){var e=this.model.items.unit_list[0].status_counter;this.model.tabs.forEach((function(t){t.less=e[t.key]||0}))},getRoomList:function(e,o){var n=this;return"special_checkitem"===e&&(e="simulate"),t[e]&&t[e].getRoomListByBatchUnit?t[e].getRoomListByBatchUnit(o).then((function(e){n.model.items=e,n.iniRoomData(),n.tabsInit()})):Promise.resolve()},iniRoomData:function(){this.model.items["unit_sel"]=this.model.items.unit_list[0].unit,this.roomStatusClass(),this.model.status_sel=this.model.lastView&&this.model.lastView.status||"全部",this.filterRoomList(),this.model.status_counter=this.model.items.unit_list[0].status_counter},filterRoomList:function(){for(var e=this.model.items.unit_list[0].floor_list,t=[],o=0;o<e.length;o++){for(var n=e[o].room_list,i=[],r=!1,a=0;a<n.length;a++)"全部"!=this.model.status_sel&&n[a].room_status!=this.model.status_sel||(i.push(n[a]),r=!0);r&&t.push({floor:e[o].floor,room_list:i})}this.model.display_rooms=t,console.log(this.model.display_rooms,"------------楼栋数据------------")},roomStatusClass:function(){for(var e=o.items.unit_list,t=0;t<e.length;t++)for(var n=e[t].floor_list,i=0;i<n.length;i++){var r=n[i].room_list;n[i]["floor_show"]=!0;for(var a=0;a<r.length;a++){switch(r[a]["room_show"]=!0,r[a].room_status){case"待检查":r[a]["room_status_class"]="white";break;case"待整改":r[a]["room_status_class"]="red",r[a].has_repaired&&(r[a]["room_status_class"]+=" problem-repaired");break;case"已整改":r[a]["room_status_class"]="blue";break;case"已通过":case"已接待":case"已交付":r[a]["room_status_class"]="green";break;default:r[a]["room_status_class"]="white";break}r[a]["room_info"]=JSON.stringify({building_name:r[a].building_name,unit:r[a].unit,floor:r[a].floor,room_no:r[a].room_no})}}}}};t["a"]=m()},"16ca":function(e,t,o){"use strict";var n=o("fd50"),i=o("c6e3"),r=o("a324"),a=o("0523"),s=o("07a4"),c=o("af4c"),l=function(e,t){for(var o=0;o<t.length;o++){var n=t[o];if(n.batch_room_id.toLowerCase()==e.toLowerCase())return!1}return!0},d=function(e,t){for(var o=0;o<e.length;o++){var n=e[o];if(0!=n.has_problem||0!=n.is_checked)if(l(n.id,t))e[o].room_status="已通过";else{for(var i=!0,r=0,a=0;a<t.length;a++){var s=t[a];if(n.id.toLowerCase()==s.batch_room_id.toLowerCase()){var c=["待派单","待指派","待整改"];c.indexOf(s.status)>-1&&(n.room_status="待整改",i=!1),"已整改"===s.status&&(i=!1,r=1)}}i?n.room_status="已通过":n.room_status?"待整改"===n.room_status&&(n.has_repaired=r):n.room_status="已整改"}else e[o].room_status="待检查"}return e},u=function(e){var t=[i["a"].getUnitFloors(e),i["a"].getUnitRooms(e),r["a"].getProblemListByBatchUnitId(e)];return n["a"].all(t).then((function(t){var o=t[0],n=t[1],i=t[2];return d(n,i),a["a"].buildRoomListData(e,o,n)}))};t["a"]={getRoomListByBatchUnit:u,updateCheckStatus:function(e){return i["a"].getRoomCheckStatus(e).then((function(e){e=e||{};var t=!e["is_checked"]||!e["check_date"]||!e["check_engineer"];return i["a"].updateCheckStatus(e,t)})).then((function(){"todo"===s["a"].state.app.global.currentMenuType&&c["a"].updateRoomList(!0)}))}}},2012:function(e,t,o){t=e.exports=o("690e")(!1),t.push([e.i,"\n.zhkf .room-list[data-v-1197a8c2] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.zhkf .content[data-v-1197a8c2] {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .wrapper[data-v-1197a8c2] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .toggleBtn[data-v-1197a8c2] {\n  color: #202020;\n  white-space: nowrap;\n}\n.zhkf .white[data-v-1197a8c2] {\n  border: 1px solid #ccc !important;\n}\n.zhkf .red[data-v-1197a8c2] {\n  background: #eb544d;\n  color: #fff;\n}\n.zhkf .blue[data-v-1197a8c2] {\n  background: #0099ff;\n  color: #fff;\n}\n.zhkf .green[data-v-1197a8c2] {\n  background: #0bc666;\n  color: #fff;\n}\n.zhkf .dot[data-v-1197a8c2] {\n  width: 7px;\n  height: 7px;\n  border-radius: 50%;\n  margin-right: 3px;\n}\n.zhkf .tabs[data-v-1197a8c2] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  height: 62px;\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  background: #fff;\n}\n.zhkf .tabs .tab[data-v-1197a8c2] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    position: relative;\n}\n.zhkf .tabs .tab[data-v-1197a8c2]:last-child {\n      border: none;\n}\n.zhkf .tabs .tab .title[data-v-1197a8c2] {\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n      -webkit-box-align: center;\n          -ms-flex-align: center;\n              align-items: center;\n      -webkit-box-pack: center;\n          -ms-flex-pack: center;\n              justify-content: center;\n      font-size: 14px;\n}\n.zhkf .tabs .tab .less[data-v-1197a8c2] {\n      text-align: center;\n      font-size: 12px;\n      color: #606060;\n}\n.zhkf .tabs .tab .line[data-v-1197a8c2] {\n      position: absolute;\n      bottom: -13px;\n      right: 50%;\n      -webkit-transform: translateX(50%);\n              transform: translateX(50%);\n      width: 24px;\n      height: 3px;\n      background: -webkit-gradient(linear, left top, right top, from(#1cb0fd), to(#0099ff));\n      background: linear-gradient(90deg, #1cb0fd 0%, #0099ff 100%);\n      border-radius: 3px;\n      z-index: 10;\n}\n.zhkf .rooms[data-v-1197a8c2] {\n  overflow: auto;\n  margin-top: 10px;\n}\n.zhkf .rooms .room[data-v-1197a8c2] {\n    padding: 4px 6px 19px 10px;\n    background: #fff;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n}\n.zhkf .rooms .room .floor[data-v-1197a8c2] {\n      padding-top: 20px;\n      width: 42px;\n      word-break: break-all;\n      text-align: center;\n      margin-right: 10px;\n      font-size: 14px;\n}\n.zhkf .rooms .room .floor span[data-v-1197a8c2]:first-child {\n        font-size: 16px;\n}\n.zhkf .rooms .room .floor span.f20[data-v-1197a8c2] {\n        font-size: 20px;\n}\n.zhkf .rooms .room .floor-rooms[data-v-1197a8c2] {\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n      -webkit-box-orient: horizontal;\n      -webkit-box-direction: normal;\n          -ms-flex-direction: row;\n              flex-direction: row;\n      -ms-flex-wrap: wrap;\n          flex-wrap: wrap;\n      -webkit-box-flex: 1;\n          -ms-flex: 1;\n              flex: 1;\n}\n.zhkf .rooms .room .floor-rooms .floor-room[data-v-1197a8c2] {\n        height: 32px;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n            -ms-flex-align: center;\n                align-items: center;\n        padding: 0 19px;\n        border-radius: 2px;\n        margin-right: 12px;\n        margin-top: 15px;\n        font-size: 14px;\n        position: relative;\n        border: 1px solid transparent;\n}\n.zhkf .rooms .room .floor-rooms .floor-room .dot[data-v-1197a8c2] {\n          width: 6px;\n          height: 6px;\n          position: absolute;\n          margin-right: 0;\n          top: 5px;\n          right: 5px;\n          display: none;\n}\n.zhkf .rooms .room .floor-rooms .floor-room.problem-repaired .dot[data-v-1197a8c2] {\n          display: block;\n}\n.zhkf .lou-ceng[data-v-1197a8c2] {\n  position: fixed;\n  bottom: 30px;\n  right: 15px;\n  width: 40px;\n  height: 40px;\n  line-height: 40px;\n  border-radius: 50%;\n  font-size: 14px;\n  text-align: center;\n  color: #fff;\n  background: -webkit-gradient(linear, left top, left bottom, from(#02b8ff), to(#0085ff));\n  background: linear-gradient(to bottom, #02b8ff, #0085ff);\n}\n.zhkf .lou-ceng-content[data-v-1197a8c2] {\n  position: absolute;\n  width: 180px;\n  font-size: 16px;\n  background-color: #fff;\n  z-index: 11;\n}\n.zhkf .list-title[data-v-1197a8c2] {\n  height: 45px;\n  line-height: 45px;\n  padding-left: 15px;\n  font-weight: 500;\n  color: #303030;\n  border-bottom: 1px solid #ebebeb;\n}\n.zhkf .lc-mask[data-v-1197a8c2] {\n  position: absolute;\n  top: 0;\n  height: 100%;\n  width: 100%;\n  background-color: rgba(0, 0, 0, 0.35);\n}\n.zhkf .lc-list[data-v-1197a8c2] {\n  padding-bottom: 65px;\n  overflow: auto;\n  color: #909090;\n}\n.zhkf .lc-list div[data-v-1197a8c2] {\n    height: 45px;\n    line-height: 45px;\n    padding-left: 15px;\n}\n.zhkf .lc-list .active_div[data-v-1197a8c2] {\n    font-weight: 500;\n    color: #303030;\n    background-color: #efefef;\n}\n.zhkf .lc-list img[data-v-1197a8c2] {\n    width: 13px;\n    height: 10px;\n    margin-left: 115px;\n}\n",""])},2249:function(e,t,o){"use strict";o.r(t);o("5ab2"),o("e44b"),o("e10e"),o("6d57"),o("cc57"),o("f548"),o("f0e6");var n=o("28f8"),i=o("0a1d"),r=o("0523"),a=o("5c1b"),s=o("0e1c"),c=o("cb6b"),l=o("438a"),d=o("f2de"),u=o("ba1a");function m(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?m(Object(o),!0).forEach((function(t){Object(n["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):m(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var h="[views]/room-list：",_={components:{EmptyPage:l["a"]},data:function(){return{model:i["a"].model,batchUnitId:"",title:"",batchType:"",hasClicked:!1,loading:!1,showEmpty:!1,emptyImgSrc:o("5452"),emptyMsg:"当前楼栋/单元暂无问题房间",allStatus:!1,isShowFloorList:!1,isChangeTab:!1,showRight:-180,currFloorIndex:0,wrapperScrollTop:0,offsetTopList:[]}},computed:p({},Object(d["e"])({isSpecialBatch:function(e){return e.app.global.isSpecialBatch},currentBatchType:function(e){return e.app.global.currentBatchType},currentMenuType:function(e){return e.app.global.currentMenuType},contentHeight:function(e){return e.app.global.contentHeight},headerHeight:function(e){return e.app.global.headerHeight}})),activated:function(){0!==this.model.display_rooms.length||this.loading||(this.showEmpty=!0),this.$router.isForward?this.wrapperScrollTop=0:this.$refs.roomList.scrollTop=this.wrapperScrollTop},created:function(){var e=this,t=u["a"].getDecodeQuery(this.$route.query),o=t.unitId,n=t.title,r=t.batchType;this.batchUnitId=o,this.title=n,this.batchType=r,this.loading=!0,i["a"].init(r,o).then((function(t){e.items=i["a"].model.items,e.showEmpty=!1,0===e.model.display_rooms.length&&(e.showEmpty=!0),e.loading=!1,a["a"].setIsUseProjectItemOfBatchUnit(o)})).finally((function(){e.model.status_sel="全部",e.select({name:"全部"})})).catch((function(e){return console.error(e)}))},methods:{go:function(){window.isNeedClearAllData=!0,this.$router.replace({path:"/checkroom/".concat(this.currentMenuType||this.currentBatchType,"-problem-list"),query:{unitId:this.batchUnitId,title:this.title,batchType:this.batchType}})},select:function(e){this.isChangeTab=!0,this.model.status_sel=e.name,i["a"].filterRoomList(),this.showEmpty=!1,0===this.model.display_rooms.length&&(this.showEmpty=!0),this.emptyMsg="当前楼栋/单元暂无".concat("全部"==e.name?"":e.name,"房间"),this.$refs.roomList.scrollTop=1,this.currFloorIndex=0,this.$refs.roomList.scrollTop=0,this.$refs.lcList.scrollTop=0},goRoom:function(e){var t=this;if(console.log(h,"goRoom()",e),this.wrapperScrollTop=this.$refs.roomList.scrollTop,this.model.lastView={status:this.model.status_sel},!this.hasClicked){this.hasClicked=!0;var o={batchRoomId:e.id,roomId:e.room_id,building_id:e.building_id,batch_unit_id:this.batchUnitId,roomtype_diagram_id:e.diagram_id,fitment_standard:e.fitment_standard,batch_id:e.batch_id,room_type_id:e.room_type_id,type:this.currentBatchType,isSpecial:0},n=this;r["a"].getRoomTypeImageFileIsExists(e.id).then((function(i){t.hasClicked=!1;var a=function(t,i){o.from="roomlist",o.isImageExists=i,o.roomTitle=e.building_name+e.room_no,t&&(o.isSpecial=1),c["a"].remove(s["a"].HAS_LAYOUT_IMG,c["a"].level.user),c["a"].set(s["a"].FROM_PAGE,"roomList",c["a"].level.user),t?n.$router.push({path:"/checkroom/".concat(n.currentMenuType||n.currentBatchType,"-roomdetail-special"),query:p({},o)}):n.$router.push({path:"/checkroom/".concat(n.currentMenuType||n.currentBatchType,"-roomdetail"),query:p({},o)})};if("simulate"===n.currentBatchType){var l=t.isSpecialBatch;o.isSpecial=t.isSpecialBatch,i?r["a"].getRoomTypeImageFileIsExistsIgnoreError(e.id).then((function(t){o.mode="0",o.roomTitle=e.building_name+e.room_no,l?(o.roomId=e.id,t?(c["a"].set(s["a"].HAS_LAYOUT_IMG,"true",c["a"].level.user),n.$router.push({path:"/checkroom/".concat(n.currentMenuType||n.currentBatchType,"-roomdetail-special"),query:p({isImageExists:!0},o)})):a(l,t)):a(l,t)})):(l&&(o.roomId=e.id),a(l,i))}else o.roomTitle=e.building_name+e.room_no,i?(o.mode="0",o.isImageExists=!0):o.from="roomlist",n.$router.push({path:"/checkroom/".concat(n.currentMenuType||n.currentBatchType,"-roomdetail"),query:p({},o)})}))}},showFloorList:function(){var e=this;window.$log("工作台-房间列表悬浮球点击"),this.isShowFloorList=!0,this.showRight=0,setTimeout((function(){if(e.$refs.roomList.scrollTop||e.isChangeTab){var t=e.$refs.roomList.scrollTop+e.headerHeight+45;if(e.isChangeTab||!e.offsetTopList.length){var o=document.getElementById("app").querySelectorAll(".room");o.forEach((function(o,n){var i={};i["index"]=n,i["offsetTop"]=o.offsetTop,e.offsetTopList.push(i),o.offsetTop-t<45&&(e.currFloorIndex=n)})),e.isChangeTab&&(e.isChangeTab=!1)}else e.offsetTopList.forEach((function(o){o.offsetTop-t<45&&(e.currFloorIndex=o.index)}))}else e.currFloorIndex=0;var n=e.$refs.lcList_items[e.currFloorIndex].offsetTop;n&&e.currFloorIndex>10?e.$refs.lcList.scrollTop=n-e.headerHeight-45:e.$refs.lcList.scrollTop=0}),200)},hideFloorList:function(e){var t=document.getElementById("app").querySelectorAll(".room");this.$refs.roomList.scrollTop=t[e].offsetTop-this.headerHeight-70,this.isShowFloorList=!1,this.showRight=-180}}},f=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"room-list"},[o("cus-nav-bar",{attrs:{"data-event":"用户点击","data-log":"问题列表",title:e.title,"left-arrow":""},on:{"click-right":function(t){return e.go()}}},[o("div",{staticClass:"toggleBtn",attrs:{slot:"right"},slot:"right"},[e._v("问题列表")])]),e._v(" "),o("div",{staticClass:"content"},[o("ul",{staticClass:"tabs van-hairline--bottom"},e._l(e.model.tabs,(function(t,n){return o("li",{key:n,staticClass:"tab van-hairline--right",attrs:{"data-event":"用户点击","data-log":t.name},on:{click:function(o){return e.select(t)}}},[o("p",{staticClass:"title"},[t.dot?o("span",{staticClass:"dot",class:t.dot}):e._e(),e._v("\n          "+e._s(t.name)+"\n        ")]),e._v(" "),o("p",{staticClass:"less"},[e._v("("+e._s(t.less)+")")]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.name==e.model.status_sel,expression:"item.name == model.status_sel"}],staticClass:"line"})])})),0),e._v(" "),o("empty-page",{attrs:{"show-empty":e.loading,"loading-page":!0,"empty-msg":"正在统计您的房间，请耐心等待"}}),e._v(" "),o("empty-page",{attrs:{"show-empty":e.showEmpty,"empty-msg":e.emptyMsg,"empty-img-src":e.emptyImgSrc}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.model.display_rooms.length>0&&!e.loading,expression:"model.display_rooms.length > 0 && !loading"}],staticClass:"wrapper"},[o("ul",{ref:"roomList",staticClass:"rooms",style:{height:e.contentHeight-62+"px"}},[e._l(e.model.display_rooms,(function(t){return o("li",{key:t.floor,staticClass:"room van-hairline--bottom"},[o("div",{staticClass:"floor"},[o("span",{class:{f20:/^\w*$/.test(t.floor)}},[e._v(e._s(t.floor))]),e._v(" "),o("span",[e._v("F")])]),e._v(" "),o("ul",{staticClass:"floor-rooms"},e._l(t.room_list,(function(t){return o("li",{key:t.id,staticClass:"floor-room",class:t.room_status_class,attrs:{"data-event":"用户点击","data-log":t.room_no},on:{click:function(o){return e.goRoom(t)}}},[o("span",{staticClass:"dot blue"}),e._v("\n              "+e._s(t.room_no)+"\n            ")])})),0)])})),e._v(" "),o("li",{staticStyle:{height:"50px"}})],2)]),e._v(" "),o("div",{staticClass:"lou-ceng",on:{click:function(t){return e.showFloorList()}}},[e._v("楼层")]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowFloorList,expression:"isShowFloorList"}],staticClass:"lc-mask",on:{click:function(t){e.isShowFloorList=!1}}},[o("div",{on:{click:function(e){e.stopPropagation()}}},[o("div",{staticClass:"lou-ceng-content",style:{top:e.headerHeight+"px",right:e.showRight+"px"}},[o("div",{staticClass:"list-title"},[e._v("楼层选择")]),e._v(" "),o("div",{ref:"lcList",staticClass:"lc-list",style:{height:e.contentHeight+"px"}},[e._l(e.model.display_rooms,(function(t,n){return o("div",{key:n,ref:"lcList_items",refInFor:!0,class:n==e.currFloorIndex?"active_div":"",on:{click:function(t){return e.hideFloorList(n)}}},[e._v("\n              "+e._s(t.floor)+"\n              ")])})),e._v(" "),o("div",{staticStyle:{height:"50px"}})],2)])])])],1)],1)},b=[],g=o("d082");function y(e){o("293f")}var v=!1,k=y,w="data-v-1197a8c2",x=null,I=Object(g["a"])(_,f,b,v,k,w,x);t["default"]=I.exports},"293f":function(e,t,o){var n=o("2012");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var i=o("85cb").default;i("9b2b1db8",n,!0,{})},"43ee":function(e,t,o){"use strict";o("c904");var n=o("fd50"),i=o("a14a"),r=o.n(i),a=o("d49d"),s=function(){var e={unitId:"",list:[],currRoom:{}},t={getRoomList:function(){return a["a"].getRoomList(e.unitId).then((function(t){var o=[];if(console.log(t),t){var n=r.a.groupBy(t,"floor");console.log(n),r.a.each(n,(function(e,t){var n={};n.floor=t,n.roomList=[],n.no=t,console.log(e),r.a.each(e,(function(e){n.roomList.push({id:e.id,room_no:e.room_no,count:e.count})})),n.roomList=n.roomList.sort((function(e,t){return t.room_no-e.room_no})),o.push(n)})),o=o.sort((function(e,t){return t.no-e.no})),e.list=o}}))}};return{model:e,initRoomList:function(o,i){return o||e.unitId?(e.list=[],o&&(e.unitId=o),i&&(e.currRoom={}),t.getRoomList()):n["a"].reject("无效的单元")},refresh:function(){return t.getRoomList()},checkHasUpload:function(e){return a["a"].checkHasUpload(e)}}};t["a"]=s()},"5c1b":function(e,t,o){"use strict";o("f0e6");var n=o("bbed"),i=o("fa1b"),r=o("07a4"),a=o("fd50");function s(){var e=function(e){e&&e.fitment_standard&&("毛坯"===e.fitment_standard?e.is_for_rough=1:"精装"===e.fitment_standard&&(e.is_for_decorated=1),delete e.fitment_standard)},t=function(e,t,o,i,r){return n["a"].getCheckItemLeaf(e,t,i,r).then((function(e){if(_.isEmpty(e))return[];var t=[];return _.each(e,(function(e){t.push(e.id)})),n["a"].getCheckItemAll(t.join("','"),o,i,r)}))};return{getCheckItemList:function(e,o,i,s,c){var l="毛坯"==s,d=a["a"].when(),u=["全部"];return u.push(1==c?"公区":"房间"),u="('"+u.join("','")+"')",d=r["a"].state.app.global.isUseProjectItem?n["a"].getProjectCheckItemList(e,o,i,l,u):t(e,o,i,l,u),d.then((function(e){return e}))},hasProjectCheckitem:function(e){return n["a"].hasProjectCheckitem(e)},searchCheckItemWithProject:function(t,o,i,r){return e(i),r?n["a"].searchProjectCheckItem(r,t,o,i):n["a"].searchCheckItem(t,o,i)},searchCheckItem:function(t,o,i,r){return console.log("searchCheckItem: ",t,o,i),console.time("searchCheckItem"),e(i),n["a"].hasProjectCheckitem(r).then((function(e){return e?n["a"].searchProjectCheckItem(r,t,o,i):n["a"].searchCheckItem(t,o,i).finally((function(){console.timeEnd("searchCheckItem")}))}))},getHigherLevelTreeListByCheckItemId:function(t,o,i){return console.log("getHigherLevelTree: ",t,o,i),console.time("getHigherLevelTree"),e(i),n["a"].getHigherLevelTreeListByCheckItemId(t,o,i).finally((function(){console.timeEnd("getHigherLevelTree")}))},getCheckItemLevel:function(e,t){return n["a"].getCheckItemLevel(e,t)},getPositionItemByRoom:function(e,t,o){var i=a["a"].when(),s=["全部"];return s.push(1==o?"公区":"房间"),s="('"+s.join("','")+"')",i=r["a"].state.app.global.isUseProjectItem?n["a"].getProjectPositionItemByRoom(e,t,s):n["a"].getPositionItemByRoom(e,s),i.then((function(e){return e}))},setIsUseProjectItemOfBatchUnit:function(e){return n["a"].getProjectItemOfBatchUnit(e).then((function(e){var t=!1;e&&(t=!0),r["a"].commit("app/APP",{isUseProjectItem:t})}))},getBatchCheckItem:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return i["a"].getCheckItemList(e,t,o,r["a"].state.app.global.isUseProjectItem).then((function(e){return console.log("BatchCheckItem",e),a["a"].resolve(e)}))}}}t["a"]=s()},"99ee":function(e,t,o){"use strict";o("c904");var n=o("fd50"),i=o("a14a"),r=o.n(i),a=o("ff29"),s=function(){var e={unitId:"",list:[],currRoom:{}},t={getRoomList:function(){return a["a"].getRoomList(e.unitId).then((function(t){var o=[];if(console.log(t),t){var n=r.a.groupBy(t,"floor");console.log(n),r.a.each(n,(function(e,t){var n={};n.floor=t,n.roomList=[],n.no=t,console.log(e),r.a.each(e,(function(e){n.roomList.push({id:e.id,room_no:e.room_no,count:e.count})})),n.roomList=n.roomList.sort((function(e,t){return t.room_no-e.room_no})),o.push(n)})),o=o.sort((function(e,t){return t.no-e.no})),e.list=o}}))}};return{model:e,initRoomList:function(o,i){return o||e.unitId?(e.list=[],o&&(e.unitId=o),i&&(e.currRoom={}),t.getRoomList()):n["a"].reject("无效的单元")},refresh:function(){return t.getRoomList()},checkHasUpload:function(e){return a["a"].checkHasUpload(e)}}};t["a"]=s()},a210:function(e,t,o){"use strict";var n=o("1834"),i=o("0938");t["a"]={insert:function(e,t){var o,r=["id","checkroom_problem_id","operate_type","operate_reason","operate_date","source"];return e.id=i["a"].uuid(),e.operate_date=i["a"].getNowDate(),e.checkroom_problem_id=e.problem_id,e.source="app",e.operate_reason||(e.operate_reason=""),o=n["a"].getColumnsValues(e,r,["operate_reason"]),t?(t.insert("checkroom_problem_operate_log",r,o),e.id):n["a"].insert("checkroom_problem_operate_log",r,o)},deleteByProblemId:function(e,t,o){var i={checkroom_problem_id:e};if(t&&""!=t&&(i.operate_type=t),!o)return n["a"].delete("checkroom_problem_operate_log",i);o.delete("checkroom_problem_operate_log",i)},deleteByUnitId:function(e,t,o){if(t){if(!o)return n["a"].delete("checkroom_problem_operate_log",{batch_unit_id:e,batch_room_id:t});o.delete("checkroom_problem_operate_log",{batch_unit_id:e,batch_room_id:t})}else{if(!o)return n["a"].delete("checkroom_problem_operate_log",{batch_unit_id:e});o.delete("checkroom_problem_operate_log",{batch_unit_id:e})}},getProblemSentBackLogInfo:function(e){var t='select operate_user_name, contractor_name, operate_date, operate_reason, remark from checkroom_problem_operate_log where operate_type = "退回给开发商" and checkroom_problem_id = ? order by operate_date desc';return n["a"].query(t,[e]).catch((function(e){console.log("getProblemSentBackLogInfo error=======",e)}))}}},a324:function(e,t,o){"use strict";o("e697");var n=o("1834"),i=o("fd50"),r=o("0938"),a=o("a14a"),s=o.n(a),c=o("9430"),l=o("a210"),d=function(e,t,o,i){i=i||!1;var r="select                                       p.id,                                           p.code,                       p.batch_room_id,                    p.position_id,                            pt.name position_name,           p.top_item_id,                          p.item_id,                                  ci.full_name as item_name, "+(i?"ifnull(ci.name, '其他') as short_item_name, ":"")+' p.desc_id,                                  p.remark,                                   p.emergency_degree,               p.coordinate,                             p.roomtype_diagram_id,             case p.status when "被退回" then "待派单" else  p.status end status,        case when di.id is null then 0 else 1 end is_local       from checkroom_problem p       left join position pt ON pt.id = p.position_id       left join data_increment di on di.relation_id = p.id and type ="问题" and operation = "add"     left join check_item ci on ci.id=p.item_id     where  p.batch_room_id = ? ';return o||(r+=' and p.status not in ("已作废", "非正常关闭") '),r+=t&&0!==t?" order by\tpt.sort,ci.sort":" order by\tp.regist_date desc",n["a"].query(r,[e])},u=function(e,t,o){var i='select        p.id,       p.position_id,       p.coordinate,       case p.status when "被退回" then "待派单" else  p.status end status,        case when di.id is null then 0 else 1 end is_local,         p.roomtype_diagram_id,      1 as isShow,       case when di.id is null then 0 else 1 end is_local     from checkroom_problem p       left join data_increment di on di.relation_id = p.id and type = "问题" and operation = "add"     where  p.batch_room_id = ? and p.item_id= ? ',r=[e,t];return o&&(i+='and p.desc_id  like "%" || ? || "%"',r.push(o)),n["a"].query(i,r)},m=function(e){var t=[];return e&&s.a.each(e,(function(e){s.a.find(t,(function(t){return t.operate_type===e.operate_type}))||t.push(e)})),t},p=function(e){var t="select p.id,p.code,p.batch_room_id,p.batch_id,p.proj_id,p.building_id,p.position_id,p.top_item_id,p.item_id,p.desc_id,p.remark,p.roomtype_diagram_id,p.coordinate,p.contractor_id,p.repair_remark,p.responsible_company_id,p.regist_date,p.dispatch_date,p.repair_date,p.sent_back_date,p.regist_user_id,p.sent_back_time,p.invalid_date,p.close_date,p.emergency_degree,p.repair_deadline, p.review_date, p.reviewed_by, p.repaired_by, p.assign_user_id,pt.name as position_name,pc.name as contractor_name,ci.full_name as item_name,p.is_passed_when_add ,case p.status when '被退回' then '待派单' else p.status end status,(select operate_reason from checkroom_problem_operate_log\t   where operate_type = '退回' and checkroom_problem_id = p.id    order by operate_date desc limit 1) sent_back_reason, (select operate_reason from checkroom_problem_operate_log\t   where operate_type = '非正常关闭' and checkroom_problem_id = p.id    order by operate_date desc limit 1) close_reason, (select operate_reason from checkroom_problem_operate_log\t   where operate_type = '作废' and checkroom_problem_id = p.id    order by operate_date desc limit 1) invalid_reason,  cb.type as batch_type, cb.child_type as batch_child_type  from checkroom_problem p left join position pt on pt.id=p.position_id left join contractor pc on pc.id=p.contractor_id inner join batch_room br on br.id = p.batch_room_id inner join checkroom_batch cb on cb.batch_id = p.batch_id left join check_item ci on ci.id=p.item_id  where p.id=?",o="select id, operate_type, operate_date from checkroom_problem_operate_log where checkroom_problem_id = ? order by operate_date desc";return n["a"].queryOne(t,[e]).then((function(t){return n["a"].query(o,[e]).then((function(o){var i=m(o),r=s.a.map(i,"id"),a='select img_localpath,img_thumbnail_localpath,img_url,type from problem_images where problem_id=? and (type = "rectify_before" or type is null or type = "" or business_id in("'+r.join('","')+'")) order by type,sort';return n["a"].query(a,[e]).then((function(e){return t.problem_images=e,t}))}))}))},h=function(e){var t="select 1 a from data_increment where operation='add' and type='问题' and relation_id=?";return n["a"].queryOne(t,[e])},_=function(e,t,o,i,a){var d=r["a"].getNowDate();return i=i?parseInt(i):0,w(e).then((function(u){if(!u)throw new Error("未找到batch_room_id相关数据");var m="已整改"===u.status?"repair_sent_back":"sent_back";return n["a"].transaction((function(p){p.update("checkroom_problem",{status:"被退回",sent_back_date:d,sent_back_time:i+1},{id:e},(function(i){var d={};d.batch_unit_id=u.batch_unit_id,d.batch_id=u.batch_id,d.proj_id=u.project_id,d.building_id=u.building_id,d.room_id=u.room_id;var h=l["a"].insert({problem_id:e,batch_unit_id:d.batch_unit_id,operate_type:"退回",operate_reason:o},p);if(p.delete("problem_images",{problem_id:e,type:"yf_send_back"}),!s.a.isEmpty(a)){var _=1,f=["id","problem_id","business_id","batch_unit_id","type","img_localpath","sort"];s.a.each(a,(function(t){t.id=r["a"].uuid(),t.problem_id=e,t.business_id=h||"",t.batch_unit_id=d.batch_unit_id,t.type="yf_send_back",t.sort=_;var o=n["a"].getColumnsValues(t,f);p.insert("problem_images",f,o),_++}))}c["a"].deleteDataIncrement(p,i,"问题","passed",e),c["a"].deleteDataIncrement(p,i,"问题","repair_passed",e),c["a"].insertDataIncrement(p,i,"问题",m,e,d.batch_unit_id,t,d.batch_id)}))})).then((function(){window.uploadStatus("waitUpload")}))}))},f=function(e){var t,o;return e&&e.problem_id?n["a"].transaction((function(n){n.update("checkroom_problem",{status:"非正常关闭",close_date:r["a"].getNowDate()},{id:e.problem_id},(function(t){if(!t.rowsAffected)throw console.error("abnormalCloseProblem: 未更新问题。id="+e.problem_id),new Error("未更新问题")})),t={problem_id:e.problem_id,batch_unit_id:e.batch_unit_id,operate_type:"非正常关闭",operate_reason:e.close_reason},l["a"].insert(t,n),o={type:"问题",operation:"abnormal_closed",relation_id:e.problem_id,batch_unit_id:e.batch_unit_id,batch_room_id:e.batch_room_id,batch_id:e.batch_id},c["a"].insert(n,o)})).then((function(){window.uploadStatus("waitUpload")})):(console.error("abnormalCloseProblem: problem或problem_id为空"),i["a"].reject("problem或problem_id为空"))},b=function(e,t,o){return w(e).then((function(n){if(!n)throw new Error("未找到batch_room_id相关数据");var i={id:e,batch_unit_id:n.batch_unit_id,batch_room_id:t,batch_id:n.batch_id,status:n.status};return g(i,null,o)}))},g=function(e,t,o){o=o||[];var i=function(t){var i=r["a"].getNowDate(),a="已整改"===e.status?"repair_passed":"passed";t.update("checkroom_problem",{status:"已通过",review_date:i},{id:e.id});var d=l["a"].insert({problem_id:e.id,batch_unit_id:e.batch_unit_id,operate_type:"通过"},t);if(t.delete("problem_images",{problem_id:e.id,type:"review"}),!s.a.isEmpty(o)){var u=1,m=["id","problem_id","business_id","batch_unit_id","type","img_localpath","sort"];s.a.each(o,(function(o){o.id=r["a"].uuid(),o.problem_id=e.id,o.business_id=d||"",o.batch_unit_id=e.batch_unit_id,o.type="review",o.sort=u;var i=n["a"].getColumnsValues(o,m);t.insert("problem_images",m,i),u++}))}c["a"].insert(t,{type:"问题",operation:a,relation_id:e.id,batch_unit_id:e.batch_unit_id,batch_room_id:e.batch_room_id,batch_id:e.batch_id})};return t?i(t):n["a"].transaction((function(e){i(e)})).then((function(){window.uploadStatus("waitUpload")}))},y=function(e,t){var o=function(t){t.update("checkroom_problem",{status:"待派单",review_date:null},{id:e}),l["a"].deleteByProblemId(e,"通过",t),c["a"].deleteDataIncrement(t,{rowsAffected:!0},"问题","passed",e)};return t?o(t):n["a"].transaction((function(e){o(e)}))},v=function(e,t,o){var i=r["a"].getNowDate();return k(t).then((function(r){if(!r||!r.length)throw new Error("未找到batch_room_id相关数据");return n["a"].transaction((function(n){n.update("checkroom_problem",{status:"已作废",invalid_date:i,review_date:null,is_passed_when_add:0},{id:e},(function(i){var a={},s=r[0];a.batch_unit_id=s.batch_unit_id,a.batch_id=s.batch_id,a.proj_id=s.project_id,a.building_id=s.building_id,a.room_id=s.room_id,l["a"].insert({problem_id:e,batch_unit_id:a.batch_unit_id,operate_type:"作废",operate_reason:o},n),c["a"].deleteDataIncrement(n,i,"问题","add",e),c["a"].deleteDataIncrement(n,i,"问题","passed",e),c["a"].insertDataIncrement(n,i,"问题","cancelled",e,a.batch_unit_id,t,a.batch_id)}))})).then((function(){window.uploadStatus("waitUpload")}))}))},k=function(e){var t=" select cb.project_id,br.batch_id,cb.type,br.batch_unit_id,br.room_id,br.building_id from batch_room br inner join checkroom_batch cb on cb.batch_id = br.batch_id where br.id = ?";return n["a"].query(t,[e])},w=function(e){var t="select cp.status, cb.project_id,br.batch_id,cb.type,br.batch_unit_id,br.room_id,br.building_id from checkroom_problem cp  inner join batch_room br on br.id = cp.batch_room_id  inner join checkroom_batch cb on cb.batch_id = br.batch_id where cp.id = ?";return n["a"].queryOne(t,[e])},x=function(e){var t=" select status,count(*)icount from checkroom_problem where batch_room_id = ? group by status ";return n["a"].query(t,[e])},I=function(e){return n["a"].queryOne("select cp.status, cp.coordinate, cp.batch_room_id, cp.roomtype_diagram_id, ryd.name as diagram_name from checkroom_problem cp inner join room_type_diagram ryd on ryd.id =  cp.roomtype_diagram_id where cp.id = ?",[e])},L=function(e){return n["a"].delete("problem_images",{id:e})},R={getProblemList:d,getProblemParams:k,getProblemInfo:p,isLocal:h,backProblem:_,cancelProblem:v,passProblem:b,passProblemExec:g,unDoPassProblemExecByEdit:y,abnormalCloseProblem:f,getProblemCountByBatchRoomId:x,getProblemListForSpecialCheckDiagram:u,getProblemPositionPointInfo:I,deleteProblemImage:L,getProblemListByBatchUnitId:function(e){var t=" select distinct cp.batch_room_id,cp.status,  case when cp.status = '待派单' or cp.status = '待指派' or cp.status = '待整改' then 1 when cp.status = '已整改' then 0 when cp.status = '已通过' then 2 end sort  from checkroom_problem cp  inner join batch_room br on cp.batch_room_id = br.id  where cp.status not in ('已作废','非正常关闭')  and br.batch_unit_id = ?  order by sort";return n["a"].query(t,[e])},getAllProblemListByPage:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;t*=o;var i="select distinct cp.id, cp.code, cp.status,case cp.status when '待整改' then date(cp.repair_deadline) when '已整改' then date(cp.repair_date) when '已通过' then date(cp.review_date) when '已作废' then date(cp.invalid_date) when '已关闭' then date(cp.close_date) when '待派单' then date(cp.regist_date) else '' end as deal_time, br.floor, br.room_no, p.name as position, ci.full_name as item, cp.desc_id, c.name as contractor,cp.roomtype_diagram_id, cp.sent_back_time, cp.emergency_degree, cp.batch_room_id,cp.batch_unit_id,ifnull(u.name,'') as regist_user_name  from checkroom_problem cp  inner join batch_room br on cp.batch_room_id = br.id  inner join building_floor bf on bf.building_id=cp.building_id and bf.floor=br.floor  inner join position p on p.id = cp.position_id inner join check_item ci on ci.id = cp.item_id left join user u on u.id = cp.regist_user_id left join contractor c on c.id = cp.contractor_id left join check_item_desc cid on cid.id = cp.desc_id where "+e+" order by bf.sort desc, br.room_no, p.sort, ci.sort, cid.sort limit "+t+","+o;return n["a"].query(i)},getSelectedProblems:function(e){var t="select distinct cp.id, cp.batch_room_id as batchRoomId  from checkroom_problem cp  inner join batch_room br on cp.batch_room_id = br.id  inner join check_item ci on ci.id = cp.item_id left join user u on u.id = cp.regist_user_id where "+e;return n["a"].query(t)},getCountOfProblemStatus:function(e){var t='select r.status as name, r.status as value, count(1) as count,case r.status when "待派单" then 1 when "待整改" then 2 when "已整改" then 3 when "已通过" then 4 when "已作废" then 5 else 6 end sort from (select cp.status from checkroom_problem cp  inner join batch_room br on br.id = cp.batch_room_id  inner join user u on u.id = cp.regist_user_id inner join check_item ci on ci.id = cp.item_id  where '+e+") r group by status order by sort";return n["a"].query(t)},getCountOfCheckItem:function(e){var t="select r.name as name, r.id as value, count(1) as count from  (select ci.id, ci.full_name as name from checkroom_problem cp  inner join batch_room br on br.id = cp.batch_room_id  inner join user u on u.id = cp.regist_user_id inner join check_item ci on ci.id = cp.item_id  where "+e+") r group by id order by name";return n["a"].query(t)},getCountOfFloor:function(e){var t="select r.floor as name, r.floor as value,sort, count(1) as count from  (select br.floor,bf.sort from checkroom_problem cp  inner join batch_room br on br.id = cp.batch_room_id  inner join building_floor bf on bf.building_id=cp.building_id and bf.floor=br.floor inner join user u on u.id = cp.regist_user_id inner join check_item ci on ci.id = cp.item_id  where "+e+") r group by floor order by sort desc";return n["a"].query(t)},getCountOfRegister:function(e){var t="select r.name as name, r.id as value, count(1) as count from  (select u.id, u.name from checkroom_problem cp  inner join batch_room br on br.id = cp.batch_room_id  inner join user u on u.id = cp.regist_user_id inner join check_item ci on ci.id = cp.item_id  where "+e+") r group by id order by name";return n["a"].query(t)},getListInfoById:function(e){var t="select cp.id, cp.code, cp.status,case cp.status when '待整改' then date(cp.repair_deadline) when '已整改' then date(cp.repair_date) when '已通过' then date(cp.review_date) when '已作废' then date(cp.invalid_date) when '已关闭' then date(cp.close_date) else '' end as deal_time, br.floor,  br.room_no, p.name as position, ci.full_name as item, cp.desc_id, c.name as contractor,cp.roomtype_diagram_id, cp.sent_back_time, cp.emergency_degree, cp.batch_room_id,cp.batch_unit_id,ifnull(u.name,'') as regist_user_name  from checkroom_problem cp  inner join batch_room br on cp.batch_room_id = br.id  inner join building_floor bf on bf.building_id=cp.building_id and bf.floor=br.floor  inner join position p on p.id = cp.position_id inner join check_item ci on ci.id = cp.item_id left join user u on u.id = cp.regist_user_id left join contractor c on c.id = cp.contractor_id left join check_item_desc cid on cid.id = cp.desc_id where cp.id = ?";return n["a"].queryOne(t,[e])},getProblemIdWithoutImageUrl:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o="",i=[e];t&&(o+=" and di.batch_room_id = ?",i.push(t));var r="select di.relation_id         from problem_images pi         inner join data_increment di on di.relation_id = pi.problem_id         WHERE di.batch_unit_id = ? AND di.type = '问题' AND di.operation ='add'         and ifnull(pi.img_localpath, '') <> ''         and (ifnull(pi.img_url, '') = '') "+o;return n["a"].queryColumn(r,i,"relation_id")}};t["a"]=R},af4c:function(e,t,o){"use strict";o("e697");var n=o("fd50"),i=o("a18c"),r=o("99ee"),a=o("43ee"),s=o("a14a"),c=o.n(s),l=o("c6e3"),d=function(){return{getNotCheckFloorAndRoom:function(e,t){return n["a"].all([l["a"].getTodoUnitFloors(e),l["a"].getTodoRoomByUnitId(e,t)]).then((function(e){var t,o=e[0],n=e[1],i="0";(c.a.isEmpty(o)||1===o.length&&""===o[0].floor)&&(t=!0,o=[{floor:i}]);for(var r=0;r<o.length;r++){o[r].roomList=[];for(var a=0;a<n.length;a++)(t||n[a].floor===o[r].floor)&&(n[a].floor=t?i:n[a].floor,o[r].roomList.push(n[a]))}return c.a.filter(o,(function(e){return e.roomList&&e.roomList.length>0}))}))},checkHasUpload:function(e,t){return l["a"].checkHasUpload(e,t).then((function(e){return e&&!!e["id"]}))},getRoomInfo:function(e,t){return l["a"].getTodoBatchRoomById(e,t)}}},u=d(),m=function(){var e={floorList:[]},t={},o={special_checkitem:"检查",simulate:"检查",opening:"接待",online_opening:"拍摄",feedback_remain_reply:"回复",delivery:"交付",online_delivery:"交付",problem_remain_reinspect:"复验"};return t.init=function(o,i,r){return r=r||!1,r||o!==e.batchUnitId||i!==e.moduleType?(e.floorList=[],e.batchUnitId=o,e.moduleType=i,e.currRoom=null,e.currFloor=null,e.tip="",t.getRoomList().then((function(t){console.log(t,"floorlist-----"),e.floorList=t}))):n["a"].resolve()},t.getRoomList=function(){return"problem_remain_reinspect"===e.moduleType?t.getReinspectRoomList():"feedback_remain_reply"===e.moduleType?t.getReplyRoomList():t.getCheckRoomList()},t.getCheckRoomList=function(){return u.getNotCheckFloorAndRoom(e.batchUnitId,e.moduleType).then((function(t){return c.a.isEmpty(t)&&u.checkHasUpload(e.batchUnitId,e.moduleType).then((function(t){t&&(e.tip="您已经"+o[e.moduleType]+"完毕，请立即上传~")})),t}))},t.getReinspectRoomList=function(){return r["a"].initRoomList(e.batchUnitId).then((function(){return c.a.isEmpty(r["a"].model.list)&&r["a"].checkHasUpload(e.batchUnitId).then((function(t){t&&(e.tip="您已经"+o[e.moduleType]+"完毕，请立即上传~")})),r["a"].model.list}))},t.getReplyRoomList=function(){return a["a"].initRoomList(e.batchUnitId).then((function(){return c.a.isEmpty(a["a"].model.list)&&a["a"].checkHasUpload(e.batchUnitId).then((function(t){t&&(e.tip="您已经"+o[e.moduleType]+"完毕，请立即上传~")})),a["a"].model.list}))},t.getRoomInfo=function(e,t){return u.getRoomInfo(e,t)},t.removeRoom=function(){var o=c.a.find(e.currFloor.roomList,{id:e.currRoom.id}),n=c.a.indexOf(e.currFloor.roomList,o);n>-1&&e.currFloor.roomList.splice(n,1),c.a.isEmpty(e.currFloor.roomList)&&(n=c.a.indexOf(e.floorList,e.currFloor),n>-1&&e.floorList.splice(n,1)),c.a.isEmpty(e.floorList)&&(t.init(e.batchUnitId,e.moduleType,!0),i["a"].go(-2))},{model:e,init:t.init,updateRoomList:function(i){return c.a.isEmpty(e)||!e.moduleType?n["a"].resolve():(i=i||!1,i?t.removeRoom():"problem_remain_reinspect"===e.moduleType?r["a"].refresh().then((function(){c.a.isEmpty(r["a"].model.list)&&r["a"].checkHasUpload(e.batchUnitId).then((function(t){t&&(e.tip="您已经"+o[e.moduleType]+"完毕，请立即上传~")})),e.floorList=r["a"].model.list})):"feedback_remain_reply"!==e.moduleType?t.getRoomInfo(e.currRoom.id,e.moduleType).then((function(o){if(c.a.isEmpty(o)||"已检查"===o.check_status)return t.removeRoom();for(var n=e.currFloor.roomList.length,i=0;i<n;i++)if(e.currFloor.roomList[i].id===o.id){e.currFloor.roomList[i]=o;break}})):(c.a.isEmpty(a["a"].model.list)&&a["a"].checkHasUpload(e.batchUnitId).then((function(t){t&&(e.tip="您已经"+o[e.moduleType]+"完毕，请立即上传~")})),void(e.floorList=a["a"].model.list)))}}};t["a"]=m()},d49d:function(e,t,o){"use strict";var n=o("fd50"),i=o("4325"),r=o("a14a"),a=o.n(r),s=function(){var e={},t={position:i["a"].getPositionFilter,checkItem:i["a"].getCheckItemFilter};return e.getRoomList=function(e){return i["a"].getReplyRooms(e)},e.getFeedbackListByBatchRoomId=function(e,t,o){return e.batchRoomId?i["a"].getFeedbackListByBatchRoomId(e,t,o).then((function(e){return e})):n["a"].reject("获取问题列表失败")},e.getFeedbackFilters=function(e,o){if(!e.batchRoomId)return n["a"].reject();var i=a.a.cloneDeep(t),r=[];return delete i[o],e.position||delete i.checkItem,a.a.each(i,(function(o,n){r.push(function(o){return t[n](e).then((function(e){return{type:o,options:e}}))}(n))})),n["a"].all(r).then((function(e){var t={};return a.a.each(e,(function(e){var o=0;a.a.each(e.options,(function(e){o+=e.count})),e.options.unshift({name:"全部",count:o,id:""}),t[e.type]=e.options})),t}))},e.hasMoreFeedback=function(e){return i["a"].getFeedbackCount(e).then((function(e){return e.count>0}))},e.getAllFeedbackIds=function(e){return i["a"].getAllFeedbackIds(e).then((function(e){return e}))},e.checkHasUpload=function(e){return i["a"].hasUploadData(e).then((function(e){return e&&!!e["id"]}))},e};t["a"]=s()},fa1b:function(e,t,o){"use strict";var n=o("1834");t["a"]={getCheckItemList:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=[e],a="select bc.item_id, ci.full_name as item_full_name  from batch_checkitem bc  inner join check_item ci on ci.id = bc.item_id  where bc.batch_id = ? ";if(a+=t?" and ci.is_for_rough = 1 ":" and ci.is_for_decorated = 1 ",o){var s=i?"project_position_checkitem":"position_checkitem";a+=" and bc.item_id in                     (select item_id from "+s+" where position_id = ? )",r.push(o)}return a+=" order by ci.sort ",n["a"].query(a,r)}}},ff29:function(e,t,o){"use strict";o("cc57"),o("e697"),o("9a33");var n=o("fd50"),i=o("4531"),r=o("760e"),a=o("a14a"),s=o.n(a),c=function(){var e={},t={position:i["a"].getPositionFilter,checkItem:i["a"].getCheckItemFilter,register:i["a"].getRegisterFilter};return e.getRoomList=function(e){return i["a"].getReinspectRooms(e)},e.getProblemListByBatchRoomId=function(e,t,o){return e.batchRoomId?i["a"].getProblemListByBatchRoomId(e,t,o).then((function(e){var t=[];return s.a.each(e,(function(e){e.desc=e.desc_id.split(";"),t=t.concat(e.desc)})),t=s.a.uniq(t),r["a"].getDescByIds(t).then((function(t){return s.a.each(e,(function(e){s.a.each(e.desc,(function(o,n){var i=s.a.find(t,{id:o});e.desc[n]=i?i.name:"无描述"})),e.desc=e.desc.join("；"),e.title=e.problem=e.position_name+"-"+e.item_name+"-"+e.desc+(e.remark?"；"+e.remark:"")})),e}))})):n["a"].reject("获取问题列表失败")},e.getProblemFilters=function(e,o){if(!e.batchRoomId)return n["a"].reject();var i=s.a.cloneDeep(t),r=[];return delete i[o],e.position||delete i.checkItem,s.a.each(i,(function(o,n){r.push(function(o){return t[n](e).then((function(e){return{type:o,options:e}}))}(n))})),n["a"].all(r).then((function(e){var t={};return s.a.each(e,(function(e){var o=0;s.a.each(e.options,(function(e){o+=e.count})),e.options.unshift({name:"全部",count:o,id:""}),t[e.type]=e.options})),t}))},e.hasMoreProblem=function(e){return i["a"].getProblemCount(e).then((function(e){return e.count>0}))},e.getAllProblemIds=function(e){return i["a"].getAllProblemIds(e).then((function(e){return e}))},e.checkHasUpload=function(e){return i["a"].hasUploadData(e).then((function(e){return e&&!!e["id"]}))},e};t["a"]=c()}}]);