(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-9047ea3a"],{"0a37":function(e,t,n){var r=n("1c4e");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=n("85cb").default;o("76d9ba51",r,!0,{})},"12c2":function(e,t,n){var r=n("25d8");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=n("85cb").default;o("23d7709f",r,!0,{})},"1c4e":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .tip[data-v-829243a6] {\n  width: 250px;\n  text-align: center;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n.zhkf .tip img[data-v-829243a6] {\n    width: 200px;\n}\n.zhkf .tip p[data-v-829243a6] {\n    color: #a0a0a0;\n    line-height: 20px;\n    font-size: 14px;\n    margin: 0 auto;\n    text-align: center;\n    margin-top: 3px;\n}\n",""])},2297:function(e,t,n){"use strict";var r={name:"ProblemBtn",props:{showCheckbox:{type:Boolean,default:!0},selectText:{type:String,default:""},actionText:{type:String,required:!0},isSelected:{type:Boolean,default:!1},acitonDisabled:{type:Boolean,default:!1},className:{type:String,default:""}},methods:{select:function(){this.$emit("select")},action:function(){this.$emit("action")}}},o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"problem-btn van-hairline--top",class:e.className},[e.showCheckbox?r("div",{staticClass:"btn-select-all",on:{click:e.select}},[r("img",{directives:[{name:"show",rawName:"v-show",value:e.isSelected,expression:"isSelected"}],attrs:{src:n("2985"),alt:"selected",width:"20",height:"20"}}),e._v(" "),r("img",{directives:[{name:"show",rawName:"v-show",value:!e.isSelected,expression:"!isSelected"}],attrs:{src:n("f97d"),alt:"select",width:"20",height:"20"}}),e._v(" "),r("span",[e._v(e._s(e.selectText))])]):e._e(),e._v(" "),r("div",{class:e.acitonDisabled?"btn-disabled btn-action":"btn-action",on:{click:e.action}},[e._v(e._s(e.actionText))])])},a=[],i=n("d082");function c(e){n("7740")}var s=!1,d=c,l="data-v-1c8fb56c",u=null,f=Object(i["a"])(r,o,a,s,d,l,u);t["a"]=f.exports},"25d8":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .isIos[data-v-385f1ae6] {\n  padding-top: 20px;\n}\n.zhkf .search-form[data-v-385f1ae6] {\n  background: -webkit-gradient(linear, left top, right top, from(#1cb0fd), to(#0099ff));\n  background: linear-gradient(90deg, #1cb0fd 0%, #0099ff 100%);\n}\n.zhkf .contractor-select[data-v-385f1ae6] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .icon-chazhao[data-v-385f1ae6] {\n  color: #bbbbbb;\n  font-size: 14px;\n}\n.zhkf .select-content[data-v-385f1ae6] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .select-content .van-search[data-v-385f1ae6] {\n    background-color: #f4f4f4 !important;\n}\n.zhkf .select-content .van-search .van-search__content[data-v-385f1ae6] {\n      background-color: #ffffff;\n      border-radius: 4px;\n}\n.zhkf .item-list[data-v-385f1ae6] {\n  overflow: scroll;\n}\n.zhkf .search-form[data-v-385f1ae6] {\n  z-index: 99;\n}\n.zhkf .search-form[data-v-385f1ae6] .van-field__control {\n    color: #202020 !important;\n}\n.zhkf .tipBox[data-v-385f1ae6] {\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  width: 100%;\n  height: 100%;\n  background: #fff;\n}\n.zhkf .ios .search .van-search[data-v-385f1ae6] {\n  padding-top: 25px;\n}\n.zhkf .search[data-v-385f1ae6] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .search .van-cell[data-v-385f1ae6]:not(:last-child)::after {\n    left: 15px;\n}\n.zhkf .search .van-search[data-v-385f1ae6] {\n    background: none !important;\n}\n.zhkf .search .van-search__action[data-v-385f1ae6]:active {\n    background: none !important;\n}\n.zhkf .icon-chazhao[data-v-385f1ae6] {\n  color: #bbbbbb;\n  font-size: 14px;\n}\n.zhkf .icon-CombinedShapeCopy[data-v-385f1ae6] {\n  color: #bbbbbb;\n  font-size: 14px;\n}\n.zhkf .clear-history[data-v-385f1ae6] {\n  text-align: center;\n  font-size: 14px;\n  color: #a0a0a0;\n  padding: 15px 0;\n}\n.zhkf .result[data-v-385f1ae6],\n.zhkf .history[data-v-385f1ae6] {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  overflow: scroll;\n}\n.zhkf .result-block[data-v-385f1ae6] {\n  margin-bottom: 10px;\n}\n.zhkf .result-block h2[data-v-385f1ae6] {\n    color: #a0a0a0;\n    font-size: 14px;\n    line-height: 36px;\n    padding-left: 15px;\n    font-weight: 400;\n    margin: 0;\n    background: #fff;\n}\n.zhkf .footer[data-v-385f1ae6] {\n  position: absolute;\n  bottom: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n  width: 100%;\n}\n.zhkf .active[data-v-385f1ae6] {\n  color: #0085ff;\n}\n",""])},"26eb":function(e,t,n){e.exports=n.p+"img/search.37f508c9.png"},"271b":function(e,t,n){"use strict";n("6d57");var r=n("fd50"),o=n("07a4"),a=(n("cc57"),n("e697"),n("9a33"),n("bc35")),i=n("760e"),c=n("a14a"),s=n.n(c),d={},l={checkItem:a["a"].getCheckItemFilter,building:a["a"].getBuildingFilter,batch:a["a"].getBatchFilter};d.getProblemByPage=function(e,t,n){return e=e||{},t=t||0,a["a"].getProblemByPage(e,t,n).then((function(e){var t=[],n=[];return s.a.each(e,(function(e){e.roomName=e.buildingName+(e.unit?e.unit+(e.unit.indexOf("单元")>-1?"":"单元"):"")+e.roomNo,e.desc=e.descId.split(";"),t=t.concat(e.desc),n.push(e.id)})),t=s.a.uniq(t),r["a"].all([a["a"].getProblemSendBackDate(n),i["a"].getDescByIds(t)]).then((function(t){var n=t[0],r=t[1];return s.a.each(e,(function(e){var t=s.a.find(n,{problem_id:e.id});console.log(t),t&&(e.sendbackDate=t.time||""),s.a.each(e.desc,(function(t,n){var o=s.a.find(r,{id:t});e.desc[n]=o?o.name:"无描述"})),e.desc=e.desc.join("；"),e.problem=e.problem=e.positionName+"-"+e.itemName+"-"+e.desc+(e.remark?"；"+e.remark:"")})),e}))}))},d.getFilters=function(e,t){var n=[],o=s.a.cloneDeep(l);return delete o[t],e.project||(delete o.checkItem,delete o.building,delete o.batch),s.a.each(o,(function(t,r){n.push(function(t){return l[r](e).then((function(e){return{type:t,options:e}}))}(r))})),r["a"].all(n).then((function(e){var t={};return s.a.each(e,(function(e){var n=0;s.a.each(e.options,(function(e){n+=e.count})),e.options.unshift({name:"全部",count:n,id:""}),t[e.type]=e.options})),t}))},d.getAllProblemAndUnitIds=function(e){return a["a"].getAllProblemAndUnitIds(e)},d.getProjectList=function(){return a["a"].getProjects()};var u=d,f=n("a18c"),h=n("a593");t["a"]=function(){var e={list:[],filterList:[],currPage:0,totalPage:0,allSelected:!1},t={},n=20;return t.getConditions=function(){var t={};return _.each(e.filterList,(function(e){e.id&&(t[e.type]=e.id)})),t["project"]=o["a"].state.projectList.currentItem.id,t},t.getFilter=function(r){var o=t.getConditions(),a=[];return!o[r]&&(r=""),u.getFilters(o,r).then((function(t){if(_.each(e.filterList,(function(n,r){var o=e.filterList[r].value||"";if(n&&t[n.type]){var i=_.filter(t[n.type],{id:o});i&&i[0]&&a.push(i[0].count),e.filterList[r].options=t[n.type]}})),a.length){var r=Math.min.apply(null,a);e.totalPage=Math.ceil(r/n)}}))},t.getProblemList=function(){var r=t.getConditions(),o=e.currPage*n;return u.getProblemByPage(r,o,n).then((function(t){e.list=e.currPage?e.list.concat(t):t,e.list.length&&e.currPage++}))},t.resetProblemList=function(){return e.currProjectId="",e.filterList.forEach((function(e){e.id="",e.name=""})),t.getProblemList()},{model:e,init:function(){return e.list=[],e.filterList=[{id:"",name:"",label:"批次",type:"batch",options:[]},{id:"",name:"",label:"楼栋",type:"building",options:[]},{id:"",name:"",label:"检查项",type:"checkItem",options:[]}],e.currPage=0,e.totalPage=0,e.allSelected=!1,e.currProjectId=o["a"].state.projectList.currentItem.id,t.getProblemList().then((function(){return t.getFilter()}))},loadMore:function(){return e.currPage<e.totalPage?t.getProblemList():r["a"].resolve()},refreshList:function(n){return e.currPage=0,e.totalPage=0,e.allSelected=!1,t.getProblemList().then((function(){var o=r["a"].when();return e.list.length||(n="",o=t.resetProblemList()),o.then((function(){return t.getFilter(n).then((function(){e.filterList[0].id||e.filterList[0].options[0].count||(h["default"].prototype.$toast("恭喜！您已完成所有问题的指派",2e3),f["a"].push({path:"/todo"}))}))}))}))},getSelecteds:function(){var n=[],o=r["a"].defer();if(e.allSelected){var a=t.getConditions();u.getAllProblemAndUnitIds(a).then((function(e){o.resolve(e)}))}else _.each(e.list,(function(e){e.selected&&n.push({problemId:e.id,batchUnitId:e.batch_unit_id})})),o.resolve(n);return o.promise}}}()},2985:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAADIklEQVRYR82ZTUhUURTHf3fKUqKkD0r7wEVQEUVCH7oSggiskMASF0EQlBW2DHQRDLQw2irZuAiKIFIXFVhIC4kKgmqlVBYuAnO0JkSMcpj0xvXN0+eb92beffMm3lsNc+/5nx/3cM85916Bny8qI5RzEDiMYD+SnUA5sDotNw3EEQwjeQ8MEOctUTGn605oGdyVW5ihGTgDbNWyhVHgPsV0cFZ882rrDbBDrqeI68A5YKVXcZd5SeAOKa7RLH7m0soN2CUbkbQDG3KJaY4niNDMefEwm507YFQuZzPtSC5qOtabLrjNGFeIir9Ohs6A3bKESXqA43refM/uYy2naRB/7AqZgGrlynn0H+FMpj7inLSvZCZgl+wseFjdFlqF+4K4ZB1eCmhsiAe+AxWEYYRG68ZZBDRSyacC7FZd7AQpdpkpaBEwJm8BS5ZXVznA+Z00ictKzwA0KsRIAEnYE+OaIrhZBXvXQewj3PuSYZakmO2q4hiAMdkGtHhSz3NS6QroPwZVGw2hWQm7u+HzVIbwDZpEq8Ao/F991FZtVDucKVDzBF6OZ8iNEqdCEJNVwBttb5oGbnADY3CkD+ako2C1AlShVSEu2OcG92ocap/Br5Sr61YF2AvUu03Ztgq+z0By1h9/HnBqC/cqwEFgj919RMDjo3CiAiZ+Q/1zeD2hB5kXnOFqSAH+cErONWXwom4RaDoFtU+9QwYAp5wnFOCMU/7bUQofGmCZpRh6hQwITgEmXQHV6NV9RkK1frkgA4RbAHQMsQnVUglth7xBBgy3EGLHTWJF8gJZADiFMCjokj1ITuXan9kghyaXli9Ty0Oey+42nWY8J2o3yJEpqLQdqfKGM9DnE7VWqXOCtC9DQHBKttpXs5ANMkC4dLOgOH20W06QAcIpqnS7pX76bFhVnlQpSCVz1ZXU9Wct/Ln2oXXc1rAaq+ir5VcVZ1OJUQJdWiYdMHOureVXf4f+0KQgQ33sNBc31Ad3BRn6qw8FGerLIzPUob5+syaG0F5gWiFDfQVsBQ3tJbq9FlifIeAAzD9DlNmeIdRdwTDwLp9niH+Lfm97gO/iCQAAAABJRU5ErkJggg=="},3473:function(e,t,n){"use strict";n("6d57");var r=n("fd50"),o=(n("cc57"),n("e697"),n("9a33"),n("ba61")),a=n("760e"),i={},c={building:o["a"].getBuildingFilter,checkItem:o["a"].getCheckItemFilter,batch:o["a"].getBatchFilter};i.getProblemByPage=function(e,t,n){return e=e||{},t=t||0,o["a"].getProblemByPage(e,t,n).then((function(e){var t=[];return _.each(e,(function(e){e.roomName=e.buildingName+(e.unit?e.unit+(e.unit.indexOf("单元")>-1?"":"单元"):"")+e.roomNo,e.desc=e.descId.split(";"),t=t.concat(e.desc)})),t=_.uniq(t),a["a"].getDescByIds(t).then((function(t){return _.each(e,(function(e){_.each(e.desc,(function(n,r){var o=_.find(t,{id:n});e.desc[r]=o?o.name:"无描述"})),e.desc=e.desc.join("；"),e.problem=e.positionName+"-"+e.itemName+"-"+e.desc+(e.remark?"；"+e.remark:"")})),e}))}))},i.getFilters=function(e,t){var n=[],o=_.cloneDeep(c);return delete o[t],e.project||(delete o.building,delete o.checkItem,delete o.batch),_.each(o,(function(t,r){n.push(function(t){return c[r](e).then((function(e){return{type:t,options:e}}))}(r))})),r["a"].all(n).then((function(e){var t={};return _.each(e,(function(e){var n=0;_.each(e.options,(function(e){n+=e.count})),e.options.unshift({name:"全部",count:n,id:""}),t[e.type]=e.options})),t}))},i.getAllProblemAndUnitIds=function(e){return o["a"].getAllProblemAndUnitIds(e)},i.getProjectList=function(){return o["a"].getProjects()};var s=i,d=n("07a4"),l=n("a593"),u=n("a18c");function f(){var e={list:[],filterList:[],currPage:0,totalPage:0,allSelected:!1},t={},n=20;return t.getConditions=function(){var t={};return _.each(e.filterList,(function(e){e.id&&(t[e.type]=e.id)})),t["project"]=d["a"].state.projectList.currentItem.id,t},t.getFilter=function(r){var o=t.getConditions(),a=[];return!o[r]&&(r=""),s.getFilters(o,r).then((function(t){if(_.each(e.filterList,(function(n,r){var o=e.filterList[r].value||"";if(n&&t[n.type]){var i=_.filter(t[n.type],{id:o});i&&i[0]&&a.push(i[0].count),e.filterList[r].options=t[n.type]}})),a.length){var r=Math.min.apply(null,a);e.totalPage=Math.ceil(r/n)}}))},t.getProblemList=function(){var r=t.getConditions(),o=e.currPage*n;return s.getProblemByPage(r,o,n).then((function(t){e.list=e.currPage?e.list.concat(t):t,e.list.length&&e.currPage++}))},t.resetProblemList=function(){return e.currProjectId="",e.filterList.forEach((function(e){e.id="",e.name=""})),t.getProblemList()},{model:e,init:function(){return e.list=[],e.filterList=[{id:"",name:"",label:"批次",type:"batch",options:[]},{id:"",name:"",label:"楼栋",type:"building",options:[]},{id:"",name:"",label:"检查项",type:"checkItem",options:[]}],e.currPage=0,e.totalPage=0,e.allSelected=!1,e.currProjectId=d["a"].state.projectList.currentItem.id,t.getProblemList().then((function(){return t.getFilter()}))},loadMore:function(){return e.currPage<e.totalPage?t.getProblemList():r["a"].resolve()},refreshList:function(n){return e.currPage=0,e.totalPage=0,e.allSelected=!1,t.getProblemList().then((function(){var o=r["a"].when();return e.list.length||(n="",o=t.resetProblemList()),o.then((function(){return t.getFilter(n).then((function(){e.filterList[0].id||e.filterList[0].options[0].count||(l["default"].prototype.$toast("恭喜！您已完成所有问题的指派",2e3),u["a"].push("/todo"))}))}))}))},getSelecteds:function(){var n=[],o=r["a"].defer();if(e.allSelected){var a=t.getConditions();s.getAllProblemAndUnitIds(a).then((function(e){o.resolve(e)}))}else _.each(e.list,(function(e){e.selected&&n.push({problemId:e.id,batchUnitId:e.batch_unit_id})})),o.resolve(n);return o.promise}}}t["a"]=f()},"41d4":function(e,t,n){"use strict";n.r(t);n("5ab2"),n("e44b"),n("e10e"),n("f548"),n("9dd9"),n("ed63"),n("8cf2"),n("6d57");var r=n("28f8"),o=n("f2de"),a=n("5cf9"),i=n("c42d"),c=n("92fb"),s=n("3473"),d=n("271b"),l=n("2297"),u=n("a14a"),f=n.n(u);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=null,m=!1,b="",_={name:"TodoContractorSelect",components:{tip:a["a"],problemBtn:l["a"]},data:function(){return{tipCont:"输入关键字进行搜索",searchMode:!1,searchLoading:!1,loading:!1,contractors:[],searchResult:[],currItemId:-1,searchNodata:!1,keyword:"",notSendBackShow:!1,notSendBack:!1}},computed:p({},Object(o["e"])({currentBatchType:function(e){return e.app.global.currentBatchType},currentMenuType:function(e){return e.app.global.currentMenuType},isIOS:function(e){return e.app.global.isIOS},contentHeight:function(e){return e.app.global.contentHeight},footerHeight:function(e){return e.app.global.footerHeight}})),watch:{keyword:function(e){this.doSearch()}},created:function(){this.init()},methods:{init:function(){var e=this;return this.tipCont="输入关键字进行搜索!",g=c["a"].model,"todo-dispatch"===g.from?this.notSendBackShow=!1:"todo-sendback"===g.from&&(this.notSendBackShow=!0),c["a"].init("").then((function(){e.contractors=g.list}))},changeSendBackStatus:function(){this.notSendBack=!this.notSendBack,console.log("changeSendBackStatus",this.notSendBack),c["a"].setForbidContractorReturn(this.notSendBack?1:0)},changeToSearchMode:function(){this.searchMode=!0;var e=this.$refs.searchInput.querySelector('input[type="search"]');console.log(e),setTimeout((function(){e.focus()}),300)},changeToListMode:function(){this.searchMode=!1},select:function(e){this.currItemId=e.contractor_id,c["a"].setSelectedConstructionId(this.currItemId)},doSearch:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(t&&(this.keyword=t),""===f.a.trim(this.keyword))return this.clearInput(),void(this.tipCont="输入关键字进行搜索");m||this.keyword!=b&&(b=this.keyword,m=!0,this.searchLoading=!0,this.searchResult=[],c["a"].getList(this.keyword).then((function(){m=!1,e.searchLoading=!1,""!==e.keyword?g.list.length?(e.searchNodata=!1,e.searchResult=f.a.cloneDeep(g.list),e.searchResult.forEach((function(t){if(t.contractor_name.toLowerCase().includes(e.keyword.toLowerCase())){var n=new RegExp(e.keyword,"ig");t.contractor_name=t.contractor_name.replace(n,(function(){return'<span class="color-blue">'+arguments[0]+"</span>"}))}})),console.log("承建商=======",e.searchResult)):(e.searchWord=e.keyword,e.searchNodata=!0,e.searchResult=[],e.tipCont='抱歉没有找到与“<span style="color:#0099FF;">'+e.searchWord+"</span>”相关的结果"):b=""})).catch((function(t){console.error(t),m=!1,e.searchLoading=!1})))},clearInput:function(){this.keyword="",m=!1,b="",this.searchNodata=!1,this.searchLoading=!1,this.searchResult=[],this.tipCont="输入关键字进行搜索!"},submit:function(){var e=this;return-1===this.currItemId?this.$toast("请选一个承建商"):(c["a"].setForbidContractorReturn(this.notSendBack?1:0),i["a"].getHasNetwork().then((function(t){if(!t)return e.$toast("当前网络异常，请稍后重试",1500),!1;e.$toast.loading({mask:!0,message:"指派中...",duration:0}),c["a"].changeConstruction().then((function(t){if(e.$toast.clear(),t){if(e.$toast("承建商指派成功",1e3),e.$router.go(-1),"todo-dispatch"===g.from)return s["a"].refreshList();if("todo-sendback"===g.from)return d["a"].refreshList()}})).catch((function(t){return console.error(t),e.$toast.clear(),e.$toast("指派承建商失败，请稍后重试",1500),e.$router.go(-1),$q.reject(t)}))})))}}},v=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"contractor-select"},[r("div",{directives:[{name:"show",rawName:"v-show",value:!e.searchMode,expression:"!searchMode"}],staticClass:"select-content"},[r("cus-nav-bar",{attrs:{title:"选择承建商","left-arrow":"",border:!1}}),e._v(" "),r("div",{on:{click:e.changeToSearchMode}},[r("van-search",{attrs:{placeholder:"搜索承建商",disabled:!0}},[r("i",{staticClass:"iconfont icon-chazhao",attrs:{slot:"left-icon"},slot:"left-icon"})])],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&e.contractors.length,expression:"!loading && contractors.length"}],staticClass:"item-list",style:{height:e.contentHeight-e.footerHeight-49+"px"}},e._l(e.contractors,(function(t,n){return r("van-cell",{key:n,class:{active:t.contractor_id===e.currItemId},attrs:{title:t.contractor_name},on:{click:function(n){return e.select(t)}}},[t.contractor_id===e.currItemId?r("template",{slot:"right-icon"},[r("i",{staticClass:"iconfont icon-gou"})]):e._e()],2)})),1),e._v(" "),e.loading||e.contractors.length?e._e():r("div",{staticClass:"tipBox"},[r("tip",{attrs:{"img-url":n("26eb"),"tip-cont":"抱歉没有找到承建商！"}})],1)],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.searchMode,expression:"searchMode"}],staticClass:"search"},[r("form",{staticClass:"search-form",class:{isIos:e.isIOS},attrs:{action:"/"}},[r("van-search",{ref:"searchInput",attrs:{placeholder:"搜索承建商","show-action":"",background:"linear-gradient(90deg,rgba(28,176,253,1) 0%,rgba(0,153,255,1) 100%)"},on:{cancel:e.changeToListMode,search:e.doSearch,clear:e.clearInput},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[r("i",{staticClass:"iconfont icon-chazhao",attrs:{slot:"left-icon"},slot:"left-icon"})])],1),e._v(" "),r("section",{staticClass:"result"},[r("van-cell-group",e._l(e.searchResult,(function(t,n){return r("van-cell",{key:n,class:{active:t.contractor_id===e.currItemId},on:{click:function(n){return e.select(t)}}},[r("template",{slot:"title"},[r("span",{domProps:{innerHTML:e._s(t.contractor_name)}})]),e._v(" "),t.contractor_id===e.currItemId?r("template",{slot:"right-icon"},[r("i",{staticClass:"iconfont icon-gou"})]):e._e()],2)})),1)],1),e._v(" "),e.searchLoading||!e.searchNodata&&e.keyword?e._e():r("div",{staticClass:"tipBox"},[r("tip",{attrs:{"img-url":n("26eb"),"tip-cont":e.tipCont}})],1)]),e._v(" "),!e.searchMode||e.searchResult.length?r("problem-btn",{staticClass:"footer",attrs:{"select-text":"禁止承建商退回","show-checkbox":e.notSendBackShow,"action-text":"确认","is-selected":e.notSendBack},on:{select:e.changeSendBackStatus,action:e.submit}}):e._e()],1)},k=[],w=n("d082");function y(e){n("12c2")}var x=!1,A=y,C="data-v-385f1ae6",I=null,P=Object(w["a"])(_,v,k,x,A,C,I);t["default"]=P.exports},"5cf9":function(e,t,n){"use strict";var r={props:{isShow:{type:Boolean,default:!0},imgUrl:{type:String,required:!0},tipCont:{type:String,default:"系统繁忙请稍后重试"}}},o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticClass:"tip"},[n("img",{attrs:{src:e.imgUrl,alt:"tip"}}),e._v(" "),e.tipCont?n("p",{domProps:{innerHTML:e._s(e.tipCont)}}):e._e()])},a=[],i=n("d082");function c(e){n("0a37")}var s=!1,d=c,l="data-v-829243a6",u=null,f=Object(i["a"])(r,o,a,s,d,l,u);t["a"]=f.exports},"760e":function(e,t,n){"use strict";var r=n("1834"),o=function(e,t,n){var o="毛坯"===t?" and is_for_rough = 1 ":" and is_for_decorated = 1 ",a="select id, name, is_remark_required, sort from check_item_desc where check_item_id = ? "+o+" order by sort";return n&&(a="select desc.id, desc.name, desc.is_remark_required, desc.sort  from check_item_desc desc where check_item_id = ?"+o+" order by desc.sort"),r["a"].query(a,[e])},a=function(e,t){var n="毛坯"===t?" and is_for_rough = 1 ":" and is_for_decorated = 1 ",o="select desc.id, desc.name, desc.is_remark_required, desc.sort from check_item_desc desc left join desc_room_average_problem_num desc_num  on desc.id=desc_num.desc_id where check_item_id = ? "+n+" order by desc_num.num desc, desc.sort";return r["a"].query(o,[e])},i=function(e){var t="select distinct id.id,id.name from check_item_desc id inner join checkroom_problem cp on cp.item_id = id.check_item_id where cp.batch_room_id = ?";return r["a"].query(t,[e])};t["a"]={getRoomCheckListDescList:a,getCheckItemDescList:o,getDescByBathRoomId:i,getDescByIds:function(e){_.isArray(e)&&(e=e.join("','"));var t="select id,name,is_remark_required from check_item_desc where id in ('"+e+"')";return r["a"].query(t)},searchDesc:function(e,t){var n="select id,name,check_item_id as item_id from check_item_desc where check_item_id in ("+t+') and (lower(name) like "%" || ? || "%" or upper(name) like "%" || ? || "%") order by name';return r["a"].query(n,[e,e])}}},7740:function(e,t,n){var r=n("812a");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=n("85cb").default;o("75ab064a",r,!0,{})},"812a":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .problem-btn[data-v-1c8fb56c] {\n  height: 60px;\n  padding: 7px 11px;\n  line-height: 46px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  font-size: 16px;\n  background: #fff;\n}\n.zhkf .problem-btn .btn-select-all[data-v-1c8fb56c] {\n    background: #fff;\n    color: #909090;\n    padding: 0 20px;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n}\n.zhkf .problem-btn .btn-select-all img[data-v-1c8fb56c] {\n      margin: 12px 8px 0 0;\n}\n.zhkf .problem-btn .btn-action[data-v-1c8fb56c] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    background: -webkit-gradient(linear, right top, left top, from(#0085ff), to(#02b8ff));\n    background: linear-gradient(270deg, #0085ff 0%, #02b8ff 100%);\n    -webkit-box-shadow: 0px 2px 4px 0px rgba(0, 133, 255, 0.2);\n            box-shadow: 0px 2px 4px 0px rgba(0, 133, 255, 0.2);\n    color: #fff;\n    text-align: center;\n    border-radius: 23px;\n    -webkit-box-shadow: 0px 0px 4px 0px rgba(0, 0, 0, 0.08);\n            box-shadow: 0px 0px 4px 0px rgba(0, 0, 0, 0.08);\n}\n.zhkf .problem-btn .btn-disabled[data-v-1c8fb56c] {\n    background: rgba(0, 153, 255, 0.5);\n}\n",""])},"92fb":function(e,t,n){"use strict";n("6d57");var r=n("dd0a"),o=(n("ed63"),n("8cf2"),n("fd50")),a=n("0e79"),i={},c=1e3,s=0;i.formatUploadData=function(e,t,n){var r={problemIdList:[],batchUnitIdList:[],contractorId:t,forbidContractorReturn:n};return _.each(e,(function(e){r.problemIdList.push(e.problemId),_.includes(r.batchUnitIdList,e.batchUnitId)||r.batchUnitIdList.push(e.batchUnitId)})),r},i.uploadData=function(e,t,n){var r=o["a"].when(),d=0;s=e.length;var l=[];while(d<s){var u=s-d>c?c:s-d,f=i.formatUploadData(e.slice(d,d+u),t,n);d+=u,l.push(f)}return _.each(l,(function(e){r=r.then((function(){return Object(a["a"])(e)}))})),r.then((function(e){return console.log("指派承建商 then",e),Promise.resolve()})).catch((function(e){return console.error("指派承建商 catch",e),Promise.reject()}))};var d=i;t["a"]=function(){var e={list:[],selectedId:-1,operateType:"指派承建商",operateReason:"指派",problemId:[],problemData:[],from:"",forbidContractorReturn:0},t={getList:function(t){var n=e.problemId.length>0?e.problemId[0]:"";return r["a"].getProjectContractorList(n,t).then((function(t){e.list=t}))},setSelectedConstructionId:function(t){e.selectedId!==t&&(e.selectedId=t)},setData:function(n,r,o){_.isArray(n)||(n=[n]),e.problemData=n;var a=[];n.forEach((function(e){a.push(e.problemId)})),e.problemId!==a&&(e.problemId=a,t.getList("")),e.operateType!==r&&(e.operateType=r,"指派承建商"===e.operateType?e.operateReason="指派":"重新指派承建商"===e.operateType?e.operateReason="重新指派":e.operateReason=null),e.from=o},changeConstruction:function(){if(-1!==e.selectedId){var t=e.problemId;return d.uploadData(e.problemData,e.selectedId,e.forbidContractorReturn).then((function(){return r["a"].changeConstruction(t,e.selectedId,e.operateType,e.operateReason)}))}}};return{model:e,init:function(e){return t.getList(e)},getList:function(e){return t.getList(e)},setSelectedConstructionId:function(e){return t.setSelectedConstructionId(e)},setData:function(e,n,r){return r=r||"",t.setData(e,n,r)},setForbidContractorReturn:function(t){e.forbidContractorReturn!==t&&(e.forbidContractorReturn=t)},changeConstruction:function(){return t.changeConstruction()}}}()},dd0a:function(e,t,n){"use strict";n("e697"),n("6d57"),n("9a33");var r=n("fe97"),o=n("fd50"),a=n("a14a"),i=n.n(a),c=function(e){return r["a"].getProjectContractor(e)},s=function(e,t,n){var a=o["a"].defer();return r["a"].getContractor(e,t,n).then((function(e){if(e){var t=e;t.desc_id=n,a.resolve(t)}else{var r={contractor_id:"",contractor_name:"",desc_id:n};a.resolve(r)}})),a.promise},d=function(e,t,n){var a=[];if(n&&-1!=n){for(var c=n.split(";"),d=[],l=0;l<c.length;l++)d.push(s(e,t,c[l]));return o["a"].all(d).then((function(e){return e&&e.forEach((function(e){e&&e.contractor_id&&(i.a.find(a,{contractor_id:e.contractor_id})||a.push(e))})),a}))}return r["a"].getContractor(e,t).then((function(e){return e}))},l=function(e,t){return r["a"].getProjectContractorList(e,t)},u=function(e,t,n,o){return r["a"].changeConstruction(e,t,n,o)};t["a"]={getContractorList:c,getContractor:d,getContractorBySingleDesc:s,getProjectContractorList:l,changeConstruction:u}},f97d:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAADa0lEQVRYR9WZO2hUQRSG/zN7MYRgkRhEURRMoYKNGtGsEkj2TlLYCGrwVVn4IoplLIQFCy1FxaiFlQ+MKWwsNnNvAqIbwVehoCkUFEXRmBQh+GB3jhy9G9Y1utnNRscptpmdM989Z85jzhDKGMlkUjU1Na3xPK+FmVcz81Iims/Ms0UcEY0x81siGiKiB5lMZmBwcPBeMpm0pW5HpSwIw3CBtbaTmXcR0cJS1jLzayK6pJQ6k0gk3kx17ZQAgyCYw8zHAOwGUBUJfwEgBeA2gKdE9GpkZGRM5urq6mYz8yIAywFsANAOYEm07guAi0R01Pf9j8VAiwIGQbCNmU8DqAeQBdATaSFdTHj+fBiGcdE+gA4AMQDDRNTp+/61P8n5LeDAwICXyWQEbF90rkw2mz3U3t7+rBSwwv+mUqllsVjsFDPraO6c53kHW1paMpPJnRQwnU5Xj4+PXwewkYg+ATjs+/6F6YAVrg2CYA+Ak8xcDeBmTU3N1ng8Lnv9NH4BjDR3Q+AAvGfmjW1tbfcrCZeT1dfX10hENwHMFUjP8zYVavIXQGNMd2TW97FYrLm1tXVoJuByMvv7+5dms9lbEeQ5rfX+/P1+Aowc4qqY1VrbPFOaK/xg0aRS6paYm4i25TvOBGAUSsQB6olob6XPXDEryJlk5vORdy/LhaAJQGPMWQD7icj4vt9WTOBMzAdB0Bd5d7fW+sD36CE/UYZ4DsCz1q6YbigpF15CkFLqCYCMUqpBMs53QGPMcQBdAK5qrXeUu0El1hljrgDYDuCE1voISeKPx+MvJbcqpdYnEomSMkQloCbJOHckd6fT6cWUSqXWKqXuAnihtW6o9IblyDPGyHFbYq1dR2EYdllrxcQTB7McoZVck3NYpdQRMsb0AtgMYKfWWuz/z4cxRvzgMhH1CuBjACsArNJaP/rndD+cdiWAhwCeUBAEH5hZgnP9VOqzv/EBUdKQcmxYNPhZitDR0dGqjo6Or38DoNgePT09s2pra6Ww/eI+4P9gYped5LE4yXVm3uJsmHE+UDuf6pwvFpwvt/6LgjXSorslvwA6f2mKIKUP4+a1M5fAnb64C6TzrQ+BdLp5lDO10+23/ILS2QZmAaS7LeCCS7WbTfTCO0T+M4S1thGAPEPMK3iGeAdgSCl1fzrPEN8Ajn19wtuO19cAAAAASUVORK5CYII="},fe97:function(e,t,n){"use strict";n("163d");var r=n("1834"),o=n("fd50"),a=n("a14a"),i=n.n(a),c=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.length>0?console.log("[repositories]/construction-repostory.js：",e,n):console.log("[repositories]/construction-repostory.js：",e)},s=function(e,t){var n="select leader_id as id from project_contractor pc where pc.proj_id = ? and pc.contractor_id = ? ";return r["a"].queryOne(n,[e,t])},d=function(e,t){var n='select distinct cc.id contractor_id,cc.name contractor_name from checkroom_problem cr join project_contractor pc on pc.proj_id=cr.proj_id join contractor cc on pc.contractor_id=cc.id where cr.id = ? and cc.name like "%" || ? || "%" order by cc.sort';return r["a"].query(n,[e,t])},l=function(e,t,n,a){i.a.isArray(e)&&(e=e.join("','"));var c="update checkroom_problem set contractor_id = ?, responsible_company_id = ? where id in ('"+e+"')";return r["a"].executeSql(c,[t,t]).then((function(t){var n="select id, batch_unit_id, batch_room_id, batch_id from checkroom_problem where id in ('"+e+"')";return r["a"].query(n).then((function(){return o["a"].resolve(!0)})).catch((function(e){return o["a"].reject(e)}))}))},u=function(e){var t="select distinct cc.id contractor_id,cc.name contractor_name from batch_room br join checkroom_batch cb on br.batch_id=cb.batch_id join project_contractor pc on pc.proj_id=cb.project_id join contractor cc on pc.contractor_id=cc.id where br.id = ? order by cc.sort";return r["a"].query(t,[e])},f=function(e,t,n){var o,a=null,i="";return o="select building_id,unit,floor,room_id,is_virtual from batch_room where id = ?",r["a"].queryOne(o,[e]).then((function(s){if(!s)throw new Error("未找到当前房间."+e);if(!s.building_id)throw new Error("未找到当前房间的楼栋."+e);return a=s,i=1===Number(a.is_virtual)?"公区":"标准房间",o='select range.contractor_id, contractor.name contractor_name            from construction_range range           inner join contractor on range.contractor_id = contractor.id           where ( range.desc_id = ? or ( range.item_id = ? and (desc_id = "" or desc_id is null) ) )           and range.building_id = ?           and  range.room_id = ?            order by desc_id desc ',c("1. 寻找匹配的承建商 - _getContractor","modeCondition=".concat(i),"check_item_id=".concat(t),"check_desc_id=".concat(n),"rangeInfo",a),r["a"].queryOne(o,[n,t,a.building_id,a.room_id])})).then((function(e){return e||(c("2. 指定房间没找到，查找楼层范围"),o='select range.contractor_id, contractor.name contractor_name              from construction_range range             inner join contractor on range.contractor_id = contractor.id             where ( range.desc_id = ? or ( range.item_id = ? and (desc_id = "" or desc_id is null) ) )             and range.building_id = ?             and range.unit = ?             and range.floor = ?             and mode in ("全部", ? )             and (range.room_id = "" or range.room_id is null)             order by (CASE mode WHEN "指定房间" THEN 1 WHEN "全部" THEN 3 ELSE 2 END), range.desc_id desc ',r["a"].queryOne(o,[n,t,a.building_id,a.unit,a.floor,i]))})).then((function(e){return e||(c("3. 楼层范围没找到，查找单元范围"),o='select range.contractor_id,contractor.name contractor_name              from construction_range range             inner join contractor on range.contractor_id = contractor.id             where ( range.desc_id = ? or ( range.item_id = ? and (desc_id = "" or desc_id is null) ) )             and range.building_id = ?             and range.unit = ?             and mode in ("全部", ? )             and (range.floor = "" or range.floor is null)             and (range.room_id = "" or range.room_id is null)             order by (CASE mode WHEN "指定房间" THEN 1 WHEN "全部" THEN 3 ELSE 2 END), range.desc_id desc ',r["a"].queryOne(o,[n,t,a.building_id,a.unit,i]))})).then((function(e){return e||(c("4. 单元范围没找到，查找楼栋范围"),o='select range.contractor_id,contractor.name contractor_name              from construction_range range             inner join contractor on range.contractor_id = contractor.id             where ( range.desc_id = ? or ( range.item_id = ? and (desc_id = "" or desc_id is null) ) )             and range.building_id = ?             and mode in ("全部", ?)              and (range.unit = "" or range.unit is null)             and (range.floor = "" or range.floor is null)             and (range.room_id = "" or range.room_id is null)             order by (CASE mode WHEN "指定房间" THEN 1 WHEN "全部" THEN 3 ELSE 2 END), range.desc_id desc ',r["a"].queryOne(o,[n,t,a.building_id,i]))})).then((function(e){return c("- 检查项/问题描述自动匹配的承建商：",e),e}))};t["a"]={getContractor:f,getProjectContractor:u,getProjectContractorList:d,changeConstruction:l,getProjectContractorLeaderId:s,getContractorByIds:function(e){i.a.isArray(e)&&(e=e.join("','"));var t="select id, name  from contractor  where id in ('".concat(e,"')  order by sort");return r["a"].query(t)}}}}]);