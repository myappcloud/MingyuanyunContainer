(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-097ba671"],{"0970":function(e,t,n){"use strict";n("6d57"),n("cc57");var i=n("1834"),o=function(){var e="select ci.id,ci.name,ci.parent_id,ci.sort,ci.ifEnd,cig.remark from check_item ci left join check_item_guide cig on ci.id=cig.item_id";return i["a"].query(e)},r=function(e){var t="select remark from check_item_guide where item_id = ?",n=[e];return i["a"].queryOne(t,n).then((function(e){return e&&e.remark}))},a=function(e){var t="select item.full_name,guide.remark as guide           from check_item_guide guide               inner join check_item item on guide.item_id=item.id           where guide.item_id=?";return i["a"].queryOne(t,[e])},l=function(){var e="select item.id,item.name,item.parent_id,guide.id is not null as has_guide       from check_item item           left join check_item_guide guide on item.id=guide.item_id              and ifnull(guide.remark,'') <> ''       order by sort";return i["a"].query(e)},c={getCheckItemWithGuide:o,getGuideByCheckItemId:r,getCheckItemList:l,getGuideAndItemByItemId:a},s=n("a14a"),d=n.n(s),m=function(){var e={};return{getItem:function(t,n){if(void 0===t||null===t)throw new TypeError("key参数为空");return n?e[t]:d.a.cloneDeep(e[t])},setItem:function(t,n){if(void 0===t||null===t)throw new TypeError("key参数为空");if(arguments.length<2)throw new TypeError("value参数未设置");e[t]=n},clear:function(){e={}}}},h=m(),u={IS_NEED_DOWNLOAD_BASE_DATA:"is_need_download_base_data",LAST_EXEC_TIME_DATA:"last_exec_time_data",LAST_GUIDE_SORT_MAP:"last_guide_sort_map"},p=function(){var e=function e(t,n){t.remark&&""!=t.remark&&(t.has_guide=!0),t.children=[];for(var i=0;i<n.length;i++)n[i].parent_id==t.id&&t.children.push(n[i]);if(t.children&&t.children.length>0)for(var o=0;o<t.children.length;o++)t.children[o]=e(t.children[o],n);return t};return{getCheckItemGuideByItemId:function(e){return c.getGuideByCheckItemId(e)},getCheckItemTree:function(){var t={id:""};return c.getCheckItemWithGuide().then((function(n){t=e(t,n);for(var i=0;i<t.children.length;i++)if("所有检查项"==t.children[i].name)return t.children[i].children;return t.children}))},getCheckItemTreeAndGuideSortMap:function(){return console.time("getData"),c.getCheckItemList().then((function(e){console.timeEnd("getData"),console.time("processData");var t={},n=[],i=0,o=[];function r(e,t){e.forEach((function(e){e.depth=t,e.tree?r(e.tree,t+1):e.has_guide&&(e.guide_sort=i,n[i]=e.id,i++)}))}return e.forEach((function(e){t[e.id]=e})),e.forEach((function(e){e.parent_id&&t[e.parent_id]?(t[e.parent_id].tree=t[e.parent_id].tree||[],t[e.parent_id].tree.push(e)):o.push(e)})),r(o,1),h.setItem(u.LAST_GUIDE_SORT_MAP,n),console.timeEnd("processData"),{tree:o,guideSortMap:n}}))},getGuideSortMapFromCatch:function(){return h.getItem(u.LAST_GUIDE_SORT_MAP,!0)},getGuideAndItemByItemId:c.getGuideAndItemByItemId}};t["a"]=p()},"1e47":function(e,t,n){"use strict";n.r(t);n("5ab2"),n("e44b"),n("e10e"),n("f548"),n("6d57"),n("f0e6");var i=n("28f8"),o=(n("cc57"),n("f2de"));function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l={props:{filterList:{type:Array,default:function(){return[{type:"status",title:"问题状态",value:"",name:"",options:[{name:"问题状态1问题状态1问题状态1问题状态1",count:2019,value:"1"},{name:"问题状态2",count:2019,value:"2"},{name:"问题状态3",count:2019,value:"3"}]},{type:"floor",title:"楼层",value:"",name:"",options:[{name:"楼层1",count:2019,value:"1"},{name:"楼层2",count:2019,value:"2"},{name:"楼层3",count:2019,value:"3"}]},{type:"item",title:"检查项",value:"",name:"",options:[{name:"检查项1",count:2019,value:"1"},{name:"检查项2",count:2019,value:"2"},{name:"检查项3",count:2019,value:"3"}]},{type:"user",title:"登记人",value:"",name:"",options:[{name:"登记人1登记人1登记人1登记人1",count:2019,value:"1"},{name:"登记人2",count:2019,value:"2"},{name:"登记人3",count:2019,value:"3"}]}]}}},data:function(){return{top:0,showFilterContent:!1,currFilter:{},currIndex:""}},computed:a({},Object(o["e"])({isIOSX:function(e){return e.app.global.isIOSX},isIOS:function(e){return e.app.global.isIOS}})),created:function(){this.top=this.isIOS?this.isIOSX?"128px":"104px":"84px"},mounted:function(){},methods:{changeFilter:function(e){if(e===this.currIndex)return this.maskClickHandler(),this.currIndex="",!1;this.currIndex=e,this.currFilter=this.filterList[e],this.showFilterContent=!0,this.$emit("changeFilter",e)},maskClickHandler:function(){this.showFilterContent=!1,this.currFilter={}},chooseItem:function(e,t,n){if(n.value===t.value)return!1;this.currFilter.name=this.currFilter.options[e].name,this.currFilter.value=this.currFilter.options[e].value,this.$emit("chooseItem",t,n)}}},c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"filter"},[n("ul",{ref:"filterHeader",staticClass:"filter-header van-hairline--bottom"},e._l(e.filterList,(function(t,i){return n("li",{key:i,staticClass:"filter-item",class:{"filter-item__active":e.currFilter.type===t.type||t.value},on:{click:function(t){return e.changeFilter(i)}}},[n("div",{staticClass:"filter-desc"},[n("span",{staticClass:"filter-title"},[e._v(e._s(t.value?t.name:t.title))]),e._v(" "),n("i",{staticClass:"iconfont",class:e.currIndex===i&&e.showFilterContent?"icon-hebingxingzhuang":"icon-hebingxingzhuang1"})])])})),0),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showFilterContent,expression:"showFilterContent"}],staticClass:"filter-content",style:{top:e.top},on:{click:e.maskClickHandler}},[n("ul",{staticClass:"filter-list"},e._l(e.currFilter.options,(function(t,i){return n("li",{key:i,staticClass:"filter-cell van-hairline--bottom",class:{"filter-cell__active":e.currFilter.value===t.value},on:{click:function(n){return e.chooseItem(i,e.currFilter,t)}}},[n("span",{staticClass:"pull-left"},[e._v(e._s(t.name))]),e._v(" "),n("span",{staticClass:"pull-right"},[e._v(e._s(t.count))])])})),0)])])},s=[],d=n("d082");function m(e){n("8da6")}var h=!1,u=m,p="data-v-064833d6",f=null,b=Object(d["a"])(l,c,s,h,u,p,f),g=b.exports,_=n("964e"),v=n("db99"),k=n("438a"),y=n("db5f"),I=n("fe6f"),w=n("ba1a");function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C={components:{AppFilter:g,EmptyPage:k["a"]},data:function(){return{batchUnitId:"",showGoTopButton:!1,title:"",batchType:"",noProblemData:!1,hasMoreProblemData:!0,model:{},loading:!1,filterList:[],loadingData:!1,finished:!1,showFinishText:!1,hasCheckbox:!1,wrapperScrollTop:0,statusColor:{"待整改":"red","已整改":"blue","已作废":"grey","非正常关闭":"black","待派单":"purple","已通过":"green"},labelMap:{"待整改":"整改时限","已整改":"整改日期","已通过":"通过日期","非正常关闭":"关闭日期","已作废":"作废日期","待派单":"登记日期"},emptyImgSrc:n("5452"),emptyMsg:"当前楼栋/单元暂无问题",dataListStyle:{}}},computed:P({},Object(o["e"])({isSpecialBatch:function(e){return e.app.global.isSpecialBatch},currentBatchType:function(e){return e.app.global.currentBatchType},currentMenuType:function(e){return e.app.global.currentMenuType},contentHeight:function(e){return e.app.global.contentHeight}})),activated:function(){this.$router.isForward?this.wrapperScrollTop=0:this.$refs.problemList.scrollTop=this.wrapperScrollTop},created:function(){var e=this;this.dataListStyle=Object(I["b"])()?{height:window.innerHeight-109+"px"}:{flex:1};var t=w["a"].getDecodeQuery(this.$route.query),n=t.unitId,i=t.title,o=t.batchType;this.batchUnitId=n,this.title=i,this.batchType=o,this.loading=!0,v["a"].init(n,i).then((function(){e.model=v["a"].model,console.log(e.model.problemList,"=======s==="),e.filterList=e.model.filter,e.loading=!1,e.showFinishText=e.model.problemList.length>20,e.shouldShowCheckbox(),e.updatePageStatus()})).catch((function(e){this.$comComps.toast.show(e,2e3),this.noProblemData=!0}))},methods:{onScroll:function(){var e=this;this.timer&&clearTimeout(this.timer);var t=this.$refs.problemList.scrollTop;this.timer=setTimeout((function(){e.showGoTopButton=t>600}),500)},onLoad:function(){this.loadMoreProblemData()},toTop:function(){this.$refs.problemList.scrollTop=0},passProblemsHandler:function(e){var t=this;this.$toast.loading({mask:!0,message:"正在处理...",duration:0}),v["a"].passProblems(e).finally((function(){t.$toast.clear()}))},passProblem:function(){var e=this;if(this.model.isAllSelected)return this.$dialog.confirm({message:"确认整改通过所有问题？",confirmButtonText:"确认"}).then((function(){e.passProblemsHandler()}));for(var t=!1,n=0;n<this.model.problemList.length;n++)if(this.model.problemList[n].checked){t=!0;break}if(!t)return this.$toast("请选择问题");var i=[];this.model.problemList.forEach((function(e){!0===e.checked&&i.push({id:e.id,batchRoomId:e.batchRoomId})})),i.length&&this.$dialog.confirm({message:"确认当前选中问题均已整改通过？",confirmButtonText:"确认"}).then((function(){e.passProblemsHandler(i)}))},selectAllProblem:function(e){this.model.isAllSelected=e,this.model.problemList.forEach((function(t){t.checked=e}))},updatePageStatus:function(){this.hasMoreProblemData=this.model.currPage<this.model.totalPage-1,this.noProblemData=!this.model.problemList.length&&!this.hasMoreProblemData,console.log("==>",this.model.currPage,this.model.totalPage,this.model.problemList.length)},shouldShowCheckbox:function(){if(~~window.take_photo_when_review)return this.hasCheckbox=!1;for(var e=!1,t=this.model.filter||[],n=t.length,i=0;i<n;i++)if("status"===t[i].type){e="已整改"===t[i].value;break}this.hasCheckbox!==e&&(this.hasCheckbox=e)},checkProblemItem:function(e,t){console.log(e,"00000"),this.$set(this.model.problemList,t,P(P({},e),{},{checked:!e.checked})),this.updateAllSelectedStatus(e.checked)},go:function(){this.$router.replace({path:"/checkroom/".concat(this.currentMenuType||this.currentBatchType,"-room-list"),query:{unitId:this.batchUnitId,title:this.title,batchType:this.batchType}})},chooseItem:function(e,t){return this.shouldShowCheckbox(),this.toTop(),this.updateAllSelectedStatus(!1),this.model.currConditon=null,this.loadProblemListData()},updateAllSelectedStatus:function(e){if(this.model.isAllSelected===e)return!1;if(!e)return this.model.isAllSelected=!1;for(var t=this.model.problemList||[],n=t.length,i=0;i<n;i++)if(!t[i].checked)return!1;return this.model.isAllSelected=!0},loadProblemListData:function(e){var t=this;return v["a"].load(e||0).then(this.updatePageStatus).catch((function(e){t.$comComps.toast.show(e,2e3),t.noProblemData=!0}))},loadMoreProblemData:function(){var e=this;if(console.log(this.loadingData,this.hasMoreProblemData),!this.hasMoreProblemData)return this.loadingData=!1,!1;var t=this.model.currPage;this.loadProblemListData(t+1).finally((function(){console.log(e.model,t,"currPage====="),e.hasMoreProblemData&&t===e.model.currPage&&(e.hasMoreProblemData=!1,e.finished=!0),e.loadingData=!1}))},showProblemDetail:function(e){var t=this;this.wrapperScrollTop=this.$refs.problemList.scrollTop;var n=_["a"].isLocal(e.id);n.then((function(n){if(n){var i={title:e.roomName,batch_room_id:e.batchRoomId,batch_unit_id:e.batchUnitId,problemId:e.id||"",building_id:e.buildingId,diagramId:e.roomtypeDiagramId,problemStamp:(new Date).getTime(),type:t.batchType,fitment_standard:e.fitmentStandard,isSpecial:t.isSpecialBatch};y["a"].init(i),t.$router.push({path:"/checkroom/".concat(t.currentMenuType||t.currentBatchType,"-edit-problem"),query:P({},i)})}else t.$router.push({path:"/checkroom/".concat(t.currentMenuType||t.currentBatchType,"-problem-detail"),query:{title:e.roomName,batch_room_id:e.batchRoomId,question_id:e.id,roomtype_diagram_id:e.roomtypeDiagramId,batch_unit_id:e.batchUnitId,building_id:e.buildingId,type:t.batchType}})}))}}},A=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"problem-list"},[i("cus-nav-bar",{attrs:{title:e.title,"left-arrow":""},on:{"click-right":function(t){return e.go()}}},[i("div",{staticClass:"toggleBtn",attrs:{slot:"right"},slot:"right"},[e._v("房间列表")])]),e._v(" "),i("app-filter",{attrs:{"filter-list":e.filterList},on:{chooseItem:e.chooseItem}}),e._v(" "),i("div",{directives:[{name:"scroll",rawName:"v-scroll"}],staticClass:"wrapper",style:e.dataListStyle},[i("empty-page",{attrs:{"show-empty":e.loading,"loading-page":!0,"empty-msg":"正在统计您的问题，请耐心等待"}}),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showGoTopButton,expression:"showGoTopButton"}],staticClass:"to-top",on:{click:function(t){return e.toTop()}}}),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"refresh-wrapper"},[i("empty-page",{attrs:{"show-empty":e.noProblemData,"empty-msg":e.emptyMsg,"empty-img-src":e.emptyImgSrc}}),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.noProblemData,expression:"!noProblemData"}],ref:"problemList",staticClass:"content",style:{height:e.contentHeight-40+"px"},on:{scroll:function(t){return e.onScroll()}}},[e.loading?e._e():i("van-list",{staticClass:"lists",attrs:{finished:e.finished,"finished-text":e.showFinishText?"没有更多了":""},on:{load:e.onLoad},model:{value:e.loadingData,callback:function(t){e.loadingData=t},expression:"loadingData"}},e._l(e.model.problemList,(function(t,o){return i("van-cell",{key:t.code,staticClass:"vanCell",on:{click:function(n){return e.showProblemDetail(t)}}},[i("div",{staticClass:"list van-hairline--bottom"},[i("div",{staticClass:"list-left"},[e.hasCheckbox?i("div",{staticClass:"check-wrapper",on:{click:function(n){return n.stopPropagation(),e.checkProblemItem(t,o)}}},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.checked,expression:"item.checked"}],attrs:{src:n("2985"),alt:"checked",width:"20",height:"20"}}),e._v(" "),i("img",{directives:[{name:"show",rawName:"v-show",value:!t.checked,expression:"!item.checked"}],attrs:{src:n("f97d"),alt:"check",width:"20",height:"20"}})]):e._e()]),e._v(" "),i("div",{staticClass:"list-right"},[i("div",{staticClass:"top-wrapper hairline-dashed--bottom"},[t.code?i("span",{staticClass:"code"},[e._v("编号: "+e._s(t.code))]):e._e(),e._v(" "),i("div",{staticClass:"status",class:e.statusColor[t.status]},[e._v(e._s(t.status))]),e._v(" "),i("div",{staticClass:"blank"}),e._v(" "),i("div",{staticClass:"remarks"},["非常紧急"==t.emergence?i("van-tag",{attrs:{color:"#E63931"}},[e._v(e._s(t.emergence))]):e._e(),e._v(" "),"紧急"==t.emergence?i("van-tag",{attrs:{color:"#FF8100"}},[e._v(e._s(t.emergence))]):e._e(),e._v(" "),t.sendBackTimes>0?i("van-tag",{attrs:{color:"#FFBE00"}},[e._v("退"+e._s(t.sendBackTimes)+"次")]):e._e()],1)]),e._v(" "),i("div",{staticClass:"detail"},[i("p",{staticClass:"num"},[e._v("房间："+e._s(t.roomName))]),e._v(" "),i("p",{staticClass:"problem"},[e._v("问题："+e._s(t.positionName)+"-"+e._s(t.itemName)+"-"+e._s(t.desc))]),e._v(" "),i("p",{staticClass:"duty-time"},[t.registerUserName?i("span",{staticClass:"duty"},[e._v("登记人："+e._s(t.registerUserName))]):e._e(),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!!t.dealTime,expression:"!!item.dealTime"}],staticClass:"time"},[e._v(e._s(e.labelMap[t.status])+"："+e._s(t.dealTime))])])])])])])})),1)],1)],1)],1),e._v(" "),e.hasCheckbox&&e.model.problemList.length?i("div",{staticClass:"footer van-hairline--top"},[i("div",{staticClass:"item-left van-hairline--right",on:{click:function(t){return t.stopPropagation(),e.selectAllProblem(!e.model.isAllSelected)}}},[i("img",{directives:[{name:"show",rawName:"v-show",value:e.model.isAllSelected,expression:"model.isAllSelected"}],attrs:{src:n("2985"),alt:"selected",width:"20",height:"20"}}),e._v(" "),i("img",{directives:[{name:"show",rawName:"v-show",value:!e.model.isAllSelected,expression:"!model.isAllSelected"}],attrs:{src:n("f97d"),alt:"select",width:"20",height:"20"}}),e._v(" "),i("span",[e._v("全选")])]),e._v(" "),i("ul",{staticClass:"btn-wrapper"},[i("li",{staticClass:"pass",on:{click:function(t){return e.passProblem()}}},[e._v("通过")])])]):e._e()],1)},L=[];function D(e){n("c0b8")}var T=!1,S=D,O="data-v-00638ef9",j=null,B=Object(d["a"])(C,A,L,T,S,O,j);t["default"]=B.exports},2985:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAADIklEQVRYR82ZTUhUURTHf3fKUqKkD0r7wEVQEUVCH7oSggiskMASF0EQlBW2DHQRDLQw2irZuAiKIFIXFVhIC4kKgmqlVBYuAnO0JkSMcpj0xvXN0+eb92beffMm3lsNc+/5nx/3cM85916Bny8qI5RzEDiMYD+SnUA5sDotNw3EEQwjeQ8MEOctUTGn605oGdyVW5ihGTgDbNWyhVHgPsV0cFZ882rrDbBDrqeI68A5YKVXcZd5SeAOKa7RLH7m0soN2CUbkbQDG3KJaY4niNDMefEwm507YFQuZzPtSC5qOtabLrjNGFeIir9Ohs6A3bKESXqA43refM/uYy2naRB/7AqZgGrlynn0H+FMpj7inLSvZCZgl+wseFjdFlqF+4K4ZB1eCmhsiAe+AxWEYYRG68ZZBDRSyacC7FZd7AQpdpkpaBEwJm8BS5ZXVznA+Z00ictKzwA0KsRIAEnYE+OaIrhZBXvXQewj3PuSYZakmO2q4hiAMdkGtHhSz3NS6QroPwZVGw2hWQm7u+HzVIbwDZpEq8Ao/F991FZtVDucKVDzBF6OZ8iNEqdCEJNVwBttb5oGbnADY3CkD+ako2C1AlShVSEu2OcG92ocap/Br5Sr61YF2AvUu03Ztgq+z0By1h9/HnBqC/cqwEFgj919RMDjo3CiAiZ+Q/1zeD2hB5kXnOFqSAH+cErONWXwom4RaDoFtU+9QwYAp5wnFOCMU/7bUQofGmCZpRh6hQwITgEmXQHV6NV9RkK1frkgA4RbAHQMsQnVUglth7xBBgy3EGLHTWJF8gJZADiFMCjokj1ITuXan9kghyaXli9Ty0Oey+42nWY8J2o3yJEpqLQdqfKGM9DnE7VWqXOCtC9DQHBKttpXs5ANMkC4dLOgOH20W06QAcIpqnS7pX76bFhVnlQpSCVz1ZXU9Wct/Ln2oXXc1rAaq+ir5VcVZ1OJUQJdWiYdMHOureVXf4f+0KQgQ33sNBc31Ad3BRn6qw8FGerLIzPUob5+syaG0F5gWiFDfQVsBQ3tJbq9FlifIeAAzD9DlNmeIdRdwTDwLp9niH+Lfm97gO/iCQAAAABJRU5ErkJggg=="},4438:function(e,t,n){"use strict";var i=n("cb6b"),o=n("0e1c");t["a"]={getLocalBusinessToggle:function(){var e=i["a"].getObject(o["a"].BUSINESS_TOGGLE,i["a"].level.user);return e||{enable_opening_tab:0,enable_pass_when_add:0,enable_pass_when_to_repair:0,sign_when_receive_delivery:1,special_project_switch:0,take_photo_when_review:0,take_photo_when_regist:0,hide_owner_phone:0,enable_problem_reason:0}}}},"5c1b":function(e,t,n){"use strict";n("f0e6");var i=n("bbed"),o=n("fa1b"),r=n("07a4"),a=n("fd50");function l(){var e=function(e){e&&e.fitment_standard&&("毛坯"===e.fitment_standard?e.is_for_rough=1:"精装"===e.fitment_standard&&(e.is_for_decorated=1),delete e.fitment_standard)},t=function(e,t,n,o,r){return i["a"].getCheckItemLeaf(e,t,o,r).then((function(e){if(_.isEmpty(e))return[];var t=[];return _.each(e,(function(e){t.push(e.id)})),i["a"].getCheckItemAll(t.join("','"),n,o,r)}))};return{getCheckItemList:function(e,n,o,l,c){var s="毛坯"==l,d=a["a"].when(),m=["全部"];return m.push(1==c?"公区":"房间"),m="('"+m.join("','")+"')",d=r["a"].state.app.global.isUseProjectItem?i["a"].getProjectCheckItemList(e,n,o,s,m):t(e,n,o,s,m),d.then((function(e){return e}))},hasProjectCheckitem:function(e){return i["a"].hasProjectCheckitem(e)},searchCheckItemWithProject:function(t,n,o,r){return e(o),r?i["a"].searchProjectCheckItem(r,t,n,o):i["a"].searchCheckItem(t,n,o)},searchCheckItem:function(t,n,o,r){return console.log("searchCheckItem: ",t,n,o),console.time("searchCheckItem"),e(o),i["a"].hasProjectCheckitem(r).then((function(e){return e?i["a"].searchProjectCheckItem(r,t,n,o):i["a"].searchCheckItem(t,n,o).finally((function(){console.timeEnd("searchCheckItem")}))}))},getHigherLevelTreeListByCheckItemId:function(t,n,o){return console.log("getHigherLevelTree: ",t,n,o),console.time("getHigherLevelTree"),e(o),i["a"].getHigherLevelTreeListByCheckItemId(t,n,o).finally((function(){console.timeEnd("getHigherLevelTree")}))},getCheckItemLevel:function(e,t){return i["a"].getCheckItemLevel(e,t)},getPositionItemByRoom:function(e,t,n){var o=a["a"].when(),l=["全部"];return l.push(1==n?"公区":"房间"),l="('"+l.join("','")+"')",o=r["a"].state.app.global.isUseProjectItem?i["a"].getProjectPositionItemByRoom(e,t,l):i["a"].getPositionItemByRoom(e,l),o.then((function(e){return e}))},setIsUseProjectItemOfBatchUnit:function(e){return i["a"].getProjectItemOfBatchUnit(e).then((function(e){var t=!1;e&&(t=!0),r["a"].commit("app/APP",{isUseProjectItem:t})}))},getBatchCheckItem:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return o["a"].getCheckItemList(e,t,n,r["a"].state.app.global.isUseProjectItem).then((function(e){return console.log("BatchCheckItem",e),a["a"].resolve(e)}))}}}t["a"]=l()},6313:function(e,t,n){var i=n("5454");t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .vanCell[data-v-00638ef9] {\n  padding: 0;\n}\n.zhkf .problem-list[data-v-00638ef9] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  height: 100%;\n}\n.zhkf .problem-list[data-v-00638ef9] .van-cell {\n    line-height: normal;\n}\n.zhkf .problem[data-v-00638ef9] {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  padding-right: 15px;\n}\n.zhkf .toggleBtn[data-v-00638ef9] {\n  color: #202020;\n  white-space: nowrap;\n}\n.zhkf .wrapper[data-v-00638ef9] {\n  overflow: auto;\n  background: #fff;\n  position: relative;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .wrapper .to-top[data-v-00638ef9] {\n    position: absolute;\n    bottom: 20px;\n    right: 20px;\n    width: 48px;\n    height: 48px;\n    z-index: 10;\n    background: url("+i(n("4d8e"))+") no-repeat;\n    background-size: 100%;\n}\n.zhkf .refresh-wrapper[data-v-00638ef9] {\n  height: 100%;\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n}\n.zhkf .content[data-v-00638ef9] {\n  overflow: scroll;\n}\n.zhkf .lists[data-v-00638ef9] {\n  background: #fff;\n}\n.zhkf .lists .list[data-v-00638ef9] {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n}\n.zhkf .lists .list .list-right[data-v-00638ef9] {\n      overflow: hidden;\n      -webkit-box-flex: 1;\n          -ms-flex: 1;\n              flex: 1;\n}\n.zhkf .lists .list .list-left[data-v-00638ef9] {\n      min-width: 15px;\n      -ms-flex-negative: 0;\n          flex-shrink: 0;\n}\n.zhkf .lists .list .list-left .check-wrapper[data-v-00638ef9] {\n        padding-left: 10px;\n        padding-right: 10px;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n            -ms-flex-align: center;\n                align-items: center;\n        -webkit-box-pack: center;\n            -ms-flex-pack: center;\n                justify-content: center;\n}\n.zhkf .lists .list .top-wrapper[data-v-00638ef9] {\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n      height: 35px;\n      -webkit-box-align: center;\n          -ms-flex-align: center;\n              align-items: center;\n}\n.zhkf .lists .list .top-wrapper .code[data-v-00638ef9] {\n        color: #a0a0a0;\n        font-size: 12px;\n}\n.zhkf .lists .list .top-wrapper .status[data-v-00638ef9] {\n        margin-left: 13px;\n        padding-left: 6.5px;\n        padding-right: 6.5px;\n        height: 16px;\n        border-radius: 8px;\n        border: 1px solid transparent;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n            -ms-flex-align: center;\n                align-items: center;\n        -webkit-box-pack: center;\n            -ms-flex-pack: center;\n                justify-content: center;\n        line-height: normal;\n        font-size: 10px;\n}\n.zhkf .lists .list .top-wrapper .status.red[data-v-00638ef9] {\n          color: #eb544d;\n          border-color: #eb544d;\n}\n.zhkf .lists .list .top-wrapper .status.blue[data-v-00638ef9] {\n          color: #0099ff;\n          border-color: #0099ff;\n}\n.zhkf .lists .list .top-wrapper .status.purple[data-v-00638ef9] {\n          color: #a13eff;\n          border-color: #a13eff;\n}\n.zhkf .lists .list .top-wrapper .status.grey[data-v-00638ef9] {\n          color: #a0a0a0;\n          border-color: #a0a0a0;\n}\n.zhkf .lists .list .top-wrapper .status.black[data-v-00638ef9] {\n          color: #000;\n          border-color: #000;\n}\n.zhkf .lists .list .top-wrapper .status.green[data-v-00638ef9] {\n          color: #00cb59;\n          border-color: #00cb59;\n}\n.zhkf .lists .list .top-wrapper .blank[data-v-00638ef9] {\n        -webkit-box-flex: 1;\n            -ms-flex: 1;\n                flex: 1;\n}\n.zhkf .lists .list .top-wrapper .remarks[data-v-00638ef9] {\n        margin-right: 15px;\n}\n.zhkf .lists .list .detail[data-v-00638ef9] {\n      padding-top: 12px;\n      padding-bottom: 12px;\n      font-size: 13px;\n      color: #606060;\n}\n.zhkf .lists .list .detail > p[data-v-00638ef9] {\n        margin-top: 6px;\n}\n.zhkf .lists .list .detail .num[data-v-00638ef9] {\n        font-size: 15px;\n        margin-top: 0;\n        color: #202020;\n}\n.zhkf .lists .list .detail .duty-time[data-v-00638ef9] {\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n            -ms-flex-align: center;\n                align-items: center;\n}\n.zhkf .lists .list .detail .duty-time .duty[data-v-00638ef9] {\n          -webkit-box-flex: 1;\n              -ms-flex: 1;\n                  flex: 1;\n}\n.zhkf .lists .list .detail .duty-time .time[data-v-00638ef9] {\n          margin-right: 15px;\n}\n.zhkf .footer[data-v-00638ef9] {\n  background: #fff;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.zhkf .footer .item-left[data-v-00638ef9] {\n    width: 100px;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    color: #0099ff;\n    font-size: 16px;\n}\n.zhkf .footer .item-left span[data-v-00638ef9] {\n      margin-left: 8px;\n}\n.zhkf .footer .btn-wrapper[data-v-00638ef9] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    height: 45px;\n}\n.zhkf .footer .btn-wrapper li[data-v-00638ef9] {\n      -webkit-box-flex: 1;\n          -ms-flex: 1;\n              flex: 1;\n      text-align: center;\n      line-height: 45px;\n      font-size: 16px;\n}\n.zhkf .footer .btn-wrapper li.unusual[data-v-00638ef9], .zhkf .footer .btn-wrapper li.back[data-v-00638ef9] {\n        background: #fff;\n        color: #eb544d;\n}\n.zhkf .footer .btn-wrapper li.pass[data-v-00638ef9] {\n        background: #0099ff;\n        color: #fff;\n}\n.zhkf .footer .btn-wrapper li[data-v-00638ef9]:last-child {\n        background: #0099ff !important;\n        color: #fff !important;\n}\n",""])},"77a8":function(e,t,n){"use strict";n("6d57");function i(){var e={list:[]};return{model:e,init:function(){e.list=[{key:"status",value:"常用状态",name:"常用状态",displayName:"所有状态",list:[{name:"常用状态",value:"常用状态"},{name:"所有状态",value:""}]},{key:"position",value:"",name:"全部",displayName:"部位",list:[]},{key:"checkItem",value:"",name:"全部",displayName:"检查项",list:[]}]},update:function(t){e.list.forEach((function(e){t[e.key]&&(e.list=t[e.key])}))},getCondition:function(){var t={};return e.list.forEach((function(e){t[e.key]=e.value})),t},resetCheckItemValue:function(){e.list.forEach((function(e){"checkItem"===e.key&&(e.value="",e.name="全部")}))}}}t["a"]=i()},"77ca":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .filter[data-v-064833d6] {\n  background: #fff;\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n}\n.zhkf .clearfix[data-v-064833d6]:before,\n.zhkf .clearfix[data-v-064833d6]:after {\n  content: ' ';\n  display: table;\n}\n.zhkf .clearfix[data-v-064833d6]:after {\n  clear: both;\n}\n.zhkf .filter-header[data-v-064833d6] {\n  height: 40px;\n  font-size: 14px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n  -ms-flex-wrap: nowrap;\n      flex-wrap: nowrap;\n  -webkit-box-flex: 0;\n      -ms-flex: 0 0 auto;\n          flex: 0 0 auto;\n}\n.zhkf .filter-header .filter-item[data-v-064833d6] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1 1 auto;\n            flex: 1 1 auto;\n    text-align: center;\n    padding: 10px 0;\n    width: 20%;\n    line-height: 22px;\n    color: #606060;\n}\n.zhkf .filter-header .filter-item .filter-desc[data-v-064833d6] {\n      border-left: 1px solid #ebebeb;\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n      -webkit-box-pack: center;\n          -ms-flex-pack: center;\n              justify-content: center;\n      padding-left: 5px;\n      padding-right: 5px;\n}\n.zhkf .filter-header .filter-item .filter-desc .filter-title[data-v-064833d6] {\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n}\n.zhkf .filter-header .filter-item .filter-desc .icon-hebingxingzhuang1[data-v-064833d6],\n      .zhkf .filter-header .filter-item .filter-desc .icon-hebingxingzhuang[data-v-064833d6] {\n        -ms-flex-negative: 0;\n            flex-shrink: 0;\n        font-size: 10px;\n        color: #d2d2d7;\n}\n.zhkf .filter-header .filter-item .filter-desc img[data-v-064833d6] {\n        width: 10px;\n        height: 10px;\n}\n.zhkf .filter-header .filter-item:first-child .filter-desc[data-v-064833d6] {\n      border-left: 0;\n}\n.zhkf .filter-header .filter-item__active[data-v-064833d6] {\n    color: #0085ff;\n}\n.zhkf .filter-header .filter-item__active .filter-desc .icon-hebingxingzhuang[data-v-064833d6],\n    .zhkf .filter-header .filter-item__active .filter-desc .icon-hebingxingzhuang1[data-v-064833d6] {\n      color: #0085ff;\n}\n.zhkf .filter-content[data-v-064833d6] {\n  width: 100%;\n  position: absolute;\n  top: 87px;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.2);\n  z-index: 9999;\n}\n.zhkf .filter-content .filter-list[data-v-064833d6] {\n    background: #fff;\n    max-height: 280px;\n    overflow: scroll;\n}\n.zhkf .filter-content .filter-list .filter-cell[data-v-064833d6] {\n      height: 40px;\n      line-height: 40px;\n      padding: 0 15px;\n      font-size: 14px;\n      color: #606060;\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n}\n.zhkf .filter-content .filter-list .filter-cell .pull-left[data-v-064833d6] {\n        -webkit-box-flex: 1;\n            -ms-flex: 1;\n                flex: 1;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n}\n.zhkf .filter-content .filter-list .filter-cell .pull-right[data-v-064833d6] {\n        -ms-flex-negative: 0;\n            flex-shrink: 0;\n}\n.zhkf .filter-content .filter-list .filter-cell[data-v-064833d6]:last-child {\n        border-bottom: 0;\n}\n.zhkf .filter-content .filter-list .filter-cell__active[data-v-064833d6] {\n      color: #0085ff;\n}\n",""])},"85cd":function(e,t,n){"use strict";var i=n("1834"),o=n("0938"),r="checkitem_remark_history",a={createCondition:function(e,t){if(_.isEmpty(e))return"";t=t?"crh.":"";var n=[];return _.each(e,(function(e,i){n.push(t+i+"="+e)})),n=n.join(" and "),n},insertHistory:function(e){e.id=o["a"].uuid(),e.used_time=e.used_time||1,e.last_used_time=e.last_used_time||o["a"].getNowDate();var t=[],n=[];return _.each(e,(function(e,i){t.push(i),n.push(e)})),i["a"].insert(r,t,n).then((function(){return e.id}))},updateHistory:function(e,t){return i["a"].update(r,e,t)},getOneHistory:function(e,t,n){var o="select * from "+r+" where item_id=? and desc_id=? and remark=?";return i["a"].queryOne(o,[e,t,n])},updateUserdTime:function(e,t){if(!t)return $q.error("次数不能为0");var n={last_used_time:o["a"].getNowDate(),used_time:t};return i["a"].update(r,n,{id:e})},getListByItemIdOrderDate:function(e,t){var n="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ?  order by crh.last_used_time desc limit "+t;return i["a"].query(n,[e])},getListByItemIdOrderUsedTime:function(e,t,n){var o=n.length?'and crh.id not in ("'+n.join('","')+'")':"",r="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ? "+o+" order by crh.used_time desc limit "+t;return i["a"].query(r,[e])},deleteItemById:function(e){var t="delete from checkitem_remark_history where id=?";return i["a"].query(t,[e])},searchByItems:function(e,t){var n="select crh.id,crh.remark as name,crh.item_id,ci.name as item_name,ci.full_name as item_full_name,crh.desc_id,cid.name as desc_name from checkitem_remark_history crh inner join check_item ci on ci.id = crh.item_id inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id in ("+t+') and (lower(crh.remark) like "%" || ? || "%" or upper(crh.remark) like "%" || ? || "%") order by crh.remark';return i["a"].query(n,[e,e])}},l=a,c={getList:function(e){if(!e)return $q.reject("itemId为空");var t=[];return l.getListByItemIdOrderDate(e,3).then((function(n){if(n){var i=[];return _.each(n,(function(e){i.push(e.id),t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),l.getListByItemIdOrderUsedTime(e,17,i).then((function(e){return e&&_.each(e,(function(e){t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),t}))}return $q.reject(t)}))},deleteItem:function(e){return l.deleteItemById(e)},upsertHistory:function(e,t,n){return l.getOneHistory(e,t,n).then((function(i){return i?l.updateUserdTime(i.id,i.used_time+1):l.insertHistory({item_id:e,desc_id:t,remark:n})}))},searchByItems:function(e,t){return l.searchByItems(e,t)}};t["a"]=c},"8da6":function(e,t,n){var i=n("77ca");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("708a5e3a",i,!0,{})},"98a4":function(e,t,n){"use strict";n("e697");var i=n("85cd"),o=n("fd50"),r=n("a593"),a={model:{},init:function(){a.model.historyList={},a.model.currItemId="",a.model.currList=[]},loadList:function(e,t){return e?(_.isEmpty(a.model)&&a.init(),t=t||!1,a.model.currItemId=e,_.isEmpty(a.model.historyList[e])||t?(console.log("=== itemId ===",e),i["a"].getList(e).then((function(t){console.log(t),a.model.historyList[e]=t,a.model.currList=t})).catch((function(){a.model.historyList[e]=[],a.model.currList=[]}))):(a.model.currList=a.model.historyList[e],o["a"].resolve())):o["a"].reject()},upsertHistory:function(e,t,n){return i["a"].upsertHistory(e,t,n).then((function(){a.loadList(e,!0)}))},delHistory:function(e){return i["a"].deleteItem(e).then((function(){var t=_.find(a.model.currList,{id:e});if(t){var n=a.model.currList.indexOf(t);n>-1&&a.model.currList.splice(n,1)}})).catch((function(e){console.error(e),r["default"].prototype.$toast("删除历史失败！")}))}};t["a"]=a},a9ec:function(e,t,n){"use strict";n("6d57");var i=n("a593"),o=n("3fa2"),r=n("d485"),a=n("9af1"),l=n("77a8");function c(){var e={},t={problemList:[],buttons:[]},n={},c="tab-icon1",s={"待派单":"tab-icon5","待整改":"tab-icon2","已整改":"tab-icon3","已通过":"tab-icon4","已作废":"tab-icon6","非正常关闭":"tab-icon7"},d=o["a"].room;return n.iniStatusStyle=function(){t.problemList.forEach((function(e){s[e.status]?e.status_style=s[e.status]:e.status_style=c}))},n.initFilter=function(){return r["a"].getPositionList(d.batchRoomId).then((function(e){t.filterList.position.list=e}))},n.getCondition=function(){var e={};_.each(t.filterList,(function(t,n){e[n]=t.value}))},n.getProblemPoints=function(){i["default"].prototype.$eventBus.$emit("app.roomdetail:updateProblemPoints",t.problemList)},e={model:t,init:function(){return r["a"].getProblemList(d.batchRoomId,0,1,!0).then((function(e){t.problemList=e,n.iniStatusStyle()})).then((function(){return console.log("fromType------",d.fromType),a["a"].getDefaultFilterList(t.problemList,d.batchRoomId,d.fromType).then((function(e){l["a"].update(e),console.log("filters---------",e),n.getProblemPoints()}))})).then((function(){if(!_.isEmpty(l["a"].model.list))return e.updateProblemList()}))},updateProblemList:function(e){var i=l["a"].getCondition();a["a"].hideProblemByFilter(t.problemList,l["a"].model.list,i,e),n.getProblemPoints()}},e}t["a"]=c()},b643:function(e,t,n){"use strict";var i=n("7ee1");t["a"]={getReasonConfig:function(){return i["a"].getList()},getProblemReason:function(e){return i["a"].getProblemReason(e)}}},bad1:function(e,t,n){"use strict";var i=n("97ba");t["a"]={getPositionList:function(e){return console.log("batchRoomId",e),i["a"].getPositionList(e).then((function(e){return e}))},getPositionByIds:function(e){return i["a"].getPositionByIds(e)},getPositionNameById:function(e){return i["a"].getPositionNameById(e)}}},c0b8:function(e,t,n){var i=n("6313");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("85cb").default;o("c8e10432",i,!0,{})},db5f:function(e,t,n){"use strict";n("5ab2"),n("e44b"),n("e10e"),n("f0e6");var i=n("28f8"),o=(n("5f54"),n("6d57"),n("fd50")),r=n("c2c1"),a=n("0938"),l=n("8ae6"),c=n("a14a"),s=n.n(c),d=n("07a4"),m=n("a593"),h=n("98a4"),u=n("3fa2"),p=n("a9ec"),f=n("db99"),b=n("bad1"),g=n("964e"),_=n("0970"),v=n("5c1b"),k=n("dd0a"),y=n("4438"),I=n("b643"),w=n("bbed");function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=u["a"].room,A="",L="";function D(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];n.length>0?console.log("[model]/problem-model.js：",e,n):console.log("[model]/problem-model.js：",e)}function T(){if(!B.model.problem.contractorIds&&B.model.problem.checkItemId)return k["a"].getContractor(C.batchRoomId||B.model.problem.batchRoomId,B.model.problem.checkItemId,B.model.problem.descIds).then((function(e){var t=[],n=[];B.model.contractorDisabled=!1,s.a.isEmpty(e)||(s.a.each(e,(function(e){t.push(e.contractor_id),n.push(e.contractor_name)})),t.length>1&&(B.model.contractorDisabled=!0),t=t.join(";"),n=n.join("；"),B.model.problem.contractors=n,B.model.problem.contractorIds=t,B.model.problem.responsibilityUnitIds=t,B.model.problem.responsibilityUnits=n)}))}function S(){var e=B.model.problem.id?"editProblem":"addProblem";!B.model.selectes&&(B.model.selectes={position:{},checkItem:{},desc:{},contractor:{},responsibleCompany:{}}),B.model.positionDisabled||(B.model.selectes.position={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-position-select"),query:{fromPage:e}}),B.model.problem.positionId?(B.model.selectes.checkItem={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-checkitem-select/").concat((new Date).getTime()),query:{type:C.fromType,fitment_standard:C.fitmentStandard,fromPage:e,isSpecial:+C.isSpecial}},B.model.problem.checkItemId?(C.isSpecial||v["a"].getHigherLevelTreeListByCheckItemId(B.model.problem.checkItemId,B.model.problem.positionId,{fitment_standard:C.fitmentStandard}).then((function(t){B.model.selectes.checkItem.query=s.a.extend(B.model.selectes.checkItem.query,{history:JSON.stringify(t),level:0,fromPage:e})})),B.model.selectes.desc={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-desc-select"),query:{fromPage:e,fitment_standard:C.fitmentStandard,level:0}},B.model.selectes.contractor={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-contractor-select"),query:{fromPage:e}},B.model.selectes.responsibleCompany={path:"/checkroom/".concat(d["a"].state.app.global.currentMenuType||d["a"].state.app.global.currentBatchType,"-responsible-select"),query:{fromPage:e}}):B.model.selectes.checkItem.query=s.a.extend(B.model.selectes.checkItem.query,{batchId:C.batchId})):B.model.selectes.checkItem={}}function O(e){var t=e.coordinate?[JSON.parse(e.coordinate)]:[];return B.model.problem={projectId:e.projectId,problemStamp:e.problemStamp,positionId:e.positionId||"",diagramId:e.diagramId,positionName:"",checkItemId:e.checkItemId||"",checkItemName:e.checkItemName||"",topCheckItemId:e.checkItemId||"",checkItemGuide:!1,descIds:e.descIds||"",descNames:e.descNames||"",remark:e.remark||"",imageList:e.imageList||[],emergencyDegree:"一般",coordinates:t,contractors:"",contractorIds:"",responsibilityUnitIds:"",responsibilityUnits:"",isPassedWhenAdd:!1,isRemarkRequired:"",feedbackId:e.feedbackId,batchRoomId:e.batch_room_id},"roomDesignChange"!==e.problemType&&"feedbackRemainReply"!==e.problemType||(C={batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id}),B.model.positionId=null,B.setProblem(),o["a"].resolve()}function j(e){return g["a"].getProblem(e.problemId).then((function(t){var n=o["a"].when();return C&&!s.a.isEmpty(C)||(C={fromType:e.type,batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id,isSpecial:e.isSpecial,fitmentStandard:e.fitment_standard,batchId:t.batch_id}),n.then((function(){return t.problem_reason_ids=[],d["a"].state.app.global.enableProblemReason?I["a"].getProblemReason(e.problemId).then((function(e){return t.problem_reason_ids=e,o["a"].resolve(t)})):o["a"].resolve(t)}))})).then((function(t){B.model.problem={id:t.id,projectId:t.proj_id,positionId:t.position_id||"",positionName:t.position_name||"",diagramId:t.roomtype_diagram_id,checkItemId:t.item_id||"",checkItemName:t.item_name||"",topCheckItemId:t.top_item_id||"",checkItemGuide:!1,descIds:t.desc_id||"",descNames:t.desc||"",remark:t.remark,imageList:[],emergencyDegree:t.emergency_degree,coordinates:t.coordinates,contractors:t.contractor_name,contractorIds:t.contractor_id,responsibilityUnitIds:t.responsible_company_id,responsibilityUnits:t.responsible_company_name,isPassedWhenAdd:t.is_passed_when_add||!1,isRemarkRequired:t.isRemarkRequired,reasonIds:t.problem_reason_ids,batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id},t.problem_images.forEach((function(e){var t=l["a"].getImageRealPath(e.img_localpath);B.model.problem.imageList.push({localPath:e.img_localpath,fullPath:t,viewPath:l["a"].getImageWebViewPath(t)})})),console.log("==== _self.model.problem  ====",B.model.problem),A=t.remark,L=t.is_passed_when_add,B.model.positionId=t.position_id}))}var B={initUpdate:!0,model:{isLoaded:!1,positionId:"",problem:{imageList:[]},ProblemReasons:[],remarkChangeStatus:1},setProblem:function(e){var t={};B.model.positionDisabled=!1,B.model.checkItemDisabled=!1,B.model.descDisabled=!1,B.model.contractorDisabled=!1,"roomDesignChange"===B.model.problemType?(!s.a.isEmpty(e)&&(t={checkItemId:e.itemId,topCheckItemId:e.itemId,checkItemName:e.itemName,descIds:e.descId,descNames:e.descName,emergencyDegree:e.emergency_degree,remark:e.remark}),B.model.checkItemDisabled=!0,B.model.descDisabled=!0):"feedbackRemainReply"===B.model.problemType?(B.model.positionDisabled=!0,B.model.checkItemDisabled=!0):"fitmentStyle"===B.model.problemType?(!s.a.isEmpty(e)&&(t={checkItemId:e.checkItemId,topCheckItemId:e.checkItemId,checkItemName:e.checkItemName,emergencyDegree:"前置配置"===e.configType?"紧急":"一般",positionId:e.positionId||""}),B.model.positionDisabled=!0,B.model.checkItemDisabled=!0):"checkList"===B.model.problemType&&(!s.a.isEmpty(e)&&(B.model.problem=s.a.extend(B.model.problem||{},e)),S(),T(),B.initUpdate=!1),B.model.problem=s.a.extend(B.model.problem||{},t)},showGuide:function(){return B.model.problem.checkItemId?_["a"].getCheckItemGuideByItemId(B.model.problem.checkItemId).then((function(e){B.model.guideText=e,B.model.showGuide=!!e})):(B.model.guideText="",B.model.showGuide=!1,o["a"].resolve())},init:function(e){B.model.isLoaded=!1,B.model.title=e.problemId?"编辑问题":"feedbackRemainReply"!==e.problemType?"登记问题":e.title,B.model.problemType=e.problemType||"default";var t,n=d["a"].state.app.global.currentBatchType||"simulate";return B.model.enablePassWhenAdd=1==y["a"].getLocalBusinessToggle().enable_pass_when_add&&(m["default"].prototype.$checkRight("reinspect_problem",n)||m["default"].prototype.$checkRight("pass_problem",n)),B.model.ProblemReasons=[],console.log("=====",B.model),t=e.problemId?j(e):O(e),t.then((function(){return B.showGuide().then((function(){if(B.model.problem.positionId)return b["a"].getPositionNameById(B.model.problem.positionId).then((function(e){B.model.problem.positionName=e}))})).then((function(){B.initUpdate&&S()})).then((function(){if(d["a"].state.app.global.enableProblemReason)return I["a"].getReasonConfig().then((function(t){console.log("=== reasons ===",t),e.problemId&&t.forEach((function(e){m["default"].prototype.$set(e,"selected",B.model.problem.reasonIds.indexOf(e.id)>-1)})),B.model.ProblemReasons=t}))})).then((function(){B.model.isLoaded=!0})).catch((function(e){console.error(e),m["default"].prototype.$toast("获取相关数据失败，请返回或稍后重试")}))}))},updateProblem:function(e,t){return t=t||!1,B.model.problem=Object.assign({},B.model.problem,e),B.showGuide().then((function(){return S(),e.remark&&B.model.remarkChangeStatus++,D("updateProblem - 更新问题的字段：","updateProblem=".concat(t),e),t?T():o["a"].resolve()}))},takePhoto:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=l["a"].getNewProblemImagePath({folder:C.batchUnitId+"/"+C.batchRoomId,imageId:Object(a["j"])()});return console.log("take photo",t),r["a"].takePhoto(t.full_path,P({withGraffiti:!0,text:g["a"].getWatermarkText()},e)).then((function(){B.model.problem.imageList.push({localPath:t.save_path,fullPath:t.full_path,viewPath:t.view_path?t.view_path:l["a"].getImageWebViewPath(t.full_path)})}))},addProblem:function(e){e=e||"";var t=[];s.a.each(B.model.problem.imageList,(function(e){t.push({img_localpath:e.localPath})}));var n={problem_images:t,batch_room_id:C.batchRoomId||B.model.problem.batchRoomId,position_id:B.model.problem.positionId,item_id:B.model.problem.checkItemId,top_item_id:C.isSpecial?"":B.model.problem.topCheckItemId,desc_id:B.model.problem.descIds,contractor_id:B.model.problem.contractorIds,responsible_company_id:B.model.problem.responsibilityUnitIds,roomtype_diagram_id:B.model.problem.diagramId,coordinate:B.model.problem.coordinates,emergency_degree:B.model.problem.emergencyDegree,remark:B.model.problem.remark,is_passed_when_add:B.model.problem.isPassedWhenAdd?1:0,problemType:B.model.problemType,feedbackId:B.model.problem.feedbackId},i=[];return B.model.ProblemReasons.forEach((function(e){e.selected&&i.push(e.id)})),g["a"].batchAddProblem(n,C.isSpecial,e,i).then((function(){return w["a"].updateCheckItemUseTimes(B.model.problem.checkItemId).catch((function(e){window.$log("添加问题 updateCheckItemUseTimes catch & 参数",{error:e,curr_param:{checkItemId:B.model.problem.checkItemId}}),console.log("添加问题 updateCheckItemUseTimes catch & 参数",{error:e,curr_param:{checkItemId:B.model.problem.checkItemId}})}))})).then((function(){return w["a"].updateItemDescUseTimes(B.model.problem.descIds).catch((function(e){window.$log("添加问题 updateItemDescUseTimes catch & 参数",{error:e,curr_param:{descIds:B.model.problem.descIds}}),console.log("添加问题 updateItemDescUseTimes catch & 参数",{error:e,curr_param:{descIds:B.model.problem.descIds}})}))})).then((function(){return p["a"].init().catch((function(e){window.$log("添加问题 刷新房间问题model catch",e),console.error("添加问题 刷新房间问题model catch",e)})),C.mode})).catch((function(e){window.$log("添加问题 刷新房间问题model这一步的外部 catch",e),console.error("添加问题 刷新房间问题model这一步的外部 catch",e)})).finally((function(){console.log("添加问题 finally88"),B.model.problem.remark&&B.model.problem.descIds.indexOf(";")<0&&h["a"].upsertHistory(B.model.problem.checkItemId,B.model.problem.descIds,B.model.problem.remark).catch((function(e){window.$log("添加问题 finally catch",e),console.log("添加问题 finally catch",e)}))}))},editProblem:function(){var e=[],t=[];return s.a.each(B.model.problem.imageList,(function(e){t.push({img_localpath:e.localPath})})),B.model.ProblemReasons.forEach((function(t){t.selected&&e.push(t.id)})),g["a"].processEditProblem({id:B.model.problem.id,problem_images:t,batch_room_id:C.batchRoomId,position_id:B.model.problem.positionId,item_id:B.model.problem.checkItemId,top_item_id:C.isSpecial?"":B.model.problem.topCheckItemId,desc_id:B.model.problem.descIds,contractor_id:B.model.problem.contractorIds,responsible_company_id:B.model.problem.responsibilityUnitIds,emergency_degree:B.model.problem.emergencyDegree,remark:B.model.problem.remark,roomtype_diagram_id:B.model.problem.diagramId,coordinate:B.model.problem.coordinates,is_passed_when_add:B.model.problem.isPassedWhenAdd?1:0,is_passed_when_add_old:L},C.isSpecial,e).then((function(){f["a"].updateProblem(B.model.problem.id),p["a"].init()})).catch((function(e){return o["a"].reject(e)})).finally((function(){B.model.problem.remark&&B.model.problem.descIds.indexOf(";")<0&&A!=B.model.problem.remark&&h["a"].upsertHistory(B.model.problem.checkItemId,B.model.problem.descIds,B.model.problem.remark)}))}};t["a"]=B},db99:function(e,t,n){"use strict";n("6d57"),n("e697");var i=n("fd50"),o=(n("cc57"),n("9a33"),n("a324")),r=n("760e"),a=function(){var e=20,t={},n={},a={};return t={batch_unit_id:"cp.batch_unit_id",status:"cp.status",floor:"br.floor",item:"ci.id",user:"u.id"},n.formatData=function(e,t){var n=[],i=[];return _.each(e,(function(e){var o={};e.desc_id=e.desc_id.split(";"),_.each(e.desc_id,(function(e){n.indexOf(e)<0&&n.push(e)})),-1==e.floor.indexOf("层")&&-1==e.floor.indexOf("楼")&&-1==e.floor.indexOf("公共区域")&&(e.floor=e.floor+"楼"),o.id=e.id,o.code=e.code,o.batchRoomId=e.batch_room_id,o.batchUnitId=e.batch_unit_id,o.registerUserName=e.regist_user_name,o.roomtypeDiagramId=e.roomtype_diagram_id,o.status=e.status,o.roomName=t+"-"+e.floor+"-"+e.room_no,o.dealTime=e.deal_time&&"00-00-00 00:00:00"!==e.deal_time?e.deal_time:"",o.emergence=e.emergency_degree&&e.emergency_degree.indexOf("急")>-1?e.emergency_degree:"",o.sendBackTimes=e.sent_back_time||0,o.positionName=e.position,o.itemName=e.item,o.contractor=e.contractor||"",o.desc=e.desc_id,i.push(o)})),r["a"].getDescByIds(n).then((function(e){return _.each(i,(function(t){_.each(t.desc,(function(n,i){var o=_.find(e,{id:n});t.desc[i]=o?o.name:"无描述"})),t.desc=t.desc.join("、")})),i}))},n.getFilter=function(e,t){var n={status:o["a"].getCountOfProblemStatus,floor:o["a"].getCountOfFloor,item:o["a"].getCountOfCheckItem,user:o["a"].getCountOfRegister};return n[e](t)},a.createCondition=function(e,n){if(_.isEmpty(e))return"";"batch_unit_id"==n&&(n="");var i=[];return _.each(e,(function(e,o){t[o]&&o!==n&&i.push(t[o]+'="'+e+'"')})),i.join(" and ")},a.initFilter=function(){var e=[{type:"status",title:"问题状态",name:"",value:"",options:[]},{type:"floor",title:"楼层",name:"",value:"",options:[]},{type:"item",title:"检查项",name:"",value:"",options:[]},{type:"user",title:"登记人",name:"",value:"",options:[]}];return e},a.getProblems=function(t,r,l){var c=a.createCondition(r);return o["a"].getAllProblemListByPage(c,t,e).then((function(e){return!e||_.isEmpty(e)?[]:n.formatData(e,l)})).catch((function(e){return i["a"].reject(e)}))},a.getFilterCount=function(e){e=e||{};var o,r="",l={},c=[];return _.each(t,(function(t,i){"batch_unit_id"!==i&&(r=a.createCondition(e,i),o=n.getFilter(i,r).then((function(e){return{type:i,res:e}})),c.push(o))})),i["a"].all(c).then((function(e){return _.each(e,(function(e){if(e){var t=[],n=0;_.each(e.res,(function(e){t.push({count:e.count,name:e.name||e.title,value:e.value}),n+=e.count})),t.unshift({value:"",name:"全部",count:n}),l[e.type]=t}})),l}))},a.getSelectedProblems=function(e){var t=a.createCondition(e);return o["a"].getSelectedProblems(t)},a.passProblems=function(e){var t=[];return e.forEach((function(e){t.push(o["a"].passProblem(e.id,e.batchRoomId))})),i["a"].all(t)},a.getListInfoById=function(e,t){return o["a"].getListInfoById(e).then((function(e){return n.formatData([e],t).then((function(e){return e.shift()}))})).catch((function(e){return i["a"].reject(e)}))},a},l=a(),c=n("9072"),s=n("a14a"),d=n.n(s),m=function(){var e={},t=20,n={};function o(){d.a.isEmpty(e.filter)&&(e.filter=l.initFilter());var n=r(),i=[],o="";return l.getFilterCount(n).then((function(n){d.a.each(e.filter,(function(t,r){if(o=e.filter[r].value||"",t&&n[t.type]){var a=d.a.find(n[t.type],{value:o});a&&i.push(a.count),e.filter[r].options=n[t.type]}}));var r=Math.min.apply(null,i);e.totalPage=Math.ceil(r/t)}))}function r(){var t={batch_unit_id:e.batchUnitId};return d.a.each(e.filter,(function(e){e.value&&(t[e.type]=e.value)})),t}function a(){var t=i["a"].defer();if(e.isAllSelected){var n=r();l.getSelectedProblems(n).then((function(e){t.resolve(e)})).catch((function(e){t.reject(e)}))}else t.reject();return t.promise}function s(t){e.isAllSelected?e.problemList=[]:d.a.each(t,(function(t){var n=d.a.find(e.problemList,{id:t.id});if(n){var i=-1;e.problemList&&(i=e.problemList.indexOf(n)),i>-1&&e.problemList.splice(i,1)}}))}return e.filter=l.initFilter(),e.currPage=0,e.totalPage=0,e.problemList=[],e.isAllSelected=!1,n={model:e,init:function(t,o){var r=i["a"].when();return e.currPage=0,e.problemList=[],e.batchUnitId=t,e.unitName=o,e.currConditon={},1==window.isNeedClearAllData&&(e.filter=l.initFilter(),window.isNeedClearAllData=!1),null==window.take_photo_when_review&&r.then((function(){return c["a"].getReviewPhotoSetting()})),r.then((function(){return n.load(0)}))},load:function(t){if(t&&t==e.currPage)return i["a"].resolve();var n=r();return o(),l.getProblems(t,n,e.unitName).then((function(t){return e.isAllSelected&&t.forEach((function(e){e.checked=!0})),i["a"].resolve(t)})).then((function(n){return e.problemList=t?e.problemList.concat(n):n,e.currPage=t,i["a"].resolve(!0)}))},passProblems:function(e){var t=i["a"].defer(),n=function(e){l.passProblems(e).then((function(){s(e),t.resolve()})).catch((function(e){t.reject(e)}))};return e?n(e):a().then(n),t.promise},updateProblem:function(t){var n=d.a.find(e.problemList,{id:t});return n?l.getListInfoById(t,e.unitName).then((function(t){if(!d.a.isEmpty(t)){if(""!=e.filter[0].value&&n.status!=t.status){var i=e.problemList.indexOf(n);i>-1&&e.problemList.splice(i,1)}else n=d.a.extend(n,t);o(),$rootScope.$$phase||$rootScope.$digest()}})):i["a"].resolve()}}};t["a"]=m()},f97d:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAADa0lEQVRYR9WZO2hUQRSG/zN7MYRgkRhEURRMoYKNGtGsEkj2TlLYCGrwVVn4IoplLIQFCy1FxaiFlQ+MKWwsNnNvAqIbwVehoCkUFEXRmBQh+GB3jhy9G9Y1utnNRscptpmdM989Z85jzhDKGMlkUjU1Na3xPK+FmVcz81Iims/Ms0UcEY0x81siGiKiB5lMZmBwcPBeMpm0pW5HpSwIw3CBtbaTmXcR0cJS1jLzayK6pJQ6k0gk3kx17ZQAgyCYw8zHAOwGUBUJfwEgBeA2gKdE9GpkZGRM5urq6mYz8yIAywFsANAOYEm07guAi0R01Pf9j8VAiwIGQbCNmU8DqAeQBdATaSFdTHj+fBiGcdE+gA4AMQDDRNTp+/61P8n5LeDAwICXyWQEbF90rkw2mz3U3t7+rBSwwv+mUqllsVjsFDPraO6c53kHW1paMpPJnRQwnU5Xj4+PXwewkYg+ATjs+/6F6YAVrg2CYA+Ak8xcDeBmTU3N1ng8Lnv9NH4BjDR3Q+AAvGfmjW1tbfcrCZeT1dfX10hENwHMFUjP8zYVavIXQGNMd2TW97FYrLm1tXVoJuByMvv7+5dms9lbEeQ5rfX+/P1+Aowc4qqY1VrbPFOaK/xg0aRS6paYm4i25TvOBGAUSsQB6olob6XPXDEryJlk5vORdy/LhaAJQGPMWQD7icj4vt9WTOBMzAdB0Bd5d7fW+sD36CE/UYZ4DsCz1q6YbigpF15CkFLqCYCMUqpBMs53QGPMcQBdAK5qrXeUu0El1hljrgDYDuCE1voISeKPx+MvJbcqpdYnEomSMkQloCbJOHckd6fT6cWUSqXWKqXuAnihtW6o9IblyDPGyHFbYq1dR2EYdllrxcQTB7McoZVck3NYpdQRMsb0AtgMYKfWWuz/z4cxRvzgMhH1CuBjACsArNJaP/rndD+cdiWAhwCeUBAEH5hZgnP9VOqzv/EBUdKQcmxYNPhZitDR0dGqjo6Or38DoNgePT09s2pra6Ww/eI+4P9gYped5LE4yXVm3uJsmHE+UDuf6pwvFpwvt/6LgjXSorslvwA6f2mKIKUP4+a1M5fAnb64C6TzrQ+BdLp5lDO10+23/ILS2QZmAaS7LeCCS7WbTfTCO0T+M4S1thGAPEPMK3iGeAdgSCl1fzrPEN8Ajn19wtuO19cAAAAASUVORK5CYII="},fa1b:function(e,t,n){"use strict";var i=n("1834");t["a"]={getCheckItemList:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=[e],a="select bc.item_id, ci.full_name as item_full_name  from batch_checkitem bc  inner join check_item ci on ci.id = bc.item_id  where bc.batch_id = ? ";if(a+=t?" and ci.is_for_rough = 1 ":" and ci.is_for_decorated = 1 ",n){var l=o?"project_position_checkitem":"position_checkitem";a+=" and bc.item_id in                     (select item_id from "+l+" where position_id = ? )",r.push(n)}return a+=" order by ci.sort ",i["a"].query(a,r)}}}}]);