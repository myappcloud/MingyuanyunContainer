(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-325e4b3c"],{"0523":function(t,e,i){"use strict";i("6d57");var o=i("c6e3"),n=i("fd50"),a=i("a654"),r=i("c2c1"),l=i("8ae6"),s=function(t){return o["a"].getRoomBaseInfo(t)},c=function(t){return o["a"].getRoomCustomer(t)},d=function(t,e,i){var o,n={batch_unit_id:t,unit_list:[]},a="0";(_.isEmpty(e)||1===e.length&&""===e[0])&&(o=!0,e=[a]);var r={unit:[""],floor_list:[],status_counter:{all:0}};n.unit_list.push(r);for(var l=0;l<e.length;l++){var s=e[l],c={floor:s,room_list:[]};r.floor_list.push(c);for(var d=0;d<i.length;d++){var f=i[d];!o&&f.floor!=s||f.batch_unit_id!=t||(f.floor=o?a:f.floor,c.room_list.push(f),r.status_counter["all"]+=1,f.room_status in r.status_counter?r.status_counter[f.room_status]+=1:r.status_counter[f.room_status]=1)}}return n},f=function(t){return o["a"].getRoomIsReviewed(t)},u=function(t){return o["a"].getRoomTypeDiagram(t).then((function(t){if(!t)return!1;var e=n["a"].when(!1);return t.forEach((function(t){e=e.then((function(e){return e?n["a"].resolve(!0):r["a"].checkFileIsExists(Object(l["e"])()+t.path)}))})),e}))},h=function(t){return o["a"].getDiagramById(t).then((function(t){if(t){if("dev"==window.ZHKF_GLOBAL_ENV.VUE_APP_ENV)return t.url;var e=Object(l["e"])()+t.path;return console.log(e,"========================"),r["a"].checkFileIsExists(e).then((function(t){return t?e:null}))}return null}))},m=function(t){try{return u(t).catch((function(){return!1})).then((function(t){return!!t}))}catch(e){return console.error(e),n["a"].when(!1)}},p=function(t){return a["a"].existsDesignChange(t)},g=function(t){return a["a"].getDesignChange(t)},b=function(t,e){return a["a"].addDesignChangeProblem(t,e)},v=function(t){return s(t).then((function(t){return t.building_name+(t.unit?t.unit+(t.unit.indexOf("单元")>-1?"":"单元"):"")+(-1==t.floor.indexOf("层")&&-1==t.floor.indexOf("楼")&&-1==t.floor.indexOf("公共区域")?t.floor+"楼":t.floor)+(-1!==t.room_no.indexOf("公共区域")?t.floor+"层 公共区域":t.room_no)}))};e["a"]={getRoomBaseInfo:s,getRoomCustomer:c,buildRoomListData:d,getRoomIsReviewed:f,getRoomTypeImageFileIsExists:u,getRoomTypeImageFileIsExistsIgnoreError:m,existsRoomDesignChange:p,getRoomDesignChange:g,addRoomDesignChangeProblem:b,getRoomTitle:v,getDiagramFullPathById:h,getBatchRoomList:function(t,e){return o["a"].getBatchRoomList(t,e)}}},"1ec3":function(t,e,i){var o=i("3e9b");"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var n=i("85cb").default;n("7da787f6",o,!0,{})},"28c8":function(t,e,i){"use strict";i("6d57");var o=i("1834"),n=i("0938");e["a"]={getRoomSatisfactionValueList:function(t,e){var i="                 select sd.id , sd.dimension as name , rsv.value                 from satisfaction_dimension sd                     left join room_satisfaction_value rsv                         on rsv.batch_room_id = ? and sd.id = rsv.dimension_id                 where sd.type = ?                 order by sd.sort , sd.dimension";return o["a"].query(i,[e,t])},saveRoomSatisfactionValue:function(t,e,i){var a,r=["batch_id","batch_room_id","batch_unit_id","dimension_id","id","source","value"];if(!e)throw new TypeError("saveRoomSatisfactionValue: batchRoomId为空");t.delete("room_satisfaction_value",{batch_room_id:e},(function(){i&&i.length&&i.forEach((function(i){i.id=Object(n["j"])(),i.batch_room_id=e,console.log("字段=====",i),a=o["a"].getColumnsValues(i,r),t.insert("room_satisfaction_value",r,a)}))}))}}},"3e9b":function(t,e,i){e=t.exports=i("690e")(!1),e.push([t.i,"\n.zhkf .filter[data-v-c89c18e4] {\n  background: #fff;\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n}\n.zhkf .pull-left[data-v-c89c18e4] {\n  float: left;\n}\n.zhkf .check[data-v-c89c18e4] {\n  width: 23px;\n  height: 40px;\n}\n.zhkf .pull-right[data-v-c89c18e4] {\n  float: right;\n}\n.zhkf .clearfix[data-v-c89c18e4]:before,\n.zhkf .clearfix[data-v-c89c18e4]:after {\n  content: ' ';\n  display: table;\n}\n.zhkf .clearfix[data-v-c89c18e4]:after {\n  clear: both;\n}\n.zhkf .filter-header[data-v-c89c18e4] {\n  height: 45px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n  -ms-flex-wrap: nowrap;\n      flex-wrap: nowrap;\n  -webkit-box-flex: 0;\n      -ms-flex: 0 0 auto;\n          flex: 0 0 auto;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.zhkf .filter-header .filter-item[data-v-c89c18e4] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1 1 auto;\n            flex: 1 1 auto;\n    text-align: center;\n    padding: 10px 0;\n    width: 20%;\n    line-height: 25px;\n    color: #606060;\n}\n.zhkf .filter-header .filter-item .filter-desc[data-v-c89c18e4] {\n      height: 100%;\n      overflow: hidden;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      font-size: 14px;\n}\n.zhkf .filter-header .filter-item .filter-desc .icon-hebingxingzhuang1[data-v-c89c18e4],\n      .zhkf .filter-header .filter-item .filter-desc .icon-hebingxingzhuang[data-v-c89c18e4] {\n        font-size: 10px;\n        color: #d2d2d7;\n        vertical-align: middle;\n}\n.zhkf .filter-header .filter-item .filter-desc img[data-v-c89c18e4] {\n        width: 10px;\n        height: 10px;\n}\n.zhkf .filter-header .filter-item:first-child .filter-desc[data-v-c89c18e4] {\n      border-left: 0;\n}\n.zhkf .filter-header .filter-item__active[data-v-c89c18e4] {\n    color: #0085ff;\n}\n.zhkf .filter-header .filter-item__active .filter-desc .icon-hebingxingzhuang1[data-v-c89c18e4],\n    .zhkf .filter-header .filter-item__active .filter-desc .icon-hebingxingzhuang[data-v-c89c18e4] {\n      color: #0085ff;\n}\n.zhkf .filter-header .filter-item__disabled[data-v-c89c18e4] {\n    color: #a0a0a0;\n}\n.zhkf .filter-header .filter-item__disabled .filter-desc .icon-hebingxingzhuang1[data-v-c89c18e4],\n    .zhkf .filter-header .filter-item__disabled .filter-desc .icon-hebingxingzhuang[data-v-c89c18e4] {\n      color: #a0a0a0;\n}\n.zhkf .filter-content[data-v-c89c18e4] {\n  width: 100%;\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.35);\n  z-index: 9999;\n}\n.zhkf .filter-content .filter-list[data-v-c89c18e4] {\n    background: #fff;\n    max-height: 320px;\n    overflow: scroll;\n}\n.zhkf .filter-content .filter-list .filter-cell[data-v-c89c18e4] {\n      height: 40px;\n      line-height: 40px;\n      padding: 0 15px;\n      font-size: 14px;\n      color: #606060;\n}\n.zhkf .filter-content .filter-list .filter-cell[data-v-c89c18e4]:last-child {\n        border-bottom: 0;\n}\n.zhkf .filter-content .filter-list .filter-cell__active[data-v-c89c18e4] {\n      color: #0085ff;\n}\n",""])},"92f0":function(t,e,i){"use strict";i("f0e6"),i("e697");var o=i("fd50"),n=i("a18c"),a=i("a593"),r=i("99ee"),l=i("964e"),s=i("ff29"),c=i("af4c"),d=i("a14a"),f=i.n(d),u=function(){var t={},e={allSelected:!1,nextRoomId:"",nextRoom:{},roomName:"",currPage:0,totalPage:0,list:[],filterList:[]},i=!1,d={},u=20;return t.getConditions=function(){var t={batchRoomId:d.id};return f.a.each(e.filterList,(function(e){t[e.type]=e.id})),t.position||(t.checkItem=""),t},t.setFilter=function(t,e,i){var o=f.a.find(t,{id:e});o||(o={id:e,name:i,count:0},t.push(o)),o.count++},t.setAllFilter=function(t){var e=0;f.a.each(t,(function(t){e+=t.count})),t.unshift({id:"",name:"全部",count:e})},t.getFilter=function(i){var o=t.getConditions(),n=[];return!o[i]&&(i=""),s["a"].getProblemFilters(o,i).then((function(t){if(f.a.each(e.filterList,(function(o,a){if(t[o.type]||i===o.type){var r=e.filterList[a].value||"";if(o&&t[o.type]){var l=f.a.filter(t[o.type],{id:r});l&&l[0]&&n.push(l[0].count),e.filterList[a].options=t[o.type]}}else o.id="",o.name="",o.options=[]})),n.length){var o=Math.min.apply(null,n);e.totalPage=Math.ceil(o/u)}console.log(e.filterList)}))},t.getProblemList=function(i){var o=t.getConditions(),n=i?0:e.currPage*u;return s["a"].getProblemListByBatchRoomId(o,n,u).then((function(t){e.list=n?e.list.concat(t):t,e.currPage++}))},t.getNextRoom=function(){i=!1;var t=d.id,o=[];f.a.each(r["a"].model.list,(function(t){o=o.concat(t.roomList)}));var n=f.a.find(o,{id:t}),a=f.a.indexOf(o,n);a<0?(e.nextRoomId="",e.nextRoom=""):a==o.length-1?(e.nextRoomId="",e.nextRoom="",o[a-1]||(i=!0)):(e.nextRoomId=o[a+1].id,e.nextRoom=o[a+1])},t.init=function(i){return i=i||!1,!i&&r["a"].model.currRoom&&r["a"].model.currRoom.id===d.id?o["a"].resolve():(e.allSelected=!1,e.nextRoomId="",e.nextRoom={},e.roomName="",e.list=[],e.currPage=0,e.totalPage=0,e.filterList=[{id:"",name:"",label:"部位",type:"position",options:[]},{id:"",name:"",label:"检查项",type:"checkItem",options:[]},{id:"",name:"",label:"登记人",type:"register",options:[]}],d=r["a"].model.currRoom,t.getProblemList(!0).then((function(){return e.roomName=r["a"].model.unitName+"-"+d.room_no,e.roomName=e.roomName.length>16?"..."+e.roomName.substr(e.roomName.length-16,16):e.roomName,t.getNextRoom(),t.getFilter()})))},t.toNextRoom=function(){return r["a"].model.currRoom=e.nextRoom,e.roomName=r["a"].model.unitName+"-"+e.nextRoom.room_no,e.roomName=e.roomName.length>16?"..."+e.roomName.substr(e.roomName.length-16,16):e.roomName,a["default"].$comComps.toast.show("查验下一个房间 "+e.roomName,3e3),t.init()},t.refresh=function(i){!f.a.isArray(i)&&(i=[i]),console.log(i,"------ids====",e.list);var o=t.getConditions(),n=i.length;return e.list.length-n<=0||e.allSelected?t.init(!0):(e.allSelected=!1,f.a.each(i,(function(t){var i=f.a.find(e.list,{id:t});i&&(e.list=e.list.filter((function(t){return t!==i})))})),s["a"].getProblemFilters(o).then((function(t){f.a.each(t,(function(i,o){var n=f.a.find(e.filterList,{type:o});if(n){n.options=t[o];var a=f.a.find(n.options,{id:n.id});f.a.isEmpty(a)&&(n.id="",n.name="")}}))})))},t.resetPage=function(){e.currPage=0,e.totalPage=0,e.allSelected=!1},{model:e,init:t.init,getProblemList:t.getProblemList,getFilter:t.getFilter,getConditions:t.getConditions,resetPage:t.resetPage,passProblem:function(t){return l["a"].batchPassRoomProblem(t,d.id)},toNextRoom:t.toNextRoom,refresh:function(r,l){return l=l||!1,s["a"].hasMoreProblem(d.id).then((function(l){if(!l&&e.nextRoomId)return n["a"].go(-1),t.toNextRoom();if(l)return n["a"].go(-1),t.refresh(r);if(c["a"].model.currFloor&&c["a"].model.currFloor.roomList.length-1){var s=c["a"].model,d=s.batchUnitId,f=s.moduleType;return c["a"].init(d,f,!0).finally((function(){n["a"].go(-2)}))}return n["a"].go(-3),i&&(a["default"].$comComps.toast.show("恭喜，该楼栋已复验完毕",2e3),t.init(!0)),o["a"].resolve()})).then((function(){l&&c["a"].updateRoomList()}))},loadMore:function(){return e.currPage<e.totalPage?t.getProblemList():o["a"].resolve()},getSelected:function(){var i=[],n=o["a"].defer();if(e.allSelected){var a=t.getConditions();s["a"].getAllProblemIds(a).then((function(t){f.a.each(t,(function(t){i.push(t.id)})),n.resolve(i)}))}else f.a.each(e.list,(function(t){t.selected&&i.push(t.id)})),n.resolve(i);return n.promise}}};e["a"]=u()},9335:function(t,e,i){"use strict";i.r(e);i("5ab2"),i("e44b"),i("e10e"),i("6d57"),i("f0e6"),i("cc57");var o=i("28f8"),n=i("e786"),a=i("2297"),r=i("6583"),l=i("438a"),s=i("cda3"),c=i("92f0"),d=i("c42d"),f=i("99ee"),u=i("ee1f"),h=i("f2de"),m=i("4778");function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function g(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){Object(o["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var _={name:"ReinspectProblem",components:{problemItem:n["a"],problemBtn:a["a"],topTip:r["a"],emptyPage:l["a"],PList:m["a"],problemFilter:s["a"]},data:function(){return{model:{},pageLoading:!1,loadingData:!1,finished:!1,hasNetwork:!0,hasMoreProblemData:!0,noProblemData:!1,canBatchPass:!1,showItem:!1,canBatchSendBack:!1,showEmpty:!1,isShowProjectChange:!1,emptySrc:i("b98c"),wrapperScrollTop:0}},computed:g({},Object(h["e"])({currentBatchType:function(t){return t.app.global.currentBatchType},currentMenuType:function(t){return t.app.global.currentMenuType},currentItem:function(t){return t.projectList.currentItem},contentHeight:function(t){return t.app.global.contentHeight},footerHeight:function(t){return t.app.global.footerHeight}})),watch:{$route:function(t,e){"todo"===e.name?this.isShowProjectChange=!0:this.isShowProjectChange=!1,"todoProblemBack"===e.name&&this.init()},currentItem:function(t,e){"todo"===this.$route.name&&this.$route.name.indexOf("ReinspectProblem")>-1&&this.$router.isForward&&t&&t.id!==(e&&e.id)&&this.init()},showItem:function(t){t&&this.$refs.filterElement.maskClickHandler()}},activated:function(){this.$router.isForward?this.wrapperScrollTop=0:this.$refs.problemList.scrollTop=this.wrapperScrollTop},created:function(){var t=~~window.take_photo_when_review;this.canBatchPass=this.$checkRight("batch_pass_problem","AppToDo")&&2!=t,this.canBatchSendBack=this.$checkRight("batch_send_back_problem","AppToDo"),this.getNetwork(),this.init()},methods:{getNetwork:function(){var t=this;return d["a"].getHasNetwork().then((function(e){t.hasNetwork=e}))},init:function(){var t=this;this.showEmpty=!1,this.pageLoading=!0,c["a"].init(!0).finally((function(){t.model=c["a"].model,console.log(t.model,"=========="),t.updatePageStatus()})).catch((function(t){return console.log(t.message)}))},getNext:function(){var t=this;return this.showEmpty=!1,this.pageLoading=!0,c["a"].toNextRoom().then((function(e){t.updatePageStatus()}))},selectItem:function(t){if(!this.hasNetwork)return this.$toast("当前无网络，请联网操作"),!1;this.$set(t,"selected",!t.selected);for(var e=!0,i=this.model.list,o=0;o<i.length;o++)if(!i[o].selected){e=!1;break}this.model.allSelected=e},openDetail:function(t){console.log(t),this.wrapperScrollTop=this.$refs.problemList.scrollTop,this.$router.push({path:"/checkroom/".concat(this.currentMenuType||this.currentBatchType,"-problem-detail"),query:{question_id:t.id,batch_room_id:t.batch_room_id,batch_unit_id:t.batch_unit_id,building_id:t.building_id,title:t.roomName,type:"todo"}})},select:function(){var t=this;this.model.allSelected=!this.model.allSelected,console.log(this.model),this.model.list.forEach((function(e){t.$set(e,"selected",t.model.allSelected)}))},action:function(t){var e=this;return this.hasNetwork?c["a"].getSelected().then((function(i){if(!i.length)return e.$toast("请选择问题"),!1;"sendback"===t?(u["a"].set({problemIds:i,batchRoomId:f["a"].model.currRoom.id}),e.$router.push({path:"/checkroom/".concat(e.currentMenuType||e.currentBatchType,"-problem-back"),query:{from:"todo"}})):e.$dialog.confirm({message:"确认当前选中问题均已整改通过？",confirmButtonText:"确认"}).then((function(){return e.$comComps.toast.show("问题处理中。。。"),c["a"].passProblem(i).then((function(){return e.$comComps.toast.hide(),e.model.allSelected=!1,c["a"].refresh(i,!0)})).catch((function(t){e.$comComps.toast.hide(),console.error(t),e.$toast("通过问题失败"),window.$log("通过问题失败",t)}))}))})):(this.$toast("当前无网络，请联网操作"),!1)},chooseFilterItem:function(t,e){var i=this;this.pageLoading=!0,console.log(t,e);var o=this.model.filterList,n=o.length;while(n--)(o[n]!==e||!o[n].id)&&(o[n].options=[]);console.log(e,"=======-=-=-=-"),c["a"].getFilter(e.type).then((function(){c["a"].resetPage(),c["a"].getProblemList(),model.filterList[0].id||(model.filterList[1].id="",model.filterList[1].name="",model.filterList[1].options=[]),i.updatePageStatus()})).finally((function(){i.pageLoading=!1}))},onLoad:function(){var t=this;if(console.log(this.hasMoreProblemData),!this.hasMoreProblemData)return this.loadingData=!1,this.finished=!0,!1;var e=this.model.currPage;return this.loadingData=!0,c["a"].loadMore().then((function(){t.updatePageStatus()})).finally((function(){t.hasMoreProblemData&&e===t.model.currPage&&(t.hasMoreProblemData=!1),t.loadingData=!1})).catch((function(t){return console.log(t)}))},updatePageStatus:function(){var t=this;this.pageLoading=!1,this.model.list.length||(this.showEmpty=!0),this.hasMoreProblemData=this.model.currPage<this.model.totalPage,this.noProblemData=!this.model.list.length&&!this.hasMoreProblemData,this.model.allSelected&&this.model.list.forEach((function(e){t.$set(e,"selected",t.model.allSelected)}))}}},b=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"dispatch-problem",attrs:{flag:t.model.roomName}},[o("cus-nav-bar",{attrs:{title:t.model.roomName,"left-arrow":""},on:{"click-right":function(e){return t.getNext()}}},[o("div",{attrs:{slot:"title"},slot:"title"},[t.isShowProjectChange?o("p-list",{model:{value:t.showItem,callback:function(e){t.showItem=e},expression:"showItem"}}):t._e(),t._v(" "),t.isShowProjectChange?t._e():o("div",[t._v(t._s(t.model.roomName))])],1),t._v(" "),t.model.nextRoomId?o("div",{staticClass:"toggleBtn",attrs:{slot:"right"},slot:"right"},[t._v("下个房间")]):t._e()]),t._v(" "),o("empty-page",{attrs:{"show-empty":t.pageLoading,"loading-page":!0,"empty-msg":"正在加载问题，请稍等"}}),t._v(" "),o("empty-page",{attrs:{"show-empty":t.noProblemData,"empty-img-src":t.emptySrc,"empty-msg":"本地暂无问题，请先下载房间数据"}}),t._v(" "),o("top-tip",{attrs:{show:!t.hasNetwork,message:"当前无网络，请在有网络的时候进行指派",icon:i("02f9"),"icon-width":23}}),t._v(" "),t.model.filterList&&t.model.filterList.length&&!t.pageLoading&&!t.showEmpty?o("problem-filter",{ref:"filterElement",attrs:{"filter-list":t.model.filterList},on:{chooseItem:t.chooseFilterItem}}):t._e(),t._v(" "),t.model.list&&t.model.list.length&&!t.pageLoading&&!t.noProblemData?o("div",{ref:"problemList",staticClass:"problem-list"},[o("van-list",{staticClass:"list-container",attrs:{finished:t.finished},on:{load:t.onLoad},model:{value:t.loadingData,callback:function(e){t.loadingData=e},expression:"loadingData"}},t._l(t.model.list,(function(e){return o("problem-item",{key:e.id,attrs:{type:"reinspect",item:e},on:{selectItem:t.selectItem,openDetail:t.openDetail}})})),1)],1):t._e(),t._v(" "),!t.canBatchPass&&!t.canBatchSendBack||t.showEmpty||t.noProblemData?t._e():o("div",{staticClass:"footer van-hairline--top"},[o("div",{staticClass:"item-left",on:{click:function(e){return e.stopPropagation(),t.select()}}},[o("img",{directives:[{name:"show",rawName:"v-show",value:t.model.allSelected,expression:"model.allSelected"}],attrs:{src:i("2985"),alt:"selected",width:"20",height:"20"}}),t._v(" "),o("img",{directives:[{name:"show",rawName:"v-show",value:!t.model.allSelected,expression:"!model.allSelected"}],attrs:{src:i("f97d"),alt:"select",width:"20",height:"20"}}),t._v(" "),o("span",[t._v("全选")])]),t._v(" "),o("ul",{staticClass:"btn-wrapper"},[t.canBatchSendBack?o("li",{staticClass:"back",on:{click:function(e){return t.action("sendback")}}},[t._v("退回")]):t._e(),t._v(" "),t.canBatchPass?o("li",{staticClass:"pass",on:{click:t.action}},[t._v("通过")]):t._e()])])],1)},v=[],w=i("d082");function x(t){i("dac5")}var y=!1,k=x,P="data-v-002ca788",R=null,I=Object(w["a"])(_,b,v,y,k,P,R);e["default"]=I.exports},a654:function(t,e,i){"use strict";var o=i("1834"),n=i("0938");e["a"]={existsDesignChange:function(t){var e="select 1 from room_design_change a inner join batch_room b on a.room_id = b.room_id where b.id = ?";return o["a"].queryOne(e,[t]).then((function(t){return!_.isEmpty(t)}))},getDesignChange:function(t){var e="select a.id, a.location, a.content, a.remark, a.sort from room_design_change a inner join batch_room b on a.room_id = b.room_id where b.id = ? order by a.sort";return o["a"].query(e,[t])},addDesignChangeProblem:function(t,e){if(t&&e){var i=n["a"].uuid();o["a"].insert("room_design_change_problem",["id","design_change_id","checkroom_problem_id"],[i,e,t])}}}},af93:function(t,e,i){"use strict";var o=i("1834");e["a"]={getRoomTypeDiagramList:function(t){var e="select rdp.id,rdp.coordinate,rdp.position_id,rdp.diagram_id from roomtype_diagram_partition rdp              inner join batch_room br on br.room_type_id = rdp.roomtype_id              inner join position p on p.id = rdp.position_id             where br.id = ?";return o["a"].query(e,[t])},hasRoomTypeDiagram:function(t){var e="select count(rdp.id) as count from roomtype_diagram_partition rdp              inner join batch_room br on br.room_type_id = rdp.roomtype_id              where br.id = ? and rdp.coordinate <> ''";return o["a"].queryOne(e,[t]).then((function(t){return t.count>0}))},isPositionInDiagram:function(t,e){return o["a"].exists("roomtype_diagram_partition",{diagram_id:t,position_id:e})},getHasPartitionByDiagramId:function(t){return o["a"].exists("roomtype_diagram_partition",{diagram_id:t})}}},cda3:function(t,e,i){"use strict";i("cc57");var o={props:{filterList:{type:Array,default:function(){return[]}}},data:function(){return{top:0,showFilterContent:!1,currFilter:{},currIndex:""}},mounted:function(){this.initPosition()},updated:function(){this.initPosition()},methods:{initPosition:function(){var t=this.$refs.filterHeader;this.top=t.offsetTop+t.offsetHeight},changeFilter:function(t){return this.currFilter=this.filterList[t],this.currFilter.options.length<2?this.$toast("请先选择部位"):t===this.currIndex?(this.maskClickHandler(),this.currIndex="",!1):(this.currIndex=t,this.showFilterContent=!0,void this.$emit("changeFilter",t))},maskClickHandler:function(){this.showFilterContent=!1,this.currFilter={},this.currIndex=""},chooseItem:function(t,e){this.currFilter.name=this.currFilter.options[t].name,this.currFilter.id!=this.currFilter.options[t].id&&(this.currFilter.id=this.currFilter.options[t].id,console.log(this.currFilter),this.currFilter={},this.$emit("chooseItem",t,e))}}},n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"filter"},[o("ul",{ref:"filterHeader",staticClass:"filter-header van-hairline--bottom"},t._l(t.filterList,(function(e,i){return o("li",{key:i,staticClass:"filter-item",class:{"filter-item__active":t.currFilter.type===e.type||e.id,"filter-item__disabled":"checkItem"==e.type&&e.options.length<2},on:{click:function(e){return t.changeFilter(i)}}},[o("div",{staticClass:"filter-desc van-hairline--left"},[o("span",{staticClass:"filter-title"},[t._v(t._s(e.id?e.name:e.label))]),t._v(" "),o("i",{staticClass:"iconfont",class:t.currIndex===i&&t.showFilterContent?"icon-hebingxingzhuang":"icon-hebingxingzhuang1"})])])})),0),t._v(" "),t.showFilterContent?o("div",{staticClass:"filter-content",style:{top:t.top+"px"},on:{click:t.maskClickHandler}},[o("ul",{staticClass:"filter-list"},t._l(t.currFilter.options,(function(e,n){return o("li",{key:n,staticClass:"filter-cell van-hairline--bottom",class:{"filter-cell__active":t.currFilter.id===e.id},on:{click:function(e){return t.chooseItem(n,t.currFilter)}}},[o("span",{staticClass:"pull-left check"},[o("img",{directives:[{name:"show",rawName:"v-show",value:t.currFilter.id===e.id,expression:"currFilter.id === item.id"}],attrs:{width:"13",src:i("2cf73"),alt:""}})]),t._v(" "),o("span",{staticClass:"pull-left"},[t._v(t._s(e.name))]),t._v(" "),o("span",{staticClass:"pull-right"},[t._v(t._s(e.count))])])})),0)]):t._e()])},a=[],r=i("d082");function l(t){i("1ec3")}var s=!1,c=l,d="data-v-c89c18e4",f=null,u=Object(r["a"])(o,n,a,s,c,d,f);e["a"]=u.exports},d341:function(t,e,i){e=t.exports=i("690e")(!1),e.push([t.i,"\n.zhkf .dispatch-problem[data-v-002ca788] {\n  height: 100%;\n  background: #fff;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .dispatch-problem .problem-list[data-v-002ca788] {\n    overflow: scroll;\n    padding-left: 10px;\n    padding-right: 10px;\n    background: #f4f4f4;\n    -webkit-box-flex: 1;\n        -ms-flex-positive: 1;\n            flex-grow: 1;\n    max-height: 100%;\n}\n.zhkf .dispatch-problem .problem-list .list-container[data-v-002ca788] {\n      margin-bottom: 10px;\n}\n.zhkf .dispatch-problem .problem-list .problem-item.van-hairline--bottom[data-v-002ca788]::after {\n      display: none;\n}\n.zhkf .toggleBtn[data-v-002ca788] {\n  color: #202020;\n  white-space: nowrap;\n}\n.zhkf .footer[data-v-002ca788] {\n  background: #fff;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  height: 60px;\n  padding: 7px 12px;\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n}\n.zhkf .footer .item-left[data-v-002ca788] {\n    width: 100px;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    color: #0099ff;\n    font-size: 16px;\n}\n.zhkf .footer .item-left span[data-v-002ca788] {\n      margin-left: 8px;\n}\n.zhkf .footer .btn-wrapper[data-v-002ca788] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    height: 46px;\n}\n.zhkf .footer .btn-wrapper li[data-v-002ca788] {\n      -webkit-box-flex: 1;\n          -ms-flex: 1;\n              flex: 1;\n      text-align: center;\n      line-height: 45px;\n      font-size: 16px;\n}\n.zhkf .footer .btn-wrapper li.unusual[data-v-002ca788], .zhkf .footer .btn-wrapper li.back[data-v-002ca788] {\n        background: #fff;\n        color: #0099ff;\n        border-radius: 23px;\n        border: 1px solid #0099ff;\n}\n.zhkf .footer .btn-wrapper li.pass[data-v-002ca788] {\n        background: -webkit-gradient(linear, right top, left top, from(#0085ff), to(#02b8ff));\n        background: linear-gradient(270deg, #0085ff 0%, #02b8ff 100%);\n        color: #fff;\n        border-radius: 23px;\n}\n.zhkf .footer .btn-wrapper li[data-v-002ca788]:last-child {\n        background: -webkit-gradient(linear, right top, left top, from(#0085ff), to(#02b8ff)) !important;\n        background: linear-gradient(270deg, #0085ff 0%, #02b8ff 100%) !important;\n        color: #fff !important;\n}\n.zhkf .footer .btn-wrapper li[data-v-002ca788]:not(:first-child) {\n        margin-left: 12px;\n}\n",""])},d42a:function(t,e,i){"use strict";i("6d57");var o=i("fd50"),n=i("1834"),a=i("0938"),r=i("9430"),l=i("c6e3"),s=i("28c8"),c=i("a405");e["a"]={saveDeliveryInfo:function(t,e){var i,d,f,u,h,m={"顺利收楼":"delivery","先收楼后处理":"process_after_delivery","暂不收楼":"delivery_after_process","先拒收后收楼":"reject_then_receive"},p=function(t,e,i){var o=[];return t&&t.length&&t.forEach((function(t){o.push({batch_unit_id:e,batch_id:i,dimension_id:t.id,value:t.value,source:"app"})})),o};return l["a"].getRoomParams(t).then((function(l){if(!l||!l.batch_id||!l.batch_unit_id)return console.error("saveDeliveryInfo：未找到对应房间信息。batchRoomId:"+t),o["a"].reject("未找到对应房间信息");var g=!1;return n["a"].transaction((function(o){u=p(e.satisfactionList,l.batch_unit_id,l.batch_id),delete e.satisfactionList,h=e.delivery_items,delete e.delivery_items,e.delivery_date=a["a"].getNowDate(),"暂不收楼"===e.delivery_situation&&(f={delivery_date:e.delivery_date,delivery_status:e.delivery_status,delivery_situation:e.delivery_situation});var n=f||e;n.assess_customer_status="待评价",o.update("batch_room",n,{id:t},(function(n){if(!n.rowsAffected)throw console.error("saveDeliveryInfo：未更新对应房间。batchRoomId:"+t),new Error("未更新对应房间");if(r["a"].existsRoomDeliveryData(o,t,"delivery_after_process",(function(){o.update("batch_room",{first_delivery_situation:e.delivery_situation,first_delivery_date:e.delivery_date},{id:t})}),(function(){o.update("batch_room",{first_delivery_situation:e.delivery_situation,first_delivery_date:e.delivery_date},{id:t,first_delivery_situation:""})})),d=m[e.delivery_situation],!d)throw console.error("saveDeliveryInfo：delivery_situation 枚举值无效"),new Error("delivery_situation 枚举值无效");r["a"].deleteRoomDeliveryData(o,t),c["a"].deleteRoomDeliveryRejection(o,t),i={type:"房间",operation:d,relation_id:t,batch_unit_id:l.batch_unit_id,batch_room_id:t,batch_id:l.batch_id},r["a"].insert(o,i),g=!0,"delivery_after_process"==d&&c["a"].insert(o,t,{batch_unit_id:l.batch_unit_id,reason:e.reason,remark:e.remark,created_by_name:e.created_by_name})})),s["a"].saveRoomSatisfactionValue(o,t,u),h&&h.length&&h.forEach((function(e){e.value&&o.update("batch_room_delivery_item",{value:e.value},{id:e.id,batch_room_id:t})}))})).then((function(){g&&window.uploadStatus("waitUpload")}))}))},saveReviewInfo:function(t,e){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return l["a"].getRoomParams(t).then((function(l){if(!l||!l.batch_id||!l.batch_unit_id)return console.error("saveReviewInfo：未找到对应房间信息。batchRoomId:"+t),o["a"].reject("未找到对应房间信息");var c=!1;return n["a"].transaction((function(o){if(e.delivery_status="已交付",e.review_date=a["a"].getNowDate(),o.update("batch_room",e,{id:t},(function(e){if(!e.rowsAffected)throw console.error("saveReviewInfo：未更新对应房间。batchRoomId:"+t),new Error("未更新对应房间");i={type:"房间",operation:"reviewed",relation_id:t,batch_unit_id:l.batch_unit_id,batch_room_id:t,batch_id:l.batch_id},r["a"].insert(o,i),c=!0})),s&&s.length){var d,f=["id","batch_room_id","batch_unit_id","type","img_localpath","sort"],u=1;o.delete("batch_room_images",{batch_room_id:t}),s.forEach((function(e){if(e.localPath){var s={};s.id=a["a"].uuid(),s.batch_room_id=t,s.batch_unit_id=l.batch_unit_id,s.type="review",s.img_localpath=e.localPath,s.sort=u,d=n["a"].getColumnsValues(s,f),o.insert("batch_room_images",f,d),u++,i={type:"房间",operation:"add_review_image",relation_id:t,batch_unit_id:l.batch_unit_id,batch_room_id:t,batch_id:l.batch_id},r["a"].insert(o,i),c=!0}}))}})).then((function(){c&&window.uploadStatus("waitUpload")}))}))},changeToProcessFromDelivered:function(t,e){var i=function(e){e.update("batch_room",{delivery_status:"交付中",delivery_situation:"先收楼后处理"},{id:t.batch_room_id,delivery_status:"已交付",delivery_situation:"顺利收楼"},(function(i){i.rowsAffected&&r["a"].changeToProcessFromDelivered(e,t)}))};if(!e)return n["a"].transaction((function(t){i(t)}));i(e)},saveReceiveInfo:function(t,e){var i,c,d="receive",f=function(t,e,i){var o=[];return t&&t.length&&t.forEach((function(t){o.push({batch_unit_id:e,batch_id:i,dimension_id:t.id,value:t.value,source:"app"})})),o};return l["a"].getRoomParams(t).then((function(l){if(!l||!l.batch_id||!l.batch_unit_id)return console.error("saveReceiveInfo：未找到对应房间信息。batchRoomId:"+t),o["a"].reject("未找到对应房间信息");var u=!1;return n["a"].transaction((function(o){c=f(e.satisfactionList,l.batch_unit_id,l.batch_id),delete e.satisfactionList,e.opening_status="已接待",e.opening_receive_date=a["a"].getNowDate(),o.update("batch_room",e,{id:t},(function(e){if(!e.rowsAffected)throw console.error("saveReceiveInfo：未更新对应房间。batchRoomId:"+t),new Error("未更新对应房间");i={type:"房间",operation:d,relation_id:t,batch_unit_id:l.batch_unit_id,batch_room_id:t,batch_id:l.batch_id},r["a"].insert(o,i),u=!0})),s["a"].saveRoomSatisfactionValue(o,t,c)})).then((function(){u&&window.uploadStatus("waitUpload")}))}))}}},dac5:function(t,e,i){var o=i("d341");"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var n=i("85cb").default;n("42024016",o,!0,{})},ee1f:function(t,e,i){"use strict";var o=function(){var t=null;return{set:function(e){t=e},get:function(){return t}}};e["a"]=o()}}]);