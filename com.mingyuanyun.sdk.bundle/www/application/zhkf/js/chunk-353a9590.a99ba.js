(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-353a9590"],{"0523":function(e,i,t){"use strict";t("6d57");var r=t("c6e3"),o=t("fd50"),c=t("a654"),n=t("c2c1"),a=t("8ae6"),d=function(e){return r["a"].getRoomBaseInfo(e)},s=function(e){return r["a"].getRoomCustomer(e)},m=function(e,i,t){var r,o={batch_unit_id:e,unit_list:[]},c="0";(_.isEmpty(i)||1===i.length&&""===i[0])&&(r=!0,i=[c]);var n={unit:[""],floor_list:[],status_counter:{all:0}};o.unit_list.push(n);for(var a=0;a<i.length;a++){var d=i[a],s={floor:d,room_list:[]};n.floor_list.push(s);for(var m=0;m<t.length;m++){var l=t[m];!r&&l.floor!=d||l.batch_unit_id!=e||(l.floor=r?c:l.floor,s.room_list.push(l),n.status_counter["all"]+=1,l.room_status in n.status_counter?n.status_counter[l.room_status]+=1:n.status_counter[l.room_status]=1)}}return o},l=function(e){return r["a"].getRoomIsReviewed(e)},p=function(e){return r["a"].getRoomTypeDiagram(e).then((function(e){if(!e)return!1;var i=o["a"].when(!1);return e.forEach((function(e){i=i.then((function(i){return i?o["a"].resolve(!0):n["a"].checkFileIsExists(Object(a["e"])()+e.path)}))})),i}))},h=function(e){return r["a"].getDiagramById(e).then((function(e){if(e){if("dev"==window.ZHKF_GLOBAL_ENV.VUE_APP_ENV)return e.url;var i=Object(a["e"])()+e.path;return console.log(i,"========================"),n["a"].checkFileIsExists(i).then((function(e){return e?i:null}))}return null}))},u=function(e){try{return p(e).catch((function(){return!1})).then((function(e){return!!e}))}catch(i){return console.error(i),o["a"].when(!1)}},f=function(e){return c["a"].existsDesignChange(e)},g=function(e){return c["a"].getDesignChange(e)},b=function(e,i){return c["a"].addDesignChangeProblem(e,i)},v=function(e){return d(e).then((function(e){return e.building_name+(e.unit?e.unit+(e.unit.indexOf("单元")>-1?"":"单元"):"")+(-1==e.floor.indexOf("层")&&-1==e.floor.indexOf("楼")&&-1==e.floor.indexOf("公共区域")?e.floor+"楼":e.floor)+(-1!==e.room_no.indexOf("公共区域")?e.floor+"层 公共区域":e.room_no)}))};i["a"]={getRoomBaseInfo:d,getRoomCustomer:s,buildRoomListData:m,getRoomIsReviewed:l,getRoomTypeImageFileIsExists:p,getRoomTypeImageFileIsExistsIgnoreError:u,existsRoomDesignChange:f,getRoomDesignChange:g,addRoomDesignChangeProblem:b,getRoomTitle:v,getDiagramFullPathById:h,getBatchRoomList:function(e,i){return r["a"].getBatchRoomList(e,i)}}},"760e":function(e,i,t){"use strict";var r=t("1834"),o=function(e,i,t){var o="毛坯"===i?" and is_for_rough = 1 ":" and is_for_decorated = 1 ",c="select id, name, is_remark_required, sort from check_item_desc where check_item_id = ? "+o+" order by sort";return t&&(c="select desc.id, desc.name, desc.is_remark_required, desc.sort  from check_item_desc desc where check_item_id = ?"+o+" order by desc.sort"),r["a"].query(c,[e])},c=function(e,i){var t="毛坯"===i?" and is_for_rough = 1 ":" and is_for_decorated = 1 ",o="select desc.id, desc.name, desc.is_remark_required, desc.sort from check_item_desc desc left join desc_room_average_problem_num desc_num  on desc.id=desc_num.desc_id where check_item_id = ? "+t+" order by desc_num.num desc, desc.sort";return r["a"].query(o,[e])},n=function(e){var i="select distinct id.id,id.name from check_item_desc id inner join checkroom_problem cp on cp.item_id = id.check_item_id where cp.batch_room_id = ?";return r["a"].query(i,[e])};i["a"]={getRoomCheckListDescList:c,getCheckItemDescList:o,getDescByBathRoomId:n,getDescByIds:function(e){_.isArray(e)&&(e=e.join("','"));var i="select id,name,is_remark_required from check_item_desc where id in ('"+e+"')";return r["a"].query(i)},searchDesc:function(e,i){var t="select id,name,check_item_id as item_id from check_item_desc where check_item_id in ("+i+') and (lower(name) like "%" || ? || "%" or upper(name) like "%" || ? || "%") order by name';return r["a"].query(t,[e,e])}}},a654:function(e,i,t){"use strict";var r=t("1834"),o=t("0938");i["a"]={existsDesignChange:function(e){var i="select 1 from room_design_change a inner join batch_room b on a.room_id = b.room_id where b.id = ?";return r["a"].queryOne(i,[e]).then((function(e){return!_.isEmpty(e)}))},getDesignChange:function(e){var i="select a.id, a.location, a.content, a.remark, a.sort from room_design_change a inner join batch_room b on a.room_id = b.room_id where b.id = ? order by a.sort";return r["a"].query(i,[e])},addDesignChangeProblem:function(e,i){if(e&&i){var t=o["a"].uuid();r["a"].insert("room_design_change_problem",["id","design_change_id","checkroom_problem_id"],[t,i,e])}}}},bbed:function(e,i,t){"use strict";t("9a33"),t("f548");var r=t("fd50"),o=t("1834"),c=t("a14a"),n=t.n(c),_=function(e,i,t){var r="select distinct ci.id as item_id,ci.name as item_name  from position_checkitem pc  inner join check_item ci on pc.item_id = ci.id inner join room_type_position rtp on pc.position_id = rtp.position_id  inner join batch_room br on br.room_type_id = rtp.room_type_id  where br.id = ? and pc.parent_item_id = '' and 1=1 and 2=2 order by ci.sort";r=i?r.replace("1=1","pc.position_id = ?"):r,r=t?r.replace("2=2","ci.is_for_rough = 1"):r.replace("2=2","ci.is_for_decorated = 1");var c=[e];return i&&c.push(i),o["a"].query(r,c)},a=function(e,i,t,r){var c="select distinct ci_all.id as item_id,ci_all.name as item_name,ci_all.level, case when ci_all.ifEnd = 1 then 0 else 1 end as child_count  from position_checkitem pc  inner join check_item ci on pc.item_id = ci.id  and exists(select desc.id from check_item_desc desc where desc.check_item_id=ci.id)  inner join check_item ci_all on ((ci.code like ci_all.code || '.%') or ci.code = ci_all.code) inner join room_type_position rtp on pc.position_id = rtp.position_id  inner join batch_room br on br.room_type_id = rtp.room_type_id  where br.id = ? and pc.position_id = ? and 1=1 and 2=2 order by ci_all.code";c=t?c.replace("1=1","ci_all.parent_id = ?"):c.replace("1=1","ci_all.level = 1"),c=r?c.replace("2=2","ci_all.is_for_rough = 1"):c.replace("2=2","ci_all.is_for_decorated = 1");var n=[e,i];return t&&n.push(t),o["a"].query(c,n)},d=function(e,i,t,r,c){c=c?" and ci_all.apply_scope in "+c:"";var n="select distinct ci_all.id as item_id,ci_all.name as item_name,ci_all.level,case when ci_all.ifEnd = 1 then 0 else 1 end as child_count  from project_position_checkitem ppc  inner join check_item ci on ppc.item_id = ci.id    and exists(select desc.id from check_item_desc desc where desc.check_item_id=ci.id) "+c+" inner join check_item ci_all on ((ci.code like ci_all.code || '.%') or ci.code = ci_all.code) "+c+" inner join checkroom_batch cb on ppc.proj_id = cb.project_id  inner join batch_room br on br.batch_id = cb.batch_id  where br.id = ? and ppc.position_id = ? and 1=1 and 2=2  order by ci_all.code";n=t?n.replace("1=1","ci_all.parent_id = ?"):n.replace("1=1","ci_all.level = 1"),n=r?n.replace("2=2","ci_all.is_for_rough = 1"):n.replace("2=2","ci_all.is_for_decorated = 1");var _=[e,i];return t&&_.push(t),console.log("_getProjectCheckItemList",n,_),o["a"].query(n,_)},s=function(e,i){i=i?" and ci.apply_scope in "+i:"";var t="select fitment_standard from room_type rt inner join batch_room br on br.room_type_id=rt.id where br.id=?";return o["a"].queryOne(t,[e]).then((function(t){var r=t&&t.fitment_standard,c="select distinct pc.position_id,ci.id as item_id,ci.name as item_name,ci.parent_id as parent_item_id,ci.level from position_checkitem pc  inner join check_item ci on pc.item_id = ci.id "+i+" inner join room_type_position rtp on pc.position_id=rtp.position_id  inner join batch_room br on br.room_type_id=rtp.room_type_id  where br.id = ?  and 1=1 order by pc.position_id, ci.code desc";return c="毛坯"==r?c.replace("1=1","ci.is_for_rough = 1"):c.replace("1=1","ci.is_for_decorated = 1"),o["a"].query(c,[e])}))},m=function(e,i,t){t=t?" and ci_all.apply_scope in "+t:"";var r="select fitment_standard from room_type rt  inner join batch_room br on br.room_type_id=rt.id where br.id=?";return o["a"].queryOne(r,[e]).then((function(r){var c=r&&r.fitment_standard,n="select distinct ppc.position_id,ci_all.id as item_id,ci_all.name as item_name,ci_all.parent_id as parent_item_id,ci_all.level  from project_position_checkitem ppc  inner join check_item ci on ppc.item_id = ci.id  inner join check_item ci_all on ((ci.code like ci_all.code || '.%') or ci.code = ci_all.code)"+t+" inner join room_type_position rtp on ppc.position_id = rtp.position_id  inner join batch_room br on br.room_type_id = rtp.room_type_id  where br.id = ? and ppc.proj_id = ? and 1=1 order by ppc.position_id, ci_all.code desc ";return n="毛坯"==c?n.replace("1=1","ci_all.is_for_rough = 1"):n.replace("1=1","ci_all.is_for_decorated = 1"),o["a"].query(n,[e,i])}))},l=function(e,i,t){var r=t&&t.is_for_rough?" and is_for_rough=1":"",c=t&&t.is_for_decorated?" and is_for_decorated=1":"",_="drop table if exists temp_search",a="              create table temp_search as               select item_id,item_name,parent_item_id,level,sort,                  substr( '0000000000'  || sort,-10) sort_str,                   case when level=1 then item_id end top_item_id               from position_checkitem               where position_id=? "+r+c,d='       WITH RECURSIVE           cte_child           as(                select *,item_id as end_item_id               from temp_search end_level               where not exists(select 1 from temp_search where parent_item_id=end_level.item_id)               union all               select temp_search.*,cte_child.end_item_id               from temp_search                   inner join cte_child on temp_search.item_id=cte_child.parent_item_id           )       select end_item_id id,group_concat(item_name,?) name,max(top_item_id) top_item_id       from (           select * from cte_child order by level,sort       )       group by end_item_id       having name like "%" || ? || "%"       order by group_concat(sort_str)       limit ? offset ?';return t=n.a.extend({limit:-1,offset:0,separator:"-"},t),o["a"].executeSql(_).then((function(){return o["a"].executeSql(a,[i])})).then((function(){return o["a"].query(d,[t.separator,e,t.limit,t.offset])}))},p=function(e,i,t){var r=t&&t.is_for_rough?" and is_for_rough=1":"",c=t&&t.is_for_decorated?" and is_for_decorated=1":"",n="drop table if exists temp_higherLevel",_="              create table if not exists temp_higherLevel as               select item_id,item_name,parent_item_id,level               from position_checkitem               where position_id=? "+r+c,a="       WITH RECURSIVE           cte_child           as(                select endLevel.item_id,endLevel.item_name,                  endLevel.level,endLevel.parent_item_id               from temp_higherLevel endLevel               where item_id = ?               union all               select higherLevel.item_id,higherLevel.item_name,                  higherLevel.level,higherLevel.parent_item_id               from temp_higherLevel higherLevel                   inner join cte_child on higherLevel.item_id=cte_child.parent_item_id           )       select * from cte_child order by level ";return o["a"].executeSql(n).then((function(){return o["a"].executeSql(_,[i])})).then((function(){return o["a"].query(a,[e])}))},h=function(e,i){var t="select distinct pc.item_id,pc.item_name,pc.parent_item_id,pc.position_id from position_checkitem pc inner join checkroom_problem cp on cp.position_id = pc.position_id where 1=1 and 2=2 ",r=[];return e&&(t=t.replace("1=1","cp.batch_room_id = ?"),r.push(e)),i&&(t=t.replace("2=2","cp.position_id = ?"),r.push(i)),o["a"].query(t,r)},u=function(e,i){return o["a"].queryOne("select level from check_item where id=?",[i]).then((function(e){return e.level}))};i["a"]={getTopCheckItemList:_,getCheckItemList:a,getCheckItemListByParams:h,searchCheckItem:l,getCheckItemLevel:u,getHigherLevelTreeListByCheckItemId:p,getPositionItemByRoom:s,getProjectPositionItemByRoom:m,getProjectCheckItemList:d,getCheckItemFilter:function(e,i,t){var r="select distinct pc.item_id as value, pc.item_name as name from position_checkitem pc  inner join room_type_position rtp on pc.position_id = rtp.position_id  inner join batch_room br on br.room_type_id = rtp.room_type_id  where br.id = ? and pc.parent_item_id = ''",c=" order by sort",n=[e];return i&&(r+=" and pc.position_id = ?",n.push(i)),r+=" and pc."+(t?"is_for_rough":"is_for_decorated")+" = 1",r+=c,o["a"].query(r,n)},getRoomCheckItemFilter:function(e){var i='select ci.id value, ifnull(ci.name, "其他") name, count(cp.id) count  from checkroom_problem cp  left join check_item ci on cp.item_id = ci.id where cp.batch_room_id = ?  group by ci.id order by ci.sort ';return o["a"].query(i,[e])},hasProjectCheckitem:function(e){if(!e)return r["a"].resolve(!1);var i="select count(1) as count from project_position_checkitem where proj_id = ?";return o["a"].queryOne(i,[e]).then((function(e){return e["count"]>0}))},searchProjectCheckItem:function(e,i,t,r){var c=r&&r.is_for_rough?" and is_for_rough=1":"",_=r&&r.is_for_decorated?" and is_for_decorated=1":"",a="drop table if exists temp_search",d="              create table temp_search as               select ppc.item_id,ci.name as item_name, ci.parent_id as parent_item_id, ci.level, ci.sort,                  substr( '0000000000'  || ci.sort,-10) sort_str,                   case when ci.level=1 then ppc.item_id end top_item_id               from project_position_checkitem ppc               inner join check_item ci on ci.id = ppc.item_id              where ppc.position_id=? and ppc.proj_id = ? "+c+_,s='               WITH RECURSIVE                   cte_child                   as(                        select *,item_id as end_item_id                       from temp_search end_level                       where not exists(select 1 from temp_search where parent_item_id=end_level.item_id)                       union all                       select temp_search.*,cte_child.end_item_id                       from temp_search                           inner join cte_child on temp_search.item_id=cte_child.parent_item_id                   )               select end_item_id id,group_concat(item_name,?) name,max(top_item_id) top_item_id               from (                   select * from cte_child order by level,sort               )               group by end_item_id               having name like "%" || ? || "%"               order by group_concat(sort_str)               limit ? offset ?';return r=n.a.extend({limit:-1,offset:0,separator:"-"},r),o["a"].executeSql(a).then((function(){return o["a"].executeSql(d,[t,e])})).then((function(){return o["a"].query(s,[r.separator,i,r.limit,r.offset])}))},getProjectItemOfBatchUnit:function(e){var i="select *  from project_position_checkitem ppc  inner join checkroom_batch cb on ppc.proj_id = cb.project_id  inner join batch_unit bu on cb.batch_id = bu.batch_id where bu.id = ?";return o["a"].queryOne(i,[e])},updateCheckItemUseTimes:function(e,i){var t="select used_times from check_item_used where item_id = ?";return i=i||1,o["a"].queryOne(t,[e]).then((function(r){r?(t="update check_item_used set used_times = used_times + ? where item_id = ?",o["a"].executeSql(t,[i,e])):o["a"].insert("check_item_used",["item_id","used_times"],[e,i])}))},updateItemDescUseTimes:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=e.split(";"),c=r["a"].when();return n.a.each(t,(function(e){c=c.then((function(){var t="select used_times from item_desc_used where desc_id = ?";return o["a"].queryOne(t,[e]).then((function(r){return r?(t="update item_desc_used set used_times = used_times + ? where desc_id = ?",o["a"].executeSql(t,[i,e])):o["a"].insert("item_desc_used",["desc_id","used_times"],[e,i])}))}))})),c.catch((function(t){window.$log("添加问题 updateItemDescUseTimes方法内部 catch & 参数",{error:t,curr_param:{descIds:e,addUseTimes:i}})}))},getCheckItemLeaf:function(e,i,t,r){r=r?" and ci.apply_scope in "+r:"";var c="select distinct ci.id  from position_checkitem pc  inner join check_item ci on pc.item_id = ci.id "+r+" and exists(select desc.id from check_item_desc desc where desc.check_item_id=ci.id)  inner join room_type_position rtp on pc.position_id = rtp.position_id  inner join batch_room br on br.room_type_id = rtp.room_type_id  where br.id = ? and pc.position_id = ? and 2=2";c=t?c.replace("2=2","ci.is_for_rough = 1"):c.replace("2=2","ci.is_for_decorated = 1");var n=[e,i];return o["a"].query(c,n)},getCheckItemAll:function(e,i,t,r){r=r?" and ci_all.apply_scope in "+r:"";var c="select distinct ci_all.id as item_id,ci_all.name as item_name,ci_all.level, case when ci_all.ifEnd = 1 then 0 else 1 end as child_count  from check_item ci  inner join check_item ci_all on ((ci.code like ci_all.code || '.%') or ci.code = ci_all.code) "+r+" where ci.id in('"+e+"') and 1=1 and 2=2 order by ci_all.code";c=i?c.replace("1=1","ci_all.parent_id = ?"):c.replace("1=1","ci_all.level = 1"),c=t?c.replace("2=2","ci_all.is_for_rough = 1"):c.replace("2=2","ci_all.is_for_decorated = 1");var n=[];return i&&n.push(i),o["a"].query(c,n)}}}}]);