(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-2e410638"],{"0523":function(e,t,i){"use strict";i("6d57");var o=i("c6e3"),r=i("fd50"),a=i("a654"),n=i("c2c1"),c=i("8ae6"),s=function(e){return o["a"].getRoomBaseInfo(e)},d=function(e){return o["a"].getRoomCustomer(e)},u=function(e,t,i){var o,r={batch_unit_id:e,unit_list:[]},a="0";(_.isEmpty(t)||1===t.length&&""===t[0])&&(o=!0,t=[a]);var n={unit:[""],floor_list:[],status_counter:{all:0}};r.unit_list.push(n);for(var c=0;c<t.length;c++){var s=t[c],d={floor:s,room_list:[]};n.floor_list.push(d);for(var u=0;u<i.length;u++){var m=i[u];!o&&m.floor!=s||m.batch_unit_id!=e||(m.floor=o?a:m.floor,d.room_list.push(m),n.status_counter["all"]+=1,m.room_status in n.status_counter?n.status_counter[m.room_status]+=1:n.status_counter[m.room_status]=1)}}return r},m=function(e){return o["a"].getRoomIsReviewed(e)},l=function(e){return o["a"].getRoomTypeDiagram(e).then((function(e){if(!e)return!1;var t=r["a"].when(!1);return e.forEach((function(e){t=t.then((function(t){return t?r["a"].resolve(!0):n["a"].checkFileIsExists(Object(c["e"])()+e.path)}))})),t}))},f=function(e){return o["a"].getDiagramById(e).then((function(e){if(e){if("dev"==window.ZHKF_GLOBAL_ENV.VUE_APP_ENV)return e.url;var t=Object(c["e"])()+e.path;return console.log(t,"========================"),n["a"].checkFileIsExists(t).then((function(e){return e?t:null}))}return null}))},h=function(e){try{return l(e).catch((function(){return!1})).then((function(e){return!!e}))}catch(t){return console.error(t),r["a"].when(!1)}},p=function(e){return a["a"].existsDesignChange(e)},v=function(e){return a["a"].getDesignChange(e)},b=function(e,t){return a["a"].addDesignChangeProblem(e,t)},g=function(e){return s(e).then((function(e){return e.building_name+(e.unit?e.unit+(e.unit.indexOf("单元")>-1?"":"单元"):"")+(-1==e.floor.indexOf("层")&&-1==e.floor.indexOf("楼")&&-1==e.floor.indexOf("公共区域")?e.floor+"楼":e.floor)+(-1!==e.room_no.indexOf("公共区域")?e.floor+"层 公共区域":e.room_no)}))};t["a"]={getRoomBaseInfo:s,getRoomCustomer:d,buildRoomListData:u,getRoomIsReviewed:m,getRoomTypeImageFileIsExists:l,getRoomTypeImageFileIsExistsIgnoreError:h,existsRoomDesignChange:p,getRoomDesignChange:v,addRoomDesignChangeProblem:b,getRoomTitle:g,getDiagramFullPathById:f,getBatchRoomList:function(e,t){return o["a"].getBatchRoomList(e,t)}}},"09bb":function(e,t,i){"use strict";i.r(t);var o=i("964e"),r=i("fd50"),a=i("a14a"),n=i.n(a),c={data:function(){return{diagramName:"电风扇"}},created:function(){this.init()},methods:{init:function(){var e=this;return this.init_prepareData().then((function(t){return console.log(t),e.init_layout(t)})).catch((function(t){e.$comComps.toast.show(t||"打开户型图失败",5e3)}))},init_layout:function(e,t){var o=this;this.$nextTick((function(){HuxinTu.reset(),HuxinTu.init({src:window.LAYOUT_WEB_DEBUG?i("46f2"):e.diagramImg,data:{areas:e.areas,points:e.points},height:o.init_layout_getWrapHeight(),clickCallback:function(e){console.log(e)},pointRadius:7,pointRatio:1.5,clickDelay:500,mark:t&&t.mark||!1,markPositionId:t&&t.markPositionId||"",markDefaultPoint:t&&t.markDefaultPoint||null,markUndoCallback:function(e){console.log("markUndoCallback",e)}})}))},init_layout_getWrapHeight:function(){var e=this.$refs.draw.offsetTop;return window.innerHeight-e},init_prepareData:function(){var e=this,t=this.$route.query.problem_id;return o["a"].getProblemPositionPointInfo(t).then((function(t){return t.room_type_image_path?(n.a.isEmpty(t.diagram_name)||(e.diagramName=t.diagram_name),{diagramImg:t.room_type_image_path,areas:[],points:[e.init_prepareData_createPoint(t)]}):r["a"].reject("户型图未下载")}))},init_prepareData_createPoint:function(e){var t,i={};if(!e.coordinate)throw new Error("无问题位置信息");switch(console.log(e,"======problemdata"),e.status){case"待派单":i.color="#bb33ee";break;case"待整改":i.color="#ff4545";break;case"已整改":i.color="#0099ff";break;case"已通过":i.color="#0bc666";break;case"已作废":i.color="#888";break;case"非正常关闭":i.color="#000";break;default:i.color="#ff4545"}return t=JSON.parse(e.coordinate),i.x=t.x,i.y=t.y,i}}},s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"problem-position"},[i("cus-nav-bar",{attrs:{title:"问题位置","left-arrow":"",border:!1}}),e._v(" "),i("div",{staticClass:"content"},[i("span",{staticClass:"app-paper-name",attrs:{"ng-if":"diagramName"}},[e._v("\n      "+e._s(e.diagramName)+"\n    ")]),e._v(" "),i("canvas",{ref:"draw",attrs:{id:"draw"}})])],1)},d=[],u=i("d082");function _(e){i("73fc")}var m=!1,l=_,f="data-v-e96e499c",h=null,p=Object(u["a"])(c,s,d,m,l,f,h);t["default"]=p.exports},"28c8":function(e,t,i){"use strict";i("6d57");var o=i("1834"),r=i("0938");t["a"]={getRoomSatisfactionValueList:function(e,t){var i="                 select sd.id , sd.dimension as name , rsv.value                 from satisfaction_dimension sd                     left join room_satisfaction_value rsv                         on rsv.batch_room_id = ? and sd.id = rsv.dimension_id                 where sd.type = ?                 order by sd.sort , sd.dimension";return o["a"].query(i,[t,e])},saveRoomSatisfactionValue:function(e,t,i){var a,n=["batch_id","batch_room_id","batch_unit_id","dimension_id","id","source","value"];if(!t)throw new TypeError("saveRoomSatisfactionValue: batchRoomId为空");e.delete("room_satisfaction_value",{batch_room_id:t},(function(){i&&i.length&&i.forEach((function(i){i.id=Object(r["j"])(),i.batch_room_id=t,console.log("字段=====",i),a=o["a"].getColumnsValues(i,n),e.insert("room_satisfaction_value",n,a)}))}))}}},"46f2":function(e,t,i){e.exports=i.p+"img/huxing.6f0f5240.jpg"},"73fc":function(e,t,i){var o=i("a3d6");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var r=i("85cb").default;r("49c63699",o,!0,{})},"760e":function(e,t,i){"use strict";var o=i("1834"),r=function(e,t,i){var r="毛坯"===t?" and is_for_rough = 1 ":" and is_for_decorated = 1 ",a="select id, name, is_remark_required, sort from check_item_desc where check_item_id = ? "+r+" order by sort";return i&&(a="select desc.id, desc.name, desc.is_remark_required, desc.sort  from check_item_desc desc where check_item_id = ?"+r+" order by desc.sort"),o["a"].query(a,[e])},a=function(e,t){var i="毛坯"===t?" and is_for_rough = 1 ":" and is_for_decorated = 1 ",r="select desc.id, desc.name, desc.is_remark_required, desc.sort from check_item_desc desc left join desc_room_average_problem_num desc_num  on desc.id=desc_num.desc_id where check_item_id = ? "+i+" order by desc_num.num desc, desc.sort";return o["a"].query(r,[e])},n=function(e){var t="select distinct id.id,id.name from check_item_desc id inner join checkroom_problem cp on cp.item_id = id.check_item_id where cp.batch_room_id = ?";return o["a"].query(t,[e])};t["a"]={getRoomCheckListDescList:a,getCheckItemDescList:r,getDescByBathRoomId:n,getDescByIds:function(e){_.isArray(e)&&(e=e.join("','"));var t="select id,name,is_remark_required from check_item_desc where id in ('"+e+"')";return o["a"].query(t)},searchDesc:function(e,t){var i="select id,name,check_item_id as item_id from check_item_desc where check_item_id in ("+t+') and (lower(name) like "%" || ? || "%" or upper(name) like "%" || ? || "%") order by name';return o["a"].query(i,[e,e])}}},a3d6:function(e,t,i){t=e.exports=i("690e")(!1),t.push([e.i,"\n.zhkf .problem-position .content[data-v-e96e499c] {\n  background: #fff;\n  position: relative;\n}\n.zhkf .app-paper-name[data-v-e96e499c] {\n  position: absolute;\n  top: 10px;\n  left: 50%;\n  display: inline-block;\n  height: 24px;\n  padding: 0 15px;\n  border-radius: 3px;\n  color: white;\n  line-height: 24px;\n  background: rgba(0, 0, 0, 0.7);\n  -webkit-transform: translate(-50%, 0);\n          transform: translate(-50%, 0);\n  white-space: nowrap;\n}\n",""])},a654:function(e,t,i){"use strict";var o=i("1834"),r=i("0938");t["a"]={existsDesignChange:function(e){var t="select 1 from room_design_change a inner join batch_room b on a.room_id = b.room_id where b.id = ?";return o["a"].queryOne(t,[e]).then((function(e){return!_.isEmpty(e)}))},getDesignChange:function(e){var t="select a.id, a.location, a.content, a.remark, a.sort from room_design_change a inner join batch_room b on a.room_id = b.room_id where b.id = ? order by a.sort";return o["a"].query(t,[e])},addDesignChangeProblem:function(e,t){if(e&&t){var i=r["a"].uuid();o["a"].insert("room_design_change_problem",["id","design_change_id","checkroom_problem_id"],[i,t,e])}}}},af93:function(e,t,i){"use strict";var o=i("1834");t["a"]={getRoomTypeDiagramList:function(e){var t="select rdp.id,rdp.coordinate,rdp.position_id,rdp.diagram_id from roomtype_diagram_partition rdp              inner join batch_room br on br.room_type_id = rdp.roomtype_id              inner join position p on p.id = rdp.position_id             where br.id = ?";return o["a"].query(t,[e])},hasRoomTypeDiagram:function(e){var t="select count(rdp.id) as count from roomtype_diagram_partition rdp              inner join batch_room br on br.room_type_id = rdp.roomtype_id              where br.id = ? and rdp.coordinate <> ''";return o["a"].queryOne(t,[e]).then((function(e){return e.count>0}))},isPositionInDiagram:function(e,t){return o["a"].exists("roomtype_diagram_partition",{diagram_id:e,position_id:t})},getHasPartitionByDiagramId:function(e){return o["a"].exists("roomtype_diagram_partition",{diagram_id:e})}}},d42a:function(e,t,i){"use strict";i("6d57");var o=i("fd50"),r=i("1834"),a=i("0938"),n=i("9430"),c=i("c6e3"),s=i("28c8"),d=i("a405");t["a"]={saveDeliveryInfo:function(e,t){var i,u,_,m,l,f={"顺利收楼":"delivery","先收楼后处理":"process_after_delivery","暂不收楼":"delivery_after_process","先拒收后收楼":"reject_then_receive"},h=function(e,t,i){var o=[];return e&&e.length&&e.forEach((function(e){o.push({batch_unit_id:t,batch_id:i,dimension_id:e.id,value:e.value,source:"app"})})),o};return c["a"].getRoomParams(e).then((function(c){if(!c||!c.batch_id||!c.batch_unit_id)return console.error("saveDeliveryInfo：未找到对应房间信息。batchRoomId:"+e),o["a"].reject("未找到对应房间信息");var p=!1;return r["a"].transaction((function(o){m=h(t.satisfactionList,c.batch_unit_id,c.batch_id),delete t.satisfactionList,l=t.delivery_items,delete t.delivery_items,t.delivery_date=a["a"].getNowDate(),"暂不收楼"===t.delivery_situation&&(_={delivery_date:t.delivery_date,delivery_status:t.delivery_status,delivery_situation:t.delivery_situation});var r=_||t;r.assess_customer_status="待评价",o.update("batch_room",r,{id:e},(function(r){if(!r.rowsAffected)throw console.error("saveDeliveryInfo：未更新对应房间。batchRoomId:"+e),new Error("未更新对应房间");if(n["a"].existsRoomDeliveryData(o,e,"delivery_after_process",(function(){o.update("batch_room",{first_delivery_situation:t.delivery_situation,first_delivery_date:t.delivery_date},{id:e})}),(function(){o.update("batch_room",{first_delivery_situation:t.delivery_situation,first_delivery_date:t.delivery_date},{id:e,first_delivery_situation:""})})),u=f[t.delivery_situation],!u)throw console.error("saveDeliveryInfo：delivery_situation 枚举值无效"),new Error("delivery_situation 枚举值无效");n["a"].deleteRoomDeliveryData(o,e),d["a"].deleteRoomDeliveryRejection(o,e),i={type:"房间",operation:u,relation_id:e,batch_unit_id:c.batch_unit_id,batch_room_id:e,batch_id:c.batch_id},n["a"].insert(o,i),p=!0,"delivery_after_process"==u&&d["a"].insert(o,e,{batch_unit_id:c.batch_unit_id,reason:t.reason,remark:t.remark,created_by_name:t.created_by_name})})),s["a"].saveRoomSatisfactionValue(o,e,m),l&&l.length&&l.forEach((function(t){t.value&&o.update("batch_room_delivery_item",{value:t.value},{id:t.id,batch_room_id:e})}))})).then((function(){p&&window.uploadStatus("waitUpload")}))}))},saveReviewInfo:function(e,t){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return c["a"].getRoomParams(e).then((function(c){if(!c||!c.batch_id||!c.batch_unit_id)return console.error("saveReviewInfo：未找到对应房间信息。batchRoomId:"+e),o["a"].reject("未找到对应房间信息");var d=!1;return r["a"].transaction((function(o){if(t.delivery_status="已交付",t.review_date=a["a"].getNowDate(),o.update("batch_room",t,{id:e},(function(t){if(!t.rowsAffected)throw console.error("saveReviewInfo：未更新对应房间。batchRoomId:"+e),new Error("未更新对应房间");i={type:"房间",operation:"reviewed",relation_id:e,batch_unit_id:c.batch_unit_id,batch_room_id:e,batch_id:c.batch_id},n["a"].insert(o,i),d=!0})),s&&s.length){var u,_=["id","batch_room_id","batch_unit_id","type","img_localpath","sort"],m=1;o.delete("batch_room_images",{batch_room_id:e}),s.forEach((function(t){if(t.localPath){var s={};s.id=a["a"].uuid(),s.batch_room_id=e,s.batch_unit_id=c.batch_unit_id,s.type="review",s.img_localpath=t.localPath,s.sort=m,u=r["a"].getColumnsValues(s,_),o.insert("batch_room_images",_,u),m++,i={type:"房间",operation:"add_review_image",relation_id:e,batch_unit_id:c.batch_unit_id,batch_room_id:e,batch_id:c.batch_id},n["a"].insert(o,i),d=!0}}))}})).then((function(){d&&window.uploadStatus("waitUpload")}))}))},changeToProcessFromDelivered:function(e,t){var i=function(t){t.update("batch_room",{delivery_status:"交付中",delivery_situation:"先收楼后处理"},{id:e.batch_room_id,delivery_status:"已交付",delivery_situation:"顺利收楼"},(function(i){i.rowsAffected&&n["a"].changeToProcessFromDelivered(t,e)}))};if(!t)return r["a"].transaction((function(e){i(e)}));i(t)},saveReceiveInfo:function(e,t){var i,d,u="receive",_=function(e,t,i){var o=[];return e&&e.length&&e.forEach((function(e){o.push({batch_unit_id:t,batch_id:i,dimension_id:e.id,value:e.value,source:"app"})})),o};return c["a"].getRoomParams(e).then((function(c){if(!c||!c.batch_id||!c.batch_unit_id)return console.error("saveReceiveInfo：未找到对应房间信息。batchRoomId:"+e),o["a"].reject("未找到对应房间信息");var m=!1;return r["a"].transaction((function(o){d=_(t.satisfactionList,c.batch_unit_id,c.batch_id),delete t.satisfactionList,t.opening_status="已接待",t.opening_receive_date=a["a"].getNowDate(),o.update("batch_room",t,{id:e},(function(t){if(!t.rowsAffected)throw console.error("saveReceiveInfo：未更新对应房间。batchRoomId:"+e),new Error("未更新对应房间");i={type:"房间",operation:u,relation_id:e,batch_unit_id:c.batch_unit_id,batch_room_id:e,batch_id:c.batch_id},n["a"].insert(o,i),m=!0})),s["a"].saveRoomSatisfactionValue(o,e,d)})).then((function(){m&&window.uploadStatus("waitUpload")}))}))}}}}]);