(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-70cb07c8"],{"0523":function(t,e,o){"use strict";o("6d57");var n=o("c6e3"),r=o("fd50"),a=o("a654"),i=o("c2c1"),s=o("8ae6"),c=function(t){return n["a"].getRoomBaseInfo(t)},u=function(t){return n["a"].getRoomCustomer(t)},d=function(t,e,o){var n,r={batch_unit_id:t,unit_list:[]},a="0";(_.isEmpty(e)||1===e.length&&""===e[0])&&(n=!0,e=[a]);var i={unit:[""],floor_list:[],status_counter:{all:0}};r.unit_list.push(i);for(var s=0;s<e.length;s++){var c=e[s],u={floor:c,room_list:[]};i.floor_list.push(u);for(var d=0;d<o.length;d++){var l=o[d];!n&&l.floor!=c||l.batch_unit_id!=t||(l.floor=n?a:l.floor,u.room_list.push(l),i.status_counter["all"]+=1,l.room_status in i.status_counter?i.status_counter[l.room_status]+=1:i.status_counter[l.room_status]=1)}}return r},l=function(t){return n["a"].getRoomIsReviewed(t)},f=function(t){return n["a"].getRoomTypeDiagram(t).then((function(t){if(!t)return!1;var e=r["a"].when(!1);return t.forEach((function(t){e=e.then((function(e){return e?r["a"].resolve(!0):i["a"].checkFileIsExists(Object(s["e"])()+t.path)}))})),e}))},m=function(t){return n["a"].getDiagramById(t).then((function(t){if(t){if("dev"==window.ZHKF_GLOBAL_ENV.VUE_APP_ENV)return t.url;var e=Object(s["e"])()+t.path;return console.log(e,"========================"),i["a"].checkFileIsExists(e).then((function(t){return t?e:null}))}return null}))},h=function(t){try{return f(t).catch((function(){return!1})).then((function(t){return!!t}))}catch(e){return console.error(e),r["a"].when(!1)}},p=function(t){return a["a"].existsDesignChange(t)},g=function(t){return a["a"].getDesignChange(t)},b=function(t,e){return a["a"].addDesignChangeProblem(t,e)},v=function(t){return c(t).then((function(t){return t.building_name+(t.unit?t.unit+(t.unit.indexOf("单元")>-1?"":"单元"):"")+(-1==t.floor.indexOf("层")&&-1==t.floor.indexOf("楼")&&-1==t.floor.indexOf("公共区域")?t.floor+"楼":t.floor)+(-1!==t.room_no.indexOf("公共区域")?t.floor+"层 公共区域":t.room_no)}))};e["a"]={getRoomBaseInfo:c,getRoomCustomer:u,buildRoomListData:d,getRoomIsReviewed:l,getRoomTypeImageFileIsExists:f,getRoomTypeImageFileIsExistsIgnoreError:h,existsRoomDesignChange:p,getRoomDesignChange:g,addRoomDesignChangeProblem:b,getRoomTitle:v,getDiagramFullPathById:m,getBatchRoomList:function(t,e){return n["a"].getBatchRoomList(t,e)}}},"2d3d":function(t,e,o){"use strict";o("e697"),o("6d57"),o("cc57");var n=o("fd50"),r=o("cb6b"),a=o("0e1c"),i=o("653b"),s=o("0523");e["a"]=function(){var t=20,e={},o={getConditions:function(){return r["a"].set(a["a"].DELIVERY_PROCESS_CONDITION,{batch:e.filterList[0].id,status:e.filterList[2].id},r["a"].level.user),{batchId:e.filterList[0].id,name:e.currType,status:e.filterList[2].name,page:e.currPage,pageSize:t,checkroomType:e.checkroomType,batchType:e.batchType}},load:function(){var r=o.getConditions();return r.batchId?i["a"].getTodoDeliveryList(r,e.search.keyword||"").then((function(o){return e.total=o.total,e.list=e.currPage?e.list.concat(o.list):o.list,0===e.currPage&&(e.search.lastKeyword=""),e.total*t>e.list.length&&e.currPage++,o.list})).then((function(t){return"delivery_check_room"===e.currType?o.setUploadStatus(t):t})):n["a"].reject("无效批次")},changeNumberStatus:function(t,o,n){var r=[];return t.room_list.forEach((function(t){r.push(t.room_id)})),i["a"].changeNumberStatus({batch_id:e.filterList[0].id,signin_id:t.signin_id,room_ids:r.join(","),operate_type:n,name:e.currType}).then((function(){e.list.splice(o,1)}))},setUploadStatus:function(t){t=t||e.list;var o=[],n=[];return t.forEach((function(t){t.room_list.forEach((function(t){o.push(t.room_id)}))})),s["a"].getBatchRoomList(e.filterList[0].id,o).then((function(t){return t.forEach((function(t){e.list.forEach((function(e){var o=_.find(e.room_list,{room_id:t.room_id});o&&(o.batchRoomId=t.id,n.push(t.id))}))})),i["a"].getHasUploadRoomList(n).then((function(t){_.isEmpty(t)||e.list.forEach((function(e){e.room_list.forEach((function(o){t.indexOf(o.batchRoomId)>-1&&(e.hasUpload=!0)}))}))}))}))}};return{model:e,init:function(t){var o=this,s=t.type,c=t.batchType;e.currType=s,e.batchType=c,e.checkroomType="全部",e.currPage=0,e.total=0,e.filterList=[{id:"",name:"",label:"批次",type:"batch",options:[]},{id:"",name:"",label:"验房类型",type:"checkroomType",options:[],hidden:!("online_delivery_center"===c)},{id:"",name:"",label:"办理状态",type:"status",options:[]}],e.currStatus="",e.search={keyword:"",lastKeyword:""},e.list=[];var u=r["a"].getObject(a["a"].DELIVERY_PROCESS_CONDITION,r["a"].level.user)||{};return i["a"].getBatchList(c).then((function(t){return t=t||[],t.length&&(e.filterList[0].options=t,e.filterList[1].options=[{id:"all",name:"全部"},{id:"offline_delivery",name:"现场验房"},{id:"online_delivery_center",name:"在线验房"}],e.filterList[2].options=[{id:1,name:"待办理"},{id:2,name:"已办理"},{id:3,name:"已过号"}],e.filterList.forEach((function(t){var e=u[t.type]||"",o=_.find(t.options,{id:e})||{};t.id=o.id||t.options[0].id,t.name=o.name||t.options[0].name})),e.currStatus=e.filterList[2].name),n["a"].resolve(!0)})).then((function(){return o.load()}))},load:function(){return e.currPage=0,o.load()},loadMore:function(){return o.load()},cross:function(t,e){return o.changeNumberStatus(t,e,"过号")},resetRecovery:function(t,e){return o.changeNumberStatus(t,e,"恢复排号")},removeItem:function(t,o,n){if(!_.isEmpty(e)&&!_.isEmpty(e.list)&&"已办理"!==e.filterList[2].name&&e.currType===n){var r=_.find(e.list,{signin_id:t}),a=!0;if(r&&(r.room_list.forEach((function(t){t.room_id===o&&(t.status=1),a&=!!t.status})),a)){var i=_.indexOf(e.list,r);i>-1&&e.list.splice(i,1)}}}}}()},"4baa":function(t,e,o){"use strict";o.r(e);o("cc57"),o("6d57");var n=o("bdbb"),r=o("a14a"),a=o.n(r),i=o("b4b9"),s={components:{TextBox:n["a"]},data:function(){return{selected:"",reasons:[{name:"操作错误",selected:!1},{name:"因房屋质量问题",selected:!1},{name:"因销售承诺未兑现",selected:!1},{name:"其他",selected:!1}],remark:""}},methods:{selectReason:function(t){this.reasons.forEach((function(t){t.selected=!1})),this.$set(t,"selected",!0),this.selected=t.name},updateRemark:function(t){this.remark=a.a.trim(t)},submit:function(){var t=this;this.selected?"其他"!==this.selected||this.remark.trim()?(this.$toast.loading({mask:!0,message:"提交中...",duration:0}),i["a"].submitAgain({reason:this.selected,remark:this.remark}).then((function(e){t.$toast.clear(),e.errcode?t.$toast("提交失败"):(t.$toast("提交成功",1e3),t.$router.go(-2))})).catch((function(){t.$toast.clear(),t.$toast("提交失败")}))):this.$toast("请填写补充说明"):this.$toast("请选择重新办理原因")}}},c=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"retransacted-reason"},[o("cus-nav-bar",{attrs:{title:"选择重新办理原因","left-arrow":"",border:!1}}),t._v(" "),o("div",{staticClass:"content"},[o("div",{staticClass:"reason-list van-hairline--bottom"},t._l(t.reasons,(function(e,n){return o("van-cell",{key:n,class:{active:e.selected},attrs:{title:e.name},on:{click:function(o){return t.selectReason(e)}}},[e.selected?o("template",{slot:"right-icon"},[o("i",{staticClass:"iconfont icon-gou"})]):t._e()],2)})),1),t._v(" "),o("text-box",{attrs:{remark:t.remark,placeholder:"补充说明"},on:{input:t.updateRemark}})],1),t._v(" "),o("div",{staticClass:"footer"},[o("div",{staticClass:"btn",on:{click:t.submit}},[t._v("确认")])])],1)},u=[],d=o("d082");function l(t){o("bab0")}var f=!1,m=l,h="data-v-768f36fc",_=null,p=Object(d["a"])(s,c,u,f,m,h,_);e["default"]=p.exports},6013:function(t,e,o){"use strict";var n=o("07a4"),r=o("dfb1"),a=o("81ad"),i=o("c6e3"),s=o("9430"),c=o("a14a"),u=o.n(c),d={getDeliveryNodeList:function(){return r["a"].getDeliveryNodeList(n["a"].state.projectList.currentItem.id)},getTodoDeliveryDetail:function(t){return r["a"].getTodoDeliveryDetail(t)},uploadDeliveryConfirmInfo:function(t,e,o){return a["a"].uploadFiles(t,"deliveryProcess",e.room_id).then((function(t){console.log(t),t=u.a.uniq(t);var n={child_process:[{id:o,status:1,imgs:t}],reason:"",remark:""};return n=u.a.extend(n,e),r["a"].uploadProcessData(n)}))},uploadProcessData:function(t){return r["a"].uploadProcessData(t)},getProcessOperateLog:function(t){return r["a"].getProcessOperateLog(t)},getDeliveryConfirmInfo:function(t,e,o){return r["a"].getDeliveryConfirmInfo(t,e,o)},getRoomData:function(t,e){return i["a"].getBatchRoom(t,e)},assistSignIn:function(t){return r["a"].assistSignIn(t)},hasUploadData:function(t){return s["a"].existsBatchRoomUploadData(t)}};e["a"]=d},a654:function(t,e,o){"use strict";var n=o("1834"),r=o("0938");e["a"]={existsDesignChange:function(t){var e="select 1 from room_design_change a inner join batch_room b on a.room_id = b.room_id where b.id = ?";return n["a"].queryOne(e,[t]).then((function(t){return!_.isEmpty(t)}))},getDesignChange:function(t){var e="select a.id, a.location, a.content, a.remark, a.sort from room_design_change a inner join batch_room b on a.room_id = b.room_id where b.id = ? order by a.sort";return n["a"].query(e,[t])},addDesignChangeProblem:function(t,e){if(t&&e){var o=r["a"].uuid();n["a"].insert("room_design_change_problem",["id","design_change_id","checkroom_problem_id"],[o,e,t])}}}},b4b9:function(t,e,o){"use strict";o("6d57"),o("cc57");var n=o("fd50"),r=o("a593"),a=o("db55"),i=o("2d3d"),s=o("6013");e["a"]=function(){var t={},e={getConditions:function(){return{batchId:a["a"].model.roomInfo.batchId,roomId:a["a"].model.roomInfo.room_list[a["a"].model.currRoomIndex].room_id,signinId:a["a"].model.roomInfo.signin_id}},creatDataParam:function(){for(var o=e.getConditions(),n={signin_id:o.signinId,batch_id:o.batchId,room_id:o.roomId,process_id:t.list.id,process_name:t.list.name,process_status:1,child_process:[]},r=0;r<t.list.child_node.length;r++)n.child_process.push({id:t.list.child_node[r].id,status:t.list.child_node[r].selected?1:2,img:[]});return n},submit:function(t){var o=e.creatDataParam();return s["a"].uploadProcessData(o).then((function(e){return i["a"].removeItem(o.signin_id,o.room_id,t),n["a"].resolve(e)}))},submitAgain:function(t){var o=e.creatDataParam();return o["reason"]=t.reason||"",o["remark"]=t.remark||"",s["a"].uploadProcessData(o)}};return{model:t,init:function(e){var o=a["a"].model.nodeList;o.forEach((function(o){o.id==e&&(t.list=o)})),t.list.child_node.forEach((function(t){r["default"].prototype.$set(t,"selected",1==t.status)})),console.log("init finish")},submit:function(t){return e.submit(t)},submitAgain:function(t){return e.submitAgain(t)},getConditions:function(){return e.getConditions()}}}()},bab0:function(t,e,o){var n=o("ead7");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var r=o("85cb").default;r("c3105686",n,!0,{})},db55:function(t,e,o){"use strict";o("5ab2"),o("e10e");var n=o("28f8"),r=(o("e697"),o("6d57"),o("e44b"),o("cc57"),o("fd50")),a=o("07a4"),i=o("a18c"),s=o("6013"),c=o("0523"),u=o("ca33"),d=o("a593");function l(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function f(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?l(Object(o),!0).forEach((function(e){Object(n["a"])(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}e["a"]=function(){var t={},e={},o={review_material:"delivery_review_material",handle_finance:"delivery_handle_finance",handle_property:"delivery_handle_property",check_room:"delivery_check_room",give_gift:"delivery_receive_gift",delivery_confirm:"delivery_confirm"};return e.getConditions=function(){return{batchId:t.roomInfo.batchId,roomId:t.roomInfo.room_list[t.currRoomIndex].room_id}},e.gotoNextRoom=function(){var o=t.roomInfo.room_list.length;return t.currRoomIndex<o-1?(t.currRoomIndex+=1,t.currRoom=t.roomInfo.room_list[t.currRoomIndex],e.load()):r["a"].resolve()},e.load=function(){var n=e.getConditions();return s["a"].getTodoDeliveryDetail(n).then((function(n){t.nodeList=[],t.baseInfo.delivery_qualification=n.delivery_qualification,t.baseInfo.appointment_process_list=n.appointment_process_list||[],t.baseInfo.checkroom_type=n.checkroom_type,t.baseInfo.delivery_unqualified_reason=n.delivery_unqualified_reason,t.baseInfo.hasTag=!1,t.baseInfo.room_name=t.roomInfo.room_list[t.currRoomIndex].room_name,t.baseInfo.customers=[],t.no="",_.each(n.customer_list,(function(e){t.baseInfo.customers.push({customerName:e.customer_name,customerPhone:e.customer_phone,canDialTelphonee:-1===e.customer_phone.indexOf("*"),hasTag:e.has_tag}),1==e.has_tag&&(t.baseInfo.hasTag=!0)})),n.no&&(t.no=n.no),n.signin_id&&(t.roomInfo.signin_id=n.signin_id);var r=a["a"].state.app.global.currentBatchType;_.each(t.sourseData,(function(e,a){var i={name:e.name,id:a,child_node:[],type:o[e.function_code],status:n.process[a]&&1==n.process[a].status?n.process[a].status:0,authRight:d["default"].prototype.$checkRight("view_room",r)&&d["default"].prototype.$checkRight(e.function_code,r)};_.each(e.child_process,(function(t,e){var o={name:t.name,type:t.type,remark:t.remark,id:e};n.process[a]&&1==n.process[a].status&&n.process[a].child_process[e]&&n.process[a].child_process[e].status?o["status"]=n.process[a].child_process[e].status:o["status"]=0,i.child_node.push(o)})),t.nodeList.push(i)}));for(var i=0;i<t.nodeList.length;i++){for(var s=!1,c=0;c<t.nodeList[i].child_node.length;c++)1==t.nodeList[i].child_node[c].status&&(s=!0);t.nodeList[i]["showStatus"]=s}return e.updateCheckroomNode().then((function(){return t.nodeList}))}))},e.updateCheckroomNode=function(){var e=r["a"].when();return t.currRoom.batchRoomId||(e=c["a"].getBatchRoomList(t.roomInfo.batchId,[t.currRoom.room_id]).then((function(e){return!_.isEmpty(e)&&(t.currRoom.batchRoomId=e[0].id,!0)}))),e.then((function(e){if(!1!==e)return s["a"].hasUploadData(t.currRoom.batchRoomId).then((function(e){if(_.isEmpty(e))return r["a"].resolve();var o=_.find(t.nodeList,{type:"delivery_check_room"});if(o){var n=!1;e.forEach((function(t){o.child_node.forEach((function(e){("问题"===t.type&&"登记问题"===e.name||"房间"===t.type&&"登记问题"!==e.name)&&(e.status=1),n=n||1==e.status}))})),o.showStatus=n,o.status=1,o.hasUpload=!0}}))}))},{model:t,initModel:function(e){t.roomInfo=e,t.currRoomIndex=0,t.currRoom=t.roomInfo.room_list[0],t.baseInfo={customers:[]};for(var o=t.roomInfo.room_list.length,n=0;n<o;n++)t.roomInfo.room_list[n].ans=n},init:function(){return s["a"].getDeliveryNodeList().then((function(o){return t.sourseData=o,_.each(t.sourseData,(function(t,e){_.each(t.child_process,(function(t,e){t.type=t.type.substr(0,t.type.length-1)}))})),e.load()}))},gotoNextRoom:function(){return e.gotoNextRoom()},gotoCheckRoom:function(){var e=a["a"].state.app.global.currentBatchType,o={deliveryprocess:{name:"正式交付",type:"交付",batch_type:"delivery",from:"deliveryprocess"},online_delivery_center:{name:"在线交房",type:"在线交付",batch_type:"online_delivery",from:"online_delivery_center"}},n=o[e]["batch_type"];return s["a"].getRoomData(t.roomInfo.batchId,t.currRoom.room_id).then((function(r){if(!_.isEmpty(r)){var s={batchRoomId:r.id,roomId:r.room_id,building_id:r.building_id,batch_unit_id:r.batch_unit_id,type:n,fitment_standard:r.fitment_standard,roomTitle:r.building_name+r.room_no,menuType:a["a"].state.app.global.currentMenuType,batch_id:t.roomInfo.batchId};return c["a"].getRoomTypeImageFileIsExists(r.id).then((function(t){t?(s.mode="0",s.isImageExists=!0):s.from=e,console.log("/checkroom/".concat(n,"-roomdetail")),i["a"].push({path:"/checkroom/".concat(n,"-roomdetail"),query:f(f({},s),{},{from:e})})}))}return a["a"].commit("app/APP",{currentBatchType:n}),i["a"].push({path:"/checkroom/".concat(n,"-batch-unit"),query:o[e]})}))},load:function(){return e.load()},uploadRoomData:function(e){return s["a"].getRoomData(t.roomInfo.batchId,t.currRoom.room_id).then((function(t){return u["a"].uploadData(t.batch_unit_id,t.id).then((function(){e.hasUpload=!1}))}))}}}()},ead7:function(t,e,o){e=t.exports=o("690e")(!1),e.push([t.i,"\n.zhkf .retransacted-reason .content[data-v-768f36fc] {\n  background: #fff;\n}\n.zhkf .retransacted-reason .content .reason-list[data-v-768f36fc] {\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n.zhkf .retransacted-reason .footer[data-v-768f36fc] {\n  width: 100%;\n  text-align: center;\n  margin-top: 20px;\n}\n.zhkf .retransacted-reason .footer .btn[data-v-768f36fc] {\n    display: inline-block;\n    width: 90%;\n    height: 45px;\n    color: #fff;\n    font-size: 16px;\n    line-height: 45px;\n    text-align: center;\n    background: -webkit-gradient(linear, left top, right top, from(#1cb0fd), to(#0099ff));\n    background: linear-gradient(90deg, #1cb0fd 0%, #0099ff 100%);\n    -webkit-box-shadow: 0px 2px 4px 0px rgba(0, 153, 255, 0.27);\n            box-shadow: 0px 2px 4px 0px rgba(0, 153, 255, 0.27);\n    border-radius: 4px;\n}\n.zhkf .retransacted-reason .active[data-v-768f36fc] {\n  color: #0085ff;\n}\n",""])}}]);