(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-4bd9f522"],{"0970":function(e,t,n){"use strict";n("6d57"),n("cc57");var o=n("1834"),i=function(){var e="select ci.id,ci.name,ci.parent_id,ci.sort,ci.ifEnd,cig.remark from check_item ci left join check_item_guide cig on ci.id=cig.item_id";return o["a"].query(e)},r=function(e){var t="select remark from check_item_guide where item_id = ?",n=[e];return o["a"].queryOne(t,n).then((function(e){return e&&e.remark}))},a=function(e){var t="select item.full_name,guide.remark as guide           from check_item_guide guide               inner join check_item item on guide.item_id=item.id           where guide.item_id=?";return o["a"].queryOne(t,[e])},c=function(){var e="select item.id,item.name,item.parent_id,guide.id is not null as has_guide       from check_item item           left join check_item_guide guide on item.id=guide.item_id              and ifnull(guide.remark,'') <> ''       order by sort";return o["a"].query(e)},s={getCheckItemWithGuide:i,getGuideByCheckItemId:r,getCheckItemList:c,getGuideAndItemByItemId:a},d=n("a14a"),l=n.n(d),m=function(){var e={};return{getItem:function(t,n){if(void 0===t||null===t)throw new TypeError("key参数为空");return n?e[t]:l.a.cloneDeep(e[t])},setItem:function(t,n){if(void 0===t||null===t)throw new TypeError("key参数为空");if(arguments.length<2)throw new TypeError("value参数未设置");e[t]=n},clear:function(){e={}}}},u=m(),h={IS_NEED_DOWNLOAD_BASE_DATA:"is_need_download_base_data",LAST_EXEC_TIME_DATA:"last_exec_time_data",LAST_GUIDE_SORT_MAP:"last_guide_sort_map"},p=function(){var e=function e(t,n){t.remark&&""!=t.remark&&(t.has_guide=!0),t.children=[];for(var o=0;o<n.length;o++)n[o].parent_id==t.id&&t.children.push(n[o]);if(t.children&&t.children.length>0)for(var i=0;i<t.children.length;i++)t.children[i]=e(t.children[i],n);return t};return{getCheckItemGuideByItemId:function(e){return s.getGuideByCheckItemId(e)},getCheckItemTree:function(){var t={id:""};return s.getCheckItemWithGuide().then((function(n){t=e(t,n);for(var o=0;o<t.children.length;o++)if("所有检查项"==t.children[o].name)return t.children[o].children;return t.children}))},getCheckItemTreeAndGuideSortMap:function(){return console.time("getData"),s.getCheckItemList().then((function(e){console.timeEnd("getData"),console.time("processData");var t={},n=[],o=0,i=[];function r(e,t){e.forEach((function(e){e.depth=t,e.tree?r(e.tree,t+1):e.has_guide&&(e.guide_sort=o,n[o]=e.id,o++)}))}return e.forEach((function(e){t[e.id]=e})),e.forEach((function(e){e.parent_id&&t[e.parent_id]?(t[e.parent_id].tree=t[e.parent_id].tree||[],t[e.parent_id].tree.push(e)):i.push(e)})),r(i,1),u.setItem(h.LAST_GUIDE_SORT_MAP,n),console.timeEnd("processData"),{tree:i,guideSortMap:n}}))},getGuideSortMapFromCatch:function(){return u.getItem(h.LAST_GUIDE_SORT_MAP,!0)},getGuideAndItemByItemId:s.getGuideAndItemByItemId}};t["a"]=p()},"0a37":function(e,t,n){var o=n("1c4e");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var i=n("85cb").default;i("76d9ba51",o,!0,{})},1390:function(e,t,n){"use strict";n("9dd9"),n("6d57"),n("cc57"),n("e697"),n("f548");var o=n("fd50"),i=n("a14a"),r=n.n(i),a=n("07a4"),c=n("3fa2"),s=n("0cd9"),d=n("5c1b"),l=n("8fee"),m=n("85cd"),u="[model]/problem-check-item-model.js：",h=c["a"].room,p=[],f=null,_={},b={},I=function(e){if(!r.a.isEmpty(v.model.endCheckItems)){var t=[],n=r.a.isEmpty(p),o=e.toLowerCase(),i=e.toUpperCase();r.a.each(v.model.endCheckItems,(function(r){(r.item_full_name.indexOf(o)>-1||r.item_full_name.indexOf(i)>-1)&&t.push({id:r.item_id,name:r.item_name,full_name:r.item_full_name,name_color:r.item_full_name.replace(f,'<span class="color-blue">'+e+"</span>")}),n&&p.push(r.item_id)})),console.log("个数",v.model.endCheckItems.length,p.length),n&&(p='"'+p.join('","')+'"'),_.checkItem.data=t}return console.log(u,"搜索检查项",[_.checkItem.data,p]),g(e)},g=function(e){return l["a"].searchDesc(e,p).then((function(t){return t=r.a.filter(t,(function(e){return r.a.find(v.model.endCheckItems,{item_id:e.item_id})})),r.a.each(t,(function(t){var n=r.a.find(v.model.endCheckItems,{item_id:t.item_id});t.item_name=n.item_name,t.item_full_name=n.item_full_name,t.name_color=t.item_full_name+"-"+t.name.replace(f,'<span class="color-blue">'+e+"</span>")})),_.desc.data=_.desc.data.concat(t),console.log(u,"搜索问题描述",[_.desc.data]),k(e)}))},k=function(e){return m["a"].searchByItems(e,p).then((function(t){r.a.each(t,(function(t){t.name_color=t.item_full_name+"-"+t.desc_name+"；"+t.name.replace(f,'<span class="color-blue">'+e+"</span>")})),_.remark.data=_.remark.data.concat(t),console.log(u,"搜索补充说明",[_.remark.data])}))},y=function(){v.model.searchResult.checkItem.data=[],v.model.searchResult.desc.data=[],v.model.searchResult.remark.data=[],_.checkItem.data=[],_.desc.data=[],_.remark.data=[]},v={model:{},initSearch:function(){_={checkItem:{title:"检查项",data:[]},desc:{title:"问题描述",data:[]},remark:{title:"补充说明",data:[]}},v.model.endCheckItems=[],p=[],v.model.searchResult=r.a.cloneDeep(_),"毛坯"===h.fitmentStandard?b.is_for_rough=1:"精装"===h.fitmentStandard&&(b.is_for_decorated=1)},initCheckItem:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return p=[],v.model.positionId=e,v.model.checkItems=[],v.initSearch(),d["a"].getCheckItemList(h.batchRoomId,e,t,h.fitmentStandard,h.isVirtual).then((function(t){return v.model.checkItems=t,h.projectId=h.projectId||a["a"].state.projectList.currentItem.id,s["a"].getPositionEndItemForSearch(h.projectId,e,h.fitmentStandard,h.isVirtual)})).then((function(e){v.model.endCheckItems=e}))},initSpecialCheckItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return p=[],v.model.positionId=e,v.model.checkItems=[],d["a"].getBatchCheckItem(h.batchId||"","毛坯"===h.fitmentStandard,e).then((function(e){e.forEach((function(e){e.item_name=e.item_full_name,e.child_count=0,e.level=1})),v.model.checkItems=e}))},search:function(e){return y(),e?(f=new RegExp(e,"ig"),I(e).then((function(){v.model.searchResult=r.a.cloneDeep(_);var e=0;return r.a.each(v.model.searchResult,(function(t){e+=t.data.length})),e}))):o["a"].resolve(0)},reset:y};t["a"]=v},"1c4e":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .tip[data-v-829243a6] {\n  width: 250px;\n  text-align: center;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n.zhkf .tip img[data-v-829243a6] {\n    width: 200px;\n}\n.zhkf .tip p[data-v-829243a6] {\n    color: #a0a0a0;\n    line-height: 20px;\n    font-size: 14px;\n    margin: 0 auto;\n    text-align: center;\n    margin-top: 3px;\n}\n",""])},"26eb":function(e,t,n){e.exports=n.p+"img/search.37f508c9.png"},4438:function(e,t,n){"use strict";var o=n("cb6b"),i=n("0e1c");t["a"]={getLocalBusinessToggle:function(){var e=o["a"].getObject(i["a"].BUSINESS_TOGGLE,o["a"].level.user);return e||{enable_opening_tab:0,enable_pass_when_add:0,enable_pass_when_to_repair:0,sign_when_receive_delivery:1,special_project_switch:0,take_photo_when_review:0,take_photo_when_regist:0,hide_owner_phone:0,enable_problem_reason:0}}}},"4d09":function(e,t,n){t=e.exports=n("690e")(!1),t.push([e.i,"\n.zhkf .isIos[data-v-0996c20e] {\n  padding-top: 20px;\n}\n.zhkf .search-form[data-v-0996c20e] {\n  background: -webkit-gradient(linear, left top, right top, from(#1cb0fd), to(#0099ff));\n  background: linear-gradient(90deg, #1cb0fd 0%, #0099ff 100%);\n}\n.zhkf .box[data-v-0996c20e] {\n  height: 100%;\n}\n.zhkf .icon-chazhao[data-v-0996c20e] {\n  color: #bbbbbb;\n  font-size: 14px;\n}\n.zhkf .active[data-v-0996c20e] {\n  color: #0085ff;\n}\n.zhkf .check-item-select[data-v-0996c20e] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .item-list[data-v-0996c20e] {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  overflow: scroll;\n}\n.zhkf .tipBox[data-v-0996c20e] {\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  width: 100%;\n  height: 100%;\n  background: #fff;\n}\n.zhkf .search[data-v-0996c20e] {\n  height: 100%;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.zhkf .search .van-cell[data-v-0996c20e]:not(:last-child)::after {\n    left: 15px;\n}\n.zhkf .search .van-search[data-v-0996c20e] {\n    background: none !important;\n}\n.zhkf .search .van-search__action[data-v-0996c20e]:active {\n    background: none !important;\n}\n.zhkf .isBgWhite[data-v-0996c20e] {\n  background: #fff;\n}\n.zhkf .icon-chazhao[data-v-0996c20e] {\n  color: #bbbbbb;\n  font-size: 14px;\n}\n.zhkf .icon-CombinedShapeCopy[data-v-0996c20e] {\n  color: #bbbbbb;\n  font-size: 14px;\n}\n.zhkf .clear-history[data-v-0996c20e] {\n  text-align: center;\n  font-size: 14px;\n  color: #a0a0a0;\n  padding: 15px 0;\n}\n.zhkf .result[data-v-0996c20e] {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  overflow: scroll;\n}\n.zhkf .result-block[data-v-0996c20e] {\n  margin-bottom: 10px;\n}\n.zhkf .result-block h2[data-v-0996c20e] {\n    color: #a0a0a0;\n    font-size: 14px;\n    line-height: 36px;\n    padding-left: 15px;\n    font-weight: 400;\n    margin: 0;\n    background: #fff;\n}\n.zhkf .search-form[data-v-0996c20e] {\n  z-index: 99;\n}\n.zhkf .search-form[data-v-0996c20e] .van-search .van-field__control {\n    color: #202020 !important;\n}\n",""])},"5c1b":function(e,t,n){"use strict";n("f0e6");var o=n("bbed"),i=n("fa1b"),r=n("07a4"),a=n("fd50");function c(){var e=function(e){e&&e.fitment_standard&&("毛坯"===e.fitment_standard?e.is_for_rough=1:"精装"===e.fitment_standard&&(e.is_for_decorated=1),delete e.fitment_standard)},t=function(e,t,n,i,r){return o["a"].getCheckItemLeaf(e,t,i,r).then((function(e){if(_.isEmpty(e))return[];var t=[];return _.each(e,(function(e){t.push(e.id)})),o["a"].getCheckItemAll(t.join("','"),n,i,r)}))};return{getCheckItemList:function(e,n,i,c,s){var d="毛坯"==c,l=a["a"].when(),m=["全部"];return m.push(1==s?"公区":"房间"),m="('"+m.join("','")+"')",l=r["a"].state.app.global.isUseProjectItem?o["a"].getProjectCheckItemList(e,n,i,d,m):t(e,n,i,d,m),l.then((function(e){return e}))},hasProjectCheckitem:function(e){return o["a"].hasProjectCheckitem(e)},searchCheckItemWithProject:function(t,n,i,r){return e(i),r?o["a"].searchProjectCheckItem(r,t,n,i):o["a"].searchCheckItem(t,n,i)},searchCheckItem:function(t,n,i,r){return console.log("searchCheckItem: ",t,n,i),console.time("searchCheckItem"),e(i),o["a"].hasProjectCheckitem(r).then((function(e){return e?o["a"].searchProjectCheckItem(r,t,n,i):o["a"].searchCheckItem(t,n,i).finally((function(){console.timeEnd("searchCheckItem")}))}))},getHigherLevelTreeListByCheckItemId:function(t,n,i){return console.log("getHigherLevelTree: ",t,n,i),console.time("getHigherLevelTree"),e(i),o["a"].getHigherLevelTreeListByCheckItemId(t,n,i).finally((function(){console.timeEnd("getHigherLevelTree")}))},getCheckItemLevel:function(e,t){return o["a"].getCheckItemLevel(e,t)},getPositionItemByRoom:function(e,t,n){var i=a["a"].when(),c=["全部"];return c.push(1==n?"公区":"房间"),c="('"+c.join("','")+"')",i=r["a"].state.app.global.isUseProjectItem?o["a"].getProjectPositionItemByRoom(e,t,c):o["a"].getPositionItemByRoom(e,c),i.then((function(e){return e}))},setIsUseProjectItemOfBatchUnit:function(e){return o["a"].getProjectItemOfBatchUnit(e).then((function(e){var t=!1;e&&(t=!0),r["a"].commit("app/APP",{isUseProjectItem:t})}))},getBatchCheckItem:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return i["a"].getCheckItemList(e,t,n,r["a"].state.app.global.isUseProjectItem).then((function(e){return console.log("BatchCheckItem",e),a["a"].resolve(e)}))}}}t["a"]=c()},"5cf9":function(e,t,n){"use strict";var o={props:{isShow:{type:Boolean,default:!0},imgUrl:{type:String,required:!0},tipCont:{type:String,default:"系统繁忙请稍后重试"}}},i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticClass:"tip"},[n("img",{attrs:{src:e.imgUrl,alt:"tip"}}),e._v(" "),e.tipCont?n("p",{domProps:{innerHTML:e._s(e.tipCont)}}):e._e()])},r=[],a=n("d082");function c(e){n("0a37")}var s=!1,d=c,l="data-v-829243a6",m=null,u=Object(a["a"])(o,i,r,s,d,l,m);t["a"]=u.exports},"77a8":function(e,t,n){"use strict";n("6d57");function o(){var e={list:[]};return{model:e,init:function(){e.list=[{key:"status",value:"常用状态",name:"常用状态",displayName:"所有状态",list:[{name:"常用状态",value:"常用状态"},{name:"所有状态",value:""}]},{key:"position",value:"",name:"全部",displayName:"部位",list:[]},{key:"checkItem",value:"",name:"全部",displayName:"检查项",list:[]}]},update:function(t){e.list.forEach((function(e){t[e.key]&&(e.list=t[e.key])}))},getCondition:function(){var t={};return e.list.forEach((function(e){t[e.key]=e.value})),t},resetCheckItemValue:function(){e.list.forEach((function(e){"checkItem"===e.key&&(e.value="",e.name="全部")}))}}}t["a"]=o()},"85cd":function(e,t,n){"use strict";var o=n("1834"),i=n("0938"),r="checkitem_remark_history",a={createCondition:function(e,t){if(_.isEmpty(e))return"";t=t?"crh.":"";var n=[];return _.each(e,(function(e,o){n.push(t+o+"="+e)})),n=n.join(" and "),n},insertHistory:function(e){e.id=i["a"].uuid(),e.used_time=e.used_time||1,e.last_used_time=e.last_used_time||i["a"].getNowDate();var t=[],n=[];return _.each(e,(function(e,o){t.push(o),n.push(e)})),o["a"].insert(r,t,n).then((function(){return e.id}))},updateHistory:function(e,t){return o["a"].update(r,e,t)},getOneHistory:function(e,t,n){var i="select * from "+r+" where item_id=? and desc_id=? and remark=?";return o["a"].queryOne(i,[e,t,n])},updateUserdTime:function(e,t){if(!t)return $q.error("次数不能为0");var n={last_used_time:i["a"].getNowDate(),used_time:t};return o["a"].update(r,n,{id:e})},getListByItemIdOrderDate:function(e,t){var n="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ?  order by crh.last_used_time desc limit "+t;return o["a"].query(n,[e])},getListByItemIdOrderUsedTime:function(e,t,n){var i=n.length?'and crh.id not in ("'+n.join('","')+'")':"",r="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ? "+i+" order by crh.used_time desc limit "+t;return o["a"].query(r,[e])},deleteItemById:function(e){var t="delete from checkitem_remark_history where id=?";return o["a"].query(t,[e])},searchByItems:function(e,t){var n="select crh.id,crh.remark as name,crh.item_id,ci.name as item_name,ci.full_name as item_full_name,crh.desc_id,cid.name as desc_name from checkitem_remark_history crh inner join check_item ci on ci.id = crh.item_id inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id in ("+t+') and (lower(crh.remark) like "%" || ? || "%" or upper(crh.remark) like "%" || ? || "%") order by crh.remark';return o["a"].query(n,[e,e])}},c=a,s={getList:function(e){if(!e)return $q.reject("itemId为空");var t=[];return c.getListByItemIdOrderDate(e,3).then((function(n){if(n){var o=[];return _.each(n,(function(e){o.push(e.id),t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),c.getListByItemIdOrderUsedTime(e,17,o).then((function(e){return e&&_.each(e,(function(e){t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),t}))}return $q.reject(t)}))},deleteItem:function(e){return c.deleteItemById(e)},upsertHistory:function(e,t,n){return c.getOneHistory(e,t,n).then((function(o){return o?c.updateUserdTime(o.id,o.used_time+1):c.insertHistory({item_id:e,desc_id:t,remark:n})}))},searchByItems:function(e,t){return c.searchByItems(e,t)}};t["a"]=s},8704:function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"8fee":function(e,t,n){"use strict";var o=n("760e"),i=n("a14a"),r=n.n(i);t["a"]={getCheckItemDescList:function(e,t,n){return o["a"].getCheckItemDescList(e,t,n).then((function(e){return e}))},getRoomCheckListDescList:function(e,t){return o["a"].getRoomCheckListDescList(e,t).then((function(e){if(!r.a.isEmpty(e))for(var t=0;t<e.length&&t<3;t++)e[t].isImportant=!0;return e}))},searchDesc:function(e,t){return o["a"].searchDesc(e,t)}}},"98a4":function(e,t,n){"use strict";n("e697");var o=n("85cd"),i=n("fd50"),r=n("a593"),a={model:{},init:function(){a.model.historyList={},a.model.currItemId="",a.model.currList=[]},loadList:function(e,t){return e?(_.isEmpty(a.model)&&a.init(),t=t||!1,a.model.currItemId=e,_.isEmpty(a.model.historyList[e])||t?(console.log("=== itemId ===",e),o["a"].getList(e).then((function(t){console.log(t),a.model.historyList[e]=t,a.model.currList=t})).catch((function(){a.model.historyList[e]=[],a.model.currList=[]}))):(a.model.currList=a.model.historyList[e],i["a"].resolve())):i["a"].reject()},upsertHistory:function(e,t,n){return o["a"].upsertHistory(e,t,n).then((function(){a.loadList(e,!0)}))},delHistory:function(e){return o["a"].deleteItem(e).then((function(){var t=_.find(a.model.currList,{id:e});if(t){var n=a.model.currList.indexOf(t);n>-1&&a.model.currList.splice(n,1)}})).catch((function(e){console.error(e),r["default"].prototype.$toast("删除历史失败！")}))}};t["a"]=a},a9ec:function(e,t,n){"use strict";n("6d57");var o=n("a593"),i=n("3fa2"),r=n("d485"),a=n("9af1"),c=n("77a8");function s(){var e={},t={problemList:[],buttons:[]},n={},s="tab-icon1",d={"待派单":"tab-icon5","待整改":"tab-icon2","已整改":"tab-icon3","已通过":"tab-icon4","已作废":"tab-icon6","非正常关闭":"tab-icon7"},l=i["a"].room;return n.iniStatusStyle=function(){t.problemList.forEach((function(e){d[e.status]?e.status_style=d[e.status]:e.status_style=s}))},n.initFilter=function(){return r["a"].getPositionList(l.batchRoomId).then((function(e){t.filterList.position.list=e}))},n.getCondition=function(){var e={};_.each(t.filterList,(function(t,n){e[n]=t.value}))},n.getProblemPoints=function(){o["default"].prototype.$eventBus.$emit("app.roomdetail:updateProblemPoints",t.problemList)},e={model:t,init:function(){return r["a"].getProblemList(l.batchRoomId,0,1,!0).then((function(e){t.problemList=e,n.iniStatusStyle()})).then((function(){return console.log("fromType------",l.fromType),a["a"].getDefaultFilterList(t.problemList,l.batchRoomId,l.fromType).then((function(e){c["a"].update(e),console.log("filters---------",e),n.getProblemPoints()}))})).then((function(){if(!_.isEmpty(c["a"].model.list))return e.updateProblemList()}))},updateProblemList:function(e){var o=c["a"].getCondition();a["a"].hideProblemByFilter(t.problemList,c["a"].model.list,o,e),n.getProblemPoints()}},e}t["a"]=s()},b643:function(e,t,n){"use strict";var o=n("7ee1");t["a"]={getReasonConfig:function(){return o["a"].getList()},getProblemReason:function(e){return o["a"].getProblemReason(e)}}},bad1:function(e,t,n){"use strict";var o=n("97ba");t["a"]={getPositionList:function(e){return console.log("batchRoomId",e),o["a"].getPositionList(e).then((function(e){return e}))},getPositionByIds:function(e){return o["a"].getPositionByIds(e)},getPositionNameById:function(e){return o["a"].getPositionNameById(e)}}},c0c3:function(e,t,n){"use strict";var o=n("69b3"),i=n("8704"),r=n("7108");n("0aed")("search",1,(function(e,t,n,a){return[function(n){var o=e(this),i=void 0==n?void 0:n[t];return void 0!==i?i.call(n,o):new RegExp(n)[t](String(o))},function(e){var t=a(n,e,this);if(t.done)return t.value;var c=o(e),s=String(this),d=c.lastIndex;i(d,0)||(c.lastIndex=0);var l=r(c,s);return i(c.lastIndex,d)||(c.lastIndex=d),null===l?-1:l.index}]}))},cc84:function(e,t,n){var o=n("4d09");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var i=n("85cb").default;i("739b4336",o,!0,{})},d2b3:function(e,t,n){"use strict";n.r(t);n("5ab2"),n("6d57"),n("e44b"),n("e10e"),n("cc57"),n("c0c3");var o=n("28f8"),i=n("db5f"),r=n("1390"),a=n("e810"),c=n("5c1b"),s=n("5cf9"),d=n("a14a"),l=n.n(d),m=n("f2de"),u=n("ba1a");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(o["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f,_="[views]/checkitem-select：",b=!1,I="",g={name:"CheckitemSelect",components:{tip:s["a"]},data:function(){return{title:"",loading:!1,keyword:"",checkItemModel:{checkItems:[]},topItemId:"",parentItemId:"",parentItemName:"",fromType:"",fromPage:"",fitmentStandard:"",currItemId:"",searchMode:!1,isBgWhite:!1,searchWord:"",searchNodata:!1,tipCont:"输入关键字进行搜索",searchHistory:[],searchLoading:!1,searchResult:[],level:1,showSearchBar:!0}},computed:p({},Object(m["e"])({currentBatchType:function(e){return e.app.global.currentBatchType},currentMenuType:function(e){return e.app.global.currentMenuType},isIOSX:function(e){return e.app.global.isIOSX},isIOS:function(e){return e.app.global.isIOS}})),watch:{keyword:function(e){this.doSearch()}},activated:function(){this.init()},beforeRouteLeave:function(e,t,n){this.clearInput(),n()},methods:{init:function(){var e=this;this.checkItemModel={checkItems:[]},this.searchMode=!1,this.loading=!0,this.$toast.loading({mask:!0,message:"加载中...",duration:0});var t=u["a"].getDecodeQuery(this.$route.query);f=i["a"].model.problem,this.topItemId=t.top_item_id,this.parentItemId=t.parent_item_id||"",this.parentItemName=t.parent_item_name||"",this.showSearchBar=!this.parentItemId&&!l.a.isBoolean(t.isSpecial),this.fromType=t.type,this.fitmentStandard=t.fitment_standard,this.fromPage="addProblem"==t.fromPage?"登记问题":"编辑问题",this.title=t.parent_item_name||"选择检查项",console.log(_,"init() - params.isSpecial=",t.isSpecial),l.a.isBoolean(t.isSpecial)?(console.log(_,"init() - ProblemCheckItemModel.initSpecialCheckItem() 初始化专项检查项"),r["a"].initSpecialCheckItem(f.positionId).then((function(){e.checkItemModel=r["a"].model,e.$toast.clear(),e.loading=!1,f.checkItemId&&(e.currItemId=f.checkItemId)}))):(console.log(_,"init() - ProblemCheckItemModel.initCheckItem() 初始化检查项"),r["a"].initCheckItem(f.positionId,this.parentItemId).then((function(){e.checkItemModel=r["a"].model,e.$toast.clear(),e.loading=!1,f.checkItemId&&(e.currItemId=f.checkItemId)})))},select:function(e){var t=this;if(console.log(_,"点击搜索项",e),e.child_count>0)1==e.level&&(this.topItemId=e.item_id),this.$router.push({path:"/checkroom/".concat(this.currentMenuType||this.currentBatchType,"-checkitem-select/").concat((new Date).getTime()),query:{top_item_id:this.topItemId,parent_item_id:e.item_id,parent_item_name:(this.parentItemName?this.parentItemName+"-":"")+e.item_name,type:this.fromType,fitment_standard:this.fitmentStandard,level:e.level}});else{var n=l.a.extend({checkItemId:e.item_id,checkItemName:(this.parentItemName?this.parentItemName+"-":"")+e.item_name,topCheckItemId:1==e.level?e.item_id:this.topItemId},this.getUpdateParams(e.item_id));i["a"].updateProblem(n).then((function(){"simulate"===t.fromType&&1==t.$route.params.isSpecial&&(e.level=1),t.$router.push({path:"/checkroom/".concat(t.currentMenuType||t.currentBatchType,"-desc-select"),query:{top_item_id:t.topItemId,parent_item_id:e.item_id,parent_item_name:(t.parentItemName?t.parentItemName+"-":"")+e.item_name,type:t.fromType,level:e.level,fitment_standard:t.fitmentStandard}})}))}},getUpdateParams:function(e){var t={};return f.checkItemId&&f.checkItemId!==e&&(t={descIds:"",descNames:"",contractors:"",contractorIds:"",responsibilityUnitIds:"",responsibilityUnits:""}),t},changeToSearchMode:function(){this.searchMode=!0,this.searchHistory.length||(this.searchHistory=a["a"].list);var e=this.$refs.searchInput.querySelector('input[type="search"]');setTimeout((function(){e.focus()}),300)},changeToListMode:function(){this.searchMode=!1,this.clearInput()},clearSearchHistory:function(){a["a"].clear()},removeSearchHistory:function(e){a["a"].remove(e)},clearInput:function(){b=!1,this.keyword="",I="",this.searchNodata=!1,r["a"].reset(),this.searchResult=[],this.tipCont="输入关键字进行搜索"},doSearch:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t&&(this.keyword=t),""!==l.a.trim(this.keyword)?b||this.keyword!=I&&(this.searchLoading=!0,this.searchResult=[],I=this.keyword,b=!0,r["a"].search(this.keyword).then((function(t){b=!1,e.$toast.clear(),e.searchLoading=!1,""!==e.keyword?0===t?(e.searchWord=e.keyword,e.searchNodata=!0,e.tipCont='抱歉没有找到与“<span style="color:#0099FF;">'.concat(e.keyword,"</span>”相关的结果")):(e.searchNodata=!1,e.searchResult=l.a.cloneDeep(e.checkItemModel.searchResult),console.log(_,"doSearch() - 搜索结果",e.checkItemModel.searchResult)):I=""})).catch((function(t){console.error(t),b=!1,e.$toast.clear(),e.searchLoading=!1}))):this.clearInput()},clickSearchItem:function(e){var t=this;a["a"].add(this.keyword);var n={},o=!1,r=!0;e.item_id&&e.desc_id?n={checkItemId:e.item_id,checkItemName:e.item_full_name,topCheckItemId:"",descIds:e.desc_id,descNames:e.desc_name,remark:e.name}:e.item_id?n={checkItemId:e.item_id,checkItemName:e.item_full_name,topCheckItemId:"",descIds:e.id,descNames:e.name}:(o=!0,r=!1,n={checkItemId:e.id,checkItemName:e.full_name,topCheckItemId:""}),n=l.a.extend(this.getUpdateParams(e.item_id),n),i["a"].updateProblem(n,r).then((function(){var e=1;o?t.parentItemId?c["a"].getCheckItemLevel(f.positionId,t.parentItemId).then((function(e){e?(e+=1,t.$router.push({path:"/checkroom/".concat(t.currentMenuType||t.currentBatchType,"-desc-select"),query:{fromPage:t.fromPage,level:e,fitment_standard:t.fitmentStandard}})):t.$toast("获取检查项层级失败")})):t.$router.push({path:"/checkroom/".concat(t.currentMenuType||t.currentBatchType,"-desc-select"),query:{fromPage:t.fromPage,level:e,fitment_standard:t.fitmentStandard}}):t.$router.go(-1),t.clearInput()}))}}},k=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"box"},[o("div",{directives:[{name:"show",rawName:"v-show",value:!e.searchMode,expression:"!searchMode"}],staticClass:"check-item-select"},[o("cus-nav-bar",{attrs:{title:e.title,"left-arrow":"",border:!1}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.showSearchBar,expression:"showSearchBar"}],on:{click:e.changeToSearchMode}},[o("van-search",{attrs:{placeholder:"搜索检查项/问题描述/补充说明",disabled:"true"}},[o("i",{staticClass:"iconfont icon-chazhao",attrs:{slot:"left-icon"},slot:"left-icon"})])],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&e.checkItemModel.checkItems.length,expression:"!loading && checkItemModel.checkItems.length"}],staticClass:"item-list"},e._l(e.checkItemModel.checkItems,(function(t,n){return o("van-cell",{key:n,class:{active:0==t.child_count&&t.item_id===e.currItemId},attrs:{title:t.item_name,"is-link":t.child_count>0},on:{click:function(n){return e.select(t)}}},[0==t.child_count&&t.item_id===e.currItemId?o("template",{slot:"right-icon"},[o("i",{staticClass:"iconfont icon-gou"})]):e._e()],2)})),1),e._v(" "),e.loading||e.checkItemModel.checkItems.length?e._e():o("div",{staticClass:"tipBox"},[o("tip",{attrs:{"img-url":n("26eb"),"tip-cont":"当前部位尚未设置检查项"}})],1)],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.searchMode,expression:"searchMode"}],staticClass:"search",class:{"bg-white":e.isBgWhite}},[o("form",{staticClass:"search-form",class:{isIos:e.isIOS},attrs:{action:"/"}},[o("van-search",{ref:"searchInput",attrs:{placeholder:"搜索检查项/问题描述/补充说明","show-action":"",background:"linear-gradient(90deg,rgba(28,176,253,1) 0%,rgba(0,153,255,1) 100%)"},on:{cancel:e.changeToListMode,search:e.doSearch,clear:e.clearInput},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[o("i",{staticClass:"iconfont icon-chazhao",attrs:{slot:"left-icon"},slot:"left-icon"})])],1),e._v(" "),o("section",{directives:[{name:"show",rawName:"v-show",value:!e.keyword&&e.searchHistory.length,expression:"!keyword && searchHistory.length"}],staticClass:"history"},[e._l(e.searchHistory,(function(t,n){return o("van-cell",{key:n,attrs:{"is-link":"",title:t},on:{click:function(n){return e.doSearch(t)}}},[o("template",{slot:"right-icon"},[o("i",{staticClass:"iconfont icon-CombinedShapeCopy",on:{click:function(n){return n.stopPropagation(),e.removeSearchHistory(t)}}})])],2)})),e._v(" "),o("div",{staticClass:"clear-history",on:{click:e.clearSearchHistory}},[e._v("清除全部搜索记录")])],2),e._v(" "),o("section",{staticClass:"result"},e._l(e.searchResult,(function(t,n){return t.data.length?o("section",{key:n,staticClass:"result-block"},[o("h2",[e._v(e._s(t.title))]),e._v(" "),o("van-cell-group",e._l(t.data,(function(t,n){return o("van-cell",{key:n,on:{click:function(n){return e.clickSearchItem(t)}}},[o("template",{slot:"title"},[o("span",{domProps:{innerHTML:e._s(t.name_color)}})])],2)})),1)],1):e._e()})),0),e._v(" "),e.searchLoading||!e.searchNodata&&(e.keyword||e.searchHistory.length)?e._e():o("div",{staticClass:"tipBox"},[o("tip",{attrs:{"img-url":n("26eb"),"tip-cont":e.tipCont}})],1)])])},y=[],v=n("d082");function w(e){n("cc84")}var P=!1,C=w,S="data-v-0996c20e",L=null,x=Object(v["a"])(g,k,y,P,C,S,L);t["default"]=x.exports},db5f:function(e,t,n){"use strict";n("5ab2"),n("e44b"),n("e10e"),n("f0e6");var o=n("28f8"),i=(n("5f54"),n("6d57"),n("fd50")),r=n("c2c1"),a=n("0938"),c=n("8ae6"),s=n("a14a"),d=n.n(s),l=n("07a4"),m=n("a593"),u=n("98a4"),h=n("3fa2"),p=n("a9ec"),f=n("db99"),_=n("bad1"),b=n("964e"),I=n("0970"),g=n("5c1b"),k=n("dd0a"),y=n("4438"),v=n("b643"),w=n("bbed");function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){Object(o["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=h["a"].room,L="",x="";function T(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];n.length>0?console.log("[model]/problem-model.js：",e,n):console.log("[model]/problem-model.js：",e)}function O(){if(!D.model.problem.contractorIds&&D.model.problem.checkItemId)return k["a"].getContractor(S.batchRoomId||D.model.problem.batchRoomId,D.model.problem.checkItemId,D.model.problem.descIds).then((function(e){var t=[],n=[];D.model.contractorDisabled=!1,d.a.isEmpty(e)||(d.a.each(e,(function(e){t.push(e.contractor_id),n.push(e.contractor_name)})),t.length>1&&(D.model.contractorDisabled=!0),t=t.join(";"),n=n.join("；"),D.model.problem.contractors=n,D.model.problem.contractorIds=t,D.model.problem.responsibilityUnitIds=t,D.model.problem.responsibilityUnits=n)}))}function j(){var e=D.model.problem.id?"editProblem":"addProblem";!D.model.selectes&&(D.model.selectes={position:{},checkItem:{},desc:{},contractor:{},responsibleCompany:{}}),D.model.positionDisabled||(D.model.selectes.position={path:"/checkroom/".concat(l["a"].state.app.global.currentMenuType||l["a"].state.app.global.currentBatchType,"-position-select"),query:{fromPage:e}}),D.model.problem.positionId?(D.model.selectes.checkItem={path:"/checkroom/".concat(l["a"].state.app.global.currentMenuType||l["a"].state.app.global.currentBatchType,"-checkitem-select/").concat((new Date).getTime()),query:{type:S.fromType,fitment_standard:S.fitmentStandard,fromPage:e,isSpecial:+S.isSpecial}},D.model.problem.checkItemId?(S.isSpecial||g["a"].getHigherLevelTreeListByCheckItemId(D.model.problem.checkItemId,D.model.problem.positionId,{fitment_standard:S.fitmentStandard}).then((function(t){D.model.selectes.checkItem.query=d.a.extend(D.model.selectes.checkItem.query,{history:JSON.stringify(t),level:0,fromPage:e})})),D.model.selectes.desc={path:"/checkroom/".concat(l["a"].state.app.global.currentMenuType||l["a"].state.app.global.currentBatchType,"-desc-select"),query:{fromPage:e,fitment_standard:S.fitmentStandard,level:0}},D.model.selectes.contractor={path:"/checkroom/".concat(l["a"].state.app.global.currentMenuType||l["a"].state.app.global.currentBatchType,"-contractor-select"),query:{fromPage:e}},D.model.selectes.responsibleCompany={path:"/checkroom/".concat(l["a"].state.app.global.currentMenuType||l["a"].state.app.global.currentBatchType,"-responsible-select"),query:{fromPage:e}}):D.model.selectes.checkItem.query=d.a.extend(D.model.selectes.checkItem.query,{batchId:S.batchId})):D.model.selectes.checkItem={}}function R(e){var t=e.coordinate?[JSON.parse(e.coordinate)]:[];return D.model.problem={projectId:e.projectId,problemStamp:e.problemStamp,positionId:e.positionId||"",diagramId:e.diagramId,positionName:"",checkItemId:e.checkItemId||"",checkItemName:e.checkItemName||"",topCheckItemId:e.checkItemId||"",checkItemGuide:!1,descIds:e.descIds||"",descNames:e.descNames||"",remark:e.remark||"",imageList:e.imageList||[],emergencyDegree:"一般",coordinates:t,contractors:"",contractorIds:"",responsibilityUnitIds:"",responsibilityUnits:"",isPassedWhenAdd:!1,isRemarkRequired:"",feedbackId:e.feedbackId,batchRoomId:e.batch_room_id},"roomDesignChange"!==e.problemType&&"feedbackRemainReply"!==e.problemType||(S={batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id}),D.model.positionId=null,D.setProblem(),i["a"].resolve()}function B(e){return b["a"].getProblem(e.problemId).then((function(t){var n=i["a"].when();return S&&!d.a.isEmpty(S)||(S={fromType:e.type,batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id,isSpecial:e.isSpecial,fitmentStandard:e.fitment_standard,batchId:t.batch_id}),n.then((function(){return t.problem_reason_ids=[],l["a"].state.app.global.enableProblemReason?v["a"].getProblemReason(e.problemId).then((function(e){return t.problem_reason_ids=e,i["a"].resolve(t)})):i["a"].resolve(t)}))})).then((function(t){D.model.problem={id:t.id,projectId:t.proj_id,positionId:t.position_id||"",positionName:t.position_name||"",diagramId:t.roomtype_diagram_id,checkItemId:t.item_id||"",checkItemName:t.item_name||"",topCheckItemId:t.top_item_id||"",checkItemGuide:!1,descIds:t.desc_id||"",descNames:t.desc||"",remark:t.remark,imageList:[],emergencyDegree:t.emergency_degree,coordinates:t.coordinates,contractors:t.contractor_name,contractorIds:t.contractor_id,responsibilityUnitIds:t.responsible_company_id,responsibilityUnits:t.responsible_company_name,isPassedWhenAdd:t.is_passed_when_add||!1,isRemarkRequired:t.isRemarkRequired,reasonIds:t.problem_reason_ids,batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id},t.problem_images.forEach((function(e){var t=c["a"].getImageRealPath(e.img_localpath);D.model.problem.imageList.push({localPath:e.img_localpath,fullPath:t,viewPath:c["a"].getImageWebViewPath(t)})})),console.log("==== _self.model.problem  ====",D.model.problem),L=t.remark,x=t.is_passed_when_add,D.model.positionId=t.position_id}))}var D={initUpdate:!0,model:{isLoaded:!1,positionId:"",problem:{imageList:[]},ProblemReasons:[],remarkChangeStatus:1},setProblem:function(e){var t={};D.model.positionDisabled=!1,D.model.checkItemDisabled=!1,D.model.descDisabled=!1,D.model.contractorDisabled=!1,"roomDesignChange"===D.model.problemType?(!d.a.isEmpty(e)&&(t={checkItemId:e.itemId,topCheckItemId:e.itemId,checkItemName:e.itemName,descIds:e.descId,descNames:e.descName,emergencyDegree:e.emergency_degree,remark:e.remark}),D.model.checkItemDisabled=!0,D.model.descDisabled=!0):"feedbackRemainReply"===D.model.problemType?(D.model.positionDisabled=!0,D.model.checkItemDisabled=!0):"fitmentStyle"===D.model.problemType?(!d.a.isEmpty(e)&&(t={checkItemId:e.checkItemId,topCheckItemId:e.checkItemId,checkItemName:e.checkItemName,emergencyDegree:"前置配置"===e.configType?"紧急":"一般",positionId:e.positionId||""}),D.model.positionDisabled=!0,D.model.checkItemDisabled=!0):"checkList"===D.model.problemType&&(!d.a.isEmpty(e)&&(D.model.problem=d.a.extend(D.model.problem||{},e)),j(),O(),D.initUpdate=!1),D.model.problem=d.a.extend(D.model.problem||{},t)},showGuide:function(){return D.model.problem.checkItemId?I["a"].getCheckItemGuideByItemId(D.model.problem.checkItemId).then((function(e){D.model.guideText=e,D.model.showGuide=!!e})):(D.model.guideText="",D.model.showGuide=!1,i["a"].resolve())},init:function(e){D.model.isLoaded=!1,D.model.title=e.problemId?"编辑问题":"feedbackRemainReply"!==e.problemType?"登记问题":e.title,D.model.problemType=e.problemType||"default";var t,n=l["a"].state.app.global.currentBatchType||"simulate";return D.model.enablePassWhenAdd=1==y["a"].getLocalBusinessToggle().enable_pass_when_add&&(m["default"].prototype.$checkRight("reinspect_problem",n)||m["default"].prototype.$checkRight("pass_problem",n)),D.model.ProblemReasons=[],console.log("=====",D.model),t=e.problemId?B(e):R(e),t.then((function(){return D.showGuide().then((function(){if(D.model.problem.positionId)return _["a"].getPositionNameById(D.model.problem.positionId).then((function(e){D.model.problem.positionName=e}))})).then((function(){D.initUpdate&&j()})).then((function(){if(l["a"].state.app.global.enableProblemReason)return v["a"].getReasonConfig().then((function(t){console.log("=== reasons ===",t),e.problemId&&t.forEach((function(e){m["default"].prototype.$set(e,"selected",D.model.problem.reasonIds.indexOf(e.id)>-1)})),D.model.ProblemReasons=t}))})).then((function(){D.model.isLoaded=!0})).catch((function(e){console.error(e),m["default"].prototype.$toast("获取相关数据失败，请返回或稍后重试")}))}))},updateProblem:function(e,t){return t=t||!1,D.model.problem=Object.assign({},D.model.problem,e),D.showGuide().then((function(){return j(),e.remark&&D.model.remarkChangeStatus++,T("updateProblem - 更新问题的字段：","updateProblem=".concat(t),e),t?O():i["a"].resolve()}))},takePhoto:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=c["a"].getNewProblemImagePath({folder:S.batchUnitId+"/"+S.batchRoomId,imageId:Object(a["j"])()});return console.log("take photo",t),r["a"].takePhoto(t.full_path,C({withGraffiti:!0,text:b["a"].getWatermarkText()},e)).then((function(){D.model.problem.imageList.push({localPath:t.save_path,fullPath:t.full_path,viewPath:t.view_path?t.view_path:c["a"].getImageWebViewPath(t.full_path)})}))},addProblem:function(e){e=e||"";var t=[];d.a.each(D.model.problem.imageList,(function(e){t.push({img_localpath:e.localPath})}));var n={problem_images:t,batch_room_id:S.batchRoomId||D.model.problem.batchRoomId,position_id:D.model.problem.positionId,item_id:D.model.problem.checkItemId,top_item_id:S.isSpecial?"":D.model.problem.topCheckItemId,desc_id:D.model.problem.descIds,contractor_id:D.model.problem.contractorIds,responsible_company_id:D.model.problem.responsibilityUnitIds,roomtype_diagram_id:D.model.problem.diagramId,coordinate:D.model.problem.coordinates,emergency_degree:D.model.problem.emergencyDegree,remark:D.model.problem.remark,is_passed_when_add:D.model.problem.isPassedWhenAdd?1:0,problemType:D.model.problemType,feedbackId:D.model.problem.feedbackId},o=[];return D.model.ProblemReasons.forEach((function(e){e.selected&&o.push(e.id)})),b["a"].batchAddProblem(n,S.isSpecial,e,o).then((function(){return w["a"].updateCheckItemUseTimes(D.model.problem.checkItemId).catch((function(e){window.$log("添加问题 updateCheckItemUseTimes catch & 参数",{error:e,curr_param:{checkItemId:D.model.problem.checkItemId}}),console.log("添加问题 updateCheckItemUseTimes catch & 参数",{error:e,curr_param:{checkItemId:D.model.problem.checkItemId}})}))})).then((function(){return w["a"].updateItemDescUseTimes(D.model.problem.descIds).catch((function(e){window.$log("添加问题 updateItemDescUseTimes catch & 参数",{error:e,curr_param:{descIds:D.model.problem.descIds}}),console.log("添加问题 updateItemDescUseTimes catch & 参数",{error:e,curr_param:{descIds:D.model.problem.descIds}})}))})).then((function(){return p["a"].init().catch((function(e){window.$log("添加问题 刷新房间问题model catch",e),console.error("添加问题 刷新房间问题model catch",e)})),S.mode})).catch((function(e){window.$log("添加问题 刷新房间问题model这一步的外部 catch",e),console.error("添加问题 刷新房间问题model这一步的外部 catch",e)})).finally((function(){console.log("添加问题 finally88"),D.model.problem.remark&&D.model.problem.descIds.indexOf(";")<0&&u["a"].upsertHistory(D.model.problem.checkItemId,D.model.problem.descIds,D.model.problem.remark).catch((function(e){window.$log("添加问题 finally catch",e),console.log("添加问题 finally catch",e)}))}))},editProblem:function(){var e=[],t=[];return d.a.each(D.model.problem.imageList,(function(e){t.push({img_localpath:e.localPath})})),D.model.ProblemReasons.forEach((function(t){t.selected&&e.push(t.id)})),b["a"].processEditProblem({id:D.model.problem.id,problem_images:t,batch_room_id:S.batchRoomId,position_id:D.model.problem.positionId,item_id:D.model.problem.checkItemId,top_item_id:S.isSpecial?"":D.model.problem.topCheckItemId,desc_id:D.model.problem.descIds,contractor_id:D.model.problem.contractorIds,responsible_company_id:D.model.problem.responsibilityUnitIds,emergency_degree:D.model.problem.emergencyDegree,remark:D.model.problem.remark,roomtype_diagram_id:D.model.problem.diagramId,coordinate:D.model.problem.coordinates,is_passed_when_add:D.model.problem.isPassedWhenAdd?1:0,is_passed_when_add_old:x},S.isSpecial,e).then((function(){f["a"].updateProblem(D.model.problem.id),p["a"].init()})).catch((function(e){return i["a"].reject(e)})).finally((function(){D.model.problem.remark&&D.model.problem.descIds.indexOf(";")<0&&L!=D.model.problem.remark&&u["a"].upsertHistory(D.model.problem.checkItemId,D.model.problem.descIds,D.model.problem.remark)}))}};t["a"]=D},db99:function(e,t,n){"use strict";n("6d57"),n("e697");var o=n("fd50"),i=(n("cc57"),n("9a33"),n("a324")),r=n("760e"),a=function(){var e=20,t={},n={},a={};return t={batch_unit_id:"cp.batch_unit_id",status:"cp.status",floor:"br.floor",item:"ci.id",user:"u.id"},n.formatData=function(e,t){var n=[],o=[];return _.each(e,(function(e){var i={};e.desc_id=e.desc_id.split(";"),_.each(e.desc_id,(function(e){n.indexOf(e)<0&&n.push(e)})),-1==e.floor.indexOf("层")&&-1==e.floor.indexOf("楼")&&-1==e.floor.indexOf("公共区域")&&(e.floor=e.floor+"楼"),i.id=e.id,i.code=e.code,i.batchRoomId=e.batch_room_id,i.batchUnitId=e.batch_unit_id,i.registerUserName=e.regist_user_name,i.roomtypeDiagramId=e.roomtype_diagram_id,i.status=e.status,i.roomName=t+"-"+e.floor+"-"+e.room_no,i.dealTime=e.deal_time&&"00-00-00 00:00:00"!==e.deal_time?e.deal_time:"",i.emergence=e.emergency_degree&&e.emergency_degree.indexOf("急")>-1?e.emergency_degree:"",i.sendBackTimes=e.sent_back_time||0,i.positionName=e.position,i.itemName=e.item,i.contractor=e.contractor||"",i.desc=e.desc_id,o.push(i)})),r["a"].getDescByIds(n).then((function(e){return _.each(o,(function(t){_.each(t.desc,(function(n,o){var i=_.find(e,{id:n});t.desc[o]=i?i.name:"无描述"})),t.desc=t.desc.join("、")})),o}))},n.getFilter=function(e,t){var n={status:i["a"].getCountOfProblemStatus,floor:i["a"].getCountOfFloor,item:i["a"].getCountOfCheckItem,user:i["a"].getCountOfRegister};return n[e](t)},a.createCondition=function(e,n){if(_.isEmpty(e))return"";"batch_unit_id"==n&&(n="");var o=[];return _.each(e,(function(e,i){t[i]&&i!==n&&o.push(t[i]+'="'+e+'"')})),o.join(" and ")},a.initFilter=function(){var e=[{type:"status",title:"问题状态",name:"",value:"",options:[]},{type:"floor",title:"楼层",name:"",value:"",options:[]},{type:"item",title:"检查项",name:"",value:"",options:[]},{type:"user",title:"登记人",name:"",value:"",options:[]}];return e},a.getProblems=function(t,r,c){var s=a.createCondition(r);return i["a"].getAllProblemListByPage(s,t,e).then((function(e){return!e||_.isEmpty(e)?[]:n.formatData(e,c)})).catch((function(e){return o["a"].reject(e)}))},a.getFilterCount=function(e){e=e||{};var i,r="",c={},s=[];return _.each(t,(function(t,o){"batch_unit_id"!==o&&(r=a.createCondition(e,o),i=n.getFilter(o,r).then((function(e){return{type:o,res:e}})),s.push(i))})),o["a"].all(s).then((function(e){return _.each(e,(function(e){if(e){var t=[],n=0;_.each(e.res,(function(e){t.push({count:e.count,name:e.name||e.title,value:e.value}),n+=e.count})),t.unshift({value:"",name:"全部",count:n}),c[e.type]=t}})),c}))},a.getSelectedProblems=function(e){var t=a.createCondition(e);return i["a"].getSelectedProblems(t)},a.passProblems=function(e){var t=[];return e.forEach((function(e){t.push(i["a"].passProblem(e.id,e.batchRoomId))})),o["a"].all(t)},a.getListInfoById=function(e,t){return i["a"].getListInfoById(e).then((function(e){return n.formatData([e],t).then((function(e){return e.shift()}))})).catch((function(e){return o["a"].reject(e)}))},a},c=a(),s=n("9072"),d=n("a14a"),l=n.n(d),m=function(){var e={},t=20,n={};function i(){l.a.isEmpty(e.filter)&&(e.filter=c.initFilter());var n=r(),o=[],i="";return c.getFilterCount(n).then((function(n){l.a.each(e.filter,(function(t,r){if(i=e.filter[r].value||"",t&&n[t.type]){var a=l.a.find(n[t.type],{value:i});a&&o.push(a.count),e.filter[r].options=n[t.type]}}));var r=Math.min.apply(null,o);e.totalPage=Math.ceil(r/t)}))}function r(){var t={batch_unit_id:e.batchUnitId};return l.a.each(e.filter,(function(e){e.value&&(t[e.type]=e.value)})),t}function a(){var t=o["a"].defer();if(e.isAllSelected){var n=r();c.getSelectedProblems(n).then((function(e){t.resolve(e)})).catch((function(e){t.reject(e)}))}else t.reject();return t.promise}function d(t){e.isAllSelected?e.problemList=[]:l.a.each(t,(function(t){var n=l.a.find(e.problemList,{id:t.id});if(n){var o=-1;e.problemList&&(o=e.problemList.indexOf(n)),o>-1&&e.problemList.splice(o,1)}}))}return e.filter=c.initFilter(),e.currPage=0,e.totalPage=0,e.problemList=[],e.isAllSelected=!1,n={model:e,init:function(t,i){var r=o["a"].when();return e.currPage=0,e.problemList=[],e.batchUnitId=t,e.unitName=i,e.currConditon={},1==window.isNeedClearAllData&&(e.filter=c.initFilter(),window.isNeedClearAllData=!1),null==window.take_photo_when_review&&r.then((function(){return s["a"].getReviewPhotoSetting()})),r.then((function(){return n.load(0)}))},load:function(t){if(t&&t==e.currPage)return o["a"].resolve();var n=r();return i(),c.getProblems(t,n,e.unitName).then((function(t){return e.isAllSelected&&t.forEach((function(e){e.checked=!0})),o["a"].resolve(t)})).then((function(n){return e.problemList=t?e.problemList.concat(n):n,e.currPage=t,o["a"].resolve(!0)}))},passProblems:function(e){var t=o["a"].defer(),n=function(e){c.passProblems(e).then((function(){d(e),t.resolve()})).catch((function(e){t.reject(e)}))};return e?n(e):a().then(n),t.promise},updateProblem:function(t){var n=l.a.find(e.problemList,{id:t});return n?c.getListInfoById(t,e.unitName).then((function(t){if(!l.a.isEmpty(t)){if(""!=e.filter[0].value&&n.status!=t.status){var o=e.problemList.indexOf(n);o>-1&&e.problemList.splice(o,1)}else n=l.a.extend(n,t);i(),$rootScope.$$phase||$rootScope.$digest()}})):o["a"].resolve()}}};t["a"]=m()},e810:function(e,t,n){"use strict";var o=n("cb6b"),i="CHECKITEM_SEARCH_HISTORY",r={};function a(){o["a"].set(i,JSON.stringify(r.list))}o["a"].preserve(i),r.list=function(){var e=o["a"].getString(i);return e?JSON.parse(e):[]}(),r.add=function(e){var t=r.list.indexOf(e);return-1!==t&&r.list.splice(t,1),r.list.unshift(e),r.list.splice(8),a(),r},r.remove=function(e){var t=r.list.indexOf(e);-1!==t&&(r.list.splice(t,1),a())},r.clear=function(){r.list.splice(0),a()},t["a"]=r},fa1b:function(e,t,n){"use strict";var o=n("1834");t["a"]={getCheckItemList:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=[e],a="select bc.item_id, ci.full_name as item_full_name  from batch_checkitem bc  inner join check_item ci on ci.id = bc.item_id  where bc.batch_id = ? ";if(a+=t?" and ci.is_for_rough = 1 ":" and ci.is_for_decorated = 1 ",n){var c=i?"project_position_checkitem":"position_checkitem";a+=" and bc.item_id in                     (select item_id from "+c+" where position_id = ? )",r.push(n)}return a+=" order by ci.sort ",o["a"].query(a,r)}}}}]);