(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-664493d0"],{"0495":function(e,t,a){t=e.exports=a("690e")(!1),t.push([e.i,"\n.zhkf .avatar[data-v-275dc895] {\n  display: inline-block;\n  background-size: cover;\n  width: 40px;\n  height: 40px;\n  line-height: 50px;\n  vertical-align: middle;\n  border-radius: 50%;\n}\n.zhkf .van-cell[data-v-275dc895] {\n  height: 50px;\n  padding: 0 15px;\n  line-height: 50px;\n}\n.zhkf .van-cell__right-icon[data-v-275dc895] {\n  height: 50px !important;\n  line-height: 50px;\n}\n",""])},"2d80c":function(e,t,a){e.exports=a.p+"img/avatar-big.761374b9.png"},"4b46":function(e,t,a){"use strict";a.r(t);a("cc57"),a("f548");var r,n=a("a740"),i=a("fe6f"),u=a("8ae6"),s=a("c42d"),o=a("c2c1"),c=a("0938"),l=a("81ad"),d=a("c24f"),h=a("fd50"),_=a("1834"),g=a("a14a"),f=a.n(g),v={getUserInfo:function(e){var t="select id, user_id, name, ifnull(avatar_local_path,'') as avatar, ifnull(avatar_url, '') as avatar_url from chat_user where id in("+e+")";return _["a"].query(t)},getGroupInfo:function(e){f.a.isArray(e)&&(e='"'.concat(e.join('","'),'"'));var t='select g.id, g.name, ifnull(v.img_local_path, "") as avatar, ifnull(v.img_url, "") as avatar_url from chat_group g  left join default_avatar v on g.avatar_id = v.id '+" where g.id in(".concat(e,")");return _["a"].query(t)},getUserCompanyByTargetIds:function(e){var t="select distinct cu.id, uc.user_id, uc.company_id, c.short_name, c.full_name from user_company as uc inner join company as c on uc.company_id = c.id  inner join chat_user cu on uc.user_id = cu.user_id where cu.id in("+e+")";return _["a"].query(t)},getUserCompanyByUserIds:function(e){var t="select uc.user_id, uc.company_id, c.short_name, c.full_name from user_company as uc inner join company as c on uc.company_id = c.id where uc.user_id in("+e+")";return _["a"].query(t)},getGroupUserInfo:function(e){var t="select distinct u.id,u.user_id, u.name, ifnull(u.avatar_local_path,'') as avatar, ifnull(u.avatar_url, '') as avatar_url, case when exists(select id from chat_group where id=? and manager_id=u.user_id) then 1 else 0 end as  is_manager  from chat_user u inner join chat_group_user gu on u.user_id = gu.user_id  where gu.group_id = ? order by is_manager desc";return _["a"].query(t,[e,e])},getUserDetail:function(e){var t="select id,user_id, name, ifnull(avatar_local_path,'') as avatar, ifnull(avatar_url,'') as avatar_url, mobile from chat_user where id = ? ";return _["a"].queryOne(t,[e])},batchInsertChat:function(e){return e&&e.length?_["a"].transaction((function(t){var a=["id","name","chat_type","relation_id","last_message","refresh_time","delete_time","is_top","not_read_count","is_silent"],r=["last_message","refresh_time","delete_time","is_top","not_read_count","is_silent"];return f.a.each(e,(function(e){var n=_["a"].getColumnsValues(e,a,r);t.delete("chat",{id:e.id}),t.insert("chat",a,n)})),h["a"].resolve()})):h["a"].resolve()},getConversationList:function(){var e="select id as targetId, name, chat_type as conversationType, last_message as message, refresh_time, not_read_count as unreadMessageCount, is_top as isTop, is_silent from chat where delete_time = ''";return _["a"].query(e)},getConversationByIdStr:function(e){var t="select id as targetId, is_silent, is_top from chat where id in(?)";return _["a"].query(t,[e])},getDeleteConversationList:function(){var e="select id, delete_time from chat where delete_time <> ''";return _["a"].query(e)},updateChatIsTop:function(e,t){return _["a"].update("chat",{is_top:t},{id:e})},updateChatIsSilent:function(e,t){return _["a"].update("chat",{is_silent:t},{id:e})},updateChatDeleteTime:function(e,t){return _["a"].update("chat",{delete_time:t},{id:e})},updateUserAvatar:function(e,t,a){return _["a"].update("chat_user",{avatar_url:t,avatar_local_path:a},{user_id:e})},isTargetExists:function(e){var t="select u.id from chat_user as u where u.id = ? union select g.id from chat_group as g where g.id = ?";return _["a"].queryOne(t,[e,e])}},m=function(){var e={getImagePath:function(t,a,r){if(!f.a.isEmpty(a)){if("dev"===APP_ENV)return a;if(!f.a.isEmpty(t))return Object(u["e"])()+t}return e.getDefaultAvatar(r)},getDefaultAvatar:function(e){var t=c["a"].randomNum(1,5);return"plugin"===e?"https://static.myfuwu.com.cn/static/checkroom/avatar/user-"+t+".png":"./img/avatar/av_0"+t+".png"}};return e}(),p=function(){var e={getUserBaseInfo:function(e){return v.getUserInfo("'"+e+"'").then((function(e){return f.a.each(e,(function(e){e.avatar=m.getImagePath(e.avatar,e.avatar_url)})),e}))},getUserDetail:function(e){return h["a"].all([v.getUserDetail(e),v.getUserCompanyByTargetIds("'"+e+"'")]).then((function(e){if(e){var t=e[0],a=e[1];return t?(t.company=[],t.avatar=m.getImagePath(t.avatar,t.avatar_url),f.a.each(a,(function(e){t.company.push(e.full_name)})),t):{}}return{}}))},updateUserAvatar:function(e,t,a){return v.updateUserAvatar(e,t,a)}};return e}(),b=a("8c4b"),w=a("2d80c"),y={data:function(){return{inSdk:Object(n["f"])(),show:!1,actions:[{name:"拍照"},{name:"从手机相册选择"}],user:{userName:"",userImg:"",userMobile:"",userCode:""},defaultImg:"this.style['background-image']='url(".concat(b,")'"),COUNT:0}},activated:function(){var e=this;r=Object(n["j"])(),console.log("用户信息",r);var t=r.user_headimg_localurl,a=r.user_name,o=r.user_mobile,c=r.user_code,l=Object(i["c"])()||t.indexOf("file:")>-1?t:Object(u["f"])(t);this.user={userName:a,userCode:c,userImg:t?l:b,userMobile:o},s["a"].getHasNetwork().then((function(t){t&&(console.log(r.user_headimg_url),e.user.userImg=r.user_headimg_url||b,console.log(e.user))}))},methods:{showAvatar:function(){var e=Object(i["c"])()?"".concat(Object(u["f"])(""),"www/").concat(w):"".concat(Object(u["b"])()).concat(w),t=this.user.userImg;t=Object(n["j"])().user_headimg_localurl?t:e,t=t.replace(/\?.*/,""),console.log("大图地址---",t),o["a"].openImageBrowser([t],0)},changeAvatar:function(){var e=this;s["a"].getHasNetwork().then((function(t){t?e.show=!0:e.$toast("当前网络异常，请稍后重试")}))},onSelect:function(e){var t=this;this.show=!1,r.avatar_id=Object(c["j"])();var a,i=Object(u["h"])(r);o["a"].takePhoto(i.full_path,{ratio:80,reqWidth:200,reqHeight:200,fromAlbum:"拍照"===e.name?0:1,text:"",isCrop:!0}).then((function(){return t.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"正在上传头像..."}),l["a"].uploadAvatar(r.avatar_id,i.full_path)})).then((function(e){return a=e,Object(d["d"])(e).catch((function(e){console.log("保存头像到后台",e)}))})).then((function(){return{original:a,localPath:i.full_path+"?"+(new Date).getTime(),savePath:i.savePath+"?"+(new Date).getTime()}})).then((function(e){return p.updateUserAvatar(r.user_id,e.original,e.savePath).then((function(){return e}))})).then((function(e){e&&(Object(n["n"])({user_headimg_url:e.original,user_headimg_old_url:e.original,user_headimg_localurl:e.localPath}),t.user.userImg=e.original,console.log(t.user.userImg),t.$toast("保存成功",1e3))})).catch((function(e){console.error("更改用户头像error",e),t.$toast.clear()}))},onCancel:function(){this.show=!1},handleDebug:function(){var e=this;if(window.MDebugging){if(this.COUNT++,clearTimeout(this.timer),5===this.COUNT&&MDebugging.hide(),this.COUNT>9)return MDebugging.show(),void(this.COUNT=0);this.timer=setTimeout((function(){e.COUNT=0}),500)}}}},k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user-info"},[a("cus-nav-bar",{attrs:{"left-arrow":"",border:!1},on:{"click-left":function(t){return e.$router.go(-1)}}},[a("div",{attrs:{slot:"title"},on:{click:e.handleDebug},slot:"title"},[a("span",[e._v("个人信息")])])]),e._v(" "),a("van-cell-group",[a("van-cell",{attrs:{title:"个人头像","is-link":""},on:{click:e.changeAvatar}},[[a("p",{staticClass:"avatar",style:{"background-image":"url("+e.user.userImg+")"},attrs:{onerror:e.defaultImg,alt:"avatar",width:"40",height:"40"},on:{click:function(t){return t.stopPropagation(),e.showAvatar(t)}}})]],2),e._v(" "),a("van-cell",{attrs:{title:"姓名",value:e.user.userName}}),e._v(" "),a("van-cell",{attrs:{title:"账号",value:e.user.userCode}}),e._v(" "),e.inSdk?e._e():a("van-cell",{attrs:{to:"/user/modify-password",title:"修改密码","is-link":""}}),e._v(" "),a("van-cell",{attrs:{title:"手机号码",value:e.user.userMobile,"is-link":"",to:"/user/edit-phone"}})],1),e._v(" "),a("van-action-sheet",{attrs:{actions:e.actions,"cancel-text":"取消"},on:{select:e.onSelect,cancel:e.onCancel},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}})],1)},C=[],I=a("d082");function j(e){a("bb53")}var O=!1,U=j,x="data-v-275dc895",T=null,A=Object(I["a"])(y,k,C,O,U,x,T);t["default"]=A.exports},"8c4b":function(e,t,a){e.exports=a.p+"img/avatar.c89b5150.png"},bb53:function(e,t,a){var r=a("0495");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=a("85cb").default;n("ee93a346",r,!0,{})}}]);