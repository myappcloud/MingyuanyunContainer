(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-7c4d35e2"],{"0970":function(e,t,o){"use strict";o("6d57"),o("cc57");var n=o("1834"),i=function(){var e="select ci.id,ci.name,ci.parent_id,ci.sort,ci.ifEnd,cig.remark from check_item ci left join check_item_guide cig on ci.id=cig.item_id";return n["a"].query(e)},r=function(e){var t="select remark from check_item_guide where item_id = ?",o=[e];return n["a"].queryOne(t,o).then((function(e){return e&&e.remark}))},a=function(e){var t="select item.full_name,guide.remark as guide           from check_item_guide guide               inner join check_item item on guide.item_id=item.id           where guide.item_id=?";return n["a"].queryOne(t,[e])},c=function(){var e="select item.id,item.name,item.parent_id,guide.id is not null as has_guide       from check_item item           left join check_item_guide guide on item.id=guide.item_id              and ifnull(guide.remark,'') <> ''       order by sort";return n["a"].query(e)},s={getCheckItemWithGuide:i,getGuideByCheckItemId:r,getCheckItemList:c,getGuideAndItemByItemId:a},d=o("a14a"),l=o.n(d),m=function(){var e={};return{getItem:function(t,o){if(void 0===t||null===t)throw new TypeError("key参数为空");return o?e[t]:l.a.cloneDeep(e[t])},setItem:function(t,o){if(void 0===t||null===t)throw new TypeError("key参数为空");if(arguments.length<2)throw new TypeError("value参数未设置");e[t]=o},clear:function(){e={}}}},u=m(),p={IS_NEED_DOWNLOAD_BASE_DATA:"is_need_download_base_data",LAST_EXEC_TIME_DATA:"last_exec_time_data",LAST_GUIDE_SORT_MAP:"last_guide_sort_map"},h=function(){var e=function e(t,o){t.remark&&""!=t.remark&&(t.has_guide=!0),t.children=[];for(var n=0;n<o.length;n++)o[n].parent_id==t.id&&t.children.push(o[n]);if(t.children&&t.children.length>0)for(var i=0;i<t.children.length;i++)t.children[i]=e(t.children[i],o);return t};return{getCheckItemGuideByItemId:function(e){return s.getGuideByCheckItemId(e)},getCheckItemTree:function(){var t={id:""};return s.getCheckItemWithGuide().then((function(o){t=e(t,o);for(var n=0;n<t.children.length;n++)if("所有检查项"==t.children[n].name)return t.children[n].children;return t.children}))},getCheckItemTreeAndGuideSortMap:function(){return console.time("getData"),s.getCheckItemList().then((function(e){console.timeEnd("getData"),console.time("processData");var t={},o=[],n=0,i=[];function r(e,t){e.forEach((function(e){e.depth=t,e.tree?r(e.tree,t+1):e.has_guide&&(e.guide_sort=n,o[n]=e.id,n++)}))}return e.forEach((function(e){t[e.id]=e})),e.forEach((function(e){e.parent_id&&t[e.parent_id]?(t[e.parent_id].tree=t[e.parent_id].tree||[],t[e.parent_id].tree.push(e)):i.push(e)})),r(i,1),u.setItem(p.LAST_GUIDE_SORT_MAP,o),console.timeEnd("processData"),{tree:i,guideSortMap:o}}))},getGuideSortMapFromCatch:function(){return u.getItem(p.LAST_GUIDE_SORT_MAP,!0)},getGuideAndItemByItemId:s.getGuideAndItemByItemId}};t["a"]=h()},"09ed":function(e,t,o){"use strict";o.r(t);o("5ab2"),o("6d57"),o("e44b"),o("e10e"),o("cc57");var n=o("28f8"),i=o("3d3a"),r=o("3fa2"),a=o("db5f"),c=o("273c"),s=o("9229"),d=o("a14a"),l=o.n(d),m=o("f2de");function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){Object(n["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var h=i["a"].model,f={name:"CheckListDetail",data:function(){return{model:{positionName:"",checkItem:{},descList:[]},deliveredForbidRegistProblem:!1}},computed:p(p({},Object(m["e"])({currentBatchType:function(e){return e.app.global.currentBatchType}})),{},{addProblemBtnDisabled:function(){if("delivery"===this.currentBatchType||"online_delivery"===this.currentBatchType){if(r["a"].room.hasDeliveryInfo&&this.deliveredForbidRegistProblem)return!0;if(r["a"].room.isReviewed)return!0}return!1}}),created:function(){var e=this;this.initData(),s["a"].getDeliveredForbidRegistProblem().then((function(t){e.deliveredForbidRegistProblem=t}))},methods:{initData:function(){var e=this;return this.model=l.a.assign(this.model,i["a"].getCurrentItemPosition()),this.model.positionName=h.currentPosition.position_name,this.model.checkItem=h.currentItem,i["a"].getItemDesc(h.currentItem.item_id).then((function(t){l.a.each(t,(function(e){e.selected=!1})),e.model.descList=t}))},openGuide:function(){this.$dialog.alert({title:this.model.checkItem.item_name||"检查项指引",message:"<pre>".concat(this.model.checkItem.remark,"</pre>"),confirmButtonText:"知道了",closeOnClickOverlay:!0}).then((function(){}))},getPrev:function(){var e=this;return i["a"].getPreviousItem().then((function(t){return h.currentItem=t,e.initData()})).then((function(e){i["a"].setPositionItemDone()})).catch((function(e){return console.log(e)}))},getNext:function(){var e=this;return i["a"].getNextItem().then((function(t){return h.currentItem=t,e.initData()})).then((function(e){i["a"].setPositionItemDone()}))},selectDesc:function(e){this.addProblemBtnDisabled||(e.selected=!e.selected)},addProblem:function(){if(this.addProblemBtnDisabled)return r["a"].room.hasDeliveryInfo&&this.deliveredForbidRegistProblem?void this.$toast("系统已设置收楼后不能登记新问题"):void this.$toast("房间已复查通过，不允许登记问题！");var e=[],t=[],o=0;if(l.a.each(this.model.descList,(function(n){n.selected&&(e.push(n.id),t.push(n.name),n.selected=!1,n.is_remark_required&&(o=1))})),e=e.join(";"),t=t.join("；"),e){h.currentSelected={positionId:h.currentPosition.position_id,positionName:h.currentPosition.position_name,checkItemId:this.model.checkItem.item_id,checkItemName:this.model.checkItem.item_name,descIds:e,descNames:t,isRemarkRequired:o};var n={problemType:"checkList"};r["a"].room.hasDiagramImage?(a["a"].model.positionId=h.currentPosition.position_id,c["a"].goMarkPosition(n)):c["a"].goAddProblem(n)}else this.$toast("请选择问题描述")}}},b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"check-list-detail"},[n("cus-nav-bar",{attrs:{title:e.model.positionName,"left-arrow":""}}),e._v(" "),n("div",{staticClass:"content-header"},[n("div",{staticClass:"header-left"},[e._v(e._s(e.model.checkItem.full_name))]),e._v(" "),e.model.checkItem.remark?n("div",{staticClass:"header-right",on:{click:e.openGuide}},[e._v("检查指引")]):e._e()]),e._v(" "),n("section",{staticClass:"detail-content"},[e.model.descList.length?n("van-cell-group",e._l(e.model.descList,(function(t,i){return n("van-cell",{key:i,on:{click:function(o){return e.selectDesc(t)}}},[n("template",{slot:"title"},[t.isImportant?n("van-tag",{attrs:{color:"#FF8100"}},[e._v("重点")]):e._e(),e._v(" "),n("span",{staticClass:"custom-text"},[e._v(e._s(t.name))])],1),e._v(" "),n("template",{slot:"right-icon"},[e.addProblemBtnDisabled?n("img",{attrs:{src:o("78a7"),alt:"disabled",width:"20",height:"20"}}):t.selected?n("img",{attrs:{src:o("2985"),alt:"selected",width:"20",height:"20"}}):n("img",{attrs:{src:o("f97d"),alt:"select",width:"20",height:"20"}})])],2)})),1):e._e()],1),e._v(" "),n("div",{staticClass:"btns van-hairline--top"},[e.model.hasPrev?n("div",{staticClass:"btn prev van-hairline--right",on:{click:e.getPrev}},[e._v("上一项")]):e._e(),e._v(" "),e.model.hasNext?n("div",{staticClass:"btn next",on:{click:e.getNext}},[e._v("下一项")]):e._e(),e._v(" "),e.$checkRight("add_problem",e.currentBatchType)?n("div",{staticClass:"btn register",class:{disabled:e.addProblemBtnDisabled},on:{click:e.addProblem}},[e._v("登记问题")]):e._e()])],1)},g=[],_=o("d082");function I(e){o("6324")}var y=!1,k=I,v="data-v-87292cd8",P=null,w=Object(_["a"])(f,b,g,y,k,v,P);t["default"]=w.exports},"0a1d":function(e,t,o){"use strict";o("6d57");var n=o("16ca"),i=o("fd50"),r=o("c6e3"),a=o("a324"),c=o("0523"),s=function(){var e=function(e,t){for(var o=0;o<e.length;o++){var n=e[o],i=!1,r=0,a=!0;if("已交付"!=n.delivery_status){for(var c=0;c<t.length;c++){var s=t[c];s.batch_room_id.toLowerCase()==n.id.toLowerCase()&&(i=!0,["待派单","待指派","待整改"].indexOf(s.status)>-1&&(n.room_status="待整改",a=!1),"已整改"===s.status&&(a=!1,r=1),"已通过"!==s.status&&(a=!1))}a||n.room_status?"待整改"===n.room_status&&(n.has_repaired=r):n.room_status="已整改","交付中"!=n.delivery_status||"暂不收楼"===n.delivery_situation||i&&!a?("待交付"!=n.delivery_status||i&&!a)&&("交付中"!=n.delivery_status||"暂不收楼"!=n.delivery_situation||i&&!a)||(n.room_status="待交付"):n.room_status="已交付"}else n.room_status="已交付"}return e},t=function(t){var o=[r["a"].getUnitFloors(t),r["a"].getUnitRooms(t),a["a"].getProblemListByBatchUnitId(t)];return i["a"].all(o).then((function(o){var n=o[0],i=o[1],r=o[2];return e(i,r),c["a"].buildRoomListData(t,n,i)}))};return{getRoomListByBatchUnit:t}},d=s(),l=function(){var e=function(e,t){for(var o=0;o<e.length;o++){for(var n=e[o],i=!1,r=0,a=!0,c=0;c<t.length;c++){var s=t[c];s.batch_room_id.toLowerCase()==n.id.toLowerCase()&&(i=!0,["待派单","待指派","待整改"].indexOf(s.status)>-1&&(n.room_status="待整改",a=!1),"已整改"===s.status&&(a=!1,r=1),"已通过"!==s.status&&(a=!1))}if(a||n.room_status?"待整改"===n.room_status&&(n.has_repaired=r):n.room_status="已整改",i?a&&("已接待"===n.opening_status?n.room_status="已接待":n.room_status="待接待"):"已接待"===n.opening_status?n.room_status="已接待":n.room_status="待接待",!n.room_status)throw new Error("room_status 赋值为空."+n.id)}return e},t=function(t){var o=[r["a"].getUnitFloors(t),r["a"].getUnitRooms(t),a["a"].getProblemListByBatchUnitId(t)];return i["a"].all(o).then((function(o){var n=o[0],i=o[1],r=o[2];return i=e(i,r),c["a"].buildRoomListData(t,n,i)}))};return{getRoomListByBatchUnit:t}},m=l(),u=function(){var e={simulate:[{name:"全部",key:"all",dot:"",less:0},{name:"待检查",key:"待检查",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已通过",key:"已通过",dot:"green",less:0}],delivery:[{name:"全部",key:"all",dot:"",less:0},{name:"待交付",key:"待交付",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已交付",key:"已交付",dot:"green",less:0}],online_delivery:[{name:"全部",key:"all",dot:"",less:0},{name:"待交付",key:"待交付",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已交付",key:"已交付",dot:"green",less:0}],opening:[{name:"全部",key:"all",dot:"",less:0},{name:"待接待",key:"待接待",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已接待",key:"已接待",dot:"green",less:0}]},t={simulate:n["a"],delivery:d,opening:m,online_delivery:d},o={tabs:[],items:{},lastView:{},status_sel:"全部",status_counter:0,display_rooms:[]};return{model:o,init:function(e,t){return this.model.batchType=e,this.model.unitId=t,this.model.tabs=this.getTabs(e),this.getRoomList(e,t)},updateRoomList:function(){var e=this.model,t=e.batchType,o=e.unitId;this.init(t,o)},getTabs:function(t){return e[t]},tabsInit:function(){var e=this.model.items.unit_list[0].status_counter;this.model.tabs.forEach((function(t){t.less=e[t.key]||0}))},getRoomList:function(e,o){var n=this;return"special_checkitem"===e&&(e="simulate"),t[e]&&t[e].getRoomListByBatchUnit?t[e].getRoomListByBatchUnit(o).then((function(e){n.model.items=e,n.iniRoomData(),n.tabsInit()})):Promise.resolve()},iniRoomData:function(){this.model.items["unit_sel"]=this.model.items.unit_list[0].unit,this.roomStatusClass(),this.model.status_sel=this.model.lastView&&this.model.lastView.status||"全部",this.filterRoomList(),this.model.status_counter=this.model.items.unit_list[0].status_counter},filterRoomList:function(){for(var e=this.model.items.unit_list[0].floor_list,t=[],o=0;o<e.length;o++){for(var n=e[o].room_list,i=[],r=!1,a=0;a<n.length;a++)"全部"!=this.model.status_sel&&n[a].room_status!=this.model.status_sel||(i.push(n[a]),r=!0);r&&t.push({floor:e[o].floor,room_list:i})}this.model.display_rooms=t,console.log(this.model.display_rooms,"------------楼栋数据------------")},roomStatusClass:function(){for(var e=o.items.unit_list,t=0;t<e.length;t++)for(var n=e[t].floor_list,i=0;i<n.length;i++){var r=n[i].room_list;n[i]["floor_show"]=!0;for(var a=0;a<r.length;a++){switch(r[a]["room_show"]=!0,r[a].room_status){case"待检查":r[a]["room_status_class"]="white";break;case"待整改":r[a]["room_status_class"]="red",r[a].has_repaired&&(r[a]["room_status_class"]+=" problem-repaired");break;case"已整改":r[a]["room_status_class"]="blue";break;case"已通过":case"已接待":case"已交付":r[a]["room_status_class"]="green";break;default:r[a]["room_status_class"]="white";break}r[a]["room_info"]=JSON.stringify({building_name:r[a].building_name,unit:r[a].unit,floor:r[a].floor,room_no:r[a].room_no})}}}}};t["a"]=u()},"16ca":function(e,t,o){"use strict";var n=o("fd50"),i=o("c6e3"),r=o("a324"),a=o("0523"),c=o("07a4"),s=o("af4c"),d=function(e,t){for(var o=0;o<t.length;o++){var n=t[o];if(n.batch_room_id.toLowerCase()==e.toLowerCase())return!1}return!0},l=function(e,t){for(var o=0;o<e.length;o++){var n=e[o];if(0!=n.has_problem||0!=n.is_checked)if(d(n.id,t))e[o].room_status="已通过";else{for(var i=!0,r=0,a=0;a<t.length;a++){var c=t[a];if(n.id.toLowerCase()==c.batch_room_id.toLowerCase()){var s=["待派单","待指派","待整改"];s.indexOf(c.status)>-1&&(n.room_status="待整改",i=!1),"已整改"===c.status&&(i=!1,r=1)}}i?n.room_status="已通过":n.room_status?"待整改"===n.room_status&&(n.has_repaired=r):n.room_status="已整改"}else e[o].room_status="待检查"}return e},m=function(e){var t=[i["a"].getUnitFloors(e),i["a"].getUnitRooms(e),r["a"].getProblemListByBatchUnitId(e)];return n["a"].all(t).then((function(t){var o=t[0],n=t[1],i=t[2];return l(n,i),a["a"].buildRoomListData(e,o,n)}))};t["a"]={getRoomListByBatchUnit:m,updateCheckStatus:function(e){return i["a"].getRoomCheckStatus(e).then((function(e){e=e||{};var t=!e["is_checked"]||!e["check_date"]||!e["check_engineer"];return i["a"].updateCheckStatus(e,t)})).then((function(){"todo"===c["a"].state.app.global.currentMenuType&&s["a"].updateRoomList(!0)}))}}},"273c":function(e,t,o){"use strict";o("5ab2"),o("6d57"),o("e44b"),o("e10e");var n=o("28f8"),i=(o("f548"),o("3fa2")),r=o("a18c"),a=o("16ca"),c=o("882e"),s=o("db5f"),d=o("0a1d"),l=o("af4c"),m=o("07a4"),u=o("6013"),p=o("c42d");function h(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function f(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?h(Object(o),!0).forEach((function(t){Object(n["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):h(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var b=i["a"].room,g="[model]/room-operate-model.js：";t["a"]={goCheckPassRoom:function(){return a["a"].updateCheckStatus(b.batchRoomId).then((function(){console.log(g,"goCheckPassRoom() - model:",d["a"].model),"todo"==m["a"].state.app.global.currentMenuType?l["a"].updateRoomList():d["a"].updateRoomList(),r["a"].go(-1)})).catch((function(e){return console.error(g,e)}))},goBatchAddProblem:function(e){console.log(g,"goBatchAddProblem() - data:",e),c["a"].setRoomPosition({unitId:b.batchUnitId,roomId:b.batchRoomId,roomTitle:b.title,position:e.positionList||[],diagramUrl:e.src||""}),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-batch-select-position")})},goMarkPosition:function(e){console.log(g,"goMarkPosition() - data:",e),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-mark-position"),query:{params:JSON.stringify(e)}})},goAddProblem:function(e,t){console.log(g,"goAddProblem() - data:",e),e=e||{};var o={title:b.title,building_id:b.buildingId,batch_unit_id:b.batchUnitId,batch_room_id:b.batchRoomId,positionId:e.positionId||e.id,positionName:e.positionName||"",diagramId:e.diagramId,problemStamp:(new Date).getTime(),layout_img_mode:b.mode,type:b.fromType,fitment_standard:b.fitmentStandard,problemType:e.problemType||"",projectId:b.projectId,checkItemId:e.checkItemId||"",itemName:e.checkItemName||"",descIds:e.descIds||"",descNames:e.descNames||"",isSpecial:b.isSpecial};e.x&&e.y&&(o["coordinate"]=JSON.stringify({x:e.x,y:e.y})),console.log(g,"goAddProblem() - ProblemModel:",o),s["a"].init(o),t?r["a"].replace({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-add-problem"),query:f({},o)}):r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-add-problem"),query:f({},o)})},goEditProblem:function(e){console.log(g,"goEditProblem() - data:",e);var t={title:b.title,batch_room_id:b.batchRoomId,batch_unit_id:b.batchUnitId,problemId:e.id||"",building_id:b.buildingId,diagramId:e.diagramId,problemStamp:(new Date).getTime(),type:b.fromType,fitment_standard:b.fitmentStandard,isSpecial:b.isSpecial};s["a"].init(t),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-edit-problem"),query:f({},t)})},goProblemView:function(e){console.log(g,"goProblemView() - data:",e);var t={title:b.title,batch_room_id:b.batchRoomId,batch_unit_id:b.batchUnitId,question_id:e.id||"",building_id:b.buildingId,type:b.fromType};r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-problem-detail"),query:f({},t)})},goCheckListDesc:function(e){console.log(g,"goCheckListDesc() - data:",e),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-check-list-detail"),query:{data:JSON.stringify(e)}})},goAddDeliveryInfo:function(){console.log(g,"goAddDeliveryInfo()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-config"),query:{fromPage:"problem_list",title:b.title,batchRoomId:b.batchRoomId}})},goRefuseDelivery:function(){console.log(g,"goRefuseDelivery()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-refuse"),query:{batchRoomId:b.batchRoomId}})},goCustomerEvaluationView:function(){console.log(g,"goCustomerEvaluationView()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-customer-tag")})},goDeliveryView:function(){console.log(g,"goDeliveryView()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-view"),query:{fromPage:"problem_list",title:b.title,batchRoomId:b.batchRoomId}})},goReceiveView:function(){console.log(g,"goReceiveView()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-receive-view"),query:{batchRoomId:b.batchRoomId}})},goAddReceiveInfo:function(){console.log(g,"goAddReceiveInfo()"),r["a"].push({path:"/checkroom/".concat(m["a"].state.app.global.currentMenuType||m["a"].state.app.global.currentBatchType,"-receive-record"),query:{fromPage:"problem_list",title:b.title,batchRoomId:b.batchRoomId}})},getDeliveryQualification:function(){return console.log(g,"getDeliveryQualification()"),p["a"].getHasNetwork().then((function(e){return e?u["a"].getTodoDeliveryDetail({batchId:b.batchId,roomId:b.id}).then((function(e){return e&&e.delivery_qualification||""})):""}))}}},2985:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAADIklEQVRYR82ZTUhUURTHf3fKUqKkD0r7wEVQEUVCH7oSggiskMASF0EQlBW2DHQRDLQw2irZuAiKIFIXFVhIC4kKgmqlVBYuAnO0JkSMcpj0xvXN0+eb92beffMm3lsNc+/5nx/3cM85916Bny8qI5RzEDiMYD+SnUA5sDotNw3EEQwjeQ8MEOctUTGn605oGdyVW5ihGTgDbNWyhVHgPsV0cFZ882rrDbBDrqeI68A5YKVXcZd5SeAOKa7RLH7m0soN2CUbkbQDG3KJaY4niNDMefEwm507YFQuZzPtSC5qOtabLrjNGFeIir9Ohs6A3bKESXqA43refM/uYy2naRB/7AqZgGrlynn0H+FMpj7inLSvZCZgl+wseFjdFlqF+4K4ZB1eCmhsiAe+AxWEYYRG68ZZBDRSyacC7FZd7AQpdpkpaBEwJm8BS5ZXVznA+Z00ictKzwA0KsRIAEnYE+OaIrhZBXvXQewj3PuSYZakmO2q4hiAMdkGtHhSz3NS6QroPwZVGw2hWQm7u+HzVIbwDZpEq8Ao/F991FZtVDucKVDzBF6OZ8iNEqdCEJNVwBttb5oGbnADY3CkD+ako2C1AlShVSEu2OcG92ocap/Br5Sr61YF2AvUu03Ztgq+z0By1h9/HnBqC/cqwEFgj919RMDjo3CiAiZ+Q/1zeD2hB5kXnOFqSAH+cErONWXwom4RaDoFtU+9QwYAp5wnFOCMU/7bUQofGmCZpRh6hQwITgEmXQHV6NV9RkK1frkgA4RbAHQMsQnVUglth7xBBgy3EGLHTWJF8gJZADiFMCjokj1ITuXan9kghyaXli9Ty0Oey+42nWY8J2o3yJEpqLQdqfKGM9DnE7VWqXOCtC9DQHBKttpXs5ANMkC4dLOgOH20W06QAcIpqnS7pX76bFhVnlQpSCVz1ZXU9Wct/Ln2oXXc1rAaq+ir5VcVZ1OJUQJdWiYdMHOureVXf4f+0KQgQ33sNBc31Ad3BRn6qw8FGerLIzPUob5+syaG0F5gWiFDfQVsBQ3tJbq9FlifIeAAzD9DlNmeIdRdwTDwLp9niH+Lfm97gO/iCQAAAABJRU5ErkJggg=="},"3d3a":function(e,t,o){"use strict";o("e697");var n=o("fd50"),i=o("0cd9"),r=o("8fee"),a=o("3fa2"),c=o("a14a"),s=o.n(c);function d(){var e,t,o={},c=a["a"].room;return e={model:o,init:function(){return o.currentPosition={},o.currentItem={},t=["全部"],t.push(1==c.isVirtual?"公区":"房间"),t="('"+t.join("','")+"')",i["a"].getRoomFitmentStandard(c.batchRoomId).then((function(e){return o.fitmentStandard=e.fitment_standard,i["a"].getPositionList(c.projectId,c.batchRoomId)})).then((function(e){return o.positionList=e,i["a"].getFirstPositionItemNotDone(c.projectId,c.batchRoomId,o.fitmentStandard,t)})).then((function(t){return t&&t.position_id?o.defaultPositionId=t.position_id:o.defaultPositionId=o.positionList&&o.positionList[0]&&o.positionList[0].position_id,e.getPositionItem(o.defaultPositionId,!0)}))},getPositionItem:function(e,r){if(e){var a=s.a.find(o.positionList,{position_id:e});return a&&a.checkItem?n["a"].when(a.checkItem):a?i["a"].getPositionEndItem(c.projectId,c.batchRoomId,e,o.fitmentStandard,t).then((function(e){return a.checkItem=e,r&&(a.open=!0),a.checkItem})):n["a"].when([])}},setPositionItemDone:function(e,t){if(e&&t){var n=s.a.find(o.positionList,{position_id:e}),r=s.a.find(n.checkItem,{item_id:t});r.done=!0}else e=o.currentPosition.position_id,t=o.currentItem.item_id,!o.currentItem.done&&(o.currentItem.done=!0);return i["a"].addDoneItemRecord(c.batchRoomId,e,t)},getItemDesc:function(e){return r["a"].getRoomCheckListDescList(e,o.fitmentStandard)},setCurrent:function(e,t){o.currentPosition.position_id!=e&&(o.currentPosition=s.a.find(o.positionList,{position_id:e})),o.currentItem.item_id!=t&&(o.currentItem=s.a.find(o.currentPosition.checkItem,{item_id:t}))},getCurrentItemPosition:function(){if(!o.currentPosition.position_id||!o.currentItem.item_id)return!1;var e=s.a.indexOf(o.currentPosition.checkItem,o.currentItem),t=s.a.indexOf(o.positionList,o.currentPosition),n=o.currentPosition.checkItem.length-1,i=o.positionList.length-1,r=!0,a=!0;return e==n&&t==i?a=!1:0==e&&0==t?r=!1:(e<0||t<0)&&(r=!1,a=!1),{hasPrev:r,hasNext:a}},getPreviousItem:function(){var t,i=s.a.indexOf(o.currentPosition.checkItem,o.currentItem);if(0!==i)return t=o.currentPosition.checkItem[i-1],n["a"].when(t);var r=s.a.indexOf(o.positionList,o.currentPosition);if(0!==r){var a=o.positionList[r-1];return o.currentPosition=a,a.checkItem?(t=a.checkItem[a.checkItem.length-1],n["a"].when(t)):e.getPositionItem(a.position_id).then((function(e){return n["a"].when(e&&e[e.length-1])}))}return n["a"].reject()},getNextItem:function(){var t,i=s.a.indexOf(o.currentPosition.checkItem,o.currentItem);if(i!==o.currentPosition.checkItem.length-1)return t=o.currentPosition.checkItem[i+1],n["a"].when(t);var r=s.a.indexOf(o.positionList,o.currentPosition);if(r!==o.positionList.length-1){var a=o.positionList[r+1];return o.currentPosition=a,a.checkItem?(t=a.checkItem[0],n["a"].when(t)):e.getPositionItem(a.position_id).then((function(e){return n["a"].when(e&&e[0])}))}return n["a"].reject()}},e}t["a"]=d()},4438:function(e,t,o){"use strict";var n=o("cb6b"),i=o("0e1c");t["a"]={getLocalBusinessToggle:function(){var e=n["a"].getObject(i["a"].BUSINESS_TOGGLE,n["a"].level.user);return e||{enable_opening_tab:0,enable_pass_when_add:0,enable_pass_when_to_repair:0,sign_when_receive_delivery:1,special_project_switch:0,take_photo_when_review:0,take_photo_when_regist:0,hide_owner_phone:0,enable_problem_reason:0}}}},"5c1b":function(e,t,o){"use strict";o("f0e6");var n=o("bbed"),i=o("fa1b"),r=o("07a4"),a=o("fd50");function c(){var e=function(e){e&&e.fitment_standard&&("毛坯"===e.fitment_standard?e.is_for_rough=1:"精装"===e.fitment_standard&&(e.is_for_decorated=1),delete e.fitment_standard)},t=function(e,t,o,i,r){return n["a"].getCheckItemLeaf(e,t,i,r).then((function(e){if(_.isEmpty(e))return[];var t=[];return _.each(e,(function(e){t.push(e.id)})),n["a"].getCheckItemAll(t.join("','"),o,i,r)}))};return{getCheckItemList:function(e,o,i,c,s){var d="毛坯"==c,l=a["a"].when(),m=["全部"];return m.push(1==s?"公区":"房间"),m="('"+m.join("','")+"')",l=r["a"].state.app.global.isUseProjectItem?n["a"].getProjectCheckItemList(e,o,i,d,m):t(e,o,i,d,m),l.then((function(e){return e}))},hasProjectCheckitem:function(e){return n["a"].hasProjectCheckitem(e)},searchCheckItemWithProject:function(t,o,i,r){return e(i),r?n["a"].searchProjectCheckItem(r,t,o,i):n["a"].searchCheckItem(t,o,i)},searchCheckItem:function(t,o,i,r){return console.log("searchCheckItem: ",t,o,i),console.time("searchCheckItem"),e(i),n["a"].hasProjectCheckitem(r).then((function(e){return e?n["a"].searchProjectCheckItem(r,t,o,i):n["a"].searchCheckItem(t,o,i).finally((function(){console.timeEnd("searchCheckItem")}))}))},getHigherLevelTreeListByCheckItemId:function(t,o,i){return console.log("getHigherLevelTree: ",t,o,i),console.time("getHigherLevelTree"),e(i),n["a"].getHigherLevelTreeListByCheckItemId(t,o,i).finally((function(){console.timeEnd("getHigherLevelTree")}))},getCheckItemLevel:function(e,t){return n["a"].getCheckItemLevel(e,t)},getPositionItemByRoom:function(e,t,o){var i=a["a"].when(),c=["全部"];return c.push(1==o?"公区":"房间"),c="('"+c.join("','")+"')",i=r["a"].state.app.global.isUseProjectItem?n["a"].getProjectPositionItemByRoom(e,t,c):n["a"].getPositionItemByRoom(e,c),i.then((function(e){return e}))},setIsUseProjectItemOfBatchUnit:function(e){return n["a"].getProjectItemOfBatchUnit(e).then((function(e){var t=!1;e&&(t=!0),r["a"].commit("app/APP",{isUseProjectItem:t})}))},getBatchCheckItem:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return i["a"].getCheckItemList(e,t,o,r["a"].state.app.global.isUseProjectItem).then((function(e){return console.log("BatchCheckItem",e),a["a"].resolve(e)}))}}}t["a"]=c()},6013:function(e,t,o){"use strict";var n=o("07a4"),i=o("dfb1"),r=o("81ad"),a=o("c6e3"),c=o("9430"),s=o("a14a"),d=o.n(s),l={getDeliveryNodeList:function(){return i["a"].getDeliveryNodeList(n["a"].state.projectList.currentItem.id)},getTodoDeliveryDetail:function(e){return i["a"].getTodoDeliveryDetail(e)},uploadDeliveryConfirmInfo:function(e,t,o){return r["a"].uploadFiles(e,"deliveryProcess",t.room_id).then((function(e){console.log(e),e=d.a.uniq(e);var n={child_process:[{id:o,status:1,imgs:e}],reason:"",remark:""};return n=d.a.extend(n,t),i["a"].uploadProcessData(n)}))},uploadProcessData:function(e){return i["a"].uploadProcessData(e)},getProcessOperateLog:function(e){return i["a"].getProcessOperateLog(e)},getDeliveryConfirmInfo:function(e,t,o){return i["a"].getDeliveryConfirmInfo(e,t,o)},getRoomData:function(e,t){return a["a"].getBatchRoom(e,t)},assistSignIn:function(e){return i["a"].assistSignIn(e)},hasUploadData:function(e){return c["a"].existsBatchRoomUploadData(e)}};t["a"]=l},6324:function(e,t,o){var n=o("9282");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var i=o("85cb").default;i("f15f5b04",n,!0,{})},"77a8":function(e,t,o){"use strict";o("6d57");function n(){var e={list:[]};return{model:e,init:function(){e.list=[{key:"status",value:"常用状态",name:"常用状态",displayName:"所有状态",list:[{name:"常用状态",value:"常用状态"},{name:"所有状态",value:""}]},{key:"position",value:"",name:"全部",displayName:"部位",list:[]},{key:"checkItem",value:"",name:"全部",displayName:"检查项",list:[]}]},update:function(t){e.list.forEach((function(e){t[e.key]&&(e.list=t[e.key])}))},getCondition:function(){var t={};return e.list.forEach((function(e){t[e.key]=e.value})),t},resetCheckItemValue:function(){e.list.forEach((function(e){"checkItem"===e.key&&(e.value="",e.name="全部")}))}}}t["a"]=n()},"78a7":function(e,t){e.exports="data:image/png;base64,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"},"85cd":function(e,t,o){"use strict";var n=o("1834"),i=o("0938"),r="checkitem_remark_history",a={createCondition:function(e,t){if(_.isEmpty(e))return"";t=t?"crh.":"";var o=[];return _.each(e,(function(e,n){o.push(t+n+"="+e)})),o=o.join(" and "),o},insertHistory:function(e){e.id=i["a"].uuid(),e.used_time=e.used_time||1,e.last_used_time=e.last_used_time||i["a"].getNowDate();var t=[],o=[];return _.each(e,(function(e,n){t.push(n),o.push(e)})),n["a"].insert(r,t,o).then((function(){return e.id}))},updateHistory:function(e,t){return n["a"].update(r,e,t)},getOneHistory:function(e,t,o){var i="select * from "+r+" where item_id=? and desc_id=? and remark=?";return n["a"].queryOne(i,[e,t,o])},updateUserdTime:function(e,t){if(!t)return $q.error("次数不能为0");var o={last_used_time:i["a"].getNowDate(),used_time:t};return n["a"].update(r,o,{id:e})},getListByItemIdOrderDate:function(e,t){var o="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ?  order by crh.last_used_time desc limit "+t;return n["a"].query(o,[e])},getListByItemIdOrderUsedTime:function(e,t,o){var i=o.length?'and crh.id not in ("'+o.join('","')+'")':"",r="select crh.id, crh.desc_id, crh.remark, cid.name as desc_name from checkitem_remark_history crh inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id = ? "+i+" order by crh.used_time desc limit "+t;return n["a"].query(r,[e])},deleteItemById:function(e){var t="delete from checkitem_remark_history where id=?";return n["a"].query(t,[e])},searchByItems:function(e,t){var o="select crh.id,crh.remark as name,crh.item_id,ci.name as item_name,ci.full_name as item_full_name,crh.desc_id,cid.name as desc_name from checkitem_remark_history crh inner join check_item ci on ci.id = crh.item_id inner join check_item_desc cid on cid.id = crh.desc_id and cid.check_item_id = crh.item_id where crh.item_id in ("+t+') and (lower(crh.remark) like "%" || ? || "%" or upper(crh.remark) like "%" || ? || "%") order by crh.remark';return n["a"].query(o,[e,e])}},c=a,s={getList:function(e){if(!e)return $q.reject("itemId为空");var t=[];return c.getListByItemIdOrderDate(e,3).then((function(o){if(o){var n=[];return _.each(o,(function(e){n.push(e.id),t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),c.getListByItemIdOrderUsedTime(e,17,n).then((function(e){return e&&_.each(e,(function(e){t.push({id:e.id,name:e.desc_name+"："+e.remark,descId:e.desc_id,remark:e.remark,descName:e.desc_name})})),t}))}return $q.reject(t)}))},deleteItem:function(e){return c.deleteItemById(e)},upsertHistory:function(e,t,o){return c.getOneHistory(e,t,o).then((function(n){return n?c.updateUserdTime(n.id,n.used_time+1):c.insertHistory({item_id:e,desc_id:t,remark:o})}))},searchByItems:function(e,t){return c.searchByItems(e,t)}};t["a"]=s},"882e":function(e,t,o){"use strict";o("cc57"),o("6d57");var n=o("fd50"),i=o("07a4"),r=o("bad1"),a=o("5c1b"),c=o("dd0a"),s=o("b643"),d=o("964e"),l=o("0938"),m=o("3fa2"),u=o("a593"),p=o("a14a"),h=o.n(p),f=o("bbed");function b(){var e={problem:{}},t=null,o="";function p(){if(t=null,e.positionItems={},e.cacheIntersectItems=[],e.diagramUrl="",e.allPositions=[],e.problemReasons=[],e.fitmentStandard=m["a"].room.fitmentStandard||"毛坯",e.points=[],e.checkItems=[],e.checkItemTree=null,e.checkItemMap=null,e.problem={},e.problem.batchRoomId="",e.problem.positions=[],e.problem.selectedItem=null,e.problem.selectedDesc=null,e.problem.problemImages=[],e.problem.remark="",e.problem.isPassedWhenAdd=0,e.problem.emergencyDegree="一般",e.problem.contractor=null,e.problem.responsibleCompany=null,e.problem.topItemId="",i["a"].state.app.global.enableProblemReason)return s["a"].getReasonConfig().then((function(t){e.problemReasons=e.problemReasons.concat(t)}))}function b(e,t){var o=[];return e.forEach((function(e){for(var n=t.length,i=0;i<n;i++)if(e.item_id===t[i].item_id){o.push(e);break}})),o}return{model:e,setRoomPosition:function(t){var n=u["default"].prototype.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"户型图加载中"});p(),e.roomTitle=t.roomTitle,e.diagramUrl=t.diagramUrl,e.allPositions=t.position,e.problem.batchUnitId=t.unitId,e.problem.batchRoomId=o=t.roomId,this.getPositionItem().then((function(){setTimeout((function(){n.clear(),console.log("关闭---------------")}),200)})).catch((function(e){return console.log(e)}))},getPositionItem:function(){return a["a"].getPositionItemByRoom(o,m["a"].room.projectId,m["a"].room.isVirtual).then((function(t){t.forEach((function(t){e.positionItems[t.position_id]||(e.positionItems[t.position_id]=[]),l["a"].getObjectFromArrayByProperty(e.positionItems[t.position_id],"item_id",t.item_id,!1)||e.positionItems[t.position_id].push({item_id:t.item_id,item_name:t.item_name,parent_item_id:t.parent_item_id,level:t.level})}))}))},checkPositionItem:function(t){if(!t)return null;e.problem.selectedItem=null;var o=e.positionItems[t];if(!o||!o.length)return!1;if(!e.cacheIntersectItems.length)return e.cacheIntersectItems.push(o),e.checkItems=o,e.checkItemTree=null,!0;var n=b(o,e.checkItems);return!(!n.length||!this.hasEndItem(n,t))&&(e.cacheIntersectItems.push(n),e.checkItems=n,e.checkItemTree=null,!0)},hasEndItem:function(t,o){for(var n=0;n<t.length;n++){for(var i=e.positionItems&&e.positionItems[o],r=i&&i.length,a=!0,c=0;c<r;c++)if(i[c].parent_item_id===t[n].item_id){a=!1;break}if(!0===a)return!0}return!1},getIntersectCheckItem:function(t,o,n){var i=[];if(t)for(var r=0;r<e.checkItems.length;r++)e.checkItems[r].parent_item_id===t&&i.push(e.checkItems[r]);else for(var a=0;a<e.checkItems.length;a++)1===e.checkItems[a].level&&i.push(e.checkItems[a]);return i.slice(o*n,(o+1)*n)},cancelPoint:function(){var t=e.cacheIntersectItems.length;t&&(e.cacheIntersectItems.pop(),e.checkItems=e.cacheIntersectItems[t-2]||[],e.problem.selectedItem=null,e.checkItemTree=null)},createRoomPosition:function(){var t={},o=[],n=e.allPositions,i=[];return e.points.forEach((function(e){var r=e.positionId,a={x:e.coordinate.x,y:e.coordinate.y,diagramId:e.diagramId},c=n.length,s=0;if(t[r])return t[r].points.push(a);for(;s<c;s++)if(r===n[s].id)return t[r]={positionId:r,positionName:"",points:[a]},i.push(r),o.push(t[r])})),e.problem.positions=o,this.setPositionName(i)},setPositionName:function(t){return t&&t.length?r["a"].getPositionByIds("'"+t.join("','")+"'").then((function(t){t&&t.length&&e.problem.positions.forEach((function(e){for(var o=t.length,n=0;n<o;n++)if(t[n].id===e.positionId){e.positionName=t[n].name;break}}))})):n["a"].resolve()},createCheckItemTree:function(){var t,o=[],n={};e.checkItems.forEach((function(e){var t,i=e.item_id,r=e.level>1?e.parent_item_id:"",a=h.a.assign({},e);return i in n?a=h.a.assign(n[i],a):n[i]=a,r?r in n?(t=n[r],void(t.children?t.children.push(a):t.children=[a])):(n[r]={item_id:r,children:[a]},n[r]):o.push(a)})),function e(o,n){o.forEach((function(t){t.item_full_name=n?n+"-"+t.item_name:t.item_name,t.children&&e(t.children,t.item_full_name)})),null!==t&&(t=1===o.length?o[0]:null)}(o),e.checkItemTree=o,e.checkItemMap=n,e.selectedItem=t},update:function(t){h.a.assign(e,t)},save:function(){t={points:e.points.slice(0),positions:e.problem.positions.slice(0),checkItems:e.checkItems.slice(0),cacheIntersectItems:e.cacheIntersectItems.slice(0)}},restore:function(){t&&(e.points=t.points,e.problem.positions=t.positions,e.checkItems=t.checkItems,e.cacheIntersectItems=t.cacheIntersectItems,t=null)},clearStore:function(){t=null},clear:function(){return p()},updateRemark:function(t){e.problem.remark=t},updateCheckItem:function(t){e.problem.selectedItem=t,e.problem.selectedDesc=null,e.problem.contractor=null,e.problem.responsibleCompany=null,e.problem.topItemId=function t(o){return o.parent_item_id&&o.level>1?t(e.checkItemMap[o.parent_item_id]):o.item_id}(t)},updateDesc:function(t){u["default"].prototype.$set(e.problem,"selectedDesc",t),e.problem.contractor=null,c["a"].getContractor(o,e.problem.selectedItem.item_id,e.problem.selectedDesc.map((function(e){return e.id})).join(";")).then((function(t){"length"in t||(t=[t]),e.problem.contractor=t,e.problem.responsibleCompany=t,u["default"].prototype.$eventBus.$emit("app.batchAddProblem:updateContractor")}))},submit:function(){var t=[],i=e.problem.problemImages.map((function(e){return{img_localpath:e.img_local_path}})),r=e.problem.selectedDesc.map((function(e){return e.id})).join(";"),a=e.problem.contractor.map((function(e){return e.contractor_id})).join(";"),c=e.problem.responsibleCompany.map((function(e){return e.contractor_id})).join(";"),s=0,l=[];e.problemReasons.forEach((function(e){e.selected&&l.push(e.id)}));for(var p=0;p<e.problem.positions.length;p++)for(var h=e.problem.positions[p],b=0;b<h.points.length;b++){var g=d["a"].batchAddProblem({problem_images:i,batch_room_id:o,position_id:h.positionId,item_id:e.problem.selectedItem.item_id,top_item_id:e.problem.topItemId,desc_id:r,contractor_id:a,responsible_company_id:c,roomtype_diagram_id:h.points[b].diagramId,coordinate:[{x:h.points[b].x,y:h.points[b].y}],emergency_degree:e.problem.emergencyDegree,remark:e.problem.remark,is_passed_when_add:e.problem.isPassedWhenAdd?1:0},!1,"",l);t.push(g),s++}return n["a"].all(t).then((function(){return f["a"].updateCheckItemUseTimes(e.problem.selectedItem.item_id,s)})).then((function(){return f["a"].updateItemDescUseTimes(r,s)})).then((function(){m["a"].room.hasProblem=!0,u["default"].prototype.$eventBus.$emit("app.roomdetail:statusChange")}))}}}t["a"]=b()},"8fee":function(e,t,o){"use strict";var n=o("760e"),i=o("a14a"),r=o.n(i);t["a"]={getCheckItemDescList:function(e,t,o){return n["a"].getCheckItemDescList(e,t,o).then((function(e){return e}))},getRoomCheckListDescList:function(e,t){return n["a"].getRoomCheckListDescList(e,t).then((function(e){if(!r.a.isEmpty(e))for(var t=0;t<e.length&&t<3;t++)e[t].isImportant=!0;return e}))},searchDesc:function(e,t){return n["a"].searchDesc(e,t)}}},9282:function(e,t,o){t=e.exports=o("690e")(!1),t.push([e.i,"\n.zhkf .check-list-detail[data-v-87292cd8] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  height: 100%;\n}\n.zhkf .content-header[data-v-87292cd8] {\n  min-height: 50px;\n  background: #eff9ff;\n  padding: 13px 15px;\n  font-size: 15px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: justify;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.zhkf .content-header .header-left[data-v-87292cd8] {\n    margin-right: 17px;\n    line-height: 1.5;\n}\n.zhkf .content-header .header-right[data-v-87292cd8] {\n    color: #0085ff;\n    -ms-flex-item-align: center;\n        align-self: center;\n    font-weight: 500;\n    white-space: nowrap;\n}\n.zhkf .detail-content[data-v-87292cd8] {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  overflow: scroll;\n}\n.zhkf .detail-content .icon-duoxuan-weixuanzhuangtai[data-v-87292cd8] {\n    font-size: 20px;\n    color: #bbb;\n}\n.zhkf .detail-content .icon-xuanzhong[data-v-87292cd8] {\n    font-size: 20px;\n    color: #0085ff;\n}\n.zhkf .btns[data-v-87292cd8] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  font-size: 16px;\n  padding: 7px 11px;\n  background: #ffffff;\n}\n.zhkf .btns .btn[data-v-87292cd8] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    text-align: center;\n    color: #0085ff;\n    padding: 12px 0;\n    border-radius: 23px;\n    border: 1px solid #0085ff;\n}\n.zhkf .btns .btn[data-v-87292cd8]:last-child {\n      background: #0085ff;\n      color: #fff;\n}\n.zhkf .btns .btn[data-v-87292cd8]:not(:first-child) {\n      margin-left: 10px;\n}\n.zhkf .btns .btn.disabled[data-v-87292cd8] {\n      background: -webkit-gradient(linear, right top, left top, from(#0085ff), to(#02b8ff));\n      background: linear-gradient(270deg, #0085ff 0%, #02b8ff 100%);\n      -webkit-box-shadow: 0px 2px 4px 0px rgba(0, 133, 255, 0.2);\n              box-shadow: 0px 2px 4px 0px rgba(0, 133, 255, 0.2);\n      opacity: 0.5;\n}\n@media screen and (max-width: 320px) {\n.zhkf .content-header .header-right[data-v-87292cd8] {\n    width: 61px;\n}\n}\n",""])},"98a4":function(e,t,o){"use strict";o("e697");var n=o("85cd"),i=o("fd50"),r=o("a593"),a={model:{},init:function(){a.model.historyList={},a.model.currItemId="",a.model.currList=[]},loadList:function(e,t){return e?(_.isEmpty(a.model)&&a.init(),t=t||!1,a.model.currItemId=e,_.isEmpty(a.model.historyList[e])||t?(console.log("=== itemId ===",e),n["a"].getList(e).then((function(t){console.log(t),a.model.historyList[e]=t,a.model.currList=t})).catch((function(){a.model.historyList[e]=[],a.model.currList=[]}))):(a.model.currList=a.model.historyList[e],i["a"].resolve())):i["a"].reject()},upsertHistory:function(e,t,o){return n["a"].upsertHistory(e,t,o).then((function(){a.loadList(e,!0)}))},delHistory:function(e){return n["a"].deleteItem(e).then((function(){var t=_.find(a.model.currList,{id:e});if(t){var o=a.model.currList.indexOf(t);o>-1&&a.model.currList.splice(o,1)}})).catch((function(e){console.error(e),r["default"].prototype.$toast("删除历史失败！")}))}};t["a"]=a},a9ec:function(e,t,o){"use strict";o("6d57");var n=o("a593"),i=o("3fa2"),r=o("d485"),a=o("9af1"),c=o("77a8");function s(){var e={},t={problemList:[],buttons:[]},o={},s="tab-icon1",d={"待派单":"tab-icon5","待整改":"tab-icon2","已整改":"tab-icon3","已通过":"tab-icon4","已作废":"tab-icon6","非正常关闭":"tab-icon7"},l=i["a"].room;return o.iniStatusStyle=function(){t.problemList.forEach((function(e){d[e.status]?e.status_style=d[e.status]:e.status_style=s}))},o.initFilter=function(){return r["a"].getPositionList(l.batchRoomId).then((function(e){t.filterList.position.list=e}))},o.getCondition=function(){var e={};_.each(t.filterList,(function(t,o){e[o]=t.value}))},o.getProblemPoints=function(){n["default"].prototype.$eventBus.$emit("app.roomdetail:updateProblemPoints",t.problemList)},e={model:t,init:function(){return r["a"].getProblemList(l.batchRoomId,0,1,!0).then((function(e){t.problemList=e,o.iniStatusStyle()})).then((function(){return console.log("fromType------",l.fromType),a["a"].getDefaultFilterList(t.problemList,l.batchRoomId,l.fromType).then((function(e){c["a"].update(e),console.log("filters---------",e),o.getProblemPoints()}))})).then((function(){if(!_.isEmpty(c["a"].model.list))return e.updateProblemList()}))},updateProblemList:function(e){var n=c["a"].getCondition();a["a"].hideProblemByFilter(t.problemList,c["a"].model.list,n,e),o.getProblemPoints()}},e}t["a"]=s()},b643:function(e,t,o){"use strict";var n=o("7ee1");t["a"]={getReasonConfig:function(){return n["a"].getList()},getProblemReason:function(e){return n["a"].getProblemReason(e)}}},bad1:function(e,t,o){"use strict";var n=o("97ba");t["a"]={getPositionList:function(e){return console.log("batchRoomId",e),n["a"].getPositionList(e).then((function(e){return e}))},getPositionByIds:function(e){return n["a"].getPositionByIds(e)},getPositionNameById:function(e){return n["a"].getPositionNameById(e)}}},db5f:function(e,t,o){"use strict";o("5ab2"),o("e44b"),o("e10e"),o("f0e6");var n=o("28f8"),i=(o("5f54"),o("6d57"),o("fd50")),r=o("c2c1"),a=o("0938"),c=o("8ae6"),s=o("a14a"),d=o.n(s),l=o("07a4"),m=o("a593"),u=o("98a4"),p=o("3fa2"),h=o("a9ec"),f=o("db99"),b=o("bad1"),g=o("964e"),_=o("0970"),I=o("5c1b"),y=o("dd0a"),k=o("4438"),v=o("b643"),P=o("bbed");function w(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function A(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?w(Object(o),!0).forEach((function(t){Object(n["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):w(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var D=p["a"].room,C="",L="";function R(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];o.length>0?console.log("[model]/problem-model.js：",e,o):console.log("[model]/problem-model.js：",e)}function O(){if(!S.model.problem.contractorIds&&S.model.problem.checkItemId)return y["a"].getContractor(D.batchRoomId||S.model.problem.batchRoomId,S.model.problem.checkItemId,S.model.problem.descIds).then((function(e){var t=[],o=[];S.model.contractorDisabled=!1,d.a.isEmpty(e)||(d.a.each(e,(function(e){t.push(e.contractor_id),o.push(e.contractor_name)})),t.length>1&&(S.model.contractorDisabled=!0),t=t.join(";"),o=o.join("；"),S.model.problem.contractors=o,S.model.problem.contractorIds=t,S.model.problem.responsibilityUnitIds=t,S.model.problem.responsibilityUnits=o)}))}function T(){var e=S.model.problem.id?"editProblem":"addProblem";!S.model.selectes&&(S.model.selectes={position:{},checkItem:{},desc:{},contractor:{},responsibleCompany:{}}),S.model.positionDisabled||(S.model.selectes.position={path:"/checkroom/".concat(l["a"].state.app.global.currentMenuType||l["a"].state.app.global.currentBatchType,"-position-select"),query:{fromPage:e}}),S.model.problem.positionId?(S.model.selectes.checkItem={path:"/checkroom/".concat(l["a"].state.app.global.currentMenuType||l["a"].state.app.global.currentBatchType,"-checkitem-select/").concat((new Date).getTime()),query:{type:D.fromType,fitment_standard:D.fitmentStandard,fromPage:e,isSpecial:+D.isSpecial}},S.model.problem.checkItemId?(D.isSpecial||I["a"].getHigherLevelTreeListByCheckItemId(S.model.problem.checkItemId,S.model.problem.positionId,{fitment_standard:D.fitmentStandard}).then((function(t){S.model.selectes.checkItem.query=d.a.extend(S.model.selectes.checkItem.query,{history:JSON.stringify(t),level:0,fromPage:e})})),S.model.selectes.desc={path:"/checkroom/".concat(l["a"].state.app.global.currentMenuType||l["a"].state.app.global.currentBatchType,"-desc-select"),query:{fromPage:e,fitment_standard:D.fitmentStandard,level:0}},S.model.selectes.contractor={path:"/checkroom/".concat(l["a"].state.app.global.currentMenuType||l["a"].state.app.global.currentBatchType,"-contractor-select"),query:{fromPage:e}},S.model.selectes.responsibleCompany={path:"/checkroom/".concat(l["a"].state.app.global.currentMenuType||l["a"].state.app.global.currentBatchType,"-responsible-select"),query:{fromPage:e}}):S.model.selectes.checkItem.query=d.a.extend(S.model.selectes.checkItem.query,{batchId:D.batchId})):S.model.selectes.checkItem={}}function B(e){var t=e.coordinate?[JSON.parse(e.coordinate)]:[];return S.model.problem={projectId:e.projectId,problemStamp:e.problemStamp,positionId:e.positionId||"",diagramId:e.diagramId,positionName:"",checkItemId:e.checkItemId||"",checkItemName:e.checkItemName||"",topCheckItemId:e.checkItemId||"",checkItemGuide:!1,descIds:e.descIds||"",descNames:e.descNames||"",remark:e.remark||"",imageList:e.imageList||[],emergencyDegree:"一般",coordinates:t,contractors:"",contractorIds:"",responsibilityUnitIds:"",responsibilityUnits:"",isPassedWhenAdd:!1,isRemarkRequired:"",feedbackId:e.feedbackId,batchRoomId:e.batch_room_id},"roomDesignChange"!==e.problemType&&"feedbackRemainReply"!==e.problemType||(D={batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id}),S.model.positionId=null,S.setProblem(),i["a"].resolve()}function j(e){return g["a"].getProblem(e.problemId).then((function(t){var o=i["a"].when();return D&&!d.a.isEmpty(D)||(D={fromType:e.type,batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id,isSpecial:e.isSpecial,fitmentStandard:e.fitment_standard,batchId:t.batch_id}),o.then((function(){return t.problem_reason_ids=[],l["a"].state.app.global.enableProblemReason?v["a"].getProblemReason(e.problemId).then((function(e){return t.problem_reason_ids=e,i["a"].resolve(t)})):i["a"].resolve(t)}))})).then((function(t){S.model.problem={id:t.id,projectId:t.proj_id,positionId:t.position_id||"",positionName:t.position_name||"",diagramId:t.roomtype_diagram_id,checkItemId:t.item_id||"",checkItemName:t.item_name||"",topCheckItemId:t.top_item_id||"",checkItemGuide:!1,descIds:t.desc_id||"",descNames:t.desc||"",remark:t.remark,imageList:[],emergencyDegree:t.emergency_degree,coordinates:t.coordinates,contractors:t.contractor_name,contractorIds:t.contractor_id,responsibilityUnitIds:t.responsible_company_id,responsibilityUnits:t.responsible_company_name,isPassedWhenAdd:t.is_passed_when_add||!1,isRemarkRequired:t.isRemarkRequired,reasonIds:t.problem_reason_ids,batchRoomId:e.batch_room_id,batchUnitId:e.batch_unit_id},t.problem_images.forEach((function(e){var t=c["a"].getImageRealPath(e.img_localpath);S.model.problem.imageList.push({localPath:e.img_localpath,fullPath:t,viewPath:c["a"].getImageWebViewPath(t)})})),console.log("==== _self.model.problem  ====",S.model.problem),C=t.remark,L=t.is_passed_when_add,S.model.positionId=t.position_id}))}var S={initUpdate:!0,model:{isLoaded:!1,positionId:"",problem:{imageList:[]},ProblemReasons:[],remarkChangeStatus:1},setProblem:function(e){var t={};S.model.positionDisabled=!1,S.model.checkItemDisabled=!1,S.model.descDisabled=!1,S.model.contractorDisabled=!1,"roomDesignChange"===S.model.problemType?(!d.a.isEmpty(e)&&(t={checkItemId:e.itemId,topCheckItemId:e.itemId,checkItemName:e.itemName,descIds:e.descId,descNames:e.descName,emergencyDegree:e.emergency_degree,remark:e.remark}),S.model.checkItemDisabled=!0,S.model.descDisabled=!0):"feedbackRemainReply"===S.model.problemType?(S.model.positionDisabled=!0,S.model.checkItemDisabled=!0):"fitmentStyle"===S.model.problemType?(!d.a.isEmpty(e)&&(t={checkItemId:e.checkItemId,topCheckItemId:e.checkItemId,checkItemName:e.checkItemName,emergencyDegree:"前置配置"===e.configType?"紧急":"一般",positionId:e.positionId||""}),S.model.positionDisabled=!0,S.model.checkItemDisabled=!0):"checkList"===S.model.problemType&&(!d.a.isEmpty(e)&&(S.model.problem=d.a.extend(S.model.problem||{},e)),T(),O(),S.initUpdate=!1),S.model.problem=d.a.extend(S.model.problem||{},t)},showGuide:function(){return S.model.problem.checkItemId?_["a"].getCheckItemGuideByItemId(S.model.problem.checkItemId).then((function(e){S.model.guideText=e,S.model.showGuide=!!e})):(S.model.guideText="",S.model.showGuide=!1,i["a"].resolve())},init:function(e){S.model.isLoaded=!1,S.model.title=e.problemId?"编辑问题":"feedbackRemainReply"!==e.problemType?"登记问题":e.title,S.model.problemType=e.problemType||"default";var t,o=l["a"].state.app.global.currentBatchType||"simulate";return S.model.enablePassWhenAdd=1==k["a"].getLocalBusinessToggle().enable_pass_when_add&&(m["default"].prototype.$checkRight("reinspect_problem",o)||m["default"].prototype.$checkRight("pass_problem",o)),S.model.ProblemReasons=[],console.log("=====",S.model),t=e.problemId?j(e):B(e),t.then((function(){return S.showGuide().then((function(){if(S.model.problem.positionId)return b["a"].getPositionNameById(S.model.problem.positionId).then((function(e){S.model.problem.positionName=e}))})).then((function(){S.initUpdate&&T()})).then((function(){if(l["a"].state.app.global.enableProblemReason)return v["a"].getReasonConfig().then((function(t){console.log("=== reasons ===",t),e.problemId&&t.forEach((function(e){m["default"].prototype.$set(e,"selected",S.model.problem.reasonIds.indexOf(e.id)>-1)})),S.model.ProblemReasons=t}))})).then((function(){S.model.isLoaded=!0})).catch((function(e){console.error(e),m["default"].prototype.$toast("获取相关数据失败，请返回或稍后重试")}))}))},updateProblem:function(e,t){return t=t||!1,S.model.problem=Object.assign({},S.model.problem,e),S.showGuide().then((function(){return T(),e.remark&&S.model.remarkChangeStatus++,R("updateProblem - 更新问题的字段：","updateProblem=".concat(t),e),t?O():i["a"].resolve()}))},takePhoto:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=c["a"].getNewProblemImagePath({folder:D.batchUnitId+"/"+D.batchRoomId,imageId:Object(a["j"])()});return console.log("take photo",t),r["a"].takePhoto(t.full_path,A({withGraffiti:!0,text:g["a"].getWatermarkText()},e)).then((function(){S.model.problem.imageList.push({localPath:t.save_path,fullPath:t.full_path,viewPath:t.view_path?t.view_path:c["a"].getImageWebViewPath(t.full_path)})}))},addProblem:function(e){e=e||"";var t=[];d.a.each(S.model.problem.imageList,(function(e){t.push({img_localpath:e.localPath})}));var o={problem_images:t,batch_room_id:D.batchRoomId||S.model.problem.batchRoomId,position_id:S.model.problem.positionId,item_id:S.model.problem.checkItemId,top_item_id:D.isSpecial?"":S.model.problem.topCheckItemId,desc_id:S.model.problem.descIds,contractor_id:S.model.problem.contractorIds,responsible_company_id:S.model.problem.responsibilityUnitIds,roomtype_diagram_id:S.model.problem.diagramId,coordinate:S.model.problem.coordinates,emergency_degree:S.model.problem.emergencyDegree,remark:S.model.problem.remark,is_passed_when_add:S.model.problem.isPassedWhenAdd?1:0,problemType:S.model.problemType,feedbackId:S.model.problem.feedbackId},n=[];return S.model.ProblemReasons.forEach((function(e){e.selected&&n.push(e.id)})),g["a"].batchAddProblem(o,D.isSpecial,e,n).then((function(){return P["a"].updateCheckItemUseTimes(S.model.problem.checkItemId).catch((function(e){window.$log("添加问题 updateCheckItemUseTimes catch & 参数",{error:e,curr_param:{checkItemId:S.model.problem.checkItemId}}),console.log("添加问题 updateCheckItemUseTimes catch & 参数",{error:e,curr_param:{checkItemId:S.model.problem.checkItemId}})}))})).then((function(){return P["a"].updateItemDescUseTimes(S.model.problem.descIds).catch((function(e){window.$log("添加问题 updateItemDescUseTimes catch & 参数",{error:e,curr_param:{descIds:S.model.problem.descIds}}),console.log("添加问题 updateItemDescUseTimes catch & 参数",{error:e,curr_param:{descIds:S.model.problem.descIds}})}))})).then((function(){return h["a"].init().catch((function(e){window.$log("添加问题 刷新房间问题model catch",e),console.error("添加问题 刷新房间问题model catch",e)})),D.mode})).catch((function(e){window.$log("添加问题 刷新房间问题model这一步的外部 catch",e),console.error("添加问题 刷新房间问题model这一步的外部 catch",e)})).finally((function(){console.log("添加问题 finally88"),S.model.problem.remark&&S.model.problem.descIds.indexOf(";")<0&&u["a"].upsertHistory(S.model.problem.checkItemId,S.model.problem.descIds,S.model.problem.remark).catch((function(e){window.$log("添加问题 finally catch",e),console.log("添加问题 finally catch",e)}))}))},editProblem:function(){var e=[],t=[];return d.a.each(S.model.problem.imageList,(function(e){t.push({img_localpath:e.localPath})})),S.model.ProblemReasons.forEach((function(t){t.selected&&e.push(t.id)})),g["a"].processEditProblem({id:S.model.problem.id,problem_images:t,batch_room_id:D.batchRoomId,position_id:S.model.problem.positionId,item_id:S.model.problem.checkItemId,top_item_id:D.isSpecial?"":S.model.problem.topCheckItemId,desc_id:S.model.problem.descIds,contractor_id:S.model.problem.contractorIds,responsible_company_id:S.model.problem.responsibilityUnitIds,emergency_degree:S.model.problem.emergencyDegree,remark:S.model.problem.remark,roomtype_diagram_id:S.model.problem.diagramId,coordinate:S.model.problem.coordinates,is_passed_when_add:S.model.problem.isPassedWhenAdd?1:0,is_passed_when_add_old:L},D.isSpecial,e).then((function(){f["a"].updateProblem(S.model.problem.id),h["a"].init()})).catch((function(e){return i["a"].reject(e)})).finally((function(){S.model.problem.remark&&S.model.problem.descIds.indexOf(";")<0&&C!=S.model.problem.remark&&u["a"].upsertHistory(S.model.problem.checkItemId,S.model.problem.descIds,S.model.problem.remark)}))}};t["a"]=S},db99:function(e,t,o){"use strict";o("6d57"),o("e697");var n=o("fd50"),i=(o("cc57"),o("9a33"),o("a324")),r=o("760e"),a=function(){var e=20,t={},o={},a={};return t={batch_unit_id:"cp.batch_unit_id",status:"cp.status",floor:"br.floor",item:"ci.id",user:"u.id"},o.formatData=function(e,t){var o=[],n=[];return _.each(e,(function(e){var i={};e.desc_id=e.desc_id.split(";"),_.each(e.desc_id,(function(e){o.indexOf(e)<0&&o.push(e)})),-1==e.floor.indexOf("层")&&-1==e.floor.indexOf("楼")&&-1==e.floor.indexOf("公共区域")&&(e.floor=e.floor+"楼"),i.id=e.id,i.code=e.code,i.batchRoomId=e.batch_room_id,i.batchUnitId=e.batch_unit_id,i.registerUserName=e.regist_user_name,i.roomtypeDiagramId=e.roomtype_diagram_id,i.status=e.status,i.roomName=t+"-"+e.floor+"-"+e.room_no,i.dealTime=e.deal_time&&"00-00-00 00:00:00"!==e.deal_time?e.deal_time:"",i.emergence=e.emergency_degree&&e.emergency_degree.indexOf("急")>-1?e.emergency_degree:"",i.sendBackTimes=e.sent_back_time||0,i.positionName=e.position,i.itemName=e.item,i.contractor=e.contractor||"",i.desc=e.desc_id,n.push(i)})),r["a"].getDescByIds(o).then((function(e){return _.each(n,(function(t){_.each(t.desc,(function(o,n){var i=_.find(e,{id:o});t.desc[n]=i?i.name:"无描述"})),t.desc=t.desc.join("、")})),n}))},o.getFilter=function(e,t){var o={status:i["a"].getCountOfProblemStatus,floor:i["a"].getCountOfFloor,item:i["a"].getCountOfCheckItem,user:i["a"].getCountOfRegister};return o[e](t)},a.createCondition=function(e,o){if(_.isEmpty(e))return"";"batch_unit_id"==o&&(o="");var n=[];return _.each(e,(function(e,i){t[i]&&i!==o&&n.push(t[i]+'="'+e+'"')})),n.join(" and ")},a.initFilter=function(){var e=[{type:"status",title:"问题状态",name:"",value:"",options:[]},{type:"floor",title:"楼层",name:"",value:"",options:[]},{type:"item",title:"检查项",name:"",value:"",options:[]},{type:"user",title:"登记人",name:"",value:"",options:[]}];return e},a.getProblems=function(t,r,c){var s=a.createCondition(r);return i["a"].getAllProblemListByPage(s,t,e).then((function(e){return!e||_.isEmpty(e)?[]:o.formatData(e,c)})).catch((function(e){return n["a"].reject(e)}))},a.getFilterCount=function(e){e=e||{};var i,r="",c={},s=[];return _.each(t,(function(t,n){"batch_unit_id"!==n&&(r=a.createCondition(e,n),i=o.getFilter(n,r).then((function(e){return{type:n,res:e}})),s.push(i))})),n["a"].all(s).then((function(e){return _.each(e,(function(e){if(e){var t=[],o=0;_.each(e.res,(function(e){t.push({count:e.count,name:e.name||e.title,value:e.value}),o+=e.count})),t.unshift({value:"",name:"全部",count:o}),c[e.type]=t}})),c}))},a.getSelectedProblems=function(e){var t=a.createCondition(e);return i["a"].getSelectedProblems(t)},a.passProblems=function(e){var t=[];return e.forEach((function(e){t.push(i["a"].passProblem(e.id,e.batchRoomId))})),n["a"].all(t)},a.getListInfoById=function(e,t){return i["a"].getListInfoById(e).then((function(e){return o.formatData([e],t).then((function(e){return e.shift()}))})).catch((function(e){return n["a"].reject(e)}))},a},c=a(),s=o("9072"),d=o("a14a"),l=o.n(d),m=function(){var e={},t=20,o={};function i(){l.a.isEmpty(e.filter)&&(e.filter=c.initFilter());var o=r(),n=[],i="";return c.getFilterCount(o).then((function(o){l.a.each(e.filter,(function(t,r){if(i=e.filter[r].value||"",t&&o[t.type]){var a=l.a.find(o[t.type],{value:i});a&&n.push(a.count),e.filter[r].options=o[t.type]}}));var r=Math.min.apply(null,n);e.totalPage=Math.ceil(r/t)}))}function r(){var t={batch_unit_id:e.batchUnitId};return l.a.each(e.filter,(function(e){e.value&&(t[e.type]=e.value)})),t}function a(){var t=n["a"].defer();if(e.isAllSelected){var o=r();c.getSelectedProblems(o).then((function(e){t.resolve(e)})).catch((function(e){t.reject(e)}))}else t.reject();return t.promise}function d(t){e.isAllSelected?e.problemList=[]:l.a.each(t,(function(t){var o=l.a.find(e.problemList,{id:t.id});if(o){var n=-1;e.problemList&&(n=e.problemList.indexOf(o)),n>-1&&e.problemList.splice(n,1)}}))}return e.filter=c.initFilter(),e.currPage=0,e.totalPage=0,e.problemList=[],e.isAllSelected=!1,o={model:e,init:function(t,i){var r=n["a"].when();return e.currPage=0,e.problemList=[],e.batchUnitId=t,e.unitName=i,e.currConditon={},1==window.isNeedClearAllData&&(e.filter=c.initFilter(),window.isNeedClearAllData=!1),null==window.take_photo_when_review&&r.then((function(){return s["a"].getReviewPhotoSetting()})),r.then((function(){return o.load(0)}))},load:function(t){if(t&&t==e.currPage)return n["a"].resolve();var o=r();return i(),c.getProblems(t,o,e.unitName).then((function(t){return e.isAllSelected&&t.forEach((function(e){e.checked=!0})),n["a"].resolve(t)})).then((function(o){return e.problemList=t?e.problemList.concat(o):o,e.currPage=t,n["a"].resolve(!0)}))},passProblems:function(e){var t=n["a"].defer(),o=function(e){c.passProblems(e).then((function(){d(e),t.resolve()})).catch((function(e){t.reject(e)}))};return e?o(e):a().then(o),t.promise},updateProblem:function(t){var o=l.a.find(e.problemList,{id:t});return o?c.getListInfoById(t,e.unitName).then((function(t){if(!l.a.isEmpty(t)){if(""!=e.filter[0].value&&o.status!=t.status){var n=e.problemList.indexOf(o);n>-1&&e.problemList.splice(n,1)}else o=l.a.extend(o,t);i(),$rootScope.$$phase||$rootScope.$digest()}})):n["a"].resolve()}}};t["a"]=m()},f97d:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAADa0lEQVRYR9WZO2hUQRSG/zN7MYRgkRhEURRMoYKNGtGsEkj2TlLYCGrwVVn4IoplLIQFCy1FxaiFlQ+MKWwsNnNvAqIbwVehoCkUFEXRmBQh+GB3jhy9G9Y1utnNRscptpmdM989Z85jzhDKGMlkUjU1Na3xPK+FmVcz81Iims/Ms0UcEY0x81siGiKiB5lMZmBwcPBeMpm0pW5HpSwIw3CBtbaTmXcR0cJS1jLzayK6pJQ6k0gk3kx17ZQAgyCYw8zHAOwGUBUJfwEgBeA2gKdE9GpkZGRM5urq6mYz8yIAywFsANAOYEm07guAi0R01Pf9j8VAiwIGQbCNmU8DqAeQBdATaSFdTHj+fBiGcdE+gA4AMQDDRNTp+/61P8n5LeDAwICXyWQEbF90rkw2mz3U3t7+rBSwwv+mUqllsVjsFDPraO6c53kHW1paMpPJnRQwnU5Xj4+PXwewkYg+ATjs+/6F6YAVrg2CYA+Ak8xcDeBmTU3N1ng8Lnv9NH4BjDR3Q+AAvGfmjW1tbfcrCZeT1dfX10hENwHMFUjP8zYVavIXQGNMd2TW97FYrLm1tXVoJuByMvv7+5dms9lbEeQ5rfX+/P1+Aowc4qqY1VrbPFOaK/xg0aRS6paYm4i25TvOBGAUSsQB6olob6XPXDEryJlk5vORdy/LhaAJQGPMWQD7icj4vt9WTOBMzAdB0Bd5d7fW+sD36CE/UYZ4DsCz1q6YbigpF15CkFLqCYCMUqpBMs53QGPMcQBdAK5qrXeUu0El1hljrgDYDuCE1voISeKPx+MvJbcqpdYnEomSMkQloCbJOHckd6fT6cWUSqXWKqXuAnihtW6o9IblyDPGyHFbYq1dR2EYdllrxcQTB7McoZVck3NYpdQRMsb0AtgMYKfWWuz/z4cxRvzgMhH1CuBjACsArNJaP/rndD+cdiWAhwCeUBAEH5hZgnP9VOqzv/EBUdKQcmxYNPhZitDR0dGqjo6Or38DoNgePT09s2pra6Ww/eI+4P9gYped5LE4yXVm3uJsmHE+UDuf6pwvFpwvt/6LgjXSorslvwA6f2mKIKUP4+a1M5fAnb64C6TzrQ+BdLp5lDO10+23/ILS2QZmAaS7LeCCS7WbTfTCO0T+M4S1thGAPEPMK3iGeAdgSCl1fzrPEN8Ajn19wtuO19cAAAAASUVORK5CYII="},fa1b:function(e,t,o){"use strict";var n=o("1834");t["a"]={getCheckItemList:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=[e],a="select bc.item_id, ci.full_name as item_full_name  from batch_checkitem bc  inner join check_item ci on ci.id = bc.item_id  where bc.batch_id = ? ";if(a+=t?" and ci.is_for_rough = 1 ":" and ci.is_for_decorated = 1 ",o){var c=i?"project_position_checkitem":"position_checkitem";a+=" and bc.item_id in                     (select item_id from "+c+" where position_id = ? )",r.push(o)}return a+=" order by ci.sort ",n["a"].query(a,r)}}}}]);