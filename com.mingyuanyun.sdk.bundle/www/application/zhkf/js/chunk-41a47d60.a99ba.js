(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-41a47d60"],{"0a1d":function(t,e,o){"use strict";o("6d57");var n=o("16ca"),a=o("fd50"),s=o("c6e3"),i=o("a324"),r=o("0523"),l=function(){var t=function(t,e){for(var o=0;o<t.length;o++){var n=t[o],a=!1,s=0,i=!0;if("已交付"!=n.delivery_status){for(var r=0;r<e.length;r++){var l=e[r];l.batch_room_id.toLowerCase()==n.id.toLowerCase()&&(a=!0,["待派单","待指派","待整改"].indexOf(l.status)>-1&&(n.room_status="待整改",i=!1),"已整改"===l.status&&(i=!1,s=1),"已通过"!==l.status&&(i=!1))}i||n.room_status?"待整改"===n.room_status&&(n.has_repaired=s):n.room_status="已整改","交付中"!=n.delivery_status||"暂不收楼"===n.delivery_situation||a&&!i?("待交付"!=n.delivery_status||a&&!i)&&("交付中"!=n.delivery_status||"暂不收楼"!=n.delivery_situation||a&&!i)||(n.room_status="待交付"):n.room_status="已交付"}else n.room_status="已交付"}return t},e=function(e){var o=[s["a"].getUnitFloors(e),s["a"].getUnitRooms(e),i["a"].getProblemListByBatchUnitId(e)];return a["a"].all(o).then((function(o){var n=o[0],a=o[1],s=o[2];return t(a,s),r["a"].buildRoomListData(e,n,a)}))};return{getRoomListByBatchUnit:e}},u=l(),c=function(){var t=function(t,e){for(var o=0;o<t.length;o++){for(var n=t[o],a=!1,s=0,i=!0,r=0;r<e.length;r++){var l=e[r];l.batch_room_id.toLowerCase()==n.id.toLowerCase()&&(a=!0,["待派单","待指派","待整改"].indexOf(l.status)>-1&&(n.room_status="待整改",i=!1),"已整改"===l.status&&(i=!1,s=1),"已通过"!==l.status&&(i=!1))}if(i||n.room_status?"待整改"===n.room_status&&(n.has_repaired=s):n.room_status="已整改",a?i&&("已接待"===n.opening_status?n.room_status="已接待":n.room_status="待接待"):"已接待"===n.opening_status?n.room_status="已接待":n.room_status="待接待",!n.room_status)throw new Error("room_status 赋值为空."+n.id)}return t},e=function(e){var o=[s["a"].getUnitFloors(e),s["a"].getUnitRooms(e),i["a"].getProblemListByBatchUnitId(e)];return a["a"].all(o).then((function(o){var n=o[0],a=o[1],s=o[2];return a=t(a,s),r["a"].buildRoomListData(e,n,a)}))};return{getRoomListByBatchUnit:e}},m=c(),d=function(){var t={simulate:[{name:"全部",key:"all",dot:"",less:0},{name:"待检查",key:"待检查",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已通过",key:"已通过",dot:"green",less:0}],delivery:[{name:"全部",key:"all",dot:"",less:0},{name:"待交付",key:"待交付",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已交付",key:"已交付",dot:"green",less:0}],online_delivery:[{name:"全部",key:"all",dot:"",less:0},{name:"待交付",key:"待交付",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已交付",key:"已交付",dot:"green",less:0}],opening:[{name:"全部",key:"all",dot:"",less:0},{name:"待接待",key:"待接待",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已接待",key:"已接待",dot:"green",less:0}]},e={simulate:n["a"],delivery:u,opening:m,online_delivery:u},o={tabs:[],items:{},lastView:{},status_sel:"全部",status_counter:0,display_rooms:[]};return{model:o,init:function(t,e){return this.model.batchType=t,this.model.unitId=e,this.model.tabs=this.getTabs(t),this.getRoomList(t,e)},updateRoomList:function(){var t=this.model,e=t.batchType,o=t.unitId;this.init(e,o)},getTabs:function(e){return t[e]},tabsInit:function(){var t=this.model.items.unit_list[0].status_counter;this.model.tabs.forEach((function(e){e.less=t[e.key]||0}))},getRoomList:function(t,o){var n=this;return"special_checkitem"===t&&(t="simulate"),e[t]&&e[t].getRoomListByBatchUnit?e[t].getRoomListByBatchUnit(o).then((function(t){n.model.items=t,n.iniRoomData(),n.tabsInit()})):Promise.resolve()},iniRoomData:function(){this.model.items["unit_sel"]=this.model.items.unit_list[0].unit,this.roomStatusClass(),this.model.status_sel=this.model.lastView&&this.model.lastView.status||"全部",this.filterRoomList(),this.model.status_counter=this.model.items.unit_list[0].status_counter},filterRoomList:function(){for(var t=this.model.items.unit_list[0].floor_list,e=[],o=0;o<t.length;o++){for(var n=t[o].room_list,a=[],s=!1,i=0;i<n.length;i++)"全部"!=this.model.status_sel&&n[i].room_status!=this.model.status_sel||(a.push(n[i]),s=!0);s&&e.push({floor:t[o].floor,room_list:a})}this.model.display_rooms=e,console.log(this.model.display_rooms,"------------楼栋数据------------")},roomStatusClass:function(){for(var t=o.items.unit_list,e=0;e<t.length;e++)for(var n=t[e].floor_list,a=0;a<n.length;a++){var s=n[a].room_list;n[a]["floor_show"]=!0;for(var i=0;i<s.length;i++){switch(s[i]["room_show"]=!0,s[i].room_status){case"待检查":s[i]["room_status_class"]="white";break;case"待整改":s[i]["room_status_class"]="red",s[i].has_repaired&&(s[i]["room_status_class"]+=" problem-repaired");break;case"已整改":s[i]["room_status_class"]="blue";break;case"已通过":case"已接待":case"已交付":s[i]["room_status_class"]="green";break;default:s[i]["room_status_class"]="white";break}s[i]["room_info"]=JSON.stringify({building_name:s[i].building_name,unit:s[i].unit,floor:s[i].floor,room_no:s[i].room_no})}}}}};e["a"]=d()},"16ca":function(t,e,o){"use strict";var n=o("fd50"),a=o("c6e3"),s=o("a324"),i=o("0523"),r=o("07a4"),l=o("af4c"),u=function(t,e){for(var o=0;o<e.length;o++){var n=e[o];if(n.batch_room_id.toLowerCase()==t.toLowerCase())return!1}return!0},c=function(t,e){for(var o=0;o<t.length;o++){var n=t[o];if(0!=n.has_problem||0!=n.is_checked)if(u(n.id,e))t[o].room_status="已通过";else{for(var a=!0,s=0,i=0;i<e.length;i++){var r=e[i];if(n.id.toLowerCase()==r.batch_room_id.toLowerCase()){var l=["待派单","待指派","待整改"];l.indexOf(r.status)>-1&&(n.room_status="待整改",a=!1),"已整改"===r.status&&(a=!1,s=1)}}a?n.room_status="已通过":n.room_status?"待整改"===n.room_status&&(n.has_repaired=s):n.room_status="已整改"}else t[o].room_status="待检查"}return t},m=function(t){var e=[a["a"].getUnitFloors(t),a["a"].getUnitRooms(t),s["a"].getProblemListByBatchUnitId(t)];return n["a"].all(e).then((function(e){var o=e[0],n=e[1],a=e[2];return c(n,a),i["a"].buildRoomListData(t,o,n)}))};e["a"]={getRoomListByBatchUnit:m,updateCheckStatus:function(t){return a["a"].getRoomCheckStatus(t).then((function(t){t=t||{};var e=!t["is_checked"]||!t["check_date"]||!t["check_engineer"];return a["a"].updateCheckStatus(t,e)})).then((function(){"todo"===r["a"].state.app.global.currentMenuType&&l["a"].updateRoomList(!0)}))}}},"425e":function(t,e,o){e=t.exports=o("690e")(!1),e.push([t.i,"\n.zhkf .problem-close .content[data-v-92d4f890] {\n  background: #fff;\n}\n.zhkf .problem-close .content .reason-list[data-v-92d4f890] {\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n.zhkf .problem-close .footer[data-v-92d4f890] {\n  width: 100%;\n  text-align: center;\n  padding: 20px 15px;\n}\n.zhkf .problem-close .footer .btn[data-v-92d4f890] {\n    display: inline-block;\n    width: 100%;\n    height: 45px;\n    color: #fff;\n    font-size: 16px;\n    line-height: 45px;\n    text-align: center;\n    background: -webkit-gradient(linear, left top, right top, from(#1cb0fd), to(#0099ff));\n    background: linear-gradient(90deg, #1cb0fd 0%, #0099ff 100%);\n    -webkit-box-shadow: 0px 2px 4px 0px rgba(0, 153, 255, 0.27);\n            box-shadow: 0px 2px 4px 0px rgba(0, 153, 255, 0.27);\n    border-radius: 4px;\n}\n.zhkf .problem-close .active[data-v-92d4f890] {\n  color: #0085ff;\n}\n",""])},"580b":function(t,e,o){"use strict";o.r(e);o("cc57");var n=o("bdbb"),a=o("265f"),s=o("db99"),i=o("a9ec"),r=o("0a1d"),l=o("964e"),u=o("a14a"),c=o.n(u),m={name:"ProblemCancel",components:{textBox:n["a"]},data:function(){return{closeReasons:[{name:"与业主协商后,无需修复",selected:!1},{name:"无法与业主达成一致",selected:!1},{name:"其他",selected:!1}],model:{other_reason:""},closeReasonText:"",currReasonIndex:null,selectReasonType:""}},created:function(){if(console.log("xxx",a["a"].getProblemMemorySetting("close")),1==a["a"].getProblemMemorySetting("close")){var t=a["a"].getProblemMemoryData("close");console.log(t),c.a.isEmpty(t)||(this.selectReason(this.closeReasons[t.reason]),this.model.other_reason=t.remark||"")}},methods:{updateRemark:function(t){console.log(t),this.model.other_reason=t},selectReason:function(t){for(var e=0;e<this.closeReasons.length;e++)this.closeReasons[e].selected=!1;t.selected=!0,this.currReasonIndex=c.a.indexOf(this.closeReasons,t),"其他"!=t.name?this.closeReasonText=t.name:this.closeReasonText="",this.selectReasonType=t.name},closeProblem:function(){var t=this;if("其他"==this.selectReasonType&&(this.closeReasonText=this.model.other_reason||"",!this.closeReasonText.trim()))return this.$toast("请填写补充说明"),!1;if(!this.closeReasonText.trim())return this.$toast("请选择关闭原因"),!1;console.log(this.closeReasonText);var e=this.$route.query,o={problem_id:e.question_id,batch_room_id:e.batch_room_id,close_reason:this.closeReasonText},n=l["a"].abnormalCloseProblem(o);n.then((function(){t.$toast("问题已关闭"),s["a"].updateProblem(e.question_id),i["a"].init(),r["a"].init(e.type,e.batch_unit_id),a["a"].setProblemMemoryData("close",{reason:t.currReasonIndex,remark:t.model.other_reason||""}),t.$router.go(-2)}),(function(e){t.$toast(e)}))}}},d=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"problem-close"},[o("cus-nav-bar",{attrs:{title:"选择关闭原因","left-arrow":"",border:!1}}),t._v(" "),o("div",{staticClass:"content"},[o("div",{staticClass:"reason-list van-hairline--bottom"},t._l(t.closeReasons,(function(e,n){return o("van-cell",{key:n,class:{active:e.selected},attrs:{title:e.name},on:{click:function(o){return t.selectReason(e)}}},[e.selected?o("template",{slot:"right-icon"},[o("i",{staticClass:"iconfont icon-gou"})]):t._e()],2)})),1),t._v(" "),o("text-box",{attrs:{remark:t.model.other_reason,placeholder:"补充说明"},on:{input:t.updateRemark}})],1),t._v(" "),o("div",{staticClass:"footer"},[o("div",{staticClass:"btn",on:{click:t.closeProblem}},[t._v("确认")])])],1)},f=[],h=o("d082");function _(t){o("f323")}var p=!1,b=_,v="data-v-92d4f890",g=null,y=Object(h["a"])(m,d,f,p,b,v,g);e["default"]=y.exports},"77a8":function(t,e,o){"use strict";o("6d57");function n(){var t={list:[]};return{model:t,init:function(){t.list=[{key:"status",value:"常用状态",name:"常用状态",displayName:"所有状态",list:[{name:"常用状态",value:"常用状态"},{name:"所有状态",value:""}]},{key:"position",value:"",name:"全部",displayName:"部位",list:[]},{key:"checkItem",value:"",name:"全部",displayName:"检查项",list:[]}]},update:function(e){t.list.forEach((function(t){e[t.key]&&(t.list=e[t.key])}))},getCondition:function(){var e={};return t.list.forEach((function(t){e[t.key]=t.value})),e},resetCheckItemValue:function(){t.list.forEach((function(t){"checkItem"===t.key&&(t.value="",t.name="全部")}))}}}e["a"]=n()},a9ec:function(t,e,o){"use strict";o("6d57");var n=o("a593"),a=o("3fa2"),s=o("d485"),i=o("9af1"),r=o("77a8");function l(){var t={},e={problemList:[],buttons:[]},o={},l="tab-icon1",u={"待派单":"tab-icon5","待整改":"tab-icon2","已整改":"tab-icon3","已通过":"tab-icon4","已作废":"tab-icon6","非正常关闭":"tab-icon7"},c=a["a"].room;return o.iniStatusStyle=function(){e.problemList.forEach((function(t){u[t.status]?t.status_style=u[t.status]:t.status_style=l}))},o.initFilter=function(){return s["a"].getPositionList(c.batchRoomId).then((function(t){e.filterList.position.list=t}))},o.getCondition=function(){var t={};_.each(e.filterList,(function(e,o){t[o]=e.value}))},o.getProblemPoints=function(){n["default"].prototype.$eventBus.$emit("app.roomdetail:updateProblemPoints",e.problemList)},t={model:e,init:function(){return s["a"].getProblemList(c.batchRoomId,0,1,!0).then((function(t){e.problemList=t,o.iniStatusStyle()})).then((function(){return console.log("fromType------",c.fromType),i["a"].getDefaultFilterList(e.problemList,c.batchRoomId,c.fromType).then((function(t){r["a"].update(t),console.log("filters---------",t),o.getProblemPoints()}))})).then((function(){if(!_.isEmpty(r["a"].model.list))return t.updateProblemList()}))},updateProblemList:function(t){var n=r["a"].getCondition();i["a"].hideProblemByFilter(e.problemList,r["a"].model.list,n,t),o.getProblemPoints()}},t}e["a"]=l()},db99:function(t,e,o){"use strict";o("6d57"),o("e697");var n=o("fd50"),a=(o("cc57"),o("9a33"),o("a324")),s=o("760e"),i=function(){var t=20,e={},o={},i={};return e={batch_unit_id:"cp.batch_unit_id",status:"cp.status",floor:"br.floor",item:"ci.id",user:"u.id"},o.formatData=function(t,e){var o=[],n=[];return _.each(t,(function(t){var a={};t.desc_id=t.desc_id.split(";"),_.each(t.desc_id,(function(t){o.indexOf(t)<0&&o.push(t)})),-1==t.floor.indexOf("层")&&-1==t.floor.indexOf("楼")&&-1==t.floor.indexOf("公共区域")&&(t.floor=t.floor+"楼"),a.id=t.id,a.code=t.code,a.batchRoomId=t.batch_room_id,a.batchUnitId=t.batch_unit_id,a.registerUserName=t.regist_user_name,a.roomtypeDiagramId=t.roomtype_diagram_id,a.status=t.status,a.roomName=e+"-"+t.floor+"-"+t.room_no,a.dealTime=t.deal_time&&"00-00-00 00:00:00"!==t.deal_time?t.deal_time:"",a.emergence=t.emergency_degree&&t.emergency_degree.indexOf("急")>-1?t.emergency_degree:"",a.sendBackTimes=t.sent_back_time||0,a.positionName=t.position,a.itemName=t.item,a.contractor=t.contractor||"",a.desc=t.desc_id,n.push(a)})),s["a"].getDescByIds(o).then((function(t){return _.each(n,(function(e){_.each(e.desc,(function(o,n){var a=_.find(t,{id:o});e.desc[n]=a?a.name:"无描述"})),e.desc=e.desc.join("、")})),n}))},o.getFilter=function(t,e){var o={status:a["a"].getCountOfProblemStatus,floor:a["a"].getCountOfFloor,item:a["a"].getCountOfCheckItem,user:a["a"].getCountOfRegister};return o[t](e)},i.createCondition=function(t,o){if(_.isEmpty(t))return"";"batch_unit_id"==o&&(o="");var n=[];return _.each(t,(function(t,a){e[a]&&a!==o&&n.push(e[a]+'="'+t+'"')})),n.join(" and ")},i.initFilter=function(){var t=[{type:"status",title:"问题状态",name:"",value:"",options:[]},{type:"floor",title:"楼层",name:"",value:"",options:[]},{type:"item",title:"检查项",name:"",value:"",options:[]},{type:"user",title:"登记人",name:"",value:"",options:[]}];return t},i.getProblems=function(e,s,r){var l=i.createCondition(s);return a["a"].getAllProblemListByPage(l,e,t).then((function(t){return!t||_.isEmpty(t)?[]:o.formatData(t,r)})).catch((function(t){return n["a"].reject(t)}))},i.getFilterCount=function(t){t=t||{};var a,s="",r={},l=[];return _.each(e,(function(e,n){"batch_unit_id"!==n&&(s=i.createCondition(t,n),a=o.getFilter(n,s).then((function(t){return{type:n,res:t}})),l.push(a))})),n["a"].all(l).then((function(t){return _.each(t,(function(t){if(t){var e=[],o=0;_.each(t.res,(function(t){e.push({count:t.count,name:t.name||t.title,value:t.value}),o+=t.count})),e.unshift({value:"",name:"全部",count:o}),r[t.type]=e}})),r}))},i.getSelectedProblems=function(t){var e=i.createCondition(t);return a["a"].getSelectedProblems(e)},i.passProblems=function(t){var e=[];return t.forEach((function(t){e.push(a["a"].passProblem(t.id,t.batchRoomId))})),n["a"].all(e)},i.getListInfoById=function(t,e){return a["a"].getListInfoById(t).then((function(t){return o.formatData([t],e).then((function(t){return t.shift()}))})).catch((function(t){return n["a"].reject(t)}))},i},r=i(),l=o("9072"),u=o("a14a"),c=o.n(u),m=function(){var t={},e=20,o={};function a(){c.a.isEmpty(t.filter)&&(t.filter=r.initFilter());var o=s(),n=[],a="";return r.getFilterCount(o).then((function(o){c.a.each(t.filter,(function(e,s){if(a=t.filter[s].value||"",e&&o[e.type]){var i=c.a.find(o[e.type],{value:a});i&&n.push(i.count),t.filter[s].options=o[e.type]}}));var s=Math.min.apply(null,n);t.totalPage=Math.ceil(s/e)}))}function s(){var e={batch_unit_id:t.batchUnitId};return c.a.each(t.filter,(function(t){t.value&&(e[t.type]=t.value)})),e}function i(){var e=n["a"].defer();if(t.isAllSelected){var o=s();r.getSelectedProblems(o).then((function(t){e.resolve(t)})).catch((function(t){e.reject(t)}))}else e.reject();return e.promise}function u(e){t.isAllSelected?t.problemList=[]:c.a.each(e,(function(e){var o=c.a.find(t.problemList,{id:e.id});if(o){var n=-1;t.problemList&&(n=t.problemList.indexOf(o)),n>-1&&t.problemList.splice(n,1)}}))}return t.filter=r.initFilter(),t.currPage=0,t.totalPage=0,t.problemList=[],t.isAllSelected=!1,o={model:t,init:function(e,a){var s=n["a"].when();return t.currPage=0,t.problemList=[],t.batchUnitId=e,t.unitName=a,t.currConditon={},1==window.isNeedClearAllData&&(t.filter=r.initFilter(),window.isNeedClearAllData=!1),null==window.take_photo_when_review&&s.then((function(){return l["a"].getReviewPhotoSetting()})),s.then((function(){return o.load(0)}))},load:function(e){if(e&&e==t.currPage)return n["a"].resolve();var o=s();return a(),r.getProblems(e,o,t.unitName).then((function(e){return t.isAllSelected&&e.forEach((function(t){t.checked=!0})),n["a"].resolve(e)})).then((function(o){return t.problemList=e?t.problemList.concat(o):o,t.currPage=e,n["a"].resolve(!0)}))},passProblems:function(t){var e=n["a"].defer(),o=function(t){r.passProblems(t).then((function(){u(t),e.resolve()})).catch((function(t){e.reject(t)}))};return t?o(t):i().then(o),e.promise},updateProblem:function(e){var o=c.a.find(t.problemList,{id:e});return o?r.getListInfoById(e,t.unitName).then((function(e){if(!c.a.isEmpty(e)){if(""!=t.filter[0].value&&o.status!=e.status){var n=t.problemList.indexOf(o);n>-1&&t.problemList.splice(n,1)}else o=c.a.extend(o,e);a(),$rootScope.$$phase||$rootScope.$digest()}})):n["a"].resolve()}}};e["a"]=m()},f323:function(t,e,o){var n=o("425e");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=o("85cb").default;a("0eaaf91f",n,!0,{})}}]);