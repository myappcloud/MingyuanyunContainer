(window["webpackJsonp_module_entry_zhkf_"]=window["webpackJsonp_module_entry_zhkf_"]||[]).push([["chunk-c5779716"],{"0a1d":function(t,e,o){"use strict";o("6d57");var n=o("16ca"),r=o("fd50"),i=o("c6e3"),a=o("a324"),s=o("0523"),c=function(){var t=function(t,e){for(var o=0;o<t.length;o++){var n=t[o],r=!1,i=0,a=!0;if("已交付"!=n.delivery_status){for(var s=0;s<e.length;s++){var c=e[s];c.batch_room_id.toLowerCase()==n.id.toLowerCase()&&(r=!0,["待派单","待指派","待整改"].indexOf(c.status)>-1&&(n.room_status="待整改",a=!1),"已整改"===c.status&&(a=!1,i=1),"已通过"!==c.status&&(a=!1))}a||n.room_status?"待整改"===n.room_status&&(n.has_repaired=i):n.room_status="已整改","交付中"!=n.delivery_status||"暂不收楼"===n.delivery_situation||r&&!a?("待交付"!=n.delivery_status||r&&!a)&&("交付中"!=n.delivery_status||"暂不收楼"!=n.delivery_situation||r&&!a)||(n.room_status="待交付"):n.room_status="已交付"}else n.room_status="已交付"}return t},e=function(e){var o=[i["a"].getUnitFloors(e),i["a"].getUnitRooms(e),a["a"].getProblemListByBatchUnitId(e)];return r["a"].all(o).then((function(o){var n=o[0],r=o[1],i=o[2];return t(r,i),s["a"].buildRoomListData(e,n,r)}))};return{getRoomListByBatchUnit:e}},u=c(),l=function(){var t=function(t,e){for(var o=0;o<t.length;o++){for(var n=t[o],r=!1,i=0,a=!0,s=0;s<e.length;s++){var c=e[s];c.batch_room_id.toLowerCase()==n.id.toLowerCase()&&(r=!0,["待派单","待指派","待整改"].indexOf(c.status)>-1&&(n.room_status="待整改",a=!1),"已整改"===c.status&&(a=!1,i=1),"已通过"!==c.status&&(a=!1))}if(a||n.room_status?"待整改"===n.room_status&&(n.has_repaired=i):n.room_status="已整改",r?a&&("已接待"===n.opening_status?n.room_status="已接待":n.room_status="待接待"):"已接待"===n.opening_status?n.room_status="已接待":n.room_status="待接待",!n.room_status)throw new Error("room_status 赋值为空."+n.id)}return t},e=function(e){var o=[i["a"].getUnitFloors(e),i["a"].getUnitRooms(e),a["a"].getProblemListByBatchUnitId(e)];return r["a"].all(o).then((function(o){var n=o[0],r=o[1],i=o[2];return r=t(r,i),s["a"].buildRoomListData(e,n,r)}))};return{getRoomListByBatchUnit:e}},m=l(),f=function(){var t={simulate:[{name:"全部",key:"all",dot:"",less:0},{name:"待检查",key:"待检查",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已通过",key:"已通过",dot:"green",less:0}],delivery:[{name:"全部",key:"all",dot:"",less:0},{name:"待交付",key:"待交付",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已交付",key:"已交付",dot:"green",less:0}],online_delivery:[{name:"全部",key:"all",dot:"",less:0},{name:"待交付",key:"待交付",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已交付",key:"已交付",dot:"green",less:0}],opening:[{name:"全部",key:"all",dot:"",less:0},{name:"待接待",key:"待接待",dot:"white",less:0},{name:"待整改",key:"待整改",dot:"red",less:0},{name:"已整改",key:"已整改",dot:"blue",less:0},{name:"已接待",key:"已接待",dot:"green",less:0}]},e={simulate:n["a"],delivery:u,opening:m,online_delivery:u},o={tabs:[],items:{},lastView:{},status_sel:"全部",status_counter:0,display_rooms:[]};return{model:o,init:function(t,e){return this.model.batchType=t,this.model.unitId=e,this.model.tabs=this.getTabs(t),this.getRoomList(t,e)},updateRoomList:function(){var t=this.model,e=t.batchType,o=t.unitId;this.init(e,o)},getTabs:function(e){return t[e]},tabsInit:function(){var t=this.model.items.unit_list[0].status_counter;this.model.tabs.forEach((function(e){e.less=t[e.key]||0}))},getRoomList:function(t,o){var n=this;return"special_checkitem"===t&&(t="simulate"),e[t]&&e[t].getRoomListByBatchUnit?e[t].getRoomListByBatchUnit(o).then((function(t){n.model.items=t,n.iniRoomData(),n.tabsInit()})):Promise.resolve()},iniRoomData:function(){this.model.items["unit_sel"]=this.model.items.unit_list[0].unit,this.roomStatusClass(),this.model.status_sel=this.model.lastView&&this.model.lastView.status||"全部",this.filterRoomList(),this.model.status_counter=this.model.items.unit_list[0].status_counter},filterRoomList:function(){for(var t=this.model.items.unit_list[0].floor_list,e=[],o=0;o<t.length;o++){for(var n=t[o].room_list,r=[],i=!1,a=0;a<n.length;a++)"全部"!=this.model.status_sel&&n[a].room_status!=this.model.status_sel||(r.push(n[a]),i=!0);i&&e.push({floor:t[o].floor,room_list:r})}this.model.display_rooms=e,console.log(this.model.display_rooms,"------------楼栋数据------------")},roomStatusClass:function(){for(var t=o.items.unit_list,e=0;e<t.length;e++)for(var n=t[e].floor_list,r=0;r<n.length;r++){var i=n[r].room_list;n[r]["floor_show"]=!0;for(var a=0;a<i.length;a++){switch(i[a]["room_show"]=!0,i[a].room_status){case"待检查":i[a]["room_status_class"]="white";break;case"待整改":i[a]["room_status_class"]="red",i[a].has_repaired&&(i[a]["room_status_class"]+=" problem-repaired");break;case"已整改":i[a]["room_status_class"]="blue";break;case"已通过":case"已接待":case"已交付":i[a]["room_status_class"]="green";break;default:i[a]["room_status_class"]="white";break}i[a]["room_info"]=JSON.stringify({building_name:i[a].building_name,unit:i[a].unit,floor:i[a].floor,room_no:i[a].room_no})}}}}};e["a"]=f()},"16ca":function(t,e,o){"use strict";var n=o("fd50"),r=o("c6e3"),i=o("a324"),a=o("0523"),s=o("07a4"),c=o("af4c"),u=function(t,e){for(var o=0;o<e.length;o++){var n=e[o];if(n.batch_room_id.toLowerCase()==t.toLowerCase())return!1}return!0},l=function(t,e){for(var o=0;o<t.length;o++){var n=t[o];if(0!=n.has_problem||0!=n.is_checked)if(u(n.id,e))t[o].room_status="已通过";else{for(var r=!0,i=0,a=0;a<e.length;a++){var s=e[a];if(n.id.toLowerCase()==s.batch_room_id.toLowerCase()){var c=["待派单","待指派","待整改"];c.indexOf(s.status)>-1&&(n.room_status="待整改",r=!1),"已整改"===s.status&&(r=!1,i=1)}}r?n.room_status="已通过":n.room_status?"待整改"===n.room_status&&(n.has_repaired=i):n.room_status="已整改"}else t[o].room_status="待检查"}return t},m=function(t){var e=[r["a"].getUnitFloors(t),r["a"].getUnitRooms(t),i["a"].getProblemListByBatchUnitId(t)];return n["a"].all(e).then((function(e){var o=e[0],n=e[1],r=e[2];return l(n,r),a["a"].buildRoomListData(t,o,n)}))};e["a"]={getRoomListByBatchUnit:m,updateCheckStatus:function(t){return r["a"].getRoomCheckStatus(t).then((function(t){t=t||{};var e=!t["is_checked"]||!t["check_date"]||!t["check_engineer"];return r["a"].updateCheckStatus(t,e)})).then((function(){"todo"===s["a"].state.app.global.currentMenuType&&c["a"].updateRoomList(!0)}))}}},"2d95":function(t,e,o){"use strict";o.r(e);o("5ab2"),o("e44b"),o("e10e"),o("cc57"),o("e204"),o("6d57");var n=o("28f8"),r=o("bdbb"),i=o("265f"),a=o("a324"),s=o("db99"),c=o("a9ec"),u=o("0a1d"),l=o("a14a"),m=o.n(l),f=o("f2de");function d(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function h(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?d(Object(o),!0).forEach((function(e){Object(n["a"])(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var p="",b=null,g={name:"ProblemCancel",components:{textBox:r["a"]},data:function(){var t=[{name:"问题登记错误",selected:!1},{name:"问题不存在",selected:!1},{name:"其他",selected:!1}];return{cancelReasons:t,remark:"",cancelReasonText:""}},computed:h({},Object(f["e"])({currentMenuType:function(t){return t.app.global.currentMenuType}})),created:function(){if(p="",b=null,console.log("作废问题"),1==i["a"].getProblemMemorySetting("cancel")){var t=i["a"].getProblemMemoryData("cancel");m.a.isEmpty(t)||(this.selectReason(this.cancelReasons[t.reason]),this.remark=t.remark||"")}},methods:{updateRemark:function(t){this.remark=t},selectReason:function(t){this.cancelReasons.forEach((function(t){t.selected=!1})),t.selected=!0,b=m.a.findIndex(this.cancelReasons,{name:t.name}),"其他"!=t.name?this.cancelReasonText=t.name:this.cancelReasonText="",p=t.name},cancelProblem:function(){var t=this;if(""===p)return this.$toast("请选择作废原因"),!1;if("其他"==p&&(this.cancelReasonText=this.remark||""),!this.cancelReasonText.trim())return this.$toast("请填写补充说明"),!1;var e=this.$route.query;console.log(this.cancelReasonText,"======cancelReasonText====="),a["a"].cancelProblem(e.problemId,e.batchRoomId,this.cancelReasonText).then((function(){t.$toast("问题已作废"),console.log("作废问题"),s["a"].updateProblem(e.problemId),c["a"].init(),"todo"!=t.currentMenuType&&u["a"].updateRoomList(),i["a"].setProblemMemoryData("cancel",{reason:b,remark:t.remark||""}),t.$router.go(-2)}),(function(e){t.$toash(e)}))}}},_=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"problem-cancel"},[o("cus-nav-bar",{attrs:{title:"选择作废原因","left-arrow":"",border:!1}}),t._v(" "),o("div",{staticClass:"content"},[o("div",{staticClass:"reason-list van-hairline--bottom"},t._l(t.cancelReasons,(function(e,n){return o("van-cell",{key:n,class:{active:e.selected},attrs:{title:e.name},on:{click:function(o){return t.selectReason(e)}}},[e.selected?o("template",{slot:"right-icon"},[o("i",{staticClass:"iconfont icon-gou"})]):t._e()],2)})),1),t._v(" "),o("text-box",{attrs:{remark:t.remark,placeholder:"补充说明"},on:{input:t.updateRemark}})],1),t._v(" "),o("div",{staticClass:"footer"},[o("div",{staticClass:"btn",on:{click:t.cancelProblem}},[t._v("\n      确认\n    ")])])],1)},v=[],y=o("d082");function k(t){o("e3038")}var L=!1,R=k,I="data-v-1f939f12",P=null,w=Object(y["a"])(g,_,v,L,R,I,P);e["default"]=w.exports},"43ee":function(t,e,o){"use strict";o("c904");var n=o("fd50"),r=o("a14a"),i=o.n(r),a=o("d49d"),s=function(){var t={unitId:"",list:[],currRoom:{}},e={getRoomList:function(){return a["a"].getRoomList(t.unitId).then((function(e){var o=[];if(console.log(e),e){var n=i.a.groupBy(e,"floor");console.log(n),i.a.each(n,(function(t,e){var n={};n.floor=e,n.roomList=[],n.no=e,console.log(t),i.a.each(t,(function(t){n.roomList.push({id:t.id,room_no:t.room_no,count:t.count})})),n.roomList=n.roomList.sort((function(t,e){return e.room_no-t.room_no})),o.push(n)})),o=o.sort((function(t,e){return e.no-t.no})),t.list=o}}))}};return{model:t,initRoomList:function(o,r){return o||t.unitId?(t.list=[],o&&(t.unitId=o),r&&(t.currRoom={}),e.getRoomList()):n["a"].reject("无效的单元")},refresh:function(){return e.getRoomList()},checkHasUpload:function(t){return a["a"].checkHasUpload(t)}}};e["a"]=s()},"77a8":function(t,e,o){"use strict";o("6d57");function n(){var t={list:[]};return{model:t,init:function(){t.list=[{key:"status",value:"常用状态",name:"常用状态",displayName:"所有状态",list:[{name:"常用状态",value:"常用状态"},{name:"所有状态",value:""}]},{key:"position",value:"",name:"全部",displayName:"部位",list:[]},{key:"checkItem",value:"",name:"全部",displayName:"检查项",list:[]}]},update:function(e){t.list.forEach((function(t){e[t.key]&&(t.list=e[t.key])}))},getCondition:function(){var e={};return t.list.forEach((function(t){e[t.key]=t.value})),e},resetCheckItemValue:function(){t.list.forEach((function(t){"checkItem"===t.key&&(t.value="",t.name="全部")}))}}}e["a"]=n()},"99ee":function(t,e,o){"use strict";o("c904");var n=o("fd50"),r=o("a14a"),i=o.n(r),a=o("ff29"),s=function(){var t={unitId:"",list:[],currRoom:{}},e={getRoomList:function(){return a["a"].getRoomList(t.unitId).then((function(e){var o=[];if(console.log(e),e){var n=i.a.groupBy(e,"floor");console.log(n),i.a.each(n,(function(t,e){var n={};n.floor=e,n.roomList=[],n.no=e,console.log(t),i.a.each(t,(function(t){n.roomList.push({id:t.id,room_no:t.room_no,count:t.count})})),n.roomList=n.roomList.sort((function(t,e){return e.room_no-t.room_no})),o.push(n)})),o=o.sort((function(t,e){return e.no-t.no})),t.list=o}}))}};return{model:t,initRoomList:function(o,r){return o||t.unitId?(t.list=[],o&&(t.unitId=o),r&&(t.currRoom={}),e.getRoomList()):n["a"].reject("无效的单元")},refresh:function(){return e.getRoomList()},checkHasUpload:function(t){return a["a"].checkHasUpload(t)}}};e["a"]=s()},"9ff4":function(t,e,o){e=t.exports=o("690e")(!1),e.push([t.i,"\n.zhkf .problem-cancel .content[data-v-1f939f12] {\n  background: #fff;\n}\n.zhkf .problem-cancel .footer[data-v-1f939f12] {\n  width: 100%;\n  text-align: center;\n  padding: 20px 15px;\n}\n.zhkf .problem-cancel .footer .btn[data-v-1f939f12] {\n    display: inline-block;\n    width: 100%;\n    height: 45px;\n    color: #fff;\n    font-size: 16px;\n    line-height: 45px;\n    text-align: center;\n    background: -webkit-gradient(linear, left top, right top, from(#1cb0fd), to(#0099ff));\n    background: linear-gradient(90deg, #1cb0fd 0%, #0099ff 100%);\n    -webkit-box-shadow: 0px 2px 4px 0px rgba(0, 153, 255, 0.27);\n            box-shadow: 0px 2px 4px 0px rgba(0, 153, 255, 0.27);\n    border-radius: 4px;\n}\n.zhkf .problem-cancel .active[data-v-1f939f12] {\n  color: #0085ff;\n}\n",""])},a9ec:function(t,e,o){"use strict";o("6d57");var n=o("a593"),r=o("3fa2"),i=o("d485"),a=o("9af1"),s=o("77a8");function c(){var t={},e={problemList:[],buttons:[]},o={},c="tab-icon1",u={"待派单":"tab-icon5","待整改":"tab-icon2","已整改":"tab-icon3","已通过":"tab-icon4","已作废":"tab-icon6","非正常关闭":"tab-icon7"},l=r["a"].room;return o.iniStatusStyle=function(){e.problemList.forEach((function(t){u[t.status]?t.status_style=u[t.status]:t.status_style=c}))},o.initFilter=function(){return i["a"].getPositionList(l.batchRoomId).then((function(t){e.filterList.position.list=t}))},o.getCondition=function(){var t={};_.each(e.filterList,(function(e,o){t[o]=e.value}))},o.getProblemPoints=function(){n["default"].prototype.$eventBus.$emit("app.roomdetail:updateProblemPoints",e.problemList)},t={model:e,init:function(){return i["a"].getProblemList(l.batchRoomId,0,1,!0).then((function(t){e.problemList=t,o.iniStatusStyle()})).then((function(){return console.log("fromType------",l.fromType),a["a"].getDefaultFilterList(e.problemList,l.batchRoomId,l.fromType).then((function(t){s["a"].update(t),console.log("filters---------",t),o.getProblemPoints()}))})).then((function(){if(!_.isEmpty(s["a"].model.list))return t.updateProblemList()}))},updateProblemList:function(t){var n=s["a"].getCondition();a["a"].hideProblemByFilter(e.problemList,s["a"].model.list,n,t),o.getProblemPoints()}},t}e["a"]=c()},af4c:function(t,e,o){"use strict";o("e697");var n=o("fd50"),r=o("a18c"),i=o("99ee"),a=o("43ee"),s=o("a14a"),c=o.n(s),u=o("c6e3"),l=function(){return{getNotCheckFloorAndRoom:function(t,e){return n["a"].all([u["a"].getTodoUnitFloors(t),u["a"].getTodoRoomByUnitId(t,e)]).then((function(t){var e,o=t[0],n=t[1],r="0";(c.a.isEmpty(o)||1===o.length&&""===o[0].floor)&&(e=!0,o=[{floor:r}]);for(var i=0;i<o.length;i++){o[i].roomList=[];for(var a=0;a<n.length;a++)(e||n[a].floor===o[i].floor)&&(n[a].floor=e?r:n[a].floor,o[i].roomList.push(n[a]))}return c.a.filter(o,(function(t){return t.roomList&&t.roomList.length>0}))}))},checkHasUpload:function(t,e){return u["a"].checkHasUpload(t,e).then((function(t){return t&&!!t["id"]}))},getRoomInfo:function(t,e){return u["a"].getTodoBatchRoomById(t,e)}}},m=l(),f=function(){var t={floorList:[]},e={},o={special_checkitem:"检查",simulate:"检查",opening:"接待",online_opening:"拍摄",feedback_remain_reply:"回复",delivery:"交付",online_delivery:"交付",problem_remain_reinspect:"复验"};return e.init=function(o,r,i){return i=i||!1,i||o!==t.batchUnitId||r!==t.moduleType?(t.floorList=[],t.batchUnitId=o,t.moduleType=r,t.currRoom=null,t.currFloor=null,t.tip="",e.getRoomList().then((function(e){console.log(e,"floorlist-----"),t.floorList=e}))):n["a"].resolve()},e.getRoomList=function(){return"problem_remain_reinspect"===t.moduleType?e.getReinspectRoomList():"feedback_remain_reply"===t.moduleType?e.getReplyRoomList():e.getCheckRoomList()},e.getCheckRoomList=function(){return m.getNotCheckFloorAndRoom(t.batchUnitId,t.moduleType).then((function(e){return c.a.isEmpty(e)&&m.checkHasUpload(t.batchUnitId,t.moduleType).then((function(e){e&&(t.tip="您已经"+o[t.moduleType]+"完毕，请立即上传~")})),e}))},e.getReinspectRoomList=function(){return i["a"].initRoomList(t.batchUnitId).then((function(){return c.a.isEmpty(i["a"].model.list)&&i["a"].checkHasUpload(t.batchUnitId).then((function(e){e&&(t.tip="您已经"+o[t.moduleType]+"完毕，请立即上传~")})),i["a"].model.list}))},e.getReplyRoomList=function(){return a["a"].initRoomList(t.batchUnitId).then((function(){return c.a.isEmpty(a["a"].model.list)&&a["a"].checkHasUpload(t.batchUnitId).then((function(e){e&&(t.tip="您已经"+o[t.moduleType]+"完毕，请立即上传~")})),a["a"].model.list}))},e.getRoomInfo=function(t,e){return m.getRoomInfo(t,e)},e.removeRoom=function(){var o=c.a.find(t.currFloor.roomList,{id:t.currRoom.id}),n=c.a.indexOf(t.currFloor.roomList,o);n>-1&&t.currFloor.roomList.splice(n,1),c.a.isEmpty(t.currFloor.roomList)&&(n=c.a.indexOf(t.floorList,t.currFloor),n>-1&&t.floorList.splice(n,1)),c.a.isEmpty(t.floorList)&&(e.init(t.batchUnitId,t.moduleType,!0),r["a"].go(-2))},{model:t,init:e.init,updateRoomList:function(r){return c.a.isEmpty(t)||!t.moduleType?n["a"].resolve():(r=r||!1,r?e.removeRoom():"problem_remain_reinspect"===t.moduleType?i["a"].refresh().then((function(){c.a.isEmpty(i["a"].model.list)&&i["a"].checkHasUpload(t.batchUnitId).then((function(e){e&&(t.tip="您已经"+o[t.moduleType]+"完毕，请立即上传~")})),t.floorList=i["a"].model.list})):"feedback_remain_reply"!==t.moduleType?e.getRoomInfo(t.currRoom.id,t.moduleType).then((function(o){if(c.a.isEmpty(o)||"已检查"===o.check_status)return e.removeRoom();for(var n=t.currFloor.roomList.length,r=0;r<n;r++)if(t.currFloor.roomList[r].id===o.id){t.currFloor.roomList[r]=o;break}})):(c.a.isEmpty(a["a"].model.list)&&a["a"].checkHasUpload(t.batchUnitId).then((function(e){e&&(t.tip="您已经"+o[t.moduleType]+"完毕，请立即上传~")})),void(t.floorList=a["a"].model.list)))}}};e["a"]=f()},d49d:function(t,e,o){"use strict";var n=o("fd50"),r=o("4325"),i=o("a14a"),a=o.n(i),s=function(){var t={},e={position:r["a"].getPositionFilter,checkItem:r["a"].getCheckItemFilter};return t.getRoomList=function(t){return r["a"].getReplyRooms(t)},t.getFeedbackListByBatchRoomId=function(t,e,o){return t.batchRoomId?r["a"].getFeedbackListByBatchRoomId(t,e,o).then((function(t){return t})):n["a"].reject("获取问题列表失败")},t.getFeedbackFilters=function(t,o){if(!t.batchRoomId)return n["a"].reject();var r=a.a.cloneDeep(e),i=[];return delete r[o],t.position||delete r.checkItem,a.a.each(r,(function(o,n){i.push(function(o){return e[n](t).then((function(t){return{type:o,options:t}}))}(n))})),n["a"].all(i).then((function(t){var e={};return a.a.each(t,(function(t){var o=0;a.a.each(t.options,(function(t){o+=t.count})),t.options.unshift({name:"全部",count:o,id:""}),e[t.type]=t.options})),e}))},t.hasMoreFeedback=function(t){return r["a"].getFeedbackCount(t).then((function(t){return t.count>0}))},t.getAllFeedbackIds=function(t){return r["a"].getAllFeedbackIds(t).then((function(t){return t}))},t.checkHasUpload=function(t){return r["a"].hasUploadData(t).then((function(t){return t&&!!t["id"]}))},t};e["a"]=s()},db99:function(t,e,o){"use strict";o("6d57"),o("e697");var n=o("fd50"),r=(o("cc57"),o("9a33"),o("a324")),i=o("760e"),a=function(){var t=20,e={},o={},a={};return e={batch_unit_id:"cp.batch_unit_id",status:"cp.status",floor:"br.floor",item:"ci.id",user:"u.id"},o.formatData=function(t,e){var o=[],n=[];return _.each(t,(function(t){var r={};t.desc_id=t.desc_id.split(";"),_.each(t.desc_id,(function(t){o.indexOf(t)<0&&o.push(t)})),-1==t.floor.indexOf("层")&&-1==t.floor.indexOf("楼")&&-1==t.floor.indexOf("公共区域")&&(t.floor=t.floor+"楼"),r.id=t.id,r.code=t.code,r.batchRoomId=t.batch_room_id,r.batchUnitId=t.batch_unit_id,r.registerUserName=t.regist_user_name,r.roomtypeDiagramId=t.roomtype_diagram_id,r.status=t.status,r.roomName=e+"-"+t.floor+"-"+t.room_no,r.dealTime=t.deal_time&&"00-00-00 00:00:00"!==t.deal_time?t.deal_time:"",r.emergence=t.emergency_degree&&t.emergency_degree.indexOf("急")>-1?t.emergency_degree:"",r.sendBackTimes=t.sent_back_time||0,r.positionName=t.position,r.itemName=t.item,r.contractor=t.contractor||"",r.desc=t.desc_id,n.push(r)})),i["a"].getDescByIds(o).then((function(t){return _.each(n,(function(e){_.each(e.desc,(function(o,n){var r=_.find(t,{id:o});e.desc[n]=r?r.name:"无描述"})),e.desc=e.desc.join("、")})),n}))},o.getFilter=function(t,e){var o={status:r["a"].getCountOfProblemStatus,floor:r["a"].getCountOfFloor,item:r["a"].getCountOfCheckItem,user:r["a"].getCountOfRegister};return o[t](e)},a.createCondition=function(t,o){if(_.isEmpty(t))return"";"batch_unit_id"==o&&(o="");var n=[];return _.each(t,(function(t,r){e[r]&&r!==o&&n.push(e[r]+'="'+t+'"')})),n.join(" and ")},a.initFilter=function(){var t=[{type:"status",title:"问题状态",name:"",value:"",options:[]},{type:"floor",title:"楼层",name:"",value:"",options:[]},{type:"item",title:"检查项",name:"",value:"",options:[]},{type:"user",title:"登记人",name:"",value:"",options:[]}];return t},a.getProblems=function(e,i,s){var c=a.createCondition(i);return r["a"].getAllProblemListByPage(c,e,t).then((function(t){return!t||_.isEmpty(t)?[]:o.formatData(t,s)})).catch((function(t){return n["a"].reject(t)}))},a.getFilterCount=function(t){t=t||{};var r,i="",s={},c=[];return _.each(e,(function(e,n){"batch_unit_id"!==n&&(i=a.createCondition(t,n),r=o.getFilter(n,i).then((function(t){return{type:n,res:t}})),c.push(r))})),n["a"].all(c).then((function(t){return _.each(t,(function(t){if(t){var e=[],o=0;_.each(t.res,(function(t){e.push({count:t.count,name:t.name||t.title,value:t.value}),o+=t.count})),e.unshift({value:"",name:"全部",count:o}),s[t.type]=e}})),s}))},a.getSelectedProblems=function(t){var e=a.createCondition(t);return r["a"].getSelectedProblems(e)},a.passProblems=function(t){var e=[];return t.forEach((function(t){e.push(r["a"].passProblem(t.id,t.batchRoomId))})),n["a"].all(e)},a.getListInfoById=function(t,e){return r["a"].getListInfoById(t).then((function(t){return o.formatData([t],e).then((function(t){return t.shift()}))})).catch((function(t){return n["a"].reject(t)}))},a},s=a(),c=o("9072"),u=o("a14a"),l=o.n(u),m=function(){var t={},e=20,o={};function r(){l.a.isEmpty(t.filter)&&(t.filter=s.initFilter());var o=i(),n=[],r="";return s.getFilterCount(o).then((function(o){l.a.each(t.filter,(function(e,i){if(r=t.filter[i].value||"",e&&o[e.type]){var a=l.a.find(o[e.type],{value:r});a&&n.push(a.count),t.filter[i].options=o[e.type]}}));var i=Math.min.apply(null,n);t.totalPage=Math.ceil(i/e)}))}function i(){var e={batch_unit_id:t.batchUnitId};return l.a.each(t.filter,(function(t){t.value&&(e[t.type]=t.value)})),e}function a(){var e=n["a"].defer();if(t.isAllSelected){var o=i();s.getSelectedProblems(o).then((function(t){e.resolve(t)})).catch((function(t){e.reject(t)}))}else e.reject();return e.promise}function u(e){t.isAllSelected?t.problemList=[]:l.a.each(e,(function(e){var o=l.a.find(t.problemList,{id:e.id});if(o){var n=-1;t.problemList&&(n=t.problemList.indexOf(o)),n>-1&&t.problemList.splice(n,1)}}))}return t.filter=s.initFilter(),t.currPage=0,t.totalPage=0,t.problemList=[],t.isAllSelected=!1,o={model:t,init:function(e,r){var i=n["a"].when();return t.currPage=0,t.problemList=[],t.batchUnitId=e,t.unitName=r,t.currConditon={},1==window.isNeedClearAllData&&(t.filter=s.initFilter(),window.isNeedClearAllData=!1),null==window.take_photo_when_review&&i.then((function(){return c["a"].getReviewPhotoSetting()})),i.then((function(){return o.load(0)}))},load:function(e){if(e&&e==t.currPage)return n["a"].resolve();var o=i();return r(),s.getProblems(e,o,t.unitName).then((function(e){return t.isAllSelected&&e.forEach((function(t){t.checked=!0})),n["a"].resolve(e)})).then((function(o){return t.problemList=e?t.problemList.concat(o):o,t.currPage=e,n["a"].resolve(!0)}))},passProblems:function(t){var e=n["a"].defer(),o=function(t){s.passProblems(t).then((function(){u(t),e.resolve()})).catch((function(t){e.reject(t)}))};return t?o(t):a().then(o),e.promise},updateProblem:function(e){var o=l.a.find(t.problemList,{id:e});return o?s.getListInfoById(e,t.unitName).then((function(e){if(!l.a.isEmpty(e)){if(""!=t.filter[0].value&&o.status!=e.status){var n=t.problemList.indexOf(o);n>-1&&t.problemList.splice(n,1)}else o=l.a.extend(o,e);r(),$rootScope.$$phase||$rootScope.$digest()}})):n["a"].resolve()}}};e["a"]=m()},e3038:function(t,e,o){var n=o("9ff4");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var r=o("85cb").default;r("c5d87390",n,!0,{})},ff29:function(t,e,o){"use strict";o("cc57"),o("e697"),o("9a33");var n=o("fd50"),r=o("4531"),i=o("760e"),a=o("a14a"),s=o.n(a),c=function(){var t={},e={position:r["a"].getPositionFilter,checkItem:r["a"].getCheckItemFilter,register:r["a"].getRegisterFilter};return t.getRoomList=function(t){return r["a"].getReinspectRooms(t)},t.getProblemListByBatchRoomId=function(t,e,o){return t.batchRoomId?r["a"].getProblemListByBatchRoomId(t,e,o).then((function(t){var e=[];return s.a.each(t,(function(t){t.desc=t.desc_id.split(";"),e=e.concat(t.desc)})),e=s.a.uniq(e),i["a"].getDescByIds(e).then((function(e){return s.a.each(t,(function(t){s.a.each(t.desc,(function(o,n){var r=s.a.find(e,{id:o});t.desc[n]=r?r.name:"无描述"})),t.desc=t.desc.join("；"),t.title=t.problem=t.position_name+"-"+t.item_name+"-"+t.desc+(t.remark?"；"+t.remark:"")})),t}))})):n["a"].reject("获取问题列表失败")},t.getProblemFilters=function(t,o){if(!t.batchRoomId)return n["a"].reject();var r=s.a.cloneDeep(e),i=[];return delete r[o],t.position||delete r.checkItem,s.a.each(r,(function(o,n){i.push(function(o){return e[n](t).then((function(t){return{type:o,options:t}}))}(n))})),n["a"].all(i).then((function(t){var e={};return s.a.each(t,(function(t){var o=0;s.a.each(t.options,(function(t){o+=t.count})),t.options.unshift({name:"全部",count:o,id:""}),e[t.type]=t.options})),e}))},t.hasMoreProblem=function(t){return r["a"].getProblemCount(t).then((function(t){return t.count>0}))},t.getAllProblemIds=function(t){return r["a"].getAllProblemIds(t).then((function(t){return t}))},t.checkHasUpload=function(t){return r["a"].hasUploadData(t).then((function(t){return t&&!!t["id"]}))},t};e["a"]=c()}}]);